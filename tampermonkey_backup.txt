{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"IITC: Ingress intel map total conversion","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null}},"storage":{"data":{},"ts":1480917632163},"enabled":true,"position":1,"file_url":"https://static.iitc.me/build/release/total-conversion-build.user.js","uuid":"a7a6c674-eba6-41d1-b984-8f16fa18cfb4","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGluZ3Jlc3MtaW50ZWwtdG90YWwtY29udmVyc2lvbkBqb25hdGtpbnMKLy8gQG5hbWUgICAgICAgICAgIElJVEM6IEluZ3Jlc3MgaW50ZWwgbWFwIHRvdGFsIGNvbnZlcnNpb24KLy8gQHZlcnNpb24gICAgICAgIDAuMjUuMi4yMDE2MTAwMy40NzQwCi8vIEBuYW1lc3BhY2UgICAgICBodHRwczovL2dpdGh1Yi5jb20vam9uYXRraW5zL2luZ3Jlc3MtaW50ZWwtdG90YWwtY29udmVyc2lvbgovLyBAdXBkYXRlVVJMICAgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3RvdGFsLWNvbnZlcnNpb24tYnVpbGQubWV0YS5qcwovLyBAZG93bmxvYWRVUkwgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3RvdGFsLWNvbnZlcnNpb24tYnVpbGQudXNlci5qcwovLyBAZGVzY3JpcHRpb24gICAgW2lpdGMtMjAxNi0xMC0wMy0wMDQ3NDBdIFRvdGFsIGNvbnZlcnNpb24gZm9yIHRoZSBpbmdyZXNzIGludGVsIG1hcC4KLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBpbmNsdWRlICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAZ3JhbnQgICAgICAgICAgbm9uZQovLyA9PS9Vc2VyU2NyaXB0PT0KCgovLyBSRVBMQUNFIE9SSUcgU0lURSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KaWYoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2h0bWwnKVswXS5nZXRBdHRyaWJ1dGUoJ2l0ZW1zY29wZScpICE9IG51bGwpCiAgdGhyb3coJ0luZ3Jlc3MgSW50ZWwgV2Vic2l0ZSBpcyBkb3duLCBub3QgYSB1c2Vyc2NyaXB0IGlzc3VlLicpOwp3aW5kb3cuaWl0Y0J1aWxkRGF0ZSA9ICcyMDE2LTEwLTAzLTAwNDc0MCc7CgovLyBkaXNhYmxlIHZhbmlsbGEgSlMKd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge307CmRvY3VtZW50LmJvZHkub25sb2FkID0gZnVuY3Rpb24oKSB7fTsKCi8vIHJlc2N1ZSB1c2VyIGRhdGEgZnJvbSBvcmlnaW5hbCBwYWdlCnZhciBzY3IgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7CmZvcih2YXIgeCBpbiBzY3IpIHsKICB2YXIgcyA9IHNjclt4XTsKICBpZihzLnNyYykgY29udGludWU7CiAgaWYocy50eXBlICE9PSAndGV4dC9qYXZhc2NyaXB0JykgY29udGludWU7CiAgdmFyIGQgPSBzLmlubmVySFRNTC5zcGxpdCgnXG4nKTsKICBicmVhazsKfQoKCmlmKCFkKSB7CiAgLy8gcGFnZSBkb2VzbuKAmXQgaGF2ZSBhIHNjcmlwdCB0YWcgd2l0aCBwbGF5ZXIgaW5mb3JtYXRpb24uCiAgaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYWRlcl9lbWFpbCcpKSB7CiAgICAvLyBob3dldmVyLCB3ZSBhcmUgbG9nZ2VkIGluLgogICAgLy8gaXQgdXNlZCB0byBiZSByZWd1bGFybHkgY29tbW9uIHRvIGdldCB0ZW1wb3JhcnkgJ2FjY291bnQgbm90IGVuYWJsZWQnIG1lc3NhZ2VzIGZyb20gdGhlIGludGVsIHNpdGUuCiAgICAvLyBob3dldmVyLCB0aGlzIGlzIG5vIGxvbmdlciBjb21tb24uIG1vcmUgY29tbW9uIGlzIHVzZXJzIGdldHRpbmcgYWNjb3VudCBzdXNwZW5kZWQvYmFubmVkIC0gYW5kIHRoaXMKICAgIC8vIGN1cnJlbnRseSBzaG93cyB0aGUgJ25vdCBlbmFibGVkJyBtZXNzYWdlLiBzbyBpdCdzIHNhZmVyIHRvIG5vdCByZXBlYXRlZGx5IHJlbG9hZCBpbiB0aGlzIGNhc2UKLy8gICAgc2V0VGltZW91dCgnbG9jYXRpb24ucmVsb2FkKCk7JywgMyoxMDAwKTsKICAgIHRocm93KCJQYWdlIGRvZXNuJ3QgaGF2ZSBwbGF5ZXIgZGF0YSwgYnV0IHlvdSBhcmUgbG9nZ2VkIGluLiIpOwogIH0KICAvLyBGSVhNRTogaGFuZGxlIG5pYSB0YWtlZG93biBpbiBwcm9ncmVzcwogIHRocm93KCJDb3VsZG4ndCByZXRyaWV2ZSBwbGF5ZXIgZGF0YS4gQXJlIHlvdSBsb2dnZWQgaW4/Iik7Cn0KCgpmb3IodmFyIGkgPSAwOyBpIDwgZC5sZW5ndGg7IGkrKykgewogIGlmKCFkW2ldLm1hdGNoKCd2YXIgUExBWUVSID0gJykpIGNvbnRpbnVlOwogIGV2YWwoZFtpXS5tYXRjaCgvXnZhciAvLCAnd2luZG93LicpKTsKICBicmVhazsKfQovLyBwbGF5ZXIgaW5mb3JtYXRpb24gaXMgbm93IGF2YWlsYWJsZSBpbiBhIGhhc2ggbGlrZSB0aGlzOgovLyB3aW5kb3cuUExBWUVSID0geyJhcCI6ICIxMjMiLCAiZW5lcmd5IjogMTIzLCAiYXZhaWxhYmxlX2ludml0ZXMiOiAxMjMsICJuaWNrbmFtZSI6ICJzb21lbmljayIsICJ0ZWFtIjogIkVOTElHSFRFTkVEfHxSRVNJU1RBTkNFIn07CgovLyByZW1vdmUgY29tcGxldGUgcGFnZS4gV2Ugb25seSB3YW50ZWQgdGhlIHVzZXItZGF0YSBhbmQgdGhlIHBhZ2XigJlzCi8vIHNlY3VyaXR5IGNvbnRleHQgc28gd2UgY2FuIGFjY2VzcyB0aGUgQVBJIGVhc2lseS4gU2V0dXAgYXMgbXVjaCBhcwovLyBwb3NzaWJsZSB3aXRob3V0IHJlcXVpcmluZyBzY3JpcHRzLgpkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmlubmVySFRNTCA9ICcnCiAgKyAnPHRpdGxlPkluZ3Jlc3MgSW50ZWwgTWFwPC90aXRsZT4nCiAgKyAnPHN0eWxlPi8qIGdlbmVyYWwgcnVsZXMgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4vKiBmb3IgcHJpbnRpbmcgZGlyZWN0bHkgZnJvbSB0aGUgYnJvd3NlciwgaGlkZSBhbGwgVUkgY29tcG9uZW50c1xuICogTk9URTogQG1lZGlhIG5lZWRzIHRvIGJlIGZpcnN0P1xuICovXG5AbWVkaWEgcHJpbnQge1xuICAubGVhZmxldC1jb250cm9sLWNvbnRhaW5lciB7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsgfVxuICAjY2hhdGNvbnRyb2xzLCAjY2hhdCwgI2NoYXRpbnB1dCB7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsgfVxuICAjc2lkZWJhcnRvZ2dsZSwgI3NpZGViYXIgeyBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7IH1cbiAgI3VwZGF0ZXN0YXR1cyB7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsgfVxuICAjcG9ydGFsX2hpZ2hsaWdodF9zZWxlY3QgeyBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7IH1cbn1cblxuXG5odG1sLCBib2R5LCAjbWFwIHtcbiAgaGVpZ2h0OiAxMDAlO1xuICB3aWR0aDogMTAwJTtcbiAgb3ZlcmZsb3c6IGhpZGRlbjsgLyogd29ya2Fyb3VuZCBmb3IgIzM3MyAqL1xuICBiYWNrZ3JvdW5kOiAjMGUzZDRlO1xufVxuXG5cbmJvZHkge1xuICBmb250LXNpemU6IDE0cHg7XG4gIGZvbnQtZmFtaWx5OiAiUm9ib3RvIiwgIkhlbHZldGljYSBOZXVlIiwgSGVsdmV0aWNhLCBzYW5zLXNlcmlmO1xuICBtYXJnaW46IDA7XG59XG5cbiNzY3JvbGx3cmFwcGVyIHtcbiAgb3ZlcmZsb3cteDogaGlkZGVuO1xuICBvdmVyZmxvdy15OiBhdXRvO1xuICBwb3NpdGlvbjogZml4ZWQ7XG4gIHJpZ2h0OiAtMzhweDtcbiAgdG9wOiAwO1xuICB3aWR0aDogMzQwcHg7XG4gIGJvdHRvbTogNDVweDtcbiAgei1pbmRleDogMTAwMTtcbiAgcG9pbnRlci1ldmVudHM6IG5vbmU7XG59XG5cbiNzaWRlYmFyIHtcbiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSg4LCA0OCwgNzgsIDAuOSk7XG4gIGJvcmRlci1sZWZ0OiAxcHggc29saWQgIzIwQThCMTtcbiAgY29sb3I6ICM4ODg7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgbGVmdDogMDtcbiAgdG9wOiAwO1xuICBtYXgtaGVpZ2h0OiAxMDAlO1xuICBvdmVyZmxvdy15OnNjcm9sbDtcbiAgb3ZlcmZsb3cteDpoaWRkZW47XG4gIHotaW5kZXg6IDMwMDA7XG4gIHBvaW50ZXItZXZlbnRzOiBhdXRvO1xufVxuXG4jc2lkZWJhcnRvZ2dsZSB7XG4gIGRpc3BsYXk6IGJsb2NrO1xuICBwYWRkaW5nOiAyMHB4IDVweDtcbiAgbWFyZ2luLXRvcDogLTMxcHg7IC8qIC0odG9nZ2xlIGhlaWdodCAvIDIpICovXG4gIGxpbmUtaGVpZ2h0OiAxMHB4O1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHRvcDogMTA4cHg7XG4gIHotaW5kZXg6IDMwMDE7XG4gIGJhY2tncm91bmQtY29sb3I6IHJnYmEoOCwgNDgsIDc4LCAwLjkpO1xuICBjb2xvcjogI0ZGQ0UwMDtcbiAgYm9yZGVyOiAxcHggc29saWQgIzIwQThCMTtcbiAgYm9yZGVyLXJpZ2h0OiBub25lO1xuICBib3JkZXItcmFkaXVzOiA1cHggMCAwIDVweDtcbiAgdGV4dC1kZWNvcmF0aW9uOiBub25lO1xuICByaWdodDogLTUwcHg7IC8qIG92ZXJ3cml0dGVuIGxhdGVyIGJ5IHRoZSBzY3JpcHQgd2l0aCBTSURFQkFSX1dJRFRIICovXG59XG5cbi5lbmwge1xuICBjb2xvcjogIzAzZmUwMyAhaW1wb3J0YW50O1xufVxuXG4ucmVzIHtcbiAgY29sb3I6ICMwMGM1ZmYgIWltcG9ydGFudDtcbn1cblxuLm5vbmUge1xuICBjb2xvcjogI2ZmZjtcbn1cblxuLm5pY2tuYW1lIHtcbiAgY3Vyc29yOiBwb2ludGVyICFpbXBvcnRhbnQ7XG59XG5cbmEge1xuICBjb2xvcjogI2ZmY2UwMDtcbiAgY3Vyc29yOiBwb2ludGVyO1xuICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG59XG5cbmE6aG92ZXIge1xuICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTtcbn1cblxuLyogbWFwIGRpc3BsYXksIHJlcXVpcmVkIGJlY2F1c2UgR01hcHMgdXNlcyBhIGhpZ2ggei1pbmRleCB3aGljaCBpc1xuICogbm9ybWFsbHkgYWJvdmUgTGVhZmxldOKAmXMgdmVjdG9yIHBhbmUgKi9cbi5sZWFmbGV0LW1hcC1wYW5lIHtcbiAgei1pbmRleDogMTAwMDtcbn1cblxuLyogbGVhZmxldCBsYXllciBjaG9vc2VyLCB3aGVuIG9wZW5lZCwgaXMgYWJvdmUgb3RoZXIgcGFuZWxzICovXG4vKiBkb2VzblwndCBhY3R1YWxseSB3b3JrIDooIC0gbGVmdCBjb21tZW50ZWQgb3V0IGZvciByZWZlcmVuY2Vcbi5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLWV4cGFuZGVkIHtcbiAgei1pbmRleDogOTk5OSAhaW1wb3J0YW50O1xufVxuKi9cblxuXG4ubGVhZmxldC1jb250cm9sLWxheWVycy1vdmVybGF5cyBsYWJlbC5kaXNhYmxlZCB7XG4gIHRleHQtZGVjb3JhdGlvbjogbGluZS10aHJvdWdoO1xuICBjdXJzb3I6IGhlbHA7XG59XG5cblxuXG4vKiBiYXNlIGxheWVyIHNlbGVjdGlvbiAtIGZpcnN0IGNvbHVtbiAqL1xuLmxlYWZsZXQtY29udHJvbC1sYXllcnMtYmFzZSB7XG4gIGZsb2F0OiBsZWZ0O1xuICBvdmVyZmxvdy15OiBhdXRvO1xuICBtYXgtaGVpZ2h0OiA2MDBweDtcbn1cblxuLyogb3ZlcmxheXMgbGF5ZXIgc2VsZWN0aW9uIC0gMm5kIGNvbHVtbiAqL1xuLmxlYWZsZXQtY29udHJvbC1sYXllcnMtb3ZlcmxheXMge1xuICBmbG9hdDogbGVmdDtcbiAgbWFyZ2luLWxlZnQ6IDhweDtcbiAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjREREREREO1xuICBwYWRkaW5nLWxlZnQ6IDhweDtcbiAgb3ZlcmZsb3cteTogYXV0bztcbiAgbWF4LWhlaWdodDogNjAwcHg7XG59XG5cbi8qIGhpZGUgdGhlIHVzdWFsIHNlcGFyYXRvciAqL1xuLmxlYWZsZXQtY29udHJvbC1sYXllcnMtc2VwYXJhdG9yIHtcbiAgZGlzcGxheTogbm9uZTtcbn1cblxuXG5cbi5oZWxwIHtcbiAgY3Vyc29yOiBoZWxwO1xufVxuXG4udG9nZ2xlIHtcbiAgZGlzcGxheTogYmxvY2s7XG4gIGhlaWdodDogMDtcbiAgd2lkdGg6IDA7XG59XG5cbi8qIGZpZWxkIG11IGNvdW50ICovXG4uZmllbGRtdSB7XG4gIGNvbG9yOiAjRkZDRTAwO1xuICBmb250LXNpemU6IDEzcHg7XG4gIGZvbnQtZmFtaWx5OiBSb2JvdG8sICJIZWx2ZXRpY2EgTmV1ZSIsIEhlbHZldGljYSwgc2Fucy1zZXJpZjsgLypvdmVycmlkZSBsZWFmbGV0LWNvbnRhaW5lciAqL1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIHRleHQtc2hhZG93OiAwIDAgMC4yZW0gYmxhY2ssIDAgMCAwLjJlbSBibGFjaywgMCAwIDAuMmVtIGJsYWNrO1xuICBwb2ludGVyLWV2ZW50czogbm9uZTtcbn1cblxuXG4vKiBjaGF0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuI2NoYXRjb250cm9scyB7XG4gIGNvbG9yOiAjRkZDRTAwO1xuICBiYWNrZ3JvdW5kOiByZ2JhKDgsIDQ4LCA3OCwgMC45KTtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBsZWZ0OiAwO1xuICB6LWluZGV4OiAzMDAwO1xuICBoZWlnaHQ6IDI2cHg7XG4gIHBhZGRpbmctbGVmdDoxcHg7XG59XG5cbiNjaGF0Y29udHJvbHMuZXhwYW5kIHtcbiAgdG9wOiAwO1xuICBib3R0b206IGF1dG87XG59XG5cbiNjaGF0Y29udHJvbHMgYSB7XG4gIG1hcmdpbi1sZWZ0OiAtMXB4O1xuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIHdpZHRoOiA5NHB4O1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIGhlaWdodDogMjRweDtcbiAgbGluZS1oZWlnaHQ6IDI0cHg7XG4gIGJvcmRlcjogMXB4IHNvbGlkICMyMEE4QjE7XG4gIHZlcnRpY2FsLWFsaWduOiB0b3A7XG59XG5cbiNjaGF0Y29udHJvbHMgYTpmaXJzdC1jaGlsZCB7XG4gIGxldHRlci1zcGFjaW5nOi0xcHg7XG4gIHRleHQtZGVjb3JhdGlvbjogbm9uZSAhaW1wb3J0YW50O1xufVxuXG4jY2hhdGNvbnRyb2xzIGEuYWN0aXZlIHtcbiAgYm9yZGVyLWNvbG9yOiAjRkZDRTAwO1xuICBib3JkZXItYm90dG9tLXdpZHRoOjBweDtcbiAgZm9udC13ZWlnaHQ6Ym9sZDtcbiAgYmFja2dyb3VuZDogcmdiKDgsIDQ4LCA3OCk7XG59XG5cbiNjaGF0Y29udHJvbHMgYS5hY3RpdmUgKyBhIHtcbiAgYm9yZGVyLWxlZnQtY29sb3I6ICNGRkNFMDBcbn1cblxuXG4jY2hhdGNvbnRyb2xzIC50b2dnbGUge1xuICBib3JkZXItbGVmdDogMTBweCBzb2xpZCB0cmFuc3BhcmVudDtcbiAgYm9yZGVyLXJpZ2h0OiAxMHB4IHNvbGlkIHRyYW5zcGFyZW50O1xuICBtYXJnaW46IDZweCBhdXRvIGF1dG87XG59XG5cbiNjaGF0Y29udHJvbHMgLmV4cGFuZCB7XG4gIGJvcmRlci1ib3R0b206IDEwcHggc29saWQgI0ZGQ0UwMDtcbn1cblxuI2NoYXRjb250cm9scyAuc2hyaW5rIHtcbiAgYm9yZGVyLXRvcDogMTBweCBzb2xpZCAjRkZDRTAwO1xufVxuXG4jY2hhdGNvbnRyb2xzIC5sb2FkaW5nIHtcbiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyNTUsMCwwLDAuMyk7XG4gIC13ZWJraXQtYW5pbWF0aW9uOiBjaGF0bG9hZGluZyAxLjJzIGluZmluaXRlIGxpbmVhcjtcbiAgLW1vei1hbmltYXRpb246IGNoYXRsb2FkaW5nIDEuMnMgaW5maW5pdGUgbGluZWFyO1xuICBhbmltYXRpb246IGNoYXRsb2FkaW5nIDEuMnMgaW5maW5pdGUgbGluZWFyO1xufVxuXG5ALXdlYmtpdC1rZXlmcmFtZXMgY2hhdGxvYWRpbmcge1xuICAgIDAlIHsgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyNTUsMCwwLDAuNCkgfVxuICAgNTAlIHsgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyNTUsMCwwLDAuMSkgfVxuICAxMDAlIHsgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyNTUsMCwwLDAuNCkgfVxufVxuXG5ALW1vei1rZXlmcmFtZXMgY2hhdGxvYWRpbmcge1xuICAgIDAlIHsgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyNTUsMCwwLDAuNCkgfVxuICAgNTAlIHsgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyNTUsMCwwLDAuMSkgfVxuICAxMDAlIHsgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyNTUsMCwwLDAuNCkgfVxufVxuXG5Aa2V5ZnJhbWVzIGNoYXRsb2FkaW5nIHtcbiAgICAwJSB7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LDAsMCwwLjQpIH1cbiAgIDUwJSB7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LDAsMCwwLjEpIH1cbiAgMTAwJSB7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LDAsMCwwLjQpIH1cbn1cblxuXG5cbiNjaGF0IHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB3aWR0aDogNzA4cHg7XG4gIGJvdHRvbTogMjNweDtcbiAgbGVmdDogMDtcbiAgei1pbmRleDogMzAwMDtcbiAgYmFja2dyb3VuZDogcmdiYSg4LCA0OCwgNzgsIDAuOSk7XG4gIGxpbmUtaGVpZ2h0OiAxNXB4O1xuICBjb2xvcjogI2VlZTtcbiAgYm9yZGVyOiAxcHggc29saWQgIzIwQThCMTtcbiAgYm9yZGVyLWJvdHRvbTogMDtcbiAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG59XG5cbmVtIHtcbiAgY29sb3I6IHJlZDtcbiAgZm9udC1zdHlsZTogbm9ybWFsO1xufVxuXG4jY2hhdC5leHBhbmQge1xuICBoZWlnaHQ6YXV0bztcbiAgdG9wOiAyNXB4O1xufVxuXG5cbiNjaGF0ID4gZGl2IHtcbiAgb3ZlcmZsb3cteDpoaWRkZW47XG4gIG92ZXJmbG93LXk6c2Nyb2xsO1xuICBoZWlnaHQ6IDEwMCU7XG4gIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICBwYWRkaW5nOiAycHg7XG4gIHBvc2l0aW9uOnJlbGF0aXZlO1xufVxuXG4jY2hhdCB0YWJsZSwgI2NoYXRpbnB1dCB0YWJsZSB7XG4gIHdpZHRoOiAxMDAlO1xuICB0YWJsZS1sYXlvdXQ6IGZpeGVkO1xuICBib3JkZXItc3BhY2luZzogMDtcbiAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTtcbn1cblxuI2NoYXRpbnB1dCB0YWJsZSB7XG4gIGhlaWdodDogMTAwJTtcbn1cblxuI2NoYXQgdGQsICNjaGF0aW5wdXQgdGQge1xuICBmb250LXNpemU6IDEzcHg7XG4gIHZlcnRpY2FsLWFsaWduOiB0b3A7XG4gIHBhZGRpbmctYm90dG9tOiAzcHg7XG59XG5cbi8qIHRpbWUgKi9cbiNjaGF0IHRkOmZpcnN0LWNoaWxkLCAjY2hhdGlucHV0IHRkOmZpcnN0LWNoaWxkIHtcbiAgd2lkdGg6IDQ0cHg7XG4gIG92ZXJmbG93OiBoaWRkZW47XG4gIHBhZGRpbmctbGVmdDogMnB4O1xuICBjb2xvcjogI2JiYjtcbiAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbn1cblxuI2NoYXQgdGltZSB7XG4gIGN1cnNvcjogaGVscDtcbn1cblxuLyogbmljayAqL1xuI2NoYXQgdGQ6bnRoLWNoaWxkKDIpLCAjY2hhdGlucHV0IHRkOm50aC1jaGlsZCgyKSB7XG4gIHdpZHRoOiA5MXB4O1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICBwYWRkaW5nLWxlZnQ6IDJweDtcbiAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbn1cblxuI2NoYXQgdGQgLnN5c3RlbV9uYXJyb3djYXN0IHtcbiAgY29sb3I6ICNmNjYgIWltcG9ydGFudDtcbn1cblxubWFyayB7XG4gIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50O1xufVxuXG4uaW52aXNlcCB7XG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgd2lkdGg6IDFweDtcbiAgaGVpZ2h0OiAxcHg7XG4gIG92ZXJmbG93OmhpZGRlbjtcbiAgY29sb3I6IHRyYW5zcGFyZW50O1xufVxuXG4vKiBkaXZpZGVyICovXG5zdW1tYXJ5IHtcbiAgY29sb3I6ICNiYmI7XG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgaGVpZ2h0OiAxNnB4O1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICBwYWRkaW5nOiAwIDJweDtcbiAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbiAgd2lkdGg6IDEwMCU7XG59XG5cbiNjaGF0aW5wdXQge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIGJvdHRvbTogMDtcbiAgbGVmdDogMDtcbiAgcGFkZGluZzogMCAycHg7XG4gIGJhY2tncm91bmQ6IHJnYmEoOCwgNDgsIDc4LCAwLjkpO1xuICB3aWR0aDogNzA4cHg7XG4gIGhlaWdodDogMjNweDtcbiAgYm9yZGVyOiAxcHggc29saWQgIzIwQThCMTtcbiAgei1pbmRleDogMzAwMTtcbiAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG59XG5cbiNjaGF0aW5wdXQgdGQge1xuICBwYWRkaW5nLWJvdHRvbTogMXB4O1xuICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO1xufVxuXG5cbiNjaGF0aW5wdXQgaW5wdXQge1xuICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDtcbiAgY29sb3I6ICNFRUVFRUU7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDEwMCU7XG4gIHBhZGRpbmc6M3B4IDRweCAxcHggNHB4O1xufVxuXG5cblxuLyogc2lkZWJhciAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbiNzaWRlYmFyID4gKiB7XG4gIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjMjBBOEIxO1xuICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbn1cblxuXG5cbiNzaWRlYmFydG9nZ2xlIC50b2dnbGUge1xuICBib3JkZXItYm90dG9tOiAxMHB4IHNvbGlkIHRyYW5zcGFyZW50O1xuICBib3JkZXItdG9wOiAxMHB4IHNvbGlkIHRyYW5zcGFyZW50O1xufVxuXG4jc2lkZWJhcnRvZ2dsZSAub3BlbiB7XG4gIGJvcmRlci1yaWdodDogMTBweCBzb2xpZCAjRkZDRTAwO1xufVxuXG4jc2lkZWJhcnRvZ2dsZSAuY2xvc2Uge1xuICBib3JkZXItbGVmdDogMTBweCBzb2xpZCAjRkZDRTAwO1xufVxuXG4vKiBwbGF5ZXIgc3RhdHMgKi9cbiNwbGF5ZXJzdGF0IHtcbiAgaGVpZ2h0OiAzMHB4O1xufVxuXG5oMiB7XG4gIGNvbG9yOiAjZmZjZTAwO1xuICBmb250LXNpemU6IDIxcHg7XG4gIHBhZGRpbmc6IDAgNHB4O1xuICBtYXJnaW46IDA7XG4gIGN1cnNvcjpoZWxwO1xuICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgd2lkdGg6IDEwMCU7XG59XG5cbmgyICNuYW1lIHtcbiAgZm9udC13ZWlnaHQ6IDMwMDtcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpcztcbiAgdmVydGljYWwtYWxpZ246IHRvcDtcbiAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbiAgd2lkdGg6IDIwNXB4O1xuICBwb3NpdGlvbjogcmVsYXRpdmU7XG59XG5cbmgyICNzdGF0cyB7XG4gIGZsb2F0OiByaWdodDtcbiAgaGVpZ2h0OiAxMDAlO1xuICBvdmVyZmxvdzogaGlkZGVuO1xufVxuXG4jc2lnbm91dCB7XG4gIGZvbnQtc2l6ZTogMTJweDtcbiAgZm9udC13ZWlnaHQ6IG5vcm1hbDtcbiAgbGluZS1oZWlnaHQ6IDI5cHg7XG4gIHBhZGRpbmc6IDAgNHB4O1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHRvcDogMDtcbiAgcmlnaHQ6IDA7XG4gIGJhY2tncm91bmQtY29sb3I6IHJnYmEoOCwgNDgsIDc4LCAwLjUpO1xuICBkaXNwbGF5OiBub25lOyAvKiBzdGFydHMgaGlkZGVuICovXG59XG4jbmFtZTpob3ZlciAjc2lnbm91dCB7XG4gIGRpc3BsYXk6IGJsb2NrO1xufVxuXG5oMiBzdXAsIGgyIHN1YiB7XG4gIGRpc3BsYXk6IGJsb2NrO1xuICBmb250LXNpemU6IDExcHg7XG4gIG1hcmdpbi1ib3R0b206IC0ycHg7XG59XG5cblxuLyogZ2FtZXN0YXRzICovXG4jZ2FtZXN0YXQge1xuICBoZWlnaHQ6IDIycHg7XG59XG5cbiNnYW1lc3RhdCBzcGFuIHtcbiAgZGlzcGxheTogYmxvY2s7XG4gIGZsb2F0OiBsZWZ0O1xuICBmb250LXdlaWdodDogYm9sZDtcbiAgY3Vyc29yOmhlbHA7XG4gIGhlaWdodDogMjFweDtcbiAgbGluZS1oZWlnaHQ6IDIycHg7XG59XG5cbiNnYW1lc3RhdCAucmVzIHtcbiAgYmFja2dyb3VuZDogIzAwNTY4NDtcbiAgdGV4dC1hbGlnbjogcmlnaHQ7XG59XG5cbiNnYW1lc3RhdCAuZW5sIHtcbiAgYmFja2dyb3VuZDogIzAxN2YwMTtcbn1cblxuXG4vKiBzZWFyY2ggaW5wdXQsIGFuZCBvdGhlcnMgKi9cbmlucHV0Om5vdChbdHlwZV0pLCAuaW5wdXQsXG5pbnB1dFt0eXBlPSJ0ZXh0Il0sIGlucHV0W3R5cGU9InBhc3N3b3JkIl0sXG5pbnB1dFt0eXBlPSJudW1iZXIiXSwgaW5wdXRbdHlwZT0iZW1haWwiXSxcbmlucHV0W3R5cGU9InNlYXJjaCJdLCBpbnB1dFt0eXBlPSJ1cmwiXSB7XG4gIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC4zKTtcbiAgY29sb3I6ICNmZmNlMDA7XG4gIGhlaWdodDogMjRweDtcbiAgcGFkZGluZzowcHggNHB4IDBweCA0cHg7XG4gIGZvbnQtc2l6ZTogMTJweDtcbiAgYm9yZGVyOjA7XG4gIGZvbnQtZmFtaWx5OmluaGVyaXQ7XG4gIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xufVxuXG4jc2VhcmNod3JhcHBlciB7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbn1cbiNzZWFyY2gge1xuICB3aWR0aDogMTAwJTtcbiAgcGFkZGluZy1yaWdodDogMjRweDtcbn1cbiNidXR0b25nZW9sb2NhdGlvbiB7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgdG9wOiAycHg7XG4gIHJpZ2h0OiAycHg7XG4gIGN1cnNvcjogcG9pbnRlcjtcbn1cbiNzZWFyY2h3cmFwcGVyIGgzIHtcbiAgZm9udC1zaXplOiAxZW07XG4gIGhlaWdodDogYXV0bztcbiAgY3Vyc29yOiBwb2ludGVyO1xufVxuLnNlYXJjaHF1ZXJ5IHtcbiAgbWF4LWhlaWdodDogMjVlbTtcbiAgb3ZlcmZsb3cteTogYXV0bztcbn1cbiNzZWFyY2h3cmFwcGVyIC51aS1hY2NvcmRpb24taGVhZGVyOjpiZWZvcmUge1xuICBmb250LXNpemU6IDE4cHg7XG4gIG1hcmdpbi1yaWdodDogMnB4O1xuICBmb250LXdlaWdodDogbm9ybWFsO1xuICBsaW5lLWhlaWdodDogMWVtO1xuICBjb250ZW50OiAi4oqeIjtcbn1cbiNzZWFyY2h3cmFwcGVyIC51aS1hY2NvcmRpb24taGVhZGVyLWFjdGl2ZTo6YmVmb3JlIHtcbiAgY29udGVudDogIuKKnyI7XG59XG4jc2VhcmNod3JhcHBlciAudWktYWNjb3JkaW9uLWNvbnRlbnQge1xuICBtYXJnaW46IDA7XG4gIG92ZXJmbG93OiBoaWRkZW47XG59XG4jc2VhcmNod3JhcHBlciB1bCB7XG4gIHBhZGRpbmctbGVmdDogMTRweDtcbn1cbiNzZWFyY2h3cmFwcGVyIGxpIHtcbiAgY3Vyc29yOiBwb2ludGVyO1xufVxuI3NlYXJjaHdyYXBwZXIgbGkgYSB7XG4gIG1hcmdpbi1sZWZ0OiAtMTRweDtcbiAgcGFkZGluZy1sZWZ0OiAxNHB4O1xuICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAxcHggY2VudGVyO1xuICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0O1xuICBiYWNrZ3JvdW5kLXNpemU6IDEycHggMTJweDtcbn1cbiNzZWFyY2h3cmFwcGVyIGxpOmZvY3VzIGEsICNzZWFyY2h3cmFwcGVyIGxpOmhvdmVyIGEge1xuICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTtcbn1cbiNzZWFyY2h3cmFwcGVyIGxpIGVtIHtcbiAgY29sb3I6ICNjY2M7XG4gIGZvbnQtc2l6ZTogMC45ZW07XG59XG5cbjo6LXdlYmtpdC1pbnB1dC1wbGFjZWhvbGRlciB7XG4gIGZvbnQtc3R5bGU6IGl0YWxpYztcbn1cblxuOi1tb3otcGxhY2Vob2xkZXIge1xuICBmb250LXN0eWxlOiBpdGFsaWM7XG59XG5cbjo6LW1vei1wbGFjZWhvbGRlciB7XG4gIGZvbnQtc3R5bGU6IGl0YWxpYztcbn1cblxuLmxlYWZsZXQtY29udHJvbC1sYXllcnMgaW5wdXQge1xuICBoZWlnaHQ6IGF1dG87XG4gIHBhZGRpbmc6IDA7XG59XG5cblxuLyogcG9ydGFsIHRpdGxlIGFuZCBpbWFnZSAqL1xuaDMge1xuICBmb250LXNpemU6IDE2cHg7XG4gIHBhZGRpbmc6IDAgNHB4O1xuICBtYXJnaW46MDtcbiAgaGVpZ2h0OiAyM3B4O1xuICB3aWR0aDogMTAwJTtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xufVxuXG4uaW1ncHJldmlldyB7XG4gIGhlaWdodDogMTkwcHg7XG4gIGJhY2tncm91bmQ6IG5vLXJlcGVhdCBjZW50ZXIgY2VudGVyO1xuICBiYWNrZ3JvdW5kLXNpemU6IGNvbnRhaW47XG4gIGN1cnNvcjogaGVscDtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xufVxuXG4uaW1ncHJldmlldyBpbWcuaGlkZSB7XG4gIGRpc3BsYXk6IG5vbmU7XG59XG5cbi5pbWdwcmV2aWV3IC5wb3J0YWxEZXRhaWxzIHtcbiAgZGlzcGxheTogbm9uZTtcbn1cblxuI2xldmVsIHtcbiAgZm9udC1zaXplOiA0MHB4O1xuICB0ZXh0LXNoYWRvdzogLTFweCAtMXB4ICMwMDAsIDFweCAtMXB4ICMwMDAsIC0xcHggMXB4ICMwMDAsIDFweCAxcHggIzAwMCwgMCAwIDVweCAjZmZmO1xuICBkaXNwbGF5OiBibG9jaztcbiAgbWFyZ2luLXJpZ2h0OiAxNXB4O1xuICB0ZXh0LWFsaWduOnJpZ2h0O1xuICBmbG9hdDogcmlnaHQ7XG59XG5cbi8qIHBvcnRhbCBtb2RzICovXG4ubW9kcyB7XG4gIG1hcmdpbjogM3B4IGF1dG8gMXB4IGF1dG87XG4gIHdpZHRoOiAyOTZweDtcbiAgaGVpZ2h0OiA2N3B4O1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG59XG5cbi5tb2RzIHNwYW4ge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuMyk7XG4gIC8qIGNhbuKAmXQgdXNlIGlubGluZS1ibG9jayBiZWNhdXNlIFdlYmtpdFwncyBpbXBsZW1lbnRhdGlvbiBpcyBidWdneSBhbmRcbiAgICogaW50cm9kdWNlcyBhZGRpdGlvbmFsIG1hcmdpbnMgaW4gcmFuZG9tIGNhc2VzLiBObyBjbGVhciBuZWNlc3NhcnksXG4gICAqIGFzIHRoYXTigJlzIHNvbHZlZCBieSBzZXR0aW5nIGhlaWdodCBvbiAubW9kcy4gKi9cbiAgZGlzcGxheTogYmxvY2s7XG4gIGZsb2F0OmxlZnQ7XG4gIGhlaWdodDogNjNweDtcbiAgbWFyZ2luOiAwIDJweDtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgcGFkZGluZzogMnB4O1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIHdpZHRoOiA2M3B4O1xuICBjdXJzb3I6aGVscDtcbiAgYm9yZGVyOiAxcHggc29saWQgIzY2Njtcbn1cblxuLm1vZHMgc3Bhbjpub3QoW3RpdGxlXSkge1xuICBjdXJzb3I6IGF1dG87XG59XG5cbi5yZXMgLm1vZHMgc3BhbiwgLnJlcyAubWV0ZXIge1xuICBib3JkZXI6IDFweCBzb2xpZCAjMDA3NmI2O1xufVxuLmVubCAubW9kcyBzcGFuLCAuZW5sIC5tZXRlciB7XG4gIGJvcmRlcjogMXB4IHNvbGlkICMwMTdmMDE7XG59XG5cbi8qIHJhbmRvbSBkZXRhaWxzLCByZXNvbmF0b3IgZGV0YWlscyAqL1xuI3JhbmRkZXRhaWxzLCAjcmVzb2RldGFpbHMge1xuICB3aWR0aDogMTAwJTtcbiAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIHBhZGRpbmc6IDAgNHB4O1xuICB0YWJsZS1sYXlvdXQ6IGZpeGVkO1xuICBib3JkZXItc3BhY2luZzogMG07XG4gIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7XG59XG5cbiNyYW5kZGV0YWlscyB0ZCwgI3Jlc29kZXRhaWxzIHRkIHtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gIHZlcnRpY2FsLWFsaWduOiB0b3A7XG4gIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gIHdpZHRoOiA1MCU7XG59XG5cbiNyYW5kZGV0YWlscyB0aCwgI3Jlc29kZXRhaWxzIHRoIHtcbiAgZm9udC13ZWlnaHQ6IG5vcm1hbDtcbiAgdGV4dC1hbGlnbjogcmlnaHQ7XG4gIHdpZHRoOiA2MnB4O1xuICBwYWRkaW5nOjBweDtcbiAgcGFkZGluZy1yaWdodDo0cHg7XG4gIHBhZGRpbmctbGVmdDo0cHg7XG59XG5cbiNyYW5kZGV0YWlscyB0aCArIHRoLCAjcmVzb2RldGFpbHMgdGggKyB0aCB7XG4gIHRleHQtYWxpZ246IGxlZnQ7XG4gIHBhZGRpbmctcmlnaHQ6IDRweDtcbiAgcGFkZGluZy1sZWZ0OiA0cHg7XG59XG5cbiNyYW5kZGV0YWlscyB0ZDpmaXJzdC1jaGlsZCwgI3Jlc29kZXRhaWxzIHRkOmZpcnN0LWNoaWxkIHtcbiAgdGV4dC1hbGlnbjogcmlnaHQ7XG4gIHBhZGRpbmctbGVmdDogMnB4O1xufVxuXG4jcmFuZGRldGFpbHMgdGQ6bGFzdC1jaGlsZCwgI3Jlc29kZXRhaWxzIHRkOmxhc3QtY2hpbGQge1xuICB0ZXh0LWFsaWduOiBsZWZ0O1xuICBwYWRkaW5nLXJpZ2h0OiAycHg7XG59XG5cblxuI3JhbmRkZXRhaWxzIHtcbiAgbWFyZ2luLXRvcDogNHB4O1xuICBtYXJnaW4tYm90dG9tOiA1cHg7XG59XG5cblxuI3JhbmRkZXRhaWxzIHR0IHtcbiAgZm9udC1mYW1pbHk6IGluaGVyaXQ7XG4gIGN1cnNvcjogaGVscDtcbn1cblxuI2FydGlmYWN0X3RhcmdldCwgI2FydGlmYWN0X2ZyYWdtZW50cyB7XG4gIG1hcmdpbi10b3A6IDRweDtcbiAgbWFyZ2luLWJvdHRvbTogNHB4O1xuXG4gIG1hcmdpbi1sZWZ0OiA4cHg7XG4gIG1hcmdpbi1yaWdodDogOHB4O1xufVxuXG5cbi8qIHJlc29uYXRvcnMgKi9cbiNyZXNvZGV0YWlscyB7XG4gIG1hcmdpbi1ib3R0b206IDBweDtcbn1cblxuLm1ldGVyIHtcbiAgYmFja2dyb3VuZDogIzAwMDtcbiAgY3Vyc29yOiBoZWxwO1xuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIGhlaWdodDogMThweDtcbiAgcGFkZGluZzogMXB4O1xuICB3aWR0aDogMTAwJTtcbiAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgbGVmdDogMDtcbiAgdG9wOiAwO1xufVxuXG4ubWV0ZXIubm9ydGgge1xuICBvdmVyZmxvdzogaGlkZGVuO1xufVxuLm1ldGVyLm5vcnRoOmJlZm9yZSB7XG4gIGNvbnRlbnQ6ICIiO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiByZWQ7XG4gIGJvcmRlcjogMXB4IHNvbGlkICMwMDAwMDA7XG4gIGJvcmRlci1yYWRpdXM6IDEwMCU7XG4gIGRpc3BsYXk6IGJsb2NrO1xuICBoZWlnaHQ6IDZweDtcbiAgd2lkdGg6IDZweDtcbiAgbGVmdDogNTAlO1xuICB0b3A6IC0zcHg7XG4gIG1hcmdpbi1sZWZ0OiAtNHB4O1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG59XG5cbi5tZXRlciBzcGFuIHtcbiAgZGlzcGxheTogYmxvY2s7XG4gIGhlaWdodDogMTRweDtcbn1cblxuLm1ldGVyLWxldmVsIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBsZWZ0OiAwO1xuICByaWdodDogMDtcbiAgdG9wOiAtMnB4O1xuICB0ZXh0LXNoYWRvdzogMC4wZW0gMC4wZW0gMC4zZW0gIzgwODA4MDtcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xuICB3b3JkLXNwYWNpbmc6IDRweDsgLyogdG8gbGVhdmUgc29tZSBzcGFjZSBmb3IgdGhlIG5vcnRoIGluZGljYXRvciAqL1xufVxuXG4vKiBsaW5rcyBiZWxvdyByZXNvcyAqL1xuXG4ubGlua2RldGFpbHMge1xuICBtYXJnaW4tYm90dG9tOiAwcHg7XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbn1cblxuLmxpbmtkZXRhaWxzIGFzaWRlIHtcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICBtYXJnaW4tbGVmdDogNXB4O1xuICBtYXJnaW4tcmlnaHQ6IDVweDtcbn1cblxuI3Rvb2xib3gge1xuICB0ZXh0LWFsaWduOiBsZWZ0OyAgICAvKiBjZW50cmUgZGlkblwndCBsb29rIGFzIG5pY2UgaGVyZSBhcyBpdCBkaWQgYWJvdmUgaW4gLmxpbmtkZXRhaWxzICovXG59XG5cbiN0b29sYm94ID4gYSB7XG4gIG1hcmdpbi1sZWZ0OiA1cHg7XG4gIG1hcmdpbi1yaWdodDogNXB4O1xuICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG59XG5cbi8qIGEgY29tbW9uIHBvcnRhbCBkaXNwbGF5IHRha2VzIHRoaXMgbXVjaCBzcGFjZSAocHJldmVudHMgbW92aW5nXG4gKiBjb250ZW50IHdoZW4gZmlyc3Qgc2VsZWN0aW5nIGEgcG9ydGFsKSAqL1xuXG4jcG9ydGFsZGV0YWlscyB7XG4gIG1pbi1oZWlnaHQ6IDYzcHg7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTsgLyogc28gdGhlIGJlbG93IFwnI3BvcnRhbGRldGFpbHMgLmNsb3NlXCcgaXMgcmVsYXRpdmUgdG8gdGhpcyAqL1xufVxuXG4jcG9ydGFsZGV0YWlscyAuY2xvc2Uge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHRvcDogLTJweDtcbiAgcmlnaHQ6IDJweDtcbiAgY3Vyc29yOiBwb2ludGVyO1xuICBjb2xvcjogI0ZGQ0UwMDtcbiAgZm9udC1zaXplOiAxNnB4O1xufVxuXG4vKiB1cGRhdGUgc3RhdHVzICovXG4jdXBkYXRlc3RhdHVzIHtcbiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSg4LCA0OCwgNzgsIDAuOSk7XG4gIGJvcmRlci1ib3R0b206IDA7XG4gIGJvcmRlci10b3A6IDFweCBzb2xpZCAjMjBBOEIxO1xuICBib3JkZXItbGVmdDogMXB4IHNvbGlkICMyMEE4QjE7XG4gIGJvdHRvbTogMDtcbiAgY29sb3I6ICNmZmNlMDA7XG4gIGZvbnQtc2l6ZToxM3B4O1xuICBwYWRkaW5nOiA0cHg7XG4gIHBvc2l0aW9uOiBmaXhlZDtcbiAgcmlnaHQ6IDA7XG4gIHotaW5kZXg6IDMwMDI7XG4gIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xufVxuXG4jdXBkYXRlc3RhdHVzIC5tYXAge1xuICBtYXJnaW4tbGVmdDogOHB4O1xufVxuXG4jbG9hZGxldmVsIHtcbiAgYmFja2dyb3VuZDogI0ZGRjtcbiAgY29sb3I6ICMwMDAwMDA7XG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgbWluLXdpZHRoOiAxLjhlbTtcbiAgYm9yZGVyOiAxcHggc29saWQgIzIwQThCMTtcbiAgYm9yZGVyLXdpZHRoOiAwIDFweDtcbiAgbWFyZ2luOiAtNHB4IDA7XG4gIHBhZGRpbmc6IDRweCAwLjJlbTtcbn1cblxuLyogRGlhbG9nc1xuICovXG4udWktdG9vbHRpcCwgLnVpLWRpYWxvZyB7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgei1pbmRleDogOTk5OTtcbiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSg4LCA0OCwgNzgsIDAuOSk7XG4gIGJvcmRlcjogMXB4IHNvbGlkICMyMEE4QjE7XG4gIGNvbG9yOiAjZWVlO1xuICBmb250LXNpemU6IDEzcHg7XG4gIGxpbmUtaGVpZ2h0OiAxNXB4O1xuICBwYWRkaW5nOiAycHggNHB4O1xufVxuXG4udWktdG9vbHRpcCB7XG4gIG1heC13aWR0aDogMzAwcHg7XG59XG5cbi51aS13aWRnZXQtb3ZlcmxheSB7XG4gIGhlaWdodDogMTAwJTtcbiAgbGVmdDogMDtcbiAgcG9zaXRpb246IGZpeGVkO1xuICB0b3A6IDA7XG4gIHdpZHRoOiAxMDAlO1xuICB6LWluZGV4OiAxMDAwMDtcbiAgYmFja2dyb3VuZDogICM0NDQ7XG4gIG9wYWNpdHk6IDAuNjtcbn1cblxuLnVpLW1vZGFsIHtcbiAgei1pbmRleDogMTAwMDEgIWltcG9ydGFudDtcbn1cblxuLnVpLXRvb2x0aXAge1xuICB6LWluZGV4OiAxMDAwMiAhaW1wb3J0YW50O1xufVxuXG4udWktdG9vbHRpcCwgLnVpLWRpYWxvZyBhIHtcbiAgY29sb3I6ICNGRkNFMDA7XG59XG5cbi51aS1kaWFsb2cge1xuICBwYWRkaW5nOiAwO1xuICBib3JkZXItcmFkaXVzOiAycHg7XG59XG5cbi51aS1kaWFsb2ctbW9kYWwgLnVpLWRpYWxvZy10aXRsZWJhci1jbG9zZSB7XG4gIGRpc3BsYXk6IG5vbmU7XG59XG5cbi51aS1kaWFsb2ctdGl0bGViYXIge1xuICBmb250LXNpemU6IDEzcHg7XG4gIGxpbmUtaGVpZ2h0OiAxNXB4O1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIHBhZGRpbmc6IDRweDtcbiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSg4LCA2MCwgNzgsIDAuOSk7XG4gIG1pbi13aWR0aDogMjUwcHg7XG59XG5cbi51aS1kaWFsb2ctdGl0bGUge1xuICBwYWRkaW5nOiAycHg7XG4gIGZvbnQtd2VpZ2h0OiBib2xkO1xufVxuXG4udWktZGlhbG9nLXRpdGxlLWFjdGl2ZSB7XG4gIGNvbG9yOiAjZmZjZTAwO1xufVxuXG4udWktZGlhbG9nLXRpdGxlLWluYWN0aXZlIHtcbiAgY29sb3I6ICNmZmZmZmY7XG59XG5cbi51aS1kaWFsb2ctdGl0bGViYXItYnV0dG9uIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBkaXNwbGF5OiB0YWJsZS1jZWxsO1xuICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIHdpZHRoOiAxN3B4O1xuICBoZWlnaHQ6IDE3cHg7XG4gIHRvcDogM3B4O1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIGJvcmRlcjogMXB4IHNvbGlkIHJnYigzMiwgMTY4LCAxNzcpO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDApO1xuICBwYWRkaW5nOiAwO1xufVxuXG4udWktZGlhbG9nLXRpdGxlYmFyLWJ1dHRvbjphY3RpdmUge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMzIsIDE2OCwgMTc3KTtcbn1cblxuLnVpLWRpYWxvZy10aXRsZWJhci1idXR0b24tY2xvc2Uge1xuICByaWdodDogNHB4O1xufVxuXG4udWktZGlhbG9nLXRpdGxlYmFyLWJ1dHRvbi1jb2xsYXBzZSB7XG4gIHJpZ2h0OiAyNXB4O1xufVxuXG4udWktZGlhbG9nLXRpdGxlYmFyLWJ1dHRvbi1jb2xsYXBzZS1leHBhbmRlZCB7XG4gIC8qIEZvciBmdXR1cmUgY2hhbmdlcyAqL1xufVxuXG4udWktZGlhbG9nLXRpdGxlYmFyLWJ1dHRvbi1jb2xsYXBzZS1jb2xsYXBzZWQge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMzIsIDE2OCwgMTc3KTtcbn1cblxuLnVpLWRpYWxvZy10aXRsZWJhci1idXR0b24tY29sbGFwc2U6OmFmdGVyLFxuLnVpLWRpYWxvZy10aXRsZWJhci1idXR0b24tY2xvc2U6OmFmdGVyLFxuLnVpLWRpYWxvZy10aXRsZWJhci1idXR0b24tY2xvc2U6OmJlZm9yZSB7XG4gIGNvbnRlbnQ6ICIiO1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHRvcDogM3B4O1xuICBsZWZ0OiA1MCU7XG4gIHdpZHRoOiAxMXB4O1xuICBtYXJnaW4tbGVmdDogLTZweDtcbiAgaGVpZ2h0OiAwO1xuICBib3JkZXItdG9wOiAycHggc29saWQgcmdiKDMyLCAxNjgsIDE3Nyk7XG59XG4udWktZGlhbG9nLXRpdGxlYmFyLWJ1dHRvbi1jbG9zZTo6YWZ0ZXIge1xuICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMy41cHgpIHJvdGF0ZSg0NWRlZyk7XG59XG4udWktZGlhbG9nLXRpdGxlYmFyLWJ1dHRvbi1jbG9zZTo6YmVmb3JlIHtcbiAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDMuNXB4KSByb3RhdGUoLTQ1ZGVnKTtcbn1cbi51aS1kaWFsb2ctdGl0bGViYXItYnV0dG9uLnVpLXN0YXRlLWFjdGl2ZTo6YWZ0ZXIsXG4udWktZGlhbG9nLXRpdGxlYmFyLWJ1dHRvbi51aS1zdGF0ZS1hY3RpdmU6OmJlZm9yZSxcbi51aS1kaWFsb2ctdGl0bGViYXItYnV0dG9uLnVpLWRpYWxvZy10aXRsZWJhci1idXR0b24tY29sbGFwc2UtY29sbGFwc2VkOjphZnRlcixcbi51aS1kaWFsb2ctdGl0bGViYXItYnV0dG9uLnVpLWRpYWxvZy10aXRsZWJhci1idXR0b24tY29sbGFwc2UtY29sbGFwc2VkOjpiZWZvcmUsXG4udWktZGlhbG9nLXRpdGxlYmFyLWJ1dHRvbjphY3RpdmU6OmFmdGVyLFxuLnVpLWRpYWxvZy10aXRsZWJhci1idXR0b246YWN0aXZlOjpiZWZvcmUge1xuICBib3JkZXItdG9wLWNvbG9yOiByZ2JhKDgsIDYwLCA3OCwgMC45KTtcbn1cblxuLnVpLWRpYWxvZy1jb250ZW50IHtcbiAgcGFkZGluZzogMTJweDtcbiAgb3ZlcmZsb3cteTogYXV0bztcbiAgb3ZlcmZsb3cteDogaGlkZGVuO1xuICBtYXgtaGVpZ2h0OiA2MDBweCAhaW1wb3J0YW50O1xuICBtYXgtd2lkdGg6IDcwMHB4ICFpbXBvcnRhbnQ7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbn1cblxuLnVpLWRpYWxvZy1jb250ZW50LWhpZGRlbiB7XG4gIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDtcbn1cblxuLnVpLWRpYWxvZy1idXR0b25wYW5lIHtcbiAgcGFkZGluZzogNnB4O1xuICBib3JkZXItdG9wOiAxcHggc29saWQgIzIwQThCMTtcbn1cblxuLnVpLWRpYWxvZy1idXR0b25zZXQge1xuICB0ZXh0LWFsaWduOiByaWdodDtcbn1cblxuLnVpLWRpYWxvZy1idXR0b25zZXQgYnV0dG9uLFxuLnVpLWRpYWxvZy1jb250ZW50IGJ1dHRvbiB7XG4gIHBhZGRpbmc6IDJweDtcbiAgbWluLXdpZHRoOiA0MHB4O1xuICBjb2xvcjogI0ZGQ0UwMDtcbiAgYm9yZGVyOiAxcHggc29saWQgI0ZGQ0UwMDtcbiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSg4LCA0OCwgNzgsIDAuOSk7XG59XG5cbi51aS1kaWFsb2ctYnV0dG9uc2V0IGJ1dHRvbjpob3ZlciB7XG4gIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lO1xufVxuXG4udWktZGlhbG9nLWFib3V0SUlUQyB7XG4gIHdpZHRoOiBhdXRvICFpbXBvcnRhbnQ7XG4gIG1pbi13aWR0aDogNDAwcHggIWltcG9ydGFudDtcbiAgbWF4LXdpZHRoOiA2MDBweCAhaW1wb3J0YW50O1xufVxuXG50ZCB7XG4gIHBhZGRpbmc6IDA7XG4gIHZlcnRpY2FsLWFsaWduOiB0b3A7XG59XG5cbnRkICsgdGQge1xuICBwYWRkaW5nLWxlZnQ6IDRweDtcbn1cblxuI3FyY29kZSA+IGNhbnZhcyB7XG4gIGJvcmRlcjogOHB4IHNvbGlkIHdoaXRlO1xufVxuXG4vKiByZWRlZW0gcmVzdWx0cyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi5yZWRlZW1SZXdhcmQge1xuICBmb250LWZhbWlseTogSW5jb25zb2xhdGEsIENvbnNvbGFzLCBNZW5sbywgIkNvdXJpZXIgTmV3IiwgbW9ub3NwYWNlO1xuICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7XG4gIHBhZGRpbmc6IDA7XG4gIGZvbnQtc2l6ZTogMTRweDtcbn1cbi5yZWRlZW1SZXdhcmQgLml0ZW1sZXZlbCB7XG4gIGZvbnQtd2VpZ2h0OiBib2xkO1xuICB0ZXh0LXNoYWRvdzogMCAwIDFweCAjMDAwOyAvKiBMOCBpcyBoYXJkIHRvIHJlYWQgb24gYmx1ZSBiYWNrZ3JvdW5kICovXG59XG4vKlxuLnJlZGVlbS1yZXN1bHQtdGFibGUge1xuICBmb250LXNpemU6IDE0cHg7XG4gIHRhYmxlLWxheW91dDogZml4ZWQ7XG59XG5cbi5yZWRlZW0tcmVzdWx0IHRyID4gdGQ6Zmlyc3QtY2hpbGQge1xuICB3aWR0aDogNTBweDtcbiAgdGV4dC1hbGlnbjogcmlnaHQ7XG59XG5cbi5yZWRlZW0tcmVzdWx0LWh0bWwge1xuICBmb250LWZhbWlseTogSW5jb25zb2xhdGEsIENvbnNvbGFzLCBNZW5sbywgIkNvdXJpZXIgTmV3IiwgbW9ub3NwYWNlO1xufVxuKi9cblxuLnBsX251ZGdlX2RhdGUge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjNzI0NTEwO1xuICBib3JkZXItbGVmdDogMXB4IHNvbGlkICNmZmQ2NTI7XG4gIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZmZkNjUyO1xuICBib3JkZXItdG9wOiAxcHggc29saWQgI2ZmZDY1MjtcbiAgY29sb3I6ICNmZmQ2NTI7XG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgZmxvYXQ6IGxlZnQ7XG4gIGhlaWdodDogMThweDtcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xufVxuXG4ucGxfbnVkZ2VfcG9pbnR5X3NwYWNlciB7XG4gIGJhY2tncm91bmQ6IG5vLXJlcGVhdCB1cmwoLy9jb21tb25kYXRhc3RvcmFnZS5nb29nbGVhcGlzLmNvbS9pbmdyZXNzLmNvbS9pbWcvbnVkZ2VfcG9pbnR5LnBuZyk7XG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgZmxvYXQ6IGxlZnQ7XG4gIGhlaWdodDogMjBweDtcbiAgbGVmdDogNDdweDtcbiAgd2lkdGg6IDVweDtcbn1cblxuLnBsX251ZGdlX3BsYXllciB7XG4gIGN1cnNvcjogcG9pbnRlcjtcbn1cblxuLnBsX251ZGdlX21lIHtcbiAgY29sb3I6ICNmZmQ2NTI7XG59XG5cbi5SRVNJU1RBTkNFIHtcbiAgY29sb3I6ICMwMGMyZmY7XG59XG5cbi5BTElFTlMsIC5FTkxJR0hURU5FRCB7XG4gIGNvbG9yOiAjMjhmNDI4O1xufVxuXG4jcG9ydGFsX2hpZ2hsaWdodF9zZWxlY3Qge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHRvcDo1cHg7XG4gIGxlZnQ6MTBweDtcbiAgei1pbmRleDogMjUwMDtcbiAgZm9udC1zaXplOjExcHg7XG4gIGJhY2tncm91bmQtY29sb3I6IzBFM0M0NjtcbiAgY29sb3I6I2ZmY2UwMDtcbiAgXG59XG5cblxuXG4ucG9ydGFsX2RldGFpbHMgdGgsIC5wb3J0YWxfZGV0YWlscyB0ZCB7XG4gIHZlcnRpY2FsLWFsaWduOiB0b3A7XG4gIHRleHQtYWxpZ246IGxlZnQ7XG59XG5cbi5wb3J0YWxfZGV0YWlscyB0aCB7XG4gIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gIHBhZGRpbmctcmlnaHQ6IDFlbTtcbn1cblxuLnBvcnRhbF9kZXRhaWxzIHRyLnBhZGRpbmctdG9wIHRoLCAucG9ydGFsX2RldGFpbHMgdHIucGFkZGluZy10b3AgdGQge1xuICBwYWRkaW5nLXRvcDogMC43ZW07XG59XG5cbiNwbGF5X2J1dHRvbiB7XG4gIGRpc3BsYXk6IG5vbmU7XG59XG5cblxuLyoqIGFydGlmYWN0IGRpYWxvZyAqKioqKioqKioqKioqKioqKi9cbnRhYmxlLmFydGlmYWN0IHRyID4gKiB7XG4gIGJhY2tncm91bmQ6IHJnYmEoOCwgNDgsIDc4LCAwLjkpO1xufVxuXG50YWJsZS5hcnRpZmFjdCB0ZC5pbmZvIHtcbiAgbWluLXdpZHRoOiAxMTBweDsgLyogbWluLXdpZHRoIGZvciBpbmZvIGNvbHVtbiwgdG8gZW5zdXJlIHJlYWxseSBsb25nIHBvcnRhbCBuYW1lcyBkb25cJ3QgY3Jvd2QgdGhpbmdzIG91dCAqL1xufVxuXG50YWJsZS5hcnRpZmFjdCAucG9ydGFsIHtcbiAgbWluLXdpZHRoOiAyMDBweDsgLyogbWluLXdpZHRoIGZvciBwb3J0YWwgbmFtZXMsIHRvIGVuc3VyZSByZWFsbHkgbG9uZyBsaXN0cyBvZiBhcnRpZmFjdHMgZG9uXCd0IGNyb3dkIG5hbWVzIG91dCAqL1xufVxuXG5cbi8qIGxlYWZsZXQgcG9wdXBzIC0gcmVzdHlsZSB0byBtYXRjaCB0aGUgdGhlbWUgb2YgSUlUQyAqL1xuI21hcCAubGVhZmxldC1wb3B1cCB7XG4gIHBvaW50ZXItZXZlbnRzOiBub25lO1xufVxuXG4jbWFwIC5sZWFmbGV0LXBvcHVwLWNvbnRlbnQtd3JhcHBlciB7XG4gIGJvcmRlci1yYWRpdXM6IDBweDtcbiAgLXdlYmtpdC1ib3JkZXItcmFkaXVzOiAwcHg7XG4gIGJvcmRlcjogMXB4IHNvbGlkICMyMEE4QjE7XG4gIGJhY2tncm91bmQ6ICMwZTNkNGU7XG4gIHBvaW50ZXItZXZlbnRzOiBhdXRvO1xufVxuXG4jbWFwIC5sZWFmbGV0LXBvcHVwLWNvbnRlbnQge1xuICBjb2xvcjogI2ZmY2UwMDtcbiAgbWFyZ2luOiA1cHggOHB4O1xufVxuXG4jbWFwIC5sZWFmbGV0LXBvcHVwLWNsb3NlLWJ1dHRvbiB7XG4gIHBhZGRpbmc6IDJweCAxcHggMCAwO1xuICBmb250LXNpemU6IDEycHg7XG4gIGxpbmUtaGVpZ2h0OiA4cHg7XG4gIHdpZHRoOiAxMHB4O1xuICBoZWlnaHQ6IDEwcHg7XG4gIHBvaW50ZXItZXZlbnRzOiBhdXRvO1xufVxuXG5cbiNtYXAgLmxlYWZsZXQtcG9wdXAtdGlwIHtcbiAgLyogY2hhbmdlIHRoZSB0aXAgZnJvbSBhbiBhcnJvdyB0byBhIHNpbXBsZSBsaW5lICovXG4gIGJhY2tncm91bmQ6ICMyMEE4QjE7XG4gIHdpZHRoOiAxcHg7XG4gIGhlaWdodDogMjBweDtcbiAgcGFkZGluZzogMDtcbiAgbWFyZ2luOiAwIDAgMCAyMHB4O1xuICAtd2Via2l0LXRyYW5zZm9ybTogbm9uZTtcbiAgLW1vei10cmFuc2Zvcm06IG5vbmU7XG4gIC1tcy10cmFuc2Zvcm06IG5vbmU7XG4gIC1vLXRyYW5zZm9ybTogbm9uZTtcbiAgdHJhbnNmb3JtOiBub25lO1xufVxuXG5cbi8qIG1pc2MgKi9cblxuLm5vLXBvaW50ZXItZXZlbnRzIHtcbiAgcG9pbnRlci1ldmVudHM6IG5vbmU7XG59XG5cblxuLmxheWVyX29mZl93YXJuaW5nIHtcbiAgY29sb3I6ICNGRkNFMDA7XG4gIG1hcmdpbjogOHB4O1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG59XG5cbi8qIHJlZ2lvbiBzY29yZXMgKi9cbi5jZWxsc2NvcmUgLnVpLWFjY29yZGlvbi1oZWFkZXIsIC5jZWxsc2NvcmUgLnVpLWFjY29yZGlvbi1jb250ZW50IHtcbglib3JkZXI6IDFweCBzb2xpZCAjMjBhOGIxO1xuCW1hcmdpbi10b3A6IC0xcHg7XG4JZGlzcGxheTogYmxvY2s7XG59XG4uY2VsbHNjb3JlIC51aS1hY2NvcmRpb24taGVhZGVyIHtcbgljb2xvcjogI2ZmY2UwMDtcbglvdXRsaW5lOiBub25lXG59XG4uY2VsbHNjb3JlIC51aS1hY2NvcmRpb24taGVhZGVyOmJlZm9yZSB7XG4JZm9udC1zaXplOiAxOHB4O1xuCW1hcmdpbi1yaWdodDogMnB4O1xuCWNvbnRlbnQ6ICLiip4iO1xufVxuLmNlbGxzY29yZSAudWktYWNjb3JkaW9uLWhlYWRlci1hY3RpdmU6YmVmb3JlIHtcbgljb250ZW50OiAi4oqfIjtcbn1cbmcuY2hlY2twb2ludDpob3ZlciBjaXJjbGUge1xuICBmaWxsLW9wYWNpdHk6IDE7XG4gIHN0cm9rZS13aWR0aDogMnB4O1xufVxuLmNoZWNrcG9pbnRfdGFibGUge1xuCWJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7XG59XG4uY2hlY2twb2ludF90YWJsZSB0ZCB7XG4JdGV4dC1hbGlnbjogcmlnaHQ7XG4JcGFkZGluZy1sZWZ0OiAxMHB4O1xufVxuXG4udGV4dC1vdmVyZmxvdy1lbGxpcHNpcyB7XG4JZGlzcGxheTogaW5saW5lLWJsb2NrO1xuCW92ZXJmbG93OiBoaWRkZW47XG4Jd2hpdGUtc3BhY2U6IG5vd3JhcDtcbgl0ZXh0LW92ZXJmbG93OiBlbGxpcHNpcztcbgl2ZXJ0aWNhbC1hbGlnbjogdGV4dC1ib3R0b207XG4Jd2lkdGg6IDEwMCU7XG59XG5cbi8qIHRhYnMgKi9cbi51aS10YWJzLW5hdiB7XG4JZGlzcGxheTogYmxvY2s7XG4JYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICMyMGE4YjE7XG4JYm9yZGVyLXRvcDogMXB4IHNvbGlkIHRyYW5zcGFyZW50O1xuCW1hcmdpbjogM3B4IDAgMDtcbglwYWRkaW5nOiAwO1xufVxuLnVpLXRhYnMtbmF2OjphZnRlciB7XG4JY29udGVudDogXCdcJztcbgljbGVhcjogbGVmdDtcbglkaXNwbGF5OiBibG9jaztcbgloZWlnaHQ6IDA7XG4Jd2lkdGg6IDA7XG59XG4udWktdGFicy1uYXYgbGkge1xuCWxpc3Qtc3R5bGU6IG5vbmU7XG4JZGlzcGxheTogYmxvY2s7XG4JZmxvYXQ6bGVmdDtcbgltYXJnaW46IDAgMCAtMXB4O1xuCWJvcmRlcjogMXB4IHNvbGlkICMyMGE4YjE7XG59XG4udWktdGFicy1uYXYgbGkudWktdGFicy1hY3RpdmUge1xuCWJvcmRlci1ib3R0b20tY29sb3I6ICMwRjJDM0Y7XG4JYmFja2dyb3VuZDogIzBGMkMzRjtcbglib3JkZXItd2lkdGg6IDJweCAycHggMXB4O1xuCWZvbnQtd2VpZ2h0OiBib2xkO1xuCW1hcmdpbjogLTFweCAxcHg7XG59XG4udWktdGFicy1uYXYgYSB7XG4JZGlzcGxheTogaW5saW5lLWJsb2NrO1xuCXBhZGRpbmc6IDAuMmVtIDAuN2VtO1xufVxuLnVpLXRhYnMtbmF2IC51aS1pY29uIHtcbglkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4JZm9udC1zaXplOiAwO1xuCWhlaWdodDogMjJweDtcbglvdmVyZmxvdzogaGlkZGVuO1xuCXBvc2l0aW9uOiByZWxhdGl2ZTtcbgl2ZXJ0aWNhbC1hbGlnbjogdG9wO1xuCXdpZHRoOiAxNnB4O1xufVxuLnVpLXRhYnMtbmF2IC51aS1pY29uLWNsb3NlOjpiZWZvcmUge1xuCWNvbnRlbnQ6ICLDlyI7XG4JZm9udC1zaXplOiAxNnB4O1xuCWhlaWdodDogMTZweDtcbglwb3NpdGlvbjogYWJzb2x1dGU7XG4JdGV4dC1hbGlnbjogY2VudGVyO1xuCXRvcDogMnB4O1xuCXZlcnRpY2FsLWFsaWduOiBiYXNlbGluZTtcbgl3aWR0aDogMTZweDtcbgljdXJzb3I6IHBvaW50ZXI7XG59XG5cbjwvc3R5bGU+JwogICsgJzxzdHlsZT4vKiByZXF1aXJlZCBzdHlsZXMgKi9cblxuLmxlYWZsZXQtbWFwLXBhbmUsXG4ubGVhZmxldC10aWxlLFxuLmxlYWZsZXQtbWFya2VyLWljb24sXG4ubGVhZmxldC1tYXJrZXItc2hhZG93LFxuLmxlYWZsZXQtdGlsZS1wYW5lLFxuLmxlYWZsZXQtdGlsZS1jb250YWluZXIsXG4ubGVhZmxldC1vdmVybGF5LXBhbmUsXG4ubGVhZmxldC1zaGFkb3ctcGFuZSxcbi5sZWFmbGV0LW1hcmtlci1wYW5lLFxuLmxlYWZsZXQtcG9wdXAtcGFuZSxcbi5sZWFmbGV0LW92ZXJsYXktcGFuZSBzdmcsXG4ubGVhZmxldC16b29tLWJveCxcbi5sZWFmbGV0LWltYWdlLWxheWVyLFxuLmxlYWZsZXQtbGF5ZXIge1xuCXBvc2l0aW9uOiBhYnNvbHV0ZTtcbglsZWZ0OiAwO1xuCXRvcDogMDtcbgl9XG4ubGVhZmxldC1jb250YWluZXIge1xuCW92ZXJmbG93OiBoaWRkZW47XG4JLW1zLXRvdWNoLWFjdGlvbjogbm9uZTtcbgl9XG4ubGVhZmxldC10aWxlLFxuLmxlYWZsZXQtbWFya2VyLWljb24sXG4ubGVhZmxldC1tYXJrZXItc2hhZG93IHtcbgktd2Via2l0LXVzZXItc2VsZWN0OiBub25lO1xuCSAgIC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7XG4JICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTtcbgktd2Via2l0LXVzZXItZHJhZzogbm9uZTtcbgl9XG4ubGVhZmxldC1tYXJrZXItaWNvbixcbi5sZWFmbGV0LW1hcmtlci1zaGFkb3cge1xuCWRpc3BsYXk6IGJsb2NrO1xuCX1cbi8qIG1hcCBpcyBicm9rZW4gaW4gRkYgaWYgeW91IGhhdmUgbWF4LXdpZHRoOiAxMDAlIG9uIHRpbGVzICovXG4ubGVhZmxldC1jb250YWluZXIgaW1nIHtcbgltYXgtd2lkdGg6IG5vbmUgIWltcG9ydGFudDtcbgl9XG4vKiBzdHVwaWQgQW5kcm9pZCAyIGRvZXNuXCd0IHVuZGVyc3RhbmQgIm1heC13aWR0aDogbm9uZSIgcHJvcGVybHkgKi9cbi5sZWFmbGV0LWNvbnRhaW5lciBpbWcubGVhZmxldC1pbWFnZS1sYXllciB7XG4JbWF4LXdpZHRoOiAxNTAwMHB4ICFpbXBvcnRhbnQ7XG4JfVxuLmxlYWZsZXQtdGlsZSB7XG4JZmlsdGVyOiBpbmhlcml0O1xuCXZpc2liaWxpdHk6IGhpZGRlbjtcbgl9XG4ubGVhZmxldC10aWxlLWxvYWRlZCB7XG4JdmlzaWJpbGl0eTogaW5oZXJpdDtcbgl9XG4ubGVhZmxldC16b29tLWJveCB7XG4Jd2lkdGg6IDA7XG4JaGVpZ2h0OiAwO1xuCX1cbi8qIHdvcmthcm91bmQgZm9yIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTg4ODMxOSAqL1xuLmxlYWZsZXQtb3ZlcmxheS1wYW5lIHN2ZyB7XG4JLW1vei11c2VyLXNlbGVjdDogbm9uZTtcbgl9XG5cbi5sZWFmbGV0LXRpbGUtcGFuZSAgICB7IHotaW5kZXg6IDI7IH1cbi5sZWFmbGV0LW9iamVjdHMtcGFuZSB7IHotaW5kZXg6IDM7IH1cbi5sZWFmbGV0LW92ZXJsYXktcGFuZSB7IHotaW5kZXg6IDQ7IH1cbi5sZWFmbGV0LXNoYWRvdy1wYW5lICB7IHotaW5kZXg6IDU7IH1cbi5sZWFmbGV0LW1hcmtlci1wYW5lICB7IHotaW5kZXg6IDY7IH1cbi5sZWFmbGV0LXBvcHVwLXBhbmUgICB7IHotaW5kZXg6IDc7IH1cblxuLmxlYWZsZXQtdm1sLXNoYXBlIHtcbgl3aWR0aDogMXB4O1xuCWhlaWdodDogMXB4O1xuCX1cbi5sdm1sIHtcbgliZWhhdmlvcjogdXJsKCNkZWZhdWx0I1ZNTCk7XG4JZGlzcGxheTogaW5saW5lLWJsb2NrO1xuCXBvc2l0aW9uOiBhYnNvbHV0ZTtcbgl9XG5cblxuLyogY29udHJvbCBwb3NpdGlvbmluZyAqL1xuXG4ubGVhZmxldC1jb250cm9sIHtcbglwb3NpdGlvbjogcmVsYXRpdmU7XG4Jei1pbmRleDogNztcbglwb2ludGVyLWV2ZW50czogYXV0bztcbgl9XG4ubGVhZmxldC10b3AsXG4ubGVhZmxldC1ib3R0b20ge1xuCXBvc2l0aW9uOiBhYnNvbHV0ZTtcbgl6LWluZGV4OiAxMDAwO1xuCXBvaW50ZXItZXZlbnRzOiBub25lO1xuCX1cbi5sZWFmbGV0LXRvcCB7XG4JdG9wOiAwO1xuCX1cbi5sZWFmbGV0LXJpZ2h0IHtcbglyaWdodDogMDtcbgl9XG4ubGVhZmxldC1ib3R0b20ge1xuCWJvdHRvbTogMDtcbgl9XG4ubGVhZmxldC1sZWZ0IHtcbglsZWZ0OiAwO1xuCX1cbi5sZWFmbGV0LWNvbnRyb2wge1xuCWZsb2F0OiBsZWZ0O1xuCWNsZWFyOiBib3RoO1xuCX1cbi5sZWFmbGV0LXJpZ2h0IC5sZWFmbGV0LWNvbnRyb2wge1xuCWZsb2F0OiByaWdodDtcbgl9XG4ubGVhZmxldC10b3AgLmxlYWZsZXQtY29udHJvbCB7XG4JbWFyZ2luLXRvcDogMTBweDtcbgl9XG4ubGVhZmxldC1ib3R0b20gLmxlYWZsZXQtY29udHJvbCB7XG4JbWFyZ2luLWJvdHRvbTogMTBweDtcbgl9XG4ubGVhZmxldC1sZWZ0IC5sZWFmbGV0LWNvbnRyb2wge1xuCW1hcmdpbi1sZWZ0OiAxMHB4O1xuCX1cbi5sZWFmbGV0LXJpZ2h0IC5sZWFmbGV0LWNvbnRyb2wge1xuCW1hcmdpbi1yaWdodDogMTBweDtcbgl9XG5cblxuLyogem9vbSBhbmQgZmFkZSBhbmltYXRpb25zICovXG5cbi5sZWFmbGV0LWZhZGUtYW5pbSAubGVhZmxldC10aWxlLFxuLmxlYWZsZXQtZmFkZS1hbmltIC5sZWFmbGV0LXBvcHVwIHtcbglvcGFjaXR5OiAwO1xuCS13ZWJraXQtdHJhbnNpdGlvbjogb3BhY2l0eSAwLjJzIGxpbmVhcjtcbgkgICAtbW96LXRyYW5zaXRpb246IG9wYWNpdHkgMC4ycyBsaW5lYXI7XG4JICAgICAtby10cmFuc2l0aW9uOiBvcGFjaXR5IDAuMnMgbGluZWFyO1xuCSAgICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjJzIGxpbmVhcjtcbgl9XG4ubGVhZmxldC1mYWRlLWFuaW0gLmxlYWZsZXQtdGlsZS1sb2FkZWQsXG4ubGVhZmxldC1mYWRlLWFuaW0gLmxlYWZsZXQtbWFwLXBhbmUgLmxlYWZsZXQtcG9wdXAge1xuCW9wYWNpdHk6IDE7XG4JfVxuXG4ubGVhZmxldC16b29tLWFuaW0gLmxlYWZsZXQtem9vbS1hbmltYXRlZCB7XG4JLXdlYmtpdC10cmFuc2l0aW9uOiAtd2Via2l0LXRyYW5zZm9ybSAwLjI1cyBjdWJpYy1iZXppZXIoMCwwLDAuMjUsMSk7XG4JICAgLW1vei10cmFuc2l0aW9uOiAgICAtbW96LXRyYW5zZm9ybSAwLjI1cyBjdWJpYy1iZXppZXIoMCwwLDAuMjUsMSk7XG4JICAgICAtby10cmFuc2l0aW9uOiAgICAgIC1vLXRyYW5zZm9ybSAwLjI1cyBjdWJpYy1iZXppZXIoMCwwLDAuMjUsMSk7XG4JICAgICAgICB0cmFuc2l0aW9uOiAgICAgICAgIHRyYW5zZm9ybSAwLjI1cyBjdWJpYy1iZXppZXIoMCwwLDAuMjUsMSk7XG4JfVxuLmxlYWZsZXQtem9vbS1hbmltIC5sZWFmbGV0LXRpbGUsXG4ubGVhZmxldC1wYW4tYW5pbSAubGVhZmxldC10aWxlLFxuLmxlYWZsZXQtdG91Y2hpbmcgLmxlYWZsZXQtem9vbS1hbmltYXRlZCB7XG4JLXdlYmtpdC10cmFuc2l0aW9uOiBub25lO1xuCSAgIC1tb3otdHJhbnNpdGlvbjogbm9uZTtcbgkgICAgIC1vLXRyYW5zaXRpb246IG5vbmU7XG4JICAgICAgICB0cmFuc2l0aW9uOiBub25lO1xuCX1cblxuLmxlYWZsZXQtem9vbS1hbmltIC5sZWFmbGV0LXpvb20taGlkZSB7XG4JdmlzaWJpbGl0eTogaGlkZGVuO1xuCX1cblxuXG4vKiBjdXJzb3JzICovXG5cbi5sZWFmbGV0LWNsaWNrYWJsZSB7XG4JY3Vyc29yOiBwb2ludGVyO1xuCX1cbi5sZWFmbGV0LWNvbnRhaW5lciB7XG4JY3Vyc29yOiAtd2Via2l0LWdyYWI7XG4JY3Vyc29yOiAgICAtbW96LWdyYWI7XG4JfVxuLmxlYWZsZXQtcG9wdXAtcGFuZSxcbi5sZWFmbGV0LWNvbnRyb2wge1xuCWN1cnNvcjogYXV0bztcbgl9XG4ubGVhZmxldC1kcmFnZ2luZyAubGVhZmxldC1jb250YWluZXIsXG4ubGVhZmxldC1kcmFnZ2luZyAubGVhZmxldC1jbGlja2FibGUge1xuCWN1cnNvcjogbW92ZTtcbgljdXJzb3I6IC13ZWJraXQtZ3JhYmJpbmc7XG4JY3Vyc29yOiAgICAtbW96LWdyYWJiaW5nO1xuCX1cblxuXG4vKiB2aXN1YWwgdHdlYWtzICovXG5cbi5sZWFmbGV0LWNvbnRhaW5lciB7XG4JYmFja2dyb3VuZDogI2RkZDtcbglvdXRsaW5lOiAwO1xuCX1cbi5sZWFmbGV0LWNvbnRhaW5lciBhIHtcbgljb2xvcjogIzAwNzhBODtcbgl9XG4ubGVhZmxldC1jb250YWluZXIgYS5sZWFmbGV0LWFjdGl2ZSB7XG4Jb3V0bGluZTogMnB4IHNvbGlkIG9yYW5nZTtcbgl9XG4ubGVhZmxldC16b29tLWJveCB7XG4JYm9yZGVyOiAycHggZG90dGVkICMzOGY7XG4JYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwwLjUpO1xuCX1cblxuXG4vKiBnZW5lcmFsIHR5cG9ncmFwaHkgKi9cbi5sZWFmbGV0LWNvbnRhaW5lciB7XG4JZm9udDogMTJweC8xLjUgIkhlbHZldGljYSBOZXVlIiwgQXJpYWwsIEhlbHZldGljYSwgc2Fucy1zZXJpZjtcbgl9XG5cblxuLyogZ2VuZXJhbCB0b29sYmFyIHN0eWxlcyAqL1xuXG4ubGVhZmxldC1iYXIge1xuCWJveC1zaGFkb3c6IDAgMXB4IDVweCByZ2JhKDAsMCwwLDAuNjUpO1xuCWJvcmRlci1yYWRpdXM6IDRweDtcbgl9XG4ubGVhZmxldC1iYXIgYSxcbi5sZWFmbGV0LWJhciBhOmhvdmVyIHtcbgliYWNrZ3JvdW5kLWNvbG9yOiAjZmZmO1xuCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjY2NjO1xuCXdpZHRoOiAyNnB4O1xuCWhlaWdodDogMjZweDtcbglsaW5lLWhlaWdodDogMjZweDtcbglkaXNwbGF5OiBibG9jaztcbgl0ZXh0LWFsaWduOiBjZW50ZXI7XG4JdGV4dC1kZWNvcmF0aW9uOiBub25lO1xuCWNvbG9yOiBibGFjaztcbgl9XG4ubGVhZmxldC1iYXIgYSxcbi5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLXRvZ2dsZSB7XG4JYmFja2dyb3VuZC1wb3NpdGlvbjogNTAlIDUwJTtcbgliYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0O1xuCWRpc3BsYXk6IGJsb2NrO1xuCX1cbi5sZWFmbGV0LWJhciBhOmhvdmVyIHtcbgliYWNrZ3JvdW5kLWNvbG9yOiAjZjRmNGY0O1xuCX1cbi5sZWFmbGV0LWJhciBhOmZpcnN0LWNoaWxkIHtcbglib3JkZXItdG9wLWxlZnQtcmFkaXVzOiA0cHg7XG4JYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDRweDtcbgl9XG4ubGVhZmxldC1iYXIgYTpsYXN0LWNoaWxkIHtcbglib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiA0cHg7XG4JYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDRweDtcbglib3JkZXItYm90dG9tOiBub25lO1xuCX1cbi5sZWFmbGV0LWJhciBhLmxlYWZsZXQtZGlzYWJsZWQge1xuCWN1cnNvcjogZGVmYXVsdDtcbgliYWNrZ3JvdW5kLWNvbG9yOiAjZjRmNGY0O1xuCWNvbG9yOiAjYmJiO1xuCX1cblxuLmxlYWZsZXQtdG91Y2ggLmxlYWZsZXQtYmFyIGEge1xuCXdpZHRoOiAzMHB4O1xuCWhlaWdodDogMzBweDtcbglsaW5lLWhlaWdodDogMzBweDtcbgl9XG5cblxuLyogem9vbSBjb250cm9sICovXG5cbi5sZWFmbGV0LWNvbnRyb2wtem9vbS1pbixcbi5sZWFmbGV0LWNvbnRyb2wtem9vbS1vdXQge1xuCWZvbnQ6IGJvbGQgMThweCBcJ0x1Y2lkYSBDb25zb2xlXCcsIE1vbmFjbywgbW9ub3NwYWNlO1xuCXRleHQtaW5kZW50OiAxcHg7XG4JfVxuLmxlYWZsZXQtY29udHJvbC16b29tLW91dCB7XG4JZm9udC1zaXplOiAyMHB4O1xuCX1cblxuLmxlYWZsZXQtdG91Y2ggLmxlYWZsZXQtY29udHJvbC16b29tLWluIHtcbglmb250LXNpemU6IDIycHg7XG4JfVxuLmxlYWZsZXQtdG91Y2ggLmxlYWZsZXQtY29udHJvbC16b29tLW91dCB7XG4JZm9udC1zaXplOiAyNHB4O1xuCX1cblxuXG4vKiBsYXllcnMgY29udHJvbCAqL1xuXG4ubGVhZmxldC1jb250cm9sLWxheWVycyB7XG4JYm94LXNoYWRvdzogMCAxcHggNXB4IHJnYmEoMCwwLDAsMC40KTtcbgliYWNrZ3JvdW5kOiAjZmZmO1xuCWJvcmRlci1yYWRpdXM6IDVweDtcbgl9XG4ubGVhZmxldC1jb250cm9sLWxheWVycy10b2dnbGUge1xuCWJhY2tncm91bmQtaW1hZ2U6IHVybChkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJvQUFBQWFDQVlBQUFDcFNrek9BQUFBQkhOQ1NWUUlDQWdJZkFoa2lBQUFBQWx3U0ZsekFBQU4xd0FBRGRjQlFpaWJlQUFBQUJsMFJWaDBVMjltZEhkaGNtVUFkM2QzTG1sdWEzTmpZWEJsTG05eVo1dnVQQm9BQUFWYlNVUkJWRWlKclpaZlNGdDNGTWUvdjN0dmJtTFVabGVOS1NIRS9MR1JpTmJHUm92VHRyQTlsY0ZrcGNPbk12YXd3aGhqcmIzc29ROGRqR0ZoWE1RTlJxRXZZM1I5a0pWdVBwUlJXUWViY2RLWXhrYUhxY0hjaEtKMnJWbzFXaE56Ly96MlVPTFVhZFZ1djlmdk9lZHpmdWVjM3g5Q0tjVisxcVZMbHdnQWRIVjE3Y3VSN0FmVTI5dGI0M2E3M3dXQVZDcjFRMGRIeDhUL0N1cnU3aTV1Ykd3ODQzSzVtczFtTXdCZ2RYVVY2WFE2SEkxR2IzWjJkajcvejZDK3ZyNlQxZFhWcDZ4V2ErbDIrdXpzN1BMazVPVFA3ZTN0djcwUzZQcjE2NDdxNnVvT3Q5dnRZUmptcGNub3VvNVVLaVZQVGs3Mm5qMTdkbXBQSUVtUytJYUdobmFQeDNPOHRMU1UzYWhSU290eXVkenJBR0F5bWY0Z2hHUTM2c3ZMeTVvc3l3T3hXS3hQRk1YOGpxQmJ0MjQxZWp5ZWQreDJlOW5XalBMNWZLMmlLQzJVVWlNQUVFTFdEQWJERU0vejQxdHRaMlptbnNteS9PUHAwNmVqbTBEWHJsMnJxSzJ0UGVOeXVRN3pQTDlwaTVxbVZheXRyWjNRZGYzZ2RpVmhHT1l2bzlINE84dXljMXNTSStsMGVuUjhmUHptdVhQbjVzanQyN2ZmOG5xOWJ3aUNZTnBTSnNQYTJscXpxcXIxQUY3ZUpFRG5PRzdNYURTR0NTSEtSbUZoWVNHWFRDWi9aZDF1OTNkT3AzTkpFQVM5SUNxSzRzbmxjbS9wdXU0RVFIYUJBQURSZGYyZ3FxbzFoSkJsbG1VWENzTGp4NCtMN3Q2OWU0WnRhbXFhZmZqdzRRZXBWT3I1b1VPSERLcXF2cWtvU2hBQXZ3ZkExc1ZybWxhdGFWcWxxcXF6dmIyOWxuQTQzS3dveW1lRVVvcWVucDdYZEYzdlcxMWRQWDdzMkRIaTlYcGZnZkhQU2lhVHVIZnZIaldielFNTXc3U2ZQMzkra1VTajBaT1UwcXNBL0V0TFN3aUh3eWdwS1VGcmF5c09IRGl3TDBBbWs4SGc0Q0JXVmxiUTNOd01pOFVDQUhGQ3lJZXN3K0g0M3VGd3VBd0dnOWxrTXNIajhTQ2Z6eU1VQ2tGUkZOaHNOdXgyWURWTlF6UWFSU2dVZ3N2bHd0R2pSMkV5dlppdGJEYkw5UGYzSDJZRGdjRDh4TVJFazY3ckNadk41aVNFa0xLeU1yamRic2l5akpHUkVWZ3NsaDEzTnpVMWhmNytmdWk2anJhMk5saXRWaEJDUUNtbG82T2pvWUdCQVNXYnpYNUJLS1c0Y3VXS2hSRHlrNjdySjRMQklGTlJVYkVlYUhaMkZwRklCRGFiRFMwdExTZ3FLaXBraXFHaElUeDU4Z1RCWUJCV3EzWGRaMjV1RHBGSWhMSXNPOGp6ZlB1RkN4ZWVrVHQzN3JRQ3VBcWdmbVZsQmZGNEhPWGw1VGh5NUFoNC9zWGdVVW9SajhjaHl6SWFHaG9BQUxGWURCNlBCMzYvSDRTOE9BSDVmQjRQSGp6QS9QdzgvSDQvU2twS0FDQUI0Q1BXNi9YZXFLeXNyT0k0cnBqbmVkanRkbVN6V1VTalVSZ01CZ2lDQUVJSXJGWXJIQTRIeHNmSHNiaTRpTmJXVnRqdDluV0lMTXNZR2hwQ2VYazVhbXBxWURRYUMzQXlQRHhjU3k1ZXZQZzJJYVRMNlhUTyszeStOa0lJQXdDS29pQ1JTRUJWVlRRMU5lM1lvMHdtZytIaFlYQWNCNS9QQjRQQlVKQm9NcGtjbEdXNWxGSjZtVkJLSVlwaU1ZRExITWVkQ2dRQ25DQUkvb0wxd3NJQ0Vva0VIQTRINnV2cjF5ZFExM1dNalkxaGFtb0tQcDhQZ2lCc2hFL2V2Mzgvb3lqS0x3QStseVRwK2FiYld4VEZPZ0RmQ0lLQVFDQVE0RGl1dE5DamREcU5wMCtmSWhBSUFBQkdSa1pRV1ZrSmw4dTFYajVOMDFaanNkanczTndjQmZDeEpFbC9GbUwvNnowU1JaRUFlSjhRSXZwOHZzV3FxcXFXZ3BiTDVSQ1B4d0VBZnI5Ly9hd0F3UFQwZERnZWp4ZnB1dDRENEZ0SmtqWUYzdkdGRlVXeEhNQ1hScVB4Y0RBWXRCWVhGMWR0WjVmTlptY2lrY2lqYkRZN0R1QlRTWkxtdDdQYjljOGdpbUliSWVRcm04MldxYXVyYTJFWXhnZ0FsRkkxSG84UFRrOVBteW1sblpJa2hWNFdaMCsvSUZFVU9RQ2RETU84VjE5Zm4yTloxaENMeGFpbWFUY0FkRXVTcE80V1kxLy9PbEVVblFDK0JrQUJmQ0pKMHFPOSt2NE5tTzl4blpvYjNXY0FBQUFBU1VWT1JLNUNZSUk9KTtcbgl3aWR0aDogMzZweDtcbgloZWlnaHQ6IDM2cHg7XG4JfVxuLmxlYWZsZXQtcmV0aW5hIC5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLXRvZ2dsZSB7XG4JYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBRFFBQUFBMENBWUFBQURGZUJ2ckFBQUFCSE5DU1ZRSUNBZ0lmQWhraUFBQUFBbHdTRmx6QUFBYnJ3QUFHNjhCWGhxUkhBQUFBQmwwUlZoMFUyOW1kSGRoY21VQWQzZDNMbWx1YTNOallYQmxMbTl5WjV2dVBCb0FBQXJQU1VSQlZHaUIzWnA3VEZ2WEhjZS85MTYvZUJoQ0RJbkp3RGpHQmh2alFIaTVTY2xhS1JMNVoxV2wvckVxL1dOcjExVEpta3BNdzkwMHBMVnJwbEoxY2FkRmFycDB6ZFptbXBacGYzU3FOclVLZlNuS2d3STJzUVBHQm1OakFzVU94Q1c4Ykd6ZmU4LytTRUFrTWZhMUE1bTA3NS8yK2YzTytaN1g1OTV6TGtVSXdmK1Q2RWRSU1dkbnA3aXpzMVA4S09xaXRucUUzbi8vL1FNYWplWVpBUEQ3L1I4ZlBYcjAwbGJXdDJXR1RwNDhxZFJvTkMvczJiTkhYVmhZeUFMQS9QeTg2UHIxNndHLzMvL2hxNisrR3RxS2VqZmRVR2RuSjZYVDZRNGJESVpXalVhVE5MbmY3NmZjYnZkbHI5ZDd2cXVyYTFNYnNLbUdUcDgrWGFkV3F3L3YzYnUzVUNRUzhhbktzaXhMWDd0MmJUNFFDSncvZnZ5NGM3UGFzQ21HVHB3NElhK3FxbnJSWkRJWlNrcEsyRXhpWjJkblJZT0RnKzdSMGRFL3YvYmFhNHNQMjVhSE5uVDI3TmtmNkhTNlF3YUQ0YUYyVExmYnpYdTkzZ3RIamh6NXo4UGt5ZHJRcVZPbkt0VnE5WS9xNnVxVXVibTVHWTNLUm9wRUlpS24weGtLQkFKL2JXOXY5MldUSTJORG5aMmRZb1BCOElMUmFHd29LeXZqc3FrMG5hYW1waGlYeXpYZ2Rycy83T3JxU21RU201R2hNMmZPSE5Cb05NL1UxZFZKS1lvU0ZFZ0lFY1Zpc1dZQWtFcWwvUlJGQ1JwTlFnamxkRHBqZnIvLzQyUEhqZ2xtbHlCREowK2VWTzdldmZzbmRYVjFGYXRNRWFKRUlxR094K01IQ0NGeUFLQW9hbEVpa1Z3U2k4VUJvVG5tNStkRlRxZHpZbng4L0M5QzJKWFMwQ3BUOUhyOWdjckt5cFRiOEhyeFBKKy9zckp5Z09mNTNjbitwMmw2WENhVFhhSnBla2xvVHAvUFIzczhua3ZwMkxXaG9YZmZmYmRlclZZZmJtaG9LRWpIbFBWdGpjVmlkU3pMTmhGQ1VqNjdVUlNWRUlsRU5xbFU2Z1FnS0QvTHN2VEF3TUJDSUJBNC84b3JyemlTNXIzZjBJa1RKK1E2bmU2SXlXUXk3Tml4US9DQ1pGbTJOQjZQUDhIei9IYWhNUUJBMC9SM0Vvbmtva2drQ2dxTm1abVpFUThPRHJxOVh1L1orOWwxajZFUFB2amdLWjFPZDZpbXBvWVNtcHpuZVZrc0Z0dkhjWnhCYUV3eU1Rempsa3FsUFRSTnJ3aU5HUjRlSmw2djk4SkxMNzMwNzlYZktFSUlUcDA2VlZsUlVmSGordnI2blprd0pSNlA2eE9KeEg1Q2lDeFRBOGxFVWRTS1dDeStLcEZJUEVKaklwR0l5T0Z3M0p5WW1EalgzdDd1bzg2ZE8zZlVhRFEybEplWEN6YkNjZHoyV0N6MkJNL3pwZGsxUGJWb21nNUtwZEtMRE1OOEp6Um1jbkpTNUhLNUJoaTlYdjlSY1hIeDdWMjdkcVVkNnJ0TU1jZmo4WU9Fa0lLSGEzYktldVFzeTlid1BDOW1HQ1pFVVZUYVRXTnNiS3pRYnJjL1JYVjBkQkFBTVlWQ2NmbnBwNStlS0M0dVRtcnNmcVk4S3FWajE2MWJ0MlNmZlBKSlJUZ2NiZ1VnWlZwYlczc0lJUWVpMFdpajAra3NtWnViVzlEcGRFc1VkV2RmNEhrK1B4cU5IbVJadGdXQTlORlpXWk9VNHpnZHk3TEZkMGNyRGdDRUVIejY2YWVsWDN6eHhmY2prVWc5Z0FtYXBnOHpWNjVjOGZYMDlQd3BIby96aEpDMjJkbloyb0dCQVJRVUZDd1ZGQlRVeE9QeFE0UVF4Zi9BeUQwaWhCU3hMRnREQ0NGZXJ6ZHkvdno1UGNGZzhDQWhSQXFnU3k2WFAvZm1tMitPM0xOdGQzUjBWRkVVOVI2QWd5S1JpTmZyOWZTK2Zmc2dGaitTODQyMFNpUVM2T25wZ2NmajRWbVdwUUY4U1FoNStaMTMzaGxkTFNOYUgvRHNzOCtHR1lZSjNMaHhnOWp0ZG5wb2FBaVRrNU5vYW1wQ2RYWDFJemV3WGlNakk3RFpiSmlmbjRkTUpxUE5aak5ScVZRQmp1UEM2OHV0amhBMU1ERHdQSURmQVNnRzd2U0d3K0hBMk5nWUFFQ2xVbUgvL3Ywb0tpcDZwRWJtNXVadzllcFYzTGh4QXdDZzFXcFJYMSsvZnRiY0F2Q0xob2FHandBUXl1RndHRG1PT3dPZ05WbkNjRGlNdnI0K3pNM05RU2FUd1dnMG9ybTVHVFM5dFVkNlBNK2p2NzhmTHBjTEt5c3JLQ29xUWt0TEN4U0tEWmZ6WllaaGpqRmFyZllmS3BXcW1hYnBwQXNsTnpjWFdxMFdNcGtNd1dBUVUxTlRDQVFDeU0vUHg3WnQyN2JFek1URUJENy8vSFA0ZkQ1UUZJV0doZ2FZeldiazV1WnVHTU54WFBIWFgzOXRZa3dtMDduaDRlR1ozTnhjei9idDI3K1hyREJGVVZBb0ZOQm9OSWhFSWdnR2cvRDVmTGg5K3phVVN1V21iUnFSU0FRWEwxNUVYMThmbHBlWG9WS3A4T1NUVDBLcFZHSVZJOG5rOC9uNnVydTd4WXVMaTNXckhEcjA3YmZmbXZ4K2YyOTVlVGt0a1VpU3dsTXNGa09sVXFHa3BBUXpNek1JQm9Qd2VyMEFBS1ZTK1ZCbUhBNEh2dnJxSzRSQ0llVGw1YUcxdFJVMU5UVXBPMnQ1ZVhuNnM4OCtHeDRmSHpjRG1LVnArakJGQ01FYmI3d2hXMXhjL0JXQVh3SmdLeXNyYlMwdExZOVRGQ1hhS0JuUDh4Z2FHb0xiN1FiSGNTZ3RMY1crZmZzeU5oWUtoZERUMDROZ01BaUdZV0F3R0ZCYlc1dHlqUkpDMkw2K3ZpcytuNjhKZDNicXQrVnkrVnV2di83NnlvWWN5c3ZMaTVuTlptbTZCaTRzTE1CbXN5RVVDa0VzRmtPdjErT3h4eDVMT3cwVGlRUysrZVliZUR3ZUpCSUpLSlZLTkRVMW9hQWc5U05pS0JSQ2IyOHZ1N3k4TEVJU0R0MWpxTHU3ZXp1QXQwT2gwSXNqSXlOVVBCNUhlWGs1bXB1YklaV21mdXFabUppQTNXN0h5c29LQ2dzTFU3THJQcWFnc2JFUkZSVVZLZlBIWWpIMDkvZGpjbklTRW9rRTFkWFZVQ3FWL3dMUTN0YldOdm1Bb2U3dTd1Y0JuTVJkRHJFc0M2L1h1NWJBWkRLaHFxb3E1ZUpNeHk0QlRIbEFoQkNNam81aWNIQVFxeDJzMCtrZ0VxMnRoaVVBdndGd3FxMnRqYVV1WExoUUErQ1BBTDZmTE9IQ3dnSmNMaGNXRnhlRnNBREFnK3lxcmEwRkFBd05EUWxseWdONTVISTVqRVpqcWlsNUhjQlBtZXJxNnIvdDJMRmpMOE13T2NsS1NhVlNsSldWUVNLUklCUUt3ZWZ6SVJxTll1Zk9uUnN1M0dUc21wNmVGc3dVbG1WaHQ5dGhzOW1RU0NSUVZWVUZvOUVJbVd6akYyT080K1JPcDFOUGRYUjBKQUFzYUxWYXQwYWplWHpEQ055Wnh4NlBCemR2M2tST1RnNzI3dDBMdFZxZEtnVFJhQlIydXgwQTBOallpSnljcFAyMnBrQWdnR3ZYcnExMW1sNnZUN3QrcDZlbisxMHVWeWtocEl6cTZPaG9BL0FlZ0VxeFdPeHNhbXJLbDh2bGxha1NoTU5oREE4UHIxVnFOcHVSbjUrZnN0SjBXbHBhUW05djcxcG4xZFRVcEoyUzBXaDAybWF6VFVhalVUTUFINENYS1VJSUxCYUxETUFxaCtpU2twSXJlL2JzYVdFWVpzTjV3Zk04L0g0L0FvRUFLSXFDd1dDQXlXUkt1V2trRXlFRWc0T0RjTHZkSUlSQXJWWkRvOUdrNVpEYjdiNHlOVFcxeGlFQWIxbXQxbnM1WkxGWXFuQm50QTVTRkRWbE5CcUR1M2J0YWs3Vm9PWGxaWGc4SG9URFllVG41Nk9scFVVd1hFT2hFUHI2K3JDMHRBU0ZRZ0c5WG8rOHZMeVVNZUZ3ZU5EaGNFZzVqcXNDOENXQWw2MVdhM0lPclRQMkhJRGZBOWlaazVQVDI5VFVWSjZUazdNclhlTkdSa1lnaEYwYk1DV2xrVVFpTVdlMzI0Y1dGaFphQWN3QStMblZhdjM3L2VVMlBBcTJXQ3lGQUxvQUhBTVFMU3Nyc3hrTWhwU1BRK25ZSllBcFNlWDMreStQalkzVkFOZ0c0QXlBVHF2Vk9wK3NiTnJiQjR2RjBudzNTUVBETUtQMTlmVXhoVUpoU2hXVGpGMEFNbUVLQUdCeGNkRm5zOW1XRW9sRUhZQUJBTWVzVm10L3FoaEIxeWtXaTRVQmNCekFid0hJQ3dvS0xqYzJOdGFLeGVJTlgxOEpJWmljbk1UWTJCaDQvczZ4R2szVDBHcTFLQzh2VDdsNWNCd1h1WDc5ZXQvczdPempBS0lBZmczZ3ROVnFUWHZCbHRHRmw4VmlLUVh3QndBL0JQQ2RWcXNkMW1nMFNkOTBWN1hLTGdBWk13WEFQd0g4ekdxMUNqN0l6K3FPMVdLeFpNeXVkRXJHRkt2VjJwMXBucXd2amJOaFZ6S2xZa28yN1hyb2EvMXMyTFdxZEV6SlJwdjJKVWttN0JMS2xHeTBxWi9HQ0dGWEprekpSbHZ5TlZZeWRra2trdHhNbVpLTnR1enpzdnZaQllBREVFRUdUTWxHVy80QjREcDJBUmt5SlJ2OUY5dnN4V0QvNDNSOUFBQUFBRWxGVGtTdVFtQ0MpO1xuCWJhY2tncm91bmQtc2l6ZTogMjZweCAyNnB4O1xuCX1cbi5sZWFmbGV0LXRvdWNoIC5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLXRvZ2dsZSB7XG4Jd2lkdGg6IDQ0cHg7XG4JaGVpZ2h0OiA0NHB4O1xuCX1cbi5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzIC5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLWxpc3QsXG4ubGVhZmxldC1jb250cm9sLWxheWVycy1leHBhbmRlZCAubGVhZmxldC1jb250cm9sLWxheWVycy10b2dnbGUge1xuCWRpc3BsYXk6IG5vbmU7XG4JfVxuLmxlYWZsZXQtY29udHJvbC1sYXllcnMtZXhwYW5kZWQgLmxlYWZsZXQtY29udHJvbC1sYXllcnMtbGlzdCB7XG4JZGlzcGxheTogYmxvY2s7XG4JcG9zaXRpb246IHJlbGF0aXZlO1xuCX1cbi5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLWV4cGFuZGVkIHtcbglwYWRkaW5nOiA2cHggMTBweCA2cHggNnB4O1xuCWNvbG9yOiAjMzMzO1xuCWJhY2tncm91bmQ6ICNmZmY7XG4JfVxuLmxlYWZsZXQtY29udHJvbC1sYXllcnMtc2VsZWN0b3Ige1xuCW1hcmdpbi10b3A6IDJweDtcbglwb3NpdGlvbjogcmVsYXRpdmU7XG4JdG9wOiAxcHg7XG4JfVxuLmxlYWZsZXQtY29udHJvbC1sYXllcnMgbGFiZWwge1xuCWRpc3BsYXk6IGJsb2NrO1xuCX1cbi5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLXNlcGFyYXRvciB7XG4JaGVpZ2h0OiAwO1xuCWJvcmRlci10b3A6IDFweCBzb2xpZCAjZGRkO1xuCW1hcmdpbjogNXB4IC0xMHB4IDVweCAtNnB4O1xuCX1cblxuXG4vKiBhdHRyaWJ1dGlvbiBhbmQgc2NhbGUgY29udHJvbHMgKi9cblxuLmxlYWZsZXQtY29udGFpbmVyIC5sZWFmbGV0LWNvbnRyb2wtYXR0cmlidXRpb24ge1xuCWJhY2tncm91bmQ6ICNmZmY7XG4JYmFja2dyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjcpO1xuCW1hcmdpbjogMDtcbgl9XG4ubGVhZmxldC1jb250cm9sLWF0dHJpYnV0aW9uLFxuLmxlYWZsZXQtY29udHJvbC1zY2FsZS1saW5lIHtcbglwYWRkaW5nOiAwIDVweDtcbgljb2xvcjogIzMzMztcbgl9XG4ubGVhZmxldC1jb250cm9sLWF0dHJpYnV0aW9uIGEge1xuCXRleHQtZGVjb3JhdGlvbjogbm9uZTtcbgl9XG4ubGVhZmxldC1jb250cm9sLWF0dHJpYnV0aW9uIGE6aG92ZXIge1xuCXRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lO1xuCX1cbi5sZWFmbGV0LWNvbnRhaW5lciAubGVhZmxldC1jb250cm9sLWF0dHJpYnV0aW9uLFxuLmxlYWZsZXQtY29udGFpbmVyIC5sZWFmbGV0LWNvbnRyb2wtc2NhbGUge1xuCWZvbnQtc2l6ZTogMTFweDtcbgl9XG4ubGVhZmxldC1sZWZ0IC5sZWFmbGV0LWNvbnRyb2wtc2NhbGUge1xuCW1hcmdpbi1sZWZ0OiA1cHg7XG4JfVxuLmxlYWZsZXQtYm90dG9tIC5sZWFmbGV0LWNvbnRyb2wtc2NhbGUge1xuCW1hcmdpbi1ib3R0b206IDVweDtcbgl9XG4ubGVhZmxldC1jb250cm9sLXNjYWxlLWxpbmUge1xuCWJvcmRlcjogMnB4IHNvbGlkICM3Nzc7XG4JYm9yZGVyLXRvcDogbm9uZTtcbglsaW5lLWhlaWdodDogMS4xO1xuCXBhZGRpbmc6IDJweCA1cHggMXB4O1xuCWZvbnQtc2l6ZTogMTFweDtcbgl3aGl0ZS1zcGFjZTogbm93cmFwO1xuCW92ZXJmbG93OiBoaWRkZW47XG4JLW1vei1ib3gtc2l6aW5nOiBjb250ZW50LWJveDtcbgkgICAgIGJveC1zaXppbmc6IGNvbnRlbnQtYm94O1xuXG4JYmFja2dyb3VuZDogI2ZmZjtcbgliYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNSk7XG4JfVxuLmxlYWZsZXQtY29udHJvbC1zY2FsZS1saW5lOm5vdCg6Zmlyc3QtY2hpbGQpIHtcbglib3JkZXItdG9wOiAycHggc29saWQgIzc3Nztcbglib3JkZXItYm90dG9tOiBub25lO1xuCW1hcmdpbi10b3A6IC0ycHg7XG4JfVxuLmxlYWZsZXQtY29udHJvbC1zY2FsZS1saW5lOm5vdCg6Zmlyc3QtY2hpbGQpOm5vdCg6bGFzdC1jaGlsZCkge1xuCWJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjNzc3O1xuCX1cblxuLmxlYWZsZXQtdG91Y2ggLmxlYWZsZXQtY29udHJvbC1hdHRyaWJ1dGlvbixcbi5sZWFmbGV0LXRvdWNoIC5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLFxuLmxlYWZsZXQtdG91Y2ggLmxlYWZsZXQtYmFyIHtcbglib3gtc2hhZG93OiBub25lO1xuCX1cbi5sZWFmbGV0LXRvdWNoIC5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLFxuLmxlYWZsZXQtdG91Y2ggLmxlYWZsZXQtYmFyIHtcbglib3JkZXI6IDJweCBzb2xpZCByZ2JhKDAsMCwwLDAuMik7XG4JYmFja2dyb3VuZC1jbGlwOiBwYWRkaW5nLWJveDtcbgl9XG5cblxuLyogcG9wdXAgKi9cblxuLmxlYWZsZXQtcG9wdXAge1xuCXBvc2l0aW9uOiBhYnNvbHV0ZTtcbgl0ZXh0LWFsaWduOiBjZW50ZXI7XG4JfVxuLmxlYWZsZXQtcG9wdXAtY29udGVudC13cmFwcGVyIHtcbglwYWRkaW5nOiAxcHg7XG4JdGV4dC1hbGlnbjogbGVmdDtcbglib3JkZXItcmFkaXVzOiAxMnB4O1xuCX1cbi5sZWFmbGV0LXBvcHVwLWNvbnRlbnQge1xuCW1hcmdpbjogMTNweCAxOXB4O1xuCWxpbmUtaGVpZ2h0OiAxLjQ7XG4JfVxuLmxlYWZsZXQtcG9wdXAtY29udGVudCBwIHtcbgltYXJnaW46IDE4cHggMDtcbgl9XG4ubGVhZmxldC1wb3B1cC10aXAtY29udGFpbmVyIHtcbgltYXJnaW46IDAgYXV0bztcbgl3aWR0aDogNDBweDtcbgloZWlnaHQ6IDIwcHg7XG4JcG9zaXRpb246IHJlbGF0aXZlO1xuCW92ZXJmbG93OiBoaWRkZW47XG4JfVxuLmxlYWZsZXQtcG9wdXAtdGlwIHtcbgl3aWR0aDogMTdweDtcbgloZWlnaHQ6IDE3cHg7XG4JcGFkZGluZzogMXB4O1xuXG4JbWFyZ2luOiAtMTBweCBhdXRvIDA7XG5cbgktd2Via2l0LXRyYW5zZm9ybTogcm90YXRlKDQ1ZGVnKTtcbgkgICAtbW96LXRyYW5zZm9ybTogcm90YXRlKDQ1ZGVnKTtcbgkgICAgLW1zLXRyYW5zZm9ybTogcm90YXRlKDQ1ZGVnKTtcbgkgICAgIC1vLXRyYW5zZm9ybTogcm90YXRlKDQ1ZGVnKTtcbgkgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDQ1ZGVnKTtcbgl9XG4ubGVhZmxldC1wb3B1cC1jb250ZW50LXdyYXBwZXIsXG4ubGVhZmxldC1wb3B1cC10aXAge1xuCWJhY2tncm91bmQ6IHdoaXRlO1xuXG4JYm94LXNoYWRvdzogMCAzcHggMTRweCByZ2JhKDAsMCwwLDAuNCk7XG4JfVxuLmxlYWZsZXQtY29udGFpbmVyIGEubGVhZmxldC1wb3B1cC1jbG9zZS1idXR0b24ge1xuCXBvc2l0aW9uOiBhYnNvbHV0ZTtcbgl0b3A6IDA7XG4JcmlnaHQ6IDA7XG4JcGFkZGluZzogNHB4IDRweCAwIDA7XG4JdGV4dC1hbGlnbjogY2VudGVyO1xuCXdpZHRoOiAxOHB4O1xuCWhlaWdodDogMTRweDtcbglmb250OiAxNnB4LzE0cHggVGFob21hLCBWZXJkYW5hLCBzYW5zLXNlcmlmO1xuCWNvbG9yOiAjYzNjM2MzO1xuCXRleHQtZGVjb3JhdGlvbjogbm9uZTtcbglmb250LXdlaWdodDogYm9sZDtcbgliYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDtcbgl9XG4ubGVhZmxldC1jb250YWluZXIgYS5sZWFmbGV0LXBvcHVwLWNsb3NlLWJ1dHRvbjpob3ZlciB7XG4JY29sb3I6ICM5OTk7XG4JfVxuLmxlYWZsZXQtcG9wdXAtc2Nyb2xsZWQge1xuCW92ZXJmbG93OiBhdXRvO1xuCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZGRkO1xuCWJvcmRlci10b3A6IDFweCBzb2xpZCAjZGRkO1xuCX1cblxuLmxlYWZsZXQtb2xkaWUgLmxlYWZsZXQtcG9wdXAtY29udGVudC13cmFwcGVyIHtcbgl6b29tOiAxO1xuCX1cbi5sZWFmbGV0LW9sZGllIC5sZWFmbGV0LXBvcHVwLXRpcCB7XG4Jd2lkdGg6IDI0cHg7XG4JbWFyZ2luOiAwIGF1dG87XG5cbgktbXMtZmlsdGVyOiAicHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0Lk1hdHJpeChNMTE9MC43MDcxMDY3OCwgTTEyPTAuNzA3MTA2NzgsIE0yMT0tMC43MDcxMDY3OCwgTTIyPTAuNzA3MTA2NzgpIjtcbglmaWx0ZXI6IHByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5NYXRyaXgoTTExPTAuNzA3MTA2NzgsIE0xMj0wLjcwNzEwNjc4LCBNMjE9LTAuNzA3MTA2NzgsIE0yMj0wLjcwNzEwNjc4KTtcbgl9XG4ubGVhZmxldC1vbGRpZSAubGVhZmxldC1wb3B1cC10aXAtY29udGFpbmVyIHtcbgltYXJnaW4tdG9wOiAtMXB4O1xuCX1cblxuLmxlYWZsZXQtb2xkaWUgLmxlYWZsZXQtY29udHJvbC16b29tLFxuLmxlYWZsZXQtb2xkaWUgLmxlYWZsZXQtY29udHJvbC1sYXllcnMsXG4ubGVhZmxldC1vbGRpZSAubGVhZmxldC1wb3B1cC1jb250ZW50LXdyYXBwZXIsXG4ubGVhZmxldC1vbGRpZSAubGVhZmxldC1wb3B1cC10aXAge1xuCWJvcmRlcjogMXB4IHNvbGlkICM5OTk7XG4JfVxuXG5cbi8qIGRpdiBpY29uICovXG5cbi5sZWFmbGV0LWRpdi1pY29uIHtcbgliYWNrZ3JvdW5kOiAjZmZmO1xuCWJvcmRlcjogMXB4IHNvbGlkICM2NjY7XG4JfVxuPC9zdHlsZT4nCi8vbm90ZTogc21hcnRwaG9uZS5jc3MgaW5qZWN0aW9uIG1vdmVkIGludG8gY29kZS9zbWFydHBob25lLmpzCiAgKyAnPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgaHJlZj0iLy9mb250cy5nb29nbGVhcGlzLmNvbS9jc3M/ZmFtaWx5PVJvYm90bzoxMDAsMTAwaXRhbGljLDMwMCwzMDBpdGFsaWMsNDAwLDQwMGl0YWxpYyw1MDAsNTAwaXRhbGljLDcwMCw3MDBpdGFsaWMmc3Vic2V0PWxhdGluLGN5cmlsbGljLWV4dCxncmVlay1leHQsZ3JlZWssdmlldG5hbWVzZSxsYXRpbi1leHQsY3lyaWxsaWMiLz4nOwoKCmRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF0uaW5uZXJIVE1MID0gJycKICArICc8ZGl2IGlkPSJtYXAiPkxvYWRpbmcsIHBsZWFzZSB3YWl0PC9kaXY+JwogICsgJzxkaXYgaWQ9ImNoYXRjb250cm9scyIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+JwogICsgJzxhIGFjY2Vzc2tleT0iMCIgdGl0bGU9IlswXSI+PHNwYW4gY2xhc3M9InRvZ2dsZSBleHBhbmQiPjwvc3Bhbj48L2E+JwogICsgJzxhIGFjY2Vzc2tleT0iMSIgdGl0bGU9IlsxXSI+YWxsPC9hPicKICArICc8YSBhY2Nlc3NrZXk9IjIiIHRpdGxlPSJbMl0iIGNsYXNzPSJhY3RpdmUiPmZhY3Rpb248L2E+JwogICsgJzxhIGFjY2Vzc2tleT0iMyIgdGl0bGU9IlszXSI+YWxlcnRzPC9hPicKICArICc8L2Rpdj4nCiAgKyAnPGRpdiBpZD0iY2hhdCIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+JwogICsgJyAgPGRpdiBpZD0iY2hhdGZhY3Rpb24iPjwvZGl2PicKICArICcgIDxkaXYgaWQ9ImNoYXRhbGwiPjwvZGl2PicKICArICcgIDxkaXYgaWQ9ImNoYXRhbGVydHMiPjwvZGl2PicKICArICc8L2Rpdj4nCiAgKyAnPGZvcm0gaWQ9ImNoYXRpbnB1dCIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+PHRhYmxlPjx0cj4nCiAgKyAnICA8dGQ+PHRpbWU+PC90aW1lPjwvdGQ+JwogICsgJyAgPHRkPjxtYXJrPnRlbGwgZmFjdGlvbjo8L21hcms+PC90ZD4nCiAgKyAnICA8dGQ+PGlucHV0IGlkPSJjaGF0dGV4dCIgdHlwZT0idGV4dCIgbWF4bGVuZ3RoPSIyNTYiIGFjY2Vzc2tleT0iYyIgdGl0bGU9IltjXSIgLz48L3RkPicKICArICc8L3RyPjwvdGFibGU+PC9mb3JtPicKICArICc8YSBpZD0ic2lkZWJhcnRvZ2dsZSIgYWNjZXNza2V5PSJpIiB0aXRsZT0iVG9nZ2xlIHNpZGViYXIgW2ldIj48c3BhbiBjbGFzcz0idG9nZ2xlIGNsb3NlIj48L3NwYW4+PC9hPicKICArICc8ZGl2IGlkPSJzY3JvbGx3cmFwcGVyIj4nIC8vIGVuYWJsZSBzY3JvbGxpbmcgZm9yIHNtYWxsIHNjcmVlbnMKICArICcgIDxkaXYgaWQ9InNpZGViYXIiIHN0eWxlPSJkaXNwbGF5OiBub25lIj4nCiAgKyAnICAgIDxkaXYgaWQ9InBsYXllcnN0YXQiPnQ8L2Rpdj4nCiAgKyAnICAgIDxkaXYgaWQ9ImdhbWVzdGF0Ij4mbmJzcDtsb2FkaW5nIGdsb2JhbCBjb250cm9sIHN0YXRzPC9kaXY+JwogICsgJyAgICA8ZGl2IGlkPSJzZWFyY2h3cmFwcGVyIj4nCiAgKyAnICAgICAgPGltZyBzcmM9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQlFBQUFBVUNBWUFBQUNOaVIwTkFBQUFHWFJGV0hSVGIyWjBkMkZ5WlFCQlpHOWlaU0JKYldGblpWSmxZV1I1Y2NsbFBBQUFBeVJwVkZoMFdFMU1PbU52YlM1aFpHOWlaUzU0YlhBQUFBQUFBRHcvZUhCaFkydGxkQ0JpWldkcGJqMGk3N3UvSWlCcFpEMGlWelZOTUUxd1EyVm9hVWg2Y21WVGVrNVVZM3ByWXpsa0lqOCtJRHg0T25odGNHMWxkR0VnZUcxc2JuTTZlRDBpWVdSdlltVTZibk02YldWMFlTOGlJSGc2ZUcxd2RHczlJa0ZrYjJKbElGaE5VQ0JEYjNKbElEVXVNQzFqTURZeElEWTBMakUwTURrME9Td2dNakF4TUM4eE1pOHdOeTB4TURvMU56b3dNU0FnSUNBZ0lDQWdJajRnUEhKa1pqcFNSRVlnZUcxc2JuTTZjbVJtUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMekF5THpJeUxYSmtaaTF6ZVc1MFlYZ3Ribk1qSWo0Z1BISmtaanBFWlhOamNtbHdkR2x2YmlCeVpHWTZZV0p2ZFhROUlpSWdlRzFzYm5NNmVHMXdQU0pvZEhSd09pOHZibk11WVdSdlltVXVZMjl0TDNoaGNDOHhMakF2SWlCNGJXeHVjenA0YlhCTlRUMGlhSFIwY0RvdkwyNXpMbUZrYjJKbExtTnZiUzk0WVhBdk1TNHdMMjF0THlJZ2VHMXNibk02YzNSU1pXWTlJbWgwZEhBNkx5OXVjeTVoWkc5aVpTNWpiMjB2ZUdGd0x6RXVNQzl6Vkhsd1pTOVNaWE52ZFhKalpWSmxaaU1pSUhodGNEcERjbVZoZEc5eVZHOXZiRDBpUVdSdlltVWdVR2h2ZEc5emFHOXdJRU5UTlM0eElFMWhZMmx1ZEc5emFDSWdlRzF3VFUwNlNXNXpkR0Z1WTJWSlJEMGllRzF3TG1scFpEb3hOak0xT1RSRk5VRTBSVEl4TVVVeE9ETkJNVVpCUTBaRlFrSkROa1JCUWlJZ2VHMXdUVTA2Ukc5amRXMWxiblJKUkQwaWVHMXdMbVJwWkRveE5qTTFPVFJGTmtFMFJUSXhNVVV4T0ROQk1VWkJRMFpGUWtKRE5rUkJRaUkrSUR4NGJYQk5UVHBFWlhKcGRtVmtSbkp2YlNCemRGSmxaanBwYm5OMFlXNWpaVWxFUFNKNGJYQXVhV2xrT2pFMk16VTVORVV6UVRSRk1qRXhSVEU0TTBFeFJrRkRSa1ZDUWtNMlJFRkNJaUJ6ZEZKbFpqcGtiMk4xYldWdWRFbEVQU0o0YlhBdVpHbGtPakUyTXpVNU5FVTBRVFJGTWpFeFJURTRNMEV4UmtGRFJrVkNRa00yUkVGQ0lpOCtJRHd2Y21SbU9rUmxjMk55YVhCMGFXOXVQaUE4TDNKa1pqcFNSRVkrSUR3dmVEcDRiWEJ0WlhSaFBpQThQM2h3WVdOclpYUWdaVzVrUFNKeUlqOCtreHZ0RWdBQUFXVkpSRUZVZU5xc1ZjdFJ3ekFVbERUY2NRbHhCM1JBMGtIU1FYTHhOWEVGZ1Fyc0hPMUw2QUE2Y0tnQWQ0QkxFQlhBVTJZZnN6WTJvTUNiMlJsYmVscXYzcysycWlvellqUEJWakFYM0F6MldzRkpjQkIwV1piMU50MElXU0Y0RmV4R3lBeldkdkFwNnJwT3BnakR4Z3VjZzNsQktWaVJ6ejNXUE42RGI4T2tqc2dhVXZRZ1NBVzU0SWtJNzdDV3drY1ZOMFBDUFpGdEFHK216WlBmbVZSVWhsQVpLMG1aSVI2cWJHUGk3Q2hZNHpsMXlLWitOVGZ4bHROdHRnNmxvZXA4TEp1VWphZDR6aDNGN3MxY2JzOGF5eEREOXhFSCswdWlMMmVkK1dkandoV1UyWWp6Vm1Kb1VmQ2ZoQzJlYi84ZzdGcjczS0hSRFdvcGlXVkMyMmtkbmh5bWhyWmZjWUc2Z29RY0FtR0hobGVWNjRsc2psVUQrNWNTejg1UnRiZlVTc2NmcnArUW44N0ljMkt1eUdsQkV5ZDhkWWtPNElKZklua2M3MEMyUU1mMENEMUk5NWh6Q2MxR3RjZkJlN2htL2wxaGU1cDNKWVZoK0Fzb2FWNzI3RU9BQVFBV2dGM2xlZEx1UUFBQUFBQkpSVTVFcmtKZ2dnPT0iLyB0aXRsZT0iQ3VycmVudCBMb2NhdGlvbiIgaWQ9ImJ1dHRvbmdlb2xvY2F0aW9uIj4nCiAgKyAnICAgICAgPGlucHV0IGlkPSJzZWFyY2giIHBsYWNlaG9sZGVyPSJTZWFyY2ggbG9jYXRpb27igKYiIHR5cGU9InNlYXJjaCIgYWNjZXNza2V5PSJmIiB0aXRsZT0iU2VhcmNoIGZvciBhIHBsYWNlIFtmXSIvPicKICArICcgICAgPC9kaXY+JwogICsgJyAgICA8ZGl2IGlkPSJwb3J0YWxkZXRhaWxzIj48L2Rpdj4nCiAgKyAnICAgIDxpbnB1dCBpZD0icmVkZWVtIiBwbGFjZWhvbGRlcj0iUmVkZWVtIGNvZGXigKYiIHR5cGU9InRleHQiLz4nCiAgKyAnICAgIDxkaXYgaWQ9InRvb2xib3giPicKICArICcgICAgICA8YSBvbm1vdXNlb3Zlcj0ic2V0UGVybWFMaW5rKHRoaXMpIiBvbmNsaWNrPSJzZXRQZXJtYUxpbmsodGhpcyk7cmV0dXJuIGFuZHJvaWRQZXJtYWxpbmsoKSIgdGl0bGU9IlVSTCBsaW5rIHRvIHRoaXMgbWFwIHZpZXciPlBlcm1hbGluazwvYT4nCiAgKyAnICAgICAgPGEgb25jbGljaz0id2luZG93LmFib3V0SUlUQygpIiBzdHlsZT0iY3Vyc29yOiBoZWxwIj5BYm91dCBJSVRDPC9hPicKICArICcgICAgICA8YSBvbmNsaWNrPSJ3aW5kb3cucmVnaW9uU2NvcmVib2FyZCgpIiB0aXRsZT0iVmlldyByZWdpb25hbCBzY29yZWJvYXJkIj5SZWdpb24gc2NvcmVzPC9hPicKICArICcgICAgPC9kaXY+JwogICsgJyAgPC9kaXY+JwogICsgJzwvZGl2PicKICArICc8ZGl2IGlkPSJ1cGRhdGVzdGF0dXMiPjxkaXYgaWQ9ImlubmVyc3RhdHVzIj48L2Rpdj48L2Rpdj4nCiAgLy8gYXZvaWQgZXJyb3IgYnkgc3RvY2sgSlMKICArICc8ZGl2IGlkPSJwbGF5X2J1dHRvbiI+PC9kaXY+JzsKCi8vIHB1dHRpbmcgZXZlcnl0aGluZyBpbiBhIHdyYXBwZXIgZnVuY3Rpb24gdGhhdCBpbiB0dXJuIGlzIHBsYWNlZCBpbiBhCi8vIHNjcmlwdCB0YWcgb24gdGhlIHdlYnNpdGUgYWxsb3dzIHVzIHRvIGV4ZWN1dGUgaW4gdGhlIHNpdGXigJlzIGNvbnRleHQKLy8gaW5zdGVhZCBvZiBpbiB0aGUgR3JlYXNlbW9ua2V5L0V4dGVuc2lvbi9ldGMuIGNvbnRleHQuCmZ1bmN0aW9uIHdyYXBwZXIoaW5mbykgewovLyBhIGN1dC1kb3duIHZlcnNpb24gb2YgR01faW5mbyBpcyBwYXNzZWQgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHNjcmlwdAovLyAobm90IHRoZSBmdWxsIEdNX2luZm8gLSBpdCBjb250YWlucyB0aGUgRU5USVJFIHNjcmlwdCBzb3VyY2UhKQp3aW5kb3cuc2NyaXB0X2luZm8gPSBpbmZvOwoKCgoKLy8gTEVBRkxFVCBQUkVGRVIgQ0FOVkFTIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIFNldCB0byB0cnVlIGlmIExlYWZsZXQgc2hvdWxkIGRyYXcgdGhpbmdzIHVzaW5nIENhbnZhcyBpbnN0ZWFkIG9mIFNWRwovLyBEaXNhYmxlZCBmb3Igbm93IGJlY2F1c2UgaXQgaGFzIHNldmVyYWwgYnVnczogZmxpY2tlcmluZywgY29uc3RhbnQKLy8gQ1BVIHVzYWdlIGFuZCBpdCBjb250aW51b3VzbHkgZmlyZXMgdGhlIG1vdmVlbmQgZXZlbnQuCgovL0xfUFJFRkVSX0NBTlZBUyA9IGZhbHNlOwoKLy8gQ09ORklHIE9QVElPTlMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwp3aW5kb3cuUkVGUkVTSCA9IDMwOyAvLyByZWZyZXNoIHZpZXcgZXZlcnkgMzBzIChiYXNlIHRpbWUpCndpbmRvdy5aT09NX0xFVkVMX0FESiA9IDU7IC8vIGFkZCA1IHNlY29uZHMgcGVyIHpvb20gbGV2ZWwKd2luZG93Lk9OX01PVkVfUkVGUkVTSCA9IDIuNTsgIC8vcmVmcmVzaCB0aW1lIHRvIHVzZSBhZnRlciBhIG1vdmVtZW50IGV2ZW50CndpbmRvdy5NSU5JTVVNX09WRVJSSURFX1JFRlJFU0ggPSAxMDsgLy9saW1pdCBvbiByZWZyZXNoIHRpbWUgc2luY2UgcHJldmlvdXMgcmVmcmVzaCwgbGltaXRpbmcgcmVwZWF0ZWQgbW92ZSByZWZyZXNoIHJhdGUKd2luZG93LlJFRlJFU0hfR0FNRV9TQ09SRSA9IDE1KjYwOyAvLyByZWZyZXNoIGdhbWUgc2NvcmUgZXZlcnkgMTUgbWludXRlcwp3aW5kb3cuTUFYX0lETEVfVElNRSA9IDE1KjYwOyAvLyBzdG9wIHVwZGF0aW5nIG1hcCBhZnRlciAxNW1pbiBpZGxpbmcKd2luZG93LkhJRERFTl9TQ1JPTExCQVJfQVNTVU1FRF9XSURUSCA9IDIwOwp3aW5kb3cuU0lERUJBUl9XSURUSCA9IDMwMDsKCi8vIGhvdyBtYW55IHBpeGVscyB0byB0aGUgdG9wIGJlZm9yZSByZXF1ZXN0aW5nIG5ldyBkYXRhCndpbmRvdy5DSEFUX1JFUVVFU1RfU0NST0xMX1RPUCA9IDIwMDsKd2luZG93LkNIQVRfU0hSSU5LRUQgPSA2MDsKCi8vIE1pbmltdW0gYXJlYSB0byB6b29tIHJhdGlvIHRoYXQgZmllbGQgTVUncyB3aWxsIGRpc3BsYXkKd2luZG93LkZJRUxEX01VX0RJU1BMQVlfQVJFQV9aT09NX1JBVElPID0gMC4wMDE7CgovLyBQb2ludCB0b2xlcmFuY2UgZm9yIGRpc3BsYXlpbmcgTVUncwp3aW5kb3cuRklFTERfTVVfRElTUExBWV9QT0lOVF9UT0xFUkFOQ0UgPSA2MAoKd2luZG93LkNPTE9SX1NFTEVDVEVEX1BPUlRBTCA9ICcjZjBmJzsKd2luZG93LkNPTE9SUyA9IFsnI0ZGNjYwMCcsICcjMDA4OEZGJywgJyMwM0RDMDMnXTsgLy8gbm9uZSwgcmVzLCBlbmwKd2luZG93LkNPTE9SU19MVkwgPSBbJyMwMDAnLCAnI0ZFQ0U1QScsICcjRkZBNjMwJywgJyNGRjczMTUnLCAnI0U0MDAwMCcsICcjRkQyOTkyJywgJyNFQjI2Q0QnLCAnI0MxMjRFMCcsICcjOTYyN0Y0J107CndpbmRvdy5DT0xPUlNfTU9EID0ge1ZFUllfUkFSRTogJyNiMDhjZmYnLCBSQVJFOiAnIzczYThmZicsIENPTU1PTjogJyM4Y2ZmYmYnfTsKCgp3aW5kb3cuTU9EX1RZUEUgPSB7UkVTX1NISUVMRDonU2hpZWxkJywgTVVMVElIQUNLOidNdWx0aS1oYWNrJywgRk9SQ0VfQU1QOidGb3JjZSBBbXAnLCBIRUFUU0lOSzonSGVhdCBTaW5rJywgVFVSUkVUOidUdXJyZXQnLCBMSU5LX0FNUExJRklFUjogJ0xpbmsgQW1wJ307CgovLyBjaXJjbGVzIGFyb3VuZCBhIHNlbGVjdGVkIHBvcnRhbCB0aGF0IHNob3cgZnJvbSB3aGVyZSB5b3UgY2FuIGhhY2sKLy8gaXQgYW5kIGhvdyBmYXIgdGhlIHBvcnRhbCByZWFjaGVzIChpLmUuIGhvdyBmYXIgbGlua3MgbWF5IGJlIG1hZGUKLy8gZnJvbSB0aGlzIHBvcnRhbCkKd2luZG93LkFDQ0VTU19JTkRJQ0FUT1JfQ09MT1IgPSAnb3JhbmdlJzsKd2luZG93LlJBTkdFX0lORElDQVRPUl9DT0xPUiA9ICdyZWQnCgovLyBtaW4gem9vbSBmb3IgaW50ZWwgbWFwIC0gc2hvdWxkIG1hdGNoIHRoYXQgdXNlZCBieSBzdG9jayBpbnRlbAp3aW5kb3cuTUlOX1pPT00gPSAzOwoKd2luZG93LkRFRkFVTFRfUE9SVEFMX0lNRyA9ICcvL2NvbW1vbmRhdGFzdG9yYWdlLmdvb2dsZWFwaXMuY29tL2luZ3Jlc3MuY29tL2ltZy9kZWZhdWx0LXBvcnRhbC1pbWFnZS5wbmcnOwovL3dpbmRvdy5OT01JTkFUSU0gPSAnLy9vcGVuLm1hcHF1ZXN0YXBpLmNvbS9ub21pbmF0aW0vdjEvc2VhcmNoLnBocD9mb3JtYXQ9anNvbiZwb2x5Z29uX2dlb2pzb249MSZxPSc7CndpbmRvdy5OT01JTkFUSU0gPSAnLy9ub21pbmF0aW0ub3BlbnN0cmVldG1hcC5vcmcvc2VhcmNoP2Zvcm1hdD1qc29uJnBvbHlnb25fZ2VvanNvbj0xJnE9JzsKCi8vIElOR1JFU1MgQ09OU1RBTlRTIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gaHR0cDovL2RlY29kZWluZ3Jlc3MubWUvMjAxMi8xMS8xOC9pbmdyZXNzLXBvcnRhbC1sZXZlbHMtYW5kLWxpbmstcmFuZ2UvCndpbmRvdy5SRVNPX05SRyA9IFswLCAxMDAwLCAxNTAwLCAyMDAwLCAyNTAwLCAzMDAwLCA0MDAwLCA1MDAwLCA2MDAwXTsKd2luZG93LkhBQ0tfUkFOR0UgPSA0MDsgLy8gaW4gbWV0ZXJzLCBtYXguIGRpc3RhbmNlIGZyb20gcG9ydGFsIHRvIGJlIGFibGUgdG8gYWNjZXNzIGl0CndpbmRvdy5PQ1RBTlRTID0gWydFJywgJ05FJywgJ04nLCAnTlcnLCAnVycsICdTVycsICdTJywgJ1NFJ107CndpbmRvdy5PQ1RBTlRTX0FSUk9XID0gWyfihpInLCAn4oaXJywgJ+KGkScsICfihpYnLCAn4oaQJywgJ+KGmScsICfihpMnLCAn4oaYJ107CndpbmRvdy5ERVNUUk9ZX1JFU09OQVRPUiA9IDc1OyAvL0FQIGZvciBkZXN0cm95aW5nIHBvcnRhbAp3aW5kb3cuREVTVFJPWV9MSU5LID0gMTg3OyAvL0FQIGZvciBkZXN0cm95aW5nIGxpbmsKd2luZG93LkRFU1RST1lfRklFTEQgPSA3NTA7IC8vQVAgZm9yIGRlc3Ryb3lpbmcgZmllbGQKd2luZG93LkNBUFRVUkVfUE9SVEFMID0gNTAwOyAvL0FQIGZvciBjYXB0dXJpbmcgYSBwb3J0YWwKd2luZG93LkRFUExPWV9SRVNPTkFUT1IgPSAxMjU7IC8vQVAgZm9yIGRlcGxveWluZyBhIHJlc29uYXRvcgp3aW5kb3cuQ09NUExFVElPTl9CT05VUyA9IDI1MDsgLy9BUCBmb3IgZGVwbG95aW5nIGFsbCByZXNvbmF0b3JzIG9uIHBvcnRhbAp3aW5kb3cuVVBHUkFERV9BTk9USEVSU19SRVNPTkFUT1IgPSA2NTsgLy9BUCBmb3IgdXBncmFkaW5nIGFub3RoZXIncyByZXNvbmF0b3IKd2luZG93Lk1BWF9QT1JUQUxfTEVWRUwgPSA4Owp3aW5kb3cuTUFYX1JFU09fUEVSX1BMQVlFUiA9IFswLCA4LCA0LCA0LCA0LCAyLCAyLCAxLCAxXTsKCi8vIE9USEVSIE1PUkUtT1ItTEVTUyBDT05TVEFOVFMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8Kd2luZG93LlRFQU1fTk9ORSA9IDA7CndpbmRvdy5URUFNX1JFUyA9IDE7CndpbmRvdy5URUFNX0VOTCA9IDI7CndpbmRvdy5URUFNX1RPX0NTUyA9IFsnbm9uZScsICdyZXMnLCAnZW5sJ107Cgp3aW5kb3cuU0xPVF9UT19MQVQgPSBbMCwgTWF0aC5zcXJ0KDIpLzIsIDEsIE1hdGguc3FydCgyKS8yLCAwLCAtTWF0aC5zcXJ0KDIpLzIsIC0xLCAtTWF0aC5zcXJ0KDIpLzJdOwp3aW5kb3cuU0xPVF9UT19MTkcgPSBbMSwgTWF0aC5zcXJ0KDIpLzIsIDAsIC1NYXRoLnNxcnQoMikvMiwgLTEsIC1NYXRoLnNxcnQoMikvMiwgMCwgTWF0aC5zcXJ0KDIpLzJdOwp3aW5kb3cuRUFSVEhfUkFESVVTPTYzNzgxMzc7CndpbmRvdy5ERUcyUkFEID0gTWF0aC5QSSAvIDE4MDsKCi8vIFNUT1JBR0UgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gZ2xvYmFsIHZhcmlhYmxlcyB1c2VkIGZvciBzdG9yYWdlLiBNb3N0IGxpa2VseSBSRUFEIE9OTFkuIFByb3BlcgovLyB3YXkgd291bGQgYmUgdG8gZW5jYXBzdWxhdGUgdGhlbSBpbiBhbiBhbm9ueW1vdXMgZnVuY3Rpb24gYW5kIHdyaXRlCi8vIGdldHRlcnMvc2V0dGVycywgYnV0IGlmIHlvdSBhcmUgY2FyZWZ1bCBlbm91Z2gsIHRoaXMgd29ya3MuCndpbmRvdy5yZWZyZXNoVGltZW91dCA9IHVuZGVmaW5lZDsKd2luZG93LnVybFBvcnRhbCA9IG51bGw7CndpbmRvdy51cmxQb3J0YWxMTCA9IG51bGw7CndpbmRvdy5zZWxlY3RlZFBvcnRhbCA9IG51bGw7CndpbmRvdy5wb3J0YWxSYW5nZUluZGljYXRvciA9IG51bGw7CndpbmRvdy5wb3J0YWxBY2Nlc3NJbmRpY2F0b3IgPSBudWxsOwp3aW5kb3cubWFwUnVuc1VzZXJBY3Rpb24gPSBmYWxzZTsKLy92YXIgcG9ydGFsc0xheWVycywgbGlua3NMYXllciwgZmllbGRzTGF5ZXI7CnZhciBwb3J0YWxzRmFjdGlvbkxheWVycywgbGlua3NGYWN0aW9uTGF5ZXJzLCBmaWVsZHNGYWN0aW9uTGF5ZXJzOwoKLy8gY29udGFpbiByZWZlcmVuY2VzIHRvIGFsbCBlbnRpdGllcyBsb2FkZWQgZnJvbSB0aGUgc2VydmVyLiBJZiByZW5kZXIgbGltaXRzIGFyZSBoaXQsCi8vIG5vdCBhbGwgbWF5IGJlIGFkZGVkIHRvIHRoZSBsZWFmbGV0IGxheWVycwp3aW5kb3cucG9ydGFscyA9IHt9Owp3aW5kb3cubGlua3MgPSB7fTsKd2luZG93LmZpZWxkcyA9IHt9OwoKd2luZG93LnJlc29uYXRvcnMgPSB7fTsKCi8vIGNvbnRhaW4gY3VycmVudCBzdGF0dXMob24vb2ZmKSBvZiBvdmVybGF5IGxheWVyR3JvdXBzLgovLyBCdXQgeW91IHNob3VsZCB1c2UgaXNMYXllckdyb3VwRGlzcGxheWVkKG5hbWUpIHRvIGNoZWNrIHRoZSBzdGF0dXMKd2luZG93Lm92ZXJsYXlTdGF0dXMgPSB7fTsKCi8vIHBsdWdpbiBmcmFtZXdvcmsuIFBsdWdpbnMgbWF5IGxvYWQgZWFybGllciB0aGFuIGlpdGMsIHNvIGRvbuKAmXQKLy8gb3ZlcndyaXRlIGRhdGEKaWYodHlwZW9mIHdpbmRvdy5wbHVnaW4gIT09ICdmdW5jdGlvbicpIHdpbmRvdy5wbHVnaW4gPSBmdW5jdGlvbigpIHt9OwoKCi8vIEFSVElGQUNUIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCi8vIGFkZGVkIGFzIHBhcnQgb2YgdGhlIGluZ3Jlc3MgIzEzbWFnbnVzIGluIG5vdmVtYmVyIDIwMTMsIGFydGlmYWN0cwovLyBhcmUgYWRkaXRpb25hbCBnYW1lIGVsZW1lbnRzIG92ZXJsYXllZCBvbiB0aGUgaW50ZWwgbWFwCi8vIGN1cnJlbnRseSB0aGVyZSBhcmUgb25seSBqYXJ2aXMtcmVsYXRlZCBlbnRpdGllcwovLyAtIHNoYXJkczogbW92ZSBiZXR3ZWVuIHBvcnRhbHMgKGFsb25nIGxpbmtzKSBlYWNoIGhvdXIuIG1vcmUgdGhhbiBvbmUgY2FuIGJlIGF0IGEgcG9ydGFsCi8vIC0gdGFyZ2V0czogc3BlY2lmaWMgcG9ydGFscyAtIG9uZSBwZXIgdGVhbQovLyB0aGUgYXJ0aWZhY3QgZGF0YSBpbmNsdWRlcyBkZXRhaWxzIGZvciB0aGUgc3BlY2lmaWMgcG9ydGFscywgc28gY2FuIGJlIHVzZWZ1bAovLyAyMDE0LTAyLTA2OiBpbnRlbCBzaXRlIHVwZGF0ZXMgaGludCBhdCBuZXcgJ2FtYXIgYXJ0aWZhY3RzJywgbGlrZWx5IGZvbGxvd2luZyB0aGUgc2FtZSBzeXN0ZW0gYXMgYWJvdmUKCgp3aW5kb3cuYXJ0aWZhY3QgPSBmdW5jdGlvbigpIHt9Cgp3aW5kb3cuYXJ0aWZhY3Quc2V0dXAgPSBmdW5jdGlvbigpIHsKICBhcnRpZmFjdC5SRUZSRVNIX0pJVFRFUiA9IDIqNjA7ICAvLyAyIG1pbnV0ZSByYW5kb20gcGVyaW9kIHNvIG5vdCBhbGwgdXNlcnMgcmVmcmVzaCBhdCBvbmNlCiAgYXJ0aWZhY3QuUkVGUkVTSF9TVUNDRVNTID0gNjAqNjA7ICAvLyA2MCBtaW51dGVzIG9uIHN1Y2Nlc3MKICBhcnRpZmFjdC5SRUZSRVNIX0ZBSUxVUkUgPSAyKjYwOyAgLy8gMiBtaW51dGUgcmV0cnkgb24gZmFpbHVyZQoKICBhcnRpZmFjdC5pZGxlID0gZmFsc2U7CiAgYXJ0aWZhY3QuY2xlYXJEYXRhKCk7CgogIGFkZFJlc3VtZUZ1bmN0aW9uKGFydGlmYWN0LmlkbGVSZXN1bWUpOwoKICAvLyBtb3ZlIHRoZSBpbml0aWFsIGRhdGEgcmVxdWVzdCBvbnRvIGEgdmVyeSBzaG9ydCB0aW1lci4gcHJldmVudHMgdGhyb3duIGV4Y2VwdGlvbnMgY2F1c2luZyBJSVRDIGJvb3QgZmFpbHVyZXMKICBzZXRUaW1lb3V0IChhcnRpZmFjdC5yZXF1ZXN0RGF0YSwgMSk7CgogIGFydGlmYWN0Ll9sYXllciA9IG5ldyBMLkxheWVyR3JvdXAoKTsKICBhZGRMYXllckdyb3VwICgnQXJ0aWZhY3RzJywgYXJ0aWZhY3QuX2xheWVyLCB0cnVlKTsKCiAgJCgnI3Rvb2xib3gnKS5hcHBlbmQoJyA8YSBvbmNsaWNrPSJ3aW5kb3cuYXJ0aWZhY3Quc2hvd0FydGlmYWN0TGlzdCgpIiB0aXRsZT0iU2hvdyBhcnRpZmFjdCBwb3J0YWwgbGlzdCI+QXJ0aWZhY3RzPC9hPicpOwoKfQoKd2luZG93LmFydGlmYWN0LnJlcXVlc3REYXRhID0gZnVuY3Rpb24oKSB7CiAgaWYgKGlzSWRsZSgpKSB7CiAgICBhcnRpZmFjdC5pZGxlID0gdHJ1ZTsKICB9IGVsc2UgewogICAgd2luZG93LnBvc3RBamF4KCdnZXRBcnRpZmFjdFBvcnRhbHMnLCB7fSwgYXJ0aWZhY3QuaGFuZGxlU3VjY2VzcywgYXJ0aWZhY3QuaGFuZGxlRXJyb3IpOwogIH0KfQoKd2luZG93LmFydGlmYWN0LmlkbGVSZXN1bWUgPSBmdW5jdGlvbigpIHsKICBpZiAoYXJ0aWZhY3QuaWRsZSkgewogICAgYXJ0aWZhY3QuaWRsZSA9IGZhbHNlOwogICAgYXJ0aWZhY3QucmVxdWVzdERhdGEoKTsKICB9Cn0KCndpbmRvdy5hcnRpZmFjdC5oYW5kbGVTdWNjZXNzID0gZnVuY3Rpb24oZGF0YSkgewogIGFydGlmYWN0LnByb2Nlc3NEYXRhIChkYXRhKTsKCiAgLy8gc3RhcnQgdGhlIG5leHQgcmVmcmVzaCBhdCBhIG11bHRpcGxlIG9mIFJFRlJFU0hfU1VDQ0VTUyBzZWNvbmRzLCBwbHVzIGEgcmFuZG9tIFJFRlJFU0hfSklUVEVSIGFtb3VudCB0byBwcmV2ZW50IGV4Y2Vzc2l2ZSBzZXJ2ZXIgaGl0cyBhdCBvbmUgdGltZQogIHZhciBub3cgPSBEYXRlLm5vdygpOwogIHZhciBuZXh0VGltZSA9IE1hdGguY2VpbChub3cvKGFydGlmYWN0LlJFRlJFU0hfU1VDQ0VTUyoxMDAwKSkqKGFydGlmYWN0LlJFRlJFU0hfU1VDQ0VTUyoxMDAwKSArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSphcnRpZmFjdC5SRUZSRVNIX0pJVFRFUioxMDAwKTsKCiAgc2V0VGltZW91dCAoYXJ0aWZhY3QucmVxdWVzdERhdGEsIG5leHRUaW1lIC0gbm93KTsKfQoKd2luZG93LmFydGlmYWN0LmhhbmRsZUZhaWx1cmUgPSBmdW5jdGlvbihkYXRhKSB7CiAgLy8gbm8gdXNlZnVsIGRhdGEgb24gZmFpbHVyZSAtIGRvIG5vdGhpbmcKCiAgc2V0VGltZW91dCAoYXJ0aWZhY3QucmVxdWVzdERhdGEsIGFydGlmYWN0LlJFRlJFU0hfRkFJTFVSRSoxMDAwKTsKfQoKCndpbmRvdy5hcnRpZmFjdC5wcm9jZXNzRGF0YSA9IGZ1bmN0aW9uKGRhdGEpIHsKCiAgaWYgKGRhdGEuZXJyb3IgfHwgIWRhdGEucmVzdWx0KSB7CiAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBmaW5kIHJlc3VsdCBpbiBnZXRBcnRpZmFjdFBvcnRhbHMgcmVzcG9uc2UnKTsKICAgIHJldHVybjsKICB9CgogIGFydGlmYWN0LmNsZWFyRGF0YSgpOwoKICBhcnRpZmFjdC5wcm9jZXNzUmVzdWx0KGRhdGEucmVzdWx0KTsKCiAgLy8gcmVkcmF3IHRoZSBhcnRpZmFjdCBsYXllcgogIGFydGlmYWN0LnVwZGF0ZUxheWVyKCk7Cgp9CgoKd2luZG93LmFydGlmYWN0LmNsZWFyRGF0YSA9IGZ1bmN0aW9uKCkgewogIGFydGlmYWN0LnBvcnRhbEluZm8gPSB7fTsKICBhcnRpZmFjdC5hcnRpZmFjdFR5cGVzID0ge307CgogIGFydGlmYWN0LmVudGl0aWVzID0gW107Cn0KCgp3aW5kb3cuYXJ0aWZhY3QucHJvY2Vzc1Jlc3VsdCA9IGZ1bmN0aW9uIChwb3J0YWxzKSB7CiAgLy8gcG9ydGFscyBpcyBhbiBvYmplY3QsIGtleWVkIGZyb20gdGhlIHBvcnRhbCBHVUlELCBjb250YWluaW5nIHRoZSBwb3J0YWwgZW50aXR5IGFycmF5CgogIGZvciAodmFyIGd1aWQgaW4gcG9ydGFscykgewogICAgdmFyIGVudCA9IHBvcnRhbHNbZ3VpZF07CiAgICB2YXIgZGF0YSA9IGRlY29kZUFycmF5LnBvcnRhbFN1bW1hcnkoZW50KTsKCiAgICAvLyB3ZSBubyBsb25nZXIga25vdyB0aGUgZmFjdGlvbiBmb3IgdGhlIHRhcmdldCBwb3J0YWxzLCBhbmQgd2UgZG9uJ3Qga25vdyB3aGljaCBmcmFnbWVudCBudW1iZXJzIGFyZSBhdCB0aGUgcG9ydGFscwogICAgLy8gYWxsIHdlIGtub3csIGZyb20gdGhlIHBvcnRhbCBzdW1tYXJ5IGRhdGEsIGZvciBlYWNoIHR5cGUgb2YgYXJ0aWZhY3QsIGlzIHRoYXQgZWFjaCBhcnRpZmFjdCBwb3J0YWwgaXMKICAgIC8vIC0gYSB0YXJnZXQgcG9ydGFsIG9yIG5vdCAtIG5vIGlkZWEgZm9yIHdoaWNoIGZhY3Rpb24KICAgIC8vIC0gaGFzIG9uZSAob3IgbW9yZSkgZnJhZ21lbnRzLCBvciBub3QKCiAgICBpZiAoIWFydGlmYWN0LnBvcnRhbEluZm9bZ3VpZF0pIGFydGlmYWN0LnBvcnRhbEluZm9bZ3VpZF0gPSB7fTsKCiAgICAvLyBzdG9yZSB0aGUgZGVjb2RlZCBkYXRhIC0gbmVlZGVkIGZvciBsYXQvbG5nIGZvciBsYXllciBtYXJrZXJzCiAgICBhcnRpZmFjdC5wb3J0YWxJbmZvW2d1aWRdLl9kYXRhID0gZGF0YTsKCiAgICBmb3IodmFyIHR5cGUgaW4gZGF0YS5hcnRpZmFjdEJyaWVmLnRhcmdldCkgewogICAgICBpZiAoIWFydGlmYWN0LmFydGlmYWN0VHlwZXNbdHlwZV0pIGFydGlmYWN0LmFydGlmYWN0VHlwZXNbdHlwZV0gPSB7fTsKCiAgICAgIGlmICghYXJ0aWZhY3QucG9ydGFsSW5mb1tndWlkXVt0eXBlXSkgYXJ0aWZhY3QucG9ydGFsSW5mb1tndWlkXVt0eXBlXSA9IHt9OwoKICAgICAgYXJ0aWZhY3QucG9ydGFsSW5mb1tndWlkXVt0eXBlXS50YXJnZXQgPSBURUFNX05PTkU7ICAvLyBhcyB3ZSBubyBsb25nZXIga25vdyB0aGUgdGVhbS4uLgogICAgfQoKICAgIGZvcih2YXIgdHlwZSBpbiBkYXRhLmFydGlmYWN0QnJpZWYuZnJhZ21lbnQpIHsKICAgICAgaWYgKCFhcnRpZmFjdC5hcnRpZmFjdFR5cGVzW3R5cGVdKSBhcnRpZmFjdC5hcnRpZmFjdFR5cGVzW3R5cGVdID0ge307CgogICAgICBpZiAoIWFydGlmYWN0LnBvcnRhbEluZm9bZ3VpZF1bdHlwZV0pIGFydGlmYWN0LnBvcnRhbEluZm9bZ3VpZF1bdHlwZV0gPSB7fTsKCiAgICAgIGFydGlmYWN0LnBvcnRhbEluZm9bZ3VpZF1bdHlwZV0uZnJhZ21lbnRzID0gdHJ1ZTsgLy9hcyB3ZSBubyBsb25nZXIgaGF2ZSBhIGxpc3Qgb2YgdGhlIGZyYWdtZW50cyB0aGVyZQogICAgfQoKCiAgICAvLyBsZXQncyBwcmUtZ2VuZXJhdGUgdGhlIGVudGl0aWVzIG5lZWRlZCB0byByZW5kZXIgdGhlIG1hcCAtIGFycmF5IG9mIFtndWlkLCB0aW1lc3RhbXAsIGVudF9hcnJheV0KICAgIGFydGlmYWN0LmVudGl0aWVzLnB1c2ggKCBbZ3VpZCwgZGF0YS50aW1lc3RhbXAsIGVudF0gKTsKCiAgfQoKfQoKd2luZG93LmFydGlmYWN0LmdldEFydGlmYWN0VHlwZXMgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gT2JqZWN0LmtleXMoYXJ0aWZhY3QuYXJ0aWZhY3RUeXBlcyk7Cn0KCndpbmRvdy5hcnRpZmFjdC5pc0FydGlmYWN0ID0gZnVuY3Rpb24odHlwZSkgewogIHJldHVybiB0eXBlIGluIGFydGlmYWN0LmFydGlmYWN0VHlwZXM7Cn0KCi8vIHVzZWQgdG8gcmVuZGVyIHBvcnRhbHMgdGhhdCB3b3VsZCBvdGhlcndpc2UgYmUgYmVsb3cgdGhlIHZpc2libGUgbGV2ZWwKd2luZG93LmFydGlmYWN0LmdldEFydGlmYWN0RW50aXRpZXMgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gYXJ0aWZhY3QuZW50aXRpZXM7Cn0KCndpbmRvdy5hcnRpZmFjdC5nZXRJbnRlcmVzdGluZ1BvcnRhbHMgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gT2JqZWN0LmtleXMoYXJ0aWZhY3QucG9ydGFsSW5mbyk7Cn0KCi8vIHF1aWNrIHRlc3QgZm9yIHBvcnRhbCBiZWluZyByZWxldmFudCB0byBhcnRpZmFjdHMgLSBvZiBhbnkgdHlwZQp3aW5kb3cuYXJ0aWZhY3QuaXNJbnRlcmVzdGluZ1BvcnRhbCA9IGZ1bmN0aW9uKGd1aWQpIHsKICByZXR1cm4gZ3VpZCBpbiBhcnRpZmFjdC5wb3J0YWxJbmZvOwp9CgovLyBnZXQgdGhlIGFydGlmYWN0IGRhdGEgZm9yIGEgc3BlY2lmaWVkIGFydGlmYWN0IGlkIChlLmcuICdqYXJ2aXMnKSwgaWYgaXQgZXhpc3RzIC0gb3RoZXJ3aXNlIHJldHVybnMgc29tZXRoaW5nICdmYWxzZSd5CndpbmRvdy5hcnRpZmFjdC5nZXRQb3J0YWxEYXRhID0gZnVuY3Rpb24oZ3VpZCxhcnRpZmFjdElkKSB7CiAgcmV0dXJuIGFydGlmYWN0LnBvcnRhbEluZm9bZ3VpZF0gJiYgYXJ0aWZhY3QucG9ydGFsSW5mb1tndWlkXVthcnRpZmFjdElkXTsKfQoKd2luZG93LmFydGlmYWN0LnVwZGF0ZUxheWVyID0gZnVuY3Rpb24oKSB7CiAgYXJ0aWZhY3QuX2xheWVyLmNsZWFyTGF5ZXJzKCk7CgogICQuZWFjaChhcnRpZmFjdC5wb3J0YWxJbmZvLCBmdW5jdGlvbihndWlkLGRhdGEpIHsKICAgIHZhciBsYXRsbmcgPSBMLmxhdExuZyAoW2RhdGEuX2RhdGEubGF0RTYvMUU2LCBkYXRhLl9kYXRhLmxuZ0U2LzFFNl0pOwoKICAgICQuZWFjaChkYXRhLCBmdW5jdGlvbih0eXBlLGRldGFpbCkgewoKICAgICAgLy8gd2UnbGwgY29uc3RydWN0IHRoZSBVUkwgZm9ybSB0aGUgdHlwZSAtIHN0b2NrIHNlZW1zIHRvIGRvIHRoYXQgbm93CgogICAgICB2YXIgaWNvblVybDsKICAgICAgaWYgKGRhdGFbdHlwZV0udGFyZ2V0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAvLyB0YXJnZXQgcG9ydGFsCiAgICAgICAgdmFyIGljb25VcmwgPSAnLy9jb21tb25kYXRhc3RvcmFnZS5nb29nbGVhcGlzLmNvbS9pbmdyZXNzLmNvbS9pbWcvbWFwX2ljb25zL21hcmtlcl9pbWFnZXMvJyt0eXBlKydfc2hhcmRfdGFyZ2V0LnBuZycKICAgICAgICB2YXIgaWNvblNpemUgPSAxMDAvMjsKICAgICAgICB2YXIgb3BhY2l0eSA9IDEuMDsKCiAgICAgICAgdmFyIGljb24gPSBMLmljb24oewogICAgICAgICAgaWNvblVybDogaWNvblVybCwKICAgICAgICAgIGljb25TaXplOiBbaWNvblNpemUsaWNvblNpemVdLAogICAgICAgICAgaWNvbkFuY2hvcjogW2ljb25TaXplLzIsaWNvblNpemUvMl0sCiAgICAgICAgICBjbGFzc05hbWU6ICduby1wb2ludGVyLWV2ZW50cycgIC8vIHRoZSBjbGlja2FibGU6IGZhbHNlIGJlbG93IHN0aWxsIGJsb2NrcyBldmVudHMgZ29pbmcgdGhyb3VnaCB0byB0aGUgc3ZnIHVuZGVybmVhdGgKICAgICAgICB9KTsKCiAgICAgICAgdmFyIG1hcmtlciA9IEwubWFya2VyIChsYXRsbmcsIHtpY29uOiBpY29uLCBjbGlja2FibGU6IGZhbHNlLCBrZXlib2FyZDogZmFsc2UsIG9wYWNpdHk6IG9wYWNpdHkgfSk7CgogICAgICAgIGFydGlmYWN0Ll9sYXllci5hZGRMYXllcihtYXJrZXIpOwoKICAgICAgfSBlbHNlIGlmIChkYXRhW3R5cGVdLmZyYWdtZW50cykgewogICAgICAgIC8vIGZyYWdtZW50KHMpIGF0IHBvcnRhbAoKICAgICAgICB2YXIgaWNvblVybCA9ICcvL2NvbW1vbmRhdGFzdG9yYWdlLmdvb2dsZWFwaXMuY29tL2luZ3Jlc3MuY29tL2ltZy9tYXBfaWNvbnMvbWFya2VyX2ltYWdlcy8nK3R5cGUrJ19zaGFyZC5wbmcnCiAgICAgICAgdmFyIGljb25TaXplID0gNjAvMjsKICAgICAgICB2YXIgb3BhY2l0eSA9IDAuNjsKCiAgICAgICAgdmFyIGljb24gPSBMLmljb24oewogICAgICAgICAgaWNvblVybDogaWNvblVybCwKICAgICAgICAgIGljb25TaXplOiBbaWNvblNpemUsaWNvblNpemVdLAogICAgICAgICAgaWNvbkFuY2hvcjogW2ljb25TaXplLzIsaWNvblNpemUvMl0sCiAgICAgICAgICBjbGFzc05hbWU6ICduby1wb2ludGVyLWV2ZW50cycgIC8vIHRoZSBjbGlja2FibGU6IGZhbHNlIGJlbG93IHN0aWxsIGJsb2NrcyBldmVudHMgZ29pbmcgdGhyb3VnaCB0byB0aGUgc3ZnIHVuZGVybmVhdGgKICAgICAgICB9KTsKCiAgICAgICAgdmFyIG1hcmtlciA9IEwubWFya2VyIChsYXRsbmcsIHtpY29uOiBpY29uLCBjbGlja2FibGU6IGZhbHNlLCBrZXlib2FyZDogZmFsc2UsIG9wYWNpdHk6IG9wYWNpdHkgfSk7CgogICAgICAgIGFydGlmYWN0Ll9sYXllci5hZGRMYXllcihtYXJrZXIpOwoKICAgICAgfQoKICAgIH0pOyAgLy9lbmQgJC5lYWNoKGRhdGEsIGZ1bmN0aW9uKHR5cGUsZGV0YWlsKQoKICB9KTsgLy9lbmQgJC5lYWNoKGFydGlmYWN0LnBvcnRhbEluZm8sIGZ1bmN0aW9uKGd1aWQsZGF0YSkKCn0KCgp3aW5kb3cuYXJ0aWZhY3Quc2hvd0FydGlmYWN0TGlzdCA9IGZ1bmN0aW9uKCkgewogIHZhciBodG1sID0gJyc7CgogIGlmIChPYmplY3Qua2V5cyhhcnRpZmFjdC5hcnRpZmFjdFR5cGVzKS5sZW5ndGggPT0gMCkgewogICAgaHRtbCArPSAnPGk+Tm8gYXJ0aWZhY3RzIGF0IHRoaXMgdGltZTwvaT4nOwogIH0KCiAgdmFyIGZpcnN0ID0gdHJ1ZTsKICAkLmVhY2goYXJ0aWZhY3QuYXJ0aWZhY3RUeXBlcywgZnVuY3Rpb24odHlwZSx0eXBlMikgewogICAgLy8gbm8gbmljZSB3YXkgdG8gY29udmVydCB0aGUgTmlhbnRpYyBpbnRlcm5hbCBuYW1lIGludG8gdGhlIGNvcnJlY3QgZGlzcGxheSBuYW1lCiAgICAvLyAod2UgZG8gZ2V0IHRoZSBkZXNjcmlwdGlvbiBzdHJpbmcgb25jZSBhIHBvcnRhbCB3aXRoIHRoYXQgc2hhcmQgdHlwZSBpcyBzZWxlY3RlZCAtIGNvdWxkIGNhY2hlIHRoYXQgc29tZXdoZXJlPykKICAgIHZhciBuYW1lID0gdHlwZS5jYXBpdGFsaXplKCkgKyAnIHNoYXJkcyc7CgogICAgaWYgKCFmaXJzdCkgaHRtbCArPSAnPGhyPic7CiAgICBmaXJzdCA9IGZhbHNlOwogICAgaHRtbCArPSAnPGRpdj48Yj4nK25hbWUrJzwvYj48L2Rpdj4nOwoKICAgIGh0bWwgKz0gJzx0YWJsZSBjbGFzcz0iYXJ0aWZhY3QgYXJ0aWZhY3QtJyt0eXBlKyciPic7CiAgICBodG1sICs9ICc8dHI+PHRoPlBvcnRhbDwvdGg+PHRoPkRldGFpbHM8L3RoPjwvdHI+JzsKCiAgICB2YXIgdGFibGVSb3dzID0gW107CgogICAgJC5lYWNoKGFydGlmYWN0LnBvcnRhbEluZm8sIGZ1bmN0aW9uKGd1aWQsIGRhdGEpIHsKICAgICAgaWYgKHR5cGUgaW4gZGF0YSkgewogICAgICAgIC8vIHRoaXMgcG9ydGFsIGhhcyBkYXRhIGZvciB0aGlzIGFydGlmYWN0IHR5cGUgLSBhZGQgaXQgdG8gdGhlIHRhYmxlCgogICAgICAgIHZhciBvbmNsaWNrID0gJ3pvb21Ub0FuZFNob3dQb3J0YWwoXCcnK2d1aWQrJ1wnLFsnK2RhdGEuX2RhdGEubGF0RTYvMUU2KycsJytkYXRhLl9kYXRhLmxuZ0U2LzFFNisnXSknOwogICAgICAgIHZhciByb3cgPSAnPHRyPjx0ZCBjbGFzcz0icG9ydGFsIj48YSBvbmNsaWNrPSInK29uY2xpY2srJyI+Jytlc2NhcGVIdG1sU3BlY2lhbENoYXJzKGRhdGEuX2RhdGEudGl0bGUpKyc8L2E+PC90ZD4nOwoKICAgICAgICByb3cgKz0gJzx0ZCBjbGFzcz0iaW5mbyI+JzsKCiAgICAgICAgaWYgKGRhdGFbdHlwZV0udGFyZ2V0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGlmIChkYXRhW3R5cGVdLnRhcmdldCA9PSBURUFNX05PTkUpIHsKICAgICAgICAgICAgcm93ICs9ICc8c3BhbiBjbGFzcz0idGFyZ2V0Ij5UYXJnZXQgUG9ydGFsPC9zcGFuPiAnOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcm93ICs9ICc8c3BhbiBjbGFzcz0idGFyZ2V0ICcrVEVBTV9UT19DU1NbZGF0YVt0eXBlXS50YXJnZXRdKyciPicrKGRhdGFbdHlwZV0udGFyZ2V0PT1URUFNX1JFUz8nUmVzaXN0YW5jZSc6J0VubGlnaHRlbmVkJykrJyB0YXJnZXQ8L3NwYW4+ICc7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZGF0YVt0eXBlXS5mcmFnbWVudHMpIHsKICAgICAgICAgIGlmIChkYXRhW3R5cGVdLnRhcmdldCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJvdyArPSAnPGJyPic7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZnJhZ21lbnROYW1lID0gJ3NoYXJkJzsKLy8gICAgICAgICAgcm93ICs9ICc8c3BhbiBjbGFzcz0iZnJhZ21lbnRzJysoZGF0YVt0eXBlXS50YXJnZXQ/JyAnK1RFQU1fVE9fQ1NTW2RhdGFbdHlwZV0udGFyZ2V0XTonJykrJyI+JytmcmFnbWVudE5hbWUrJzogIycrZGF0YVt0eXBlXS5mcmFnbWVudHMuam9pbignLCAjJykrJzwvc3Bhbj4gJzsKICAgICAgICAgIHJvdyArPSAnPHNwYW4gY2xhc3M9ImZyYWdtZW50cycrKGRhdGFbdHlwZV0udGFyZ2V0PycgJytURUFNX1RPX0NTU1tkYXRhW3R5cGVdLnRhcmdldF06JycpKyciPicrZnJhZ21lbnROYW1lKyc6IHllczwvc3Bhbj4gJzsKICAgICAgICB9CgogICAgICAgIHJvdyArPSAnPC90ZD48L3RyPic7CgogICAgICAgIC8vIHNvcnQgYnkgdGFyZ2V0IHBvcnRhbHMgZmlyc3QsIHRoZW4gYnkgcG9ydGFsIEdVSUQKICAgICAgICB2YXIgc29ydFZhbCA9IChkYXRhW3R5cGVdLnRhcmdldCAhPT0gdW5kZWZpbmVkID8gJ0EnIDogJ1onKSArIGd1aWQ7CgogICAgICAgIHRhYmxlUm93cy5wdXNoICggW3NvcnRWYWwsIHJvd10gKTsKICAgICAgfQogICAgfSk7CgogICAgLy8gY2hlY2sgZm9yIG5vIHJvd3MsIGFuZCBhZGQgYSBub3RlIHRvIHRoZSB0YWJsZSBpbnN0ZWFkCiAgICBpZiAodGFibGVSb3dzLmxlbmd0aCA9PSAwKSB7CiAgICAgIGh0bWwgKz0gJzx0cj48dGQgY29sc3Bhbj0iMiI+PGk+Tm8gcG9ydGFscyBhdCB0aGlzIHRpbWU8L2k+PC90ZD48L3RyPic7CiAgICB9CgogICAgLy8gc29ydCB0aGUgcm93cwogICAgdGFibGVSb3dzLnNvcnQoZnVuY3Rpb24oYSxiKSB7CiAgICAgIGlmIChhWzBdID09IGJbMF0pIHJldHVybiAwOwogICAgICBlbHNlIGlmIChhWzBdIDwgYlswXSkgcmV0dXJuIC0xOwogICAgICBlbHNlIHJldHVybiAxOwogICAgfSk7CgogICAgLy8gYW5kIGFkZCB0aGVtIHRvIHRoZSB0YWJsZQogICAgaHRtbCArPSB0YWJsZVJvd3MubWFwKGZ1bmN0aW9uKGEpe3JldHVybiBhWzFdO30pLmpvaW4oJycpOwoKCiAgICBodG1sICs9ICc8L3RhYmxlPic7CiAgfSk7CgoKICBodG1sICs9ICI8aHIgLz4iCiAgICAgICAgKyAiPHA+SW4gU3VtbWVyIDIwMTUsIE5pYW50aWMgY2hhbmdlZCB0aGUgZGF0YSBmb3JtYXQgZm9yIGFydGlmYWN0IHBvcnRhbHMuIFdlIG5vIGxvbmdlciBrbm93OjwvcD4iCiAgICAgICAgKyAiPHVsPjxsaT5XaGljaCB0ZWFtIGVhY2ggdGFyZ2V0IHBvcnRhbCBpcyBmb3IgLSBvbmx5IHRoYXQgaXQgaXMgYSB0YXJnZXQ8L2xpPiIKICAgICAgICArICI8bGk+V2hpY2ggc2hhcmRzIGFyZSBhdCBlYWNoIHBvcnRhbCwganVzdCB0aGF0IGl0IGhhcyBvbmUgb3IgbW9yZSBzaGFyZHM8L2xpPjwvdWw+IgogICAgICAgICsgIjxwPllvdSBjYW4gc2VsZWN0IGEgcG9ydGFsIGFuZCB0aGUgZGV0YWlsZWQgZGF0YSBjb250YWlucyB0aGUgbGlzdCBvZiBzaGFyZCBudW1iZXJzLCBidXQgdGhlcmUncyBzdGlsbCBubyIKICAgICAgICArICIgbW9yZSBpbmZvcm1hdGlvbiBvbiB0YXJnZXRzLjwvcD4iOwoKICBkaWFsb2coewogICAgdGl0bGU6ICdBcnRpZmFjdHMnLAogICAgaHRtbDogaHRtbCwKICAgIHdpZHRoOiA0MDAsCiAgICBwb3NpdGlvbjoge215OiAncmlnaHQgY2VudGVyJywgYXQ6ICdjZW50ZXItNjAgY2VudGVyJywgb2Y6IHdpbmRvdywgY29sbGlzaW9uOiAnZml0J30KICB9KTsKCn0KCgo7CgovLy8gU0VUVVAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyB0aGVzZSBmdW5jdGlvbnMgc2V0IHVwIHNwZWNpZmljIGFyZWFzIGFmdGVyIHRoZSBib290IGZ1bmN0aW9uCi8vIGNyZWF0ZWQgYSBiYXNpYyBmcmFtZXdvcmsuIEFsbCBvZiB0aGVzZSBmdW5jdGlvbnMgc2hvdWxkIG9ubHkgZXZlcgovLyBiZSBydW4gb25jZS4KCndpbmRvdy5zZXR1cExhcmdlSW1hZ2VQcmV2aWV3ID0gZnVuY3Rpb24oKSB7CiAgJCgnI3BvcnRhbGRldGFpbHMnKS5vbignY2xpY2snLCAnLmltZ3ByZXZpZXcnLCBmdW5jdGlvbigpIHsKICAgIHZhciBpbWcgPSAkKHRoaXMpLmZpbmQoJ2ltZycpWzBdOwogICAgdmFyIGRldGFpbHMgPSAkKHRoaXMpLmZpbmQoJ2Rpdi5wb3J0YWxEZXRhaWxzJylbMF07CiAgICAvL2RpYWxvZ3MgaGF2ZSAxMnB4IHBhZGRpbmcgYXJvdW5kIHRoZSBjb250ZW50CiAgICB2YXIgZGxnV2lkdGggPSBNYXRoLm1heChpbWcubmF0dXJhbFdpZHRoKzI0LDUwMCk7CiAgICBpZiAoZGV0YWlscykgewogICAgICBkaWFsb2coewogICAgICAgIGh0bWw6ICc8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOiBjZW50ZXIiPicgKyBpbWcub3V0ZXJIVE1MICsgJzwvZGl2PicgKyBkZXRhaWxzLm91dGVySFRNTCwKICAgICAgICB0aXRsZTogJCh0aGlzKS5wYXJlbnQoKS5maW5kKCdoMy50aXRsZScpLnRleHQoKSwKICAgICAgICB3aWR0aDogZGxnV2lkdGgsCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgZGlhbG9nKHsKICAgICAgICBodG1sOiAnPGRpdiBzdHlsZT0idGV4dC1hbGlnbjogY2VudGVyIj4nICsgaW1nLm91dGVySFRNTCArICc8L2Rpdj4nLAogICAgICAgIHRpdGxlOiAkKHRoaXMpLnBhcmVudCgpLmZpbmQoJ2gzLnRpdGxlJykudGV4dCgpLAogICAgICAgIHdpZHRoOiBkbGdXaWR0aCwKICAgICAgfSk7CiAgICB9CiAgfSk7Cn0KCi8vIGFkZHMgbGlzdGVuZXJzIHRvIHRoZSBsYXllciBjaG9vc2VyIHN1Y2ggdGhhdCBhIGxvbmcgcHJlc3MgaGlkZXMKLy8gYWxsIGN1c3RvbSBsYXllcnMgZXhjZXB0IHRoZSBsb25nIHByZXNzZWQgb25lLgp3aW5kb3cuc2V0dXBMYXllckNob29zZXJTZWxlY3RPbmUgPSBmdW5jdGlvbigpIHsKICAkKCcubGVhZmxldC1jb250cm9sLWxheWVycy1vdmVybGF5cycpLm9uKCdjbGljayB0YXBob2xkJywgJ2xhYmVsJywgZnVuY3Rpb24oZSkgewogICAgaWYoIWUpIHJldHVybjsKICAgIGlmKCEoZS5tZXRhS2V5IHx8IGUuY3RybEtleSB8fCBlLnNoaWZ0S2V5IHx8IGUuYWx0S2V5IHx8IGUudHlwZSA9PT0gJ3RhcGhvbGQnKSkgcmV0dXJuOwogICAgdmFyIG0gPSB3aW5kb3cubWFwOwoKICAgIHZhciBhZGQgPSBmdW5jdGlvbihsYXllcikgewogICAgICBpZighbS5oYXNMYXllcihsYXllci5sYXllcikpIG0uYWRkTGF5ZXIobGF5ZXIubGF5ZXIpOwogICAgfTsKICAgIHZhciByZW0gPSBmdW5jdGlvbihsYXllcikgewogICAgICBpZihtLmhhc0xheWVyKGxheWVyLmxheWVyKSkgbS5yZW1vdmVMYXllcihsYXllci5sYXllcik7CiAgICB9OwoKICAgIHZhciBpc0NoZWNrZWQgPSAkKGUudGFyZ2V0KS5maW5kKCdpbnB1dCcpLmlzKCc6Y2hlY2tlZCcpOwogICAgdmFyIGNoZWNrU2l6ZSA9ICQoJy5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLW92ZXJsYXlzIGlucHV0OmNoZWNrZWQnKS5sZW5ndGg7CiAgICBpZigoaXNDaGVja2VkICYmIGNoZWNrU2l6ZSA9PT0gMSkgfHwgY2hlY2tTaXplID09PSAwKSB7CiAgICAgIC8vIGlmIG5vdGhpbmcgaXMgc2VsZWN0ZWQgb3IgdGhlIHVzZXJzIGxvbmctY2xpY2tzIHRoZSBvbmx5CiAgICAgIC8vIHNlbGVjdGVkIGVsZW1lbnQsIGFzc3VtZSBhbGwgYm94ZXMgc2hvdWxkIGJlIGNoZWNrZWQgYWdhaW4KICAgICAgJC5lYWNoKHdpbmRvdy5sYXllckNob29zZXIuX2xheWVycywgZnVuY3Rpb24oaW5kLCBsYXllcikgewogICAgICAgIGlmKCFsYXllci5vdmVybGF5KSByZXR1cm4gdHJ1ZTsKICAgICAgICBhZGQobGF5ZXIpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIHVuY2hlY2sgYWxsCiAgICAgIHZhciBrZWVwID0gJC50cmltKCQoZS50YXJnZXQpLnRleHQoKSk7CiAgICAgICQuZWFjaCh3aW5kb3cubGF5ZXJDaG9vc2VyLl9sYXllcnMsIGZ1bmN0aW9uKGluZCwgbGF5ZXIpIHsKICAgICAgICBpZihsYXllci5vdmVybGF5ICE9PSB0cnVlKSByZXR1cm4gdHJ1ZTsKICAgICAgICBpZihsYXllci5uYW1lID09PSBrZWVwKSB7IGFkZChsYXllcik7ICByZXR1cm4gdHJ1ZTsgfQogICAgICAgIHJlbShsYXllcik7CiAgICAgIH0pOwogICAgfQogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogIH0pOwp9CgovLyBTZXR1cCB0aGUgZnVuY3Rpb24gdG8gcmVjb3JkIHRoZSBvbi9vZmYgc3RhdHVzIG9mIG92ZXJsYXkgbGF5ZXJHcm91cHMKd2luZG93LnNldHVwTGF5ZXJDaG9vc2VyU3RhdHVzUmVjb3JkZXIgPSBmdW5jdGlvbigpIHsKICAvLyBSZWNvcmQgYWxyZWFkeSBhZGRlZCBsYXllckdyb3VwcwogICQuZWFjaCh3aW5kb3cubGF5ZXJDaG9vc2VyLl9sYXllcnMsIGZ1bmN0aW9uKGluZCwgY2hvb3NlckVudHJ5KSB7CiAgICBpZighY2hvb3NlckVudHJ5Lm92ZXJsYXkpIHJldHVybiB0cnVlOwogICAgdmFyIGRpc3BsYXkgPSB3aW5kb3cubWFwLmhhc0xheWVyKGNob29zZXJFbnRyeS5sYXllcik7CiAgICB3aW5kb3cudXBkYXRlRGlzcGxheWVkTGF5ZXJHcm91cChjaG9vc2VyRW50cnkubmFtZSwgZGlzcGxheSk7CiAgfSk7CgogIC8vIFJlY29yZCBsYXllckdyb3VwcyBjaGFuZ2UKICB3aW5kb3cubWFwLm9uKCdvdmVybGF5YWRkIG92ZXJsYXlyZW1vdmUnLCBmdW5jdGlvbihlKSB7CiAgICB2YXIgZGlzcGxheSA9IChlLnR5cGUgPT09ICdvdmVybGF5YWRkJyk7CiAgICB3aW5kb3cudXBkYXRlRGlzcGxheWVkTGF5ZXJHcm91cChlLm5hbWUsIGRpc3BsYXkpOwogIH0pOwp9Cgp3aW5kb3cubGF5ZXJDaG9vc2VyU2V0RGlzYWJsZWRTdGF0ZXMgPSBmdW5jdGlvbigpIHsKLy8gbGF5ZXIgc2VsZWN0b3IgLSBlbmFibGUvZGlzYWJsZSBsYXllcnMgdGhhdCBhcmVuJ3QgdmlzaWJsZSBkdWUgdG8gem9vbSBsZXZlbAogIHZhciBtaW5sdmwgPSBnZXRNaW5Qb3J0YWxMZXZlbCgpOwogIHZhciBwb3J0YWxTZWxlY3Rpb24gPSAkKCcubGVhZmxldC1jb250cm9sLWxheWVycy1vdmVybGF5cyBsYWJlbCcpOwogIC8vaXQncyBhbiBhcnJheSAtIDA9dW5jbGFpbWVkLCAxPWx2bCAxLCAyPWx2bCAyLCAuLi4sIDg9bHZsIDggLSA5IHJlbGV2YW50IGVudHJpZXMKICAvL21hcmsgYWxsIGxldmVscyBiZWxvdyAoYnV0IG5vdCBhdCkgbWlubHZsIGFzIGRpc2FibGVkCiAgcG9ydGFsU2VsZWN0aW9uLnNsaWNlKDAsIG1pbmx2bCkuYWRkQ2xhc3MoJ2Rpc2FibGVkJykuYXR0cigndGl0bGUnLCAnWm9vbSBpbiB0byBzaG93IHRob3NlLicpOwogIC8vYW5kIGFsbCBmcm9tIG1pbmx2bCB0byA4IGFzIGVuYWJsZWQKICBwb3J0YWxTZWxlY3Rpb24uc2xpY2UobWlubHZsLCA4KzEpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpLmF0dHIoJ3RpdGxlJywgJycpOwoKLy9UT0RPPyBzb21lIGdlbmVyaWMgbWVjaGFuaXNtIHdoZXJlIG90aGVyIGxheWVycyBjYW4gaGF2ZSB0aGVpciBkaXNhYmxlZCBzdGF0ZSBtYXJrZWQgb24vb2ZmPyBhIGZldwovL3BsdWdpbnMgaGF2ZSBjb2RlIHRvIGRvIGl0IGJ5IGhhbmQgYWxyZWFkeQp9CgoKd2luZG93LnNldHVwU3R5bGVzID0gZnVuY3Rpb24oKSB7CiAgJCgnaGVhZCcpLmFwcGVuZCgnPHN0eWxlPicgKwogICAgWyAnI2xhcmdlcHJldmlldy5lbmwgaW1nIHsgYm9yZGVyOjJweCBzb2xpZCAnK0NPTE9SU1tURUFNX0VOTF0rJzsgfSAnLAogICAgICAnI2xhcmdlcHJldmlldy5yZXMgaW1nIHsgYm9yZGVyOjJweCBzb2xpZCAnK0NPTE9SU1tURUFNX1JFU10rJzsgfSAnLAogICAgICAnI2xhcmdlcHJldmlldy5ub25lIGltZyB7IGJvcmRlcjoycHggc29saWQgJytDT0xPUlNbVEVBTV9OT05FXSsnOyB9ICcsCiAgICAgICcjY2hhdGNvbnRyb2xzIHsgYm90dG9tOiAnKyhDSEFUX1NIUklOS0VEKzIyKSsncHg7IH0nLAogICAgICAnI2NoYXQgeyBoZWlnaHQ6ICcrQ0hBVF9TSFJJTktFRCsncHg7IH0gJywKICAgICAgJy5sZWFmbGV0LXJpZ2h0IHsgbWFyZ2luLXJpZ2h0OiAnKyhTSURFQkFSX1dJRFRIKzEpKydweCB9ICcsCiAgICAgICcjdXBkYXRlc3RhdHVzIHsgd2lkdGg6JysoU0lERUJBUl9XSURUSCsyKSsncHg7ICB9ICcsCiAgICAgICcjc2lkZWJhciB7IHdpZHRoOicrKFNJREVCQVJfV0lEVEggKyBISURERU5fU0NST0xMQkFSX0FTU1VNRURfV0lEVEggKyAxIC8qYm9yZGVyKi8pKydweDsgIH0gJywKICAgICAgJyNzaWRlYmFydG9nZ2xlIHsgcmlnaHQ6JysoU0lERUJBUl9XSURUSCsxKSsncHg7ICB9ICcsCiAgICAgICcjc2Nyb2xsd3JhcHBlciAgeyB3aWR0aDonKyhTSURFQkFSX1dJRFRIICsgMipISURERU5fU0NST0xMQkFSX0FTU1VNRURfV0lEVEgpKydweDsgcmlnaHQ6LScrKDIqSElEREVOX1NDUk9MTEJBUl9BU1NVTUVEX1dJRFRILTIpKydweCB9ICcsCiAgICAgICcjc2lkZWJhciA+ICogeyB3aWR0aDonKyhTSURFQkFSX1dJRFRIKzEpKydweDsgIH0nXS5qb2luKCJcbiIpCiAgICArICc8L3N0eWxlPicpOwp9CgpmdW5jdGlvbiBjcmVhdGVEZWZhdWx0QmFzZU1hcExheWVycygpIHsKICB2YXIgYmFzZUxheWVycyA9IHt9OwoKICAvL09wZW5TdHJlZXRNYXAgYXR0cmlidXRpb24gLSByZXF1aXJlZCBieSBzZXZlcmFsIG9mIHRoZSBsYXllcnMKICBvc21BdHRyaWJ1dGlvbiA9ICdNYXAgZGF0YSDCqSBPcGVuU3RyZWV0TWFwIGNvbnRyaWJ1dG9ycyc7CgogIC8vTWFwUXVlc3Qgb2ZmZXIgdGlsZXMgLSBodHRwOi8vZGV2ZWxvcGVyLm1hcHF1ZXN0LmNvbS93ZWIvcHJvZHVjdHMvb3Blbi9tYXAKICAvL3RoZWlyIHVzYWdlIHBvbGljeSBoYXMgbm8gbGltaXRzIChleGNlcHQgcmVxdWlyZWQgbm90aWZpY2F0aW9uIGFib3ZlIDQwMDAgdGlsZXMvc2VjIC0gd2UncmUgcGVyaGFwcyBhdCA1MCB0aWxlcy9zZWMgYmFzZWQgb24gQ2xvdWRNYWRlIHN0YXRzKQogIHZhciBtcVN1YmRvbWFpbnMgPSBbICdvdGlsZTEnLCdvdGlsZTInLCAnb3RpbGUzJywgJ290aWxlNCcgXTsKICB2YXIgbXFUaWxlVXJsUHJlZml4ID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sICE9PSAnaHR0cHM6JyA/ICdodHRwOi8ve3N9Lm1xY2RuLmNvbScgOiAnaHR0cHM6Ly97c30tcy5tcWNkbi5jb20nOwogIHZhciBtcU1hcE9wdCA9IHthdHRyaWJ1dGlvbjogb3NtQXR0cmlidXRpb24rJywgVGlsZXMgQ291cnRlc3kgb2YgTWFwUXVlc3QnLCBtYXhOYXRpdmVab29tOiAxOCwgbWF4Wm9vbTogMjEsIHN1YmRvbWFpbnM6IG1xU3ViZG9tYWluc307CiAgYmFzZUxheWVyc1snTWFwUXVlc3QgT1NNJ10gPSBuZXcgTC5UaWxlTGF5ZXIobXFUaWxlVXJsUHJlZml4KycvdGlsZXMvMS4wLjAvbWFwL3t6fS97eH0ve3l9LmpwZycsbXFNYXBPcHQpOwoKICAvLyBjYXJ0b2RiIGhhcyBzb21lIG5pY2UgdGlsZXMgdG9vIC0gYm90aCBkYXJrIGFuZCBsaWdodCBzdWJ0bGUgbWFwcyAtIGh0dHA6Ly9jYXJ0b2RiLmNvbS9iYXNlbWFwcy8KICAvLyAobm90IGF2YWlsYWJsZSBvdmVyIGh0dHBzIHRob3VnaCAtIG5vdCBvbiB0aGUgcmlnaHQgZG9tYWluIG5hbWUgYW55d2F5KQogIHZhciBjYXJ0b0F0dHIgPSAnJmNvcHk7IDxhIGhyZWY9Imh0dHA6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvY29weXJpZ2h0Ij5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsICZjb3B5OyA8YSBocmVmPSJodHRwOi8vY2FydG9kYi5jb20vYXR0cmlidXRpb25zIj5DYXJ0b0RCPC9hPic7CiAgdmFyIGNhcnRvVXJsID0gJ2h0dHA6Ly97c30uYmFzZW1hcHMuY2FydG9jZG4uY29tL3t0aGVtZX0ve3p9L3t4fS97eX0ucG5nJzsKICBiYXNlTGF5ZXJzWydDYXJ0b0RCIERhcmsgTWF0dGVyJ10gPSBMLnRpbGVMYXllcihjYXJ0b1VybCx7YXR0cmlidXRpb246Y2FydG9BdHRyLHRoZW1lOidkYXJrX2FsbCd9KTsKICBiYXNlTGF5ZXJzWydDYXJ0b0RCIFBvc2l0cm9uJ10gPSBMLnRpbGVMYXllcihjYXJ0b1VybCx7YXR0cmlidXRpb246Y2FydG9BdHRyLHRoZW1lOidsaWdodF9hbGwnfSk7CgoKICAvLyB3ZSdsbCBpbmNsdWRlIGdvb2dsZSBtYXBzIHRvbyAtIGluIHRoZSBpbmdyZXNzIGRlZmF1bHQgc3R5bGUsIGFuZCBhIGZldyBvdGhlciBzdGFuZGFyZCBvbmVzCiAgLy8gYXMgdGhlIHN0b2NrIGludGVsIG1hcCBhbHJlYWR5IHVzZXMgdGhlIGdvb2dtZSBtYXBzIEFQSSwgd2UganVzdCBoaWphY2sgdGhlaXIgaW5jbHVzaW9uIG9mIHRoZSBqYXZhc2NyaXB0IGFuZCBBUEkga2V5IDopCiAgdmFyIGluZ3Jlc3NHTWFwT3B0aW9ucyA9IHsKICAgIGJhY2tncm91bmRDb2xvcjogJyMwZTNkNGUnLCAvL29yICNkZGRkZGQgPyAtIHRoYXQncyB0aGUgR29vZ2xlIHRpbGUgbGF5ZXIgZGVmYXVsdAogICAgc3R5bGVzOiBbCiAgICAgICAgeyBmZWF0dXJlVHlwZToiYWxsIiwgZWxlbWVudFR5cGU6ImFsbCIsCiAgICAgICAgICBzdHlsZXJzOiBbe3Zpc2liaWxpdHk6Im9uIn0sIHtodWU6IiMxMzFjMWMifSwge3NhdHVyYXRpb246Ii01MCJ9LCB7aW52ZXJ0X2xpZ2h0bmVzczp0cnVlfV0gfSwKICAgICAgICB7IGZlYXR1cmVUeXBlOiJ3YXRlciIsIGVsZW1lbnRUeXBlOiJhbGwiLAogICAgICAgICAgc3R5bGVyczogW3t2aXNpYmlsaXR5OiJvbiJ9LCB7aHVlOiIjMDA1ZWZmIn0sIHtpbnZlcnRfbGlnaHRuZXNzOnRydWV9XSB9LAogICAgICAgIHsgZmVhdHVyZVR5cGU6InBvaSIsIHN0eWxlcnM6W3t2aXNpYmlsaXR5OiJvZmYifV19LAogICAgICAgIHsgZmVhdHVyZVR5cGU6InRyYW5zaXQiLCBlbGVtZW50VHlwZToiYWxsIiwgc3R5bGVyczpbe3Zpc2liaWxpdHk6Im9mZiJ9XSB9CiAgICAgIF0KICB9OwogIGJhc2VMYXllcnNbJ0dvb2dsZSBEZWZhdWx0IEluZ3Jlc3MgTWFwJ10gPSBuZXcgTC5Hb29nbGUoJ1JPQURNQVAnLHttYXhab29tOjIxLCBtYXBPcHRpb25zOmluZ3Jlc3NHTWFwT3B0aW9uc30pOwogIGJhc2VMYXllcnNbJ0dvb2dsZSBSb2FkcyddID0gbmV3IEwuR29vZ2xlKCdST0FETUFQJyx7bWF4Wm9vbToyMX0pOwogIGJhc2VMYXllcnNbJ0dvb2dsZSBTYXRlbGxpdGUnXSA9IG5ldyBMLkdvb2dsZSgnU0FURUxMSVRFJyx7bWF4Wm9vbToyMX0pOwogIGJhc2VMYXllcnNbJ0dvb2dsZSBIeWJyaWQnXSA9IG5ldyBMLkdvb2dsZSgnSFlCUklEJyx7bWF4Wm9vbToyMX0pOwogIGJhc2VMYXllcnNbJ0dvb2dsZSBUZXJyYWluJ10gPSBuZXcgTC5Hb29nbGUoJ1RFUlJBSU4nLHttYXhab29tOjE1fSk7CgoKICByZXR1cm4gYmFzZUxheWVyczsKfQoKCndpbmRvdy5zZXR1cE1hcCA9IGZ1bmN0aW9uKCkgewogICQoJyNtYXAnKS50ZXh0KCcnKTsKCgoKCiAgLy8gcHJvcGVyIGluaXRpYWwgcG9zaXRpb24gaXMgbm93IGRlbGF5ZWQgdW50aWwgYWxsIHBsdWdpbnMgYXJlIGxvYWRlZCBhbmQgdGhlIGJhc2UgbGF5ZXIgaXMgc2V0CiAgd2luZG93Lm1hcCA9IG5ldyBMLk1hcCgnbWFwJywgewogICAgY2VudGVyOiBbMCwwXSwKICAgIHpvb206IDEsCiAgICB6b29tQ29udHJvbDogKHR5cGVvZiBhbmRyb2lkICE9PSAndW5kZWZpbmVkJyAmJiBhbmRyb2lkICYmIGFuZHJvaWQuc2hvd1pvb20pID8gYW5kcm9pZC5zaG93Wm9vbSgpIDogdHJ1ZSwKICAgIG1pblpvb206IE1JTl9aT09NLAovLyAgICB6b29tQW5pbWF0aW9uOiBmYWxzZSwKICAgIG1hcmtlclpvb21BbmltYXRpb246IGZhbHNlLAogICAgYm91bmNlQXRab29tTGltaXRzOiBmYWxzZQogIH0pOwoKICBpZiAoTC5QYXRoLkNBTlZBUykgewogICAgLy8gZm9yIGNhbnZhcywgMiUgb3ZlcmRyYXcgb25seSAtIHRvIGhlbHAgcGVyZm9ybWFuY2UKICAgIEwuUGF0aC5DTElQX1BBRERJTkcgPSAwLjAyOwogIH0gZWxzZSBpZiAoTC5QYXRoLlNWRykgewogICAgaWYgKEwuQnJvd3Nlci5tb2JpbGUpIHsKICAgICAgLy8gbW9iaWxlIFNWRyAtIDEwJSBvdnJlZHJhdy4gbWlnaHQgaGVscCBwZXJmb3JtYW5jZT8KICAgICAgTC5QYXRoLkNMSVBfUEFERElORyA9IDAuMTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGZvciBzdmcsIDEwMCUgb3ZlcmRyYXcgLSBzbyB3ZSBoYXZlIGEgZnVsbCBzY3JlZW4gd29ydGggaW4gYWxsIGRpcmVjdGlvbnMKICAgICAgTC5QYXRoLkNMSVBfUEFERElORyA9IDEuMDsKICAgIH0KICB9CgogIC8vIGFkZCBlbXB0eSBkaXYgdG8gbGVhZmxldCBjb250cm9sIGFyZWFzIC0gdG8gZm9yY2Ugb3RoZXIgbGVhZmxldCBjb250cm9scyB0byBtb3ZlIGFyb3VuZCBJSVRDIFVJIGVsZW1lbnRzCiAgLy8gVE9ETz8gbW92ZSB0aGUgYWN0dWFsIElJVEMgRE9NIGludG8gdGhlIGxlYWZsZXQgY29udHJvbCBhcmVhcywgc28gZHVtbXkgPGRpdj5zIGFyZW4ndCBuZWVkZWQKICBpZighaXNTbWFydHBob25lKCkpIHsKICAgIC8vIGNoYXQgd2luZG93IGFyZWEKICAgICQod2luZG93Lm1hcC5fY29udHJvbENvcm5lcnNbJ2JvdHRvbWxlZnQnXSkuYXBwZW5kKAogICAgICAkKCc8ZGl2PicpLndpZHRoKDcwOCkuaGVpZ2h0KDEwOCkuYWRkQ2xhc3MoJ2xlYWZsZXQtY29udHJvbCcpLmNzcyh7J3BvaW50ZXItZXZlbnRzJzogJ25vbmUnLCAnbWFyZ2luJzogJzAnfSkpOwogIH0KCiAgdmFyIGFkZExheWVycyA9IHt9OwogIHZhciBoaWRkZW5MYXllciA9IFtdOwoKICBwb3J0YWxzRmFjdGlvbkxheWVycyA9IFtdOwogIHZhciBwb3J0YWxzTGF5ZXJzID0gW107CiAgZm9yKHZhciBpID0gMDsgaSA8PSA4OyBpKyspIHsKICAgIHBvcnRhbHNGYWN0aW9uTGF5ZXJzW2ldID0gW0wubGF5ZXJHcm91cCgpLCBMLmxheWVyR3JvdXAoKSwgTC5sYXllckdyb3VwKCldOwogICAgcG9ydGFsc0xheWVyc1tpXSA9IEwubGF5ZXJHcm91cChwb3J0YWxzRmFjdGlvbkxheWVyc1tpXSk7CiAgICBtYXAuYWRkTGF5ZXIocG9ydGFsc0xheWVyc1tpXSk7CiAgICB2YXIgdCA9IChpID09PSAwID8gJ1VuY2xhaW1lZCcgOiAnTGV2ZWwgJyArIGkpICsgJyBQb3J0YWxzJzsKICAgIGFkZExheWVyc1t0XSA9IHBvcnRhbHNMYXllcnNbaV07CiAgICAvLyBTdG9yZSBpdCBpbiBoaWRkZW5MYXllciB0byByZW1vdmUgbGF0ZXIKICAgIGlmKCFpc0xheWVyR3JvdXBEaXNwbGF5ZWQodCwgdHJ1ZSkpIGhpZGRlbkxheWVyLnB1c2gocG9ydGFsc0xheWVyc1tpXSk7CiAgfQoKICBmaWVsZHNGYWN0aW9uTGF5ZXJzID0gW0wubGF5ZXJHcm91cCgpLCBMLmxheWVyR3JvdXAoKSwgTC5sYXllckdyb3VwKCldOwogIHZhciBmaWVsZHNMYXllciA9IEwubGF5ZXJHcm91cChmaWVsZHNGYWN0aW9uTGF5ZXJzKTsKICBtYXAuYWRkTGF5ZXIoZmllbGRzTGF5ZXIsIHRydWUpOwogIGFkZExheWVyc1snRmllbGRzJ10gPSBmaWVsZHNMYXllcjsKICAvLyBTdG9yZSBpdCBpbiBoaWRkZW5MYXllciB0byByZW1vdmUgbGF0ZXIKICBpZighaXNMYXllckdyb3VwRGlzcGxheWVkKCdGaWVsZHMnLCB0cnVlKSkgaGlkZGVuTGF5ZXIucHVzaChmaWVsZHNMYXllcik7CgogIGxpbmtzRmFjdGlvbkxheWVycyA9IFtMLmxheWVyR3JvdXAoKSwgTC5sYXllckdyb3VwKCksIEwubGF5ZXJHcm91cCgpXTsKICB2YXIgbGlua3NMYXllciA9IEwubGF5ZXJHcm91cChsaW5rc0ZhY3Rpb25MYXllcnMpOwogIG1hcC5hZGRMYXllcihsaW5rc0xheWVyLCB0cnVlKTsKICBhZGRMYXllcnNbJ0xpbmtzJ10gPSBsaW5rc0xheWVyOwogIC8vIFN0b3JlIGl0IGluIGhpZGRlbkxheWVyIHRvIHJlbW92ZSBsYXRlcgogIGlmKCFpc0xheWVyR3JvdXBEaXNwbGF5ZWQoJ0xpbmtzJywgdHJ1ZSkpIGhpZGRlbkxheWVyLnB1c2gobGlua3NMYXllcik7CgogIC8vIGZhY3Rpb24tc3BlY2lmaWMgbGF5ZXJzCiAgLy8gdGhlc2UgbGF5ZXJzIGRvbid0IGFjdHVhbGx5IGNvbnRhaW4gYW55IGRhdGEuIGluc3RlYWQsIGV2ZXJ5IHRpbWUgdGhleSdyZSBhZGRlZC9yZW1vdmVkIGZyb20gdGhlIG1hcCwKICAvLyB0aGUgbWF0Y2hpbmcgc3ViLWxheWVycyB3aXRoaW4gdGhlIGFib3ZlIHBvcnRhbHMvZmllbGRzL2xpbmtzIGFyZSBhZGRlZC9yZW1vdmVkIGZyb20gdGhlaXIgcGFyZW50IHdpdGgKICAvLyB0aGUgYmVsb3cgJ29ub3ZlcmxheWFkZC9vbm92ZXJsYXlyZW1vdmUnIGV2ZW50cwogIHZhciBmYWN0aW9uTGF5ZXJzID0gW0wubGF5ZXJHcm91cCgpLCBMLmxheWVyR3JvdXAoKSwgTC5sYXllckdyb3VwKCldOwogIGZvciAodmFyIGZhYyBpbiBmYWN0aW9uTGF5ZXJzKSB7CiAgICBtYXAuYWRkTGF5ZXIgKGZhY3Rpb25MYXllcnNbZmFjXSk7CiAgfQoKICB2YXIgc2V0RmFjdGlvbkxheWVyc1N0YXRlID0gZnVuY3Rpb24oZmFjLGVuYWJsZWQpIHsKICAgIGlmIChlbmFibGVkKSB7CiAgICAgIGlmICghZmllbGRzTGF5ZXIuaGFzTGF5ZXIoZmllbGRzRmFjdGlvbkxheWVyc1tmYWNdKSkgZmllbGRzTGF5ZXIuYWRkTGF5ZXIgKGZpZWxkc0ZhY3Rpb25MYXllcnNbZmFjXSk7CiAgICAgIGlmICghbGlua3NMYXllci5oYXNMYXllcihsaW5rc0ZhY3Rpb25MYXllcnNbZmFjXSkpIGxpbmtzTGF5ZXIuYWRkTGF5ZXIgKGxpbmtzRmFjdGlvbkxheWVyc1tmYWNdKTsKICAgICAgZm9yICh2YXIgbHZsIGluIHBvcnRhbHNMYXllcnMpIHsKICAgICAgICBpZiAoIXBvcnRhbHNMYXllcnNbbHZsXS5oYXNMYXllcihwb3J0YWxzRmFjdGlvbkxheWVyc1tsdmxdW2ZhY10pKSBwb3J0YWxzTGF5ZXJzW2x2bF0uYWRkTGF5ZXIgKHBvcnRhbHNGYWN0aW9uTGF5ZXJzW2x2bF1bZmFjXSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChmaWVsZHNMYXllci5oYXNMYXllcihmaWVsZHNGYWN0aW9uTGF5ZXJzW2ZhY10pKSBmaWVsZHNMYXllci5yZW1vdmVMYXllciAoZmllbGRzRmFjdGlvbkxheWVyc1tmYWNdKTsKICAgICAgaWYgKGxpbmtzTGF5ZXIuaGFzTGF5ZXIobGlua3NGYWN0aW9uTGF5ZXJzW2ZhY10pKSBsaW5rc0xheWVyLnJlbW92ZUxheWVyIChsaW5rc0ZhY3Rpb25MYXllcnNbZmFjXSk7CiAgICAgIGZvciAodmFyIGx2bCBpbiBwb3J0YWxzTGF5ZXJzKSB7CiAgICAgICAgaWYgKHBvcnRhbHNMYXllcnNbbHZsXS5oYXNMYXllcihwb3J0YWxzRmFjdGlvbkxheWVyc1tsdmxdW2ZhY10pKSBwb3J0YWxzTGF5ZXJzW2x2bF0ucmVtb3ZlTGF5ZXIgKHBvcnRhbHNGYWN0aW9uTGF5ZXJzW2x2bF1bZmFjXSk7CiAgICAgIH0KICAgIH0KICB9CgogIC8vIHRvIGF2b2lkIGFueSBmYXZvdXJpdGlzbSwgd2UnbGwgcHV0IHRoZSBwbGF5ZXIncyBvd24gZmFjdGlvbiBsYXllciBmaXJzdAogIGlmIChQTEFZRVIudGVhbSA9PSAnUkVTSVNUQU5DRScpIHsKICAgIGFkZExheWVyc1snUmVzaXN0YW5jZSddID0gZmFjdGlvbkxheWVyc1tURUFNX1JFU107CiAgICBhZGRMYXllcnNbJ0VubGlnaHRlbmVkJ10gPSBmYWN0aW9uTGF5ZXJzW1RFQU1fRU5MXTsKICB9IGVsc2UgewogICAgYWRkTGF5ZXJzWydFbmxpZ2h0ZW5lZCddID0gZmFjdGlvbkxheWVyc1tURUFNX0VOTF07CiAgICBhZGRMYXllcnNbJ1Jlc2lzdGFuY2UnXSA9IGZhY3Rpb25MYXllcnNbVEVBTV9SRVNdOwogIH0KICBpZiAoIWlzTGF5ZXJHcm91cERpc3BsYXllZCgnUmVzaXN0YW5jZScsIHRydWUpKSBoaWRkZW5MYXllci5wdXNoIChmYWN0aW9uTGF5ZXJzW1RFQU1fUkVTXSk7CiAgaWYgKCFpc0xheWVyR3JvdXBEaXNwbGF5ZWQoJ0VubGlnaHRlbmVkJywgdHJ1ZSkpIGhpZGRlbkxheWVyLnB1c2ggKGZhY3Rpb25MYXllcnNbVEVBTV9FTkxdKTsKCiAgc2V0RmFjdGlvbkxheWVyc1N0YXRlIChURUFNX05PTkUsIHRydWUpOwogIHNldEZhY3Rpb25MYXllcnNTdGF0ZSAoVEVBTV9SRVMsIGlzTGF5ZXJHcm91cERpc3BsYXllZCgnUmVzaXN0YW5jZScsIHRydWUpKTsKICBzZXRGYWN0aW9uTGF5ZXJzU3RhdGUgKFRFQU1fRU5MLCBpc0xheWVyR3JvdXBEaXNwbGF5ZWQoJ0VubGlnaHRlbmVkJywgdHJ1ZSkpOwoKICAvLyBOT1RFOiB0aGVzZSBldmVudHMgYXJlIGZpcmVkIGJ5IHRoZSBsYXllciBjaG9vc2VyLCBzbyB3b24ndCBoYXBwZW4gdW50aWwgdGhhdCdzIGNyZWF0ZWQgYW5kIGFkZGVkIHRvIHRoZSBtYXAKICB3aW5kb3cubWFwLm9uKCdvdmVybGF5YWRkIG92ZXJsYXlyZW1vdmUnLCBmdW5jdGlvbihlKSB7CiAgICB2YXIgZGlzcGxheWVkID0gKGUudHlwZSA9PSAnb3ZlcmxheWFkZCcpOwogICAgc3dpdGNoIChlLm5hbWUpIHsKICAgICAgY2FzZSAnUmVzaXN0YW5jZSc6CiAgICAgICAgc2V0RmFjdGlvbkxheWVyc1N0YXRlIChURUFNX1JFUywgZGlzcGxheWVkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnRW5saWdodGVuZWQnOgogICAgICAgIHNldEZhY3Rpb25MYXllcnNTdGF0ZSAoVEVBTV9FTkwsIGRpc3BsYXllZCk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfSk7CgogIHZhciBiYXNlTGF5ZXJzID0gY3JlYXRlRGVmYXVsdEJhc2VNYXBMYXllcnMoKTsKCiAgd2luZG93LmxheWVyQ2hvb3NlciA9IG5ldyBMLkNvbnRyb2wuTGF5ZXJzKGJhc2VMYXllcnMsIGFkZExheWVycyk7CgogIC8vIFJlbW92ZSB0aGUgaGlkZGVuIGxheWVyIGFmdGVyIGxheWVyQ2hvb3NlciBidWlsdCwgdG8gYXZvaWQgbWVzc2luZyB1cCBvcmRlcmluZyBvZiBsYXllcnMgCiAgJC5lYWNoKGhpZGRlbkxheWVyLCBmdW5jdGlvbihpbmQsIGxheWVyKXsKICAgIG1hcC5yZW1vdmVMYXllcihsYXllcik7CgogICAgLy8gYXMgdXNlcnMgb2Z0ZW4gYmVjb21lIGNvbmZ1c2VkIGlmIHRoZXkgYWNjaWRlbnRhbGx5IHN3aXRjaCBhIHN0YW5kYXJkIGxheWVyIG9mZiwgZGlzcGxheSBhIHdhcm5pbmcgaW4gdGhpcyBjYXNlCiAgICAkKCcjcG9ydGFsZGV0YWlscycpLmh0bWwoJzxkaXYgY2xhc3M9ImxheWVyX29mZl93YXJuaW5nIj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArJzxwPjxiPldhcm5pbmc8L2I+OiBzb21lIG9mIHRoZSBzdGFuZGFyZCBsYXllcnMgYXJlIHR1cm5lZCBvZmYuIFNvbWUgcG9ydGFscy9saW5rcy9maWVsZHMgd2lsbCBub3QgYmUgdmlzaWJsZS48L3A+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8YSBpZD0iZW5hYmxlX3N0YW5kYXJkX2xheWVycyI+RW5hYmxlIHN0YW5kYXJkIGxheWVyczwvYT4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArJzwvZGl2PicpOwoKICAgICQoJyNlbmFibGVfc3RhbmRhcmRfbGF5ZXJzJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7CiAgICAgICQuZWFjaChhZGRMYXllcnMsIGZ1bmN0aW9uKGluZCwgbGF5ZXIpIHsKICAgICAgICBpZiAoIW1hcC5oYXNMYXllcihsYXllcikpIG1hcC5hZGRMYXllcihsYXllcik7CiAgICAgIH0pOwogICAgICAkKCcjcG9ydGFsZGV0YWlscycpLmh0bWwoJycpOwogICAgfSk7CgogIH0pOwoKICBtYXAuYWRkQ29udHJvbCh3aW5kb3cubGF5ZXJDaG9vc2VyKTsKCiAgbWFwLmF0dHJpYnV0aW9uQ29udHJvbC5zZXRQcmVmaXgoJycpOwogIC8vIGxpc3RlbiBmb3IgY2hhbmdlcyBhbmQgc3RvcmUgdGhlbSBpbiBjb29raWVzCiAgbWFwLm9uKCdtb3ZlZW5kJywgd2luZG93LnN0b3JlTWFwUG9zaXRpb24pOwoKICBtYXAub24oJ21vdmVlbmQnLCBmdW5jdGlvbihlKSB7CiAgICAvLyB0d28gbGltaXRzIG9uIG1hcCBwb3NpdGlvbgogICAgLy8gd2Ugd3JhcCBsb25naXR1ZGUgKHRoZSBMLkxhdExuZyAnd3JhcCcgbWV0aG9kKSAtIHNvIHdlIGRvbid0IGZpbmQgb3Vyc2VsdmVzIGxvb2tpbmcgYmV5b25kICstMTgwIGRlZ3JlZXMKICAgIC8vIHRoZW4gbGF0aXR1ZGUgaXMgY2xhbXBlZCB3aXRoIHRoZSBjbGFtcExhdExuZyBmdW5jdGlvbiAodG8gdGhlIDg1IGRlZyBub3J0aC9zb3V0aCBsaW1pdHMpCiAgICB2YXIgbmV3UG9zID0gY2xhbXBMYXRMbmcobWFwLmdldENlbnRlcigpLndyYXAoKSk7CiAgICBpZiAoIW1hcC5nZXRDZW50ZXIoKS5lcXVhbHMobmV3UG9zKSkgewogICAgICBtYXAucGFuVG8obmV3UG9zLHthbmltYXRlOmZhbHNlfSkKICAgIH0KICB9KTsKCiAgLy8gbWFwIHVwZGF0ZSBzdGF0dXMgaGFuZGxpbmcgJiB1cGRhdGUgbWFwIGhvb2tzCiAgLy8gZW5zdXJlcyBvcmRlciBvZiBjYWxscwogIG1hcC5vbignbW92ZXN0YXJ0JywgZnVuY3Rpb24oKSB7IHdpbmRvdy5tYXBSdW5zVXNlckFjdGlvbiA9IHRydWU7IHdpbmRvdy5yZXF1ZXN0cy5hYm9ydCgpOyB3aW5kb3cuc3RhcnRSZWZyZXNoVGltZW91dCgtMSk7IH0pOwogIG1hcC5vbignbW92ZWVuZCcsIGZ1bmN0aW9uKCkgeyB3aW5kb3cubWFwUnVuc1VzZXJBY3Rpb24gPSBmYWxzZTsgd2luZG93LnN0YXJ0UmVmcmVzaFRpbWVvdXQoT05fTU9WRV9SRUZSRVNIKjEwMDApOyB9KTsKCiAgbWFwLm9uKCd6b29tZW5kJywgZnVuY3Rpb24oKSB7IHdpbmRvdy5sYXllckNob29zZXJTZXREaXNhYmxlZFN0YXRlcygpOyB9KTsKICB3aW5kb3cubGF5ZXJDaG9vc2VyU2V0RGlzYWJsZWRTdGF0ZXMoKTsKCiAgLy8gb24gem9vbWVuZCwgY2hlY2sgdG8gc2VlIHRoZSB6b29tIGxldmVsIGlzIGFuIGludCwgYW5kIHJlc2V0IHRoZSB2aWV3IGlmIG5vdAogIC8vICh0aGVyZSdzIGEgYnVnIG9uIG1vYmlsZSB3aGVyZSB6b29tIGxldmVscyBzb21ldGltZXMgZW5kIHVwIGFzIGZyYWN0aW9uYWwgbGV2ZWxzLiB0aGlzIGNhdXNlcyB0aGUgYmFzZSBtYXAgdG8gYmUgaW52aXNpYmxlKQogIG1hcC5vbignem9vbWVuZCcsIGZ1bmN0aW9uKCkgewogICAgdmFyIHogPSBtYXAuZ2V0Wm9vbSgpOwogICAgaWYgKHogIT0gcGFyc2VJbnQoeikpCiAgICB7CiAgICAgIGNvbnNvbGUud2FybignTm9uLWludGVnZXIgem9vbSBsZXZlbCBhdCB6b29tZW5kOiAnK3orJyAtIHRyeWluZyB0byBmaXguLi4nKTsKICAgICAgbWFwLnNldFpvb20ocGFyc2VJbnQoeiksIHthbmltYXRlOmZhbHNlfSk7CiAgICB9CiAgfSk7CgoKICAvLyBzZXQgYSAnbW92ZWVuZCcgaGFuZGxlciBmb3IgdGhlIG1hcCB0byBjbGVhciBpZGxlIHN0YXRlLiBlLmcuIGFmdGVyIG1vYmlsZSAnbXkgbG9jYXRpb24nIGlzIHVzZWQuCiAgLy8gcG9zc2libHkgc29tZSBjYXNlcyB3aGVuIHJlc2l6aW5nIGRlc2t0b3AgYnJvd3NlciB0b28KICBtYXAub24oJ21vdmVlbmQnLCBpZGxlUmVzZXQpOwoKICB3aW5kb3cuYWRkUmVzdW1lRnVuY3Rpb24oZnVuY3Rpb24oKSB7IHdpbmRvdy5zdGFydFJlZnJlc2hUaW1lb3V0KE9OX01PVkVfUkVGUkVTSCoxMDAwKTsgfSk7CgogIC8vIGNyZWF0ZSB0aGUgbWFwIGRhdGEgcmVxdWVzdGVyCiAgd2luZG93Lm1hcERhdGFSZXF1ZXN0ID0gbmV3IE1hcERhdGFSZXF1ZXN0KCk7CiAgd2luZG93Lm1hcERhdGFSZXF1ZXN0LnN0YXJ0KCk7CgogIC8vIHN0YXJ0IHRoZSByZWZyZXNoIHByb2Nlc3Mgd2l0aCBhIHNtYWxsIHRpbWVvdXQsIHNvIHRoZSBmaXJzdCBkYXRhIHJlcXVlc3QgaGFwcGVucyBxdWlja2x5CiAgLy8gKHRoZSBjb2RlIG9yaWdpbmFsbHkgY2FsbGVkIHRoZSByZXF1ZXN0IGZ1bmN0aW9uIGRpcmVjdGx5LCBhbmQgdHJpZ2dlcmVkIGEgbm9ybWFsIGRlbGF5IGZvciB0aGUgbmV4dCByZWZyZXNoLgogIC8vICBob3dldmVyLCB0aGUgbW92ZWVuZC96b29tZW5kIGdldHMgdHJpZ2dlcmVkIG9uIG1hcCBsb2FkLCBjYXVzaW5nIGEgZHVwbGljYXRlIHJlZnJlc2guIHRoaXMgaGVscHMgcHJldmVudCB0aGF0CiAgd2luZG93LnN0YXJ0UmVmcmVzaFRpbWVvdXQoT05fTU9WRV9SRUZSRVNIKjEwMDApOwp9OwoKLy9hZGRzIGEgYmFzZSBsYXllciB0byB0aGUgbWFwLiBkb25lIHNlcGFyYXRlbHkgZnJvbSB0aGUgYWJvdmUsIHNvIHRoYXQgcGx1Z2lucyB0aGF0IGFkZCBiYXNlIGxheWVycyBjYW4gYmUgdGhlIGRlZmF1bHQKd2luZG93LnNldE1hcEJhc2VMYXllciA9IGZ1bmN0aW9uKCkgewogIC8vY3JlYXRlIGEgbWFwIG5hbWUgLT4gbGF5ZXIgbWFwcGluZyAtIGRlcGVuZHMgb24gaW50ZXJuYWxzIG9mIEwuQ29udHJvbC5MYXllcnMKICB2YXIgbmFtZVRvTGF5ZXIgPSB7fTsKICB2YXIgZmlyc3RMYXllciA9IG51bGw7CgogIGZvciAoaSBpbiB3aW5kb3cubGF5ZXJDaG9vc2VyLl9sYXllcnMpIHsKICAgIHZhciBvYmogPSB3aW5kb3cubGF5ZXJDaG9vc2VyLl9sYXllcnNbaV07CiAgICBpZiAoIW9iai5vdmVybGF5KSB7CiAgICAgIG5hbWVUb0xheWVyW29iai5uYW1lXSA9IG9iai5sYXllcjsKICAgICAgaWYgKCFmaXJzdExheWVyKSBmaXJzdExheWVyID0gb2JqLmxheWVyOwogICAgfQogIH0KCiAgdmFyIGJhc2VMYXllciA9IG5hbWVUb0xheWVyW2xvY2FsU3RvcmFnZVsnaWl0Yy1iYXNlLW1hcCddXSB8fCBmaXJzdExheWVyOwogIG1hcC5hZGRMYXllcihiYXNlTGF5ZXIpOwoKICAvLyBub3cgd2UgaGF2ZSBhIGJhc2UgbGF5ZXIgd2UgY2FuIHNldCB0aGUgbWFwIHBvc2l0aW9uCiAgLy8gKHNldHRpbmcgYW4gaW5pdGlhbCBwb3NpdGlvbiwgYmVmb3JlIGEgYmFzZSBsYXllciBpcyBhZGRlZCwgY2F1c2VzIGlzc3VlcyB3aXRoIGxlYWZsZXQpCiAgdmFyIHBvcyA9IGdldFBvc2l0aW9uKCk7CiAgbWFwLnNldFZpZXcgKHBvcy5jZW50ZXIsIHBvcy56b29tLCB7cmVzZXQ6dHJ1ZX0pOwoKCiAgLy9ldmVudCB0byB0cmFjayBsYXllciBjaGFuZ2VzIGFuZCBzdG9yZSB0aGUgbmFtZQogIG1hcC5vbignYmFzZWxheWVyY2hhbmdlJywgZnVuY3Rpb24oaW5mbykgewogICAgZm9yKGkgaW4gd2luZG93LmxheWVyQ2hvb3Nlci5fbGF5ZXJzKSB7CiAgICAgIHZhciBvYmogPSB3aW5kb3cubGF5ZXJDaG9vc2VyLl9sYXllcnNbaV07CiAgICAgIGlmIChpbmZvLmxheWVyID09PSBvYmoubGF5ZXIpIHsKICAgICAgICBsb2NhbFN0b3JhZ2VbJ2lpdGMtYmFzZS1tYXAnXSA9IG9iai5uYW1lOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CgogICAgLy9hbHNvLCBsZWFmbGV0IG5vIGxvbmdlciBlbnN1cmVzIHRoZSBiYXNlIGxheWVyIHpvb20gaXMgc3VpdGFibGUgZm9yIHRoZSBtYXAgKGEgYnVnPyBmZWF0dXJlIGNoYW5nZT8pLCBzbyBkbyBzbyBoZXJlCiAgICBtYXAuc2V0Wm9vbShtYXAuZ2V0Wm9vbSgpKTsKCgogIH0pOwoKCn0KCi8vIHJlbmRlcnMgcGxheWVyIGRldGFpbHMgaW50byB0aGUgd2Vic2l0ZS4gU2luY2UgdGhlIHBsYXllciBpbmZvIGlzCi8vIGluY2x1ZGVkIGFzIGlubGluZSBzY3JpcHQgaW4gdGhlIG9yaWdpbmFsIHNpdGUsIHRoZSBkYXRhIGlzIHN0YXRpYwovLyBhbmQgY2Fubm90IGJlIHVwZGF0ZWQuCndpbmRvdy5zZXR1cFBsYXllclN0YXQgPSBmdW5jdGlvbigpIHsKICAvLyBzdG9jayBzaXRlIHVwZGF0ZWQgdG8gc3VwcGx5IHRoZSBhY3R1YWwgcGxheWVyIGxldmVsLCBBUCByZXF1aXJlbWVudHMgYW5kIFhNIGNhcGFjaXR5IHZhbHVlcwogIHZhciBsZXZlbCA9IFBMQVlFUi52ZXJpZmllZF9sZXZlbDsKICBQTEFZRVIubGV2ZWwgPSBsZXZlbDsgLy9mb3IgaGlzdG9yaWNhbCByZWFzb25zIElJVEMgZXhwZWN0cyBQTEFZRVIubGV2ZWwgdG8gY29udGFpbiB0aGUgY3VycmVudCBwbGF5ZXIgbGV2ZWwKCiAgdmFyIG4gPSB3aW5kb3cuUExBWUVSLm5pY2tuYW1lOwogIFBMQVlFUi5uaWNrTWF0Y2hlciA9IG5ldyBSZWdFeHAoJ1xcYignK24rJylcXGInLCAnaWcnKTsKCiAgdmFyIGFwID0gcGFyc2VJbnQoUExBWUVSLmFwKTsKICB2YXIgdGhpc0x2bEFwID0gcGFyc2VJbnQoUExBWUVSLm1pbl9hcF9mb3JfY3VycmVudF9sZXZlbCk7CiAgdmFyIG5leHRMdmxBcCA9IHBhcnNlSW50KFBMQVlFUi5taW5fYXBfZm9yX25leHRfbGV2ZWwpOwoKICBpZiAobmV4dEx2bEFwKSB7CiAgICB2YXIgbHZsVXBBcCA9IGRpZ2l0cyhuZXh0THZsQXAtYXApOwogICAgdmFyIGx2bEFwUHJvZyA9IE1hdGgucm91bmQoKGFwLXRoaXNMdmxBcCkvKG5leHRMdmxBcC10aGlzTHZsQXApKjEwMCk7CiAgfSAvLyBlbHNlIHplcm8gbmV4dEx2bEFwIC0gc28gYXQgbWF4aW11bSBsZXZlbCg/KQoKICB2YXIgeG1NYXggPSBwYXJzZUludChQTEFZRVIueG1fY2FwYWNpdHkpOwogIHZhciB4bVJhdGlvID0gTWF0aC5yb3VuZChQTEFZRVIuZW5lcmd5L3htTWF4KjEwMCk7CgogIHZhciBjbHMgPSBQTEFZRVIudGVhbSA9PT0gJ1JFU0lTVEFOQ0UnID8gJ3JlcycgOiAnZW5sJzsKCgogIHZhciB0ID0gJ0xldmVsOlx0JyArIGxldmVsICsgJ1xuJwogICAgICAgICsgJ1hNOlx0JyArIFBMQVlFUi5lbmVyZ3kgKyAnIC8gJyArIHhtTWF4ICsgJ1xuJwogICAgICAgICsgJ0FQOlx0JyArIGRpZ2l0cyhhcCkgKyAnXG4nCiAgICAgICAgKyAobmV4dEx2bEFwID4gMCA/ICdsZXZlbCB1cCBpbjpcdCcgKyBsdmxVcEFwICsgJyBBUCcgOiAnTWF4aW11bCBsZXZlbCByZWFjaGVkKCEpJykKICAgICAgICArICdcblxJbnZpdGVzOlx0JytQTEFZRVIuYXZhaWxhYmxlX2ludml0ZXMKICAgICAgICArICdcblxuTm90ZTogeW91ciBwbGF5ZXIgc3RhdHMgY2FuIG9ubHkgYmUgdXBkYXRlZCBieSBhIGZ1bGwgcmVsb2FkIChGNSknOwoKICAkKCcjcGxheWVyc3RhdCcpLmh0bWwoJycKICAgICsgJzxoMiB0aXRsZT0iJyt0KyciPicrbGV2ZWwrJyZuYnNwOycKICAgICsgJzxkaXYgaWQ9Im5hbWUiPicKICAgICsgJzxzcGFuIGNsYXNzPSInK2NscysnIj4nK1BMQVlFUi5uaWNrbmFtZSsnPC9zcGFuPicKICAgICsgJzxhIGhyZWY9Ii9fYWgvbG9nb3V0P2NvbnRpbnVlPWh0dHBzOi8vd3d3Lmdvb2dsZS5jb20vYWNjb3VudHMvTG9nb3V0JTNGY29udGludWUlM0RodHRwczovL2FwcGVuZ2luZS5nb29nbGUuY29tL19haC9sb2dvdXQlMjUzRmNvbnRpbnVlJTI1M0RodHRwczovL3d3dy5pbmdyZXNzLmNvbS9pbnRlbCUyNnNlcnZpY2UlM0RhaCIgaWQ9InNpZ25vdXQiPnNpZ24gb3V0PC9hPicKICAgICsgJzwvZGl2PicKICAgICsgJzxkaXYgaWQ9InN0YXRzIj4nCiAgICArICc8c3VwPlhNOiAnK3htUmF0aW8rJyU8L3N1cD4nCiAgICArICc8c3ViPicgKyAobmV4dEx2bEFwID4gMCA/ICdsZXZlbDogJytsdmxBcFByb2crJyUnIDogJ21heCBsZXZlbCcpICsgJzwvc3ViPicKICAgICsgJzwvZGl2PicKICAgICsgJzwvaDI+JwogICk7Cn0KCndpbmRvdy5zZXR1cFNpZGViYXJUb2dnbGUgPSBmdW5jdGlvbigpIHsKICAkKCcjc2lkZWJhcnRvZ2dsZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgewogICAgdmFyIHRvZ2dsZSA9ICQoJyNzaWRlYmFydG9nZ2xlJyk7CiAgICB2YXIgc2lkZWJhciA9ICQoJyNzY3JvbGx3cmFwcGVyJyk7CiAgICBpZihzaWRlYmFyLmlzKCc6dmlzaWJsZScpKSB7CiAgICAgIHNpZGViYXIuaGlkZSgpLmNzcygnei1pbmRleCcsIDEpOwogICAgICAkKCcubGVhZmxldC1yaWdodCcpLmNzcygnbWFyZ2luLXJpZ2h0JywnMCcpOwogICAgICB0b2dnbGUuaHRtbCgnPHNwYW4gY2xhc3M9InRvZ2dsZSBvcGVuIj48L3NwYW4+Jyk7CiAgICAgIHRvZ2dsZS5jc3MoJ3JpZ2h0JywgJzAnKTsKICAgIH0gZWxzZSB7CiAgICAgIHNpZGViYXIuY3NzKCd6LWluZGV4JywgMTAwMSkuc2hvdygpOwogICAgICAkKCcubGVhZmxldC1yaWdodCcpLmNzcygnbWFyZ2luLXJpZ2h0JywgU0lERUJBUl9XSURUSCsxKydweCcpOwogICAgICB0b2dnbGUuaHRtbCgnPHNwYW4gY2xhc3M9InRvZ2dsZSBjbG9zZSI+PC9zcGFuPicpOwogICAgICB0b2dnbGUuY3NzKCdyaWdodCcsIFNJREVCQVJfV0lEVEgrMSsncHgnKTsKICAgIH0KICAgICQoJy51aS10b29sdGlwJykucmVtb3ZlKCk7CiAgfSk7Cn0KCndpbmRvdy5zZXR1cFRvb2x0aXBzID0gZnVuY3Rpb24oZWxlbWVudCkgewogIGVsZW1lbnQgPSBlbGVtZW50IHx8ICQoZG9jdW1lbnQpOwogIGVsZW1lbnQudG9vbHRpcCh7CiAgICAvLyBkaXNhYmxlIHNob3cvaGlkZSBhbmltYXRpb24KICAgIHNob3c6IHsgZWZmZWN0OiAnbm9uZScsIGR1cmF0aW9uOiAwLCBkZWxheTogMzUwIH0sCiAgICBoaWRlOiBmYWxzZSwKICAgIG9wZW46IGZ1bmN0aW9uKGV2ZW50LCB1aSkgewogICAgICAvLyBlbnN1cmUgYWxsIG90aGVyIHRvb2x0aXBzIGFyZSBjbG9zZWQKICAgICAgJCgiLnVpLXRvb2x0aXAiKS5ub3QodWkudG9vbHRpcCkucmVtb3ZlKCk7CiAgICB9LAogICAgY29udGVudDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciB0aXRsZSA9ICQodGhpcykuYXR0cigndGl0bGUnKTsKICAgICAgcmV0dXJuIHdpbmRvdy5jb252ZXJ0VGV4dFRvVGFibGVNYWdpYyh0aXRsZSk7CiAgICB9CiAgfSk7CgogIGlmKCF3aW5kb3cudG9vbHRpcENsZWFyZXJIYXNCZWVuU2V0dXApIHsKICAgIHdpbmRvdy50b29sdGlwQ2xlYXJlckhhc0JlZW5TZXR1cCA9IHRydWU7CiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnVpLXRvb2x0aXAnLCBmdW5jdGlvbigpIHsgJCh0aGlzKS5yZW1vdmUoKTsgfSk7CiAgfQp9Cgp3aW5kb3cuc2V0dXBUYXBob2xkID0gZnVuY3Rpb24oKSB7CiAgLy8gQGF1dGhvciBSaWNoIEFkYW1zIDxyaWNoQHJpY2hhZGFtcy5tZT4KCi8vIEltcGxlbWVudHMgYSB0YXAgYW5kIGhvbGQgZnVuY3Rpb25hbGl0eS4gSWYgeW91IGNsaWNrL3RhcCBhbmQgcmVsZWFzZSwgaXQgd2lsbCB0cmlnZ2VyIGEgbm9ybWFsCi8vIGNsaWNrIGV2ZW50LiBCdXQgaWYgeW91IGNsaWNrL3RhcCBhbmQgaG9sZCBmb3IgMXMgKGRlZmF1bHQpLCBpdCB3aWxsIHRyaWdnZXIgYSB0YXBob2xkIGV2ZW50IGluc3RlYWQuCgo7KGZ1bmN0aW9uKCQpCnsKICAgIC8vIERlZmF1bHQgb3B0aW9ucwogICAgdmFyIGRlZmF1bHRzID0gewogICAgICAgIGR1cmF0aW9uOiAxMDAwLCAvLyBtcwogICAgICAgIGNsaWNrSGFuZGxlcjogbnVsbAogICAgfQoKICAgIC8vIFdoZW4gc3RhcnQgb2YgYSB0YXBob2xkIGV2ZW50IGlzIHRyaWdnZXJlZC4KICAgIGZ1bmN0aW9uIHN0YXJ0SGFuZGxlcihldmVudCkKICAgIHsKICAgICAgICB2YXIgJGVsZW0gPSBqUXVlcnkodGhpcyk7CgogICAgICAgIC8vIE1lcmdlIHRoZSBkZWZhdWx0cyBhbmQgYW55IHVzZXIgZGVmaW5lZCBzZXR0aW5ncy4KICAgICAgICBzZXR0aW5ncyA9IGpRdWVyeS5leHRlbmQoe30sIGRlZmF1bHRzLCBldmVudC5kYXRhKTsKCiAgICAgICAgLy8gSWYgb2JqZWN0IGFsc28gaGFzIGNsaWNrIGhhbmRsZXIsIHN0b3JlIGl0IGFuZCB1bmJpbmQuIFRhcGhvbGQgd2lsbCB0cmlnZ2VyIHRoZQogICAgICAgIC8vIGNsaWNrIGl0c2VsZiwgcmF0aGVyIHRoYW4gbm9ybWFsIHByb3BhZ2F0aW9uLgogICAgICAgIGlmICh0eXBlb2YgJGVsZW0uZGF0YSgiZXZlbnRzIikgIT0gInVuZGVmaW5lZCIKICAgICAgICAgICAgJiYgdHlwZW9mICRlbGVtLmRhdGEoImV2ZW50cyIpLmNsaWNrICE9ICJ1bmRlZmluZWQiKQogICAgICAgIHsKICAgICAgICAgICAgLy8gRmluZCB0aGUgb25lIHdpdGhvdXQgYSBuYW1lc3BhY2UgZGVmaW5lZC4KICAgICAgICAgICAgZm9yICh2YXIgYyBpbiAkZWxlbS5kYXRhKCJldmVudHMiKS5jbGljaykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCRlbGVtLmRhdGEoImV2ZW50cyIpLmNsaWNrW2NdLm5hbWVzcGFjZSA9PSAiIikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaGFuZGxlciA9ICRlbGVtLmRhdGEoImV2ZW50cyIpLmNsaWNrW2NdLmhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAkZWxlbS5kYXRhKCJ0YXBob2xkX2NsaWNrX2hhbmRsZXIiLCBoYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICAkZWxlbS51bmJpbmQoImNsaWNrIiwgaGFuZGxlcik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gT3RoZXJ3aXNlLCBpZiBhIGN1c3RvbSBjbGljayBoYW5kbGVyIHdhcyBleHBsaWNpdGx5IGRlZmluZWQsIHRoZW4gc3RvcmUgaXQgaW5zdGVhZC4KICAgICAgICBlbHNlIGlmICh0eXBlb2Ygc2V0dGluZ3MuY2xpY2tIYW5kbGVyID09ICJmdW5jdGlvbiIpCiAgICAgICAgewogICAgICAgICAgICAkZWxlbS5kYXRhKCJ0YXBob2xkX2NsaWNrX2hhbmRsZXIiLCBzZXR0aW5ncy5jbGlja0hhbmRsZXIpOwogICAgICAgIH0KCiAgICAgICAgLy8gUmVzZXQgdGhlIGZsYWdzCiAgICAgICAgJGVsZW0uZGF0YSgidGFwaG9sZF90cmlnZ2VyZWQiLCBmYWxzZSk7IC8vIElmIGEgaG9sZCB3YXMgdHJpZ2dlcmVkCiAgICAgICAgJGVsZW0uZGF0YSgidGFwaG9sZF9jbGlja2VkIiwgICBmYWxzZSk7IC8vIElmIGEgY2xpY2sgd2FzIHRyaWdnZXJlZAogICAgICAgICRlbGVtLmRhdGEoInRhcGhvbGRfY2FuY2VsbGVkIiwgZmFsc2UpOyAvLyBJZiBldmVudCBoYXMgYmVlbiBjYW5jZWxsZWQuCgogICAgICAgIC8vIFNldCB0aGUgdGltZXIgZm9yIHRoZSBob2xkIGV2ZW50LgogICAgICAgICRlbGVtLmRhdGEoInRhcGhvbGRfdGltZXIiLAogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gSWYgZXZlbnQgaGFzbid0IGJlZW4gY2FuY2VsbGVkL2NsaWNrZWQgYWxyZWFkeSwgdGhlbiBnbyBhaGVhZCBhbmQgdHJpZ2dlciB0aGUgaG9sZC4KICAgICAgICAgICAgICAgIGlmICghJGVsZW0uZGF0YSgidGFwaG9sZF9jYW5jZWxsZWQiKQogICAgICAgICAgICAgICAgICAgICYmICEkZWxlbS5kYXRhKCJ0YXBob2xkX2NsaWNrZWQiKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAvLyBUcmlnZ2VyIHRoZSBob2xkIGV2ZW50LCBhbmQgc2V0IHRoZSBmbGFnIHRvIHNheSBpdCdzIGJlZW4gdHJpZ2dlcmVkLgogICAgICAgICAgICAgICAgICAgICRlbGVtLnRyaWdnZXIoalF1ZXJ5LmV4dGVuZChldmVudCwgalF1ZXJ5LkV2ZW50KCJ0YXBob2xkIikpKTsKICAgICAgICAgICAgICAgICAgICAkZWxlbS5kYXRhKCJ0YXBob2xkX3RyaWdnZXJlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBzZXR0aW5ncy5kdXJhdGlvbikpOwogICAgfQoKICAgIC8vIFdoZW4gdXNlciBlbmRzIGEgdGFwIG9yIGNsaWNrLCBkZWNpZGUgd2hhdCB3ZSBzaG91bGQgZG8uCiAgICBmdW5jdGlvbiBzdG9wSGFuZGxlcihldmVudCkKICAgIHsKICAgICAgICB2YXIgJGVsZW0gPSBqUXVlcnkodGhpcyk7CgogICAgICAgIC8vIElmIHRhcGhvbGQgaGFzIGJlZW4gY2FuY2VsbGVkLCB0aGVuIHdlJ3JlIGRvbmUuCiAgICAgICAgaWYgKCRlbGVtLmRhdGEoInRhcGhvbGRfY2FuY2VsbGVkIikpIHsgcmV0dXJuOyB9CgogICAgICAgIC8vIENsZWFyIHRoZSBob2xkIHRpbWVyLiBJZiBpdCBoYXNuJ3QgYWxyZWFkeSB0cmlnZ2VyZWQsIHRoZW4gaXQncyB0b28gbGF0ZSBhbnl3YXkuCiAgICAgICAgY2xlYXJUaW1lb3V0KCRlbGVtLmRhdGEoInRhcGhvbGRfdGltZXIiKSk7CgogICAgICAgIC8vIElmIGhvbGQgd2Fzbid0IHRyaWdnZXJlZCBhbmQgbm90IGFscmVhZHkgY2xpY2tlZCwgdGhlbiB3YXMgYSBjbGljayBldmVudC4KICAgICAgICBpZiAoISRlbGVtLmRhdGEoInRhcGhvbGRfdHJpZ2dlcmVkIikKICAgICAgICAgICAgJiYgISRlbGVtLmRhdGEoInRhcGhvbGRfY2xpY2tlZCIpKQogICAgICAgIHsKICAgICAgICAgICAgLy8gSWYgY2xpY2sgaGFuZGxlciwgdHJpZ2dlciBpdC4KICAgICAgICAgICAgaWYgKHR5cGVvZiAkZWxlbS5kYXRhKCJ0YXBob2xkX2NsaWNrX2hhbmRsZXIiKSA9PSAiZnVuY3Rpb24iKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkZWxlbS5kYXRhKCJ0YXBob2xkX2NsaWNrX2hhbmRsZXIiKShqUXVlcnkuZXh0ZW5kKGV2ZW50LCBqUXVlcnkuRXZlbnQoImNsaWNrIikpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2V0IGZsYWcgdG8gc2F5IHdlJ3ZlIHRyaWdnZXJlZCB0aGUgY2xpY2sgZXZlbnQuCiAgICAgICAgICAgICRlbGVtLmRhdGEoInRhcGhvbGRfY2xpY2tlZCIsIHRydWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBJZiBhIHVzZXIgcHJlbWF0dXJlbHkgbGVhdmVzIHRoZSBib3VuZGFyeSBvZiB0aGUgb2JqZWN0IHdlJ3JlIHdvcmtpbmcgb24uCiAgICBmdW5jdGlvbiBsZWF2ZUhhbmRsZXIoZXZlbnQpCiAgICB7CiAgICAgICAgLy8gQ2FuY2VsIHRoZSBldmVudC4KICAgICAgICAkKHRoaXMpLmRhdGEoInRhcGhvbGRfY2FuY2VsbGVkIiwgdHJ1ZSk7CiAgICB9CgogICAgLy8gRGV0ZXJtaW5lIGlmIHRvdWNoIGV2ZW50cyBhcmUgc3VwcG9ydGVkLgogICAgdmFyIHRvdWNoU3VwcG9ydGVkID0gKCJvbnRvdWNoc3RhcnQiIGluIHdpbmRvdykgLy8gTW9zdCBicm93c2VycwogICAgICAgICAgICAgICAgICAgICAgICAgfHwgKCJvbm1zZ2VzdHVyZWNoYW5nZSIgaW4gd2luZG93KTsgLy8gTWlyY29zb2Z0CgogICAgdmFyIHRhcGhvbGQgPSAkLmV2ZW50LnNwZWNpYWwudGFwaG9sZCA9CiAgICB7CiAgICAgICAgc2V0dXA6IGZ1bmN0aW9uKGRhdGEpCiAgICAgICAgewogICAgICAgICAgICAkKHRoaXMpLmJpbmQoKHRvdWNoU3VwcG9ydGVkID8gInRvdWNoc3RhcnQiIDogIm1vdXNlZG93biIpLCAgZGF0YSwgc3RhcnRIYW5kbGVyKQogICAgICAgICAgICAgICAgICAgLmJpbmQoKHRvdWNoU3VwcG9ydGVkID8gInRvdWNoZW5kIiAgIDogIm1vdXNldXAiKSwgICAgc3RvcEhhbmRsZXIpCiAgICAgICAgICAgICAgICAgICAuYmluZCgodG91Y2hTdXBwb3J0ZWQgPyAidG91Y2htb3ZlIiAgOiAibW91c2VsZWF2ZSIpLCBsZWF2ZUhhbmRsZXIpOwogICAgICAgICAgICBpZih0b3VjaFN1cHBvcnRlZCkKICAgICAgICAgICAgICAgICQodGhpcykuYmluZCgidG91Y2hjYW5jZWwiLCBsZWF2ZUhhbmRsZXIpOwogICAgICAgIH0sCiAgICAgICAgdGVhcmRvd246IGZ1bmN0aW9uKG5hbWVzcGFjZXMpCiAgICAgICAgewogICAgICAgICAgICAkKHRoaXMpLnVuYmluZCgodG91Y2hTdXBwb3J0ZWQgPyAidG91Y2hzdGFydCIgOiAibW91c2Vkb3duIiksICBzdGFydEhhbmRsZXIpCiAgICAgICAgICAgICAgICAgICAudW5iaW5kKCh0b3VjaFN1cHBvcnRlZCA/ICJ0b3VjaGVuZCIgICA6ICJtb3VzZXVwIiksICAgIHN0b3BIYW5kbGVyKQogICAgICAgICAgICAgICAgICAgLnVuYmluZCgodG91Y2hTdXBwb3J0ZWQgPyAidG91Y2htb3ZlIiAgOiAibW91c2VsZWF2ZSIpLCBsZWF2ZUhhbmRsZXIpOwogICAgICAgICAgICBpZih0b3VjaFN1cHBvcnRlZCkKICAgICAgICAgICAgICAgICQodGhpcykudW5iaW5kKCJ0b3VjaGNhbmNlbCIsIGxlYXZlSGFuZGxlcik7CiAgICAgICAgfQogICAgfTsKfSkoalF1ZXJ5KTsKCn0KCgp3aW5kb3cuc2V0dXBRUkxvYWRMaWIgPSBmdW5jdGlvbigpIHsKICAoZnVuY3Rpb24ocil7ci5mbi5xcmNvZGU9ZnVuY3Rpb24oaCl7dmFyIHM7ZnVuY3Rpb24gdShhKXt0aGlzLm1vZGU9czt0aGlzLmRhdGE9YX1mdW5jdGlvbiBvKGEsYyl7dGhpcy50eXBlTnVtYmVyPWE7dGhpcy5lcnJvckNvcnJlY3RMZXZlbD1jO3RoaXMubW9kdWxlcz1udWxsO3RoaXMubW9kdWxlQ291bnQ9MDt0aGlzLmRhdGFDYWNoZT1udWxsO3RoaXMuZGF0YUxpc3Q9W119ZnVuY3Rpb24gcShhLGMpe2lmKHZvaWQgMD09YS5sZW5ndGgpdGhyb3cgRXJyb3IoYS5sZW5ndGgrIi8iK2MpO2Zvcih2YXIgZD0wO2Q8YS5sZW5ndGgmJjA9PWFbZF07KWQrKzt0aGlzLm51bT1BcnJheShhLmxlbmd0aC1kK2MpO2Zvcih2YXIgYj0wO2I8YS5sZW5ndGgtZDtiKyspdGhpcy5udW1bYl09YVtiK2RdfWZ1bmN0aW9uIHAoYSxjKXt0aGlzLnRvdGFsQ291bnQ9YTt0aGlzLmRhdGFDb3VudD1jfWZ1bmN0aW9uIHQoKXt0aGlzLmJ1ZmZlcj1bXTt0aGlzLmxlbmd0aD0wfXUucHJvdG90eXBlPXtnZXRMZW5ndGg6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kYXRhLmxlbmd0aH0sCndyaXRlOmZ1bmN0aW9uKGEpe2Zvcih2YXIgYz0wO2M8dGhpcy5kYXRhLmxlbmd0aDtjKyspYS5wdXQodGhpcy5kYXRhLmNoYXJDb2RlQXQoYyksOCl9fTtvLnByb3RvdHlwZT17YWRkRGF0YTpmdW5jdGlvbihhKXt0aGlzLmRhdGFMaXN0LnB1c2gobmV3IHUoYSkpO3RoaXMuZGF0YUNhY2hlPW51bGx9LGlzRGFyazpmdW5jdGlvbihhLGMpe2lmKDA+YXx8dGhpcy5tb2R1bGVDb3VudDw9YXx8MD5jfHx0aGlzLm1vZHVsZUNvdW50PD1jKXRocm93IEVycm9yKGErIiwiK2MpO3JldHVybiB0aGlzLm1vZHVsZXNbYV1bY119LGdldE1vZHVsZUNvdW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubW9kdWxlQ291bnR9LG1ha2U6ZnVuY3Rpb24oKXtpZigxPnRoaXMudHlwZU51bWJlcil7Zm9yKHZhciBhPTEsYT0xOzQwPmE7YSsrKXtmb3IodmFyIGM9cC5nZXRSU0Jsb2NrcyhhLHRoaXMuZXJyb3JDb3JyZWN0TGV2ZWwpLGQ9bmV3IHQsYj0wLGU9MDtlPGMubGVuZ3RoO2UrKyliKz1jW2VdLmRhdGFDb3VudDsKZm9yKGU9MDtlPHRoaXMuZGF0YUxpc3QubGVuZ3RoO2UrKyljPXRoaXMuZGF0YUxpc3RbZV0sZC5wdXQoYy5tb2RlLDQpLGQucHV0KGMuZ2V0TGVuZ3RoKCksai5nZXRMZW5ndGhJbkJpdHMoYy5tb2RlLGEpKSxjLndyaXRlKGQpO2lmKGQuZ2V0TGVuZ3RoSW5CaXRzKCk8PTgqYilicmVha310aGlzLnR5cGVOdW1iZXI9YX10aGlzLm1ha2VJbXBsKCExLHRoaXMuZ2V0QmVzdE1hc2tQYXR0ZXJuKCkpfSxtYWtlSW1wbDpmdW5jdGlvbihhLGMpe3RoaXMubW9kdWxlQ291bnQ9NCp0aGlzLnR5cGVOdW1iZXIrMTc7dGhpcy5tb2R1bGVzPUFycmF5KHRoaXMubW9kdWxlQ291bnQpO2Zvcih2YXIgZD0wO2Q8dGhpcy5tb2R1bGVDb3VudDtkKyspe3RoaXMubW9kdWxlc1tkXT1BcnJheSh0aGlzLm1vZHVsZUNvdW50KTtmb3IodmFyIGI9MDtiPHRoaXMubW9kdWxlQ291bnQ7YisrKXRoaXMubW9kdWxlc1tkXVtiXT1udWxsfXRoaXMuc2V0dXBQb3NpdGlvblByb2JlUGF0dGVybigwLDApO3RoaXMuc2V0dXBQb3NpdGlvblByb2JlUGF0dGVybih0aGlzLm1vZHVsZUNvdW50LQo3LDApO3RoaXMuc2V0dXBQb3NpdGlvblByb2JlUGF0dGVybigwLHRoaXMubW9kdWxlQ291bnQtNyk7dGhpcy5zZXR1cFBvc2l0aW9uQWRqdXN0UGF0dGVybigpO3RoaXMuc2V0dXBUaW1pbmdQYXR0ZXJuKCk7dGhpcy5zZXR1cFR5cGVJbmZvKGEsYyk7Nzw9dGhpcy50eXBlTnVtYmVyJiZ0aGlzLnNldHVwVHlwZU51bWJlcihhKTtudWxsPT10aGlzLmRhdGFDYWNoZSYmKHRoaXMuZGF0YUNhY2hlPW8uY3JlYXRlRGF0YSh0aGlzLnR5cGVOdW1iZXIsdGhpcy5lcnJvckNvcnJlY3RMZXZlbCx0aGlzLmRhdGFMaXN0KSk7dGhpcy5tYXBEYXRhKHRoaXMuZGF0YUNhY2hlLGMpfSxzZXR1cFBvc2l0aW9uUHJvYmVQYXR0ZXJuOmZ1bmN0aW9uKGEsYyl7Zm9yKHZhciBkPS0xOzc+PWQ7ZCsrKWlmKCEoLTE+PWErZHx8dGhpcy5tb2R1bGVDb3VudDw9YStkKSlmb3IodmFyIGI9LTE7Nz49YjtiKyspLTE+PWMrYnx8dGhpcy5tb2R1bGVDb3VudDw9YytifHwodGhpcy5tb2R1bGVzW2ErZF1bYytiXT0KMDw9ZCYmNj49ZCYmKDA9PWJ8fDY9PWIpfHwwPD1iJiY2Pj1iJiYoMD09ZHx8Nj09ZCl8fDI8PWQmJjQ+PWQmJjI8PWImJjQ+PWI/ITA6ITEpfSxnZXRCZXN0TWFza1BhdHRlcm46ZnVuY3Rpb24oKXtmb3IodmFyIGE9MCxjPTAsZD0wOzg+ZDtkKyspe3RoaXMubWFrZUltcGwoITAsZCk7dmFyIGI9ai5nZXRMb3N0UG9pbnQodGhpcyk7aWYoMD09ZHx8YT5iKWE9YixjPWR9cmV0dXJuIGN9LGNyZWF0ZU1vdmllQ2xpcDpmdW5jdGlvbihhLGMsZCl7YT1hLmNyZWF0ZUVtcHR5TW92aWVDbGlwKGMsZCk7dGhpcy5tYWtlKCk7Zm9yKGM9MDtjPHRoaXMubW9kdWxlcy5sZW5ndGg7YysrKWZvcih2YXIgZD0xKmMsYj0wO2I8dGhpcy5tb2R1bGVzW2NdLmxlbmd0aDtiKyspe3ZhciBlPTEqYjt0aGlzLm1vZHVsZXNbY11bYl0mJihhLmJlZ2luRmlsbCgwLDEwMCksYS5tb3ZlVG8oZSxkKSxhLmxpbmVUbyhlKzEsZCksYS5saW5lVG8oZSsxLGQrMSksYS5saW5lVG8oZSxkKzEpLGEuZW5kRmlsbCgpKX1yZXR1cm4gYX0sCnNldHVwVGltaW5nUGF0dGVybjpmdW5jdGlvbigpe2Zvcih2YXIgYT04O2E8dGhpcy5tb2R1bGVDb3VudC04O2ErKyludWxsPT10aGlzLm1vZHVsZXNbYV1bNl0mJih0aGlzLm1vZHVsZXNbYV1bNl09MD09YSUyKTtmb3IoYT04O2E8dGhpcy5tb2R1bGVDb3VudC04O2ErKyludWxsPT10aGlzLm1vZHVsZXNbNl1bYV0mJih0aGlzLm1vZHVsZXNbNl1bYV09MD09YSUyKX0sc2V0dXBQb3NpdGlvbkFkanVzdFBhdHRlcm46ZnVuY3Rpb24oKXtmb3IodmFyIGE9ai5nZXRQYXR0ZXJuUG9zaXRpb24odGhpcy50eXBlTnVtYmVyKSxjPTA7YzxhLmxlbmd0aDtjKyspZm9yKHZhciBkPTA7ZDxhLmxlbmd0aDtkKyspe3ZhciBiPWFbY10sZT1hW2RdO2lmKG51bGw9PXRoaXMubW9kdWxlc1tiXVtlXSlmb3IodmFyIGY9LTI7Mj49ZjtmKyspZm9yKHZhciBpPS0yOzI+PWk7aSsrKXRoaXMubW9kdWxlc1tiK2ZdW2UraV09LTI9PWZ8fDI9PWZ8fC0yPT1pfHwyPT1pfHwwPT1mJiYwPT1pPyEwOiExfX0sc2V0dXBUeXBlTnVtYmVyOmZ1bmN0aW9uKGEpe2Zvcih2YXIgYz0Kai5nZXRCQ0hUeXBlTnVtYmVyKHRoaXMudHlwZU51bWJlciksZD0wOzE4PmQ7ZCsrKXt2YXIgYj0hYSYmMT09KGM+PmQmMSk7dGhpcy5tb2R1bGVzW01hdGguZmxvb3IoZC8zKV1bZCUzK3RoaXMubW9kdWxlQ291bnQtOC0zXT1ifWZvcihkPTA7MTg+ZDtkKyspYj0hYSYmMT09KGM+PmQmMSksdGhpcy5tb2R1bGVzW2QlMyt0aGlzLm1vZHVsZUNvdW50LTgtM11bTWF0aC5mbG9vcihkLzMpXT1ifSxzZXR1cFR5cGVJbmZvOmZ1bmN0aW9uKGEsYyl7Zm9yKHZhciBkPWouZ2V0QkNIVHlwZUluZm8odGhpcy5lcnJvckNvcnJlY3RMZXZlbDw8M3xjKSxiPTA7MTU+YjtiKyspe3ZhciBlPSFhJiYxPT0oZD4+YiYxKTs2PmI/dGhpcy5tb2R1bGVzW2JdWzhdPWU6OD5iP3RoaXMubW9kdWxlc1tiKzFdWzhdPWU6dGhpcy5tb2R1bGVzW3RoaXMubW9kdWxlQ291bnQtMTUrYl1bOF09ZX1mb3IoYj0wOzE1PmI7YisrKWU9IWEmJjE9PShkPj5iJjEpLDg+Yj90aGlzLm1vZHVsZXNbOF1bdGhpcy5tb2R1bGVDb3VudC0KYi0xXT1lOjk+Yj90aGlzLm1vZHVsZXNbOF1bMTUtYi0xKzFdPWU6dGhpcy5tb2R1bGVzWzhdWzE1LWItMV09ZTt0aGlzLm1vZHVsZXNbdGhpcy5tb2R1bGVDb3VudC04XVs4XT0hYX0sbWFwRGF0YTpmdW5jdGlvbihhLGMpe2Zvcih2YXIgZD0tMSxiPXRoaXMubW9kdWxlQ291bnQtMSxlPTcsZj0wLGk9dGhpcy5tb2R1bGVDb3VudC0xOzA8aTtpLT0yKWZvcig2PT1pJiZpLS07Oyl7Zm9yKHZhciBnPTA7Mj5nO2crKylpZihudWxsPT10aGlzLm1vZHVsZXNbYl1baS1nXSl7dmFyIG49ITE7ZjxhLmxlbmd0aCYmKG49MT09KGFbZl0+Pj5lJjEpKTtqLmdldE1hc2soYyxiLGktZykmJihuPSFuKTt0aGlzLm1vZHVsZXNbYl1baS1nXT1uO2UtLTsgLTE9PWUmJihmKyssZT03KX1iKz1kO2lmKDA+Ynx8dGhpcy5tb2R1bGVDb3VudDw9Yil7Yi09ZDtkPS1kO2JyZWFrfX19fTtvLlBBRDA9MjM2O28uUEFEMT0xNztvLmNyZWF0ZURhdGE9ZnVuY3Rpb24oYSxjLGQpe2Zvcih2YXIgYz1wLmdldFJTQmxvY2tzKGEsCmMpLGI9bmV3IHQsZT0wO2U8ZC5sZW5ndGg7ZSsrKXt2YXIgZj1kW2VdO2IucHV0KGYubW9kZSw0KTtiLnB1dChmLmdldExlbmd0aCgpLGouZ2V0TGVuZ3RoSW5CaXRzKGYubW9kZSxhKSk7Zi53cml0ZShiKX1mb3IoZT1hPTA7ZTxjLmxlbmd0aDtlKyspYSs9Y1tlXS5kYXRhQ291bnQ7aWYoYi5nZXRMZW5ndGhJbkJpdHMoKT44KmEpdGhyb3cgRXJyb3IoImNvZGUgbGVuZ3RoIG92ZXJmbG93LiAoIitiLmdldExlbmd0aEluQml0cygpKyI+Iis4KmErIikiKTtmb3IoYi5nZXRMZW5ndGhJbkJpdHMoKSs0PD04KmEmJmIucHV0KDAsNCk7MCE9Yi5nZXRMZW5ndGhJbkJpdHMoKSU4OyliLnB1dEJpdCghMSk7Zm9yKDshKGIuZ2V0TGVuZ3RoSW5CaXRzKCk+PTgqYSk7KXtiLnB1dChvLlBBRDAsOCk7aWYoYi5nZXRMZW5ndGhJbkJpdHMoKT49OCphKWJyZWFrO2IucHV0KG8uUEFEMSw4KX1yZXR1cm4gby5jcmVhdGVCeXRlcyhiLGMpfTtvLmNyZWF0ZUJ5dGVzPWZ1bmN0aW9uKGEsYyl7Zm9yKHZhciBkPQowLGI9MCxlPTAsZj1BcnJheShjLmxlbmd0aCksaT1BcnJheShjLmxlbmd0aCksZz0wO2c8Yy5sZW5ndGg7ZysrKXt2YXIgbj1jW2ddLmRhdGFDb3VudCxoPWNbZ10udG90YWxDb3VudC1uLGI9TWF0aC5tYXgoYixuKSxlPU1hdGgubWF4KGUsaCk7ZltnXT1BcnJheShuKTtmb3IodmFyIGs9MDtrPGZbZ10ubGVuZ3RoO2srKylmW2ddW2tdPTI1NSZhLmJ1ZmZlcltrK2RdO2QrPW47az1qLmdldEVycm9yQ29ycmVjdFBvbHlub21pYWwoaCk7bj0obmV3IHEoZltnXSxrLmdldExlbmd0aCgpLTEpKS5tb2Qoayk7aVtnXT1BcnJheShrLmdldExlbmd0aCgpLTEpO2ZvcihrPTA7azxpW2ddLmxlbmd0aDtrKyspaD1rK24uZ2V0TGVuZ3RoKCktaVtnXS5sZW5ndGgsaVtnXVtrXT0wPD1oP24uZ2V0KGgpOjB9Zm9yKGs9Zz0wO2s8Yy5sZW5ndGg7aysrKWcrPWNba10udG90YWxDb3VudDtkPUFycmF5KGcpO2ZvcihrPW49MDtrPGI7aysrKWZvcihnPTA7ZzxjLmxlbmd0aDtnKyspazxmW2ddLmxlbmd0aCYmCihkW24rK109ZltnXVtrXSk7Zm9yKGs9MDtrPGU7aysrKWZvcihnPTA7ZzxjLmxlbmd0aDtnKyspazxpW2ddLmxlbmd0aCYmKGRbbisrXT1pW2ddW2tdKTtyZXR1cm4gZH07cz00O2Zvcih2YXIgaj17UEFUVEVSTl9QT1NJVElPTl9UQUJMRTpbW10sWzYsMThdLFs2LDIyXSxbNiwyNl0sWzYsMzBdLFs2LDM0XSxbNiwyMiwzOF0sWzYsMjQsNDJdLFs2LDI2LDQ2XSxbNiwyOCw1MF0sWzYsMzAsNTRdLFs2LDMyLDU4XSxbNiwzNCw2Ml0sWzYsMjYsNDYsNjZdLFs2LDI2LDQ4LDcwXSxbNiwyNiw1MCw3NF0sWzYsMzAsNTQsNzhdLFs2LDMwLDU2LDgyXSxbNiwzMCw1OCw4Nl0sWzYsMzQsNjIsOTBdLFs2LDI4LDUwLDcyLDk0XSxbNiwyNiw1MCw3NCw5OF0sWzYsMzAsNTQsNzgsMTAyXSxbNiwyOCw1NCw4MCwxMDZdLFs2LDMyLDU4LDg0LDExMF0sWzYsMzAsNTgsODYsMTE0XSxbNiwzNCw2Miw5MCwxMThdLFs2LDI2LDUwLDc0LDk4LDEyMl0sWzYsMzAsNTQsNzgsMTAyLDEyNl0sWzYsMjYsNTIsCjc4LDEwNCwxMzBdLFs2LDMwLDU2LDgyLDEwOCwxMzRdLFs2LDM0LDYwLDg2LDExMiwxMzhdLFs2LDMwLDU4LDg2LDExNCwxNDJdLFs2LDM0LDYyLDkwLDExOCwxNDZdLFs2LDMwLDU0LDc4LDEwMiwxMjYsMTUwXSxbNiwyNCw1MCw3NiwxMDIsMTI4LDE1NF0sWzYsMjgsNTQsODAsMTA2LDEzMiwxNThdLFs2LDMyLDU4LDg0LDExMCwxMzYsMTYyXSxbNiwyNiw1NCw4MiwxMTAsMTM4LDE2Nl0sWzYsMzAsNTgsODYsMTE0LDE0MiwxNzBdXSxHMTU6MTMzNSxHMTg6Nzk3MyxHMTVfTUFTSzoyMTUyMixnZXRCQ0hUeXBlSW5mbzpmdW5jdGlvbihhKXtmb3IodmFyIGM9YTw8MTA7MDw9ai5nZXRCQ0hEaWdpdChjKS1qLmdldEJDSERpZ2l0KGouRzE1KTspY149ai5HMTU8PGouZ2V0QkNIRGlnaXQoYyktai5nZXRCQ0hEaWdpdChqLkcxNSk7cmV0dXJuKGE8PDEwfGMpXmouRzE1X01BU0t9LGdldEJDSFR5cGVOdW1iZXI6ZnVuY3Rpb24oYSl7Zm9yKHZhciBjPWE8PDEyOzA8PWouZ2V0QkNIRGlnaXQoYyktCmouZ2V0QkNIRGlnaXQoai5HMTgpOyljXj1qLkcxODw8ai5nZXRCQ0hEaWdpdChjKS1qLmdldEJDSERpZ2l0KGouRzE4KTtyZXR1cm4gYTw8MTJ8Y30sZ2V0QkNIRGlnaXQ6ZnVuY3Rpb24oYSl7Zm9yKHZhciBjPTA7MCE9YTspYysrLGE+Pj49MTtyZXR1cm4gY30sZ2V0UGF0dGVyblBvc2l0aW9uOmZ1bmN0aW9uKGEpe3JldHVybiBqLlBBVFRFUk5fUE9TSVRJT05fVEFCTEVbYS0xXX0sZ2V0TWFzazpmdW5jdGlvbihhLGMsZCl7c3dpdGNoKGEpe2Nhc2UgMDpyZXR1cm4gMD09KGMrZCklMjtjYXNlIDE6cmV0dXJuIDA9PWMlMjtjYXNlIDI6cmV0dXJuIDA9PWQlMztjYXNlIDM6cmV0dXJuIDA9PShjK2QpJTM7Y2FzZSA0OnJldHVybiAwPT0oTWF0aC5mbG9vcihjLzIpK01hdGguZmxvb3IoZC8zKSklMjtjYXNlIDU6cmV0dXJuIDA9PWMqZCUyK2MqZCUzO2Nhc2UgNjpyZXR1cm4gMD09KGMqZCUyK2MqZCUzKSUyO2Nhc2UgNzpyZXR1cm4gMD09KGMqZCUzKyhjK2QpJTIpJTI7ZGVmYXVsdDp0aHJvdyBFcnJvcigiYmFkIG1hc2tQYXR0ZXJuOiIrCmEpO319LGdldEVycm9yQ29ycmVjdFBvbHlub21pYWw6ZnVuY3Rpb24oYSl7Zm9yKHZhciBjPW5ldyBxKFsxXSwwKSxkPTA7ZDxhO2QrKyljPWMubXVsdGlwbHkobmV3IHEoWzEsbC5nZXhwKGQpXSwwKSk7cmV0dXJuIGN9LGdldExlbmd0aEluQml0czpmdW5jdGlvbihhLGMpe2lmKDE8PWMmJjEwPmMpc3dpdGNoKGEpe2Nhc2UgMTpyZXR1cm4gMTA7Y2FzZSAyOnJldHVybiA5O2Nhc2UgczpyZXR1cm4gODtjYXNlIDg6cmV0dXJuIDg7ZGVmYXVsdDp0aHJvdyBFcnJvcigibW9kZToiK2EpO31lbHNlIGlmKDI3PmMpc3dpdGNoKGEpe2Nhc2UgMTpyZXR1cm4gMTI7Y2FzZSAyOnJldHVybiAxMTtjYXNlIHM6cmV0dXJuIDE2O2Nhc2UgODpyZXR1cm4gMTA7ZGVmYXVsdDp0aHJvdyBFcnJvcigibW9kZToiK2EpO31lbHNlIGlmKDQxPmMpc3dpdGNoKGEpe2Nhc2UgMTpyZXR1cm4gMTQ7Y2FzZSAyOnJldHVybiAxMztjYXNlIHM6cmV0dXJuIDE2O2Nhc2UgODpyZXR1cm4gMTI7ZGVmYXVsdDp0aHJvdyBFcnJvcigibW9kZToiKwphKTt9ZWxzZSB0aHJvdyBFcnJvcigidHlwZToiK2MpO30sZ2V0TG9zdFBvaW50OmZ1bmN0aW9uKGEpe2Zvcih2YXIgYz1hLmdldE1vZHVsZUNvdW50KCksZD0wLGI9MDtiPGM7YisrKWZvcih2YXIgZT0wO2U8YztlKyspe2Zvcih2YXIgZj0wLGk9YS5pc0RhcmsoYixlKSxnPS0xOzE+PWc7ZysrKWlmKCEoMD5iK2d8fGM8PWIrZykpZm9yKHZhciBoPS0xOzE+PWg7aCsrKTA+ZStofHxjPD1lK2h8fDA9PWcmJjA9PWh8fGk9PWEuaXNEYXJrKGIrZyxlK2gpJiZmKys7NTxmJiYoZCs9MytmLTUpfWZvcihiPTA7YjxjLTE7YisrKWZvcihlPTA7ZTxjLTE7ZSsrKWlmKGY9MCxhLmlzRGFyayhiLGUpJiZmKyssYS5pc0RhcmsoYisxLGUpJiZmKyssYS5pc0RhcmsoYixlKzEpJiZmKyssYS5pc0RhcmsoYisxLGUrMSkmJmYrKywwPT1mfHw0PT1mKWQrPTM7Zm9yKGI9MDtiPGM7YisrKWZvcihlPTA7ZTxjLTY7ZSsrKWEuaXNEYXJrKGIsZSkmJiFhLmlzRGFyayhiLGUrMSkmJmEuaXNEYXJrKGIsZSsKMikmJmEuaXNEYXJrKGIsZSszKSYmYS5pc0RhcmsoYixlKzQpJiYhYS5pc0RhcmsoYixlKzUpJiZhLmlzRGFyayhiLGUrNikmJihkKz00MCk7Zm9yKGU9MDtlPGM7ZSsrKWZvcihiPTA7YjxjLTY7YisrKWEuaXNEYXJrKGIsZSkmJiFhLmlzRGFyayhiKzEsZSkmJmEuaXNEYXJrKGIrMixlKSYmYS5pc0RhcmsoYiszLGUpJiZhLmlzRGFyayhiKzQsZSkmJiFhLmlzRGFyayhiKzUsZSkmJmEuaXNEYXJrKGIrNixlKSYmKGQrPTQwKTtmb3IoZT1mPTA7ZTxjO2UrKylmb3IoYj0wO2I8YztiKyspYS5pc0RhcmsoYixlKSYmZisrO2E9TWF0aC5hYnMoMTAwKmYvYy9jLTUwKS81O3JldHVybiBkKzEwKmF9fSxsPXtnbG9nOmZ1bmN0aW9uKGEpe2lmKDE+YSl0aHJvdyBFcnJvcigiZ2xvZygiK2ErIikiKTtyZXR1cm4gbC5MT0dfVEFCTEVbYV19LGdleHA6ZnVuY3Rpb24oYSl7Zm9yKDswPmE7KWErPTI1NTtmb3IoOzI1Njw9YTspYS09MjU1O3JldHVybiBsLkVYUF9UQUJMRVthXX0sRVhQX1RBQkxFOkFycmF5KDI1NiksCkxPR19UQUJMRTpBcnJheSgyNTYpfSxtPTA7OD5tO20rKylsLkVYUF9UQUJMRVttXT0xPDxtO2ZvcihtPTg7MjU2Pm07bSsrKWwuRVhQX1RBQkxFW21dPWwuRVhQX1RBQkxFW20tNF1ebC5FWFBfVEFCTEVbbS01XV5sLkVYUF9UQUJMRVttLTZdXmwuRVhQX1RBQkxFW20tOF07Zm9yKG09MDsyNTU+bTttKyspbC5MT0dfVEFCTEVbbC5FWFBfVEFCTEVbbV1dPW07cS5wcm90b3R5cGU9e2dldDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5udW1bYV19LGdldExlbmd0aDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm51bS5sZW5ndGh9LG11bHRpcGx5OmZ1bmN0aW9uKGEpe2Zvcih2YXIgYz1BcnJheSh0aGlzLmdldExlbmd0aCgpK2EuZ2V0TGVuZ3RoKCktMSksZD0wO2Q8dGhpcy5nZXRMZW5ndGgoKTtkKyspZm9yKHZhciBiPTA7YjxhLmdldExlbmd0aCgpO2IrKyljW2QrYl1ePWwuZ2V4cChsLmdsb2codGhpcy5nZXQoZCkpK2wuZ2xvZyhhLmdldChiKSkpO3JldHVybiBuZXcgcShjLDApfSxtb2Q6ZnVuY3Rpb24oYSl7aWYoMD4KdGhpcy5nZXRMZW5ndGgoKS1hLmdldExlbmd0aCgpKXJldHVybiB0aGlzO2Zvcih2YXIgYz1sLmdsb2codGhpcy5nZXQoMCkpLWwuZ2xvZyhhLmdldCgwKSksZD1BcnJheSh0aGlzLmdldExlbmd0aCgpKSxiPTA7Yjx0aGlzLmdldExlbmd0aCgpO2IrKylkW2JdPXRoaXMuZ2V0KGIpO2ZvcihiPTA7YjxhLmdldExlbmd0aCgpO2IrKylkW2JdXj1sLmdleHAobC5nbG9nKGEuZ2V0KGIpKStjKTtyZXR1cm4obmV3IHEoZCwwKSkubW9kKGEpfX07cC5SU19CTE9DS19UQUJMRT1bWzEsMjYsMTldLFsxLDI2LDE2XSxbMSwyNiwxM10sWzEsMjYsOV0sWzEsNDQsMzRdLFsxLDQ0LDI4XSxbMSw0NCwyMl0sWzEsNDQsMTZdLFsxLDcwLDU1XSxbMSw3MCw0NF0sWzIsMzUsMTddLFsyLDM1LDEzXSxbMSwxMDAsODBdLFsyLDUwLDMyXSxbMiw1MCwyNF0sWzQsMjUsOV0sWzEsMTM0LDEwOF0sWzIsNjcsNDNdLFsyLDMzLDE1LDIsMzQsMTZdLFsyLDMzLDExLDIsMzQsMTJdLFsyLDg2LDY4XSxbNCw0MywyN10sCls0LDQzLDE5XSxbNCw0MywxNV0sWzIsOTgsNzhdLFs0LDQ5LDMxXSxbMiwzMiwxNCw0LDMzLDE1XSxbNCwzOSwxMywxLDQwLDE0XSxbMiwxMjEsOTddLFsyLDYwLDM4LDIsNjEsMzldLFs0LDQwLDE4LDIsNDEsMTldLFs0LDQwLDE0LDIsNDEsMTVdLFsyLDE0NiwxMTZdLFszLDU4LDM2LDIsNTksMzddLFs0LDM2LDE2LDQsMzcsMTddLFs0LDM2LDEyLDQsMzcsMTNdLFsyLDg2LDY4LDIsODcsNjldLFs0LDY5LDQzLDEsNzAsNDRdLFs2LDQzLDE5LDIsNDQsMjBdLFs2LDQzLDE1LDIsNDQsMTZdLFs0LDEwMSw4MV0sWzEsODAsNTAsNCw4MSw1MV0sWzQsNTAsMjIsNCw1MSwyM10sWzMsMzYsMTIsOCwzNywxM10sWzIsMTE2LDkyLDIsMTE3LDkzXSxbNiw1OCwzNiwyLDU5LDM3XSxbNCw0NiwyMCw2LDQ3LDIxXSxbNyw0MiwxNCw0LDQzLDE1XSxbNCwxMzMsMTA3XSxbOCw1OSwzNywxLDYwLDM4XSxbOCw0NCwyMCw0LDQ1LDIxXSxbMTIsMzMsMTEsNCwzNCwxMl0sWzMsMTQ1LDExNSwxLDE0NiwKMTE2XSxbNCw2NCw0MCw1LDY1LDQxXSxbMTEsMzYsMTYsNSwzNywxN10sWzExLDM2LDEyLDUsMzcsMTNdLFs1LDEwOSw4NywxLDExMCw4OF0sWzUsNjUsNDEsNSw2Niw0Ml0sWzUsNTQsMjQsNyw1NSwyNV0sWzExLDM2LDEyXSxbNSwxMjIsOTgsMSwxMjMsOTldLFs3LDczLDQ1LDMsNzQsNDZdLFsxNSw0MywxOSwyLDQ0LDIwXSxbMyw0NSwxNSwxMyw0NiwxNl0sWzEsMTM1LDEwNyw1LDEzNiwxMDhdLFsxMCw3NCw0NiwxLDc1LDQ3XSxbMSw1MCwyMiwxNSw1MSwyM10sWzIsNDIsMTQsMTcsNDMsMTVdLFs1LDE1MCwxMjAsMSwxNTEsMTIxXSxbOSw2OSw0Myw0LDcwLDQ0XSxbMTcsNTAsMjIsMSw1MSwyM10sWzIsNDIsMTQsMTksNDMsMTVdLFszLDE0MSwxMTMsNCwxNDIsMTE0XSxbMyw3MCw0NCwxMSw3MSw0NV0sWzE3LDQ3LDIxLDQsNDgsMjJdLFs5LDM5LDEzLDE2LDQwLDE0XSxbMywxMzUsMTA3LDUsMTM2LDEwOF0sWzMsNjcsNDEsMTMsNjgsNDJdLFsxNSw1NCwyNCw1LDU1LDI1XSxbMTUsCjQzLDE1LDEwLDQ0LDE2XSxbNCwxNDQsMTE2LDQsMTQ1LDExN10sWzE3LDY4LDQyXSxbMTcsNTAsMjIsNiw1MSwyM10sWzE5LDQ2LDE2LDYsNDcsMTddLFsyLDEzOSwxMTEsNywxNDAsMTEyXSxbMTcsNzQsNDZdLFs3LDU0LDI0LDE2LDU1LDI1XSxbMzQsMzcsMTNdLFs0LDE1MSwxMjEsNSwxNTIsMTIyXSxbNCw3NSw0NywxNCw3Niw0OF0sWzExLDU0LDI0LDE0LDU1LDI1XSxbMTYsNDUsMTUsMTQsNDYsMTZdLFs2LDE0NywxMTcsNCwxNDgsMTE4XSxbNiw3Myw0NSwxNCw3NCw0Nl0sWzExLDU0LDI0LDE2LDU1LDI1XSxbMzAsNDYsMTYsMiw0NywxN10sWzgsMTMyLDEwNiw0LDEzMywxMDddLFs4LDc1LDQ3LDEzLDc2LDQ4XSxbNyw1NCwyNCwyMiw1NSwyNV0sWzIyLDQ1LDE1LDEzLDQ2LDE2XSxbMTAsMTQyLDExNCwyLDE0MywxMTVdLFsxOSw3NCw0Niw0LDc1LDQ3XSxbMjgsNTAsMjIsNiw1MSwyM10sWzMzLDQ2LDE2LDQsNDcsMTddLFs4LDE1MiwxMjIsNCwxNTMsMTIzXSxbMjIsNzMsNDUsCjMsNzQsNDZdLFs4LDUzLDIzLDI2LDU0LDI0XSxbMTIsNDUsMTUsMjgsNDYsMTZdLFszLDE0NywxMTcsMTAsMTQ4LDExOF0sWzMsNzMsNDUsMjMsNzQsNDZdLFs0LDU0LDI0LDMxLDU1LDI1XSxbMTEsNDUsMTUsMzEsNDYsMTZdLFs3LDE0NiwxMTYsNywxNDcsMTE3XSxbMjEsNzMsNDUsNyw3NCw0Nl0sWzEsNTMsMjMsMzcsNTQsMjRdLFsxOSw0NSwxNSwyNiw0NiwxNl0sWzUsMTQ1LDExNSwxMCwxNDYsMTE2XSxbMTksNzUsNDcsMTAsNzYsNDhdLFsxNSw1NCwyNCwyNSw1NSwyNV0sWzIzLDQ1LDE1LDI1LDQ2LDE2XSxbMTMsMTQ1LDExNSwzLDE0NiwxMTZdLFsyLDc0LDQ2LDI5LDc1LDQ3XSxbNDIsNTQsMjQsMSw1NSwyNV0sWzIzLDQ1LDE1LDI4LDQ2LDE2XSxbMTcsMTQ1LDExNV0sWzEwLDc0LDQ2LDIzLDc1LDQ3XSxbMTAsNTQsMjQsMzUsNTUsMjVdLFsxOSw0NSwxNSwzNSw0NiwxNl0sWzE3LDE0NSwxMTUsMSwxNDYsMTE2XSxbMTQsNzQsNDYsMjEsNzUsNDddLFsyOSw1NCwyNCwxOSwKNTUsMjVdLFsxMSw0NSwxNSw0Niw0NiwxNl0sWzEzLDE0NSwxMTUsNiwxNDYsMTE2XSxbMTQsNzQsNDYsMjMsNzUsNDddLFs0NCw1NCwyNCw3LDU1LDI1XSxbNTksNDYsMTYsMSw0NywxN10sWzEyLDE1MSwxMjEsNywxNTIsMTIyXSxbMTIsNzUsNDcsMjYsNzYsNDhdLFszOSw1NCwyNCwxNCw1NSwyNV0sWzIyLDQ1LDE1LDQxLDQ2LDE2XSxbNiwxNTEsMTIxLDE0LDE1MiwxMjJdLFs2LDc1LDQ3LDM0LDc2LDQ4XSxbNDYsNTQsMjQsMTAsNTUsMjVdLFsyLDQ1LDE1LDY0LDQ2LDE2XSxbMTcsMTUyLDEyMiw0LDE1MywxMjNdLFsyOSw3NCw0NiwxNCw3NSw0N10sWzQ5LDU0LDI0LDEwLDU1LDI1XSxbMjQsNDUsMTUsNDYsNDYsMTZdLFs0LDE1MiwxMjIsMTgsMTUzLDEyM10sWzEzLDc0LDQ2LDMyLDc1LDQ3XSxbNDgsNTQsMjQsMTQsNTUsMjVdLFs0Miw0NSwxNSwzMiw0NiwxNl0sWzIwLDE0NywxMTcsNCwxNDgsMTE4XSxbNDAsNzUsNDcsNyw3Niw0OF0sWzQzLDU0LDI0LDIyLDU1LDI1XSxbMTAsCjQ1LDE1LDY3LDQ2LDE2XSxbMTksMTQ4LDExOCw2LDE0OSwxMTldLFsxOCw3NSw0NywzMSw3Niw0OF0sWzM0LDU0LDI0LDM0LDU1LDI1XSxbMjAsNDUsMTUsNjEsNDYsMTZdXTtwLmdldFJTQmxvY2tzPWZ1bmN0aW9uKGEsYyl7dmFyIGQ9cC5nZXRSc0Jsb2NrVGFibGUoYSxjKTtpZih2b2lkIDA9PWQpdGhyb3cgRXJyb3IoImJhZCBycyBibG9jayBAIHR5cGVOdW1iZXI6IithKyIvZXJyb3JDb3JyZWN0TGV2ZWw6IitjKTtmb3IodmFyIGI9ZC5sZW5ndGgvMyxlPVtdLGY9MDtmPGI7ZisrKWZvcih2YXIgaD1kWzMqZiswXSxnPWRbMypmKzFdLGo9ZFszKmYrMl0sbD0wO2w8aDtsKyspZS5wdXNoKG5ldyBwKGcsaikpO3JldHVybiBlfTtwLmdldFJzQmxvY2tUYWJsZT1mdW5jdGlvbihhLGMpe3N3aXRjaChjKXtjYXNlIDE6cmV0dXJuIHAuUlNfQkxPQ0tfVEFCTEVbNCooYS0xKSswXTtjYXNlIDA6cmV0dXJuIHAuUlNfQkxPQ0tfVEFCTEVbNCooYS0xKSsxXTtjYXNlIDM6cmV0dXJuIHAuUlNfQkxPQ0tfVEFCTEVbNCoKKGEtMSkrMl07Y2FzZSAyOnJldHVybiBwLlJTX0JMT0NLX1RBQkxFWzQqKGEtMSkrM119fTt0LnByb3RvdHlwZT17Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiAxPT0odGhpcy5idWZmZXJbTWF0aC5mbG9vcihhLzgpXT4+PjctYSU4JjEpfSxwdXQ6ZnVuY3Rpb24oYSxjKXtmb3IodmFyIGQ9MDtkPGM7ZCsrKXRoaXMucHV0Qml0KDE9PShhPj4+Yy1kLTEmMSkpfSxnZXRMZW5ndGhJbkJpdHM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5sZW5ndGh9LHB1dEJpdDpmdW5jdGlvbihhKXt2YXIgYz1NYXRoLmZsb29yKHRoaXMubGVuZ3RoLzgpO3RoaXMuYnVmZmVyLmxlbmd0aDw9YyYmdGhpcy5idWZmZXIucHVzaCgwKTthJiYodGhpcy5idWZmZXJbY118PTEyOD4+PnRoaXMubGVuZ3RoJTgpO3RoaXMubGVuZ3RoKyt9fTsic3RyaW5nIj09PXR5cGVvZiBoJiYoaD17dGV4dDpofSk7aD1yLmV4dGVuZCh7fSx7cmVuZGVyOiJjYW52YXMiLHdpZHRoOjI1NixoZWlnaHQ6MjU2LHR5cGVOdW1iZXI6LTEsCmNvcnJlY3RMZXZlbDoyLGJhY2tncm91bmQ6IiNmZmZmZmYiLGZvcmVncm91bmQ6IiMwMDAwMDAifSxoKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGE7aWYoImNhbnZhcyI9PWgucmVuZGVyKXthPW5ldyBvKGgudHlwZU51bWJlcixoLmNvcnJlY3RMZXZlbCk7YS5hZGREYXRhKGgudGV4dCk7YS5tYWtlKCk7dmFyIGM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7Yy53aWR0aD1oLndpZHRoO2MuaGVpZ2h0PWguaGVpZ2h0O2Zvcih2YXIgZD1jLmdldENvbnRleHQoIjJkIiksYj1oLndpZHRoL2EuZ2V0TW9kdWxlQ291bnQoKSxlPWguaGVpZ2h0L2EuZ2V0TW9kdWxlQ291bnQoKSxmPTA7ZjxhLmdldE1vZHVsZUNvdW50KCk7ZisrKWZvcih2YXIgaT0wO2k8YS5nZXRNb2R1bGVDb3VudCgpO2krKyl7ZC5maWxsU3R5bGU9YS5pc0RhcmsoZixpKT9oLmZvcmVncm91bmQ6aC5iYWNrZ3JvdW5kO3ZhciBnPU1hdGguY2VpbCgoaSsxKSpiKS1NYXRoLmZsb29yKGkqYiksCmo9TWF0aC5jZWlsKChmKzEpKmIpLU1hdGguZmxvb3IoZipiKTtkLmZpbGxSZWN0KE1hdGgucm91bmQoaSpiKSxNYXRoLnJvdW5kKGYqZSksZyxqKX19ZWxzZXthPW5ldyBvKGgudHlwZU51bWJlcixoLmNvcnJlY3RMZXZlbCk7YS5hZGREYXRhKGgudGV4dCk7YS5tYWtlKCk7Yz1yKCI8dGFibGU+PC90YWJsZT4iKS5jc3MoIndpZHRoIixoLndpZHRoKyJweCIpLmNzcygiaGVpZ2h0IixoLmhlaWdodCsicHgiKS5jc3MoImJvcmRlciIsIjBweCIpLmNzcygiYm9yZGVyLWNvbGxhcHNlIiwiY29sbGFwc2UiKS5jc3MoImJhY2tncm91bmQtY29sb3IiLGguYmFja2dyb3VuZCk7ZD1oLndpZHRoL2EuZ2V0TW9kdWxlQ291bnQoKTtiPWguaGVpZ2h0L2EuZ2V0TW9kdWxlQ291bnQoKTtmb3IoZT0wO2U8YS5nZXRNb2R1bGVDb3VudCgpO2UrKyl7Zj1yKCI8dHI+PC90cj4iKS5jc3MoImhlaWdodCIsYisicHgiKS5hcHBlbmRUbyhjKTtmb3IoaT0wO2k8YS5nZXRNb2R1bGVDb3VudCgpO2krKylyKCI8dGQ+PC90ZD4iKS5jc3MoIndpZHRoIiwKZCsicHgiKS5jc3MoImJhY2tncm91bmQtY29sb3IiLGEuaXNEYXJrKGUsaSk/aC5mb3JlZ3JvdW5kOmguYmFja2dyb3VuZCkuYXBwZW5kVG8oZil9fWE9YztqUXVlcnkoYSkuYXBwZW5kVG8odGhpcyl9KX19KShqUXVlcnkpOwoKfQoKd2luZG93LnNldHVwTGF5ZXJDaG9vc2VyQXBpID0gZnVuY3Rpb24oKSB7CiAgLy8gaGlkZSBsYXllciBjaG9vc2VyIGlmIGJvb3RlZCB3aXRoIHRoZSBpaXRjbSBhbmRyb2lkIGFwcAogIGlmICh0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCAmJiBhbmRyb2lkLnNldExheWVycykgewogICAgJCgnLmxlYWZsZXQtY29udHJvbC1sYXllcnMnKS5oaWRlKCk7CiAgfQoKICAvL2hvb2sgc29tZSBhZGRpdGlvbmFsIGNvZGUgaW50byB0aGUgTGF5ZXJDb250cm9sIHNvIGl0J3MgZWFzeSBmb3IgdGhlIG1vYmlsZSBhcHAgdG8gaW50ZXJmYWNlIHdpdGggaXQKICAvL1dBUk5JTkc6IGRvZXMgZGVwZW5kIG9uIGludGVybmFscyBvZiB0aGUgTC5Db250cm9sLkxheWVycyBjb2RlCiAgd2luZG93LmxheWVyQ2hvb3Nlci5nZXRMYXllcnMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBiYXNlTGF5ZXJzID0gbmV3IEFycmF5KCk7CiAgICB2YXIgb3ZlcmxheUxheWVycyA9IG5ldyBBcnJheSgpOwoKICAgIGZvciAoaSBpbiB0aGlzLl9sYXllcnMpIHsKICAgICAgdmFyIG9iaiA9IHRoaXMuX2xheWVyc1tpXTsKICAgICAgdmFyIGxheWVyQWN0aXZlID0gd2luZG93Lm1hcC5oYXNMYXllcihvYmoubGF5ZXIpOwogICAgICB2YXIgaW5mbyA9IHsKICAgICAgICBsYXllcklkOiBMLnN0YW1wKG9iai5sYXllciksCiAgICAgICAgbmFtZTogb2JqLm5hbWUsCiAgICAgICAgYWN0aXZlOiBsYXllckFjdGl2ZQogICAgICB9CiAgICAgIGlmIChvYmoub3ZlcmxheSkgewogICAgICAgIG92ZXJsYXlMYXllcnMucHVzaChpbmZvKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBiYXNlTGF5ZXJzLnB1c2goaW5mbyk7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgb3ZlcmxheUxheWVyc0pTT04gPSBKU09OLnN0cmluZ2lmeShvdmVybGF5TGF5ZXJzKTsKICAgIHZhciBiYXNlTGF5ZXJzSlNPTiA9IEpTT04uc3RyaW5naWZ5KGJhc2VMYXllcnMpOwoKICAgIGlmICh0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCAmJiBhbmRyb2lkLnNldExheWVycykgewogICAgICAgIGFuZHJvaWQuc2V0TGF5ZXJzKGJhc2VMYXllcnNKU09OLCBvdmVybGF5TGF5ZXJzSlNPTik7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgYmFzZUxheWVyczogYmFzZUxheWVycywKICAgICAgb3ZlcmxheUxheWVyczogb3ZlcmxheUxheWVycwogICAgfQogIH0KCiAgd2luZG93LmxheWVyQ2hvb3Nlci5zaG93TGF5ZXIgPSBmdW5jdGlvbihpZCxzaG93KSB7CiAgICBpZiAoc2hvdyA9PT0gdW5kZWZpbmVkKSBzaG93ID0gdHJ1ZTsKICAgIG9iaiA9IHRoaXMuX2xheWVyc1tpZF07CiAgICBpZiAoIW9iaikgcmV0dXJuIGZhbHNlOwoKICAgIGlmKHNob3cpIHsKICAgICAgaWYgKCF0aGlzLl9tYXAuaGFzTGF5ZXIob2JqLmxheWVyKSkgewogICAgICAgIC8vdGhlIGxheWVyIHRvIHNob3cgaXMgbm90IGN1cnJlbnRseSBhY3RpdmUKICAgICAgICB0aGlzLl9tYXAuYWRkTGF5ZXIob2JqLmxheWVyKTsKCiAgICAgICAgLy9pZiBpdCdzIGEgYmFzZSBsYXllciwgcmVtb3ZlIGFueSBvdGhlcnMKICAgICAgICBpZiAoIW9iai5vdmVybGF5KSB7CiAgICAgICAgICBmb3IoaSBpbiB0aGlzLl9sYXllcnMpIHsKICAgICAgICAgICAgaWYgKGkgIT0gaWQpIHsKICAgICAgICAgICAgICB2YXIgb3RoZXIgPSB0aGlzLl9sYXllcnNbaV07CiAgICAgICAgICAgICAgaWYgKCFvdGhlci5vdmVybGF5ICYmIHRoaXMuX21hcC5oYXNMYXllcihvdGhlci5sYXllcikpIHRoaXMuX21hcC5yZW1vdmVMYXllcihvdGhlci5sYXllcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmICh0aGlzLl9tYXAuaGFzTGF5ZXIob2JqLmxheWVyKSkgewogICAgICAgIHRoaXMuX21hcC5yZW1vdmVMYXllcihvYmoubGF5ZXIpOwogICAgICB9CiAgICB9CgogICAgLy9iZWxvdyBsb2dpYyBiYXNlZCBvbiBjb2RlIGluIEwuQ29udHJvbC5MYXllcnMgX29uSW5wdXRDbGljawogICAgaWYoIW9iai5vdmVybGF5KSB7CiAgICAgIHRoaXMuX21hcC5zZXRab29tKHRoaXMuX21hcC5nZXRab29tKCkpOwogICAgICB0aGlzLl9tYXAuZmlyZSgnYmFzZWxheWVyY2hhbmdlJywge2xheWVyOiBvYmoubGF5ZXJ9KTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCi8vIEJPT1RJTkcgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCmZ1bmN0aW9uIGJvb3QoKSB7CiAgaWYoIWlzU21hcnRwaG9uZSgpKSAvLyBUT0RPIHJlbW92ZSBjb21wbGV0ZWx5PwogICAgd2luZG93LmRlYnVnLmNvbnNvbGUub3ZlcndyaXRlTmF0aXZlSWZSZXF1aXJlZCgpOwoKICBjb25zb2xlLmxvZygnbG9hZGluZyBkb25lLCBib290aW5nLiBCdWlsdDogMjAxNi0xMC0wMy0wMDQ3NDAnKTsKICBpZih3aW5kb3cuZGV2aWNlSUQpIGNvbnNvbGUubG9nKCdZb3VyIGRldmljZSBJRDogJyArIHdpbmRvdy5kZXZpY2VJRCk7CiAgd2luZG93LnJ1bk9uU21hcnRwaG9uZXNCZWZvcmVCb290KCk7CgogIHZhciBpY29uRGVmSW1hZ2UgPSAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCa0FBQUFwQ0FZQUFBREFrNExPQUFBQUNYQklXWE1BQUFzVEFBQUxFd0VBbXB3WUFBQUFJR05JVWswQUFIb2xBQUNBZ3dBQStmOEFBSURwQUFCMU1BQUE2bUFBQURxWUFBQVhiNUpmeFVZQUFBb2NTVVJCVkhqYW5OUmJVRk4zSGdmd3Y5UGR6dTVzWjdjUDNkMWVwclA3c0MvYlB2U2xzOU1tQjVDTGNnMklJQWhTV3dTOHJGcXJwYlZidTNWZGQyb3YwNHFKZ0dCRVNBSkpDT1IyQWlGY0VwS1Qrd2toaUlpQ29DSktrUWhDSUVnRXZ2c1FjYW9WZGZmaE0rZk1PZi8vLzN2KzUvYzdoOFM4bGs2NGYwd2tINy85TFpHbnNVU2N6QkJSRWtORVNSYWllTTlKT2c2Zkp6VUpsamNrUEdhamhNZnNGNmRZam9sVExNVjE2YlpNeFJiblcyS2VoVWhTR1NKS3RCQmx2cHRJTSsya0p0NUNSSWtXSWtsamlDU1ZJV1MxRUhFeVE2U1p0cmRWQmU1am9tUkxkMTI2ZFZhNnliWlluK09BYkpOOXFTN2RPaWRKWXk2SWtpM2ZTM2dNNS84SitiTW8wVkpabTJwZGFIalBpYVo5WHJSK2RnNnRuNTlEMjZGZXRCMDZoOVovbkVQenZtNG90N2xSbDI1ZHJJNDNWemQrNFByTE00V0lrcGpJbWtSbVdKSG5Ra3R4RDlvKzcwWExKejdvOW5XRDN1TUZ2ZHNMZW84WHVnKzdvUy8yM2IvZmc0YjNYQkNsTU5mRnlVeDhUZUlqSVd0ZlRTUHYvaUdlSEhqN0d5TG5zZW5pSkdaR3M4T0R0a085YVA2b0c5cWRYZERzOEVDM3g0cys1U2p1ak16aEluMERUZnU2b2RuaGdYWm5GNW8rNmtiYm9WNW9kblpCbE1RRWF4SXN1UStGSkx5K21VUy90b0Y4OHZiM2Y1TWx1KzlvZDNYQmNQQWN0RHU3b0M3MFFGM2tnYlAwTXU1Y0QyTE92NERGaFNYTStSY3djM01lYk1VUTFFVWVxQXM5ME93TXo2TjNlMUdUWUprVkpWb29TU3BEYWxOdGhGVEV0SktLbU5iZm5vbnJ1S0RheHNKd3NBZnE3UjZvQ2xtWWpsN0FyYjVwM0oyNWh6N2xLRm8vNzhYc3Jic3dIdTdET2VrSTVxZENtTGc0QS9PeGZxZ0tXYWkzZTJENHRBZktBamVxMTVzSHF0ZWJmM2M2cm8yUW1uVU1xWTYxSEpKdXRNUHdhUTgwT3p6UTcvZGhxR01jOTRLTHVPNjhqZGJQemtGVndFSi93SWZRM0NMYUR2VkNWY0RDOEdrUHJqSVR1QmRjeEJYekxiUVU5endJa21VNFVMSFc4R1g4NjltRW5JMHovLzVzbkhsY3U2c0x1cjFldU11SE1IdnJMdndEQVppLzdvZHlteHZLZkJiS2ZCYTZ2ZDBZODkyQi91TWVLTGV4WWZuM2Q5dy9qVG4vQXJxRXc5RHQ5WUwrdXhmQ0dPUEUvcmUrZTVsVXhYVG1TVkt0MEI4SXQrUDBhQkNEaGgraEttU2h6SGREWGNoQ3M5MEQ3WTR3ZWxmWGczUE5kZzgwUlI0MDVydWhLbVRScjcyQjZkRWdsTnZjYUQ3Z1EyMmFGZUk0eDFaeUpzb2tWdVE1b2R2cmhTTFBoZHVEQWRpT0Q2RDluK0gzSHhpYngvUm9FSlBEczVnZURXTDZlaERUbzBGTVhabkY5UFVnQW1Qem1QTXZ3SFQwQXN4ZjljTS9HSUFpendYZFhpOGE4cHc0RTJXU0VHR1V5YWtxWUtIWjRZRmlTempFWFg0WmpWdGRHRDgvRFFCWXVyZU1QdVVvVEVmNllEeDhIcVlqZmVpVmorRGUzU1VBZ0g4d2dNYjMzYkFmSDhEdHdRQVVXMXpRYlBkQVZjQkNHR1YwRStGYTQxWDEvUXNOdWVFUXRud0lEVnRjYVAvaVBFTDNpeDhZbThjMTZ3U01oL3N3YkJ6SDdQaGRqRGo4dURlL0NOTy9MMENSNTRLalpCQzNCd05veUhWQlZSRHVOdUZhNHpVaVhHdThvZG51Z1RMZkRmbG1CL3lEQWJqS0xrT1I2NFFpMTRtaGpuR01zcFBRZmRpTlVkZHRMQzh0NDZaM0N2cjlQbHhsSmpCaTgwT1I2MFI5amhPMjQ1ZmdId3hBdnRrQlpiNGJtbkRJRFZJWjJlNXV6SGREdWMwTldiWUQvb0Z3U1AxbUIrUTVUcWlMV0N3RTdzSHl6VVUwNUxrd1B4V0N1c2dENCtFK2hJS0xvSGQ3SWM5eFFyN1pBZHNQbCtBZkNFQ1c3WUF5bjBYakIyNVVScmF6cEp3eXlHVFpkcWlMUEpCdXNzTS9HSUM5WkFDeWJEdE1SL3FnTC9iQlczTUZNemVDME8zMUlqQTJqK2I5UGt3T3o2SzNmZ1JOSDNhajh6OFhJTTkyZ1BuNkl2d0RBVWczaGRlVFpkdFJUclUya05QUjdYdXFrenFoMmQ0RldaWWRFLzB6OEltdllrQS9oc1c3UzNDZkdvSXMyNDZwYTNNWU5Qd0kvMkFBZy9veHpJd0dVWi9qaFAzNEFFTEJSUXgxak1OYmRRVVQvVE9RWmRtaDJkR0Y2cVJPbkk1cDMwZktJL1IvcllocURha0tXTlRuT25IN2NnQUFNTXBPb3FXNEI5Sk1PMlNaZHBpLzZzZnkwakpDd1VVQWdPMkhTNUJ0c2tPYWFZZCt2dzhqZGord0RFeGVtVVY5cmhQcUFoYW5vZ3loOGdqRG02U01hbDV6a3FOcnJjdGtvTXhuNGF1OWhxWFFFaTYzL3dobGdSdlNEQnZxTnRvaHpiQmh4T0VIQU56c25vSTB3LzZBOGdNM0xqWGR4UExTTW5ybEkxQnRZMUdid2VEa3U3cVc4Z2o5R2xJV29TY0NMcDFURVd1QXFzQURhWVlOK21JZnhucW1FSnhjZ0U5OEZmVTVUdFNsMjlDMHJ4dnpkMEl3SE94QjNVWWJaRmwyZEZWZHdaeC9BZVBucDJFNDJBTnBwZzNxUWc4cVl3M2djK2lNazVTT2tCTWNOU25ocUY4UWNPZ2hlWTREaWkxT2lIa01KS2tNTE4vMDQ4N0lIS2F1emNGOHJCKzFHNnpRN2U1QzNRWXJPby8yWVhKb0ZqTTNnckQ5Y0FrU0hnTXhqNEVpendYNVpnZjRITHIvQkZmenF4TmNEU0Y4U2t2NGxKYWM0R2lPbkVub2dES2ZoU1F0SENKSlpTRExzc01udVliNXFSQnVlQ1poUE5LSEVZY2ZkNmRET0Y5L0hZb2NaM2dzajRFa2pZRXFuNFV3dmgxOGp2WmdLZFZFU3FrbVFrb2ptc09vcGo4SktOMXRlWTREOG13SHhDbmhKeFB6R0loVEdLaUxXQXliYm1IK1RnalhyQlBRN09xQ21HZUZoR2VGT0lXQktJVkJmWTREOHMwT0NMajBtSUNpWHhaUU5CRlFOQ0hsRVMwUDhEbmFZOEw0ZGpSdWRZY25KakVRSlRNUXIwajZPVkZ5ZUp5WXg2RHhmVGRPcjJzRG4wTi9zYktMVXFxSmtKVzArMTRSY09seGFaWWRzazEyMUNSWUlFcDh1cG9FUzdpZE45a2c0TkxYUzZtbWx4NEs0WE8xRHpuQjBYeDVlbDBiRkhrdWlKTENDenlOS05rQ1JaNExsWEd0RUhEbzRwOEdQRGFFejlXK0pPRFNvOUpNRzZRWmRweU5NNk42M2VyT3hwa2h6YlNqTHNNS0FWYzNMS0RvRndXVWp2d1VlVFMxbEdvaUFnNzlTV1ZzS3hTNVRsU3Z0K0JzYkhpeG40azFvenJlQWtXT0V4VXhCZ2k0dXIxbEVYcnlxRWRyc3VKRkFZY2VscVF6cU50Z1ExVk1KNnBpZis1TVRDZnEwbTBRYjJEQTUyZ3ZsWEJVTDVTRXY3dUhrRWUzdG9MUDFlNnVpRFpBbnVWQTlUb3pxcUk3dzJFcm9qdFJ2ZDRNZWJZRHA2SU5LT0dvaTBvNEt2STRwRHpTc0lxVzMvQTUyb3NpbmdXMXFWWUlvNHc0RTJWNlFCaGxSRzJxRlNLZUdYd3VmWjdQMWY3Nk1mVWxmSzcyc1lYL2FhY1ZuRnJiQW1tR0hWV3huUkJHR2lHTU1rSVlhVVJWYkNla0dYYVVSZWxSUmpWdlBSM1pUaW9qMng2TG5LUjBUL0lyUG9mdXFVbnVoSVJuUldWa0IwNUhkYUF5c2dNU25oVTF5WjNnYzdUZUVvNzYrUk1jTlZrTldlMDlyampCVWVlV1IrbFJ0OEVHWVl3UnA2aFdDR09NcU50Z1EzbVVIZ0tLemxyNS82MkdQRzBBbjlMK1VzQ2wyZW9FRTBSSkZwUlRCb2lTTERpYllNSkpTdWVzampmL29pYkJUSjZFVk1kM1BsRk5ncGxVUkJ2U1N5T2FJRTVoVUJWbmdqaUZRVmxrTTc1N3B6N3QyM2RrNUduSXFVakRzM2lPejlVeVo5WjFoTCtiOVNaOC8yNkRlZjNyV2MrdGZZVkhvbDlOZTZLbkZmNEJQbGVUV0JiWkRGR1NCV1dSZWh6bnFCSjJ2M21VN0h6ak1ObjF4citlNklrdC9JZzFBb3B1SzR2UVEwRFJyWHl1ZGsxNVJBczVGV0Y0cXRWK0s2dUpFMURhVVBqNDdQUCsxNURuQlJSZGVQLzR6UFArT3dDVjk1NXgvMThoekFBQUFBQkpSVTVFcmtKZ2dnPT0nOwogIHZhciBpY29uRGVmUmV0SW1hZ2UgPSAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFESUFBQUJTQ0FZQUFBQVd5NGZyQUFBQUNYQklXWE1BQUFzVEFBQUxFd0VBbXB3WUFBQUFJR05JVWswQUFIb2xBQUNBZ3dBQStmOEFBSURwQUFCMU1BQUE2bUFBQURxWUFBQVhiNUpmeFVZQUFCSFFTVVJCVkhqYTNKdDdVRnRYZnNlVmJxYmJ5ZXgyMmttbk05dk10anZUYWFhZHljNyswVzVtYXk3SWppbUZRa1R3Z3NFeElkaXhGOGN4c1IyeUpON041TkZNTTgyajJaZ2J3Q3lZaDVCQWdFQ2dpeEFQODVDdTBGdENZSU94d2J5TURjYllZR09NZWVuYlA2N08wUlV2RXdjbjlwNlo3ejlYOTU3eis1emZlZjdPa1FTQTVFOUJXNTZVMGFhZktHVDhMNVV4cGhobHRPbE5oWXovVENIai82Q1E4V2tLR2I5YkdXUGFwb3cyL2JUeFJOY1BKSTlTdWxnLzlvUXkydlFyaFl6L1FobHRHbFRJZUd4U2s4cG9VNjVDeG9jcFpQeVQzeHVBUXNiL25VTEdmNm1ROFNNcmpWUkdtMUN5cXgxbENSYW9rMnlvVExhamZJOFZxamd6bE5HbXRhQnVLR1I4bmpMYTlJL2ZHWUE4d3ZpVVFzWi9vSkR4czJKanloSXNxRWx4b3VIZExweDUvK3lHYWp6UmhkcFVOOVNKdHBWZzg4VlIvQmZ5Q09OZlBWU0k0aWorMWVJby9rcHhGSS9pS0I0bHU5cWhQZVFTakgvdjdDbzEvVDVRNjczREhYRkRGV2NHeWJjNGlyK3VrUEZ2YkhrL0tnbzMvcms4a3MrWFIvS1FSd3ExVjMzUWljWVRnUUFONloyb08rNkI3bWdIdUNOdWFBKzdBc1FkY2FNMjFZMjZZeDFvU085Y0JWZVQ0b1F5MmdSU2pqeVMxNVhHbW4rOFZhUFEwL0pJM2tBeVZ5ZlpxQkZOdnhlYVNkMXh6NXFHMzAvY0VSL1V1MTAwdjRaM3UxQzF6eTZHNlpKSEdQLysyL2FIZjVaSDh2M3lDQ1BrRVViVXBEaFhBV2dQdWRaVjI4YzlHTytjeHZVTHQ4Ri8ycnZodXl1QnVDTnVBVVFvZTB3ZXlULy9ZQkNSL00va2tmeUVQTUlJaFl5SDdtZ0hMVVNmNW9IMnNBczFLYzQxVmYvYlR2UTFqR0Y1WVJra2VaZTlHREplUitPSnJuVy8weDUyb2U2NGg1WlRkNnhEYUdvUlJzZ2orVHZ5Q09QUHYrblEraU41aExHVFFPalRQR2c4MFlYR0UxM1FIZTFBOVVIbm1xcEpjY0ZUUEl5NXFRV3NsK2J2TEtKYlBRcnVEZmU2K2RTbXV0SHdybEJlL2R1ZFVNYVlpR2NHQ2tJTlQyOEs0b1ZuWXA0b0NqZHFpc0tGNXFRN0tyaThJYjBUMnNPdWRRczMvK0VpSmkvT1VJUG5waGR3VVQrR3hia2xlSmU5Nkc4Y3g1MXI5K2p2MDhPenNHWDNyNXVmOXJBTERlbWRhSGhYYU1MeVNCNUY0VVlVaFJ0Yk5qV0JGb1ViUC9KOVFPZUZodlJPYUErdERkSDgvam1NV0c1UUE1ZVh2QmhzbTBEOWI3dWdmZDJOeFh0QzgycDhwd3U2Tnp2UVZ6K09wWHYrSmpmbW1VTGIvNXhmRythUUg0WTc0aVlna0VjWXY5d1FvaURVOEd4aG1HR3hNTXlBeW1TN2tFbDZKN2dqYm1nT09BSlVtK3BHTDNjVmkzTkwxS2lKbmxzd2ZISWVtdGNjMEx6bWdQNHREelc2NWFOdWFBNDRvVG5nUk11SDNianFtZ3FBNzI4YVI5MWJubFhsVU0ra2Q2SXkyWTdDTUFNS3d3eExoV0dHZjluSUcxV0ZZUVlvWkR6OVdIZTBZMVhtcnZ3QnpJek5VVU51ajgzQm1UdEFBZFlFK2JCNzFlOVd0ZzlUUTdNMG43czM1dEZaTW96cTN6aFhWUnF4UnhsalFtR1lBVVhoeHRyMXZCRlVFR3BBUWFoQmFGTHBuZENuZWFEWjc2RGlQKzNGUk05dFd2REM3Qko2cWtaUm0rb09lSTlJZjF3RThrRzMvemNSalBaMUY3cEtoakUzN1I4Z2JsNjZBOHZKdm9DODZvNTdhRDhsZGhhRUdsNVlDOFJTRUdwQXlhNTIxTC9kaWZxM08xR1Q0a1RWUGp2MGFSNE1HU2NBcjMvMEdiRk1vdkhFV1ZUdGQ2eXJ1dU1lK243TGg5MGJ2cXRQNjhSQXl6VjRsLzJGak5wdm9QR0VNRUZXSDNSU3UwcGp6UVRFL2NJek1VK0lJZjZOVU5hbXVsSC90dENrcXZiWjRmampKZHk3dlVnenY5RTNBLzdUWGxUdHM2K1FZNVc0Tjl3WU5rM2lzdlVHNnQvdVhPTWQreXExL25jM3hydW1hWG1MYzB0d0Z3NmlhcCtkMmxhYjZoWjdaWnNZNUpPQ1VBT2RNL1JwUXFlclRMWmppTDlPaDFObjNnQ3E5Z3ZQSzVQdHFOb2lWYTRoQzl1SE94UENjRDFpdllIS1pEczBCeHpVUG9XTVIwR29BZms3Mno2bklQazcyeTdrNzJ5RE90RUdmWnF3NkNNWkRyUmNBd0FNdGswSXoxNFZhci95Vlh1Z2tyZEc0b3JxcWI0Q0FCamlyOU5udXFNZDBLZDVVSmxzUi83T051VHZiT3NqM25ndWYwY2I4bmUwb1RiVkRYMmFCelVwVHFpVGJGQW4yWENwV1FBWmFKdWdtNlFSOHlTbUJ1L2c1a0NncGdhL21kYjZmcXh6R3BvRERxaVRiRGhmSTRBTUdpZW9QVFVwVHVqVFBLaE5kWVBZWFJCcWVFNXllbnRyV3Y2T05zZ2plZFFkOTZEdXVFZjRLRkVRQVJsc214Q2V2V0tETGFzZkR5dDFsWTdRc3MvN1BESm9tS0RQMUVrMmFtZHhGRTlnMGlXbnQ3ZG1uTjdlaXRKWU0rcU9kVUIzdE1QLzBUb2c2bGRzR0Q4N0hXQ0Exd3RjY2Q2RUxhc2ZGcllQOXB4TGNLeVFQZWNTckYvM3dmcDFINGJiSitGZDhnYmtNVFU4aThways4WWdpVGE2cDFIRm1YRjZleXRPYjI4OUpUbTl2YlVxVDlxQ3NnUUw2bzRKRzZJTlFYeHErdDFaTEs4d1pIblJpeUgrT2hyU095bndTdW1PZHFDL2FSeEw4OHVydkdIOHRGZDRMMmxqRUxLUEtVdXdJRS9hZ2x4cHMxYVNLMjIyNTBsYkJKY2Q2eEQ2eHlaQTFJazI5RGVPQXdDVzVwZUZJZFByWDNKYzFJOUJsK3IzcnZhUUN6MVZvd0ZMbW10bnA3RXd1MFRuaklvVithOEhVcFBpUk4yeERxaVRiTWlUdGlCUDJ1S1M1RWxicnVaS20xRzF6MDZYNkJWN3JWU1h6dmc2ZSt1RThDelJob3E5Z3JTdnUzRHYxaUxnQmJvclI5SHlVVGR1OU4veHI0Q25GdUF1R0lROSt4Sm14djByMzF1WDc0TC9yQmZ1Z2tGNHZVSkY2Tk04QWVWVzdMV2lwM3FVZ29pZmF3NDQ2RHlYSzIxR3JyUjVUSklyYmI2ZEsyMkdacitEcnF2SzkxaXArcHY4SU9WN3JLaDQyU2RmcGgyRmc0SlhGcGFGWVR2SkJuZkJJTzdlbkYrOUY1bFpSRmZwTUYyZXpNOElFKzM1bWlzMDMzS2lQVmIwYUVacGF4RGJSRUEwK3gwRTVMWWtWOXJjblN0dGhqckpSajFTbG1DaDZtOFNtczlBeXpXVUpWaUV6RVFGcWwreFlXcFlXUGhkN1ppaXo3V0hYYmlvSDRQWDE5d0dEUlBRSC9kUWd3ZGFKK2hDVWZPYWd4cFBWSlpnUVUvVktLMUVzVTNWQjUzQ29KUmtJeUE5a2x4cHN5NVgyZ3hWdkdWVElBS01KYUJRd3lmbmFhMmJQcjlBbjFjbDIybWZxRHZtb2MvUHZIZU9ycWxzV2YyckFJanVCNktLdHhDUWVrbE9TRk5XVGtnVGxERW0xS2E2VVpOeWZ4Q3h5bjFnVjV3M2FmdFhKd21SUmUwaEZ3VnBTTytpeGs3MDNBSUFURjZjUWNVZUs4b1RyR3ZtdlI1SVRZcXdIVmJJZU9TRU5DRW5wT21Qa3B5UXBuZHlRcHBRR0dZQWQ4UU43b2diWlFrV3FPSUZrWkhwVXNzMXFPSXRLQk5MbEhuZFd4NDZwSGJJaDJpQllwQ3lCQ3ZNSi90OEV3L1EvTUU1Zng3eHE5VXRBaUgycU9JdDFNN0NNQU55UXBwd0txVHhQVWwyY0gzSXFaQkc1SVEwQ2FHWnd5Nm9FMjFReFptaGlqUDdRWnF2Q2M5MkM5SWVkbUhZZEIzbmE2N1Fnc2x3T1g5bkVkVUhuYWphNzZBZytyYzhxRWkwMFlYZ2tQRTYvYTVEUG9SUngwM1VIZmRBdGR0QzFWMDVTbHNEc2FkaXI5RC90SWRjQkFLblFob2pKUElJNDVPblFocW5UNFUwQ3VQOVlSYzBCeHlyUWM0SW1WVWtXdUV1SE1TOVcvNk5VRzFxQjFTN0xhamE1NkNqVlYvOU9DcjIyaWdJOTdvTEhzV3dzRFMvdXdUdXNCdGx1eTNRaUdBWDd5N2hiUGxsVk8yelF4Vm54am4xNVZVZ1pQdXJUclFSaU5uaUtQNHZKQktKUkpJZFhLOCtGZEtJNGlpZUJobldBbW43dUJ2VEkvNnQ2ZXprUEZ5bkI2Qit4ZTlCc2c1YlhsaUc4WC9QWTI1NkFkNGxML2pQZWpIdjI5ZDBxVVpvclpmdnNjTDZkVDl1WDdsTDg1MFpuNFBwODE0Ni9JcEJhbEtFb0VSeEZFOUFPTHFNenc2dWZ5MDd1QjY1MG1ZYStTdmZZMFZwckJsOURRTEl3bDMvakx5MHNJeGU3aXFxOXRsUkdtdEdhWndnVlp3Wlpidk5OQ3cwUFRLTCtabEZMTTB2MDczNXpOZ2NLaEt0MURBaWRaSU5aOHRHNkV3dkxuT2c1UnBLWTgxMEFORWVjaUZYMm96czRIcGtCZXNQVVpDc1lQMHpXY0Y2YjFhd25pNEJLcE1GSS90OU16c0FlSmVFYUtIZXQ5MWNUMmZlUHhld0xSYW45aTh2UUJWcmhtcWRiMnRUM2VockNGeUxEUm9tVUJwcmhtYS9neTZoc29MMXlBcldMNThLYWZ4cHdKNDlPN2krTHBQUm9UQk1DRDVVSDNTaU5OYmZUZ0ZnOGQ0U25Ia0RLSTF0Ujhtdi9TcWxNbE1OR2ErdmdoanZtZzU0WjIyMXc1eHhrYzc2QU5DcnZZTFNXRE1OclJhRUdwREo2SkRKNkdwV0JSOHlHVjJrNzBkS1hyRlhHTjhkdVpjQ29vUlRRN1BnUCt0RnlhNzJOVlc2cXgzYVEwNHNpcHFqZDhrckJBNVdHcjdMakZMZmQ2MGZkK042NysyQXRacEhNWXlLdlZhNnFhcmFaeWNReUdSMG9hdEFzb1ByLzR4bHVFR1c0ZWo1aDJhL0E4b1lFNVF4SnFoZnRlRzg5Z3FXRndPakhQcTNQQ2lKYWZkTEJOUlZPa0xmN1dzY1h4ZTg5b2g3bFFmN0c4ZFJmZEJmUG9rK0ttUThXSVpESnFQcldUZEFseEdrZllkbE9Kd0thYVFma25NL0luMmFCNWV0ay82T1A3K01DN1ZYb2RudkNBU0thVWZGeTFiTVRzNWpjVzVwemQvVmlUYWNxN2lNK1R1TEFTSFV4dCtkaFVMbUwxTVZiNkgyWkFmWGcyVTRzQXozeHJvZ1gyM1QvQTNMY1BkWWhvTXF6b3pxZzhMZVhReENaUGlrQnpmNlp3S0dZbWZlQUVwLzNRN2xTMzVaTXZyUVVUU0VrcGZhQTJSbCszRDdxajlhZVd2MEx0cS92QUNGekJSd3FLcU1OcUV5MlU3N3JBL2kxc21nbWg5dEdQOWxHVTdPTWh6eWQ3WUp6ZXVBNE42MWpwaEw0OHh3NVE4RVRJNlRGMmZROHNHNU5lR1YwU1kwdk5PSjhjN0F1TlZaMVFncVhyWUtFQy95Z254bGxPeHFwOTdJbFRhRFpUaGtCR2xQM2pjYXp6TGNyM3pVVUNmYVVIM1FpZkk5MWczUHpEV3ZPWVFsdTJqck85dytDZTRORndXb1B1REFwVE9Ca2NSQnd3UzR3eTZmRjN5VnRRSkViSVBQTG04bW8vdW5UWjJSc0F6blloa09oV0VHR252ZHpDVUFmWm9IVjkxVGdiVmRmaGtkOHFFQXIwMmN2NDBtWHovWUNFSVpZNkxsNSs5c0l5RDZUWjlZc1F6M012Rkt4VjRyTlBzZDYzcWwrTVZBS1Y3a1lmcWlGN2RHNzY2YVIrNU0zSU10cXgvS2w5cWhlTkVra3VoN1VkNms3TElFQzRFQXkzQXZiQnJFTnhTZlpSa09CYUVHR3BkVnlIanhXZmlHS29zem8xTXhqTm5KZWN4TkxhQ25haFFWTDFzMy9iMHl4a1RMemQvUlJ2cEd5emMrRE0wSTBzYVFXaWpmWTBWbHNoMnFlSXY0MkhpVmloOUVQc05YNWxXeDExOG1zU09UMFFVOTBNa3V5M0FPNGhVU2UxWEkrQTFoNUpFOGl2OXI4MXJyZTJXTWlaYVhKMjBoSUhVUGZNN09NdHgva3RwUXhWdjhYdkdkdXo4c2xTVlk2S0pWNUkxLy9WYVhCbGlHNDFtR1EvNk9OaHBJVnNqNGh3YWhrUEcwSERKdnNBeFg5YTJ2Y0dRRWFVT29WM3o3QmxXOGhaNndiclhJMWFpU1hlMEVZam1UMFQyM0pmZFJXSVpyWUJrT0pMU3FUcktoT0lyZmNvaDF2Rkd5WmJlRE1vSzB2eVJlS1kzMWU4VjNWTHhsSXQ1UVJwc0l4QkxMY005dTZWVW5sdUdxV1laRHJyU1pCcE9MbzNqeFdkNjNVbkVVVC9QTkNXa2lJUGxiZnVrc2s5SDluR1U0TDh0d3d2N0VGekxhS2hCVnZBWHFSQnZkYjdBTXQ1QWRYUCt6aDNLRGptVzRFcGJoa0JQU3RLVmVJZDZvMkdzVjd6ZXlIdHBWUUpiaG52VzFXeWhrUEwxdzZUdVVmR0NwNG9RSWlUeVNlbVB1cTIyYVp4N3F2Y2FNSU8xcHNvc2tzVng1aFBHQklZcWplQnE4Rm5uank0ZCt5NVJsdUg5Z0dXNmVaVGhoY1poZytWWmVVY1daVVpaZ0VYdmp6bGZiTkgvN25WeVpaUm51YTViaGtCMWNMd1MyRTRSbEN6a3UzcXhvUmNSYmtCV3NKeUNmZkdkM2YwK0ZOUDZFWmJpN0xNTkJIc2xERlNjRTEzd25ySnRTL280MkdtVXNDamNTaU9tVFFUVi8vWjNleE00STBuN0dNaHl5Z3ZVQkJ2a09KKytyb25Bai9TNlQwWkg5eHZ2ZitaWHlrMEUxVDJjRWFXK3pERWVOS3RuVmp0UGJXKzhMUWM3MXlUems4OFprcnJUNXg1THZJN0VNOXhIeENqRnNNMTRSZ3hOdnNBeVgvcjFkOU05a2RIL0pNdHdOc3ZraXh2a084ZGRVbnJRRkpidmE2VWpuZ3hqN2Fwdm1xZS8xYnhja09wbko2SVM0YjZ6Z2xmVkFpc0tOS0kxZDVZMDN2L2YvajN5MVRmTVV5M0RqWlBORjRybTUwbVp5VUVtVksyMm12NU9BQXN0d0l5ZURhbjc0U1B3WmhtVzRONGxYbERIQ2YwZklRYVZZUmVGR2xPeHFoekxhSlBiR2J4NlpmL1djREtyNUljdHdJMkt2S0tOTjRzTks1SVEwMFQvSW5ON2VTaUF1eVNPTVQwb2VwY1F5M0VIaUZSS3pMUXd6VUpEQ01PSGlwMmlaRHBiaGtpU1BXcEpIR0o5a0dhNlBiSW5KUDNWSXN5TFJkVkY0NS96Ly9idjZCNUpITWJFTXQ1ZlVkbkVVVHk5UWtvdWZ4VkYrYjJRRWFYZExIdFhrQzdXZUkxdmlsWEZpVVVEQkUzQmY5eEgxeWk1UzYrUnZUQ1E2S2VvYk1zbmprRmlHYzY3MGlzZ2JOc25qa2s0RzFZU1QyaWN4SzFIZitBL0o0NVJZaGpPUlFJVW92R09RUEc2SlpUaXBxRThRYjRSSUhzZkVNbHlqQ0tSQjhyZ21sdUdlRjRFOEwzbWNFOHR3TlN6RDFVZ2U5OFF5M0M5WWh2dkZ3eTduL3djQTlJZDlvMzFNaThFQUFBQUFTVVZPUks1Q1lJST0nOwoKICBMLkljb24uRGVmYXVsdCA9IEwuSWNvbi5leHRlbmQoe29wdGlvbnM6IHsKICAgIGljb25Vcmw6IGljb25EZWZJbWFnZSwKICAgIGljb25SZXRpbmFVcmw6IGljb25EZWZSZXRJbWFnZSwKICAgIGljb25TaXplOiBuZXcgTC5Qb2ludCgyNSwgNDEpLAogICAgaWNvbkFuY2hvcjogbmV3IEwuUG9pbnQoMTIsIDQxKSwKICAgIHBvcHVwQW5jaG9yOiBuZXcgTC5Qb2ludCgxLCAtMzQpLAogIH19KTsKCiAgd2luZG93LmV4dHJhY3RGcm9tU3RvY2soKTsKICB3aW5kb3cuc2V0dXBJZGxlKCk7CiAgd2luZG93LnNldHVwVGFwaG9sZCgpOwogIHdpbmRvdy5zZXR1cFN0eWxlcygpOwogIHdpbmRvdy5zZXR1cERpYWxvZ3MoKTsKICB3aW5kb3cuc2V0dXBEYXRhVGlsZVBhcmFtcygpOwogIHdpbmRvdy5zZXR1cE1hcCgpOwogIHdpbmRvdy5zZXR1cE9NUygpOwogIHdpbmRvdy5zZWFyY2guc2V0dXAoKTsKICB3aW5kb3cuc2V0dXBSZWRlZW0oKTsKICB3aW5kb3cuc2V0dXBMYXJnZUltYWdlUHJldmlldygpOwogIHdpbmRvdy5zZXR1cFNpZGViYXJUb2dnbGUoKTsKICB3aW5kb3cudXBkYXRlR2FtZVNjb3JlKCk7CiAgd2luZG93LmFydGlmYWN0LnNldHVwKCk7CiAgd2luZG93Lm9ybmFtZW50cy5zZXR1cCgpOwogIHdpbmRvdy5zZXR1cFBsYXllclN0YXQoKTsKICB3aW5kb3cuc2V0dXBUb29sdGlwcygpOwogIHdpbmRvdy5jaGF0LnNldHVwKCk7CiAgd2luZG93LnBvcnRhbERldGFpbC5zZXR1cCgpOwogIHdpbmRvdy5zZXR1cFFSTG9hZExpYigpOwogIHdpbmRvdy5zZXR1cExheWVyQ2hvb3NlclNlbGVjdE9uZSgpOwogIHdpbmRvdy5zZXR1cExheWVyQ2hvb3NlclN0YXR1c1JlY29yZGVyKCk7CiAgLy8gcmVhZCBoZXJlIE9OQ0UsIHNvIHRoZSBVUkwgaXMgb25seSBldmFsdWF0ZWQgb25lIHRpbWUgYWZ0ZXIgdGhlCiAgLy8gbmVjZXNzYXJ5IGRhdGEgaGFzIGJlZW4gbG9hZGVkLgogIHVybFBvcnRhbExMID0gZ2V0VVJMUGFyYW0oJ3BsbCcpOwogIGlmKHVybFBvcnRhbExMKSB7CiAgICB1cmxQb3J0YWxMTCA9IHVybFBvcnRhbExMLnNwbGl0KCIsIik7CiAgICB1cmxQb3J0YWxMTCA9IFtwYXJzZUZsb2F0KHVybFBvcnRhbExMWzBdKSB8fCAwLjAsIHBhcnNlRmxvYXQodXJsUG9ydGFsTExbMV0pIHx8IDAuMF07CiAgfQogIHVybFBvcnRhbCA9IGdldFVSTFBhcmFtKCdwZ3VpZCcpOwoKICAkKCcjc2lkZWJhcicpLnNob3coKTsKCiAgaWYod2luZG93LmJvb3RQbHVnaW5zKSB7CiAgICAvLyBjaGVjayB0byBzZWUgaWYgYSBrbm93biAnYmFkJyBwbHVnaW4gaXMgaW5zdGFsbGVkLiBJZiBzbywgYWxlcnQgdGhlIHVzZXIsIGFuZCBkb24ndCBib290IGFueSBwbHVnaW5zCiAgICB2YXIgYmFkUGx1Z2lucyA9IHsKICAgICAgJ2FyYyc6ICdDb250YWlucyBoaWRkZW4gY29kZSB0byByZXBvcnQgcHJpdmF0ZSBkYXRhIHRvIGEgM3JkIHBhcnR5IHNlcnZlcjogPGEgaHJlZj0iaHR0cHM6Ly9wbHVzLmdvb2dsZS5jb20vMTA1MzgzNzU2MzYxMzc1NDEwODY3L3Bvc3RzLzRiMkVqUDNEdTQyIj5kZXRhaWxzIGhlcmU8L2E+JywKICAgIH07CgogICAgLy8gcmVtb3ZlIGVudHJpZXMgZnJvbSBiYWRQbHVnaW5zIHdoaWNoIGFyZSBub3QgaW5zdGFsbGVkCiAgICAkLmVhY2goYmFkUGx1Z2lucywgZnVuY3Rpb24obmFtZSxkZXNjKSB7CiAgICAgIGlmICghKHdpbmRvdy5wbHVnaW4gJiYgd2luZG93LnBsdWdpbltuYW1lXSkpIHsKICAgICAgICAvLyBub3QgZGV0ZWN0ZWQ6IGRlbGV0ZSBmcm9tIHRoZSBsaXN0CiAgICAgICAgZGVsZXRlIGJhZFBsdWdpbnNbbmFtZV07CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIGlmIGFueSBlbnRyaWVzIHJlbWFpbiBpbiB0aGUgbGlzdCwgcmVwb3J0IHRoaXMgdG8gdGhlIHVzZXIgYW5kIGRvbid0IGJvb3QgQU5ZIHBsdWdpbnMKICAgIC8vICh3aHkgbm90IGFueT8gaXQncyB0cmlja3kgdG8ga25vdyB3aGljaCBvZiB0aGUgcGx1Z2luIGJvb3QgZW50cmllcyB3ZXJlIHNhZmUvdW5zYWZlKQogICAgaWYgKE9iamVjdC5rZXlzKGJhZFBsdWdpbnMpLmxlbmd0aCA+IDApIHsKICAgICAgdmFyIHdhcm5pbmcgPSAnT25lIG9yIG1vcmUga25vd24gdW5zYWZlIHBsdWdpbnMgd2VyZSBkZXRlY3RlZC4gRm9yIHlvdXIgc2FmZXR5LCBJSVRDIGhhcyBkaXNhYmxlZCBhbGwgcGx1Z2lucy48dWw+JzsKICAgICAgJC5lYWNoKGJhZFBsdWdpbnMsZnVuY3Rpb24obmFtZSxkZXNjKSB7CiAgICAgICAgd2FybmluZyArPSAnPGxpPjxiPicrbmFtZSsnPC9iPjogJytkZXNjKyc8L2xpPic7CiAgICAgIH0pOwogICAgICB3YXJuaW5nICs9ICc8L3VsPjxwPlBsZWFzZSB1bmluc3RhbGwgdGhlIHByb2JsZW0gcGx1Z2lucyBhbmQgcmVsb2FkIHRoZSBwYWdlLiBTZWUgdGhpcyA8YSBocmVmPSJodHRwOi8vaWl0Yy5qb25hdGtpbnMuY29tLz9wYWdlPWZhcSN1bmluc3RhbGwiPkZBUSBlbnRyeTwvYT4gZm9yIGhlbHAuPC9wPjxwPjxpPk5vdGU6IEl0IGlzIHRyaWNreSBmb3IgSUlUQyB0byBzYWZlbHkgZGlzYWJsZSBqdXN0IHByb2JsZW0gcGx1Z2luczwvaT48L3A+JzsKCiAgICAgIGRpYWxvZyh7CiAgICAgICAgdGl0bGU6ICdQbHVnaW4gV2FybmluZycsCiAgICAgICAgaHRtbDogd2FybmluZywKICAgICAgICB3aWR0aDogNDAwCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgLy8gbm8ga25vd24gdW5zYWZlIHBsdWdpbnMgZGV0ZWN0ZWQgLSBib290IGFsbCBwbHVnaW5zCiAgICAgICQuZWFjaCh3aW5kb3cuYm9vdFBsdWdpbnMsIGZ1bmN0aW9uKGluZCwgcmVmKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJlZigpOwogICAgICAgIH0gY2F0Y2goZXJyKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJlcnJvciBzdGFydGluZyBwbHVnaW46IGluZGV4ICIraW5kKyIsIGVycm9yOiAiK2Vycik7CiAgICAgICAgICBkZWJ1Z2dlcjsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KCiAgd2luZG93LnNldE1hcEJhc2VMYXllcigpOwogIHdpbmRvdy5zZXR1cExheWVyQ2hvb3NlckFwaSgpOwoKICB3aW5kb3cucnVuT25TbWFydHBob25lc0FmdGVyQm9vdCgpOwoKICAvLyB3b3JrYXJvdW5kIGZvciAjMTI5LiBOb3Qgc3VyZSB3aHkgdGhpcyBpcyByZXF1aXJlZC4KICAvLyBzZXRUaW1lb3V0KCd3aW5kb3cubWFwLmludmFsaWRhdGVTaXplKGZhbHNlKTsnLCA1MDApOwoKICB3aW5kb3cuaWl0Y0xvYWRlZCA9IHRydWU7CiAgd2luZG93LnJ1bkhvb2tzKCdpaXRjTG9hZGVkJyk7CgoKICBpZiAodHlwZW9mIGFuZHJvaWQgIT09ICd1bmRlZmluZWQnICYmIGFuZHJvaWQgJiYgYW5kcm9pZC5ib290RmluaXNoZWQpIHsKICAgIGFuZHJvaWQuYm9vdEZpbmlzaGVkKCk7CiAgfQoKfQoKCi8qIENvcHlyaWdodCAoYykgMjAxMCBDaHJpcyBPJ0hhcmEgPGNvaGFyYTg3QGdtYWlsLmNvbT4uIE1JVCBMaWNlbnNlZCAqLwoKLy9JbmNsdWRlIHRoZSBjaGFpbi5qcyBtaWNyb2ZyYW1ld29yayAoaHR0cDovL2dpdGh1Yi5jb20vY2hyaXNvL2NoYWluLmpzKQooZnVuY3Rpb24oYSl7YT1hfHx7fTt2YXIgYj17fSxjLGQ7Yz1mdW5jdGlvbihhLGQsZSl7dmFyIGY9YS5oYWx0PSExO2EuZXJyb3I9ZnVuY3Rpb24oYSl7dGhyb3cgYX0sYS5uZXh0PWZ1bmN0aW9uKGMpe2MmJihmPSExKTtpZighYS5oYWx0JiZkJiZkLmxlbmd0aCl7dmFyIGU9ZC5zaGlmdCgpLGc9ZS5zaGlmdCgpO2Y9ITA7dHJ5e2JbZ10uYXBwbHkoYSxbZSxlLmxlbmd0aCxnXSl9Y2F0Y2goaCl7YS5lcnJvcihoKX19cmV0dXJuIGF9O2Zvcih2YXIgZyBpbiBiKXtpZih0eXBlb2YgYVtnXT09PSJmdW5jdGlvbiIpY29udGludWU7KGZ1bmN0aW9uKGUpe2FbZV09ZnVuY3Rpb24oKXt2YXIgZz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO2lmKGU9PT0ib25FcnJvciIpe2lmKGQpe2Iub25FcnJvci5hcHBseShhLFtnLGcubGVuZ3RoXSk7cmV0dXJuIGF9dmFyIGg9e307Yi5vbkVycm9yLmFwcGx5KGgsW2csZy5sZW5ndGhdKTtyZXR1cm4gYyhoLG51bGwsIm9uRXJyb3IiKX1nLnVuc2hpZnQoZSk7aWYoIWQpcmV0dXJuIGMoe30sW2ddLGUpO2EudGhlbj1hW2VdLGQucHVzaChnKTtyZXR1cm4gZj9hOmEubmV4dCgpfX0pKGcpfWUmJihhLnRoZW49YVtlXSksYS5jYWxsPWZ1bmN0aW9uKGIsYyl7Yy51bnNoaWZ0KGIpLGQudW5zaGlmdChjKSxhLm5leHQoITApfTtyZXR1cm4gYS5uZXh0KCl9LGQ9YS5hZGRNZXRob2Q9ZnVuY3Rpb24oZCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSxmPWUucG9wKCk7Zm9yKHZhciBnPTAsaD1lLmxlbmd0aDtnPGg7ZysrKXR5cGVvZiBlW2ddPT09InN0cmluZyImJihiW2VbZ11dPWYpOy0taHx8KGJbInRoZW4iK2Quc3Vic3RyKDAsMSkudG9VcHBlckNhc2UoKStkLnN1YnN0cigxKV09ZiksYyhhKX0sZCgiY2hhaW4iLGZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMsYz1mdW5jdGlvbigpe2lmKCFiLmhhbHQpe2lmKCFhLmxlbmd0aClyZXR1cm4gYi5uZXh0KCEwKTt0cnl7bnVsbCE9YS5zaGlmdCgpLmNhbGwoYixjLGIuZXJyb3IpJiZjKCl9Y2F0Y2goZCl7Yi5lcnJvcihkKX19fTtjKCl9KSxkKCJydW4iLGZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcyxkPWZ1bmN0aW9uKCl7Yy5oYWx0fHwtLWJ8fGMubmV4dCghMCl9LGU9ZnVuY3Rpb24oYSl7Yy5lcnJvcihhKX07Zm9yKHZhciBmPTAsZz1iOyFjLmhhbHQmJmY8ZztmKyspbnVsbCE9YVtmXS5jYWxsKGMsZCxlKSYmZCgpfSksZCgiZGVmZXIiLGZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7c2V0VGltZW91dChmdW5jdGlvbigpe2IubmV4dCghMCl9LGEuc2hpZnQoKSl9KSxkKCJvbkVycm9yIixmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXM7dGhpcy5lcnJvcj1mdW5jdGlvbihkKXtjLmhhbHQ9ITA7Zm9yKHZhciBlPTA7ZTxiO2UrKylhW2VdLmNhbGwoYyxkKX19KX0pKHRoaXMpOwoKdmFyIGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCmFkZE1ldGhvZCgnbG9hZCcsIGZ1bmN0aW9uIChhcmdzLCBhcmdjKSB7CiAgICBmb3IgKHZhciBxdWV1ZSA9IFtdLCBpID0gMDsgaSA8IGFyZ2M7IGkrKykgewogICAgICAgIChmdW5jdGlvbiAoaSkgewogICAgICAgICAgICBxdWV1ZS5wdXNoKGFzeW5jTG9hZFNjcmlwdChhcmdzW2ldKSk7CiAgICAgICAgfShpKSk7CiAgICB9CiAgICB0aGlzLmNhbGwoJ3J1bicsIHF1ZXVlKTsKfSk7CgpmdW5jdGlvbiBhc3luY0xvYWRTY3JpcHQoc3JjKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKG9ubG9hZCwgb25lcnJvcikgewogICAgICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICBzY3JpcHQudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOwogICAgICAgIHNjcmlwdC5zcmMgPSBzcmM7CiAgICAgICAgc2NyaXB0Lm9ubG9hZCA9IG9ubG9hZDsKICAgICAgICBzY3JpcHQub25lcnJvciA9IG9uZXJyb3I7CiAgICAgICAgc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdGhpcy5yZWFkeVN0YXRlOwogICAgICAgICAgICBpZiAoc3RhdGUgPT09ICdsb2FkZWQnIHx8IHN0YXRlID09PSAnY29tcGxldGUnKSB7CiAgICAgICAgICAgICAgICBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDsKICAgICAgICAgICAgICAgIG9ubG9hZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBoZWFkLmluc2VydEJlZm9yZShzY3JpcHQsIGhlYWQuZmlyc3RDaGlsZCk7CiAgICB9Cn0KCgp0cnkgeyBjb25zb2xlLmxvZygnTG9hZGluZyBpbmNsdWRlZCBKUyBub3cnKTsgfSBjYXRjaChlKSB7fQovKgogTGVhZmxldCwgYSBKYXZhU2NyaXB0IGxpYnJhcnkgZm9yIG1vYmlsZS1mcmllbmRseSBpbnRlcmFjdGl2ZSBtYXBzLiBodHRwOi8vbGVhZmxldGpzLmNvbQogKGMpIDIwMTAtMjAxMywgVmxhZGltaXIgQWdhZm9ua2luCiAoYykgMjAxMC0yMDExLCBDbG91ZE1hZGUKKi8KKGZ1bmN0aW9uICh3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHsKdmFyIG9sZEwgPSB3aW5kb3cuTCwKICAgIEwgPSB7fTsKCkwudmVyc2lvbiA9ICcwLjcuMyc7CgovLyBkZWZpbmUgTGVhZmxldCBmb3IgTm9kZSBtb2R1bGUgcGF0dGVybiBsb2FkZXJzLCBpbmNsdWRpbmcgQnJvd3NlcmlmeQppZiAodHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZS5leHBvcnRzID09PSAnb2JqZWN0JykgewoJbW9kdWxlLmV4cG9ydHMgPSBMOwoKLy8gZGVmaW5lIExlYWZsZXQgYXMgYW4gQU1EIG1vZHVsZQp9IGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewoJZGVmaW5lKEwpOwp9CgovLyBkZWZpbmUgTGVhZmxldCBhcyBhIGdsb2JhbCBMIHZhcmlhYmxlLCBzYXZpbmcgdGhlIG9yaWdpbmFsIEwgdG8gcmVzdG9yZSBsYXRlciBpZiBuZWVkZWQKCkwubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKCXdpbmRvdy5MID0gb2xkTDsKCXJldHVybiB0aGlzOwp9OwoKd2luZG93LkwgPSBMOwoKCi8qCiAqIEwuVXRpbCBjb250YWlucyB2YXJpb3VzIHV0aWxpdHkgZnVuY3Rpb25zIHVzZWQgdGhyb3VnaG91dCBMZWFmbGV0IGNvZGUuCiAqLwoKTC5VdGlsID0gewoJZXh0ZW5kOiBmdW5jdGlvbiAoZGVzdCkgeyAvLyAoT2JqZWN0WywgT2JqZWN0LCAuLi5dKSAtPgoJCXZhciBzb3VyY2VzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwKCQkgICAgaSwgaiwgbGVuLCBzcmM7CgoJCWZvciAoaiA9IDAsIGxlbiA9IHNvdXJjZXMubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHsKCQkJc3JjID0gc291cmNlc1tqXSB8fCB7fTsKCQkJZm9yIChpIGluIHNyYykgewoJCQkJaWYgKHNyYy5oYXNPd25Qcm9wZXJ0eShpKSkgewoJCQkJCWRlc3RbaV0gPSBzcmNbaV07CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIGRlc3Q7Cgl9LAoKCWJpbmQ6IGZ1bmN0aW9uIChmbiwgb2JqKSB7IC8vIChGdW5jdGlvbiwgT2JqZWN0KSAtPiBGdW5jdGlvbgoJCXZhciBhcmdzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpIDogbnVsbDsKCQlyZXR1cm4gZnVuY3Rpb24gKCkgewoJCQlyZXR1cm4gZm4uYXBwbHkob2JqLCBhcmdzIHx8IGFyZ3VtZW50cyk7CgkJfTsKCX0sCgoJc3RhbXA6IChmdW5jdGlvbiAoKSB7CgkJdmFyIGxhc3RJZCA9IDAsCgkJICAgIGtleSA9ICdfbGVhZmxldF9pZCc7CgkJcmV0dXJuIGZ1bmN0aW9uIChvYmopIHsKCQkJb2JqW2tleV0gPSBvYmpba2V5XSB8fCArK2xhc3RJZDsKCQkJcmV0dXJuIG9ialtrZXldOwoJCX07Cgl9KCkpLAoKCWludm9rZUVhY2g6IGZ1bmN0aW9uIChvYmosIG1ldGhvZCwgY29udGV4dCkgewoJCXZhciBpLCBhcmdzOwoKCQlpZiAodHlwZW9mIG9iaiA9PT0gJ29iamVjdCcpIHsKCQkJYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMyk7CgoJCQlmb3IgKGkgaW4gb2JqKSB7CgkJCQltZXRob2QuYXBwbHkoY29udGV4dCwgW2ksIG9ialtpXV0uY29uY2F0KGFyZ3MpKTsKCQkJfQoJCQlyZXR1cm4gdHJ1ZTsKCQl9CgoJCXJldHVybiBmYWxzZTsKCX0sCgoJbGltaXRFeGVjQnlJbnRlcnZhbDogZnVuY3Rpb24gKGZuLCB0aW1lLCBjb250ZXh0KSB7CgkJdmFyIGxvY2ssIGV4ZWNPblVubG9jazsKCgkJcmV0dXJuIGZ1bmN0aW9uIHdyYXBwZXJGbigpIHsKCQkJdmFyIGFyZ3MgPSBhcmd1bWVudHM7CgoJCQlpZiAobG9jaykgewoJCQkJZXhlY09uVW5sb2NrID0gdHJ1ZTsKCQkJCXJldHVybjsKCQkJfQoKCQkJbG9jayA9IHRydWU7CgoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCQkJCWxvY2sgPSBmYWxzZTsKCgkJCQlpZiAoZXhlY09uVW5sb2NrKSB7CgkJCQkJd3JhcHBlckZuLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwoJCQkJCWV4ZWNPblVubG9jayA9IGZhbHNlOwoJCQkJfQoJCQl9LCB0aW1lKTsKCgkJCWZuLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwoJCX07Cgl9LAoKCWZhbHNlRm46IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCWZvcm1hdE51bTogZnVuY3Rpb24gKG51bSwgZGlnaXRzKSB7CgkJdmFyIHBvdyA9IE1hdGgucG93KDEwLCBkaWdpdHMgfHwgNSk7CgkJcmV0dXJuIE1hdGgucm91bmQobnVtICogcG93KSAvIHBvdzsKCX0sCgoJdHJpbTogZnVuY3Rpb24gKHN0cikgewoJCXJldHVybiBzdHIudHJpbSA/IHN0ci50cmltKCkgOiBzdHIucmVwbGFjZSgvXlxzK3xccyskL2csICcnKTsKCX0sCgoJc3BsaXRXb3JkczogZnVuY3Rpb24gKHN0cikgewoJCXJldHVybiBMLlV0aWwudHJpbShzdHIpLnNwbGl0KC9ccysvKTsKCX0sCgoJc2V0T3B0aW9uczogZnVuY3Rpb24gKG9iaiwgb3B0aW9ucykgewoJCW9iai5vcHRpb25zID0gTC5leHRlbmQoe30sIG9iai5vcHRpb25zLCBvcHRpb25zKTsKCQlyZXR1cm4gb2JqLm9wdGlvbnM7Cgl9LAoKCWdldFBhcmFtU3RyaW5nOiBmdW5jdGlvbiAob2JqLCBleGlzdGluZ1VybCwgdXBwZXJjYXNlKSB7CgkJdmFyIHBhcmFtcyA9IFtdOwoJCWZvciAodmFyIGkgaW4gb2JqKSB7CgkJCXBhcmFtcy5wdXNoKGVuY29kZVVSSUNvbXBvbmVudCh1cHBlcmNhc2UgPyBpLnRvVXBwZXJDYXNlKCkgOiBpKSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudChvYmpbaV0pKTsKCQl9CgkJcmV0dXJuICgoIWV4aXN0aW5nVXJsIHx8IGV4aXN0aW5nVXJsLmluZGV4T2YoJz8nKSA9PT0gLTEpID8gJz8nIDogJyYnKSArIHBhcmFtcy5qb2luKCcmJyk7Cgl9LAoJdGVtcGxhdGU6IGZ1bmN0aW9uIChzdHIsIGRhdGEpIHsKCQlyZXR1cm4gc3RyLnJlcGxhY2UoL1x7ICooW1x3X10rKSAqXH0vZywgZnVuY3Rpb24gKHN0ciwga2V5KSB7CgkJCXZhciB2YWx1ZSA9IGRhdGFba2V5XTsKCQkJaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKCQkJCXRocm93IG5ldyBFcnJvcignTm8gdmFsdWUgcHJvdmlkZWQgZm9yIHZhcmlhYmxlICcgKyBzdHIpOwoJCQl9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewoJCQkJdmFsdWUgPSB2YWx1ZShkYXRhKTsKCQkJfQoJCQlyZXR1cm4gdmFsdWU7CgkJfSk7Cgl9LAoKCWlzQXJyYXk6IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKG9iaikgewoJCXJldHVybiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEFycmF5XScpOwoJfSwKCgllbXB0eUltYWdlVXJsOiAnZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFBRC9BQ3dBQUFBQUFRQUJBQUFDQURzPScKfTsKCihmdW5jdGlvbiAoKSB7CgoJLy8gaW5zcGlyZWQgYnkgaHR0cDovL3BhdWxpcmlzaC5jb20vMjAxMS9yZXF1ZXN0YW5pbWF0aW9uZnJhbWUtZm9yLXNtYXJ0LWFuaW1hdGluZy8KCglmdW5jdGlvbiBnZXRQcmVmaXhlZChuYW1lKSB7CgkJdmFyIGksIGZuLAoJCSAgICBwcmVmaXhlcyA9IFsnd2Via2l0JywgJ21veicsICdvJywgJ21zJ107CgoJCWZvciAoaSA9IDA7IGkgPCBwcmVmaXhlcy5sZW5ndGggJiYgIWZuOyBpKyspIHsKCQkJZm4gPSB3aW5kb3dbcHJlZml4ZXNbaV0gKyBuYW1lXTsKCQl9CgoJCXJldHVybiBmbjsKCX0KCgl2YXIgbGFzdFRpbWUgPSAwOwoKCWZ1bmN0aW9uIHRpbWVvdXREZWZlcihmbikgewoJCXZhciB0aW1lID0gK25ldyBEYXRlKCksCgkJICAgIHRpbWVUb0NhbGwgPSBNYXRoLm1heCgwLCAxNiAtICh0aW1lIC0gbGFzdFRpbWUpKTsKCgkJbGFzdFRpbWUgPSB0aW1lICsgdGltZVRvQ2FsbDsKCQlyZXR1cm4gd2luZG93LnNldFRpbWVvdXQoZm4sIHRpbWVUb0NhbGwpOwoJfQoKCXZhciByZXF1ZXN0Rm4gPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8CgkgICAgICAgIGdldFByZWZpeGVkKCdSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnKSB8fCB0aW1lb3V0RGVmZXI7CgoJdmFyIGNhbmNlbEZuID0gd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lIHx8CgkgICAgICAgIGdldFByZWZpeGVkKCdDYW5jZWxBbmltYXRpb25GcmFtZScpIHx8CgkgICAgICAgIGdldFByZWZpeGVkKCdDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnKSB8fAoJICAgICAgICBmdW5jdGlvbiAoaWQpIHsgd2luZG93LmNsZWFyVGltZW91dChpZCk7IH07CgoKCUwuVXRpbC5yZXF1ZXN0QW5pbUZyYW1lID0gZnVuY3Rpb24gKGZuLCBjb250ZXh0LCBpbW1lZGlhdGUsIGVsZW1lbnQpIHsKCQlmbiA9IEwuYmluZChmbiwgY29udGV4dCk7CgoJCWlmIChpbW1lZGlhdGUgJiYgcmVxdWVzdEZuID09PSB0aW1lb3V0RGVmZXIpIHsKCQkJZm4oKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gcmVxdWVzdEZuLmNhbGwod2luZG93LCBmbiwgZWxlbWVudCk7CgkJfQoJfTsKCglMLlV0aWwuY2FuY2VsQW5pbUZyYW1lID0gZnVuY3Rpb24gKGlkKSB7CgkJaWYgKGlkKSB7CgkJCWNhbmNlbEZuLmNhbGwod2luZG93LCBpZCk7CgkJfQoJfTsKCn0oKSk7CgovLyBzaG9ydGN1dHMgZm9yIG1vc3QgdXNlZCB1dGlsaXR5IGZ1bmN0aW9ucwpMLmV4dGVuZCA9IEwuVXRpbC5leHRlbmQ7CkwuYmluZCA9IEwuVXRpbC5iaW5kOwpMLnN0YW1wID0gTC5VdGlsLnN0YW1wOwpMLnNldE9wdGlvbnMgPSBMLlV0aWwuc2V0T3B0aW9uczsKCgovKgogKiBMLkNsYXNzIHBvd2VycyB0aGUgT09QIGZhY2lsaXRpZXMgb2YgdGhlIGxpYnJhcnkuCiAqIFRoYW5rcyB0byBKb2huIFJlc2lnIGFuZCBEZWFuIEVkd2FyZHMgZm9yIGluc3BpcmF0aW9uIQogKi8KCkwuQ2xhc3MgPSBmdW5jdGlvbiAoKSB7fTsKCkwuQ2xhc3MuZXh0ZW5kID0gZnVuY3Rpb24gKHByb3BzKSB7CgoJLy8gZXh0ZW5kZWQgY2xhc3Mgd2l0aCB0aGUgbmV3IHByb3RvdHlwZQoJdmFyIE5ld0NsYXNzID0gZnVuY3Rpb24gKCkgewoKCQkvLyBjYWxsIHRoZSBjb25zdHJ1Y3RvcgoJCWlmICh0aGlzLmluaXRpYWxpemUpIHsKCQkJdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJfQoKCQkvLyBjYWxsIGFsbCBjb25zdHJ1Y3RvciBob29rcwoJCWlmICh0aGlzLl9pbml0SG9va3MpIHsKCQkJdGhpcy5jYWxsSW5pdEhvb2tzKCk7CgkJfQoJfTsKCgkvLyBpbnN0YW50aWF0ZSBjbGFzcyB3aXRob3V0IGNhbGxpbmcgY29uc3RydWN0b3IKCXZhciBGID0gZnVuY3Rpb24gKCkge307CglGLnByb3RvdHlwZSA9IHRoaXMucHJvdG90eXBlOwoKCXZhciBwcm90byA9IG5ldyBGKCk7Cglwcm90by5jb25zdHJ1Y3RvciA9IE5ld0NsYXNzOwoKCU5ld0NsYXNzLnByb3RvdHlwZSA9IHByb3RvOwoKCS8vaW5oZXJpdCBwYXJlbnQncyBzdGF0aWNzCglmb3IgKHZhciBpIGluIHRoaXMpIHsKCQlpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShpKSAmJiBpICE9PSAncHJvdG90eXBlJykgewoJCQlOZXdDbGFzc1tpXSA9IHRoaXNbaV07CgkJfQoJfQoKCS8vIG1peCBzdGF0aWMgcHJvcGVydGllcyBpbnRvIHRoZSBjbGFzcwoJaWYgKHByb3BzLnN0YXRpY3MpIHsKCQlMLmV4dGVuZChOZXdDbGFzcywgcHJvcHMuc3RhdGljcyk7CgkJZGVsZXRlIHByb3BzLnN0YXRpY3M7Cgl9CgoJLy8gbWl4IGluY2x1ZGVzIGludG8gdGhlIHByb3RvdHlwZQoJaWYgKHByb3BzLmluY2x1ZGVzKSB7CgkJTC5VdGlsLmV4dGVuZC5hcHBseShudWxsLCBbcHJvdG9dLmNvbmNhdChwcm9wcy5pbmNsdWRlcykpOwoJCWRlbGV0ZSBwcm9wcy5pbmNsdWRlczsKCX0KCgkvLyBtZXJnZSBvcHRpb25zCglpZiAocHJvcHMub3B0aW9ucyAmJiBwcm90by5vcHRpb25zKSB7CgkJcHJvcHMub3B0aW9ucyA9IEwuZXh0ZW5kKHt9LCBwcm90by5vcHRpb25zLCBwcm9wcy5vcHRpb25zKTsKCX0KCgkvLyBtaXggZ2l2ZW4gcHJvcGVydGllcyBpbnRvIHRoZSBwcm90b3R5cGUKCUwuZXh0ZW5kKHByb3RvLCBwcm9wcyk7CgoJcHJvdG8uX2luaXRIb29rcyA9IFtdOwoKCXZhciBwYXJlbnQgPSB0aGlzOwoJLy8ganNoaW50IGNhbWVsY2FzZTogZmFsc2UKCU5ld0NsYXNzLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7CgoJLy8gYWRkIG1ldGhvZCBmb3IgY2FsbGluZyBhbGwgaG9va3MKCXByb3RvLmNhbGxJbml0SG9va3MgPSBmdW5jdGlvbiAoKSB7CgoJCWlmICh0aGlzLl9pbml0SG9va3NDYWxsZWQpIHsgcmV0dXJuOyB9CgoJCWlmIChwYXJlbnQucHJvdG90eXBlLmNhbGxJbml0SG9va3MpIHsKCQkJcGFyZW50LnByb3RvdHlwZS5jYWxsSW5pdEhvb2tzLmNhbGwodGhpcyk7CgkJfQoKCQl0aGlzLl9pbml0SG9va3NDYWxsZWQgPSB0cnVlOwoKCQlmb3IgKHZhciBpID0gMCwgbGVuID0gcHJvdG8uX2luaXRIb29rcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQlwcm90by5faW5pdEhvb2tzW2ldLmNhbGwodGhpcyk7CgkJfQoJfTsKCglyZXR1cm4gTmV3Q2xhc3M7Cn07CgoKLy8gbWV0aG9kIGZvciBhZGRpbmcgcHJvcGVydGllcyB0byBwcm90b3R5cGUKTC5DbGFzcy5pbmNsdWRlID0gZnVuY3Rpb24gKHByb3BzKSB7CglMLmV4dGVuZCh0aGlzLnByb3RvdHlwZSwgcHJvcHMpOwp9OwoKLy8gbWVyZ2UgbmV3IGRlZmF1bHQgb3B0aW9ucyB0byB0aGUgQ2xhc3MKTC5DbGFzcy5tZXJnZU9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewoJTC5leHRlbmQodGhpcy5wcm90b3R5cGUub3B0aW9ucywgb3B0aW9ucyk7Cn07CgovLyBhZGQgYSBjb25zdHJ1Y3RvciBob29rCkwuQ2xhc3MuYWRkSW5pdEhvb2sgPSBmdW5jdGlvbiAoZm4pIHsgLy8gKEZ1bmN0aW9uKSB8fCAoU3RyaW5nLCBhcmdzLi4uKQoJdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwoKCXZhciBpbml0ID0gdHlwZW9mIGZuID09PSAnZnVuY3Rpb24nID8gZm4gOiBmdW5jdGlvbiAoKSB7CgkJdGhpc1tmbl0uYXBwbHkodGhpcywgYXJncyk7Cgl9OwoKCXRoaXMucHJvdG90eXBlLl9pbml0SG9va3MgPSB0aGlzLnByb3RvdHlwZS5faW5pdEhvb2tzIHx8IFtdOwoJdGhpcy5wcm90b3R5cGUuX2luaXRIb29rcy5wdXNoKGluaXQpOwp9OwoKCi8qCiAqIEwuTWl4aW4uRXZlbnRzIGlzIHVzZWQgdG8gYWRkIGN1c3RvbSBldmVudHMgZnVuY3Rpb25hbGl0eSB0byBMZWFmbGV0IGNsYXNzZXMuCiAqLwoKdmFyIGV2ZW50c0tleSA9ICdfbGVhZmxldF9ldmVudHMnOwoKTC5NaXhpbiA9IHt9OwoKTC5NaXhpbi5FdmVudHMgPSB7CgoJYWRkRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gKHR5cGVzLCBmbiwgY29udGV4dCkgeyAvLyAoU3RyaW5nLCBGdW5jdGlvblssIE9iamVjdF0pIG9yIChPYmplY3RbLCBPYmplY3RdKQoKCQkvLyB0eXBlcyBjYW4gYmUgYSBtYXAgb2YgdHlwZXMvaGFuZGxlcnMKCQlpZiAoTC5VdGlsLmludm9rZUVhY2godHlwZXMsIHRoaXMuYWRkRXZlbnRMaXN0ZW5lciwgdGhpcywgZm4sIGNvbnRleHQpKSB7IHJldHVybiB0aGlzOyB9CgoJCXZhciBldmVudHMgPSB0aGlzW2V2ZW50c0tleV0gPSB0aGlzW2V2ZW50c0tleV0gfHwge30sCgkJICAgIGNvbnRleHRJZCA9IGNvbnRleHQgJiYgY29udGV4dCAhPT0gdGhpcyAmJiBMLnN0YW1wKGNvbnRleHQpLAoJCSAgICBpLCBsZW4sIGV2ZW50LCB0eXBlLCBpbmRleEtleSwgaW5kZXhMZW5LZXksIHR5cGVJbmRleDsKCgkJLy8gdHlwZXMgY2FuIGJlIGEgc3RyaW5nIG9mIHNwYWNlLXNlcGFyYXRlZCB3b3JkcwoJCXR5cGVzID0gTC5VdGlsLnNwbGl0V29yZHModHlwZXMpOwoKCQlmb3IgKGkgPSAwLCBsZW4gPSB0eXBlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQlldmVudCA9IHsKCQkJCWFjdGlvbjogZm4sCgkJCQljb250ZXh0OiBjb250ZXh0IHx8IHRoaXMKCQkJfTsKCQkJdHlwZSA9IHR5cGVzW2ldOwoKCQkJaWYgKGNvbnRleHRJZCkgewoJCQkJLy8gc3RvcmUgbGlzdGVuZXJzIG9mIGEgcGFydGljdWxhciBjb250ZXh0IGluIGEgc2VwYXJhdGUgaGFzaCAoaWYgaXQgaGFzIGFuIGlkKQoJCQkJLy8gZ2l2ZXMgYSBtYWpvciBwZXJmb3JtYW5jZSBib29zdCB3aGVuIHJlbW92aW5nIHRob3VzYW5kcyBvZiBtYXAgbGF5ZXJzCgoJCQkJaW5kZXhLZXkgPSB0eXBlICsgJ19pZHgnOwoJCQkJaW5kZXhMZW5LZXkgPSBpbmRleEtleSArICdfbGVuJzsKCgkJCQl0eXBlSW5kZXggPSBldmVudHNbaW5kZXhLZXldID0gZXZlbnRzW2luZGV4S2V5XSB8fCB7fTsKCgkJCQlpZiAoIXR5cGVJbmRleFtjb250ZXh0SWRdKSB7CgkJCQkJdHlwZUluZGV4W2NvbnRleHRJZF0gPSBbXTsKCgkJCQkJLy8ga2VlcCB0cmFjayBvZiB0aGUgbnVtYmVyIG9mIGtleXMgaW4gdGhlIGluZGV4IHRvIHF1aWNrbHkgY2hlY2sgaWYgaXQncyBlbXB0eQoJCQkJCWV2ZW50c1tpbmRleExlbktleV0gPSAoZXZlbnRzW2luZGV4TGVuS2V5XSB8fCAwKSArIDE7CgkJCQl9CgoJCQkJdHlwZUluZGV4W2NvbnRleHRJZF0ucHVzaChldmVudCk7CgoKCQkJfSBlbHNlIHsKCQkJCWV2ZW50c1t0eXBlXSA9IGV2ZW50c1t0eXBlXSB8fCBbXTsKCQkJCWV2ZW50c1t0eXBlXS5wdXNoKGV2ZW50KTsKCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWhhc0V2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAodHlwZSkgeyAvLyAoU3RyaW5nKSAtPiBCb29sZWFuCgkJdmFyIGV2ZW50cyA9IHRoaXNbZXZlbnRzS2V5XTsKCQlyZXR1cm4gISFldmVudHMgJiYgKCh0eXBlIGluIGV2ZW50cyAmJiBldmVudHNbdHlwZV0ubGVuZ3RoID4gMCkgfHwKCQkgICAgICAgICAgICAgICAgICAgICh0eXBlICsgJ19pZHgnIGluIGV2ZW50cyAmJiBldmVudHNbdHlwZSArICdfaWR4X2xlbiddID4gMCkpOwoJfSwKCglyZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAodHlwZXMsIGZuLCBjb250ZXh0KSB7IC8vIChbU3RyaW5nLCBGdW5jdGlvbiwgT2JqZWN0XSkgb3IgKE9iamVjdFssIE9iamVjdF0pCgoJCWlmICghdGhpc1tldmVudHNLZXldKSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJaWYgKCF0eXBlcykgewoJCQlyZXR1cm4gdGhpcy5jbGVhckFsbEV2ZW50TGlzdGVuZXJzKCk7CgkJfQoKCQlpZiAoTC5VdGlsLmludm9rZUVhY2godHlwZXMsIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lciwgdGhpcywgZm4sIGNvbnRleHQpKSB7IHJldHVybiB0aGlzOyB9CgoJCXZhciBldmVudHMgPSB0aGlzW2V2ZW50c0tleV0sCgkJICAgIGNvbnRleHRJZCA9IGNvbnRleHQgJiYgY29udGV4dCAhPT0gdGhpcyAmJiBMLnN0YW1wKGNvbnRleHQpLAoJCSAgICBpLCBsZW4sIHR5cGUsIGxpc3RlbmVycywgaiwgaW5kZXhLZXksIGluZGV4TGVuS2V5LCB0eXBlSW5kZXgsIHJlbW92ZWQ7CgoJCXR5cGVzID0gTC5VdGlsLnNwbGl0V29yZHModHlwZXMpOwoKCQlmb3IgKGkgPSAwLCBsZW4gPSB0eXBlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQl0eXBlID0gdHlwZXNbaV07CgkJCWluZGV4S2V5ID0gdHlwZSArICdfaWR4JzsKCQkJaW5kZXhMZW5LZXkgPSBpbmRleEtleSArICdfbGVuJzsKCgkJCXR5cGVJbmRleCA9IGV2ZW50c1tpbmRleEtleV07CgoJCQlpZiAoIWZuKSB7CgkJCQkvLyBjbGVhciBhbGwgbGlzdGVuZXJzIGZvciBhIHR5cGUgaWYgZnVuY3Rpb24gaXNuJ3Qgc3BlY2lmaWVkCgkJCQlkZWxldGUgZXZlbnRzW3R5cGVdOwoJCQkJZGVsZXRlIGV2ZW50c1tpbmRleEtleV07CgkJCQlkZWxldGUgZXZlbnRzW2luZGV4TGVuS2V5XTsKCgkJCX0gZWxzZSB7CgkJCQlsaXN0ZW5lcnMgPSBjb250ZXh0SWQgJiYgdHlwZUluZGV4ID8gdHlwZUluZGV4W2NvbnRleHRJZF0gOiBldmVudHNbdHlwZV07CgoJCQkJaWYgKGxpc3RlbmVycykgewoJCQkJCWZvciAoaiA9IGxpc3RlbmVycy5sZW5ndGggLSAxOyBqID49IDA7IGotLSkgewoJCQkJCQlpZiAoKGxpc3RlbmVyc1tqXS5hY3Rpb24gPT09IGZuKSAmJiAoIWNvbnRleHQgfHwgKGxpc3RlbmVyc1tqXS5jb250ZXh0ID09PSBjb250ZXh0KSkpIHsKCQkJCQkJCXJlbW92ZWQgPSBsaXN0ZW5lcnMuc3BsaWNlKGosIDEpOwoJCQkJCQkJLy8gc2V0IHRoZSBvbGQgYWN0aW9uIHRvIGEgbm8tb3AsIGJlY2F1c2UgaXQgaXMgcG9zc2libGUKCQkJCQkJCS8vIHRoYXQgdGhlIGxpc3RlbmVyIGlzIGJlaW5nIGl0ZXJhdGVkIG92ZXIgYXMgcGFydCBvZiBhIGRpc3BhdGNoCgkJCQkJCQlyZW1vdmVkWzBdLmFjdGlvbiA9IEwuVXRpbC5mYWxzZUZuOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQlpZiAoY29udGV4dCAmJiB0eXBlSW5kZXggJiYgKGxpc3RlbmVycy5sZW5ndGggPT09IDApKSB7CgkJCQkJCWRlbGV0ZSB0eXBlSW5kZXhbY29udGV4dElkXTsKCQkJCQkJZXZlbnRzW2luZGV4TGVuS2V5XS0tOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWNsZWFyQWxsRXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKCQlkZWxldGUgdGhpc1tldmVudHNLZXldOwoJCXJldHVybiB0aGlzOwoJfSwKCglmaXJlRXZlbnQ6IGZ1bmN0aW9uICh0eXBlLCBkYXRhKSB7IC8vIChTdHJpbmdbLCBPYmplY3RdKQoJCWlmICghdGhpcy5oYXNFdmVudExpc3RlbmVycyh0eXBlKSkgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCXZhciBldmVudCA9IEwuVXRpbC5leHRlbmQoe30sIGRhdGEsIHsgdHlwZTogdHlwZSwgdGFyZ2V0OiB0aGlzIH0pOwoKCQl2YXIgZXZlbnRzID0gdGhpc1tldmVudHNLZXldLAoJCSAgICBsaXN0ZW5lcnMsIGksIGxlbiwgdHlwZUluZGV4LCBjb250ZXh0SWQ7CgoJCWlmIChldmVudHNbdHlwZV0pIHsKCQkJLy8gbWFrZSBzdXJlIGFkZGluZy9yZW1vdmluZyBsaXN0ZW5lcnMgaW5zaWRlIG90aGVyIGxpc3RlbmVycyB3b24ndCBjYXVzZSBpbmZpbml0ZSBsb29wCgkJCWxpc3RlbmVycyA9IGV2ZW50c1t0eXBlXS5zbGljZSgpOwoKCQkJZm9yIChpID0gMCwgbGVuID0gbGlzdGVuZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCQlsaXN0ZW5lcnNbaV0uYWN0aW9uLmNhbGwobGlzdGVuZXJzW2ldLmNvbnRleHQsIGV2ZW50KTsKCQkJfQoJCX0KCgkJLy8gZmlyZSBldmVudCBmb3IgdGhlIGNvbnRleHQtaW5kZXhlZCBsaXN0ZW5lcnMgYXMgd2VsbAoJCXR5cGVJbmRleCA9IGV2ZW50c1t0eXBlICsgJ19pZHgnXTsKCgkJZm9yIChjb250ZXh0SWQgaW4gdHlwZUluZGV4KSB7CgkJCWxpc3RlbmVycyA9IHR5cGVJbmRleFtjb250ZXh0SWRdLnNsaWNlKCk7CgoJCQlpZiAobGlzdGVuZXJzKSB7CgkJCQlmb3IgKGkgPSAwLCBsZW4gPSBsaXN0ZW5lcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJCQlsaXN0ZW5lcnNbaV0uYWN0aW9uLmNhbGwobGlzdGVuZXJzW2ldLmNvbnRleHQsIGV2ZW50KTsKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWFkZE9uZVRpbWVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAodHlwZXMsIGZuLCBjb250ZXh0KSB7CgoJCWlmIChMLlV0aWwuaW52b2tlRWFjaCh0eXBlcywgdGhpcy5hZGRPbmVUaW1lRXZlbnRMaXN0ZW5lciwgdGhpcywgZm4sIGNvbnRleHQpKSB7IHJldHVybiB0aGlzOyB9CgoJCXZhciBoYW5kbGVyID0gTC5iaW5kKGZ1bmN0aW9uICgpIHsKCQkJdGhpcwoJCQkgICAgLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZXMsIGZuLCBjb250ZXh0KQoJCQkgICAgLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZXMsIGhhbmRsZXIsIGNvbnRleHQpOwoJCX0sIHRoaXMpOwoKCQlyZXR1cm4gdGhpcwoJCSAgICAuYWRkRXZlbnRMaXN0ZW5lcih0eXBlcywgZm4sIGNvbnRleHQpCgkJICAgIC5hZGRFdmVudExpc3RlbmVyKHR5cGVzLCBoYW5kbGVyLCBjb250ZXh0KTsKCX0KfTsKCkwuTWl4aW4uRXZlbnRzLm9uID0gTC5NaXhpbi5FdmVudHMuYWRkRXZlbnRMaXN0ZW5lcjsKTC5NaXhpbi5FdmVudHMub2ZmID0gTC5NaXhpbi5FdmVudHMucmVtb3ZlRXZlbnRMaXN0ZW5lcjsKTC5NaXhpbi5FdmVudHMub25jZSA9IEwuTWl4aW4uRXZlbnRzLmFkZE9uZVRpbWVFdmVudExpc3RlbmVyOwpMLk1peGluLkV2ZW50cy5maXJlID0gTC5NaXhpbi5FdmVudHMuZmlyZUV2ZW50OwoKCi8qCiAqIEwuQnJvd3NlciBoYW5kbGVzIGRpZmZlcmVudCBicm93c2VyIGFuZCBmZWF0dXJlIGRldGVjdGlvbnMgZm9yIGludGVybmFsIExlYWZsZXQgdXNlLgogKi8KCihmdW5jdGlvbiAoKSB7CgoJdmFyIGllID0gJ0FjdGl2ZVhPYmplY3QnIGluIHdpbmRvdywKCQlpZWx0OSA9IGllICYmICFkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyLAoKCSAgICAvLyB0ZXJyaWJsZSBicm93c2VyIGRldGVjdGlvbiB0byB3b3JrIGFyb3VuZCBTYWZhcmkgLyBpT1MgLyBBbmRyb2lkIGJyb3dzZXIgYnVncwoJICAgIHVhID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLAoJICAgIHdlYmtpdCA9IHVhLmluZGV4T2YoJ3dlYmtpdCcpICE9PSAtMSwKCSAgICBjaHJvbWUgPSB1YS5pbmRleE9mKCdjaHJvbWUnKSAhPT0gLTEsCgkgICAgcGhhbnRvbWpzID0gdWEuaW5kZXhPZigncGhhbnRvbScpICE9PSAtMSwKCSAgICBhbmRyb2lkID0gdWEuaW5kZXhPZignYW5kcm9pZCcpICE9PSAtMSwKCSAgICBhbmRyb2lkMjMgPSB1YS5zZWFyY2goJ2FuZHJvaWQgWzIzXScpICE9PSAtMSwKCQlnZWNrbyA9IHVhLmluZGV4T2YoJ2dlY2tvJykgIT09IC0xLAoKCSAgICBtb2JpbGUgPSB0eXBlb2Ygb3JpZW50YXRpb24gIT09IHVuZGVmaW5lZCArICcnLAoJICAgIG1zUG9pbnRlciA9IHdpbmRvdy5uYXZpZ2F0b3IgJiYgd2luZG93Lm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkICYmCgkgICAgICAgICAgICAgIHdpbmRvdy5uYXZpZ2F0b3IubXNNYXhUb3VjaFBvaW50cyAmJiAhd2luZG93LlBvaW50ZXJFdmVudCwKCQlwb2ludGVyID0gKHdpbmRvdy5Qb2ludGVyRXZlbnQgJiYgd2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZCAmJiB3aW5kb3cubmF2aWdhdG9yLm1heFRvdWNoUG9pbnRzKSB8fAoJCQkJICBtc1BvaW50ZXIsCgkgICAgcmV0aW5hID0gKCdkZXZpY2VQaXhlbFJhdGlvJyBpbiB3aW5kb3cgJiYgd2luZG93LmRldmljZVBpeGVsUmF0aW8gPiAxKSB8fAoJICAgICAgICAgICAgICgnbWF0Y2hNZWRpYScgaW4gd2luZG93ICYmIHdpbmRvdy5tYXRjaE1lZGlhKCcobWluLXJlc29sdXRpb246MTQ0ZHBpKScpICYmCgkgICAgICAgICAgICAgIHdpbmRvdy5tYXRjaE1lZGlhKCcobWluLXJlc29sdXRpb246MTQ0ZHBpKScpLm1hdGNoZXMpLAoKCSAgICBkb2MgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsCgkgICAgaWUzZCA9IGllICYmICgndHJhbnNpdGlvbicgaW4gZG9jLnN0eWxlKSwKCSAgICB3ZWJraXQzZCA9ICgnV2ViS2l0Q1NTTWF0cml4JyBpbiB3aW5kb3cpICYmICgnbTExJyBpbiBuZXcgd2luZG93LldlYktpdENTU01hdHJpeCgpKSAmJiAhYW5kcm9pZDIzLAoJICAgIGdlY2tvM2QgPSAnTW96UGVyc3BlY3RpdmUnIGluIGRvYy5zdHlsZSwKCSAgICBvcGVyYTNkID0gJ09UcmFuc2l0aW9uJyBpbiBkb2Muc3R5bGUsCgkgICAgYW55M2QgPSAhd2luZG93LkxfRElTQUJMRV8zRCAmJiAoaWUzZCB8fCB3ZWJraXQzZCB8fCBnZWNrbzNkIHx8IG9wZXJhM2QpICYmICFwaGFudG9tanM7CgoKCS8vIFBoYW50b21KUyBoYXMgJ29udG91Y2hzdGFydCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBidXQgZG9lc24ndCBhY3R1YWxseSBzdXBwb3J0IHRvdWNoLgoJLy8gaHR0cHM6Ly9naXRodWIuY29tL0xlYWZsZXQvTGVhZmxldC9wdWxsLzE0MzQjaXNzdWVjb21tZW50LTEzODQzMTUxCgoJdmFyIHRvdWNoID0gIXdpbmRvdy5MX05PX1RPVUNIICYmICFwaGFudG9tanMgJiYgKGZ1bmN0aW9uICgpIHsKCgkJdmFyIHN0YXJ0TmFtZSA9ICdvbnRvdWNoc3RhcnQnOwoKCQkvLyBJRTEwKyAoV2Ugc2ltdWxhdGUgdGhlc2UgaW50byB0b3VjaCogZXZlbnRzIGluIEwuRG9tRXZlbnQgYW5kIEwuRG9tRXZlbnQuUG9pbnRlcikgb3IgV2ViS2l0LCBldGMuCgkJaWYgKHBvaW50ZXIgfHwgKHN0YXJ0TmFtZSBpbiBkb2MpKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCgkJLy8gRmlyZWZveC9HZWNrbwoJCXZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkgICAgc3VwcG9ydGVkID0gZmFsc2U7CgoJCWlmICghZGl2LnNldEF0dHJpYnV0ZSkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCWRpdi5zZXRBdHRyaWJ1dGUoc3RhcnROYW1lLCAncmV0dXJuOycpOwoKCQlpZiAodHlwZW9mIGRpdltzdGFydE5hbWVdID09PSAnZnVuY3Rpb24nKSB7CgkJCXN1cHBvcnRlZCA9IHRydWU7CgkJfQoKCQlkaXYucmVtb3ZlQXR0cmlidXRlKHN0YXJ0TmFtZSk7CgkJZGl2ID0gbnVsbDsKCgkJcmV0dXJuIHN1cHBvcnRlZDsKCX0oKSk7CgoKCUwuQnJvd3NlciA9IHsKCQlpZTogaWUsCgkJaWVsdDk6IGllbHQ5LAoJCXdlYmtpdDogd2Via2l0LAoJCWdlY2tvOiBnZWNrbyAmJiAhd2Via2l0ICYmICF3aW5kb3cub3BlcmEgJiYgIWllLAoKCQlhbmRyb2lkOiBhbmRyb2lkLAoJCWFuZHJvaWQyMzogYW5kcm9pZDIzLAoKCQljaHJvbWU6IGNocm9tZSwKCgkJaWUzZDogaWUzZCwKCQl3ZWJraXQzZDogd2Via2l0M2QsCgkJZ2Vja28zZDogZ2Vja28zZCwKCQlvcGVyYTNkOiBvcGVyYTNkLAoJCWFueTNkOiBhbnkzZCwKCgkJbW9iaWxlOiBtb2JpbGUsCgkJbW9iaWxlV2Via2l0OiBtb2JpbGUgJiYgd2Via2l0LAoJCW1vYmlsZVdlYmtpdDNkOiBtb2JpbGUgJiYgd2Via2l0M2QsCgkJbW9iaWxlT3BlcmE6IG1vYmlsZSAmJiB3aW5kb3cub3BlcmEsCgoJCXRvdWNoOiB0b3VjaCwKCQltc1BvaW50ZXI6IG1zUG9pbnRlciwKCQlwb2ludGVyOiBwb2ludGVyLAoKCQlyZXRpbmE6IHJldGluYQoJfTsKCn0oKSk7CgoKLyoKICogTC5Qb2ludCByZXByZXNlbnRzIGEgcG9pbnQgd2l0aCB4IGFuZCB5IGNvb3JkaW5hdGVzLgogKi8KCkwuUG9pbnQgPSBmdW5jdGlvbiAoLypOdW1iZXIqLyB4LCAvKk51bWJlciovIHksIC8qQm9vbGVhbiovIHJvdW5kKSB7Cgl0aGlzLnggPSAocm91bmQgPyBNYXRoLnJvdW5kKHgpIDogeCk7Cgl0aGlzLnkgPSAocm91bmQgPyBNYXRoLnJvdW5kKHkpIDogeSk7Cn07CgpMLlBvaW50LnByb3RvdHlwZSA9IHsKCgljbG9uZTogZnVuY3Rpb24gKCkgewoJCXJldHVybiBuZXcgTC5Qb2ludCh0aGlzLngsIHRoaXMueSk7Cgl9LAoKCS8vIG5vbi1kZXN0cnVjdGl2ZSwgcmV0dXJucyBhIG5ldyBwb2ludAoJYWRkOiBmdW5jdGlvbiAocG9pbnQpIHsKCQlyZXR1cm4gdGhpcy5jbG9uZSgpLl9hZGQoTC5wb2ludChwb2ludCkpOwoJfSwKCgkvLyBkZXN0cnVjdGl2ZSwgdXNlZCBkaXJlY3RseSBmb3IgcGVyZm9ybWFuY2UgaW4gc2l0dWF0aW9ucyB3aGVyZSBpdCdzIHNhZmUgdG8gbW9kaWZ5IGV4aXN0aW5nIHBvaW50CglfYWRkOiBmdW5jdGlvbiAocG9pbnQpIHsKCQl0aGlzLnggKz0gcG9pbnQueDsKCQl0aGlzLnkgKz0gcG9pbnQueTsKCQlyZXR1cm4gdGhpczsKCX0sCgoJc3VidHJhY3Q6IGZ1bmN0aW9uIChwb2ludCkgewoJCXJldHVybiB0aGlzLmNsb25lKCkuX3N1YnRyYWN0KEwucG9pbnQocG9pbnQpKTsKCX0sCgoJX3N1YnRyYWN0OiBmdW5jdGlvbiAocG9pbnQpIHsKCQl0aGlzLnggLT0gcG9pbnQueDsKCQl0aGlzLnkgLT0gcG9pbnQueTsKCQlyZXR1cm4gdGhpczsKCX0sCgoJZGl2aWRlQnk6IGZ1bmN0aW9uIChudW0pIHsKCQlyZXR1cm4gdGhpcy5jbG9uZSgpLl9kaXZpZGVCeShudW0pOwoJfSwKCglfZGl2aWRlQnk6IGZ1bmN0aW9uIChudW0pIHsKCQl0aGlzLnggLz0gbnVtOwoJCXRoaXMueSAvPSBudW07CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCW11bHRpcGx5Qnk6IGZ1bmN0aW9uIChudW0pIHsKCQlyZXR1cm4gdGhpcy5jbG9uZSgpLl9tdWx0aXBseUJ5KG51bSk7Cgl9LAoKCV9tdWx0aXBseUJ5OiBmdW5jdGlvbiAobnVtKSB7CgkJdGhpcy54ICo9IG51bTsKCQl0aGlzLnkgKj0gbnVtOwoJCXJldHVybiB0aGlzOwoJfSwKCglyb3VuZDogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLmNsb25lKCkuX3JvdW5kKCk7Cgl9LAoKCV9yb3VuZDogZnVuY3Rpb24gKCkgewoJCXRoaXMueCA9IE1hdGgucm91bmQodGhpcy54KTsKCQl0aGlzLnkgPSBNYXRoLnJvdW5kKHRoaXMueSk7CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWZsb29yOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRoaXMuY2xvbmUoKS5fZmxvb3IoKTsKCX0sCgoJX2Zsb29yOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy54ID0gTWF0aC5mbG9vcih0aGlzLngpOwoJCXRoaXMueSA9IE1hdGguZmxvb3IodGhpcy55KTsKCQlyZXR1cm4gdGhpczsKCX0sCgoJZGlzdGFuY2VUbzogZnVuY3Rpb24gKHBvaW50KSB7CgkJcG9pbnQgPSBMLnBvaW50KHBvaW50KTsKCgkJdmFyIHggPSBwb2ludC54IC0gdGhpcy54LAoJCSAgICB5ID0gcG9pbnQueSAtIHRoaXMueTsKCgkJcmV0dXJuIE1hdGguc3FydCh4ICogeCArIHkgKiB5KTsKCX0sCgoJZXF1YWxzOiBmdW5jdGlvbiAocG9pbnQpIHsKCQlwb2ludCA9IEwucG9pbnQocG9pbnQpOwoKCQlyZXR1cm4gcG9pbnQueCA9PT0gdGhpcy54ICYmCgkJICAgICAgIHBvaW50LnkgPT09IHRoaXMueTsKCX0sCgoJY29udGFpbnM6IGZ1bmN0aW9uIChwb2ludCkgewoJCXBvaW50ID0gTC5wb2ludChwb2ludCk7CgoJCXJldHVybiBNYXRoLmFicyhwb2ludC54KSA8PSBNYXRoLmFicyh0aGlzLngpICYmCgkJICAgICAgIE1hdGguYWJzKHBvaW50LnkpIDw9IE1hdGguYWJzKHRoaXMueSk7Cgl9LAoKCXRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuICdQb2ludCgnICsKCQkgICAgICAgIEwuVXRpbC5mb3JtYXROdW0odGhpcy54KSArICcsICcgKwoJCSAgICAgICAgTC5VdGlsLmZvcm1hdE51bSh0aGlzLnkpICsgJyknOwoJfQp9OwoKTC5wb2ludCA9IGZ1bmN0aW9uICh4LCB5LCByb3VuZCkgewoJaWYgKHggaW5zdGFuY2VvZiBMLlBvaW50KSB7CgkJcmV0dXJuIHg7Cgl9CglpZiAoTC5VdGlsLmlzQXJyYXkoeCkpIHsKCQlyZXR1cm4gbmV3IEwuUG9pbnQoeFswXSwgeFsxXSk7Cgl9CglpZiAoeCA9PT0gdW5kZWZpbmVkIHx8IHggPT09IG51bGwpIHsKCQlyZXR1cm4geDsKCX0KCXJldHVybiBuZXcgTC5Qb2ludCh4LCB5LCByb3VuZCk7Cn07CgoKLyoKICogTC5Cb3VuZHMgcmVwcmVzZW50cyBhIHJlY3Rhbmd1bGFyIGFyZWEgb24gdGhlIHNjcmVlbiBpbiBwaXhlbCBjb29yZGluYXRlcy4KICovCgpMLkJvdW5kcyA9IGZ1bmN0aW9uIChhLCBiKSB7IC8vKFBvaW50LCBQb2ludCkgb3IgUG9pbnRbXQoJaWYgKCFhKSB7IHJldHVybjsgfQoKCXZhciBwb2ludHMgPSBiID8gW2EsIGJdIDogYTsKCglmb3IgKHZhciBpID0gMCwgbGVuID0gcG9pbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJdGhpcy5leHRlbmQocG9pbnRzW2ldKTsKCX0KfTsKCkwuQm91bmRzLnByb3RvdHlwZSA9IHsKCS8vIGV4dGVuZCB0aGUgYm91bmRzIHRvIGNvbnRhaW4gdGhlIGdpdmVuIHBvaW50CglleHRlbmQ6IGZ1bmN0aW9uIChwb2ludCkgeyAvLyAoUG9pbnQpCgkJcG9pbnQgPSBMLnBvaW50KHBvaW50KTsKCgkJaWYgKCF0aGlzLm1pbiAmJiAhdGhpcy5tYXgpIHsKCQkJdGhpcy5taW4gPSBwb2ludC5jbG9uZSgpOwoJCQl0aGlzLm1heCA9IHBvaW50LmNsb25lKCk7CgkJfSBlbHNlIHsKCQkJdGhpcy5taW4ueCA9IE1hdGgubWluKHBvaW50LngsIHRoaXMubWluLngpOwoJCQl0aGlzLm1heC54ID0gTWF0aC5tYXgocG9pbnQueCwgdGhpcy5tYXgueCk7CgkJCXRoaXMubWluLnkgPSBNYXRoLm1pbihwb2ludC55LCB0aGlzLm1pbi55KTsKCQkJdGhpcy5tYXgueSA9IE1hdGgubWF4KHBvaW50LnksIHRoaXMubWF4LnkpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJZ2V0Q2VudGVyOiBmdW5jdGlvbiAocm91bmQpIHsgLy8gKEJvb2xlYW4pIC0+IFBvaW50CgkJcmV0dXJuIG5ldyBMLlBvaW50KAoJCSAgICAgICAgKHRoaXMubWluLnggKyB0aGlzLm1heC54KSAvIDIsCgkJICAgICAgICAodGhpcy5taW4ueSArIHRoaXMubWF4LnkpIC8gMiwgcm91bmQpOwoJfSwKCglnZXRCb3R0b21MZWZ0OiBmdW5jdGlvbiAoKSB7IC8vIC0+IFBvaW50CgkJcmV0dXJuIG5ldyBMLlBvaW50KHRoaXMubWluLngsIHRoaXMubWF4LnkpOwoJfSwKCglnZXRUb3BSaWdodDogZnVuY3Rpb24gKCkgeyAvLyAtPiBQb2ludAoJCXJldHVybiBuZXcgTC5Qb2ludCh0aGlzLm1heC54LCB0aGlzLm1pbi55KTsKCX0sCgoJZ2V0U2l6ZTogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLm1heC5zdWJ0cmFjdCh0aGlzLm1pbik7Cgl9LAoKCWNvbnRhaW5zOiBmdW5jdGlvbiAob2JqKSB7IC8vIChCb3VuZHMpIG9yIChQb2ludCkgLT4gQm9vbGVhbgoJCXZhciBtaW4sIG1heDsKCgkJaWYgKHR5cGVvZiBvYmpbMF0gPT09ICdudW1iZXInIHx8IG9iaiBpbnN0YW5jZW9mIEwuUG9pbnQpIHsKCQkJb2JqID0gTC5wb2ludChvYmopOwoJCX0gZWxzZSB7CgkJCW9iaiA9IEwuYm91bmRzKG9iaik7CgkJfQoKCQlpZiAob2JqIGluc3RhbmNlb2YgTC5Cb3VuZHMpIHsKCQkJbWluID0gb2JqLm1pbjsKCQkJbWF4ID0gb2JqLm1heDsKCQl9IGVsc2UgewoJCQltaW4gPSBtYXggPSBvYmo7CgkJfQoKCQlyZXR1cm4gKG1pbi54ID49IHRoaXMubWluLngpICYmCgkJICAgICAgIChtYXgueCA8PSB0aGlzLm1heC54KSAmJgoJCSAgICAgICAobWluLnkgPj0gdGhpcy5taW4ueSkgJiYKCQkgICAgICAgKG1heC55IDw9IHRoaXMubWF4LnkpOwoJfSwKCglpbnRlcnNlY3RzOiBmdW5jdGlvbiAoYm91bmRzKSB7IC8vIChCb3VuZHMpIC0+IEJvb2xlYW4KCQlib3VuZHMgPSBMLmJvdW5kcyhib3VuZHMpOwoKCQl2YXIgbWluID0gdGhpcy5taW4sCgkJICAgIG1heCA9IHRoaXMubWF4LAoJCSAgICBtaW4yID0gYm91bmRzLm1pbiwKCQkgICAgbWF4MiA9IGJvdW5kcy5tYXgsCgkJICAgIHhJbnRlcnNlY3RzID0gKG1heDIueCA+PSBtaW4ueCkgJiYgKG1pbjIueCA8PSBtYXgueCksCgkJICAgIHlJbnRlcnNlY3RzID0gKG1heDIueSA+PSBtaW4ueSkgJiYgKG1pbjIueSA8PSBtYXgueSk7CgoJCXJldHVybiB4SW50ZXJzZWN0cyAmJiB5SW50ZXJzZWN0czsKCX0sCgoJaXNWYWxpZDogZnVuY3Rpb24gKCkgewoJCXJldHVybiAhISh0aGlzLm1pbiAmJiB0aGlzLm1heCk7Cgl9Cn07CgpMLmJvdW5kcyA9IGZ1bmN0aW9uIChhLCBiKSB7IC8vIChCb3VuZHMpIG9yIChQb2ludCwgUG9pbnQpIG9yIChQb2ludFtdKQoJaWYgKCFhIHx8IGEgaW5zdGFuY2VvZiBMLkJvdW5kcykgewoJCXJldHVybiBhOwoJfQoJcmV0dXJuIG5ldyBMLkJvdW5kcyhhLCBiKTsKfTsKCgovKgogKiBMLlRyYW5zZm9ybWF0aW9uIGlzIGFuIHV0aWxpdHkgY2xhc3MgdG8gcGVyZm9ybSBzaW1wbGUgcG9pbnQgdHJhbnNmb3JtYXRpb25zIHRocm91Z2ggYSAyZC1tYXRyaXguCiAqLwoKTC5UcmFuc2Zvcm1hdGlvbiA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7Cgl0aGlzLl9hID0gYTsKCXRoaXMuX2IgPSBiOwoJdGhpcy5fYyA9IGM7Cgl0aGlzLl9kID0gZDsKfTsKCkwuVHJhbnNmb3JtYXRpb24ucHJvdG90eXBlID0gewoJdHJhbnNmb3JtOiBmdW5jdGlvbiAocG9pbnQsIHNjYWxlKSB7IC8vIChQb2ludCwgTnVtYmVyKSAtPiBQb2ludAoJCXJldHVybiB0aGlzLl90cmFuc2Zvcm0ocG9pbnQuY2xvbmUoKSwgc2NhbGUpOwoJfSwKCgkvLyBkZXN0cnVjdGl2ZSB0cmFuc2Zvcm0gKGZhc3RlcikKCV90cmFuc2Zvcm06IGZ1bmN0aW9uIChwb2ludCwgc2NhbGUpIHsKCQlzY2FsZSA9IHNjYWxlIHx8IDE7CgkJcG9pbnQueCA9IHNjYWxlICogKHRoaXMuX2EgKiBwb2ludC54ICsgdGhpcy5fYik7CgkJcG9pbnQueSA9IHNjYWxlICogKHRoaXMuX2MgKiBwb2ludC55ICsgdGhpcy5fZCk7CgkJcmV0dXJuIHBvaW50OwoJfSwKCgl1bnRyYW5zZm9ybTogZnVuY3Rpb24gKHBvaW50LCBzY2FsZSkgewoJCXNjYWxlID0gc2NhbGUgfHwgMTsKCQlyZXR1cm4gbmV3IEwuUG9pbnQoCgkJICAgICAgICAocG9pbnQueCAvIHNjYWxlIC0gdGhpcy5fYikgLyB0aGlzLl9hLAoJCSAgICAgICAgKHBvaW50LnkgLyBzY2FsZSAtIHRoaXMuX2QpIC8gdGhpcy5fYyk7Cgl9Cn07CgoKLyoKICogTC5Eb21VdGlsIGNvbnRhaW5zIHZhcmlvdXMgdXRpbGl0eSBmdW5jdGlvbnMgZm9yIHdvcmtpbmcgd2l0aCBET00uCiAqLwoKTC5Eb21VdGlsID0gewoJZ2V0OiBmdW5jdGlvbiAoaWQpIHsKCQlyZXR1cm4gKHR5cGVvZiBpZCA9PT0gJ3N0cmluZycgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkgOiBpZCk7Cgl9LAoKCWdldFN0eWxlOiBmdW5jdGlvbiAoZWwsIHN0eWxlKSB7CgoJCXZhciB2YWx1ZSA9IGVsLnN0eWxlW3N0eWxlXTsKCgkJaWYgKCF2YWx1ZSAmJiBlbC5jdXJyZW50U3R5bGUpIHsKCQkJdmFsdWUgPSBlbC5jdXJyZW50U3R5bGVbc3R5bGVdOwoJCX0KCgkJaWYgKCghdmFsdWUgfHwgdmFsdWUgPT09ICdhdXRvJykgJiYgZG9jdW1lbnQuZGVmYXVsdFZpZXcpIHsKCQkJdmFyIGNzcyA9IGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoZWwsIG51bGwpOwoJCQl2YWx1ZSA9IGNzcyA/IGNzc1tzdHlsZV0gOiBudWxsOwoJCX0KCgkJcmV0dXJuIHZhbHVlID09PSAnYXV0bycgPyBudWxsIDogdmFsdWU7Cgl9LAoKCWdldFZpZXdwb3J0T2Zmc2V0OiBmdW5jdGlvbiAoZWxlbWVudCkgewoKCQl2YXIgdG9wID0gMCwKCQkgICAgbGVmdCA9IDAsCgkJICAgIGVsID0gZWxlbWVudCwKCQkgICAgZG9jQm9keSA9IGRvY3VtZW50LmJvZHksCgkJICAgIGRvY0VsID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LAoJCSAgICBwb3M7CgoJCWRvIHsKCQkJdG9wICArPSBlbC5vZmZzZXRUb3AgIHx8IDA7CgkJCWxlZnQgKz0gZWwub2Zmc2V0TGVmdCB8fCAwOwoKCQkJLy9hZGQgYm9yZGVycwoJCQl0b3AgKz0gcGFyc2VJbnQoTC5Eb21VdGlsLmdldFN0eWxlKGVsLCAnYm9yZGVyVG9wV2lkdGgnKSwgMTApIHx8IDA7CgkJCWxlZnQgKz0gcGFyc2VJbnQoTC5Eb21VdGlsLmdldFN0eWxlKGVsLCAnYm9yZGVyTGVmdFdpZHRoJyksIDEwKSB8fCAwOwoKCQkJcG9zID0gTC5Eb21VdGlsLmdldFN0eWxlKGVsLCAncG9zaXRpb24nKTsKCgkJCWlmIChlbC5vZmZzZXRQYXJlbnQgPT09IGRvY0JvZHkgJiYgcG9zID09PSAnYWJzb2x1dGUnKSB7IGJyZWFrOyB9CgoJCQlpZiAocG9zID09PSAnZml4ZWQnKSB7CgkJCQl0b3AgICs9IGRvY0JvZHkuc2Nyb2xsVG9wICB8fCBkb2NFbC5zY3JvbGxUb3AgIHx8IDA7CgkJCQlsZWZ0ICs9IGRvY0JvZHkuc2Nyb2xsTGVmdCB8fCBkb2NFbC5zY3JvbGxMZWZ0IHx8IDA7CgkJCQlicmVhazsKCQkJfQoKCQkJaWYgKHBvcyA9PT0gJ3JlbGF0aXZlJyAmJiAhZWwub2Zmc2V0TGVmdCkgewoJCQkJdmFyIHdpZHRoID0gTC5Eb21VdGlsLmdldFN0eWxlKGVsLCAnd2lkdGgnKSwKCQkJCSAgICBtYXhXaWR0aCA9IEwuRG9tVXRpbC5nZXRTdHlsZShlbCwgJ21heC13aWR0aCcpLAoJCQkJICAgIHIgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCgkJCQlpZiAod2lkdGggIT09ICdub25lJyB8fCBtYXhXaWR0aCAhPT0gJ25vbmUnKSB7CgkJCQkJbGVmdCArPSByLmxlZnQgKyBlbC5jbGllbnRMZWZ0OwoJCQkJfQoKCQkJCS8vY2FsY3VsYXRlIGZ1bGwgeSBvZmZzZXQgc2luY2Ugd2UncmUgYnJlYWtpbmcgb3V0IG9mIHRoZSBsb29wCgkJCQl0b3AgKz0gci50b3AgKyAoZG9jQm9keS5zY3JvbGxUb3AgIHx8IGRvY0VsLnNjcm9sbFRvcCAgfHwgMCk7CgoJCQkJYnJlYWs7CgkJCX0KCgkJCWVsID0gZWwub2Zmc2V0UGFyZW50OwoKCQl9IHdoaWxlIChlbCk7CgoJCWVsID0gZWxlbWVudDsKCgkJZG8gewoJCQlpZiAoZWwgPT09IGRvY0JvZHkpIHsgYnJlYWs7IH0KCgkJCXRvcCAgLT0gZWwuc2Nyb2xsVG9wICB8fCAwOwoJCQlsZWZ0IC09IGVsLnNjcm9sbExlZnQgfHwgMDsKCgkJCWVsID0gZWwucGFyZW50Tm9kZTsKCQl9IHdoaWxlIChlbCk7CgoJCXJldHVybiBuZXcgTC5Qb2ludChsZWZ0LCB0b3ApOwoJfSwKCglkb2N1bWVudElzTHRyOiBmdW5jdGlvbiAoKSB7CgkJaWYgKCFMLkRvbVV0aWwuX2RvY0lzTHRyQ2FjaGVkKSB7CgkJCUwuRG9tVXRpbC5fZG9jSXNMdHJDYWNoZWQgPSB0cnVlOwoJCQlMLkRvbVV0aWwuX2RvY0lzTHRyID0gTC5Eb21VdGlsLmdldFN0eWxlKGRvY3VtZW50LmJvZHksICdkaXJlY3Rpb24nKSA9PT0gJ2x0cic7CgkJfQoJCXJldHVybiBMLkRvbVV0aWwuX2RvY0lzTHRyOwoJfSwKCgljcmVhdGU6IGZ1bmN0aW9uICh0YWdOYW1lLCBjbGFzc05hbWUsIGNvbnRhaW5lcikgewoKCQl2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpOwoJCWVsLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsKCgkJaWYgKGNvbnRhaW5lcikgewoJCQljb250YWluZXIuYXBwZW5kQ2hpbGQoZWwpOwoJCX0KCgkJcmV0dXJuIGVsOwoJfSwKCgloYXNDbGFzczogZnVuY3Rpb24gKGVsLCBuYW1lKSB7CgkJaWYgKGVsLmNsYXNzTGlzdCAhPT0gdW5kZWZpbmVkKSB7CgkJCXJldHVybiBlbC5jbGFzc0xpc3QuY29udGFpbnMobmFtZSk7CgkJfQoJCXZhciBjbGFzc05hbWUgPSBMLkRvbVV0aWwuX2dldENsYXNzKGVsKTsKCQlyZXR1cm4gY2xhc3NOYW1lLmxlbmd0aCA+IDAgJiYgbmV3IFJlZ0V4cCgnKF58XFxzKScgKyBuYW1lICsgJyhcXHN8JCknKS50ZXN0KGNsYXNzTmFtZSk7Cgl9LAoKCWFkZENsYXNzOiBmdW5jdGlvbiAoZWwsIG5hbWUpIHsKCQlpZiAoZWwuY2xhc3NMaXN0ICE9PSB1bmRlZmluZWQpIHsKCQkJdmFyIGNsYXNzZXMgPSBMLlV0aWwuc3BsaXRXb3JkcyhuYW1lKTsKCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IGNsYXNzZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJCWVsLmNsYXNzTGlzdC5hZGQoY2xhc3Nlc1tpXSk7CgkJCX0KCQl9IGVsc2UgaWYgKCFMLkRvbVV0aWwuaGFzQ2xhc3MoZWwsIG5hbWUpKSB7CgkJCXZhciBjbGFzc05hbWUgPSBMLkRvbVV0aWwuX2dldENsYXNzKGVsKTsKCQkJTC5Eb21VdGlsLl9zZXRDbGFzcyhlbCwgKGNsYXNzTmFtZSA/IGNsYXNzTmFtZSArICcgJyA6ICcnKSArIG5hbWUpOwoJCX0KCX0sCgoJcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uIChlbCwgbmFtZSkgewoJCWlmIChlbC5jbGFzc0xpc3QgIT09IHVuZGVmaW5lZCkgewoJCQllbC5jbGFzc0xpc3QucmVtb3ZlKG5hbWUpOwoJCX0gZWxzZSB7CgkJCUwuRG9tVXRpbC5fc2V0Q2xhc3MoZWwsIEwuVXRpbC50cmltKCgnICcgKyBMLkRvbVV0aWwuX2dldENsYXNzKGVsKSArICcgJykucmVwbGFjZSgnICcgKyBuYW1lICsgJyAnLCAnICcpKSk7CgkJfQoJfSwKCglfc2V0Q2xhc3M6IGZ1bmN0aW9uIChlbCwgbmFtZSkgewoJCWlmIChlbC5jbGFzc05hbWUuYmFzZVZhbCA9PT0gdW5kZWZpbmVkKSB7CgkJCWVsLmNsYXNzTmFtZSA9IG5hbWU7CgkJfSBlbHNlIHsKCQkJLy8gaW4gY2FzZSBvZiBTVkcgZWxlbWVudAoJCQllbC5jbGFzc05hbWUuYmFzZVZhbCA9IG5hbWU7CgkJfQoJfSwKCglfZ2V0Q2xhc3M6IGZ1bmN0aW9uIChlbCkgewoJCXJldHVybiBlbC5jbGFzc05hbWUuYmFzZVZhbCA9PT0gdW5kZWZpbmVkID8gZWwuY2xhc3NOYW1lIDogZWwuY2xhc3NOYW1lLmJhc2VWYWw7Cgl9LAoKCXNldE9wYWNpdHk6IGZ1bmN0aW9uIChlbCwgdmFsdWUpIHsKCgkJaWYgKCdvcGFjaXR5JyBpbiBlbC5zdHlsZSkgewoJCQllbC5zdHlsZS5vcGFjaXR5ID0gdmFsdWU7CgoJCX0gZWxzZSBpZiAoJ2ZpbHRlcicgaW4gZWwuc3R5bGUpIHsKCgkJCXZhciBmaWx0ZXIgPSBmYWxzZSwKCQkJICAgIGZpbHRlck5hbWUgPSAnRFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuQWxwaGEnOwoKCQkJLy8gZmlsdGVycyBjb2xsZWN0aW9uIHRocm93cyBhbiBlcnJvciBpZiB3ZSB0cnkgdG8gcmV0cmlldmUgYSBmaWx0ZXIgdGhhdCBkb2Vzbid0IGV4aXN0CgkJCXRyeSB7CgkJCQlmaWx0ZXIgPSBlbC5maWx0ZXJzLml0ZW0oZmlsdGVyTmFtZSk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCS8vIGRvbid0IHNldCBvcGFjaXR5IHRvIDEgaWYgd2UgaGF2ZW4ndCBhbHJlYWR5IHNldCBhbiBvcGFjaXR5LAoJCQkJLy8gaXQgaXNuJ3QgbmVlZGVkIGFuZCBicmVha3MgdHJhbnNwYXJlbnQgcG5ncy4KCQkJCWlmICh2YWx1ZSA9PT0gMSkgeyByZXR1cm47IH0KCQkJfQoKCQkJdmFsdWUgPSBNYXRoLnJvdW5kKHZhbHVlICogMTAwKTsKCgkJCWlmIChmaWx0ZXIpIHsKCQkJCWZpbHRlci5FbmFibGVkID0gKHZhbHVlICE9PSAxMDApOwoJCQkJZmlsdGVyLk9wYWNpdHkgPSB2YWx1ZTsKCQkJfSBlbHNlIHsKCQkJCWVsLnN0eWxlLmZpbHRlciArPSAnIHByb2dpZDonICsgZmlsdGVyTmFtZSArICcob3BhY2l0eT0nICsgdmFsdWUgKyAnKSc7CgkJCX0KCQl9Cgl9LAoKCXRlc3RQcm9wOiBmdW5jdGlvbiAocHJvcHMpIHsKCgkJdmFyIHN0eWxlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlOwoKCQlmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CgkJCWlmIChwcm9wc1tpXSBpbiBzdHlsZSkgewoJCQkJcmV0dXJuIHByb3BzW2ldOwoJCQl9CgkJfQoJCXJldHVybiBmYWxzZTsKCX0sCgoJZ2V0VHJhbnNsYXRlU3RyaW5nOiBmdW5jdGlvbiAocG9pbnQpIHsKCQkvLyBvbiBXZWJLaXQgYnJvd3NlcnMgKENocm9tZS9TYWZhcmkvaU9TIFNhZmFyaS9BbmRyb2lkKSB1c2luZyB0cmFuc2xhdGUzZCBpbnN0ZWFkIG9mIHRyYW5zbGF0ZQoJCS8vIG1ha2VzIGFuaW1hdGlvbiBzbW9vdGhlciBhcyBpdCBlbnN1cmVzIEhXIGFjY2VsIGlzIHVzZWQuIEZpcmVmb3ggMTMgZG9lc24ndCBjYXJlCgkJLy8gKHNhbWUgc3BlZWQgZWl0aGVyIHdheSksIE9wZXJhIDEyIGRvZXNuJ3Qgc3VwcG9ydCB0cmFuc2xhdGUzZAoKCQl2YXIgaXMzZCA9IEwuQnJvd3Nlci53ZWJraXQzZCwKCQkgICAgb3BlbiA9ICd0cmFuc2xhdGUnICsgKGlzM2QgPyAnM2QnIDogJycpICsgJygnLAoJCSAgICBjbG9zZSA9IChpczNkID8gJywwJyA6ICcnKSArICcpJzsKCgkJcmV0dXJuIG9wZW4gKyBwb2ludC54ICsgJ3B4LCcgKyBwb2ludC55ICsgJ3B4JyArIGNsb3NlOwoJfSwKCglnZXRTY2FsZVN0cmluZzogZnVuY3Rpb24gKHNjYWxlLCBvcmlnaW4pIHsKCgkJdmFyIHByZVRyYW5zbGF0ZVN0ciA9IEwuRG9tVXRpbC5nZXRUcmFuc2xhdGVTdHJpbmcob3JpZ2luLmFkZChvcmlnaW4ubXVsdGlwbHlCeSgtMSAqIHNjYWxlKSkpLAoJCSAgICBzY2FsZVN0ciA9ICcgc2NhbGUoJyArIHNjYWxlICsgJykgJzsKCgkJcmV0dXJuIHByZVRyYW5zbGF0ZVN0ciArIHNjYWxlU3RyOwoJfSwKCglzZXRQb3NpdGlvbjogZnVuY3Rpb24gKGVsLCBwb2ludCwgZGlzYWJsZTNEKSB7IC8vIChIVE1MRWxlbWVudCwgUG9pbnRbLCBCb29sZWFuXSkKCgkJLy8ganNoaW50IGNhbWVsY2FzZTogZmFsc2UKCQllbC5fbGVhZmxldF9wb3MgPSBwb2ludDsKCgkJaWYgKCFkaXNhYmxlM0QgJiYgTC5Ccm93c2VyLmFueTNkKSB7CgkJCWVsLnN0eWxlW0wuRG9tVXRpbC5UUkFOU0ZPUk1dID0gIEwuRG9tVXRpbC5nZXRUcmFuc2xhdGVTdHJpbmcocG9pbnQpOwoJCX0gZWxzZSB7CgkJCWVsLnN0eWxlLmxlZnQgPSBwb2ludC54ICsgJ3B4JzsKCQkJZWwuc3R5bGUudG9wID0gcG9pbnQueSArICdweCc7CgkJfQoJfSwKCglnZXRQb3NpdGlvbjogZnVuY3Rpb24gKGVsKSB7CgkJLy8gdGhpcyBtZXRob2QgaXMgb25seSB1c2VkIGZvciBlbGVtZW50cyBwcmV2aW91c2x5IHBvc2l0aW9uZWQgdXNpbmcgc2V0UG9zaXRpb24sCgkJLy8gc28gaXQncyBzYWZlIHRvIGNhY2hlIHRoZSBwb3NpdGlvbiBmb3IgcGVyZm9ybWFuY2UKCgkJLy8ganNoaW50IGNhbWVsY2FzZTogZmFsc2UKCQlyZXR1cm4gZWwuX2xlYWZsZXRfcG9zOwoJfQp9OwoKCi8vIHByZWZpeCBzdHlsZSBwcm9wZXJ0eSBuYW1lcwoKTC5Eb21VdGlsLlRSQU5TRk9STSA9IEwuRG9tVXRpbC50ZXN0UHJvcCgKICAgICAgICBbJ3RyYW5zZm9ybScsICdXZWJraXRUcmFuc2Zvcm0nLCAnT1RyYW5zZm9ybScsICdNb3pUcmFuc2Zvcm0nLCAnbXNUcmFuc2Zvcm0nXSk7CgovLyB3ZWJraXRUcmFuc2l0aW9uIGNvbWVzIGZpcnN0IGJlY2F1c2Ugc29tZSBicm93c2VyIHZlcnNpb25zIHRoYXQgZHJvcCB2ZW5kb3IgcHJlZml4IGRvbid0IGRvCi8vIHRoZSBzYW1lIGZvciB0aGUgdHJhbnNpdGlvbmVuZCBldmVudCwgaW4gcGFydGljdWxhciB0aGUgQW5kcm9pZCA0LjEgc3RvY2sgYnJvd3NlcgoKTC5Eb21VdGlsLlRSQU5TSVRJT04gPSBMLkRvbVV0aWwudGVzdFByb3AoCiAgICAgICAgWyd3ZWJraXRUcmFuc2l0aW9uJywgJ3RyYW5zaXRpb24nLCAnT1RyYW5zaXRpb24nLCAnTW96VHJhbnNpdGlvbicsICdtc1RyYW5zaXRpb24nXSk7CgpMLkRvbVV0aWwuVFJBTlNJVElPTl9FTkQgPQogICAgICAgIEwuRG9tVXRpbC5UUkFOU0lUSU9OID09PSAnd2Via2l0VHJhbnNpdGlvbicgfHwgTC5Eb21VdGlsLlRSQU5TSVRJT04gPT09ICdPVHJhbnNpdGlvbicgPwogICAgICAgIEwuRG9tVXRpbC5UUkFOU0lUSU9OICsgJ0VuZCcgOiAndHJhbnNpdGlvbmVuZCc7CgooZnVuY3Rpb24gKCkgewogICAgaWYgKCdvbnNlbGVjdHN0YXJ0JyBpbiBkb2N1bWVudCkgewogICAgICAgIEwuZXh0ZW5kKEwuRG9tVXRpbCwgewogICAgICAgICAgICBkaXNhYmxlVGV4dFNlbGVjdGlvbjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgTC5Eb21FdmVudC5vbih3aW5kb3csICdzZWxlY3RzdGFydCcsIEwuRG9tRXZlbnQucHJldmVudERlZmF1bHQpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZW5hYmxlVGV4dFNlbGVjdGlvbjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgTC5Eb21FdmVudC5vZmYod2luZG93LCAnc2VsZWN0c3RhcnQnLCBMLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICB2YXIgdXNlclNlbGVjdFByb3BlcnR5ID0gTC5Eb21VdGlsLnRlc3RQcm9wKAogICAgICAgICAgICBbJ3VzZXJTZWxlY3QnLCAnV2Via2l0VXNlclNlbGVjdCcsICdPVXNlclNlbGVjdCcsICdNb3pVc2VyU2VsZWN0JywgJ21zVXNlclNlbGVjdCddKTsKCiAgICAgICAgTC5leHRlbmQoTC5Eb21VdGlsLCB7CiAgICAgICAgICAgIGRpc2FibGVUZXh0U2VsZWN0aW9uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAodXNlclNlbGVjdFByb3BlcnR5KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHN0eWxlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3VzZXJTZWxlY3QgPSBzdHlsZVt1c2VyU2VsZWN0UHJvcGVydHldOwogICAgICAgICAgICAgICAgICAgIHN0eWxlW3VzZXJTZWxlY3RQcm9wZXJ0eV0gPSAnbm9uZSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBlbmFibGVUZXh0U2VsZWN0aW9uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAodXNlclNlbGVjdFByb3BlcnR5KSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlW3VzZXJTZWxlY3RQcm9wZXJ0eV0gPSB0aGlzLl91c2VyU2VsZWN0OwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl91c2VyU2VsZWN0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgoJTC5leHRlbmQoTC5Eb21VdGlsLCB7CgkJZGlzYWJsZUltYWdlRHJhZzogZnVuY3Rpb24gKCkgewoJCQlMLkRvbUV2ZW50Lm9uKHdpbmRvdywgJ2RyYWdzdGFydCcsIEwuRG9tRXZlbnQucHJldmVudERlZmF1bHQpOwoJCX0sCgoJCWVuYWJsZUltYWdlRHJhZzogZnVuY3Rpb24gKCkgewoJCQlMLkRvbUV2ZW50Lm9mZih3aW5kb3csICdkcmFnc3RhcnQnLCBMLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KTsKCQl9Cgl9KTsKfSkoKTsKCgovKgogKiBMLkxhdExuZyByZXByZXNlbnRzIGEgZ2VvZ3JhcGhpY2FsIHBvaW50IHdpdGggbGF0aXR1ZGUgYW5kIGxvbmdpdHVkZSBjb29yZGluYXRlcy4KICovCgpMLkxhdExuZyA9IGZ1bmN0aW9uIChsYXQsIGxuZywgYWx0KSB7IC8vIChOdW1iZXIsIE51bWJlciwgTnVtYmVyKQoJbGF0ID0gcGFyc2VGbG9hdChsYXQpOwoJbG5nID0gcGFyc2VGbG9hdChsbmcpOwoKCWlmIChpc05hTihsYXQpIHx8IGlzTmFOKGxuZykpIHsKCQl0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgTGF0TG5nIG9iamVjdDogKCcgKyBsYXQgKyAnLCAnICsgbG5nICsgJyknKTsKCX0KCgl0aGlzLmxhdCA9IGxhdDsKCXRoaXMubG5nID0gbG5nOwoKCWlmIChhbHQgIT09IHVuZGVmaW5lZCkgewoJCXRoaXMuYWx0ID0gcGFyc2VGbG9hdChhbHQpOwoJfQp9OwoKTC5leHRlbmQoTC5MYXRMbmcsIHsKCURFR19UT19SQUQ6IE1hdGguUEkgLyAxODAsCglSQURfVE9fREVHOiAxODAgLyBNYXRoLlBJLAoJTUFYX01BUkdJTjogMS4wRS05IC8vIG1heCBtYXJnaW4gb2YgZXJyb3IgZm9yIHRoZSAiZXF1YWxzIiBjaGVjawp9KTsKCkwuTGF0TG5nLnByb3RvdHlwZSA9IHsKCWVxdWFsczogZnVuY3Rpb24gKG9iaikgeyAvLyAoTGF0TG5nKSAtPiBCb29sZWFuCgkJaWYgKCFvYmopIHsgcmV0dXJuIGZhbHNlOyB9CgoJCW9iaiA9IEwubGF0TG5nKG9iaik7CgoJCXZhciBtYXJnaW4gPSBNYXRoLm1heCgKCQkgICAgICAgIE1hdGguYWJzKHRoaXMubGF0IC0gb2JqLmxhdCksCgkJICAgICAgICBNYXRoLmFicyh0aGlzLmxuZyAtIG9iai5sbmcpKTsKCgkJcmV0dXJuIG1hcmdpbiA8PSBMLkxhdExuZy5NQVhfTUFSR0lOOwoJfSwKCgl0b1N0cmluZzogZnVuY3Rpb24gKHByZWNpc2lvbikgeyAvLyAoTnVtYmVyKSAtPiBTdHJpbmcKCQlyZXR1cm4gJ0xhdExuZygnICsKCQkgICAgICAgIEwuVXRpbC5mb3JtYXROdW0odGhpcy5sYXQsIHByZWNpc2lvbikgKyAnLCAnICsKCQkgICAgICAgIEwuVXRpbC5mb3JtYXROdW0odGhpcy5sbmcsIHByZWNpc2lvbikgKyAnKSc7Cgl9LAoKCS8vIEhhdmVyc2luZSBkaXN0YW5jZSBmb3JtdWxhLCBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9IYXZlcnNpbmVfZm9ybXVsYQoJLy8gVE9ETyBtb3ZlIHRvIHByb2plY3Rpb24gY29kZSwgTGF0TG5nIHNob3VsZG4ndCBrbm93IGFib3V0IEVhcnRoCglkaXN0YW5jZVRvOiBmdW5jdGlvbiAob3RoZXIpIHsgLy8gKExhdExuZykgLT4gTnVtYmVyCgkJb3RoZXIgPSBMLmxhdExuZyhvdGhlcik7CgoJCXZhciBSID0gNjM2NzAwMC4wLCAvLyBlYXJ0aCByYWRpdXMgaW4gbWV0ZXJzCgkJICAgIGQyciA9IEwuTGF0TG5nLkRFR19UT19SQUQsCgkJICAgIGRMYXQgPSAob3RoZXIubGF0IC0gdGhpcy5sYXQpICogZDJyLAoJCSAgICBkTG9uID0gKG90aGVyLmxuZyAtIHRoaXMubG5nKSAqIGQyciwKCQkgICAgbGF0MSA9IHRoaXMubGF0ICogZDJyLAoJCSAgICBsYXQyID0gb3RoZXIubGF0ICogZDJyLAoJCSAgICBzaW4xID0gTWF0aC5zaW4oZExhdCAvIDIpLAoJCSAgICBzaW4yID0gTWF0aC5zaW4oZExvbiAvIDIpOwoKCQl2YXIgYSA9IHNpbjEgKiBzaW4xICsgc2luMiAqIHNpbjIgKiBNYXRoLmNvcyhsYXQxKSAqIE1hdGguY29zKGxhdDIpOwoKCQlyZXR1cm4gUiAqIDIgKiBNYXRoLmF0YW4yKE1hdGguc3FydChhKSwgTWF0aC5zcXJ0KDEgLSBhKSk7Cgl9LAoKCXdyYXA6IGZ1bmN0aW9uIChhLCBiKSB7IC8vIChOdW1iZXIsIE51bWJlcikgLT4gTGF0TG5nCgkJdmFyIGxuZyA9IHRoaXMubG5nOwoKCQlhID0gYSB8fCAtMTgwOwoJCWIgPSBiIHx8ICAxODA7CgoJCWxuZyA9IChsbmcgKyBiKSAlIChiIC0gYSkgKyAobG5nIDwgYSB8fCBsbmcgPT09IGIgPyBiIDogYSk7CgoJCXJldHVybiBuZXcgTC5MYXRMbmcodGhpcy5sYXQsIGxuZyk7Cgl9Cn07CgpMLmxhdExuZyA9IGZ1bmN0aW9uIChhLCBiKSB7IC8vIChMYXRMbmcpIG9yIChbTnVtYmVyLCBOdW1iZXJdKSBvciAoTnVtYmVyLCBOdW1iZXIpCglpZiAoYSBpbnN0YW5jZW9mIEwuTGF0TG5nKSB7CgkJcmV0dXJuIGE7Cgl9CglpZiAoTC5VdGlsLmlzQXJyYXkoYSkpIHsKCQlpZiAodHlwZW9mIGFbMF0gPT09ICdudW1iZXInIHx8IHR5cGVvZiBhWzBdID09PSAnc3RyaW5nJykgewoJCQlyZXR1cm4gbmV3IEwuTGF0TG5nKGFbMF0sIGFbMV0sIGFbMl0pOwoJCX0gZWxzZSB7CgkJCXJldHVybiBudWxsOwoJCX0KCX0KCWlmIChhID09PSB1bmRlZmluZWQgfHwgYSA9PT0gbnVsbCkgewoJCXJldHVybiBhOwoJfQoJaWYgKHR5cGVvZiBhID09PSAnb2JqZWN0JyAmJiAnbGF0JyBpbiBhKSB7CgkJcmV0dXJuIG5ldyBMLkxhdExuZyhhLmxhdCwgJ2xuZycgaW4gYSA/IGEubG5nIDogYS5sb24pOwoJfQoJaWYgKGIgPT09IHVuZGVmaW5lZCkgewoJCXJldHVybiBudWxsOwoJfQoJcmV0dXJuIG5ldyBMLkxhdExuZyhhLCBiKTsKfTsKCgoKLyoKICogTC5MYXRMbmdCb3VuZHMgcmVwcmVzZW50cyBhIHJlY3Rhbmd1bGFyIGFyZWEgb24gdGhlIG1hcCBpbiBnZW9ncmFwaGljYWwgY29vcmRpbmF0ZXMuCiAqLwoKTC5MYXRMbmdCb3VuZHMgPSBmdW5jdGlvbiAoc291dGhXZXN0LCBub3J0aEVhc3QpIHsgLy8gKExhdExuZywgTGF0TG5nKSBvciAoTGF0TG5nW10pCglpZiAoIXNvdXRoV2VzdCkgeyByZXR1cm47IH0KCgl2YXIgbGF0bG5ncyA9IG5vcnRoRWFzdCA/IFtzb3V0aFdlc3QsIG5vcnRoRWFzdF0gOiBzb3V0aFdlc3Q7CgoJZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxhdGxuZ3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQl0aGlzLmV4dGVuZChsYXRsbmdzW2ldKTsKCX0KfTsKCkwuTGF0TG5nQm91bmRzLnByb3RvdHlwZSA9IHsKCS8vIGV4dGVuZCB0aGUgYm91bmRzIHRvIGNvbnRhaW4gdGhlIGdpdmVuIHBvaW50IG9yIGJvdW5kcwoJZXh0ZW5kOiBmdW5jdGlvbiAob2JqKSB7IC8vIChMYXRMbmcpIG9yIChMYXRMbmdCb3VuZHMpCgkJaWYgKCFvYmopIHsgcmV0dXJuIHRoaXM7IH0KCgkJdmFyIGxhdExuZyA9IEwubGF0TG5nKG9iaik7CgkJaWYgKGxhdExuZyAhPT0gbnVsbCkgewoJCQlvYmogPSBsYXRMbmc7CgkJfSBlbHNlIHsKCQkJb2JqID0gTC5sYXRMbmdCb3VuZHMob2JqKTsKCQl9CgoJCWlmIChvYmogaW5zdGFuY2VvZiBMLkxhdExuZykgewoJCQlpZiAoIXRoaXMuX3NvdXRoV2VzdCAmJiAhdGhpcy5fbm9ydGhFYXN0KSB7CgkJCQl0aGlzLl9zb3V0aFdlc3QgPSBuZXcgTC5MYXRMbmcob2JqLmxhdCwgb2JqLmxuZyk7CgkJCQl0aGlzLl9ub3J0aEVhc3QgPSBuZXcgTC5MYXRMbmcob2JqLmxhdCwgb2JqLmxuZyk7CgkJCX0gZWxzZSB7CgkJCQl0aGlzLl9zb3V0aFdlc3QubGF0ID0gTWF0aC5taW4ob2JqLmxhdCwgdGhpcy5fc291dGhXZXN0LmxhdCk7CgkJCQl0aGlzLl9zb3V0aFdlc3QubG5nID0gTWF0aC5taW4ob2JqLmxuZywgdGhpcy5fc291dGhXZXN0LmxuZyk7CgoJCQkJdGhpcy5fbm9ydGhFYXN0LmxhdCA9IE1hdGgubWF4KG9iai5sYXQsIHRoaXMuX25vcnRoRWFzdC5sYXQpOwoJCQkJdGhpcy5fbm9ydGhFYXN0LmxuZyA9IE1hdGgubWF4KG9iai5sbmcsIHRoaXMuX25vcnRoRWFzdC5sbmcpOwoJCQl9CgkJfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBMLkxhdExuZ0JvdW5kcykgewoJCQl0aGlzLmV4dGVuZChvYmouX3NvdXRoV2VzdCk7CgkJCXRoaXMuZXh0ZW5kKG9iai5fbm9ydGhFYXN0KTsKCQl9CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCS8vIGV4dGVuZCB0aGUgYm91bmRzIGJ5IGEgcGVyY2VudGFnZQoJcGFkOiBmdW5jdGlvbiAoYnVmZmVyUmF0aW8pIHsgLy8gKE51bWJlcikgLT4gTGF0TG5nQm91bmRzCgkJdmFyIHN3ID0gdGhpcy5fc291dGhXZXN0LAoJCSAgICBuZSA9IHRoaXMuX25vcnRoRWFzdCwKCQkgICAgaGVpZ2h0QnVmZmVyID0gTWF0aC5hYnMoc3cubGF0IC0gbmUubGF0KSAqIGJ1ZmZlclJhdGlvLAoJCSAgICB3aWR0aEJ1ZmZlciA9IE1hdGguYWJzKHN3LmxuZyAtIG5lLmxuZykgKiBidWZmZXJSYXRpbzsKCgkJcmV0dXJuIG5ldyBMLkxhdExuZ0JvdW5kcygKCQkgICAgICAgIG5ldyBMLkxhdExuZyhzdy5sYXQgLSBoZWlnaHRCdWZmZXIsIHN3LmxuZyAtIHdpZHRoQnVmZmVyKSwKCQkgICAgICAgIG5ldyBMLkxhdExuZyhuZS5sYXQgKyBoZWlnaHRCdWZmZXIsIG5lLmxuZyArIHdpZHRoQnVmZmVyKSk7Cgl9LAoKCWdldENlbnRlcjogZnVuY3Rpb24gKCkgeyAvLyAtPiBMYXRMbmcKCQlyZXR1cm4gbmV3IEwuTGF0TG5nKAoJCSAgICAgICAgKHRoaXMuX3NvdXRoV2VzdC5sYXQgKyB0aGlzLl9ub3J0aEVhc3QubGF0KSAvIDIsCgkJICAgICAgICAodGhpcy5fc291dGhXZXN0LmxuZyArIHRoaXMuX25vcnRoRWFzdC5sbmcpIC8gMik7Cgl9LAoKCWdldFNvdXRoV2VzdDogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9zb3V0aFdlc3Q7Cgl9LAoKCWdldE5vcnRoRWFzdDogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9ub3J0aEVhc3Q7Cgl9LAoKCWdldE5vcnRoV2VzdDogZnVuY3Rpb24gKCkgewoJCXJldHVybiBuZXcgTC5MYXRMbmcodGhpcy5nZXROb3J0aCgpLCB0aGlzLmdldFdlc3QoKSk7Cgl9LAoKCWdldFNvdXRoRWFzdDogZnVuY3Rpb24gKCkgewoJCXJldHVybiBuZXcgTC5MYXRMbmcodGhpcy5nZXRTb3V0aCgpLCB0aGlzLmdldEVhc3QoKSk7Cgl9LAoKCWdldFdlc3Q6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5fc291dGhXZXN0LmxuZzsKCX0sCgoJZ2V0U291dGg6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5fc291dGhXZXN0LmxhdDsKCX0sCgoJZ2V0RWFzdDogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9ub3J0aEVhc3QubG5nOwoJfSwKCglnZXROb3J0aDogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9ub3J0aEVhc3QubGF0OwoJfSwKCgljb250YWluczogZnVuY3Rpb24gKG9iaikgeyAvLyAoTGF0TG5nQm91bmRzKSBvciAoTGF0TG5nKSAtPiBCb29sZWFuCgkJaWYgKHR5cGVvZiBvYmpbMF0gPT09ICdudW1iZXInIHx8IG9iaiBpbnN0YW5jZW9mIEwuTGF0TG5nKSB7CgkJCW9iaiA9IEwubGF0TG5nKG9iaik7CgkJfSBlbHNlIHsKCQkJb2JqID0gTC5sYXRMbmdCb3VuZHMob2JqKTsKCQl9CgoJCXZhciBzdyA9IHRoaXMuX3NvdXRoV2VzdCwKCQkgICAgbmUgPSB0aGlzLl9ub3J0aEVhc3QsCgkJICAgIHN3MiwgbmUyOwoKCQlpZiAob2JqIGluc3RhbmNlb2YgTC5MYXRMbmdCb3VuZHMpIHsKCQkJc3cyID0gb2JqLmdldFNvdXRoV2VzdCgpOwoJCQluZTIgPSBvYmouZ2V0Tm9ydGhFYXN0KCk7CgkJfSBlbHNlIHsKCQkJc3cyID0gbmUyID0gb2JqOwoJCX0KCgkJcmV0dXJuIChzdzIubGF0ID49IHN3LmxhdCkgJiYgKG5lMi5sYXQgPD0gbmUubGF0KSAmJgoJCSAgICAgICAoc3cyLmxuZyA+PSBzdy5sbmcpICYmIChuZTIubG5nIDw9IG5lLmxuZyk7Cgl9LAoKCWludGVyc2VjdHM6IGZ1bmN0aW9uIChib3VuZHMpIHsgLy8gKExhdExuZ0JvdW5kcykKCQlib3VuZHMgPSBMLmxhdExuZ0JvdW5kcyhib3VuZHMpOwoKCQl2YXIgc3cgPSB0aGlzLl9zb3V0aFdlc3QsCgkJICAgIG5lID0gdGhpcy5fbm9ydGhFYXN0LAoJCSAgICBzdzIgPSBib3VuZHMuZ2V0U291dGhXZXN0KCksCgkJICAgIG5lMiA9IGJvdW5kcy5nZXROb3J0aEVhc3QoKSwKCgkJICAgIGxhdEludGVyc2VjdHMgPSAobmUyLmxhdCA+PSBzdy5sYXQpICYmIChzdzIubGF0IDw9IG5lLmxhdCksCgkJICAgIGxuZ0ludGVyc2VjdHMgPSAobmUyLmxuZyA+PSBzdy5sbmcpICYmIChzdzIubG5nIDw9IG5lLmxuZyk7CgoJCXJldHVybiBsYXRJbnRlcnNlY3RzICYmIGxuZ0ludGVyc2VjdHM7Cgl9LAoKCXRvQkJveFN0cmluZzogZnVuY3Rpb24gKCkgewoJCXJldHVybiBbdGhpcy5nZXRXZXN0KCksIHRoaXMuZ2V0U291dGgoKSwgdGhpcy5nZXRFYXN0KCksIHRoaXMuZ2V0Tm9ydGgoKV0uam9pbignLCcpOwoJfSwKCgllcXVhbHM6IGZ1bmN0aW9uIChib3VuZHMpIHsgLy8gKExhdExuZ0JvdW5kcykKCQlpZiAoIWJvdW5kcykgeyByZXR1cm4gZmFsc2U7IH0KCgkJYm91bmRzID0gTC5sYXRMbmdCb3VuZHMoYm91bmRzKTsKCgkJcmV0dXJuIHRoaXMuX3NvdXRoV2VzdC5lcXVhbHMoYm91bmRzLmdldFNvdXRoV2VzdCgpKSAmJgoJCSAgICAgICB0aGlzLl9ub3J0aEVhc3QuZXF1YWxzKGJvdW5kcy5nZXROb3J0aEVhc3QoKSk7Cgl9LAoKCWlzVmFsaWQ6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gISEodGhpcy5fc291dGhXZXN0ICYmIHRoaXMuX25vcnRoRWFzdCk7Cgl9Cn07CgovL1RPRE8gSW50ZXJuYXRpb25hbCBkYXRlIGxpbmU/CgpMLmxhdExuZ0JvdW5kcyA9IGZ1bmN0aW9uIChhLCBiKSB7IC8vIChMYXRMbmdCb3VuZHMpIG9yIChMYXRMbmcsIExhdExuZykKCWlmICghYSB8fCBhIGluc3RhbmNlb2YgTC5MYXRMbmdCb3VuZHMpIHsKCQlyZXR1cm4gYTsKCX0KCXJldHVybiBuZXcgTC5MYXRMbmdCb3VuZHMoYSwgYik7Cn07CgoKLyoKICogTC5Qcm9qZWN0aW9uIGNvbnRhaW5zIHZhcmlvdXMgZ2VvZ3JhcGhpY2FsIHByb2plY3Rpb25zIHVzZWQgYnkgQ1JTIGNsYXNzZXMuCiAqLwoKTC5Qcm9qZWN0aW9uID0ge307CgoKLyoKICogU3BoZXJpY2FsIE1lcmNhdG9yIGlzIHRoZSBtb3N0IHBvcHVsYXIgbWFwIHByb2plY3Rpb24sIHVzZWQgYnkgRVBTRzozODU3IENSUyB1c2VkIGJ5IGRlZmF1bHQuCiAqLwoKTC5Qcm9qZWN0aW9uLlNwaGVyaWNhbE1lcmNhdG9yID0gewoJTUFYX0xBVElUVURFOiA4NS4wNTExMjg3Nzk4LAoKCXByb2plY3Q6IGZ1bmN0aW9uIChsYXRsbmcpIHsgLy8gKExhdExuZykgLT4gUG9pbnQKCQl2YXIgZCA9IEwuTGF0TG5nLkRFR19UT19SQUQsCgkJICAgIG1heCA9IHRoaXMuTUFYX0xBVElUVURFLAoJCSAgICBsYXQgPSBNYXRoLm1heChNYXRoLm1pbihtYXgsIGxhdGxuZy5sYXQpLCAtbWF4KSwKCQkgICAgeCA9IGxhdGxuZy5sbmcgKiBkLAoJCSAgICB5ID0gbGF0ICogZDsKCgkJeSA9IE1hdGgubG9nKE1hdGgudGFuKChNYXRoLlBJIC8gNCkgKyAoeSAvIDIpKSk7CgoJCXJldHVybiBuZXcgTC5Qb2ludCh4LCB5KTsKCX0sCgoJdW5wcm9qZWN0OiBmdW5jdGlvbiAocG9pbnQpIHsgLy8gKFBvaW50LCBCb29sZWFuKSAtPiBMYXRMbmcKCQl2YXIgZCA9IEwuTGF0TG5nLlJBRF9UT19ERUcsCgkJICAgIGxuZyA9IHBvaW50LnggKiBkLAoJCSAgICBsYXQgPSAoMiAqIE1hdGguYXRhbihNYXRoLmV4cChwb2ludC55KSkgLSAoTWF0aC5QSSAvIDIpKSAqIGQ7CgoJCXJldHVybiBuZXcgTC5MYXRMbmcobGF0LCBsbmcpOwoJfQp9OwoKCi8qCiAqIFNpbXBsZSBlcXVpcmVjdGFuZ3VsYXIgKFBsYXRlIENhcnJlZSkgcHJvamVjdGlvbiwgdXNlZCBieSBDUlMgbGlrZSBFUFNHOjQzMjYgYW5kIFNpbXBsZS4KICovCgpMLlByb2plY3Rpb24uTG9uTGF0ID0gewoJcHJvamVjdDogZnVuY3Rpb24gKGxhdGxuZykgewoJCXJldHVybiBuZXcgTC5Qb2ludChsYXRsbmcubG5nLCBsYXRsbmcubGF0KTsKCX0sCgoJdW5wcm9qZWN0OiBmdW5jdGlvbiAocG9pbnQpIHsKCQlyZXR1cm4gbmV3IEwuTGF0TG5nKHBvaW50LnksIHBvaW50LngpOwoJfQp9OwoKCi8qCiAqIEwuQ1JTIGlzIGEgYmFzZSBvYmplY3QgZm9yIGFsbCBkZWZpbmVkIENSUyAoQ29vcmRpbmF0ZSBSZWZlcmVuY2UgU3lzdGVtcykgaW4gTGVhZmxldC4KICovCgpMLkNSUyA9IHsKCWxhdExuZ1RvUG9pbnQ6IGZ1bmN0aW9uIChsYXRsbmcsIHpvb20pIHsgLy8gKExhdExuZywgTnVtYmVyKSAtPiBQb2ludAoJCXZhciBwcm9qZWN0ZWRQb2ludCA9IHRoaXMucHJvamVjdGlvbi5wcm9qZWN0KGxhdGxuZyksCgkJICAgIHNjYWxlID0gdGhpcy5zY2FsZSh6b29tKTsKCgkJcmV0dXJuIHRoaXMudHJhbnNmb3JtYXRpb24uX3RyYW5zZm9ybShwcm9qZWN0ZWRQb2ludCwgc2NhbGUpOwoJfSwKCglwb2ludFRvTGF0TG5nOiBmdW5jdGlvbiAocG9pbnQsIHpvb20pIHsgLy8gKFBvaW50LCBOdW1iZXJbLCBCb29sZWFuXSkgLT4gTGF0TG5nCgkJdmFyIHNjYWxlID0gdGhpcy5zY2FsZSh6b29tKSwKCQkgICAgdW50cmFuc2Zvcm1lZFBvaW50ID0gdGhpcy50cmFuc2Zvcm1hdGlvbi51bnRyYW5zZm9ybShwb2ludCwgc2NhbGUpOwoKCQlyZXR1cm4gdGhpcy5wcm9qZWN0aW9uLnVucHJvamVjdCh1bnRyYW5zZm9ybWVkUG9pbnQpOwoJfSwKCglwcm9qZWN0OiBmdW5jdGlvbiAobGF0bG5nKSB7CgkJcmV0dXJuIHRoaXMucHJvamVjdGlvbi5wcm9qZWN0KGxhdGxuZyk7Cgl9LAoKCXNjYWxlOiBmdW5jdGlvbiAoem9vbSkgewoJCXJldHVybiAyNTYgKiBNYXRoLnBvdygyLCB6b29tKTsKCX0sCgoJZ2V0U2l6ZTogZnVuY3Rpb24gKHpvb20pIHsKCQl2YXIgcyA9IHRoaXMuc2NhbGUoem9vbSk7CgkJcmV0dXJuIEwucG9pbnQocywgcyk7Cgl9Cn07CgoKLyoKICogQSBzaW1wbGUgQ1JTIHRoYXQgY2FuIGJlIHVzZWQgZm9yIGZsYXQgbm9uLUVhcnRoIG1hcHMgbGlrZSBwYW5vcmFtYXMgb3IgZ2FtZSBtYXBzLgogKi8KCkwuQ1JTLlNpbXBsZSA9IEwuZXh0ZW5kKHt9LCBMLkNSUywgewoJcHJvamVjdGlvbjogTC5Qcm9qZWN0aW9uLkxvbkxhdCwKCXRyYW5zZm9ybWF0aW9uOiBuZXcgTC5UcmFuc2Zvcm1hdGlvbigxLCAwLCAtMSwgMCksCgoJc2NhbGU6IGZ1bmN0aW9uICh6b29tKSB7CgkJcmV0dXJuIE1hdGgucG93KDIsIHpvb20pOwoJfQp9KTsKCgovKgogKiBMLkNSUy5FUFNHMzg1NyAoU3BoZXJpY2FsIE1lcmNhdG9yKSBpcyB0aGUgbW9zdCBjb21tb24gQ1JTIGZvciB3ZWIgbWFwcGluZwogKiBhbmQgaXMgdXNlZCBieSBMZWFmbGV0IGJ5IGRlZmF1bHQuCiAqLwoKTC5DUlMuRVBTRzM4NTcgPSBMLmV4dGVuZCh7fSwgTC5DUlMsIHsKCWNvZGU6ICdFUFNHOjM4NTcnLAoKCXByb2plY3Rpb246IEwuUHJvamVjdGlvbi5TcGhlcmljYWxNZXJjYXRvciwKCXRyYW5zZm9ybWF0aW9uOiBuZXcgTC5UcmFuc2Zvcm1hdGlvbigwLjUgLyBNYXRoLlBJLCAwLjUsIC0wLjUgLyBNYXRoLlBJLCAwLjUpLAoKCXByb2plY3Q6IGZ1bmN0aW9uIChsYXRsbmcpIHsgLy8gKExhdExuZykgLT4gUG9pbnQKCQl2YXIgcHJvamVjdGVkUG9pbnQgPSB0aGlzLnByb2plY3Rpb24ucHJvamVjdChsYXRsbmcpLAoJCSAgICBlYXJ0aFJhZGl1cyA9IDYzNjcwMDAuMDsKCQlyZXR1cm4gcHJvamVjdGVkUG9pbnQubXVsdGlwbHlCeShlYXJ0aFJhZGl1cyk7Cgl9Cn0pOwoKTC5DUlMuRVBTRzkwMDkxMyA9IEwuZXh0ZW5kKHt9LCBMLkNSUy5FUFNHMzg1NywgewoJY29kZTogJ0VQU0c6OTAwOTEzJwp9KTsKCgovKgogKiBMLkNSUy5FUFNHNDMyNiBpcyBhIENSUyBwb3B1bGFyIGFtb25nIGFkdmFuY2VkIEdJUyBzcGVjaWFsaXN0cy4KICovCgpMLkNSUy5FUFNHNDMyNiA9IEwuZXh0ZW5kKHt9LCBMLkNSUywgewoJY29kZTogJ0VQU0c6NDMyNicsCgoJcHJvamVjdGlvbjogTC5Qcm9qZWN0aW9uLkxvbkxhdCwKCXRyYW5zZm9ybWF0aW9uOiBuZXcgTC5UcmFuc2Zvcm1hdGlvbigxIC8gMzYwLCAwLjUsIC0xIC8gMzYwLCAwLjUpCn0pOwoKCi8qCiAqIEwuTWFwIGlzIHRoZSBjZW50cmFsIGNsYXNzIG9mIHRoZSBBUEkgLSBpdCBpcyB1c2VkIHRvIGNyZWF0ZSBhIG1hcC4KICovCgpMLk1hcCA9IEwuQ2xhc3MuZXh0ZW5kKHsKCglpbmNsdWRlczogTC5NaXhpbi5FdmVudHMsCgoJb3B0aW9uczogewoJCWNyczogTC5DUlMuRVBTRzM4NTcsCgoJCS8qCgkJY2VudGVyOiBMYXRMbmcsCgkJem9vbTogTnVtYmVyLAoJCWxheWVyczogQXJyYXksCgkJKi8KCgkJZmFkZUFuaW1hdGlvbjogTC5Eb21VdGlsLlRSQU5TSVRJT04gJiYgIUwuQnJvd3Nlci5hbmRyb2lkMjMsCgkJdHJhY2tSZXNpemU6IHRydWUsCgkJbWFya2VyWm9vbUFuaW1hdGlvbjogTC5Eb21VdGlsLlRSQU5TSVRJT04gJiYgTC5Ccm93c2VyLmFueTNkCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChpZCwgb3B0aW9ucykgeyAvLyAoSFRNTEVsZW1lbnQgb3IgU3RyaW5nLCBPYmplY3QpCgkJb3B0aW9ucyA9IEwuc2V0T3B0aW9ucyh0aGlzLCBvcHRpb25zKTsKCgoJCXRoaXMuX2luaXRDb250YWluZXIoaWQpOwoJCXRoaXMuX2luaXRMYXlvdXQoKTsKCgkJLy8gaGFjayBmb3IgaHR0cHM6Ly9naXRodWIuY29tL0xlYWZsZXQvTGVhZmxldC9pc3N1ZXMvMTk4MAoJCXRoaXMuX29uUmVzaXplID0gTC5iaW5kKHRoaXMuX29uUmVzaXplLCB0aGlzKTsKCgkJdGhpcy5faW5pdEV2ZW50cygpOwoKCQlpZiAob3B0aW9ucy5tYXhCb3VuZHMpIHsKCQkJdGhpcy5zZXRNYXhCb3VuZHMob3B0aW9ucy5tYXhCb3VuZHMpOwoJCX0KCgkJaWYgKG9wdGlvbnMuY2VudGVyICYmIG9wdGlvbnMuem9vbSAhPT0gdW5kZWZpbmVkKSB7CgkJCXRoaXMuc2V0VmlldyhMLmxhdExuZyhvcHRpb25zLmNlbnRlciksIG9wdGlvbnMuem9vbSwge3Jlc2V0OiB0cnVlfSk7CgkJfQoKCQl0aGlzLl9oYW5kbGVycyA9IFtdOwoKCQl0aGlzLl9sYXllcnMgPSB7fTsKCQl0aGlzLl96b29tQm91bmRMYXllcnMgPSB7fTsKCQl0aGlzLl90aWxlTGF5ZXJzTnVtID0gMDsKCgkJdGhpcy5jYWxsSW5pdEhvb2tzKCk7CgoJCXRoaXMuX2FkZExheWVycyhvcHRpb25zLmxheWVycyk7Cgl9LAoKCgkvLyBwdWJsaWMgbWV0aG9kcyB0aGF0IG1vZGlmeSBtYXAgc3RhdGUKCgkvLyByZXBsYWNlZCBieSBhbmltYXRpb24tcG93ZXJlZCBpbXBsZW1lbnRhdGlvbiBpbiBNYXAuUGFuQW5pbWF0aW9uLmpzCglzZXRWaWV3OiBmdW5jdGlvbiAoY2VudGVyLCB6b29tKSB7CgkJem9vbSA9IHpvb20gPT09IHVuZGVmaW5lZCA/IHRoaXMuZ2V0Wm9vbSgpIDogem9vbTsKCQl0aGlzLl9yZXNldFZpZXcoTC5sYXRMbmcoY2VudGVyKSwgdGhpcy5fbGltaXRab29tKHpvb20pKTsKCQlyZXR1cm4gdGhpczsKCX0sCgoJc2V0Wm9vbTogZnVuY3Rpb24gKHpvb20sIG9wdGlvbnMpIHsKCQlpZiAoIXRoaXMuX2xvYWRlZCkgewoJCQl0aGlzLl96b29tID0gdGhpcy5fbGltaXRab29tKHpvb20pOwoJCQlyZXR1cm4gdGhpczsKCQl9CgkJcmV0dXJuIHRoaXMuc2V0Vmlldyh0aGlzLmdldENlbnRlcigpLCB6b29tLCB7em9vbTogb3B0aW9uc30pOwoJfSwKCgl6b29tSW46IGZ1bmN0aW9uIChkZWx0YSwgb3B0aW9ucykgewoJCXJldHVybiB0aGlzLnNldFpvb20odGhpcy5fem9vbSArIChkZWx0YSB8fCAxKSwgb3B0aW9ucyk7Cgl9LAoKCXpvb21PdXQ6IGZ1bmN0aW9uIChkZWx0YSwgb3B0aW9ucykgewoJCXJldHVybiB0aGlzLnNldFpvb20odGhpcy5fem9vbSAtIChkZWx0YSB8fCAxKSwgb3B0aW9ucyk7Cgl9LAoKCXNldFpvb21Bcm91bmQ6IGZ1bmN0aW9uIChsYXRsbmcsIHpvb20sIG9wdGlvbnMpIHsKCQl2YXIgc2NhbGUgPSB0aGlzLmdldFpvb21TY2FsZSh6b29tKSwKCQkgICAgdmlld0hhbGYgPSB0aGlzLmdldFNpemUoKS5kaXZpZGVCeSgyKSwKCQkgICAgY29udGFpbmVyUG9pbnQgPSBsYXRsbmcgaW5zdGFuY2VvZiBMLlBvaW50ID8gbGF0bG5nIDogdGhpcy5sYXRMbmdUb0NvbnRhaW5lclBvaW50KGxhdGxuZyksCgoJCSAgICBjZW50ZXJPZmZzZXQgPSBjb250YWluZXJQb2ludC5zdWJ0cmFjdCh2aWV3SGFsZikubXVsdGlwbHlCeSgxIC0gMSAvIHNjYWxlKSwKCQkgICAgbmV3Q2VudGVyID0gdGhpcy5jb250YWluZXJQb2ludFRvTGF0TG5nKHZpZXdIYWxmLmFkZChjZW50ZXJPZmZzZXQpKTsKCgkJcmV0dXJuIHRoaXMuc2V0VmlldyhuZXdDZW50ZXIsIHpvb20sIHt6b29tOiBvcHRpb25zfSk7Cgl9LAoKCWZpdEJvdW5kczogZnVuY3Rpb24gKGJvdW5kcywgb3B0aW9ucykgewoKCQlvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCQlib3VuZHMgPSBib3VuZHMuZ2V0Qm91bmRzID8gYm91bmRzLmdldEJvdW5kcygpIDogTC5sYXRMbmdCb3VuZHMoYm91bmRzKTsKCgkJdmFyIHBhZGRpbmdUTCA9IEwucG9pbnQob3B0aW9ucy5wYWRkaW5nVG9wTGVmdCB8fCBvcHRpb25zLnBhZGRpbmcgfHwgWzAsIDBdKSwKCQkgICAgcGFkZGluZ0JSID0gTC5wb2ludChvcHRpb25zLnBhZGRpbmdCb3R0b21SaWdodCB8fCBvcHRpb25zLnBhZGRpbmcgfHwgWzAsIDBdKSwKCgkJICAgIHpvb20gPSB0aGlzLmdldEJvdW5kc1pvb20oYm91bmRzLCBmYWxzZSwgcGFkZGluZ1RMLmFkZChwYWRkaW5nQlIpKSwKCQkgICAgcGFkZGluZ09mZnNldCA9IHBhZGRpbmdCUi5zdWJ0cmFjdChwYWRkaW5nVEwpLmRpdmlkZUJ5KDIpLAoKCQkgICAgc3dQb2ludCA9IHRoaXMucHJvamVjdChib3VuZHMuZ2V0U291dGhXZXN0KCksIHpvb20pLAoJCSAgICBuZVBvaW50ID0gdGhpcy5wcm9qZWN0KGJvdW5kcy5nZXROb3J0aEVhc3QoKSwgem9vbSksCgkJICAgIGNlbnRlciA9IHRoaXMudW5wcm9qZWN0KHN3UG9pbnQuYWRkKG5lUG9pbnQpLmRpdmlkZUJ5KDIpLmFkZChwYWRkaW5nT2Zmc2V0KSwgem9vbSk7CgoJCXpvb20gPSBvcHRpb25zICYmIG9wdGlvbnMubWF4Wm9vbSA/IE1hdGgubWluKG9wdGlvbnMubWF4Wm9vbSwgem9vbSkgOiB6b29tOwoKCQlyZXR1cm4gdGhpcy5zZXRWaWV3KGNlbnRlciwgem9vbSwgb3B0aW9ucyk7Cgl9LAoKCWZpdFdvcmxkOiBmdW5jdGlvbiAob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmZpdEJvdW5kcyhbWy05MCwgLTE4MF0sIFs5MCwgMTgwXV0sIG9wdGlvbnMpOwoJfSwKCglwYW5UbzogZnVuY3Rpb24gKGNlbnRlciwgb3B0aW9ucykgeyAvLyAoTGF0TG5nKQoJCXJldHVybiB0aGlzLnNldFZpZXcoY2VudGVyLCB0aGlzLl96b29tLCB7cGFuOiBvcHRpb25zfSk7Cgl9LAoKCXBhbkJ5OiBmdW5jdGlvbiAob2Zmc2V0KSB7IC8vIChQb2ludCkKCQkvLyByZXBsYWNlZCB3aXRoIGFuaW1hdGVkIHBhbkJ5IGluIE1hcC5QYW5BbmltYXRpb24uanMKCQl0aGlzLmZpcmUoJ21vdmVzdGFydCcpOwoKCQl0aGlzLl9yYXdQYW5CeShMLnBvaW50KG9mZnNldCkpOwoKCQl0aGlzLmZpcmUoJ21vdmUnKTsKCQlyZXR1cm4gdGhpcy5maXJlKCdtb3ZlZW5kJyk7Cgl9LAoKCXNldE1heEJvdW5kczogZnVuY3Rpb24gKGJvdW5kcykgewoJCWJvdW5kcyA9IEwubGF0TG5nQm91bmRzKGJvdW5kcyk7CgoJCXRoaXMub3B0aW9ucy5tYXhCb3VuZHMgPSBib3VuZHM7CgoJCWlmICghYm91bmRzKSB7CgkJCXJldHVybiB0aGlzLm9mZignbW92ZWVuZCcsIHRoaXMuX3Bhbkluc2lkZU1heEJvdW5kcywgdGhpcyk7CgkJfQoKCQlpZiAodGhpcy5fbG9hZGVkKSB7CgkJCXRoaXMuX3Bhbkluc2lkZU1heEJvdW5kcygpOwoJCX0KCgkJcmV0dXJuIHRoaXMub24oJ21vdmVlbmQnLCB0aGlzLl9wYW5JbnNpZGVNYXhCb3VuZHMsIHRoaXMpOwoJfSwKCglwYW5JbnNpZGVCb3VuZHM6IGZ1bmN0aW9uIChib3VuZHMsIG9wdGlvbnMpIHsKCQl2YXIgY2VudGVyID0gdGhpcy5nZXRDZW50ZXIoKSwKCQkJbmV3Q2VudGVyID0gdGhpcy5fbGltaXRDZW50ZXIoY2VudGVyLCB0aGlzLl96b29tLCBib3VuZHMpOwoKCQlpZiAoY2VudGVyLmVxdWFscyhuZXdDZW50ZXIpKSB7IHJldHVybiB0aGlzOyB9CgoJCXJldHVybiB0aGlzLnBhblRvKG5ld0NlbnRlciwgb3B0aW9ucyk7Cgl9LAoKCWFkZExheWVyOiBmdW5jdGlvbiAobGF5ZXIpIHsKCQkvLyBUT0RPIG1ldGhvZCBpcyB0b28gYmlnLCByZWZhY3RvcgoKCQl2YXIgaWQgPSBMLnN0YW1wKGxheWVyKTsKCgkJaWYgKHRoaXMuX2xheWVyc1tpZF0pIHsgcmV0dXJuIHRoaXM7IH0KCgkJdGhpcy5fbGF5ZXJzW2lkXSA9IGxheWVyOwoKCQkvLyBUT0RPIGdldE1heFpvb20sIGdldE1pblpvb20gaW4gSUxheWVyIChpbnN0ZWFkIG9mIG9wdGlvbnMpCgkJaWYgKGxheWVyLm9wdGlvbnMgJiYgKCFpc05hTihsYXllci5vcHRpb25zLm1heFpvb20pIHx8ICFpc05hTihsYXllci5vcHRpb25zLm1pblpvb20pKSkgewoJCQl0aGlzLl96b29tQm91bmRMYXllcnNbaWRdID0gbGF5ZXI7CgkJCXRoaXMuX3VwZGF0ZVpvb21MZXZlbHMoKTsKCQl9CgoJCS8vIFRPRE8gbG9va3MgdWdseSwgcmVmYWN0b3IhISEKCQlpZiAodGhpcy5vcHRpb25zLnpvb21BbmltYXRpb24gJiYgTC5UaWxlTGF5ZXIgJiYgKGxheWVyIGluc3RhbmNlb2YgTC5UaWxlTGF5ZXIpKSB7CgkJCXRoaXMuX3RpbGVMYXllcnNOdW0rKzsKCQkJdGhpcy5fdGlsZUxheWVyc1RvTG9hZCsrOwoJCQlsYXllci5vbignbG9hZCcsIHRoaXMuX29uVGlsZUxheWVyTG9hZCwgdGhpcyk7CgkJfQoKCQlpZiAodGhpcy5fbG9hZGVkKSB7CgkJCXRoaXMuX2xheWVyQWRkKGxheWVyKTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCglyZW1vdmVMYXllcjogZnVuY3Rpb24gKGxheWVyKSB7CgkJdmFyIGlkID0gTC5zdGFtcChsYXllcik7CgoJCWlmICghdGhpcy5fbGF5ZXJzW2lkXSkgeyByZXR1cm4gdGhpczsgfQoKCQlpZiAodGhpcy5fbG9hZGVkKSB7CgkJCWxheWVyLm9uUmVtb3ZlKHRoaXMpOwoJCX0KCgkJZGVsZXRlIHRoaXMuX2xheWVyc1tpZF07CgoJCWlmICh0aGlzLl9sb2FkZWQpIHsKCQkJdGhpcy5maXJlKCdsYXllcnJlbW92ZScsIHtsYXllcjogbGF5ZXJ9KTsKCQl9CgoJCWlmICh0aGlzLl96b29tQm91bmRMYXllcnNbaWRdKSB7CgkJCWRlbGV0ZSB0aGlzLl96b29tQm91bmRMYXllcnNbaWRdOwoJCQl0aGlzLl91cGRhdGVab29tTGV2ZWxzKCk7CgkJfQoKCQkvLyBUT0RPIGxvb2tzIHVnbHksIHJlZmFjdG9yCgkJaWYgKHRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uICYmIEwuVGlsZUxheWVyICYmIChsYXllciBpbnN0YW5jZW9mIEwuVGlsZUxheWVyKSkgewoJCQl0aGlzLl90aWxlTGF5ZXJzTnVtLS07CgkJCXRoaXMuX3RpbGVMYXllcnNUb0xvYWQtLTsKCQkJbGF5ZXIub2ZmKCdsb2FkJywgdGhpcy5fb25UaWxlTGF5ZXJMb2FkLCB0aGlzKTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCgloYXNMYXllcjogZnVuY3Rpb24gKGxheWVyKSB7CgkJaWYgKCFsYXllcikgeyByZXR1cm4gZmFsc2U7IH0KCgkJcmV0dXJuIChMLnN0YW1wKGxheWVyKSBpbiB0aGlzLl9sYXllcnMpOwoJfSwKCgllYWNoTGF5ZXI6IGZ1bmN0aW9uIChtZXRob2QsIGNvbnRleHQpIHsKCQlmb3IgKHZhciBpIGluIHRoaXMuX2xheWVycykgewoJCQltZXRob2QuY2FsbChjb250ZXh0LCB0aGlzLl9sYXllcnNbaV0pOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJaW52YWxpZGF0ZVNpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CgkJaWYgKCF0aGlzLl9sb2FkZWQpIHsgcmV0dXJuIHRoaXM7IH0KCgkJb3B0aW9ucyA9IEwuZXh0ZW5kKHsKCQkJYW5pbWF0ZTogZmFsc2UsCgkJCXBhbjogdHJ1ZQoJCX0sIG9wdGlvbnMgPT09IHRydWUgPyB7YW5pbWF0ZTogdHJ1ZX0gOiBvcHRpb25zKTsKCgkJdmFyIG9sZFNpemUgPSB0aGlzLmdldFNpemUoKTsKCQl0aGlzLl9zaXplQ2hhbmdlZCA9IHRydWU7CgkJdGhpcy5faW5pdGlhbENlbnRlciA9IG51bGw7CgoJCXZhciBuZXdTaXplID0gdGhpcy5nZXRTaXplKCksCgkJICAgIG9sZENlbnRlciA9IG9sZFNpemUuZGl2aWRlQnkoMikucm91bmQoKSwKCQkgICAgbmV3Q2VudGVyID0gbmV3U2l6ZS5kaXZpZGVCeSgyKS5yb3VuZCgpLAoJCSAgICBvZmZzZXQgPSBvbGRDZW50ZXIuc3VidHJhY3QobmV3Q2VudGVyKTsKCgkJaWYgKCFvZmZzZXQueCAmJiAhb2Zmc2V0LnkpIHsgcmV0dXJuIHRoaXM7IH0KCgkJaWYgKG9wdGlvbnMuYW5pbWF0ZSAmJiBvcHRpb25zLnBhbikgewoJCQl0aGlzLnBhbkJ5KG9mZnNldCk7CgoJCX0gZWxzZSB7CgkJCWlmIChvcHRpb25zLnBhbikgewoJCQkJdGhpcy5fcmF3UGFuQnkob2Zmc2V0KTsKCQkJfQoKCQkJdGhpcy5maXJlKCdtb3ZlJyk7CgoJCQlpZiAob3B0aW9ucy5kZWJvdW5jZU1vdmVlbmQpIHsKCQkJCWNsZWFyVGltZW91dCh0aGlzLl9zaXplVGltZXIpOwoJCQkJdGhpcy5fc2l6ZVRpbWVyID0gc2V0VGltZW91dChMLmJpbmQodGhpcy5maXJlLCB0aGlzLCAnbW92ZWVuZCcpLCAyMDApOwoJCQl9IGVsc2UgewoJCQkJdGhpcy5maXJlKCdtb3ZlZW5kJyk7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzLmZpcmUoJ3Jlc2l6ZScsIHsKCQkJb2xkU2l6ZTogb2xkU2l6ZSwKCQkJbmV3U2l6ZTogbmV3U2l6ZQoJCX0pOwoJfSwKCgkvLyBUT0RPIGhhbmRsZXIuYWRkVG8KCWFkZEhhbmRsZXI6IGZ1bmN0aW9uIChuYW1lLCBIYW5kbGVyQ2xhc3MpIHsKCQlpZiAoIUhhbmRsZXJDbGFzcykgeyByZXR1cm4gdGhpczsgfQoKCQl2YXIgaGFuZGxlciA9IHRoaXNbbmFtZV0gPSBuZXcgSGFuZGxlckNsYXNzKHRoaXMpOwoKCQl0aGlzLl9oYW5kbGVycy5wdXNoKGhhbmRsZXIpOwoKCQlpZiAodGhpcy5vcHRpb25zW25hbWVdKSB7CgkJCWhhbmRsZXIuZW5hYmxlKCk7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJcmVtb3ZlOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX2xvYWRlZCkgewoJCQl0aGlzLmZpcmUoJ3VubG9hZCcpOwoJCX0KCgkJdGhpcy5faW5pdEV2ZW50cygnb2ZmJyk7CgoJCXRyeSB7CgkJCS8vIHRocm93cyBlcnJvciBpbiBJRTYtOAoJCQlkZWxldGUgdGhpcy5fY29udGFpbmVyLl9sZWFmbGV0OwoJCX0gY2F0Y2ggKGUpIHsKCQkJdGhpcy5fY29udGFpbmVyLl9sZWFmbGV0ID0gdW5kZWZpbmVkOwoJCX0KCgkJdGhpcy5fY2xlYXJQYW5lcygpOwoJCWlmICh0aGlzLl9jbGVhckNvbnRyb2xQb3MpIHsKCQkJdGhpcy5fY2xlYXJDb250cm9sUG9zKCk7CgkJfQoKCQl0aGlzLl9jbGVhckhhbmRsZXJzKCk7CgoJCXJldHVybiB0aGlzOwoJfSwKCgoJLy8gcHVibGljIG1ldGhvZHMgZm9yIGdldHRpbmcgbWFwIHN0YXRlCgoJZ2V0Q2VudGVyOiBmdW5jdGlvbiAoKSB7IC8vIChCb29sZWFuKSAtPiBMYXRMbmcKCQl0aGlzLl9jaGVja0lmTG9hZGVkKCk7CgoJCWlmICh0aGlzLl9pbml0aWFsQ2VudGVyICYmICF0aGlzLl9tb3ZlZCgpKSB7CgkJCXJldHVybiB0aGlzLl9pbml0aWFsQ2VudGVyOwoJCX0KCQlyZXR1cm4gdGhpcy5sYXllclBvaW50VG9MYXRMbmcodGhpcy5fZ2V0Q2VudGVyTGF5ZXJQb2ludCgpKTsKCX0sCgoJZ2V0Wm9vbTogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl96b29tOwoJfSwKCglnZXRCb3VuZHM6IGZ1bmN0aW9uICgpIHsKCQl2YXIgYm91bmRzID0gdGhpcy5nZXRQaXhlbEJvdW5kcygpLAoJCSAgICBzdyA9IHRoaXMudW5wcm9qZWN0KGJvdW5kcy5nZXRCb3R0b21MZWZ0KCkpLAoJCSAgICBuZSA9IHRoaXMudW5wcm9qZWN0KGJvdW5kcy5nZXRUb3BSaWdodCgpKTsKCgkJcmV0dXJuIG5ldyBMLkxhdExuZ0JvdW5kcyhzdywgbmUpOwoJfSwKCglnZXRNaW5ab29tOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRoaXMub3B0aW9ucy5taW5ab29tID09PSB1bmRlZmluZWQgPwoJCQkodGhpcy5fbGF5ZXJzTWluWm9vbSA9PT0gdW5kZWZpbmVkID8gMCA6IHRoaXMuX2xheWVyc01pblpvb20pIDoKCQkJdGhpcy5vcHRpb25zLm1pblpvb207Cgl9LAoKCWdldE1heFpvb206IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5vcHRpb25zLm1heFpvb20gPT09IHVuZGVmaW5lZCA/CgkJCSh0aGlzLl9sYXllcnNNYXhab29tID09PSB1bmRlZmluZWQgPyBJbmZpbml0eSA6IHRoaXMuX2xheWVyc01heFpvb20pIDoKCQkJdGhpcy5vcHRpb25zLm1heFpvb207Cgl9LAoKCWdldEJvdW5kc1pvb206IGZ1bmN0aW9uIChib3VuZHMsIGluc2lkZSwgcGFkZGluZykgeyAvLyAoTGF0TG5nQm91bmRzWywgQm9vbGVhbiwgUG9pbnRdKSAtPiBOdW1iZXIKCQlib3VuZHMgPSBMLmxhdExuZ0JvdW5kcyhib3VuZHMpOwoKCQl2YXIgem9vbSA9IHRoaXMuZ2V0TWluWm9vbSgpIC0gKGluc2lkZSA/IDEgOiAwKSwKCQkgICAgbWF4Wm9vbSA9IHRoaXMuZ2V0TWF4Wm9vbSgpLAoJCSAgICBzaXplID0gdGhpcy5nZXRTaXplKCksCgoJCSAgICBudyA9IGJvdW5kcy5nZXROb3J0aFdlc3QoKSwKCQkgICAgc2UgPSBib3VuZHMuZ2V0U291dGhFYXN0KCksCgoJCSAgICB6b29tTm90Rm91bmQgPSB0cnVlLAoJCSAgICBib3VuZHNTaXplOwoKCQlwYWRkaW5nID0gTC5wb2ludChwYWRkaW5nIHx8IFswLCAwXSk7CgoJCWRvIHsKCQkJem9vbSsrOwoJCQlib3VuZHNTaXplID0gdGhpcy5wcm9qZWN0KHNlLCB6b29tKS5zdWJ0cmFjdCh0aGlzLnByb2plY3QobncsIHpvb20pKS5hZGQocGFkZGluZyk7CgkJCXpvb21Ob3RGb3VuZCA9ICFpbnNpZGUgPyBzaXplLmNvbnRhaW5zKGJvdW5kc1NpemUpIDogYm91bmRzU2l6ZS54IDwgc2l6ZS54IHx8IGJvdW5kc1NpemUueSA8IHNpemUueTsKCgkJfSB3aGlsZSAoem9vbU5vdEZvdW5kICYmIHpvb20gPD0gbWF4Wm9vbSk7CgoJCWlmICh6b29tTm90Rm91bmQgJiYgaW5zaWRlKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCgkJcmV0dXJuIGluc2lkZSA/IHpvb20gOiB6b29tIC0gMTsKCX0sCgoJZ2V0U2l6ZTogZnVuY3Rpb24gKCkgewoJCWlmICghdGhpcy5fc2l6ZSB8fCB0aGlzLl9zaXplQ2hhbmdlZCkgewoJCQl0aGlzLl9zaXplID0gbmV3IEwuUG9pbnQoCgkJCQl0aGlzLl9jb250YWluZXIuY2xpZW50V2lkdGgsCgkJCQl0aGlzLl9jb250YWluZXIuY2xpZW50SGVpZ2h0KTsKCgkJCXRoaXMuX3NpemVDaGFuZ2VkID0gZmFsc2U7CgkJfQoJCXJldHVybiB0aGlzLl9zaXplLmNsb25lKCk7Cgl9LAoKCWdldFBpeGVsQm91bmRzOiBmdW5jdGlvbiAoKSB7CgkJdmFyIHRvcExlZnRQb2ludCA9IHRoaXMuX2dldFRvcExlZnRQb2ludCgpOwoJCXJldHVybiBuZXcgTC5Cb3VuZHModG9wTGVmdFBvaW50LCB0b3BMZWZ0UG9pbnQuYWRkKHRoaXMuZ2V0U2l6ZSgpKSk7Cgl9LAoKCWdldFBpeGVsT3JpZ2luOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fY2hlY2tJZkxvYWRlZCgpOwoJCXJldHVybiB0aGlzLl9pbml0aWFsVG9wTGVmdFBvaW50OwoJfSwKCglnZXRQYW5lczogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9wYW5lczsKCX0sCgoJZ2V0Q29udGFpbmVyOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRoaXMuX2NvbnRhaW5lcjsKCX0sCgoKCS8vIFRPRE8gcmVwbGFjZSB3aXRoIHVuaXZlcnNhbCBpbXBsZW1lbnRhdGlvbiBhZnRlciByZWZhY3RvcmluZyBwcm9qZWN0aW9ucwoKCWdldFpvb21TY2FsZTogZnVuY3Rpb24gKHRvWm9vbSkgewoJCXZhciBjcnMgPSB0aGlzLm9wdGlvbnMuY3JzOwoJCXJldHVybiBjcnMuc2NhbGUodG9ab29tKSAvIGNycy5zY2FsZSh0aGlzLl96b29tKTsKCX0sCgoJZ2V0U2NhbGVab29tOiBmdW5jdGlvbiAoc2NhbGUpIHsKCQlyZXR1cm4gdGhpcy5fem9vbSArIChNYXRoLmxvZyhzY2FsZSkgLyBNYXRoLkxOMik7Cgl9LAoKCgkvLyBjb252ZXJzaW9uIG1ldGhvZHMKCglwcm9qZWN0OiBmdW5jdGlvbiAobGF0bG5nLCB6b29tKSB7IC8vIChMYXRMbmdbLCBOdW1iZXJdKSAtPiBQb2ludAoJCXpvb20gPSB6b29tID09PSB1bmRlZmluZWQgPyB0aGlzLl96b29tIDogem9vbTsKCQlyZXR1cm4gdGhpcy5vcHRpb25zLmNycy5sYXRMbmdUb1BvaW50KEwubGF0TG5nKGxhdGxuZyksIHpvb20pOwoJfSwKCgl1bnByb2plY3Q6IGZ1bmN0aW9uIChwb2ludCwgem9vbSkgeyAvLyAoUG9pbnRbLCBOdW1iZXJdKSAtPiBMYXRMbmcKCQl6b29tID0gem9vbSA9PT0gdW5kZWZpbmVkID8gdGhpcy5fem9vbSA6IHpvb207CgkJcmV0dXJuIHRoaXMub3B0aW9ucy5jcnMucG9pbnRUb0xhdExuZyhMLnBvaW50KHBvaW50KSwgem9vbSk7Cgl9LAoKCWxheWVyUG9pbnRUb0xhdExuZzogZnVuY3Rpb24gKHBvaW50KSB7IC8vIChQb2ludCkKCQl2YXIgcHJvamVjdGVkUG9pbnQgPSBMLnBvaW50KHBvaW50KS5hZGQodGhpcy5nZXRQaXhlbE9yaWdpbigpKTsKCQlyZXR1cm4gdGhpcy51bnByb2plY3QocHJvamVjdGVkUG9pbnQpOwoJfSwKCglsYXRMbmdUb0xheWVyUG9pbnQ6IGZ1bmN0aW9uIChsYXRsbmcpIHsgLy8gKExhdExuZykKCQl2YXIgcHJvamVjdGVkUG9pbnQgPSB0aGlzLnByb2plY3QoTC5sYXRMbmcobGF0bG5nKSkuX3JvdW5kKCk7CgkJcmV0dXJuIHByb2plY3RlZFBvaW50Ll9zdWJ0cmFjdCh0aGlzLmdldFBpeGVsT3JpZ2luKCkpOwoJfSwKCgljb250YWluZXJQb2ludFRvTGF5ZXJQb2ludDogZnVuY3Rpb24gKHBvaW50KSB7IC8vIChQb2ludCkKCQlyZXR1cm4gTC5wb2ludChwb2ludCkuc3VidHJhY3QodGhpcy5fZ2V0TWFwUGFuZVBvcygpKTsKCX0sCgoJbGF5ZXJQb2ludFRvQ29udGFpbmVyUG9pbnQ6IGZ1bmN0aW9uIChwb2ludCkgeyAvLyAoUG9pbnQpCgkJcmV0dXJuIEwucG9pbnQocG9pbnQpLmFkZCh0aGlzLl9nZXRNYXBQYW5lUG9zKCkpOwoJfSwKCgljb250YWluZXJQb2ludFRvTGF0TG5nOiBmdW5jdGlvbiAocG9pbnQpIHsKCQl2YXIgbGF5ZXJQb2ludCA9IHRoaXMuY29udGFpbmVyUG9pbnRUb0xheWVyUG9pbnQoTC5wb2ludChwb2ludCkpOwoJCXJldHVybiB0aGlzLmxheWVyUG9pbnRUb0xhdExuZyhsYXllclBvaW50KTsKCX0sCgoJbGF0TG5nVG9Db250YWluZXJQb2ludDogZnVuY3Rpb24gKGxhdGxuZykgewoJCXJldHVybiB0aGlzLmxheWVyUG9pbnRUb0NvbnRhaW5lclBvaW50KHRoaXMubGF0TG5nVG9MYXllclBvaW50KEwubGF0TG5nKGxhdGxuZykpKTsKCX0sCgoJbW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQ6IGZ1bmN0aW9uIChlKSB7IC8vIChNb3VzZUV2ZW50KQoJCXJldHVybiBMLkRvbUV2ZW50LmdldE1vdXNlUG9zaXRpb24oZSwgdGhpcy5fY29udGFpbmVyKTsKCX0sCgoJbW91c2VFdmVudFRvTGF5ZXJQb2ludDogZnVuY3Rpb24gKGUpIHsgLy8gKE1vdXNlRXZlbnQpCgkJcmV0dXJuIHRoaXMuY29udGFpbmVyUG9pbnRUb0xheWVyUG9pbnQodGhpcy5tb3VzZUV2ZW50VG9Db250YWluZXJQb2ludChlKSk7Cgl9LAoKCW1vdXNlRXZlbnRUb0xhdExuZzogZnVuY3Rpb24gKGUpIHsgLy8gKE1vdXNlRXZlbnQpCgkJcmV0dXJuIHRoaXMubGF5ZXJQb2ludFRvTGF0TG5nKHRoaXMubW91c2VFdmVudFRvTGF5ZXJQb2ludChlKSk7Cgl9LAoKCgkvLyBtYXAgaW5pdGlhbGl6YXRpb24gbWV0aG9kcwoKCV9pbml0Q29udGFpbmVyOiBmdW5jdGlvbiAoaWQpIHsKCQl2YXIgY29udGFpbmVyID0gdGhpcy5fY29udGFpbmVyID0gTC5Eb21VdGlsLmdldChpZCk7CgoJCWlmICghY29udGFpbmVyKSB7CgkJCXRocm93IG5ldyBFcnJvcignTWFwIGNvbnRhaW5lciBub3QgZm91bmQuJyk7CgkJfSBlbHNlIGlmIChjb250YWluZXIuX2xlYWZsZXQpIHsKCQkJdGhyb3cgbmV3IEVycm9yKCdNYXAgY29udGFpbmVyIGlzIGFscmVhZHkgaW5pdGlhbGl6ZWQuJyk7CgkJfQoKCQljb250YWluZXIuX2xlYWZsZXQgPSB0cnVlOwoJfSwKCglfaW5pdExheW91dDogZnVuY3Rpb24gKCkgewoJCXZhciBjb250YWluZXIgPSB0aGlzLl9jb250YWluZXI7CgoJCUwuRG9tVXRpbC5hZGRDbGFzcyhjb250YWluZXIsICdsZWFmbGV0LWNvbnRhaW5lcicgKwoJCQkoTC5Ccm93c2VyLnRvdWNoID8gJyBsZWFmbGV0LXRvdWNoJyA6ICcnKSArCgkJCShMLkJyb3dzZXIucmV0aW5hID8gJyBsZWFmbGV0LXJldGluYScgOiAnJykgKwoJCQkoTC5Ccm93c2VyLmllbHQ5ID8gJyBsZWFmbGV0LW9sZGllJyA6ICcnKSArCgkJCSh0aGlzLm9wdGlvbnMuZmFkZUFuaW1hdGlvbiA/ICcgbGVhZmxldC1mYWRlLWFuaW0nIDogJycpKTsKCgkJdmFyIHBvc2l0aW9uID0gTC5Eb21VdGlsLmdldFN0eWxlKGNvbnRhaW5lciwgJ3Bvc2l0aW9uJyk7CgoJCWlmIChwb3NpdGlvbiAhPT0gJ2Fic29sdXRlJyAmJiBwb3NpdGlvbiAhPT0gJ3JlbGF0aXZlJyAmJiBwb3NpdGlvbiAhPT0gJ2ZpeGVkJykgewoJCQljb250YWluZXIuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnOwoJCX0KCgkJdGhpcy5faW5pdFBhbmVzKCk7CgoJCWlmICh0aGlzLl9pbml0Q29udHJvbFBvcykgewoJCQl0aGlzLl9pbml0Q29udHJvbFBvcygpOwoJCX0KCX0sCgoJX2luaXRQYW5lczogZnVuY3Rpb24gKCkgewoJCXZhciBwYW5lcyA9IHRoaXMuX3BhbmVzID0ge307CgoJCXRoaXMuX21hcFBhbmUgPSBwYW5lcy5tYXBQYW5lID0gdGhpcy5fY3JlYXRlUGFuZSgnbGVhZmxldC1tYXAtcGFuZScsIHRoaXMuX2NvbnRhaW5lcik7CgoJCXRoaXMuX3RpbGVQYW5lID0gcGFuZXMudGlsZVBhbmUgPSB0aGlzLl9jcmVhdGVQYW5lKCdsZWFmbGV0LXRpbGUtcGFuZScsIHRoaXMuX21hcFBhbmUpOwoJCXBhbmVzLm9iamVjdHNQYW5lID0gdGhpcy5fY3JlYXRlUGFuZSgnbGVhZmxldC1vYmplY3RzLXBhbmUnLCB0aGlzLl9tYXBQYW5lKTsKCQlwYW5lcy5zaGFkb3dQYW5lID0gdGhpcy5fY3JlYXRlUGFuZSgnbGVhZmxldC1zaGFkb3ctcGFuZScpOwoJCXBhbmVzLm92ZXJsYXlQYW5lID0gdGhpcy5fY3JlYXRlUGFuZSgnbGVhZmxldC1vdmVybGF5LXBhbmUnKTsKCQlwYW5lcy5tYXJrZXJQYW5lID0gdGhpcy5fY3JlYXRlUGFuZSgnbGVhZmxldC1tYXJrZXItcGFuZScpOwoJCXBhbmVzLnBvcHVwUGFuZSA9IHRoaXMuX2NyZWF0ZVBhbmUoJ2xlYWZsZXQtcG9wdXAtcGFuZScpOwoKCQl2YXIgem9vbUhpZGUgPSAnIGxlYWZsZXQtem9vbS1oaWRlJzsKCgkJaWYgKCF0aGlzLm9wdGlvbnMubWFya2VyWm9vbUFuaW1hdGlvbikgewoJCQlMLkRvbVV0aWwuYWRkQ2xhc3MocGFuZXMubWFya2VyUGFuZSwgem9vbUhpZGUpOwoJCQlMLkRvbVV0aWwuYWRkQ2xhc3MocGFuZXMuc2hhZG93UGFuZSwgem9vbUhpZGUpOwoJCQlMLkRvbVV0aWwuYWRkQ2xhc3MocGFuZXMucG9wdXBQYW5lLCB6b29tSGlkZSk7CgkJfQoJfSwKCglfY3JlYXRlUGFuZTogZnVuY3Rpb24gKGNsYXNzTmFtZSwgY29udGFpbmVyKSB7CgkJcmV0dXJuIEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsIGNsYXNzTmFtZSwgY29udGFpbmVyIHx8IHRoaXMuX3BhbmVzLm9iamVjdHNQYW5lKTsKCX0sCgoJX2NsZWFyUGFuZXM6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9jb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy5fbWFwUGFuZSk7Cgl9LAoKCV9hZGRMYXllcnM6IGZ1bmN0aW9uIChsYXllcnMpIHsKCQlsYXllcnMgPSBsYXllcnMgPyAoTC5VdGlsLmlzQXJyYXkobGF5ZXJzKSA/IGxheWVycyA6IFtsYXllcnNdKSA6IFtdOwoKCQlmb3IgKHZhciBpID0gMCwgbGVuID0gbGF5ZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCXRoaXMuYWRkTGF5ZXIobGF5ZXJzW2ldKTsKCQl9Cgl9LAoKCgkvLyBwcml2YXRlIG1ldGhvZHMgdGhhdCBtb2RpZnkgbWFwIHN0YXRlCgoJX3Jlc2V0VmlldzogZnVuY3Rpb24gKGNlbnRlciwgem9vbSwgcHJlc2VydmVNYXBPZmZzZXQsIGFmdGVyWm9vbUFuaW0pIHsKCgkJdmFyIHpvb21DaGFuZ2VkID0gKHRoaXMuX3pvb20gIT09IHpvb20pOwoKCQlpZiAoIWFmdGVyWm9vbUFuaW0pIHsKCQkJdGhpcy5maXJlKCdtb3Zlc3RhcnQnKTsKCgkJCWlmICh6b29tQ2hhbmdlZCkgewoJCQkJdGhpcy5maXJlKCd6b29tc3RhcnQnKTsKCQkJfQoJCX0KCgkJdGhpcy5fem9vbSA9IHpvb207CgkJdGhpcy5faW5pdGlhbENlbnRlciA9IGNlbnRlcjsKCgkJdGhpcy5faW5pdGlhbFRvcExlZnRQb2ludCA9IHRoaXMuX2dldE5ld1RvcExlZnRQb2ludChjZW50ZXIpOwoKCQlpZiAoIXByZXNlcnZlTWFwT2Zmc2V0KSB7CgkJCUwuRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9tYXBQYW5lLCBuZXcgTC5Qb2ludCgwLCAwKSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5faW5pdGlhbFRvcExlZnRQb2ludC5fYWRkKHRoaXMuX2dldE1hcFBhbmVQb3MoKSk7CgkJfQoKCQl0aGlzLl90aWxlTGF5ZXJzVG9Mb2FkID0gdGhpcy5fdGlsZUxheWVyc051bTsKCgkJdmFyIGxvYWRpbmcgPSAhdGhpcy5fbG9hZGVkOwoJCXRoaXMuX2xvYWRlZCA9IHRydWU7CgoJCXRoaXMuZmlyZSgndmlld3Jlc2V0Jywge2hhcmQ6ICFwcmVzZXJ2ZU1hcE9mZnNldH0pOwoKCQlpZiAobG9hZGluZykgewoJCQl0aGlzLmZpcmUoJ2xvYWQnKTsKCQkJdGhpcy5lYWNoTGF5ZXIodGhpcy5fbGF5ZXJBZGQsIHRoaXMpOwoJCX0KCgkJdGhpcy5maXJlKCdtb3ZlJyk7CgoJCWlmICh6b29tQ2hhbmdlZCB8fCBhZnRlclpvb21BbmltKSB7CgkJCXRoaXMuZmlyZSgnem9vbWVuZCcpOwoJCX0KCgkJdGhpcy5maXJlKCdtb3ZlZW5kJywge2hhcmQ6ICFwcmVzZXJ2ZU1hcE9mZnNldH0pOwoJfSwKCglfcmF3UGFuQnk6IGZ1bmN0aW9uIChvZmZzZXQpIHsKCQlMLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fbWFwUGFuZSwgdGhpcy5fZ2V0TWFwUGFuZVBvcygpLnN1YnRyYWN0KG9mZnNldCkpOwoJfSwKCglfZ2V0Wm9vbVNwYW46IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5nZXRNYXhab29tKCkgLSB0aGlzLmdldE1pblpvb20oKTsKCX0sCgoJX3VwZGF0ZVpvb21MZXZlbHM6IGZ1bmN0aW9uICgpIHsKCQl2YXIgaSwKCQkJbWluWm9vbSA9IEluZmluaXR5LAoJCQltYXhab29tID0gLUluZmluaXR5LAoJCQlvbGRab29tU3BhbiA9IHRoaXMuX2dldFpvb21TcGFuKCk7CgoJCWZvciAoaSBpbiB0aGlzLl96b29tQm91bmRMYXllcnMpIHsKCQkJdmFyIGxheWVyID0gdGhpcy5fem9vbUJvdW5kTGF5ZXJzW2ldOwoJCQlpZiAoIWlzTmFOKGxheWVyLm9wdGlvbnMubWluWm9vbSkpIHsKCQkJCW1pblpvb20gPSBNYXRoLm1pbihtaW5ab29tLCBsYXllci5vcHRpb25zLm1pblpvb20pOwoJCQl9CgkJCWlmICghaXNOYU4obGF5ZXIub3B0aW9ucy5tYXhab29tKSkgewoJCQkJbWF4Wm9vbSA9IE1hdGgubWF4KG1heFpvb20sIGxheWVyLm9wdGlvbnMubWF4Wm9vbSk7CgkJCX0KCQl9CgoJCWlmIChpID09PSB1bmRlZmluZWQpIHsgLy8gd2UgaGF2ZSBubyB0aWxlbGF5ZXJzCgkJCXRoaXMuX2xheWVyc01heFpvb20gPSB0aGlzLl9sYXllcnNNaW5ab29tID0gdW5kZWZpbmVkOwoJCX0gZWxzZSB7CgkJCXRoaXMuX2xheWVyc01heFpvb20gPSBtYXhab29tOwoJCQl0aGlzLl9sYXllcnNNaW5ab29tID0gbWluWm9vbTsKCQl9CgoJCWlmIChvbGRab29tU3BhbiAhPT0gdGhpcy5fZ2V0Wm9vbVNwYW4oKSkgewoJCQl0aGlzLmZpcmUoJ3pvb21sZXZlbHNjaGFuZ2UnKTsKCQl9Cgl9LAoKCV9wYW5JbnNpZGVNYXhCb3VuZHM6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLnBhbkluc2lkZUJvdW5kcyh0aGlzLm9wdGlvbnMubWF4Qm91bmRzKTsKCX0sCgoJX2NoZWNrSWZMb2FkZWQ6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIXRoaXMuX2xvYWRlZCkgewoJCQl0aHJvdyBuZXcgRXJyb3IoJ1NldCBtYXAgY2VudGVyIGFuZCB6b29tIGZpcnN0LicpOwoJCX0KCX0sCgoJLy8gbWFwIGV2ZW50cwoKCV9pbml0RXZlbnRzOiBmdW5jdGlvbiAob25PZmYpIHsKCQlpZiAoIUwuRG9tRXZlbnQpIHsgcmV0dXJuOyB9CgoJCW9uT2ZmID0gb25PZmYgfHwgJ29uJzsKCgkJTC5Eb21FdmVudFtvbk9mZl0odGhpcy5fY29udGFpbmVyLCAnY2xpY2snLCB0aGlzLl9vbk1vdXNlQ2xpY2ssIHRoaXMpOwoKCQl2YXIgZXZlbnRzID0gWydkYmxjbGljaycsICdtb3VzZWRvd24nLCAnbW91c2V1cCcsICdtb3VzZWVudGVyJywKCQkgICAgICAgICAgICAgICdtb3VzZWxlYXZlJywgJ21vdXNlbW92ZScsICdjb250ZXh0bWVudSddLAoJCSAgICBpLCBsZW47CgoJCWZvciAoaSA9IDAsIGxlbiA9IGV2ZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQlMLkRvbUV2ZW50W29uT2ZmXSh0aGlzLl9jb250YWluZXIsIGV2ZW50c1tpXSwgdGhpcy5fZmlyZU1vdXNlRXZlbnQsIHRoaXMpOwoJCX0KCgkJaWYgKHRoaXMub3B0aW9ucy50cmFja1Jlc2l6ZSkgewoJCQlMLkRvbUV2ZW50W29uT2ZmXSh3aW5kb3csICdyZXNpemUnLCB0aGlzLl9vblJlc2l6ZSwgdGhpcyk7CgkJfQoJfSwKCglfb25SZXNpemU6IGZ1bmN0aW9uICgpIHsKCQlMLlV0aWwuY2FuY2VsQW5pbUZyYW1lKHRoaXMuX3Jlc2l6ZVJlcXVlc3QpOwoJCXRoaXMuX3Jlc2l6ZVJlcXVlc3QgPSBMLlV0aWwucmVxdWVzdEFuaW1GcmFtZSgKCQkgICAgICAgIGZ1bmN0aW9uICgpIHsgdGhpcy5pbnZhbGlkYXRlU2l6ZSh7ZGVib3VuY2VNb3ZlZW5kOiB0cnVlfSk7IH0sIHRoaXMsIGZhbHNlLCB0aGlzLl9jb250YWluZXIpOwoJfSwKCglfb25Nb3VzZUNsaWNrOiBmdW5jdGlvbiAoZSkgewoJCWlmICghdGhpcy5fbG9hZGVkIHx8ICghZS5fc2ltdWxhdGVkICYmCgkJICAgICAgICAoKHRoaXMuZHJhZ2dpbmcgJiYgdGhpcy5kcmFnZ2luZy5tb3ZlZCgpKSB8fAoJCSAgICAgICAgICh0aGlzLmJveFpvb20gICYmIHRoaXMuYm94Wm9vbS5tb3ZlZCgpKSkpIHx8CgkJICAgICAgICAgICAgTC5Eb21FdmVudC5fc2tpcHBlZChlKSkgeyByZXR1cm47IH0KCgkJdGhpcy5maXJlKCdwcmVjbGljaycpOwoJCXRoaXMuX2ZpcmVNb3VzZUV2ZW50KGUpOwoJfSwKCglfZmlyZU1vdXNlRXZlbnQ6IGZ1bmN0aW9uIChlKSB7CgkJaWYgKCF0aGlzLl9sb2FkZWQgfHwgTC5Eb21FdmVudC5fc2tpcHBlZChlKSkgeyByZXR1cm47IH0KCgkJdmFyIHR5cGUgPSBlLnR5cGU7CgoJCXR5cGUgPSAodHlwZSA9PT0gJ21vdXNlZW50ZXInID8gJ21vdXNlb3ZlcicgOiAodHlwZSA9PT0gJ21vdXNlbGVhdmUnID8gJ21vdXNlb3V0JyA6IHR5cGUpKTsKCgkJaWYgKCF0aGlzLmhhc0V2ZW50TGlzdGVuZXJzKHR5cGUpKSB7IHJldHVybjsgfQoKCQlpZiAodHlwZSA9PT0gJ2NvbnRleHRtZW51JykgewoJCQlMLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KGUpOwoJCX0KCgkJdmFyIGNvbnRhaW5lclBvaW50ID0gdGhpcy5tb3VzZUV2ZW50VG9Db250YWluZXJQb2ludChlKSwKCQkgICAgbGF5ZXJQb2ludCA9IHRoaXMuY29udGFpbmVyUG9pbnRUb0xheWVyUG9pbnQoY29udGFpbmVyUG9pbnQpLAoJCSAgICBsYXRsbmcgPSB0aGlzLmxheWVyUG9pbnRUb0xhdExuZyhsYXllclBvaW50KTsKCgkJdGhpcy5maXJlKHR5cGUsIHsKCQkJbGF0bG5nOiBsYXRsbmcsCgkJCWxheWVyUG9pbnQ6IGxheWVyUG9pbnQsCgkJCWNvbnRhaW5lclBvaW50OiBjb250YWluZXJQb2ludCwKCQkJb3JpZ2luYWxFdmVudDogZQoJCX0pOwoJfSwKCglfb25UaWxlTGF5ZXJMb2FkOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fdGlsZUxheWVyc1RvTG9hZC0tOwoJCWlmICh0aGlzLl90aWxlTGF5ZXJzTnVtICYmICF0aGlzLl90aWxlTGF5ZXJzVG9Mb2FkKSB7CgkJCXRoaXMuZmlyZSgndGlsZWxheWVyc2xvYWQnKTsKCQl9Cgl9LAoKCV9jbGVhckhhbmRsZXJzOiBmdW5jdGlvbiAoKSB7CgkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX2hhbmRsZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCXRoaXMuX2hhbmRsZXJzW2ldLmRpc2FibGUoKTsKCQl9Cgl9LAoKCXdoZW5SZWFkeTogZnVuY3Rpb24gKGNhbGxiYWNrLCBjb250ZXh0KSB7CgkJaWYgKHRoaXMuX2xvYWRlZCkgewoJCQljYWxsYmFjay5jYWxsKGNvbnRleHQgfHwgdGhpcywgdGhpcyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5vbignbG9hZCcsIGNhbGxiYWNrLCBjb250ZXh0KTsKCQl9CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCV9sYXllckFkZDogZnVuY3Rpb24gKGxheWVyKSB7CgkJbGF5ZXIub25BZGQodGhpcyk7CgkJdGhpcy5maXJlKCdsYXllcmFkZCcsIHtsYXllcjogbGF5ZXJ9KTsKCX0sCgoKCS8vIHByaXZhdGUgbWV0aG9kcyBmb3IgZ2V0dGluZyBtYXAgc3RhdGUKCglfZ2V0TWFwUGFuZVBvczogZnVuY3Rpb24gKCkgewoJCXJldHVybiBMLkRvbVV0aWwuZ2V0UG9zaXRpb24odGhpcy5fbWFwUGFuZSk7Cgl9LAoKCV9tb3ZlZDogZnVuY3Rpb24gKCkgewoJCXZhciBwb3MgPSB0aGlzLl9nZXRNYXBQYW5lUG9zKCk7CgkJcmV0dXJuIHBvcyAmJiAhcG9zLmVxdWFscyhbMCwgMF0pOwoJfSwKCglfZ2V0VG9wTGVmdFBvaW50OiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRoaXMuZ2V0UGl4ZWxPcmlnaW4oKS5zdWJ0cmFjdCh0aGlzLl9nZXRNYXBQYW5lUG9zKCkpOwoJfSwKCglfZ2V0TmV3VG9wTGVmdFBvaW50OiBmdW5jdGlvbiAoY2VudGVyLCB6b29tKSB7CgkJdmFyIHZpZXdIYWxmID0gdGhpcy5nZXRTaXplKCkuX2RpdmlkZUJ5KDIpOwoJCS8vIFRPRE8gcm91bmQgb24gZGlzcGxheSwgbm90IGNhbGN1bGF0aW9uIHRvIGluY3JlYXNlIHByZWNpc2lvbj8KCQlyZXR1cm4gdGhpcy5wcm9qZWN0KGNlbnRlciwgem9vbSkuX3N1YnRyYWN0KHZpZXdIYWxmKS5fcm91bmQoKTsKCX0sCgoJX2xhdExuZ1RvTmV3TGF5ZXJQb2ludDogZnVuY3Rpb24gKGxhdGxuZywgbmV3Wm9vbSwgbmV3Q2VudGVyKSB7CgkJdmFyIHRvcExlZnQgPSB0aGlzLl9nZXROZXdUb3BMZWZ0UG9pbnQobmV3Q2VudGVyLCBuZXdab29tKS5hZGQodGhpcy5fZ2V0TWFwUGFuZVBvcygpKTsKCQlyZXR1cm4gdGhpcy5wcm9qZWN0KGxhdGxuZywgbmV3Wm9vbSkuX3N1YnRyYWN0KHRvcExlZnQpOwoJfSwKCgkvLyBsYXllciBwb2ludCBvZiB0aGUgY3VycmVudCBjZW50ZXIKCV9nZXRDZW50ZXJMYXllclBvaW50OiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRoaXMuY29udGFpbmVyUG9pbnRUb0xheWVyUG9pbnQodGhpcy5nZXRTaXplKCkuX2RpdmlkZUJ5KDIpKTsKCX0sCgoJLy8gb2Zmc2V0IG9mIHRoZSBzcGVjaWZpZWQgcGxhY2UgdG8gdGhlIGN1cnJlbnQgY2VudGVyIGluIHBpeGVscwoJX2dldENlbnRlck9mZnNldDogZnVuY3Rpb24gKGxhdGxuZykgewoJCXJldHVybiB0aGlzLmxhdExuZ1RvTGF5ZXJQb2ludChsYXRsbmcpLnN1YnRyYWN0KHRoaXMuX2dldENlbnRlckxheWVyUG9pbnQoKSk7Cgl9LAoKCS8vIGFkanVzdCBjZW50ZXIgZm9yIHZpZXcgdG8gZ2V0IGluc2lkZSBib3VuZHMKCV9saW1pdENlbnRlcjogZnVuY3Rpb24gKGNlbnRlciwgem9vbSwgYm91bmRzKSB7CgoJCWlmICghYm91bmRzKSB7IHJldHVybiBjZW50ZXI7IH0KCgkJdmFyIGNlbnRlclBvaW50ID0gdGhpcy5wcm9qZWN0KGNlbnRlciwgem9vbSksCgkJICAgIHZpZXdIYWxmID0gdGhpcy5nZXRTaXplKCkuZGl2aWRlQnkoMiksCgkJICAgIHZpZXdCb3VuZHMgPSBuZXcgTC5Cb3VuZHMoY2VudGVyUG9pbnQuc3VidHJhY3Qodmlld0hhbGYpLCBjZW50ZXJQb2ludC5hZGQodmlld0hhbGYpKSwKCQkgICAgb2Zmc2V0ID0gdGhpcy5fZ2V0Qm91bmRzT2Zmc2V0KHZpZXdCb3VuZHMsIGJvdW5kcywgem9vbSk7CgoJCXJldHVybiB0aGlzLnVucHJvamVjdChjZW50ZXJQb2ludC5hZGQob2Zmc2V0KSwgem9vbSk7Cgl9LAoKCS8vIGFkanVzdCBvZmZzZXQgZm9yIHZpZXcgdG8gZ2V0IGluc2lkZSBib3VuZHMKCV9saW1pdE9mZnNldDogZnVuY3Rpb24gKG9mZnNldCwgYm91bmRzKSB7CgkJaWYgKCFib3VuZHMpIHsgcmV0dXJuIG9mZnNldDsgfQoKCQl2YXIgdmlld0JvdW5kcyA9IHRoaXMuZ2V0UGl4ZWxCb3VuZHMoKSwKCQkgICAgbmV3Qm91bmRzID0gbmV3IEwuQm91bmRzKHZpZXdCb3VuZHMubWluLmFkZChvZmZzZXQpLCB2aWV3Qm91bmRzLm1heC5hZGQob2Zmc2V0KSk7CgoJCXJldHVybiBvZmZzZXQuYWRkKHRoaXMuX2dldEJvdW5kc09mZnNldChuZXdCb3VuZHMsIGJvdW5kcykpOwoJfSwKCgkvLyByZXR1cm5zIG9mZnNldCBuZWVkZWQgZm9yIHB4Qm91bmRzIHRvIGdldCBpbnNpZGUgbWF4Qm91bmRzIGF0IGEgc3BlY2lmaWVkIHpvb20KCV9nZXRCb3VuZHNPZmZzZXQ6IGZ1bmN0aW9uIChweEJvdW5kcywgbWF4Qm91bmRzLCB6b29tKSB7CgkJdmFyIG53T2Zmc2V0ID0gdGhpcy5wcm9qZWN0KG1heEJvdW5kcy5nZXROb3J0aFdlc3QoKSwgem9vbSkuc3VidHJhY3QocHhCb3VuZHMubWluKSwKCQkgICAgc2VPZmZzZXQgPSB0aGlzLnByb2plY3QobWF4Qm91bmRzLmdldFNvdXRoRWFzdCgpLCB6b29tKS5zdWJ0cmFjdChweEJvdW5kcy5tYXgpLAoKCQkgICAgZHggPSB0aGlzLl9yZWJvdW5kKG53T2Zmc2V0LngsIC1zZU9mZnNldC54KSwKCQkgICAgZHkgPSB0aGlzLl9yZWJvdW5kKG53T2Zmc2V0LnksIC1zZU9mZnNldC55KTsKCgkJcmV0dXJuIG5ldyBMLlBvaW50KGR4LCBkeSk7Cgl9LAoKCV9yZWJvdW5kOiBmdW5jdGlvbiAobGVmdCwgcmlnaHQpIHsKCQlyZXR1cm4gbGVmdCArIHJpZ2h0ID4gMCA/CgkJCU1hdGgucm91bmQobGVmdCAtIHJpZ2h0KSAvIDIgOgoJCQlNYXRoLm1heCgwLCBNYXRoLmNlaWwobGVmdCkpIC0gTWF0aC5tYXgoMCwgTWF0aC5mbG9vcihyaWdodCkpOwoJfSwKCglfbGltaXRab29tOiBmdW5jdGlvbiAoem9vbSkgewoJCXZhciBtaW4gPSB0aGlzLmdldE1pblpvb20oKSwKCQkgICAgbWF4ID0gdGhpcy5nZXRNYXhab29tKCk7CgoJCXJldHVybiBNYXRoLm1heChtaW4sIE1hdGgubWluKG1heCwgem9vbSkpOwoJfQp9KTsKCkwubWFwID0gZnVuY3Rpb24gKGlkLCBvcHRpb25zKSB7CglyZXR1cm4gbmV3IEwuTWFwKGlkLCBvcHRpb25zKTsKfTsKCgovKgogKiBNZXJjYXRvciBwcm9qZWN0aW9uIHRoYXQgdGFrZXMgaW50byBhY2NvdW50IHRoYXQgdGhlIEVhcnRoIGlzIG5vdCBhIHBlcmZlY3Qgc3BoZXJlLgogKiBMZXNzIHBvcHVsYXIgdGhhbiBzcGhlcmljYWwgbWVyY2F0b3I7IHVzZWQgYnkgcHJvamVjdGlvbnMgbGlrZSBFUFNHOjMzOTUuCiAqLwoKTC5Qcm9qZWN0aW9uLk1lcmNhdG9yID0gewoJTUFYX0xBVElUVURFOiA4NS4wODQwNTkxNTU2LAoKCVJfTUlOT1I6IDYzNTY3NTIuMzE0MjQ1MTc5LAoJUl9NQUpPUjogNjM3ODEzNywKCglwcm9qZWN0OiBmdW5jdGlvbiAobGF0bG5nKSB7IC8vIChMYXRMbmcpIC0+IFBvaW50CgkJdmFyIGQgPSBMLkxhdExuZy5ERUdfVE9fUkFELAoJCSAgICBtYXggPSB0aGlzLk1BWF9MQVRJVFVERSwKCQkgICAgbGF0ID0gTWF0aC5tYXgoTWF0aC5taW4obWF4LCBsYXRsbmcubGF0KSwgLW1heCksCgkJICAgIHIgPSB0aGlzLlJfTUFKT1IsCgkJICAgIHIyID0gdGhpcy5SX01JTk9SLAoJCSAgICB4ID0gbGF0bG5nLmxuZyAqIGQgKiByLAoJCSAgICB5ID0gbGF0ICogZCwKCQkgICAgdG1wID0gcjIgLyByLAoJCSAgICBlY2NlbnQgPSBNYXRoLnNxcnQoMS4wIC0gdG1wICogdG1wKSwKCQkgICAgY29uID0gZWNjZW50ICogTWF0aC5zaW4oeSk7CgoJCWNvbiA9IE1hdGgucG93KCgxIC0gY29uKSAvICgxICsgY29uKSwgZWNjZW50ICogMC41KTsKCgkJdmFyIHRzID0gTWF0aC50YW4oMC41ICogKChNYXRoLlBJICogMC41KSAtIHkpKSAvIGNvbjsKCQl5ID0gLXIgKiBNYXRoLmxvZyh0cyk7CgoJCXJldHVybiBuZXcgTC5Qb2ludCh4LCB5KTsKCX0sCgoJdW5wcm9qZWN0OiBmdW5jdGlvbiAocG9pbnQpIHsgLy8gKFBvaW50LCBCb29sZWFuKSAtPiBMYXRMbmcKCQl2YXIgZCA9IEwuTGF0TG5nLlJBRF9UT19ERUcsCgkJICAgIHIgPSB0aGlzLlJfTUFKT1IsCgkJICAgIHIyID0gdGhpcy5SX01JTk9SLAoJCSAgICBsbmcgPSBwb2ludC54ICogZCAvIHIsCgkJICAgIHRtcCA9IHIyIC8gciwKCQkgICAgZWNjZW50ID0gTWF0aC5zcXJ0KDEgLSAodG1wICogdG1wKSksCgkJICAgIHRzID0gTWF0aC5leHAoLSBwb2ludC55IC8gciksCgkJICAgIHBoaSA9IChNYXRoLlBJIC8gMikgLSAyICogTWF0aC5hdGFuKHRzKSwKCQkgICAgbnVtSXRlciA9IDE1LAoJCSAgICB0b2wgPSAxZS03LAoJCSAgICBpID0gbnVtSXRlciwKCQkgICAgZHBoaSA9IDAuMSwKCQkgICAgY29uOwoKCQl3aGlsZSAoKE1hdGguYWJzKGRwaGkpID4gdG9sKSAmJiAoLS1pID4gMCkpIHsKCQkJY29uID0gZWNjZW50ICogTWF0aC5zaW4ocGhpKTsKCQkJZHBoaSA9IChNYXRoLlBJIC8gMikgLSAyICogTWF0aC5hdGFuKHRzICoKCQkJICAgICAgICAgICAgTWF0aC5wb3coKDEuMCAtIGNvbikgLyAoMS4wICsgY29uKSwgMC41ICogZWNjZW50KSkgLSBwaGk7CgkJCXBoaSArPSBkcGhpOwoJCX0KCgkJcmV0dXJuIG5ldyBMLkxhdExuZyhwaGkgKiBkLCBsbmcpOwoJfQp9OwoKCgpMLkNSUy5FUFNHMzM5NSA9IEwuZXh0ZW5kKHt9LCBMLkNSUywgewoJY29kZTogJ0VQU0c6MzM5NScsCgoJcHJvamVjdGlvbjogTC5Qcm9qZWN0aW9uLk1lcmNhdG9yLAoKCXRyYW5zZm9ybWF0aW9uOiAoZnVuY3Rpb24gKCkgewoJCXZhciBtID0gTC5Qcm9qZWN0aW9uLk1lcmNhdG9yLAoJCSAgICByID0gbS5SX01BSk9SLAoJCSAgICBzY2FsZSA9IDAuNSAvIChNYXRoLlBJICogcik7CgoJCXJldHVybiBuZXcgTC5UcmFuc2Zvcm1hdGlvbihzY2FsZSwgMC41LCAtc2NhbGUsIDAuNSk7Cgl9KCkpCn0pOwoKCi8qCiAqIEwuVGlsZUxheWVyIGlzIHVzZWQgZm9yIHN0YW5kYXJkIHh5ei1udW1iZXJlZCB0aWxlIGxheWVycy4KICovCgpMLlRpbGVMYXllciA9IEwuQ2xhc3MuZXh0ZW5kKHsKCWluY2x1ZGVzOiBMLk1peGluLkV2ZW50cywKCglvcHRpb25zOiB7CgkJbWluWm9vbTogMCwKCQltYXhab29tOiAxOCwKCQl0aWxlU2l6ZTogMjU2LAoJCXN1YmRvbWFpbnM6ICdhYmMnLAoJCWVycm9yVGlsZVVybDogJycsCgkJYXR0cmlidXRpb246ICcnLAoJCXpvb21PZmZzZXQ6IDAsCgkJb3BhY2l0eTogMSwKCQkvKgoJCW1heE5hdGl2ZVpvb206IG51bGwsCgkJekluZGV4OiBudWxsLAoJCXRtczogZmFsc2UsCgkJY29udGludW91c1dvcmxkOiBmYWxzZSwKCQlub1dyYXA6IGZhbHNlLAoJCXpvb21SZXZlcnNlOiBmYWxzZSwKCQlkZXRlY3RSZXRpbmE6IGZhbHNlLAoJCXJldXNlVGlsZXM6IGZhbHNlLAoJCWJvdW5kczogZmFsc2UsCgkJKi8KCQl1bmxvYWRJbnZpc2libGVUaWxlczogTC5Ccm93c2VyLm1vYmlsZSwKCQl1cGRhdGVXaGVuSWRsZTogTC5Ccm93c2VyLm1vYmlsZQoJfSwKCglpbml0aWFsaXplOiBmdW5jdGlvbiAodXJsLCBvcHRpb25zKSB7CgkJb3B0aW9ucyA9IEwuc2V0T3B0aW9ucyh0aGlzLCBvcHRpb25zKTsKCgkJLy8gZGV0ZWN0aW5nIHJldGluYSBkaXNwbGF5cywgYWRqdXN0aW5nIHRpbGVTaXplIGFuZCB6b29tIGxldmVscwoJCWlmIChvcHRpb25zLmRldGVjdFJldGluYSAmJiBMLkJyb3dzZXIucmV0aW5hICYmIG9wdGlvbnMubWF4Wm9vbSA+IDApIHsKCgkJCW9wdGlvbnMudGlsZVNpemUgPSBNYXRoLmZsb29yKG9wdGlvbnMudGlsZVNpemUgLyAyKTsKCQkJb3B0aW9ucy56b29tT2Zmc2V0Kys7CgoJCQlpZiAob3B0aW9ucy5taW5ab29tID4gMCkgewoJCQkJb3B0aW9ucy5taW5ab29tLS07CgkJCX0KCQkJdGhpcy5vcHRpb25zLm1heFpvb20tLTsKCQl9CgoJCWlmIChvcHRpb25zLmJvdW5kcykgewoJCQlvcHRpb25zLmJvdW5kcyA9IEwubGF0TG5nQm91bmRzKG9wdGlvbnMuYm91bmRzKTsKCQl9CgoJCXRoaXMuX3VybCA9IHVybDsKCgkJdmFyIHN1YmRvbWFpbnMgPSB0aGlzLm9wdGlvbnMuc3ViZG9tYWluczsKCgkJaWYgKHR5cGVvZiBzdWJkb21haW5zID09PSAnc3RyaW5nJykgewoJCQl0aGlzLm9wdGlvbnMuc3ViZG9tYWlucyA9IHN1YmRvbWFpbnMuc3BsaXQoJycpOwoJCX0KCX0sCgoJb25BZGQ6IGZ1bmN0aW9uIChtYXApIHsKCQl0aGlzLl9tYXAgPSBtYXA7CgkJdGhpcy5fYW5pbWF0ZWQgPSBtYXAuX3pvb21BbmltYXRlZDsKCgkJLy8gY3JlYXRlIGEgY29udGFpbmVyIGRpdiBmb3IgdGlsZXMKCQl0aGlzLl9pbml0Q29udGFpbmVyKCk7CgoJCS8vIHNldCB1cCBldmVudHMKCQltYXAub24oewoJCQkndmlld3Jlc2V0JzogdGhpcy5fcmVzZXQsCgkJCSdtb3ZlZW5kJzogdGhpcy5fdXBkYXRlCgkJfSwgdGhpcyk7CgoJCWlmICh0aGlzLl9hbmltYXRlZCkgewoJCQltYXAub24oewoJCQkJJ3pvb21hbmltJzogdGhpcy5fYW5pbWF0ZVpvb20sCgkJCQknem9vbWVuZCc6IHRoaXMuX2VuZFpvb21BbmltCgkJCX0sIHRoaXMpOwoJCX0KCgkJaWYgKCF0aGlzLm9wdGlvbnMudXBkYXRlV2hlbklkbGUpIHsKCQkJdGhpcy5fbGltaXRlZFVwZGF0ZSA9IEwuVXRpbC5saW1pdEV4ZWNCeUludGVydmFsKHRoaXMuX3VwZGF0ZSwgMTUwLCB0aGlzKTsKCQkJbWFwLm9uKCdtb3ZlJywgdGhpcy5fbGltaXRlZFVwZGF0ZSwgdGhpcyk7CgkJfQoKCQl0aGlzLl9yZXNldCgpOwoJCXRoaXMuX3VwZGF0ZSgpOwoJfSwKCglhZGRUbzogZnVuY3Rpb24gKG1hcCkgewoJCW1hcC5hZGRMYXllcih0aGlzKTsKCQlyZXR1cm4gdGhpczsKCX0sCgoJb25SZW1vdmU6IGZ1bmN0aW9uIChtYXApIHsKCQl0aGlzLl9jb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLl9jb250YWluZXIpOwoKCQltYXAub2ZmKHsKCQkJJ3ZpZXdyZXNldCc6IHRoaXMuX3Jlc2V0LAoJCQknbW92ZWVuZCc6IHRoaXMuX3VwZGF0ZQoJCX0sIHRoaXMpOwoKCQlpZiAodGhpcy5fYW5pbWF0ZWQpIHsKCQkJbWFwLm9mZih7CgkJCQknem9vbWFuaW0nOiB0aGlzLl9hbmltYXRlWm9vbSwKCQkJCSd6b29tZW5kJzogdGhpcy5fZW5kWm9vbUFuaW0KCQkJfSwgdGhpcyk7CgkJfQoKCQlpZiAoIXRoaXMub3B0aW9ucy51cGRhdGVXaGVuSWRsZSkgewoJCQltYXAub2ZmKCdtb3ZlJywgdGhpcy5fbGltaXRlZFVwZGF0ZSwgdGhpcyk7CgkJfQoKCQl0aGlzLl9jb250YWluZXIgPSBudWxsOwoJCXRoaXMuX21hcCA9IG51bGw7Cgl9LAoKCWJyaW5nVG9Gcm9udDogZnVuY3Rpb24gKCkgewoJCXZhciBwYW5lID0gdGhpcy5fbWFwLl9wYW5lcy50aWxlUGFuZTsKCgkJaWYgKHRoaXMuX2NvbnRhaW5lcikgewoJCQlwYW5lLmFwcGVuZENoaWxkKHRoaXMuX2NvbnRhaW5lcik7CgkJCXRoaXMuX3NldEF1dG9aSW5kZXgocGFuZSwgTWF0aC5tYXgpOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWJyaW5nVG9CYWNrOiBmdW5jdGlvbiAoKSB7CgkJdmFyIHBhbmUgPSB0aGlzLl9tYXAuX3BhbmVzLnRpbGVQYW5lOwoKCQlpZiAodGhpcy5fY29udGFpbmVyKSB7CgkJCXBhbmUuaW5zZXJ0QmVmb3JlKHRoaXMuX2NvbnRhaW5lciwgcGFuZS5maXJzdENoaWxkKTsKCQkJdGhpcy5fc2V0QXV0b1pJbmRleChwYW5lLCBNYXRoLm1pbik7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJZ2V0QXR0cmlidXRpb246IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5vcHRpb25zLmF0dHJpYnV0aW9uOwoJfSwKCglnZXRDb250YWluZXI6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5fY29udGFpbmVyOwoJfSwKCglzZXRPcGFjaXR5OiBmdW5jdGlvbiAob3BhY2l0eSkgewoJCXRoaXMub3B0aW9ucy5vcGFjaXR5ID0gb3BhY2l0eTsKCgkJaWYgKHRoaXMuX21hcCkgewoJCQl0aGlzLl91cGRhdGVPcGFjaXR5KCk7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJc2V0WkluZGV4OiBmdW5jdGlvbiAoekluZGV4KSB7CgkJdGhpcy5vcHRpb25zLnpJbmRleCA9IHpJbmRleDsKCQl0aGlzLl91cGRhdGVaSW5kZXgoKTsKCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXNldFVybDogZnVuY3Rpb24gKHVybCwgbm9SZWRyYXcpIHsKCQl0aGlzLl91cmwgPSB1cmw7CgoJCWlmICghbm9SZWRyYXcpIHsKCQkJdGhpcy5yZWRyYXcoKTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCglyZWRyYXc6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fbWFwKSB7CgkJCXRoaXMuX3Jlc2V0KHtoYXJkOiB0cnVlfSk7CgkJCXRoaXMuX3VwZGF0ZSgpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJX3VwZGF0ZVpJbmRleDogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9jb250YWluZXIgJiYgdGhpcy5vcHRpb25zLnpJbmRleCAhPT0gdW5kZWZpbmVkKSB7CgkJCXRoaXMuX2NvbnRhaW5lci5zdHlsZS56SW5kZXggPSB0aGlzLm9wdGlvbnMuekluZGV4OwoJCX0KCX0sCgoJX3NldEF1dG9aSW5kZXg6IGZ1bmN0aW9uIChwYW5lLCBjb21wYXJlKSB7CgoJCXZhciBsYXllcnMgPSBwYW5lLmNoaWxkcmVuLAoJCSAgICBlZGdlWkluZGV4ID0gLWNvbXBhcmUoSW5maW5pdHksIC1JbmZpbml0eSksIC8vIC1JbmZpbml0eSBmb3IgbWF4LCBJbmZpbml0eSBmb3IgbWluCgkJICAgIHpJbmRleCwgaSwgbGVuOwoKCQlmb3IgKGkgPSAwLCBsZW4gPSBsYXllcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCgkJCWlmIChsYXllcnNbaV0gIT09IHRoaXMuX2NvbnRhaW5lcikgewoJCQkJekluZGV4ID0gcGFyc2VJbnQobGF5ZXJzW2ldLnN0eWxlLnpJbmRleCwgMTApOwoKCQkJCWlmICghaXNOYU4oekluZGV4KSkgewoJCQkJCWVkZ2VaSW5kZXggPSBjb21wYXJlKGVkZ2VaSW5kZXgsIHpJbmRleCk7CgkJCQl9CgkJCX0KCQl9CgoJCXRoaXMub3B0aW9ucy56SW5kZXggPSB0aGlzLl9jb250YWluZXIuc3R5bGUuekluZGV4ID0KCQkgICAgICAgIChpc0Zpbml0ZShlZGdlWkluZGV4KSA/IGVkZ2VaSW5kZXggOiAwKSArIGNvbXBhcmUoMSwgLTEpOwoJfSwKCglfdXBkYXRlT3BhY2l0eTogZnVuY3Rpb24gKCkgewoJCXZhciBpLAoJCSAgICB0aWxlcyA9IHRoaXMuX3RpbGVzOwoKCQlpZiAoTC5Ccm93c2VyLmllbHQ5KSB7CgkJCWZvciAoaSBpbiB0aWxlcykgewoJCQkJTC5Eb21VdGlsLnNldE9wYWNpdHkodGlsZXNbaV0sIHRoaXMub3B0aW9ucy5vcGFjaXR5KTsKCQkJfQoJCX0gZWxzZSB7CgkJCUwuRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2NvbnRhaW5lciwgdGhpcy5vcHRpb25zLm9wYWNpdHkpOwoJCX0KCX0sCgoJX2luaXRDb250YWluZXI6IGZ1bmN0aW9uICgpIHsKCQl2YXIgdGlsZVBhbmUgPSB0aGlzLl9tYXAuX3BhbmVzLnRpbGVQYW5lOwoKCQlpZiAoIXRoaXMuX2NvbnRhaW5lcikgewoJCQl0aGlzLl9jb250YWluZXIgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCAnbGVhZmxldC1sYXllcicpOwoKCQkJdGhpcy5fdXBkYXRlWkluZGV4KCk7CgoJCQlpZiAodGhpcy5fYW5pbWF0ZWQpIHsKCQkJCXZhciBjbGFzc05hbWUgPSAnbGVhZmxldC10aWxlLWNvbnRhaW5lcic7CgoJCQkJdGhpcy5fYmdCdWZmZXIgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCBjbGFzc05hbWUsIHRoaXMuX2NvbnRhaW5lcik7CgkJCQl0aGlzLl90aWxlQ29udGFpbmVyID0gTC5Eb21VdGlsLmNyZWF0ZSgnZGl2JywgY2xhc3NOYW1lLCB0aGlzLl9jb250YWluZXIpOwoKCQkJfSBlbHNlIHsKCQkJCXRoaXMuX3RpbGVDb250YWluZXIgPSB0aGlzLl9jb250YWluZXI7CgkJCX0KCgkJCXRpbGVQYW5lLmFwcGVuZENoaWxkKHRoaXMuX2NvbnRhaW5lcik7CgoJCQlpZiAodGhpcy5vcHRpb25zLm9wYWNpdHkgPCAxKSB7CgkJCQl0aGlzLl91cGRhdGVPcGFjaXR5KCk7CgkJCX0KCQl9Cgl9LAoKCV9yZXNldDogZnVuY3Rpb24gKGUpIHsKCQlmb3IgKHZhciBrZXkgaW4gdGhpcy5fdGlsZXMpIHsKCQkJdGhpcy5maXJlKCd0aWxldW5sb2FkJywge3RpbGU6IHRoaXMuX3RpbGVzW2tleV19KTsKCQl9CgoJCXRoaXMuX3RpbGVzID0ge307CgkJdGhpcy5fdGlsZXNUb0xvYWQgPSAwOwoKCQlpZiAodGhpcy5vcHRpb25zLnJldXNlVGlsZXMpIHsKCQkJdGhpcy5fdW51c2VkVGlsZXMgPSBbXTsKCQl9CgoJCXRoaXMuX3RpbGVDb250YWluZXIuaW5uZXJIVE1MID0gJyc7CgoJCWlmICh0aGlzLl9hbmltYXRlZCAmJiBlICYmIGUuaGFyZCkgewoJCQl0aGlzLl9jbGVhckJnQnVmZmVyKCk7CgkJfQoKCQl0aGlzLl9pbml0Q29udGFpbmVyKCk7Cgl9LAoKCV9nZXRUaWxlU2l6ZTogZnVuY3Rpb24gKCkgewoJCXZhciBtYXAgPSB0aGlzLl9tYXAsCgkJICAgIHpvb20gPSBtYXAuZ2V0Wm9vbSgpICsgdGhpcy5vcHRpb25zLnpvb21PZmZzZXQsCgkJICAgIHpvb21OID0gdGhpcy5vcHRpb25zLm1heE5hdGl2ZVpvb20sCgkJICAgIHRpbGVTaXplID0gdGhpcy5vcHRpb25zLnRpbGVTaXplOwoKCQlpZiAoem9vbU4gJiYgem9vbSA+IHpvb21OKSB7CgkJCXRpbGVTaXplID0gTWF0aC5yb3VuZChtYXAuZ2V0Wm9vbVNjYWxlKHpvb20pIC8gbWFwLmdldFpvb21TY2FsZSh6b29tTikgKiB0aWxlU2l6ZSk7CgkJfQoKCQlyZXR1cm4gdGlsZVNpemU7Cgl9LAoKCV91cGRhdGU6IGZ1bmN0aW9uICgpIHsKCgkJaWYgKCF0aGlzLl9tYXApIHsgcmV0dXJuOyB9CgoJCXZhciBtYXAgPSB0aGlzLl9tYXAsCgkJICAgIGJvdW5kcyA9IG1hcC5nZXRQaXhlbEJvdW5kcygpLAoJCSAgICB6b29tID0gbWFwLmdldFpvb20oKSwKCQkgICAgdGlsZVNpemUgPSB0aGlzLl9nZXRUaWxlU2l6ZSgpOwoKCQlpZiAoem9vbSA+IHRoaXMub3B0aW9ucy5tYXhab29tIHx8IHpvb20gPCB0aGlzLm9wdGlvbnMubWluWm9vbSkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgdGlsZUJvdW5kcyA9IEwuYm91bmRzKAoJCSAgICAgICAgYm91bmRzLm1pbi5kaXZpZGVCeSh0aWxlU2l6ZSkuX2Zsb29yKCksCgkJICAgICAgICBib3VuZHMubWF4LmRpdmlkZUJ5KHRpbGVTaXplKS5fZmxvb3IoKSk7CgoJCXRoaXMuX2FkZFRpbGVzRnJvbUNlbnRlck91dCh0aWxlQm91bmRzKTsKCgkJaWYgKHRoaXMub3B0aW9ucy51bmxvYWRJbnZpc2libGVUaWxlcyB8fCB0aGlzLm9wdGlvbnMucmV1c2VUaWxlcykgewoJCQl0aGlzLl9yZW1vdmVPdGhlclRpbGVzKHRpbGVCb3VuZHMpOwoJCX0KCX0sCgoJX2FkZFRpbGVzRnJvbUNlbnRlck91dDogZnVuY3Rpb24gKGJvdW5kcykgewoJCXZhciBxdWV1ZSA9IFtdLAoJCSAgICBjZW50ZXIgPSBib3VuZHMuZ2V0Q2VudGVyKCk7CgoJCXZhciBqLCBpLCBwb2ludDsKCgkJZm9yIChqID0gYm91bmRzLm1pbi55OyBqIDw9IGJvdW5kcy5tYXgueTsgaisrKSB7CgkJCWZvciAoaSA9IGJvdW5kcy5taW4ueDsgaSA8PSBib3VuZHMubWF4Lng7IGkrKykgewoJCQkJcG9pbnQgPSBuZXcgTC5Qb2ludChpLCBqKTsKCgkJCQlpZiAodGhpcy5fdGlsZVNob3VsZEJlTG9hZGVkKHBvaW50KSkgewoJCQkJCXF1ZXVlLnB1c2gocG9pbnQpOwoJCQkJfQoJCQl9CgkJfQoKCQl2YXIgdGlsZXNUb0xvYWQgPSBxdWV1ZS5sZW5ndGg7CgoJCWlmICh0aWxlc1RvTG9hZCA9PT0gMCkgeyByZXR1cm47IH0KCgkJLy8gbG9hZCB0aWxlcyBpbiBvcmRlciBvZiB0aGVpciBkaXN0YW5jZSB0byBjZW50ZXIKCQlxdWV1ZS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CgkJCXJldHVybiBhLmRpc3RhbmNlVG8oY2VudGVyKSAtIGIuZGlzdGFuY2VUbyhjZW50ZXIpOwoJCX0pOwoKCQl2YXIgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CgoJCS8vIGlmIGl0cyB0aGUgZmlyc3QgYmF0Y2ggb2YgdGlsZXMgdG8gbG9hZAoJCWlmICghdGhpcy5fdGlsZXNUb0xvYWQpIHsKCQkJdGhpcy5maXJlKCdsb2FkaW5nJyk7CgkJfQoKCQl0aGlzLl90aWxlc1RvTG9hZCArPSB0aWxlc1RvTG9hZDsKCgkJZm9yIChpID0gMDsgaSA8IHRpbGVzVG9Mb2FkOyBpKyspIHsKCQkJdGhpcy5fYWRkVGlsZShxdWV1ZVtpXSwgZnJhZ21lbnQpOwoJCX0KCgkJdGhpcy5fdGlsZUNvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7Cgl9LAoKCV90aWxlU2hvdWxkQmVMb2FkZWQ6IGZ1bmN0aW9uICh0aWxlUG9pbnQpIHsKCQlpZiAoKHRpbGVQb2ludC54ICsgJzonICsgdGlsZVBvaW50LnkpIGluIHRoaXMuX3RpbGVzKSB7CgkJCXJldHVybiBmYWxzZTsgLy8gYWxyZWFkeSBsb2FkZWQKCQl9CgoJCXZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zOwoKCQlpZiAoIW9wdGlvbnMuY29udGludW91c1dvcmxkKSB7CgkJCXZhciBsaW1pdCA9IHRoaXMuX2dldFdyYXBUaWxlTnVtKCk7CgoJCQkvLyBkb24ndCBsb2FkIGlmIGV4Y2VlZHMgd29ybGQgYm91bmRzCgkJCWlmICgob3B0aW9ucy5ub1dyYXAgJiYgKHRpbGVQb2ludC54IDwgMCB8fCB0aWxlUG9pbnQueCA+PSBsaW1pdC54KSkgfHwKCQkJCXRpbGVQb2ludC55IDwgMCB8fCB0aWxlUG9pbnQueSA+PSBsaW1pdC55KSB7IHJldHVybiBmYWxzZTsgfQoJCX0KCgkJaWYgKG9wdGlvbnMuYm91bmRzKSB7CgkJCXZhciB0aWxlU2l6ZSA9IG9wdGlvbnMudGlsZVNpemUsCgkJCSAgICBud1BvaW50ID0gdGlsZVBvaW50Lm11bHRpcGx5QnkodGlsZVNpemUpLAoJCQkgICAgc2VQb2ludCA9IG53UG9pbnQuYWRkKFt0aWxlU2l6ZSwgdGlsZVNpemVdKSwKCQkJICAgIG53ID0gdGhpcy5fbWFwLnVucHJvamVjdChud1BvaW50KSwKCQkJICAgIHNlID0gdGhpcy5fbWFwLnVucHJvamVjdChzZVBvaW50KTsKCgkJCS8vIFRPRE8gdGVtcG9yYXJ5IGhhY2ssIHdpbGwgYmUgcmVtb3ZlZCBhZnRlciByZWZhY3RvcmluZyBwcm9qZWN0aW9ucwoJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vTGVhZmxldC9MZWFmbGV0L2lzc3Vlcy8xNjE4CgkJCWlmICghb3B0aW9ucy5jb250aW51b3VzV29ybGQgJiYgIW9wdGlvbnMubm9XcmFwKSB7CgkJCQludyA9IG53LndyYXAoKTsKCQkJCXNlID0gc2Uud3JhcCgpOwoJCQl9CgoJCQlpZiAoIW9wdGlvbnMuYm91bmRzLmludGVyc2VjdHMoW253LCBzZV0pKSB7IHJldHVybiBmYWxzZTsgfQoJCX0KCgkJcmV0dXJuIHRydWU7Cgl9LAoKCV9yZW1vdmVPdGhlclRpbGVzOiBmdW5jdGlvbiAoYm91bmRzKSB7CgkJdmFyIGtBcnIsIHgsIHksIGtleTsKCgkJZm9yIChrZXkgaW4gdGhpcy5fdGlsZXMpIHsKCQkJa0FyciA9IGtleS5zcGxpdCgnOicpOwoJCQl4ID0gcGFyc2VJbnQoa0FyclswXSwgMTApOwoJCQl5ID0gcGFyc2VJbnQoa0FyclsxXSwgMTApOwoKCQkJLy8gcmVtb3ZlIHRpbGUgaWYgaXQncyBvdXQgb2YgYm91bmRzCgkJCWlmICh4IDwgYm91bmRzLm1pbi54IHx8IHggPiBib3VuZHMubWF4LnggfHwgeSA8IGJvdW5kcy5taW4ueSB8fCB5ID4gYm91bmRzLm1heC55KSB7CgkJCQl0aGlzLl9yZW1vdmVUaWxlKGtleSk7CgkJCX0KCQl9Cgl9LAoKCV9yZW1vdmVUaWxlOiBmdW5jdGlvbiAoa2V5KSB7CgkJdmFyIHRpbGUgPSB0aGlzLl90aWxlc1trZXldOwoKCQl0aGlzLmZpcmUoJ3RpbGV1bmxvYWQnLCB7dGlsZTogdGlsZSwgdXJsOiB0aWxlLnNyY30pOwoKCQlpZiAodGhpcy5vcHRpb25zLnJldXNlVGlsZXMpIHsKCQkJTC5Eb21VdGlsLnJlbW92ZUNsYXNzKHRpbGUsICdsZWFmbGV0LXRpbGUtbG9hZGVkJyk7CgkJCXRoaXMuX3VudXNlZFRpbGVzLnB1c2godGlsZSk7CgoJCX0gZWxzZSBpZiAodGlsZS5wYXJlbnROb2RlID09PSB0aGlzLl90aWxlQ29udGFpbmVyKSB7CgkJCXRoaXMuX3RpbGVDb250YWluZXIucmVtb3ZlQ2hpbGQodGlsZSk7CgkJfQoKCQkvLyBmb3IgaHR0cHM6Ly9naXRodWIuY29tL0Nsb3VkTWFkZS9MZWFmbGV0L2lzc3Vlcy8xMzcKCQlpZiAoIUwuQnJvd3Nlci5hbmRyb2lkKSB7CgkJCXRpbGUub25sb2FkID0gbnVsbDsKCQkJdGlsZS5zcmMgPSBMLlV0aWwuZW1wdHlJbWFnZVVybDsKCQl9CgoJCWRlbGV0ZSB0aGlzLl90aWxlc1trZXldOwoJfSwKCglfYWRkVGlsZTogZnVuY3Rpb24gKHRpbGVQb2ludCwgY29udGFpbmVyKSB7CgkJdmFyIHRpbGVQb3MgPSB0aGlzLl9nZXRUaWxlUG9zKHRpbGVQb2ludCk7CgoJCS8vIGdldCB1bnVzZWQgdGlsZSAtIG9yIGNyZWF0ZSBhIG5ldyB0aWxlCgkJdmFyIHRpbGUgPSB0aGlzLl9nZXRUaWxlKCk7CgoJCS8qCgkJQ2hyb21lIDIwIGxheW91dHMgbXVjaCBmYXN0ZXIgd2l0aCB0b3AvbGVmdCAodmVyaWZ5IHdpdGggdGltZWxpbmUsIGZyYW1lcykKCQlBbmRyb2lkIDQgYnJvd3NlciBoYXMgZGlzcGxheSBpc3N1ZXMgd2l0aCB0b3AvbGVmdCBhbmQgcmVxdWlyZXMgdHJhbnNmb3JtIGluc3RlYWQKCQkob3RoZXIgYnJvd3NlcnMgZG9uJ3QgY3VycmVudGx5IGNhcmUpIC0gc2VlIGRlYnVnL2hhY2tzL2ppdHRlci5odG1sIGZvciBhbiBleGFtcGxlCgkJKi8KCQlMLkRvbVV0aWwuc2V0UG9zaXRpb24odGlsZSwgdGlsZVBvcywgTC5Ccm93c2VyLmNocm9tZSk7CgoJCXRoaXMuX3RpbGVzW3RpbGVQb2ludC54ICsgJzonICsgdGlsZVBvaW50LnldID0gdGlsZTsKCgkJdGhpcy5fbG9hZFRpbGUodGlsZSwgdGlsZVBvaW50KTsKCgkJaWYgKHRpbGUucGFyZW50Tm9kZSAhPT0gdGhpcy5fdGlsZUNvbnRhaW5lcikgewoJCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGlsZSk7CgkJfQoJfSwKCglfZ2V0Wm9vbUZvclVybDogZnVuY3Rpb24gKCkgewoKCQl2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKCQkgICAgem9vbSA9IHRoaXMuX21hcC5nZXRab29tKCk7CgoJCWlmIChvcHRpb25zLnpvb21SZXZlcnNlKSB7CgkJCXpvb20gPSBvcHRpb25zLm1heFpvb20gLSB6b29tOwoJCX0KCgkJem9vbSArPSBvcHRpb25zLnpvb21PZmZzZXQ7CgoJCXJldHVybiBvcHRpb25zLm1heE5hdGl2ZVpvb20gPyBNYXRoLm1pbih6b29tLCBvcHRpb25zLm1heE5hdGl2ZVpvb20pIDogem9vbTsKCX0sCgoJX2dldFRpbGVQb3M6IGZ1bmN0aW9uICh0aWxlUG9pbnQpIHsKCQl2YXIgb3JpZ2luID0gdGhpcy5fbWFwLmdldFBpeGVsT3JpZ2luKCksCgkJICAgIHRpbGVTaXplID0gdGhpcy5fZ2V0VGlsZVNpemUoKTsKCgkJcmV0dXJuIHRpbGVQb2ludC5tdWx0aXBseUJ5KHRpbGVTaXplKS5zdWJ0cmFjdChvcmlnaW4pOwoJfSwKCgkvLyBpbWFnZS1zcGVjaWZpYyBjb2RlIChvdmVycmlkZSB0byBpbXBsZW1lbnQgZS5nLiBDYW52YXMgb3IgU1ZHIHRpbGUgbGF5ZXIpCgoJZ2V0VGlsZVVybDogZnVuY3Rpb24gKHRpbGVQb2ludCkgewoJCXJldHVybiBMLlV0aWwudGVtcGxhdGUodGhpcy5fdXJsLCBMLmV4dGVuZCh7CgkJCXM6IHRoaXMuX2dldFN1YmRvbWFpbih0aWxlUG9pbnQpLAoJCQl6OiB0aWxlUG9pbnQueiwKCQkJeDogdGlsZVBvaW50LngsCgkJCXk6IHRpbGVQb2ludC55CgkJfSwgdGhpcy5vcHRpb25zKSk7Cgl9LAoKCV9nZXRXcmFwVGlsZU51bTogZnVuY3Rpb24gKCkgewoJCXZhciBjcnMgPSB0aGlzLl9tYXAub3B0aW9ucy5jcnMsCgkJICAgIHNpemUgPSBjcnMuZ2V0U2l6ZSh0aGlzLl9tYXAuZ2V0Wm9vbSgpKTsKCQlyZXR1cm4gc2l6ZS5kaXZpZGVCeSh0aGlzLl9nZXRUaWxlU2l6ZSgpKS5fZmxvb3IoKTsKCX0sCgoJX2FkanVzdFRpbGVQb2ludDogZnVuY3Rpb24gKHRpbGVQb2ludCkgewoKCQl2YXIgbGltaXQgPSB0aGlzLl9nZXRXcmFwVGlsZU51bSgpOwoKCQkvLyB3cmFwIHRpbGUgY29vcmRpbmF0ZXMKCQlpZiAoIXRoaXMub3B0aW9ucy5jb250aW51b3VzV29ybGQgJiYgIXRoaXMub3B0aW9ucy5ub1dyYXApIHsKCQkJdGlsZVBvaW50LnggPSAoKHRpbGVQb2ludC54ICUgbGltaXQueCkgKyBsaW1pdC54KSAlIGxpbWl0Lng7CgkJfQoKCQlpZiAodGhpcy5vcHRpb25zLnRtcykgewoJCQl0aWxlUG9pbnQueSA9IGxpbWl0LnkgLSB0aWxlUG9pbnQueSAtIDE7CgkJfQoKCQl0aWxlUG9pbnQueiA9IHRoaXMuX2dldFpvb21Gb3JVcmwoKTsKCX0sCgoJX2dldFN1YmRvbWFpbjogZnVuY3Rpb24gKHRpbGVQb2ludCkgewoJCXZhciBpbmRleCA9IE1hdGguYWJzKHRpbGVQb2ludC54ICsgdGlsZVBvaW50LnkpICUgdGhpcy5vcHRpb25zLnN1YmRvbWFpbnMubGVuZ3RoOwoJCXJldHVybiB0aGlzLm9wdGlvbnMuc3ViZG9tYWluc1tpbmRleF07Cgl9LAoKCV9nZXRUaWxlOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMub3B0aW9ucy5yZXVzZVRpbGVzICYmIHRoaXMuX3VudXNlZFRpbGVzLmxlbmd0aCA+IDApIHsKCQkJdmFyIHRpbGUgPSB0aGlzLl91bnVzZWRUaWxlcy5wb3AoKTsKCQkJdGhpcy5fcmVzZXRUaWxlKHRpbGUpOwoJCQlyZXR1cm4gdGlsZTsKCQl9CgkJcmV0dXJuIHRoaXMuX2NyZWF0ZVRpbGUoKTsKCX0sCgoJLy8gT3ZlcnJpZGUgaWYgZGF0YSBzdG9yZWQgb24gYSB0aWxlIG5lZWRzIHRvIGJlIGNsZWFuZWQgdXAgYmVmb3JlIHJldXNlCglfcmVzZXRUaWxlOiBmdW5jdGlvbiAoLyp0aWxlKi8pIHt9LAoKCV9jcmVhdGVUaWxlOiBmdW5jdGlvbiAoKSB7CgkJdmFyIHRpbGUgPSBMLkRvbVV0aWwuY3JlYXRlKCdpbWcnLCAnbGVhZmxldC10aWxlJyk7CgkJdGlsZS5zdHlsZS53aWR0aCA9IHRpbGUuc3R5bGUuaGVpZ2h0ID0gdGhpcy5fZ2V0VGlsZVNpemUoKSArICdweCc7CgkJdGlsZS5nYWxsZXJ5aW1nID0gJ25vJzsKCgkJdGlsZS5vbnNlbGVjdHN0YXJ0ID0gdGlsZS5vbm1vdXNlbW92ZSA9IEwuVXRpbC5mYWxzZUZuOwoKCQlpZiAoTC5Ccm93c2VyLmllbHQ5ICYmIHRoaXMub3B0aW9ucy5vcGFjaXR5ICE9PSB1bmRlZmluZWQpIHsKCQkJTC5Eb21VdGlsLnNldE9wYWNpdHkodGlsZSwgdGhpcy5vcHRpb25zLm9wYWNpdHkpOwoJCX0KCQkvLyB3aXRob3V0IHRoaXMgaGFjaywgdGlsZXMgZGlzYXBwZWFyIGFmdGVyIHpvb20gb24gQ2hyb21lIGZvciBBbmRyb2lkCgkJLy8gaHR0cHM6Ly9naXRodWIuY29tL0xlYWZsZXQvTGVhZmxldC9pc3N1ZXMvMjA3OAoJCWlmIChMLkJyb3dzZXIubW9iaWxlV2Via2l0M2QpIHsKCQkJdGlsZS5zdHlsZS5XZWJraXRCYWNrZmFjZVZpc2liaWxpdHkgPSAnaGlkZGVuJzsKCQl9CgkJcmV0dXJuIHRpbGU7Cgl9LAoKCV9sb2FkVGlsZTogZnVuY3Rpb24gKHRpbGUsIHRpbGVQb2ludCkgewoJCXRpbGUuX2xheWVyICA9IHRoaXM7CgkJdGlsZS5vbmxvYWQgID0gdGhpcy5fdGlsZU9uTG9hZDsKCQl0aWxlLm9uZXJyb3IgPSB0aGlzLl90aWxlT25FcnJvcjsKCgkJdGhpcy5fYWRqdXN0VGlsZVBvaW50KHRpbGVQb2ludCk7CgkJdGlsZS5zcmMgICAgID0gdGhpcy5nZXRUaWxlVXJsKHRpbGVQb2ludCk7CgoJCXRoaXMuZmlyZSgndGlsZWxvYWRzdGFydCcsIHsKCQkJdGlsZTogdGlsZSwKCQkJdXJsOiB0aWxlLnNyYwoJCX0pOwoJfSwKCglfdGlsZUxvYWRlZDogZnVuY3Rpb24gKCkgewoJCXRoaXMuX3RpbGVzVG9Mb2FkLS07CgoJCWlmICh0aGlzLl9hbmltYXRlZCkgewoJCQlMLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fdGlsZUNvbnRhaW5lciwgJ2xlYWZsZXQtem9vbS1hbmltYXRlZCcpOwoJCX0KCgkJaWYgKCF0aGlzLl90aWxlc1RvTG9hZCkgewoJCQl0aGlzLmZpcmUoJ2xvYWQnKTsKCgkJCWlmICh0aGlzLl9hbmltYXRlZCkgewoJCQkJLy8gY2xlYXIgc2NhbGVkIHRpbGVzIGFmdGVyIGFsbCBuZXcgdGlsZXMgYXJlIGxvYWRlZCAoZm9yIHBlcmZvcm1hbmNlKQoJCQkJY2xlYXJUaW1lb3V0KHRoaXMuX2NsZWFyQmdCdWZmZXJUaW1lcik7CgkJCQl0aGlzLl9jbGVhckJnQnVmZmVyVGltZXIgPSBzZXRUaW1lb3V0KEwuYmluZCh0aGlzLl9jbGVhckJnQnVmZmVyLCB0aGlzKSwgNTAwKTsKCQkJfQoJCX0KCX0sCgoJX3RpbGVPbkxvYWQ6IGZ1bmN0aW9uICgpIHsKCQl2YXIgbGF5ZXIgPSB0aGlzLl9sYXllcjsKCgkJLy9Pbmx5IGlmIHdlIGFyZSBsb2FkaW5nIGFuIGFjdHVhbCBpbWFnZQoJCWlmICh0aGlzLnNyYyAhPT0gTC5VdGlsLmVtcHR5SW1hZ2VVcmwpIHsKCQkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMsICdsZWFmbGV0LXRpbGUtbG9hZGVkJyk7CgoJCQlsYXllci5maXJlKCd0aWxlbG9hZCcsIHsKCQkJCXRpbGU6IHRoaXMsCgkJCQl1cmw6IHRoaXMuc3JjCgkJCX0pOwoJCX0KCgkJbGF5ZXIuX3RpbGVMb2FkZWQoKTsKCX0sCgoJX3RpbGVPbkVycm9yOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGxheWVyID0gdGhpcy5fbGF5ZXI7CgoJCWxheWVyLmZpcmUoJ3RpbGVlcnJvcicsIHsKCQkJdGlsZTogdGhpcywKCQkJdXJsOiB0aGlzLnNyYwoJCX0pOwoKCQl2YXIgbmV3VXJsID0gbGF5ZXIub3B0aW9ucy5lcnJvclRpbGVVcmw7CgkJaWYgKG5ld1VybCkgewoJCQl0aGlzLnNyYyA9IG5ld1VybDsKCQl9CgoJCWxheWVyLl90aWxlTG9hZGVkKCk7Cgl9Cn0pOwoKTC50aWxlTGF5ZXIgPSBmdW5jdGlvbiAodXJsLCBvcHRpb25zKSB7CglyZXR1cm4gbmV3IEwuVGlsZUxheWVyKHVybCwgb3B0aW9ucyk7Cn07CgoKLyoKICogTC5UaWxlTGF5ZXIuV01TIGlzIHVzZWQgZm9yIHB1dHRpbmcgV01TIHRpbGUgbGF5ZXJzIG9uIHRoZSBtYXAuCiAqLwoKTC5UaWxlTGF5ZXIuV01TID0gTC5UaWxlTGF5ZXIuZXh0ZW5kKHsKCglkZWZhdWx0V21zUGFyYW1zOiB7CgkJc2VydmljZTogJ1dNUycsCgkJcmVxdWVzdDogJ0dldE1hcCcsCgkJdmVyc2lvbjogJzEuMS4xJywKCQlsYXllcnM6ICcnLAoJCXN0eWxlczogJycsCgkJZm9ybWF0OiAnaW1hZ2UvanBlZycsCgkJdHJhbnNwYXJlbnQ6IGZhbHNlCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uICh1cmwsIG9wdGlvbnMpIHsgLy8gKFN0cmluZywgT2JqZWN0KQoKCQl0aGlzLl91cmwgPSB1cmw7CgoJCXZhciB3bXNQYXJhbXMgPSBMLmV4dGVuZCh7fSwgdGhpcy5kZWZhdWx0V21zUGFyYW1zKSwKCQkgICAgdGlsZVNpemUgPSBvcHRpb25zLnRpbGVTaXplIHx8IHRoaXMub3B0aW9ucy50aWxlU2l6ZTsKCgkJaWYgKG9wdGlvbnMuZGV0ZWN0UmV0aW5hICYmIEwuQnJvd3Nlci5yZXRpbmEpIHsKCQkJd21zUGFyYW1zLndpZHRoID0gd21zUGFyYW1zLmhlaWdodCA9IHRpbGVTaXplICogMjsKCQl9IGVsc2UgewoJCQl3bXNQYXJhbXMud2lkdGggPSB3bXNQYXJhbXMuaGVpZ2h0ID0gdGlsZVNpemU7CgkJfQoKCQlmb3IgKHZhciBpIGluIG9wdGlvbnMpIHsKCQkJLy8gYWxsIGtleXMgdGhhdCBhcmUgbm90IFRpbGVMYXllciBvcHRpb25zIGdvIHRvIFdNUyBwYXJhbXMKCQkJaWYgKCF0aGlzLm9wdGlvbnMuaGFzT3duUHJvcGVydHkoaSkgJiYgaSAhPT0gJ2NycycpIHsKCQkJCXdtc1BhcmFtc1tpXSA9IG9wdGlvbnNbaV07CgkJCX0KCQl9CgoJCXRoaXMud21zUGFyYW1zID0gd21zUGFyYW1zOwoKCQlMLnNldE9wdGlvbnModGhpcywgb3B0aW9ucyk7Cgl9LAoKCW9uQWRkOiBmdW5jdGlvbiAobWFwKSB7CgoJCXRoaXMuX2NycyA9IHRoaXMub3B0aW9ucy5jcnMgfHwgbWFwLm9wdGlvbnMuY3JzOwoKCQl0aGlzLl93bXNWZXJzaW9uID0gcGFyc2VGbG9hdCh0aGlzLndtc1BhcmFtcy52ZXJzaW9uKTsKCgkJdmFyIHByb2plY3Rpb25LZXkgPSB0aGlzLl93bXNWZXJzaW9uID49IDEuMyA/ICdjcnMnIDogJ3Nycyc7CgkJdGhpcy53bXNQYXJhbXNbcHJvamVjdGlvbktleV0gPSB0aGlzLl9jcnMuY29kZTsKCgkJTC5UaWxlTGF5ZXIucHJvdG90eXBlLm9uQWRkLmNhbGwodGhpcywgbWFwKTsKCX0sCgoJZ2V0VGlsZVVybDogZnVuY3Rpb24gKHRpbGVQb2ludCkgeyAvLyAoUG9pbnQsIE51bWJlcikgLT4gU3RyaW5nCgoJCXZhciBtYXAgPSB0aGlzLl9tYXAsCgkJICAgIHRpbGVTaXplID0gdGhpcy5vcHRpb25zLnRpbGVTaXplLAoKCQkgICAgbndQb2ludCA9IHRpbGVQb2ludC5tdWx0aXBseUJ5KHRpbGVTaXplKSwKCQkgICAgc2VQb2ludCA9IG53UG9pbnQuYWRkKFt0aWxlU2l6ZSwgdGlsZVNpemVdKSwKCgkJICAgIG53ID0gdGhpcy5fY3JzLnByb2plY3QobWFwLnVucHJvamVjdChud1BvaW50LCB0aWxlUG9pbnQueikpLAoJCSAgICBzZSA9IHRoaXMuX2Nycy5wcm9qZWN0KG1hcC51bnByb2plY3Qoc2VQb2ludCwgdGlsZVBvaW50LnopKSwKCQkgICAgYmJveCA9IHRoaXMuX3dtc1ZlcnNpb24gPj0gMS4zICYmIHRoaXMuX2NycyA9PT0gTC5DUlMuRVBTRzQzMjYgPwoJCSAgICAgICAgW3NlLnksIG53LngsIG53LnksIHNlLnhdLmpvaW4oJywnKSA6CgkJICAgICAgICBbbncueCwgc2UueSwgc2UueCwgbncueV0uam9pbignLCcpLAoKCQkgICAgdXJsID0gTC5VdGlsLnRlbXBsYXRlKHRoaXMuX3VybCwge3M6IHRoaXMuX2dldFN1YmRvbWFpbih0aWxlUG9pbnQpfSk7CgoJCXJldHVybiB1cmwgKyBMLlV0aWwuZ2V0UGFyYW1TdHJpbmcodGhpcy53bXNQYXJhbXMsIHVybCwgdHJ1ZSkgKyAnJkJCT1g9JyArIGJib3g7Cgl9LAoKCXNldFBhcmFtczogZnVuY3Rpb24gKHBhcmFtcywgbm9SZWRyYXcpIHsKCgkJTC5leHRlbmQodGhpcy53bXNQYXJhbXMsIHBhcmFtcyk7CgoJCWlmICghbm9SZWRyYXcpIHsKCQkJdGhpcy5yZWRyYXcoKTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfQp9KTsKCkwudGlsZUxheWVyLndtcyA9IGZ1bmN0aW9uICh1cmwsIG9wdGlvbnMpIHsKCXJldHVybiBuZXcgTC5UaWxlTGF5ZXIuV01TKHVybCwgb3B0aW9ucyk7Cn07CgoKLyoKICogTC5UaWxlTGF5ZXIuQ2FudmFzIGlzIGEgY2xhc3MgdGhhdCB5b3UgY2FuIHVzZSBhcyBhIGJhc2UgZm9yIGNyZWF0aW5nCiAqIGR5bmFtaWNhbGx5IGRyYXduIENhbnZhcy1iYXNlZCB0aWxlIGxheWVycy4KICovCgpMLlRpbGVMYXllci5DYW52YXMgPSBMLlRpbGVMYXllci5leHRlbmQoewoJb3B0aW9uczogewoJCWFzeW5jOiBmYWxzZQoJfSwKCglpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewoJCUwuc2V0T3B0aW9ucyh0aGlzLCBvcHRpb25zKTsKCX0sCgoJcmVkcmF3OiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX21hcCkgewoJCQl0aGlzLl9yZXNldCh7aGFyZDogdHJ1ZX0pOwoJCQl0aGlzLl91cGRhdGUoKTsKCQl9CgoJCWZvciAodmFyIGkgaW4gdGhpcy5fdGlsZXMpIHsKCQkJdGhpcy5fcmVkcmF3VGlsZSh0aGlzLl90aWxlc1tpXSk7CgkJfQoJCXJldHVybiB0aGlzOwoJfSwKCglfcmVkcmF3VGlsZTogZnVuY3Rpb24gKHRpbGUpIHsKCQl0aGlzLmRyYXdUaWxlKHRpbGUsIHRpbGUuX3RpbGVQb2ludCwgdGhpcy5fbWFwLl96b29tKTsKCX0sCgoJX2NyZWF0ZVRpbGU6IGZ1bmN0aW9uICgpIHsKCQl2YXIgdGlsZSA9IEwuRG9tVXRpbC5jcmVhdGUoJ2NhbnZhcycsICdsZWFmbGV0LXRpbGUnKTsKCQl0aWxlLndpZHRoID0gdGlsZS5oZWlnaHQgPSB0aGlzLm9wdGlvbnMudGlsZVNpemU7CgkJdGlsZS5vbnNlbGVjdHN0YXJ0ID0gdGlsZS5vbm1vdXNlbW92ZSA9IEwuVXRpbC5mYWxzZUZuOwoJCXJldHVybiB0aWxlOwoJfSwKCglfbG9hZFRpbGU6IGZ1bmN0aW9uICh0aWxlLCB0aWxlUG9pbnQpIHsKCQl0aWxlLl9sYXllciA9IHRoaXM7CgkJdGlsZS5fdGlsZVBvaW50ID0gdGlsZVBvaW50OwoKCQl0aGlzLl9yZWRyYXdUaWxlKHRpbGUpOwoKCQlpZiAoIXRoaXMub3B0aW9ucy5hc3luYykgewoJCQl0aGlzLnRpbGVEcmF3bih0aWxlKTsKCQl9Cgl9LAoKCWRyYXdUaWxlOiBmdW5jdGlvbiAoLyp0aWxlLCB0aWxlUG9pbnQqLykgewoJCS8vIG92ZXJyaWRlIHdpdGggcmVuZGVyaW5nIGNvZGUKCX0sCgoJdGlsZURyYXduOiBmdW5jdGlvbiAodGlsZSkgewoJCXRoaXMuX3RpbGVPbkxvYWQuY2FsbCh0aWxlKTsKCX0KfSk7CgoKTC50aWxlTGF5ZXIuY2FudmFzID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKCXJldHVybiBuZXcgTC5UaWxlTGF5ZXIuQ2FudmFzKG9wdGlvbnMpOwp9OwoKCi8qCiAqIEwuSW1hZ2VPdmVybGF5IGlzIHVzZWQgdG8gb3ZlcmxheSBpbWFnZXMgb3ZlciB0aGUgbWFwICh0byBzcGVjaWZpYyBnZW9ncmFwaGljYWwgYm91bmRzKS4KICovCgpMLkltYWdlT3ZlcmxheSA9IEwuQ2xhc3MuZXh0ZW5kKHsKCWluY2x1ZGVzOiBMLk1peGluLkV2ZW50cywKCglvcHRpb25zOiB7CgkJb3BhY2l0eTogMQoJfSwKCglpbml0aWFsaXplOiBmdW5jdGlvbiAodXJsLCBib3VuZHMsIG9wdGlvbnMpIHsgLy8gKFN0cmluZywgTGF0TG5nQm91bmRzLCBPYmplY3QpCgkJdGhpcy5fdXJsID0gdXJsOwoJCXRoaXMuX2JvdW5kcyA9IEwubGF0TG5nQm91bmRzKGJvdW5kcyk7CgoJCUwuc2V0T3B0aW9ucyh0aGlzLCBvcHRpb25zKTsKCX0sCgoJb25BZGQ6IGZ1bmN0aW9uIChtYXApIHsKCQl0aGlzLl9tYXAgPSBtYXA7CgoJCWlmICghdGhpcy5faW1hZ2UpIHsKCQkJdGhpcy5faW5pdEltYWdlKCk7CgkJfQoKCQltYXAuX3BhbmVzLm92ZXJsYXlQYW5lLmFwcGVuZENoaWxkKHRoaXMuX2ltYWdlKTsKCgkJbWFwLm9uKCd2aWV3cmVzZXQnLCB0aGlzLl9yZXNldCwgdGhpcyk7CgoJCWlmIChtYXAub3B0aW9ucy56b29tQW5pbWF0aW9uICYmIEwuQnJvd3Nlci5hbnkzZCkgewoJCQltYXAub24oJ3pvb21hbmltJywgdGhpcy5fYW5pbWF0ZVpvb20sIHRoaXMpOwoJCX0KCgkJdGhpcy5fcmVzZXQoKTsKCX0sCgoJb25SZW1vdmU6IGZ1bmN0aW9uIChtYXApIHsKCQltYXAuZ2V0UGFuZXMoKS5vdmVybGF5UGFuZS5yZW1vdmVDaGlsZCh0aGlzLl9pbWFnZSk7CgoJCW1hcC5vZmYoJ3ZpZXdyZXNldCcsIHRoaXMuX3Jlc2V0LCB0aGlzKTsKCgkJaWYgKG1hcC5vcHRpb25zLnpvb21BbmltYXRpb24pIHsKCQkJbWFwLm9mZignem9vbWFuaW0nLCB0aGlzLl9hbmltYXRlWm9vbSwgdGhpcyk7CgkJfQoJfSwKCglhZGRUbzogZnVuY3Rpb24gKG1hcCkgewoJCW1hcC5hZGRMYXllcih0aGlzKTsKCQlyZXR1cm4gdGhpczsKCX0sCgoJc2V0T3BhY2l0eTogZnVuY3Rpb24gKG9wYWNpdHkpIHsKCQl0aGlzLm9wdGlvbnMub3BhY2l0eSA9IG9wYWNpdHk7CgkJdGhpcy5fdXBkYXRlT3BhY2l0eSgpOwoJCXJldHVybiB0aGlzOwoJfSwKCgkvLyBUT0RPIHJlbW92ZSBicmluZ1RvRnJvbnQvYnJpbmdUb0JhY2sgZHVwbGljYXRpb24gZnJvbSBUaWxlTGF5ZXIvUGF0aAoJYnJpbmdUb0Zyb250OiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX2ltYWdlKSB7CgkJCXRoaXMuX21hcC5fcGFuZXMub3ZlcmxheVBhbmUuYXBwZW5kQ2hpbGQodGhpcy5faW1hZ2UpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJYnJpbmdUb0JhY2s6IGZ1bmN0aW9uICgpIHsKCQl2YXIgcGFuZSA9IHRoaXMuX21hcC5fcGFuZXMub3ZlcmxheVBhbmU7CgkJaWYgKHRoaXMuX2ltYWdlKSB7CgkJCXBhbmUuaW5zZXJ0QmVmb3JlKHRoaXMuX2ltYWdlLCBwYW5lLmZpcnN0Q2hpbGQpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJc2V0VXJsOiBmdW5jdGlvbiAodXJsKSB7CgkJdGhpcy5fdXJsID0gdXJsOwoJCXRoaXMuX2ltYWdlLnNyYyA9IHRoaXMuX3VybDsKCX0sCgoJZ2V0QXR0cmlidXRpb246IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5vcHRpb25zLmF0dHJpYnV0aW9uOwoJfSwKCglfaW5pdEltYWdlOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5faW1hZ2UgPSBMLkRvbVV0aWwuY3JlYXRlKCdpbWcnLCAnbGVhZmxldC1pbWFnZS1sYXllcicpOwoKCQlpZiAodGhpcy5fbWFwLm9wdGlvbnMuem9vbUFuaW1hdGlvbiAmJiBMLkJyb3dzZXIuYW55M2QpIHsKCQkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX2ltYWdlLCAnbGVhZmxldC16b29tLWFuaW1hdGVkJyk7CgkJfSBlbHNlIHsKCQkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX2ltYWdlLCAnbGVhZmxldC16b29tLWhpZGUnKTsKCQl9CgoJCXRoaXMuX3VwZGF0ZU9wYWNpdHkoKTsKCgkJLy9UT0RPIGNyZWF0ZUltYWdlIHV0aWwgbWV0aG9kIHRvIHJlbW92ZSBkdXBsaWNhdGlvbgoJCUwuZXh0ZW5kKHRoaXMuX2ltYWdlLCB7CgkJCWdhbGxlcnlpbWc6ICdubycsCgkJCW9uc2VsZWN0c3RhcnQ6IEwuVXRpbC5mYWxzZUZuLAoJCQlvbm1vdXNlbW92ZTogTC5VdGlsLmZhbHNlRm4sCgkJCW9ubG9hZDogTC5iaW5kKHRoaXMuX29uSW1hZ2VMb2FkLCB0aGlzKSwKCQkJc3JjOiB0aGlzLl91cmwKCQl9KTsKCX0sCgoJX2FuaW1hdGVab29tOiBmdW5jdGlvbiAoZSkgewoJCXZhciBtYXAgPSB0aGlzLl9tYXAsCgkJICAgIGltYWdlID0gdGhpcy5faW1hZ2UsCgkJICAgIHNjYWxlID0gbWFwLmdldFpvb21TY2FsZShlLnpvb20pLAoJCSAgICBudyA9IHRoaXMuX2JvdW5kcy5nZXROb3J0aFdlc3QoKSwKCQkgICAgc2UgPSB0aGlzLl9ib3VuZHMuZ2V0U291dGhFYXN0KCksCgoJCSAgICB0b3BMZWZ0ID0gbWFwLl9sYXRMbmdUb05ld0xheWVyUG9pbnQobncsIGUuem9vbSwgZS5jZW50ZXIpLAoJCSAgICBzaXplID0gbWFwLl9sYXRMbmdUb05ld0xheWVyUG9pbnQoc2UsIGUuem9vbSwgZS5jZW50ZXIpLl9zdWJ0cmFjdCh0b3BMZWZ0KSwKCQkgICAgb3JpZ2luID0gdG9wTGVmdC5fYWRkKHNpemUuX211bHRpcGx5QnkoKDEgLyAyKSAqICgxIC0gMSAvIHNjYWxlKSkpOwoKCQlpbWFnZS5zdHlsZVtMLkRvbVV0aWwuVFJBTlNGT1JNXSA9CgkJICAgICAgICBMLkRvbVV0aWwuZ2V0VHJhbnNsYXRlU3RyaW5nKG9yaWdpbikgKyAnIHNjYWxlKCcgKyBzY2FsZSArICcpICc7Cgl9LAoKCV9yZXNldDogZnVuY3Rpb24gKCkgewoJCXZhciBpbWFnZSAgID0gdGhpcy5faW1hZ2UsCgkJICAgIHRvcExlZnQgPSB0aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KHRoaXMuX2JvdW5kcy5nZXROb3J0aFdlc3QoKSksCgkJICAgIHNpemUgPSB0aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KHRoaXMuX2JvdW5kcy5nZXRTb3V0aEVhc3QoKSkuX3N1YnRyYWN0KHRvcExlZnQpOwoKCQlMLkRvbVV0aWwuc2V0UG9zaXRpb24oaW1hZ2UsIHRvcExlZnQpOwoKCQlpbWFnZS5zdHlsZS53aWR0aCAgPSBzaXplLnggKyAncHgnOwoJCWltYWdlLnN0eWxlLmhlaWdodCA9IHNpemUueSArICdweCc7Cgl9LAoKCV9vbkltYWdlTG9hZDogZnVuY3Rpb24gKCkgewoJCXRoaXMuZmlyZSgnbG9hZCcpOwoJfSwKCglfdXBkYXRlT3BhY2l0eTogZnVuY3Rpb24gKCkgewoJCUwuRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2ltYWdlLCB0aGlzLm9wdGlvbnMub3BhY2l0eSk7Cgl9Cn0pOwoKTC5pbWFnZU92ZXJsYXkgPSBmdW5jdGlvbiAodXJsLCBib3VuZHMsIG9wdGlvbnMpIHsKCXJldHVybiBuZXcgTC5JbWFnZU92ZXJsYXkodXJsLCBib3VuZHMsIG9wdGlvbnMpOwp9OwoKCi8qCiAqIEwuSWNvbiBpcyBhbiBpbWFnZS1iYXNlZCBpY29uIGNsYXNzIHRoYXQgeW91IGNhbiB1c2Ugd2l0aCBMLk1hcmtlciBmb3IgY3VzdG9tIG1hcmtlcnMuCiAqLwoKTC5JY29uID0gTC5DbGFzcy5leHRlbmQoewoJb3B0aW9uczogewoJCS8qCgkJaWNvblVybDogKFN0cmluZykgKHJlcXVpcmVkKQoJCWljb25SZXRpbmFVcmw6IChTdHJpbmcpIChvcHRpb25hbCwgdXNlZCBmb3IgcmV0aW5hIGRldmljZXMgaWYgZGV0ZWN0ZWQpCgkJaWNvblNpemU6IChQb2ludCkgKGNhbiBiZSBzZXQgdGhyb3VnaCBDU1MpCgkJaWNvbkFuY2hvcjogKFBvaW50KSAoY2VudGVyZWQgYnkgZGVmYXVsdCwgY2FuIGJlIHNldCBpbiBDU1Mgd2l0aCBuZWdhdGl2ZSBtYXJnaW5zKQoJCXBvcHVwQW5jaG9yOiAoUG9pbnQpIChpZiBub3Qgc3BlY2lmaWVkLCBwb3B1cCBvcGVucyBpbiB0aGUgYW5jaG9yIHBvaW50KQoJCXNoYWRvd1VybDogKFN0cmluZykgKG5vIHNoYWRvdyBieSBkZWZhdWx0KQoJCXNoYWRvd1JldGluYVVybDogKFN0cmluZykgKG9wdGlvbmFsLCB1c2VkIGZvciByZXRpbmEgZGV2aWNlcyBpZiBkZXRlY3RlZCkKCQlzaGFkb3dTaXplOiAoUG9pbnQpCgkJc2hhZG93QW5jaG9yOiAoUG9pbnQpCgkJKi8KCQljbGFzc05hbWU6ICcnCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CgkJTC5zZXRPcHRpb25zKHRoaXMsIG9wdGlvbnMpOwoJfSwKCgljcmVhdGVJY29uOiBmdW5jdGlvbiAob2xkSWNvbikgewoJCXJldHVybiB0aGlzLl9jcmVhdGVJY29uKCdpY29uJywgb2xkSWNvbik7Cgl9LAoKCWNyZWF0ZVNoYWRvdzogZnVuY3Rpb24gKG9sZEljb24pIHsKCQlyZXR1cm4gdGhpcy5fY3JlYXRlSWNvbignc2hhZG93Jywgb2xkSWNvbik7Cgl9LAoKCV9jcmVhdGVJY29uOiBmdW5jdGlvbiAobmFtZSwgb2xkSWNvbikgewoJCXZhciBzcmMgPSB0aGlzLl9nZXRJY29uVXJsKG5hbWUpOwoKCQlpZiAoIXNyYykgewoJCQlpZiAobmFtZSA9PT0gJ2ljb24nKSB7CgkJCQl0aHJvdyBuZXcgRXJyb3IoJ2ljb25Vcmwgbm90IHNldCBpbiBJY29uIG9wdGlvbnMgKHNlZSB0aGUgZG9jcykuJyk7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfQoKCQl2YXIgaW1nOwoJCWlmICghb2xkSWNvbiB8fCBvbGRJY29uLnRhZ05hbWUgIT09ICdJTUcnKSB7CgkJCWltZyA9IHRoaXMuX2NyZWF0ZUltZyhzcmMpOwoJCX0gZWxzZSB7CgkJCWltZyA9IHRoaXMuX2NyZWF0ZUltZyhzcmMsIG9sZEljb24pOwoJCX0KCQl0aGlzLl9zZXRJY29uU3R5bGVzKGltZywgbmFtZSk7CgoJCXJldHVybiBpbWc7Cgl9LAoKCV9zZXRJY29uU3R5bGVzOiBmdW5jdGlvbiAoaW1nLCBuYW1lKSB7CgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCgkJICAgIHNpemUgPSBMLnBvaW50KG9wdGlvbnNbbmFtZSArICdTaXplJ10pLAoJCSAgICBhbmNob3I7CgoJCWlmIChuYW1lID09PSAnc2hhZG93JykgewoJCQlhbmNob3IgPSBMLnBvaW50KG9wdGlvbnMuc2hhZG93QW5jaG9yIHx8IG9wdGlvbnMuaWNvbkFuY2hvcik7CgkJfSBlbHNlIHsKCQkJYW5jaG9yID0gTC5wb2ludChvcHRpb25zLmljb25BbmNob3IpOwoJCX0KCgkJaWYgKCFhbmNob3IgJiYgc2l6ZSkgewoJCQlhbmNob3IgPSBzaXplLmRpdmlkZUJ5KDIsIHRydWUpOwoJCX0KCgkJaW1nLmNsYXNzTmFtZSA9ICdsZWFmbGV0LW1hcmtlci0nICsgbmFtZSArICcgJyArIG9wdGlvbnMuY2xhc3NOYW1lOwoKCQlpZiAoYW5jaG9yKSB7CgkJCWltZy5zdHlsZS5tYXJnaW5MZWZ0ID0gKC1hbmNob3IueCkgKyAncHgnOwoJCQlpbWcuc3R5bGUubWFyZ2luVG9wICA9ICgtYW5jaG9yLnkpICsgJ3B4JzsKCQl9CgoJCWlmIChzaXplKSB7CgkJCWltZy5zdHlsZS53aWR0aCAgPSBzaXplLnggKyAncHgnOwoJCQlpbWcuc3R5bGUuaGVpZ2h0ID0gc2l6ZS55ICsgJ3B4JzsKCQl9Cgl9LAoKCV9jcmVhdGVJbWc6IGZ1bmN0aW9uIChzcmMsIGVsKSB7CgkJZWwgPSBlbCB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsKCQllbC5zcmMgPSBzcmM7CgkJcmV0dXJuIGVsOwoJfSwKCglfZ2V0SWNvblVybDogZnVuY3Rpb24gKG5hbWUpIHsKCQlpZiAoTC5Ccm93c2VyLnJldGluYSAmJiB0aGlzLm9wdGlvbnNbbmFtZSArICdSZXRpbmFVcmwnXSkgewoJCQlyZXR1cm4gdGhpcy5vcHRpb25zW25hbWUgKyAnUmV0aW5hVXJsJ107CgkJfQoJCXJldHVybiB0aGlzLm9wdGlvbnNbbmFtZSArICdVcmwnXTsKCX0KfSk7CgpMLmljb24gPSBmdW5jdGlvbiAob3B0aW9ucykgewoJcmV0dXJuIG5ldyBMLkljb24ob3B0aW9ucyk7Cn07CgoKLyoKICogTC5JY29uLkRlZmF1bHQgaXMgdGhlIGJsdWUgbWFya2VyIGljb24gdXNlZCBieSBkZWZhdWx0IGluIExlYWZsZXQuCiAqLwoKTC5JY29uLkRlZmF1bHQgPSBMLkljb24uZXh0ZW5kKHsKCglvcHRpb25zOiB7CgkJaWNvblNpemU6IFsyNSwgNDFdLAoJCWljb25BbmNob3I6IFsxMiwgNDFdLAoJCXBvcHVwQW5jaG9yOiBbMSwgLTM0XSwKCgkJc2hhZG93U2l6ZTogWzQxLCA0MV0KCX0sCgoJX2dldEljb25Vcmw6IGZ1bmN0aW9uIChuYW1lKSB7CgkJdmFyIGtleSA9IG5hbWUgKyAnVXJsJzsKCgkJaWYgKHRoaXMub3B0aW9uc1trZXldKSB7CgkJCXJldHVybiB0aGlzLm9wdGlvbnNba2V5XTsKCQl9CgoJCWlmIChMLkJyb3dzZXIucmV0aW5hICYmIG5hbWUgPT09ICdpY29uJykgewoJCQluYW1lICs9ICctMngnOwoJCX0KCgkJdmFyIHBhdGggPSBMLkljb24uRGVmYXVsdC5pbWFnZVBhdGg7CgoJCWlmICghcGF0aCkgewoJCQl0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkblwndCBhdXRvZGV0ZWN0IEwuSWNvbi5EZWZhdWx0LmltYWdlUGF0aCwgc2V0IGl0IG1hbnVhbGx5LicpOwoJCX0KCgkJcmV0dXJuIHBhdGggKyAnL21hcmtlci0nICsgbmFtZSArICcucG5nJzsKCX0KfSk7CgpMLkljb24uRGVmYXVsdC5pbWFnZVBhdGggPSAoZnVuY3Rpb24gKCkgewoJdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JyksCgkgICAgbGVhZmxldFJlID0gL1tcL15dbGVhZmxldFtcLVwuX10/KFtcd1wtXC5fXSopXC5qc1w/Py87CgoJdmFyIGksIGxlbiwgc3JjLCBtYXRjaGVzLCBwYXRoOwoKCWZvciAoaSA9IDAsIGxlbiA9IHNjcmlwdHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQlzcmMgPSBzY3JpcHRzW2ldLnNyYzsKCQltYXRjaGVzID0gc3JjLm1hdGNoKGxlYWZsZXRSZSk7CgoJCWlmIChtYXRjaGVzKSB7CgkJCXBhdGggPSBzcmMuc3BsaXQobGVhZmxldFJlKVswXTsKCQkJcmV0dXJuIChwYXRoID8gcGF0aCArICcvJyA6ICcnKSArICdpbWFnZXMnOwoJCX0KCX0KfSgpKTsKCgovKgogKiBMLk1hcmtlciBpcyB1c2VkIHRvIGRpc3BsYXkgY2xpY2thYmxlL2RyYWdnYWJsZSBpY29ucyBvbiB0aGUgbWFwLgogKi8KCkwuTWFya2VyID0gTC5DbGFzcy5leHRlbmQoewoKCWluY2x1ZGVzOiBMLk1peGluLkV2ZW50cywKCglvcHRpb25zOiB7CgkJaWNvbjogbmV3IEwuSWNvbi5EZWZhdWx0KCksCgkJdGl0bGU6ICcnLAoJCWFsdDogJycsCgkJY2xpY2thYmxlOiB0cnVlLAoJCWRyYWdnYWJsZTogZmFsc2UsCgkJa2V5Ym9hcmQ6IHRydWUsCgkJekluZGV4T2Zmc2V0OiAwLAoJCW9wYWNpdHk6IDEsCgkJcmlzZU9uSG92ZXI6IGZhbHNlLAoJCXJpc2VPZmZzZXQ6IDI1MAoJfSwKCglpbml0aWFsaXplOiBmdW5jdGlvbiAobGF0bG5nLCBvcHRpb25zKSB7CgkJTC5zZXRPcHRpb25zKHRoaXMsIG9wdGlvbnMpOwoJCXRoaXMuX2xhdGxuZyA9IEwubGF0TG5nKGxhdGxuZyk7Cgl9LAoKCW9uQWRkOiBmdW5jdGlvbiAobWFwKSB7CgkJdGhpcy5fbWFwID0gbWFwOwoKCQltYXAub24oJ3ZpZXdyZXNldCcsIHRoaXMudXBkYXRlLCB0aGlzKTsKCgkJdGhpcy5faW5pdEljb24oKTsKCQl0aGlzLnVwZGF0ZSgpOwoJCXRoaXMuZmlyZSgnYWRkJyk7CgoJCWlmIChtYXAub3B0aW9ucy56b29tQW5pbWF0aW9uICYmIG1hcC5vcHRpb25zLm1hcmtlclpvb21BbmltYXRpb24pIHsKCQkJbWFwLm9uKCd6b29tYW5pbScsIHRoaXMuX2FuaW1hdGVab29tLCB0aGlzKTsKCQl9Cgl9LAoKCWFkZFRvOiBmdW5jdGlvbiAobWFwKSB7CgkJbWFwLmFkZExheWVyKHRoaXMpOwoJCXJldHVybiB0aGlzOwoJfSwKCglvblJlbW92ZTogZnVuY3Rpb24gKG1hcCkgewoJCWlmICh0aGlzLmRyYWdnaW5nKSB7CgkJCXRoaXMuZHJhZ2dpbmcuZGlzYWJsZSgpOwoJCX0KCgkJdGhpcy5fcmVtb3ZlSWNvbigpOwoJCXRoaXMuX3JlbW92ZVNoYWRvdygpOwoKCQl0aGlzLmZpcmUoJ3JlbW92ZScpOwoKCQltYXAub2ZmKHsKCQkJJ3ZpZXdyZXNldCc6IHRoaXMudXBkYXRlLAoJCQknem9vbWFuaW0nOiB0aGlzLl9hbmltYXRlWm9vbQoJCX0sIHRoaXMpOwoKCQl0aGlzLl9tYXAgPSBudWxsOwoJfSwKCglnZXRMYXRMbmc6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5fbGF0bG5nOwoJfSwKCglzZXRMYXRMbmc6IGZ1bmN0aW9uIChsYXRsbmcpIHsKCQl0aGlzLl9sYXRsbmcgPSBMLmxhdExuZyhsYXRsbmcpOwoKCQl0aGlzLnVwZGF0ZSgpOwoKCQlyZXR1cm4gdGhpcy5maXJlKCdtb3ZlJywgeyBsYXRsbmc6IHRoaXMuX2xhdGxuZyB9KTsKCX0sCgoJc2V0WkluZGV4T2Zmc2V0OiBmdW5jdGlvbiAob2Zmc2V0KSB7CgkJdGhpcy5vcHRpb25zLnpJbmRleE9mZnNldCA9IG9mZnNldDsKCQl0aGlzLnVwZGF0ZSgpOwoKCQlyZXR1cm4gdGhpczsKCX0sCgoJc2V0SWNvbjogZnVuY3Rpb24gKGljb24pIHsKCgkJdGhpcy5vcHRpb25zLmljb24gPSBpY29uOwoKCQlpZiAodGhpcy5fbWFwKSB7CgkJCXRoaXMuX2luaXRJY29uKCk7CgkJCXRoaXMudXBkYXRlKCk7CgkJfQoKCQlpZiAodGhpcy5fcG9wdXApIHsKCQkJdGhpcy5iaW5kUG9wdXAodGhpcy5fcG9wdXApOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXVwZGF0ZTogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9pY29uKSB7CgkJCXZhciBwb3MgPSB0aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KHRoaXMuX2xhdGxuZykucm91bmQoKTsKCQkJdGhpcy5fc2V0UG9zKHBvcyk7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJX2luaXRJY29uOiBmdW5jdGlvbiAoKSB7CgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCgkJICAgIG1hcCA9IHRoaXMuX21hcCwKCQkgICAgYW5pbWF0aW9uID0gKG1hcC5vcHRpb25zLnpvb21BbmltYXRpb24gJiYgbWFwLm9wdGlvbnMubWFya2VyWm9vbUFuaW1hdGlvbiksCgkJICAgIGNsYXNzVG9BZGQgPSBhbmltYXRpb24gPyAnbGVhZmxldC16b29tLWFuaW1hdGVkJyA6ICdsZWFmbGV0LXpvb20taGlkZSc7CgoJCXZhciBpY29uID0gb3B0aW9ucy5pY29uLmNyZWF0ZUljb24odGhpcy5faWNvbiksCgkJCWFkZEljb24gPSBmYWxzZTsKCgkJLy8gaWYgd2UncmUgbm90IHJldXNpbmcgdGhlIGljb24sIHJlbW92ZSB0aGUgb2xkIG9uZSBhbmQgaW5pdCBuZXcgb25lCgkJaWYgKGljb24gIT09IHRoaXMuX2ljb24pIHsKCQkJaWYgKHRoaXMuX2ljb24pIHsKCQkJCXRoaXMuX3JlbW92ZUljb24oKTsKCQkJfQoJCQlhZGRJY29uID0gdHJ1ZTsKCgkJCWlmIChvcHRpb25zLnRpdGxlKSB7CgkJCQlpY29uLnRpdGxlID0gb3B0aW9ucy50aXRsZTsKCQkJfQoJCQkKCQkJaWYgKG9wdGlvbnMuYWx0KSB7CgkJCQlpY29uLmFsdCA9IG9wdGlvbnMuYWx0OwoJCQl9CgkJfQoKCQlMLkRvbVV0aWwuYWRkQ2xhc3MoaWNvbiwgY2xhc3NUb0FkZCk7CgoJCWlmIChvcHRpb25zLmtleWJvYXJkKSB7CgkJCWljb24udGFiSW5kZXggPSAnMCc7CgkJfQoKCQl0aGlzLl9pY29uID0gaWNvbjsKCgkJdGhpcy5faW5pdEludGVyYWN0aW9uKCk7CgoJCWlmIChvcHRpb25zLnJpc2VPbkhvdmVyKSB7CgkJCUwuRG9tRXZlbnQKCQkJCS5vbihpY29uLCAnbW91c2VvdmVyJywgdGhpcy5fYnJpbmdUb0Zyb250LCB0aGlzKQoJCQkJLm9uKGljb24sICdtb3VzZW91dCcsIHRoaXMuX3Jlc2V0WkluZGV4LCB0aGlzKTsKCQl9CgoJCXZhciBuZXdTaGFkb3cgPSBvcHRpb25zLmljb24uY3JlYXRlU2hhZG93KHRoaXMuX3NoYWRvdyksCgkJCWFkZFNoYWRvdyA9IGZhbHNlOwoKCQlpZiAobmV3U2hhZG93ICE9PSB0aGlzLl9zaGFkb3cpIHsKCQkJdGhpcy5fcmVtb3ZlU2hhZG93KCk7CgkJCWFkZFNoYWRvdyA9IHRydWU7CgkJfQoKCQlpZiAobmV3U2hhZG93KSB7CgkJCUwuRG9tVXRpbC5hZGRDbGFzcyhuZXdTaGFkb3csIGNsYXNzVG9BZGQpOwoJCX0KCQl0aGlzLl9zaGFkb3cgPSBuZXdTaGFkb3c7CgoKCQlpZiAob3B0aW9ucy5vcGFjaXR5IDwgMSkgewoJCQl0aGlzLl91cGRhdGVPcGFjaXR5KCk7CgkJfQoKCgkJdmFyIHBhbmVzID0gdGhpcy5fbWFwLl9wYW5lczsKCgkJaWYgKGFkZEljb24pIHsKCQkJcGFuZXMubWFya2VyUGFuZS5hcHBlbmRDaGlsZCh0aGlzLl9pY29uKTsKCQl9CgoJCWlmIChuZXdTaGFkb3cgJiYgYWRkU2hhZG93KSB7CgkJCXBhbmVzLnNoYWRvd1BhbmUuYXBwZW5kQ2hpbGQodGhpcy5fc2hhZG93KTsKCQl9Cgl9LAoKCV9yZW1vdmVJY29uOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMub3B0aW9ucy5yaXNlT25Ib3ZlcikgewoJCQlMLkRvbUV2ZW50CgkJCSAgICAub2ZmKHRoaXMuX2ljb24sICdtb3VzZW92ZXInLCB0aGlzLl9icmluZ1RvRnJvbnQpCgkJCSAgICAub2ZmKHRoaXMuX2ljb24sICdtb3VzZW91dCcsIHRoaXMuX3Jlc2V0WkluZGV4KTsKCQl9CgoJCXRoaXMuX21hcC5fcGFuZXMubWFya2VyUGFuZS5yZW1vdmVDaGlsZCh0aGlzLl9pY29uKTsKCgkJdGhpcy5faWNvbiA9IG51bGw7Cgl9LAoKCV9yZW1vdmVTaGFkb3c6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fc2hhZG93KSB7CgkJCXRoaXMuX21hcC5fcGFuZXMuc2hhZG93UGFuZS5yZW1vdmVDaGlsZCh0aGlzLl9zaGFkb3cpOwoJCX0KCQl0aGlzLl9zaGFkb3cgPSBudWxsOwoJfSwKCglfc2V0UG9zOiBmdW5jdGlvbiAocG9zKSB7CgkJTC5Eb21VdGlsLnNldFBvc2l0aW9uKHRoaXMuX2ljb24sIHBvcyk7CgoJCWlmICh0aGlzLl9zaGFkb3cpIHsKCQkJTC5Eb21VdGlsLnNldFBvc2l0aW9uKHRoaXMuX3NoYWRvdywgcG9zKTsKCQl9CgoJCXRoaXMuX3pJbmRleCA9IHBvcy55ICsgdGhpcy5vcHRpb25zLnpJbmRleE9mZnNldDsKCgkJdGhpcy5fcmVzZXRaSW5kZXgoKTsKCX0sCgoJX3VwZGF0ZVpJbmRleDogZnVuY3Rpb24gKG9mZnNldCkgewoJCXRoaXMuX2ljb24uc3R5bGUuekluZGV4ID0gdGhpcy5fekluZGV4ICsgb2Zmc2V0OwoJfSwKCglfYW5pbWF0ZVpvb206IGZ1bmN0aW9uIChvcHQpIHsKCQl2YXIgcG9zID0gdGhpcy5fbWFwLl9sYXRMbmdUb05ld0xheWVyUG9pbnQodGhpcy5fbGF0bG5nLCBvcHQuem9vbSwgb3B0LmNlbnRlcikucm91bmQoKTsKCgkJdGhpcy5fc2V0UG9zKHBvcyk7Cgl9LAoKCV9pbml0SW50ZXJhY3Rpb246IGZ1bmN0aW9uICgpIHsKCgkJaWYgKCF0aGlzLm9wdGlvbnMuY2xpY2thYmxlKSB7IHJldHVybjsgfQoKCQkvLyBUT0RPIHJlZmFjdG9yIGludG8gc29tZXRoaW5nIHNoYXJlZCB3aXRoIE1hcC9QYXRoL2V0Yy4gdG8gRFJZIGl0IHVwCgoJCXZhciBpY29uID0gdGhpcy5faWNvbiwKCQkgICAgZXZlbnRzID0gWydkYmxjbGljaycsICdtb3VzZWRvd24nLCAnbW91c2VvdmVyJywgJ21vdXNlb3V0JywgJ2NvbnRleHRtZW51J107CgoJCUwuRG9tVXRpbC5hZGRDbGFzcyhpY29uLCAnbGVhZmxldC1jbGlja2FibGUnKTsKCQlMLkRvbUV2ZW50Lm9uKGljb24sICdjbGljaycsIHRoaXMuX29uTW91c2VDbGljaywgdGhpcyk7CgkJTC5Eb21FdmVudC5vbihpY29uLCAna2V5cHJlc3MnLCB0aGlzLl9vbktleVByZXNzLCB0aGlzKTsKCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudHMubGVuZ3RoOyBpKyspIHsKCQkJTC5Eb21FdmVudC5vbihpY29uLCBldmVudHNbaV0sIHRoaXMuX2ZpcmVNb3VzZUV2ZW50LCB0aGlzKTsKCQl9CgoJCWlmIChMLkhhbmRsZXIuTWFya2VyRHJhZykgewoJCQl0aGlzLmRyYWdnaW5nID0gbmV3IEwuSGFuZGxlci5NYXJrZXJEcmFnKHRoaXMpOwoKCQkJaWYgKHRoaXMub3B0aW9ucy5kcmFnZ2FibGUpIHsKCQkJCXRoaXMuZHJhZ2dpbmcuZW5hYmxlKCk7CgkJCX0KCQl9Cgl9LAoKCV9vbk1vdXNlQ2xpY2s6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIHdhc0RyYWdnZWQgPSB0aGlzLmRyYWdnaW5nICYmIHRoaXMuZHJhZ2dpbmcubW92ZWQoKTsKCgkJaWYgKHRoaXMuaGFzRXZlbnRMaXN0ZW5lcnMoZS50eXBlKSB8fCB3YXNEcmFnZ2VkKSB7CgkJCUwuRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKGUpOwoJCX0KCgkJaWYgKHdhc0RyYWdnZWQpIHsgcmV0dXJuOyB9CgoJCWlmICgoIXRoaXMuZHJhZ2dpbmcgfHwgIXRoaXMuZHJhZ2dpbmcuX2VuYWJsZWQpICYmIHRoaXMuX21hcC5kcmFnZ2luZyAmJiB0aGlzLl9tYXAuZHJhZ2dpbmcubW92ZWQoKSkgeyByZXR1cm47IH0KCgkJdGhpcy5maXJlKGUudHlwZSwgewoJCQlvcmlnaW5hbEV2ZW50OiBlLAoJCQlsYXRsbmc6IHRoaXMuX2xhdGxuZwoJCX0pOwoJfSwKCglfb25LZXlQcmVzczogZnVuY3Rpb24gKGUpIHsKCQlpZiAoZS5rZXlDb2RlID09PSAxMykgewoJCQl0aGlzLmZpcmUoJ2NsaWNrJywgewoJCQkJb3JpZ2luYWxFdmVudDogZSwKCQkJCWxhdGxuZzogdGhpcy5fbGF0bG5nCgkJCX0pOwoJCX0KCX0sCgoJX2ZpcmVNb3VzZUV2ZW50OiBmdW5jdGlvbiAoZSkgewoKCQl0aGlzLmZpcmUoZS50eXBlLCB7CgkJCW9yaWdpbmFsRXZlbnQ6IGUsCgkJCWxhdGxuZzogdGhpcy5fbGF0bG5nCgkJfSk7CgoJCS8vIFRPRE8gcHJvcGVyIGN1c3RvbSBldmVudCBwcm9wYWdhdGlvbgoJCS8vIHRoaXMgbGluZSB3aWxsIGFsd2F5cyBiZSBjYWxsZWQgaWYgbWFya2VyIGlzIGluIGEgRmVhdHVyZUdyb3VwCgkJaWYgKGUudHlwZSA9PT0gJ2NvbnRleHRtZW51JyAmJiB0aGlzLmhhc0V2ZW50TGlzdGVuZXJzKGUudHlwZSkpIHsKCQkJTC5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdChlKTsKCQl9CgkJaWYgKGUudHlwZSAhPT0gJ21vdXNlZG93bicpIHsKCQkJTC5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24oZSk7CgkJfSBlbHNlIHsKCQkJTC5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdChlKTsKCQl9Cgl9LAoKCXNldE9wYWNpdHk6IGZ1bmN0aW9uIChvcGFjaXR5KSB7CgkJdGhpcy5vcHRpb25zLm9wYWNpdHkgPSBvcGFjaXR5OwoJCWlmICh0aGlzLl9tYXApIHsKCQkJdGhpcy5fdXBkYXRlT3BhY2l0eSgpOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCV91cGRhdGVPcGFjaXR5OiBmdW5jdGlvbiAoKSB7CgkJTC5Eb21VdGlsLnNldE9wYWNpdHkodGhpcy5faWNvbiwgdGhpcy5vcHRpb25zLm9wYWNpdHkpOwoJCWlmICh0aGlzLl9zaGFkb3cpIHsKCQkJTC5Eb21VdGlsLnNldE9wYWNpdHkodGhpcy5fc2hhZG93LCB0aGlzLm9wdGlvbnMub3BhY2l0eSk7CgkJfQoJfSwKCglfYnJpbmdUb0Zyb250OiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fdXBkYXRlWkluZGV4KHRoaXMub3B0aW9ucy5yaXNlT2Zmc2V0KTsKCX0sCgoJX3Jlc2V0WkluZGV4OiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fdXBkYXRlWkluZGV4KDApOwoJfQp9KTsKCkwubWFya2VyID0gZnVuY3Rpb24gKGxhdGxuZywgb3B0aW9ucykgewoJcmV0dXJuIG5ldyBMLk1hcmtlcihsYXRsbmcsIG9wdGlvbnMpOwp9OwoKCi8qCiAqIEwuRGl2SWNvbiBpcyBhIGxpZ2h0d2VpZ2h0IEhUTUwtYmFzZWQgaWNvbiBjbGFzcyAoYXMgb3Bwb3NlZCB0byB0aGUgaW1hZ2UtYmFzZWQgTC5JY29uKQogKiB0byB1c2Ugd2l0aCBMLk1hcmtlci4KICovCgpMLkRpdkljb24gPSBMLkljb24uZXh0ZW5kKHsKCW9wdGlvbnM6IHsKCQlpY29uU2l6ZTogWzEyLCAxMl0sIC8vIGFsc28gY2FuIGJlIHNldCB0aHJvdWdoIENTUwoJCS8qCgkJaWNvbkFuY2hvcjogKFBvaW50KQoJCXBvcHVwQW5jaG9yOiAoUG9pbnQpCgkJaHRtbDogKFN0cmluZykKCQliZ1BvczogKFBvaW50KQoJCSovCgkJY2xhc3NOYW1lOiAnbGVhZmxldC1kaXYtaWNvbicsCgkJaHRtbDogZmFsc2UKCX0sCgoJY3JlYXRlSWNvbjogZnVuY3Rpb24gKG9sZEljb24pIHsKCQl2YXIgZGl2ID0gKG9sZEljb24gJiYgb2xkSWNvbi50YWdOYW1lID09PSAnRElWJykgPyBvbGRJY29uIDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgoJCWlmIChvcHRpb25zLmh0bWwgIT09IGZhbHNlKSB7CgkJCWRpdi5pbm5lckhUTUwgPSBvcHRpb25zLmh0bWw7CgkJfSBlbHNlIHsKCQkJZGl2LmlubmVySFRNTCA9ICcnOwoJCX0KCgkJaWYgKG9wdGlvbnMuYmdQb3MpIHsKCQkJZGl2LnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbiA9CgkJCSAgICAgICAgKC1vcHRpb25zLmJnUG9zLngpICsgJ3B4ICcgKyAoLW9wdGlvbnMuYmdQb3MueSkgKyAncHgnOwoJCX0KCgkJdGhpcy5fc2V0SWNvblN0eWxlcyhkaXYsICdpY29uJyk7CgkJcmV0dXJuIGRpdjsKCX0sCgoJY3JlYXRlU2hhZG93OiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIG51bGw7Cgl9Cn0pOwoKTC5kaXZJY29uID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKCXJldHVybiBuZXcgTC5EaXZJY29uKG9wdGlvbnMpOwp9OwoKCi8qCiAqIEwuUG9wdXAgaXMgdXNlZCBmb3IgZGlzcGxheWluZyBwb3B1cHMgb24gdGhlIG1hcC4KICovCgpMLk1hcC5tZXJnZU9wdGlvbnMoewoJY2xvc2VQb3B1cE9uQ2xpY2s6IHRydWUKfSk7CgpMLlBvcHVwID0gTC5DbGFzcy5leHRlbmQoewoJaW5jbHVkZXM6IEwuTWl4aW4uRXZlbnRzLAoKCW9wdGlvbnM6IHsKCQltaW5XaWR0aDogNTAsCgkJbWF4V2lkdGg6IDMwMCwKCQkvLyBtYXhIZWlnaHQ6IG51bGwsCgkJYXV0b1BhbjogdHJ1ZSwKCQljbG9zZUJ1dHRvbjogdHJ1ZSwKCQlvZmZzZXQ6IFswLCA3XSwKCQlhdXRvUGFuUGFkZGluZzogWzUsIDVdLAoJCS8vIGF1dG9QYW5QYWRkaW5nVG9wTGVmdDogbnVsbCwKCQkvLyBhdXRvUGFuUGFkZGluZ0JvdHRvbVJpZ2h0OiBudWxsLAoJCWtlZXBJblZpZXc6IGZhbHNlLAoJCWNsYXNzTmFtZTogJycsCgkJem9vbUFuaW1hdGlvbjogdHJ1ZQoJfSwKCglpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucywgc291cmNlKSB7CgkJTC5zZXRPcHRpb25zKHRoaXMsIG9wdGlvbnMpOwoKCQl0aGlzLl9zb3VyY2UgPSBzb3VyY2U7CgkJdGhpcy5fYW5pbWF0ZWQgPSBMLkJyb3dzZXIuYW55M2QgJiYgdGhpcy5vcHRpb25zLnpvb21BbmltYXRpb247CgkJdGhpcy5faXNPcGVuID0gZmFsc2U7Cgl9LAoKCW9uQWRkOiBmdW5jdGlvbiAobWFwKSB7CgkJdGhpcy5fbWFwID0gbWFwOwoKCQlpZiAoIXRoaXMuX2NvbnRhaW5lcikgewoJCQl0aGlzLl9pbml0TGF5b3V0KCk7CgkJfQoKCQl2YXIgYW5pbUZhZGUgPSBtYXAub3B0aW9ucy5mYWRlQW5pbWF0aW9uOwoKCQlpZiAoYW5pbUZhZGUpIHsKCQkJTC5Eb21VdGlsLnNldE9wYWNpdHkodGhpcy5fY29udGFpbmVyLCAwKTsKCQl9CgkJbWFwLl9wYW5lcy5wb3B1cFBhbmUuYXBwZW5kQ2hpbGQodGhpcy5fY29udGFpbmVyKTsKCgkJbWFwLm9uKHRoaXMuX2dldEV2ZW50cygpLCB0aGlzKTsKCgkJdGhpcy51cGRhdGUoKTsKCgkJaWYgKGFuaW1GYWRlKSB7CgkJCUwuRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2NvbnRhaW5lciwgMSk7CgkJfQoKCQl0aGlzLmZpcmUoJ29wZW4nKTsKCgkJbWFwLmZpcmUoJ3BvcHVwb3BlbicsIHtwb3B1cDogdGhpc30pOwoKCQlpZiAodGhpcy5fc291cmNlKSB7CgkJCXRoaXMuX3NvdXJjZS5maXJlKCdwb3B1cG9wZW4nLCB7cG9wdXA6IHRoaXN9KTsKCQl9Cgl9LAoKCWFkZFRvOiBmdW5jdGlvbiAobWFwKSB7CgkJbWFwLmFkZExheWVyKHRoaXMpOwoJCXJldHVybiB0aGlzOwoJfSwKCglvcGVuT246IGZ1bmN0aW9uIChtYXApIHsKCQltYXAub3BlblBvcHVwKHRoaXMpOwoJCXJldHVybiB0aGlzOwoJfSwKCglvblJlbW92ZTogZnVuY3Rpb24gKG1hcCkgewoJCW1hcC5fcGFuZXMucG9wdXBQYW5lLnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRhaW5lcik7CgoJCUwuVXRpbC5mYWxzZUZuKHRoaXMuX2NvbnRhaW5lci5vZmZzZXRXaWR0aCk7IC8vIGZvcmNlIHJlZmxvdwoKCQltYXAub2ZmKHRoaXMuX2dldEV2ZW50cygpLCB0aGlzKTsKCgkJaWYgKG1hcC5vcHRpb25zLmZhZGVBbmltYXRpb24pIHsKCQkJTC5Eb21VdGlsLnNldE9wYWNpdHkodGhpcy5fY29udGFpbmVyLCAwKTsKCQl9CgoJCXRoaXMuX21hcCA9IG51bGw7CgoJCXRoaXMuZmlyZSgnY2xvc2UnKTsKCgkJbWFwLmZpcmUoJ3BvcHVwY2xvc2UnLCB7cG9wdXA6IHRoaXN9KTsKCgkJaWYgKHRoaXMuX3NvdXJjZSkgewoJCQl0aGlzLl9zb3VyY2UuZmlyZSgncG9wdXBjbG9zZScsIHtwb3B1cDogdGhpc30pOwoJCX0KCX0sCgoJZ2V0TGF0TG5nOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRoaXMuX2xhdGxuZzsKCX0sCgoJc2V0TGF0TG5nOiBmdW5jdGlvbiAobGF0bG5nKSB7CgkJdGhpcy5fbGF0bG5nID0gTC5sYXRMbmcobGF0bG5nKTsKCQlpZiAodGhpcy5fbWFwKSB7CgkJCXRoaXMuX3VwZGF0ZVBvc2l0aW9uKCk7CgkJCXRoaXMuX2FkanVzdFBhbigpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJZ2V0Q29udGVudDogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9jb250ZW50OwoJfSwKCglzZXRDb250ZW50OiBmdW5jdGlvbiAoY29udGVudCkgewoJCXRoaXMuX2NvbnRlbnQgPSBjb250ZW50OwoJCXRoaXMudXBkYXRlKCk7CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXVwZGF0ZTogZnVuY3Rpb24gKCkgewoJCWlmICghdGhpcy5fbWFwKSB7IHJldHVybjsgfQoKCQl0aGlzLl9jb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOwoKCQl0aGlzLl91cGRhdGVDb250ZW50KCk7CgkJdGhpcy5fdXBkYXRlTGF5b3V0KCk7CgkJdGhpcy5fdXBkYXRlUG9zaXRpb24oKTsKCgkJdGhpcy5fY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAnJzsKCgkJdGhpcy5fYWRqdXN0UGFuKCk7Cgl9LAoKCV9nZXRFdmVudHM6IGZ1bmN0aW9uICgpIHsKCQl2YXIgZXZlbnRzID0gewoJCQl2aWV3cmVzZXQ6IHRoaXMuX3VwZGF0ZVBvc2l0aW9uCgkJfTsKCgkJaWYgKHRoaXMuX2FuaW1hdGVkKSB7CgkJCWV2ZW50cy56b29tYW5pbSA9IHRoaXMuX3pvb21BbmltYXRpb247CgkJfQoJCWlmICgnY2xvc2VPbkNsaWNrJyBpbiB0aGlzLm9wdGlvbnMgPyB0aGlzLm9wdGlvbnMuY2xvc2VPbkNsaWNrIDogdGhpcy5fbWFwLm9wdGlvbnMuY2xvc2VQb3B1cE9uQ2xpY2spIHsKCQkJZXZlbnRzLnByZWNsaWNrID0gdGhpcy5fY2xvc2U7CgkJfQoJCWlmICh0aGlzLm9wdGlvbnMua2VlcEluVmlldykgewoJCQlldmVudHMubW92ZWVuZCA9IHRoaXMuX2FkanVzdFBhbjsKCQl9CgoJCXJldHVybiBldmVudHM7Cgl9LAoKCV9jbG9zZTogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9tYXApIHsKCQkJdGhpcy5fbWFwLmNsb3NlUG9wdXAodGhpcyk7CgkJfQoJfSwKCglfaW5pdExheW91dDogZnVuY3Rpb24gKCkgewoJCXZhciBwcmVmaXggPSAnbGVhZmxldC1wb3B1cCcsCgkJCWNvbnRhaW5lckNsYXNzID0gcHJlZml4ICsgJyAnICsgdGhpcy5vcHRpb25zLmNsYXNzTmFtZSArICcgbGVhZmxldC16b29tLScgKwoJCQkgICAgICAgICh0aGlzLl9hbmltYXRlZCA/ICdhbmltYXRlZCcgOiAnaGlkZScpLAoJCQljb250YWluZXIgPSB0aGlzLl9jb250YWluZXIgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCBjb250YWluZXJDbGFzcyksCgkJCWNsb3NlQnV0dG9uOwoKCQlpZiAodGhpcy5vcHRpb25zLmNsb3NlQnV0dG9uKSB7CgkJCWNsb3NlQnV0dG9uID0gdGhpcy5fY2xvc2VCdXR0b24gPQoJCQkgICAgICAgIEwuRG9tVXRpbC5jcmVhdGUoJ2EnLCBwcmVmaXggKyAnLWNsb3NlLWJ1dHRvbicsIGNvbnRhaW5lcik7CgkJCWNsb3NlQnV0dG9uLmhyZWYgPSAnI2Nsb3NlJzsKCQkJY2xvc2VCdXR0b24uaW5uZXJIVE1MID0gJyYjMjE1Oyc7CgkJCUwuRG9tRXZlbnQuZGlzYWJsZUNsaWNrUHJvcGFnYXRpb24oY2xvc2VCdXR0b24pOwoKCQkJTC5Eb21FdmVudC5vbihjbG9zZUJ1dHRvbiwgJ2NsaWNrJywgdGhpcy5fb25DbG9zZUJ1dHRvbkNsaWNrLCB0aGlzKTsKCQl9CgoJCXZhciB3cmFwcGVyID0gdGhpcy5fd3JhcHBlciA9CgkJICAgICAgICBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCBwcmVmaXggKyAnLWNvbnRlbnQtd3JhcHBlcicsIGNvbnRhaW5lcik7CgkJTC5Eb21FdmVudC5kaXNhYmxlQ2xpY2tQcm9wYWdhdGlvbih3cmFwcGVyKTsKCgkJdGhpcy5fY29udGVudE5vZGUgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCBwcmVmaXggKyAnLWNvbnRlbnQnLCB3cmFwcGVyKTsKCgkJTC5Eb21FdmVudC5kaXNhYmxlU2Nyb2xsUHJvcGFnYXRpb24odGhpcy5fY29udGVudE5vZGUpOwoJCUwuRG9tRXZlbnQub24od3JhcHBlciwgJ2NvbnRleHRtZW51JywgTC5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24pOwoKCQl0aGlzLl90aXBDb250YWluZXIgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCBwcmVmaXggKyAnLXRpcC1jb250YWluZXInLCBjb250YWluZXIpOwoJCXRoaXMuX3RpcCA9IEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsIHByZWZpeCArICctdGlwJywgdGhpcy5fdGlwQ29udGFpbmVyKTsKCX0sCgoJX3VwZGF0ZUNvbnRlbnQ6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIXRoaXMuX2NvbnRlbnQpIHsgcmV0dXJuOyB9CgoJCWlmICh0eXBlb2YgdGhpcy5fY29udGVudCA9PT0gJ3N0cmluZycpIHsKCQkJdGhpcy5fY29udGVudE5vZGUuaW5uZXJIVE1MID0gdGhpcy5fY29udGVudDsKCQl9IGVsc2UgewoJCQl3aGlsZSAodGhpcy5fY29udGVudE5vZGUuaGFzQ2hpbGROb2RlcygpKSB7CgkJCQl0aGlzLl9jb250ZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLl9jb250ZW50Tm9kZS5maXJzdENoaWxkKTsKCQkJfQoJCQl0aGlzLl9jb250ZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLl9jb250ZW50KTsKCQl9CgkJdGhpcy5maXJlKCdjb250ZW50dXBkYXRlJyk7Cgl9LAoKCV91cGRhdGVMYXlvdXQ6IGZ1bmN0aW9uICgpIHsKCQl2YXIgY29udGFpbmVyID0gdGhpcy5fY29udGVudE5vZGUsCgkJICAgIHN0eWxlID0gY29udGFpbmVyLnN0eWxlOwoKCQlzdHlsZS53aWR0aCA9ICcnOwoJCXN0eWxlLndoaXRlU3BhY2UgPSAnbm93cmFwJzsKCgkJdmFyIHdpZHRoID0gY29udGFpbmVyLm9mZnNldFdpZHRoOwoJCXdpZHRoID0gTWF0aC5taW4od2lkdGgsIHRoaXMub3B0aW9ucy5tYXhXaWR0aCk7CgkJd2lkdGggPSBNYXRoLm1heCh3aWR0aCwgdGhpcy5vcHRpb25zLm1pbldpZHRoKTsKCgkJc3R5bGUud2lkdGggPSAod2lkdGggKyAxKSArICdweCc7CgkJc3R5bGUud2hpdGVTcGFjZSA9ICcnOwoKCQlzdHlsZS5oZWlnaHQgPSAnJzsKCgkJdmFyIGhlaWdodCA9IGNvbnRhaW5lci5vZmZzZXRIZWlnaHQsCgkJICAgIG1heEhlaWdodCA9IHRoaXMub3B0aW9ucy5tYXhIZWlnaHQsCgkJICAgIHNjcm9sbGVkQ2xhc3MgPSAnbGVhZmxldC1wb3B1cC1zY3JvbGxlZCc7CgoJCWlmIChtYXhIZWlnaHQgJiYgaGVpZ2h0ID4gbWF4SGVpZ2h0KSB7CgkJCXN0eWxlLmhlaWdodCA9IG1heEhlaWdodCArICdweCc7CgkJCUwuRG9tVXRpbC5hZGRDbGFzcyhjb250YWluZXIsIHNjcm9sbGVkQ2xhc3MpOwoJCX0gZWxzZSB7CgkJCUwuRG9tVXRpbC5yZW1vdmVDbGFzcyhjb250YWluZXIsIHNjcm9sbGVkQ2xhc3MpOwoJCX0KCgkJdGhpcy5fY29udGFpbmVyV2lkdGggPSB0aGlzLl9jb250YWluZXIub2Zmc2V0V2lkdGg7Cgl9LAoKCV91cGRhdGVQb3NpdGlvbjogZnVuY3Rpb24gKCkgewoJCWlmICghdGhpcy5fbWFwKSB7IHJldHVybjsgfQoKCQl2YXIgcG9zID0gdGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludCh0aGlzLl9sYXRsbmcpLAoJCSAgICBhbmltYXRlZCA9IHRoaXMuX2FuaW1hdGVkLAoJCSAgICBvZmZzZXQgPSBMLnBvaW50KHRoaXMub3B0aW9ucy5vZmZzZXQpOwoKCQlpZiAoYW5pbWF0ZWQpIHsKCQkJTC5Eb21VdGlsLnNldFBvc2l0aW9uKHRoaXMuX2NvbnRhaW5lciwgcG9zKTsKCQl9CgoJCXRoaXMuX2NvbnRhaW5lckJvdHRvbSA9IC1vZmZzZXQueSAtIChhbmltYXRlZCA/IDAgOiBwb3MueSk7CgkJdGhpcy5fY29udGFpbmVyTGVmdCA9IC1NYXRoLnJvdW5kKHRoaXMuX2NvbnRhaW5lcldpZHRoIC8gMikgKyBvZmZzZXQueCArIChhbmltYXRlZCA/IDAgOiBwb3MueCk7CgoJCS8vIGJvdHRvbSBwb3NpdGlvbiB0aGUgcG9wdXAgaW4gY2FzZSB0aGUgaGVpZ2h0IG9mIHRoZSBwb3B1cCBjaGFuZ2VzIChpbWFnZXMgbG9hZGluZyBldGMpCgkJdGhpcy5fY29udGFpbmVyLnN0eWxlLmJvdHRvbSA9IHRoaXMuX2NvbnRhaW5lckJvdHRvbSArICdweCc7CgkJdGhpcy5fY29udGFpbmVyLnN0eWxlLmxlZnQgPSB0aGlzLl9jb250YWluZXJMZWZ0ICsgJ3B4JzsKCX0sCgoJX3pvb21BbmltYXRpb246IGZ1bmN0aW9uIChvcHQpIHsKCQl2YXIgcG9zID0gdGhpcy5fbWFwLl9sYXRMbmdUb05ld0xheWVyUG9pbnQodGhpcy5fbGF0bG5nLCBvcHQuem9vbSwgb3B0LmNlbnRlcik7CgoJCUwuRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9jb250YWluZXIsIHBvcyk7Cgl9LAoKCV9hZGp1c3RQYW46IGZ1bmN0aW9uICgpIHsKCQlpZiAoIXRoaXMub3B0aW9ucy5hdXRvUGFuKSB7IHJldHVybjsgfQoKCQl2YXIgbWFwID0gdGhpcy5fbWFwLAoJCSAgICBjb250YWluZXJIZWlnaHQgPSB0aGlzLl9jb250YWluZXIub2Zmc2V0SGVpZ2h0LAoJCSAgICBjb250YWluZXJXaWR0aCA9IHRoaXMuX2NvbnRhaW5lcldpZHRoLAoKCQkgICAgbGF5ZXJQb3MgPSBuZXcgTC5Qb2ludCh0aGlzLl9jb250YWluZXJMZWZ0LCAtY29udGFpbmVySGVpZ2h0IC0gdGhpcy5fY29udGFpbmVyQm90dG9tKTsKCgkJaWYgKHRoaXMuX2FuaW1hdGVkKSB7CgkJCWxheWVyUG9zLl9hZGQoTC5Eb21VdGlsLmdldFBvc2l0aW9uKHRoaXMuX2NvbnRhaW5lcikpOwoJCX0KCgkJdmFyIGNvbnRhaW5lclBvcyA9IG1hcC5sYXllclBvaW50VG9Db250YWluZXJQb2ludChsYXllclBvcyksCgkJICAgIHBhZGRpbmcgPSBMLnBvaW50KHRoaXMub3B0aW9ucy5hdXRvUGFuUGFkZGluZyksCgkJICAgIHBhZGRpbmdUTCA9IEwucG9pbnQodGhpcy5vcHRpb25zLmF1dG9QYW5QYWRkaW5nVG9wTGVmdCB8fCBwYWRkaW5nKSwKCQkgICAgcGFkZGluZ0JSID0gTC5wb2ludCh0aGlzLm9wdGlvbnMuYXV0b1BhblBhZGRpbmdCb3R0b21SaWdodCB8fCBwYWRkaW5nKSwKCQkgICAgc2l6ZSA9IG1hcC5nZXRTaXplKCksCgkJICAgIGR4ID0gMCwKCQkgICAgZHkgPSAwOwoKCQlpZiAoY29udGFpbmVyUG9zLnggKyBjb250YWluZXJXaWR0aCArIHBhZGRpbmdCUi54ID4gc2l6ZS54KSB7IC8vIHJpZ2h0CgkJCWR4ID0gY29udGFpbmVyUG9zLnggKyBjb250YWluZXJXaWR0aCAtIHNpemUueCArIHBhZGRpbmdCUi54OwoJCX0KCQlpZiAoY29udGFpbmVyUG9zLnggLSBkeCAtIHBhZGRpbmdUTC54IDwgMCkgeyAvLyBsZWZ0CgkJCWR4ID0gY29udGFpbmVyUG9zLnggLSBwYWRkaW5nVEwueDsKCQl9CgkJaWYgKGNvbnRhaW5lclBvcy55ICsgY29udGFpbmVySGVpZ2h0ICsgcGFkZGluZ0JSLnkgPiBzaXplLnkpIHsgLy8gYm90dG9tCgkJCWR5ID0gY29udGFpbmVyUG9zLnkgKyBjb250YWluZXJIZWlnaHQgLSBzaXplLnkgKyBwYWRkaW5nQlIueTsKCQl9CgkJaWYgKGNvbnRhaW5lclBvcy55IC0gZHkgLSBwYWRkaW5nVEwueSA8IDApIHsgLy8gdG9wCgkJCWR5ID0gY29udGFpbmVyUG9zLnkgLSBwYWRkaW5nVEwueTsKCQl9CgoJCWlmIChkeCB8fCBkeSkgewoJCQltYXAKCQkJICAgIC5maXJlKCdhdXRvcGFuc3RhcnQnKQoJCQkgICAgLnBhbkJ5KFtkeCwgZHldKTsKCQl9Cgl9LAoKCV9vbkNsb3NlQnV0dG9uQ2xpY2s6IGZ1bmN0aW9uIChlKSB7CgkJdGhpcy5fY2xvc2UoKTsKCQlMLkRvbUV2ZW50LnN0b3AoZSk7Cgl9Cn0pOwoKTC5wb3B1cCA9IGZ1bmN0aW9uIChvcHRpb25zLCBzb3VyY2UpIHsKCXJldHVybiBuZXcgTC5Qb3B1cChvcHRpb25zLCBzb3VyY2UpOwp9OwoKCkwuTWFwLmluY2x1ZGUoewoJb3BlblBvcHVwOiBmdW5jdGlvbiAocG9wdXAsIGxhdGxuZywgb3B0aW9ucykgeyAvLyAoUG9wdXApIG9yIChTdHJpbmcgfHwgSFRNTEVsZW1lbnQsIExhdExuZ1ssIE9iamVjdF0pCgkJdGhpcy5jbG9zZVBvcHVwKCk7CgoJCWlmICghKHBvcHVwIGluc3RhbmNlb2YgTC5Qb3B1cCkpIHsKCQkJdmFyIGNvbnRlbnQgPSBwb3B1cDsKCgkJCXBvcHVwID0gbmV3IEwuUG9wdXAob3B0aW9ucykKCQkJICAgIC5zZXRMYXRMbmcobGF0bG5nKQoJCQkgICAgLnNldENvbnRlbnQoY29udGVudCk7CgkJfQoJCXBvcHVwLl9pc09wZW4gPSB0cnVlOwoKCQl0aGlzLl9wb3B1cCA9IHBvcHVwOwoJCXJldHVybiB0aGlzLmFkZExheWVyKHBvcHVwKTsKCX0sCgoJY2xvc2VQb3B1cDogZnVuY3Rpb24gKHBvcHVwKSB7CgkJaWYgKCFwb3B1cCB8fCBwb3B1cCA9PT0gdGhpcy5fcG9wdXApIHsKCQkJcG9wdXAgPSB0aGlzLl9wb3B1cDsKCQkJdGhpcy5fcG9wdXAgPSBudWxsOwoJCX0KCQlpZiAocG9wdXApIHsKCQkJdGhpcy5yZW1vdmVMYXllcihwb3B1cCk7CgkJCXBvcHVwLl9pc09wZW4gPSBmYWxzZTsKCQl9CgkJcmV0dXJuIHRoaXM7Cgl9Cn0pOwoKCi8qCiAqIFBvcHVwIGV4dGVuc2lvbiB0byBMLk1hcmtlciwgYWRkaW5nIHBvcHVwLXJlbGF0ZWQgbWV0aG9kcy4KICovCgpMLk1hcmtlci5pbmNsdWRlKHsKCW9wZW5Qb3B1cDogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9wb3B1cCAmJiB0aGlzLl9tYXAgJiYgIXRoaXMuX21hcC5oYXNMYXllcih0aGlzLl9wb3B1cCkpIHsKCQkJdGhpcy5fcG9wdXAuc2V0TGF0TG5nKHRoaXMuX2xhdGxuZyk7CgkJCXRoaXMuX21hcC5vcGVuUG9wdXAodGhpcy5fcG9wdXApOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWNsb3NlUG9wdXA6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fcG9wdXApIHsKCQkJdGhpcy5fcG9wdXAuX2Nsb3NlKCk7CgkJfQoJCXJldHVybiB0aGlzOwoJfSwKCgl0b2dnbGVQb3B1cDogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9wb3B1cCkgewoJCQlpZiAodGhpcy5fcG9wdXAuX2lzT3BlbikgewoJCQkJdGhpcy5jbG9zZVBvcHVwKCk7CgkJCX0gZWxzZSB7CgkJCQl0aGlzLm9wZW5Qb3B1cCgpOwoJCQl9CgkJfQoJCXJldHVybiB0aGlzOwoJfSwKCgliaW5kUG9wdXA6IGZ1bmN0aW9uIChjb250ZW50LCBvcHRpb25zKSB7CgkJdmFyIGFuY2hvciA9IEwucG9pbnQodGhpcy5vcHRpb25zLmljb24ub3B0aW9ucy5wb3B1cEFuY2hvciB8fCBbMCwgMF0pOwoKCQlhbmNob3IgPSBhbmNob3IuYWRkKEwuUG9wdXAucHJvdG90eXBlLm9wdGlvbnMub2Zmc2V0KTsKCgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5vZmZzZXQpIHsKCQkJYW5jaG9yID0gYW5jaG9yLmFkZChvcHRpb25zLm9mZnNldCk7CgkJfQoKCQlvcHRpb25zID0gTC5leHRlbmQoe29mZnNldDogYW5jaG9yfSwgb3B0aW9ucyk7CgoJCWlmICghdGhpcy5fcG9wdXBIYW5kbGVyc0FkZGVkKSB7CgkJCXRoaXMKCQkJICAgIC5vbignY2xpY2snLCB0aGlzLnRvZ2dsZVBvcHVwLCB0aGlzKQoJCQkgICAgLm9uKCdyZW1vdmUnLCB0aGlzLmNsb3NlUG9wdXAsIHRoaXMpCgkJCSAgICAub24oJ21vdmUnLCB0aGlzLl9tb3ZlUG9wdXAsIHRoaXMpOwoJCQl0aGlzLl9wb3B1cEhhbmRsZXJzQWRkZWQgPSB0cnVlOwoJCX0KCgkJaWYgKGNvbnRlbnQgaW5zdGFuY2VvZiBMLlBvcHVwKSB7CgkJCUwuc2V0T3B0aW9ucyhjb250ZW50LCBvcHRpb25zKTsKCQkJdGhpcy5fcG9wdXAgPSBjb250ZW50OwoJCX0gZWxzZSB7CgkJCXRoaXMuX3BvcHVwID0gbmV3IEwuUG9wdXAob3B0aW9ucywgdGhpcykKCQkJCS5zZXRDb250ZW50KGNvbnRlbnQpOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXNldFBvcHVwQ29udGVudDogZnVuY3Rpb24gKGNvbnRlbnQpIHsKCQlpZiAodGhpcy5fcG9wdXApIHsKCQkJdGhpcy5fcG9wdXAuc2V0Q29udGVudChjb250ZW50KTsKCQl9CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXVuYmluZFBvcHVwOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX3BvcHVwKSB7CgkJCXRoaXMuX3BvcHVwID0gbnVsbDsKCQkJdGhpcwoJCQkgICAgLm9mZignY2xpY2snLCB0aGlzLnRvZ2dsZVBvcHVwLCB0aGlzKQoJCQkgICAgLm9mZigncmVtb3ZlJywgdGhpcy5jbG9zZVBvcHVwLCB0aGlzKQoJCQkgICAgLm9mZignbW92ZScsIHRoaXMuX21vdmVQb3B1cCwgdGhpcyk7CgkJCXRoaXMuX3BvcHVwSGFuZGxlcnNBZGRlZCA9IGZhbHNlOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJZ2V0UG9wdXA6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5fcG9wdXA7Cgl9LAoKCV9tb3ZlUG9wdXA6IGZ1bmN0aW9uIChlKSB7CgkJdGhpcy5fcG9wdXAuc2V0TGF0TG5nKGUubGF0bG5nKTsKCX0KfSk7CgoKLyoKICogTC5MYXllckdyb3VwIGlzIGEgY2xhc3MgdG8gY29tYmluZSBzZXZlcmFsIGxheWVycyBpbnRvIG9uZSBzbyB0aGF0CiAqIHlvdSBjYW4gbWFuaXB1bGF0ZSB0aGUgZ3JvdXAgKGUuZy4gYWRkL3JlbW92ZSBpdCkgYXMgb25lIGxheWVyLgogKi8KCkwuTGF5ZXJHcm91cCA9IEwuQ2xhc3MuZXh0ZW5kKHsKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChsYXllcnMpIHsKCQl0aGlzLl9sYXllcnMgPSB7fTsKCgkJdmFyIGksIGxlbjsKCgkJaWYgKGxheWVycykgewoJCQlmb3IgKGkgPSAwLCBsZW4gPSBsYXllcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJCXRoaXMuYWRkTGF5ZXIobGF5ZXJzW2ldKTsKCQkJfQoJCX0KCX0sCgoJYWRkTGF5ZXI6IGZ1bmN0aW9uIChsYXllcikgewoJCXZhciBpZCA9IHRoaXMuZ2V0TGF5ZXJJZChsYXllcik7CgoJCXRoaXMuX2xheWVyc1tpZF0gPSBsYXllcjsKCgkJaWYgKHRoaXMuX21hcCkgewoJCQl0aGlzLl9tYXAuYWRkTGF5ZXIobGF5ZXIpOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXJlbW92ZUxheWVyOiBmdW5jdGlvbiAobGF5ZXIpIHsKCQl2YXIgaWQgPSBsYXllciBpbiB0aGlzLl9sYXllcnMgPyBsYXllciA6IHRoaXMuZ2V0TGF5ZXJJZChsYXllcik7CgoJCWlmICh0aGlzLl9tYXAgJiYgdGhpcy5fbGF5ZXJzW2lkXSkgewoJCQl0aGlzLl9tYXAucmVtb3ZlTGF5ZXIodGhpcy5fbGF5ZXJzW2lkXSk7CgkJfQoKCQlkZWxldGUgdGhpcy5fbGF5ZXJzW2lkXTsKCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWhhc0xheWVyOiBmdW5jdGlvbiAobGF5ZXIpIHsKCQlpZiAoIWxheWVyKSB7IHJldHVybiBmYWxzZTsgfQoKCQlyZXR1cm4gKGxheWVyIGluIHRoaXMuX2xheWVycyB8fCB0aGlzLmdldExheWVySWQobGF5ZXIpIGluIHRoaXMuX2xheWVycyk7Cgl9LAoKCWNsZWFyTGF5ZXJzOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5lYWNoTGF5ZXIodGhpcy5yZW1vdmVMYXllciwgdGhpcyk7CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWludm9rZTogZnVuY3Rpb24gKG1ldGhvZE5hbWUpIHsKCQl2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksCgkJICAgIGksIGxheWVyOwoKCQlmb3IgKGkgaW4gdGhpcy5fbGF5ZXJzKSB7CgkJCWxheWVyID0gdGhpcy5fbGF5ZXJzW2ldOwoKCQkJaWYgKGxheWVyW21ldGhvZE5hbWVdKSB7CgkJCQlsYXllclttZXRob2ROYW1lXS5hcHBseShsYXllciwgYXJncyk7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCglvbkFkZDogZnVuY3Rpb24gKG1hcCkgewoJCXRoaXMuX21hcCA9IG1hcDsKCQl0aGlzLmVhY2hMYXllcihtYXAuYWRkTGF5ZXIsIG1hcCk7Cgl9LAoKCW9uUmVtb3ZlOiBmdW5jdGlvbiAobWFwKSB7CgkJdGhpcy5lYWNoTGF5ZXIobWFwLnJlbW92ZUxheWVyLCBtYXApOwoJCXRoaXMuX21hcCA9IG51bGw7Cgl9LAoKCWFkZFRvOiBmdW5jdGlvbiAobWFwKSB7CgkJbWFwLmFkZExheWVyKHRoaXMpOwoJCXJldHVybiB0aGlzOwoJfSwKCgllYWNoTGF5ZXI6IGZ1bmN0aW9uIChtZXRob2QsIGNvbnRleHQpIHsKCQlmb3IgKHZhciBpIGluIHRoaXMuX2xheWVycykgewoJCQltZXRob2QuY2FsbChjb250ZXh0LCB0aGlzLl9sYXllcnNbaV0pOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJZ2V0TGF5ZXI6IGZ1bmN0aW9uIChpZCkgewoJCXJldHVybiB0aGlzLl9sYXllcnNbaWRdOwoJfSwKCglnZXRMYXllcnM6IGZ1bmN0aW9uICgpIHsKCQl2YXIgbGF5ZXJzID0gW107CgoJCWZvciAodmFyIGkgaW4gdGhpcy5fbGF5ZXJzKSB7CgkJCWxheWVycy5wdXNoKHRoaXMuX2xheWVyc1tpXSk7CgkJfQoJCXJldHVybiBsYXllcnM7Cgl9LAoKCXNldFpJbmRleDogZnVuY3Rpb24gKHpJbmRleCkgewoJCXJldHVybiB0aGlzLmludm9rZSgnc2V0WkluZGV4JywgekluZGV4KTsKCX0sCgoJZ2V0TGF5ZXJJZDogZnVuY3Rpb24gKGxheWVyKSB7CgkJcmV0dXJuIEwuc3RhbXAobGF5ZXIpOwoJfQp9KTsKCkwubGF5ZXJHcm91cCA9IGZ1bmN0aW9uIChsYXllcnMpIHsKCXJldHVybiBuZXcgTC5MYXllckdyb3VwKGxheWVycyk7Cn07CgoKLyoKICogTC5GZWF0dXJlR3JvdXAgZXh0ZW5kcyBMLkxheWVyR3JvdXAgYnkgaW50cm9kdWNpbmcgbW91c2UgZXZlbnRzIGFuZCBhZGRpdGlvbmFsIG1ldGhvZHMKICogc2hhcmVkIGJldHdlZW4gYSBncm91cCBvZiBpbnRlcmFjdGl2ZSBsYXllcnMgKGxpa2UgdmVjdG9ycyBvciBtYXJrZXJzKS4KICovCgpMLkZlYXR1cmVHcm91cCA9IEwuTGF5ZXJHcm91cC5leHRlbmQoewoJaW5jbHVkZXM6IEwuTWl4aW4uRXZlbnRzLAoKCXN0YXRpY3M6IHsKCQlFVkVOVFM6ICdjbGljayBkYmxjbGljayBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2Vtb3ZlIGNvbnRleHRtZW51IHBvcHVwb3BlbiBwb3B1cGNsb3NlJwoJfSwKCglhZGRMYXllcjogZnVuY3Rpb24gKGxheWVyKSB7CgkJaWYgKHRoaXMuaGFzTGF5ZXIobGF5ZXIpKSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJaWYgKCdvbicgaW4gbGF5ZXIpIHsKCQkJbGF5ZXIub24oTC5GZWF0dXJlR3JvdXAuRVZFTlRTLCB0aGlzLl9wcm9wYWdhdGVFdmVudCwgdGhpcyk7CgkJfQoKCQlMLkxheWVyR3JvdXAucHJvdG90eXBlLmFkZExheWVyLmNhbGwodGhpcywgbGF5ZXIpOwoKCQlpZiAodGhpcy5fcG9wdXBDb250ZW50ICYmIGxheWVyLmJpbmRQb3B1cCkgewoJCQlsYXllci5iaW5kUG9wdXAodGhpcy5fcG9wdXBDb250ZW50LCB0aGlzLl9wb3B1cE9wdGlvbnMpOwoJCX0KCgkJcmV0dXJuIHRoaXMuZmlyZSgnbGF5ZXJhZGQnLCB7bGF5ZXI6IGxheWVyfSk7Cgl9LAoKCXJlbW92ZUxheWVyOiBmdW5jdGlvbiAobGF5ZXIpIHsKCQlpZiAoIXRoaXMuaGFzTGF5ZXIobGF5ZXIpKSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCQlpZiAobGF5ZXIgaW4gdGhpcy5fbGF5ZXJzKSB7CgkJCWxheWVyID0gdGhpcy5fbGF5ZXJzW2xheWVyXTsKCQl9CgoJCWxheWVyLm9mZihMLkZlYXR1cmVHcm91cC5FVkVOVFMsIHRoaXMuX3Byb3BhZ2F0ZUV2ZW50LCB0aGlzKTsKCgkJTC5MYXllckdyb3VwLnByb3RvdHlwZS5yZW1vdmVMYXllci5jYWxsKHRoaXMsIGxheWVyKTsKCgkJaWYgKHRoaXMuX3BvcHVwQ29udGVudCkgewoJCQl0aGlzLmludm9rZSgndW5iaW5kUG9wdXAnKTsKCQl9CgoJCXJldHVybiB0aGlzLmZpcmUoJ2xheWVycmVtb3ZlJywge2xheWVyOiBsYXllcn0pOwoJfSwKCgliaW5kUG9wdXA6IGZ1bmN0aW9uIChjb250ZW50LCBvcHRpb25zKSB7CgkJdGhpcy5fcG9wdXBDb250ZW50ID0gY29udGVudDsKCQl0aGlzLl9wb3B1cE9wdGlvbnMgPSBvcHRpb25zOwoJCXJldHVybiB0aGlzLmludm9rZSgnYmluZFBvcHVwJywgY29udGVudCwgb3B0aW9ucyk7Cgl9LAoKCW9wZW5Qb3B1cDogZnVuY3Rpb24gKGxhdGxuZykgewoJCS8vIG9wZW4gcG9wdXAgb24gdGhlIGZpcnN0IGxheWVyCgkJZm9yICh2YXIgaWQgaW4gdGhpcy5fbGF5ZXJzKSB7CgkJCXRoaXMuX2xheWVyc1tpZF0ub3BlblBvcHVwKGxhdGxuZyk7CgkJCWJyZWFrOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJc2V0U3R5bGU6IGZ1bmN0aW9uIChzdHlsZSkgewoJCXJldHVybiB0aGlzLmludm9rZSgnc2V0U3R5bGUnLCBzdHlsZSk7Cgl9LAoKCWJyaW5nVG9Gcm9udDogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLmludm9rZSgnYnJpbmdUb0Zyb250Jyk7Cgl9LAoKCWJyaW5nVG9CYWNrOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRoaXMuaW52b2tlKCdicmluZ1RvQmFjaycpOwoJfSwKCglnZXRCb3VuZHM6IGZ1bmN0aW9uICgpIHsKCQl2YXIgYm91bmRzID0gbmV3IEwuTGF0TG5nQm91bmRzKCk7CgoJCXRoaXMuZWFjaExheWVyKGZ1bmN0aW9uIChsYXllcikgewoJCQlib3VuZHMuZXh0ZW5kKGxheWVyIGluc3RhbmNlb2YgTC5NYXJrZXIgPyBsYXllci5nZXRMYXRMbmcoKSA6IGxheWVyLmdldEJvdW5kcygpKTsKCQl9KTsKCgkJcmV0dXJuIGJvdW5kczsKCX0sCgoJX3Byb3BhZ2F0ZUV2ZW50OiBmdW5jdGlvbiAoZSkgewoJCWUgPSBMLmV4dGVuZCh7CgkJCWxheWVyOiBlLnRhcmdldCwKCQkJdGFyZ2V0OiB0aGlzCgkJfSwgZSk7CgkJdGhpcy5maXJlKGUudHlwZSwgZSk7Cgl9Cn0pOwoKTC5mZWF0dXJlR3JvdXAgPSBmdW5jdGlvbiAobGF5ZXJzKSB7CglyZXR1cm4gbmV3IEwuRmVhdHVyZUdyb3VwKGxheWVycyk7Cn07CgoKLyoKICogTC5QYXRoIGlzIGEgYmFzZSBjbGFzcyBmb3IgcmVuZGVyaW5nIHZlY3RvciBwYXRocyBvbiBhIG1hcC4gSW5oZXJpdGVkIGJ5IFBvbHlsaW5lLCBDaXJjbGUsIGV0Yy4KICovCgpMLlBhdGggPSBMLkNsYXNzLmV4dGVuZCh7CglpbmNsdWRlczogW0wuTWl4aW4uRXZlbnRzXSwKCglzdGF0aWNzOiB7CgkJLy8gaG93IG11Y2ggdG8gZXh0ZW5kIHRoZSBjbGlwIGFyZWEgYXJvdW5kIHRoZSBtYXAgdmlldwoJCS8vIChyZWxhdGl2ZSB0byBpdHMgc2l6ZSwgZS5nLiAwLjUgaXMgaGFsZiB0aGUgc2NyZWVuIGluIGVhY2ggZGlyZWN0aW9uKQoJCS8vIHNldCBpdCBzbyB0aGF0IFNWRyBlbGVtZW50IGRvZXNuJ3QgZXhjZWVkIDEyODBweCAodmVjdG9ycyBmbGlja2VyIG9uIGRyYWdlbmQgaWYgaXQgaXMpCgkJQ0xJUF9QQURESU5HOiAoZnVuY3Rpb24gKCkgewoJCQl2YXIgbWF4ID0gTC5Ccm93c2VyLm1vYmlsZSA/IDEyODAgOiAyMDAwLAoJCQkgICAgdGFyZ2V0ID0gKG1heCAvIE1hdGgubWF4KHdpbmRvdy5vdXRlcldpZHRoLCB3aW5kb3cub3V0ZXJIZWlnaHQpIC0gMSkgLyAyOwoJCQlyZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4oMC41LCB0YXJnZXQpKTsKCQl9KSgpCgl9LAoKCW9wdGlvbnM6IHsKCQlzdHJva2U6IHRydWUsCgkJY29sb3I6ICcjMDAzM2ZmJywKCQlkYXNoQXJyYXk6IG51bGwsCgkJbGluZUNhcDogbnVsbCwKCQlsaW5lSm9pbjogbnVsbCwKCQl3ZWlnaHQ6IDUsCgkJb3BhY2l0eTogMC41LAoKCQlmaWxsOiBmYWxzZSwKCQlmaWxsQ29sb3I6IG51bGwsIC8vc2FtZSBhcyBjb2xvciBieSBkZWZhdWx0CgkJZmlsbE9wYWNpdHk6IDAuMiwKCgkJY2xpY2thYmxlOiB0cnVlCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CgkJTC5zZXRPcHRpb25zKHRoaXMsIG9wdGlvbnMpOwoJfSwKCglvbkFkZDogZnVuY3Rpb24gKG1hcCkgewoJCXRoaXMuX21hcCA9IG1hcDsKCgkJaWYgKCF0aGlzLl9jb250YWluZXIpIHsKCQkJdGhpcy5faW5pdEVsZW1lbnRzKCk7CgkJCXRoaXMuX2luaXRFdmVudHMoKTsKCQl9CgoJCXRoaXMucHJvamVjdExhdGxuZ3MoKTsKCQl0aGlzLl91cGRhdGVQYXRoKCk7CgoJCWlmICh0aGlzLl9jb250YWluZXIpIHsKCQkJdGhpcy5fbWFwLl9wYXRoUm9vdC5hcHBlbmRDaGlsZCh0aGlzLl9jb250YWluZXIpOwoJCX0KCgkJdGhpcy5maXJlKCdhZGQnKTsKCgkJbWFwLm9uKHsKCQkJJ3ZpZXdyZXNldCc6IHRoaXMucHJvamVjdExhdGxuZ3MsCgkJCSdtb3ZlZW5kJzogdGhpcy5fdXBkYXRlUGF0aAoJCX0sIHRoaXMpOwoJfSwKCglhZGRUbzogZnVuY3Rpb24gKG1hcCkgewoJCW1hcC5hZGRMYXllcih0aGlzKTsKCQlyZXR1cm4gdGhpczsKCX0sCgoJb25SZW1vdmU6IGZ1bmN0aW9uIChtYXApIHsKCQltYXAuX3BhdGhSb290LnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRhaW5lcik7CgoJCS8vIE5lZWQgdG8gZmlyZSByZW1vdmUgZXZlbnQgYmVmb3JlIHdlIHNldCBfbWFwIHRvIG51bGwgYXMgdGhlIGV2ZW50IGhvb2tzIG1pZ2h0IG5lZWQgdGhlIG9iamVjdAoJCXRoaXMuZmlyZSgncmVtb3ZlJyk7CgkJdGhpcy5fbWFwID0gbnVsbDsKCgkJaWYgKEwuQnJvd3Nlci52bWwpIHsKCQkJdGhpcy5fY29udGFpbmVyID0gbnVsbDsKCQkJdGhpcy5fc3Ryb2tlID0gbnVsbDsKCQkJdGhpcy5fZmlsbCA9IG51bGw7CgkJfQoKCQltYXAub2ZmKHsKCQkJJ3ZpZXdyZXNldCc6IHRoaXMucHJvamVjdExhdGxuZ3MsCgkJCSdtb3ZlZW5kJzogdGhpcy5fdXBkYXRlUGF0aAoJCX0sIHRoaXMpOwoJfSwKCglwcm9qZWN0TGF0bG5nczogZnVuY3Rpb24gKCkgewoJCS8vIGRvIGFsbCBwcm9qZWN0aW9uIHN0dWZmIGhlcmUKCX0sCgoJc2V0U3R5bGU6IGZ1bmN0aW9uIChzdHlsZSkgewoJCUwuc2V0T3B0aW9ucyh0aGlzLCBzdHlsZSk7CgoJCWlmICh0aGlzLl9jb250YWluZXIpIHsKCQkJdGhpcy5fdXBkYXRlU3R5bGUoKTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCglyZWRyYXc6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fbWFwKSB7CgkJCXRoaXMucHJvamVjdExhdGxuZ3MoKTsKCQkJdGhpcy5fdXBkYXRlUGF0aCgpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0KfSk7CgpMLk1hcC5pbmNsdWRlKHsKCV91cGRhdGVQYXRoVmlld3BvcnQ6IGZ1bmN0aW9uICgpIHsKCQl2YXIgcCA9IEwuUGF0aC5DTElQX1BBRERJTkcsCgkJICAgIHNpemUgPSB0aGlzLmdldFNpemUoKSwKCQkgICAgcGFuZVBvcyA9IEwuRG9tVXRpbC5nZXRQb3NpdGlvbih0aGlzLl9tYXBQYW5lKSwKCQkgICAgbWluID0gcGFuZVBvcy5tdWx0aXBseUJ5KC0xKS5fc3VidHJhY3Qoc2l6ZS5tdWx0aXBseUJ5KHApLl9yb3VuZCgpKSwKCQkgICAgbWF4ID0gbWluLmFkZChzaXplLm11bHRpcGx5QnkoMSArIHAgKiAyKS5fcm91bmQoKSk7CgoJCXRoaXMuX3BhdGhWaWV3cG9ydCA9IG5ldyBMLkJvdW5kcyhtaW4sIG1heCk7Cgl9Cn0pOwoKCi8qCiAqIEV4dGVuZHMgTC5QYXRoIHdpdGggU1ZHLXNwZWNpZmljIHJlbmRlcmluZyBjb2RlLgogKi8KCkwuUGF0aC5TVkdfTlMgPSAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnOwoKTC5Ccm93c2VyLnN2ZyA9ICEhKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyAmJiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoTC5QYXRoLlNWR19OUywgJ3N2ZycpLmNyZWF0ZVNWR1JlY3QpOwoKTC5QYXRoID0gTC5QYXRoLmV4dGVuZCh7CglzdGF0aWNzOiB7CgkJU1ZHOiBMLkJyb3dzZXIuc3ZnCgl9LAoKCWJyaW5nVG9Gcm9udDogZnVuY3Rpb24gKCkgewoJCXZhciByb290ID0gdGhpcy5fbWFwLl9wYXRoUm9vdCwKCQkgICAgcGF0aCA9IHRoaXMuX2NvbnRhaW5lcjsKCgkJaWYgKHBhdGggJiYgcm9vdC5sYXN0Q2hpbGQgIT09IHBhdGgpIHsKCQkJcm9vdC5hcHBlbmRDaGlsZChwYXRoKTsKCQl9CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWJyaW5nVG9CYWNrOiBmdW5jdGlvbiAoKSB7CgkJdmFyIHJvb3QgPSB0aGlzLl9tYXAuX3BhdGhSb290LAoJCSAgICBwYXRoID0gdGhpcy5fY29udGFpbmVyLAoJCSAgICBmaXJzdCA9IHJvb3QuZmlyc3RDaGlsZDsKCgkJaWYgKHBhdGggJiYgZmlyc3QgIT09IHBhdGgpIHsKCQkJcm9vdC5pbnNlcnRCZWZvcmUocGF0aCwgZmlyc3QpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJZ2V0UGF0aFN0cmluZzogZnVuY3Rpb24gKCkgewoJCS8vIGZvcm0gcGF0aCBzdHJpbmcgaGVyZQoJfSwKCglfY3JlYXRlRWxlbWVudDogZnVuY3Rpb24gKG5hbWUpIHsKCQlyZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKEwuUGF0aC5TVkdfTlMsIG5hbWUpOwoJfSwKCglfaW5pdEVsZW1lbnRzOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fbWFwLl9pbml0UGF0aFJvb3QoKTsKCQl0aGlzLl9pbml0UGF0aCgpOwoJCXRoaXMuX2luaXRTdHlsZSgpOwoJfSwKCglfaW5pdFBhdGg6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9jb250YWluZXIgPSB0aGlzLl9jcmVhdGVFbGVtZW50KCdnJyk7CgoJCXRoaXMuX3BhdGggPSB0aGlzLl9jcmVhdGVFbGVtZW50KCdwYXRoJyk7CgoJCWlmICh0aGlzLm9wdGlvbnMuY2xhc3NOYW1lKSB7CgkJCUwuRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl9wYXRoLCB0aGlzLm9wdGlvbnMuY2xhc3NOYW1lKTsKCQl9CgoJCXRoaXMuX2NvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9wYXRoKTsKCX0sCgoJX2luaXRTdHlsZTogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLm9wdGlvbnMuc3Ryb2tlKSB7CgkJCXRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCdzdHJva2UtbGluZWpvaW4nLCAncm91bmQnKTsKCQkJdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1saW5lY2FwJywgJ3JvdW5kJyk7CgkJfQoJCWlmICh0aGlzLm9wdGlvbnMuZmlsbCkgewoJCQl0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgnZmlsbC1ydWxlJywgJ2V2ZW5vZGQnKTsKCQl9CgkJaWYgKHRoaXMub3B0aW9ucy5wb2ludGVyRXZlbnRzKSB7CgkJCXRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCdwb2ludGVyLWV2ZW50cycsIHRoaXMub3B0aW9ucy5wb2ludGVyRXZlbnRzKTsKCQl9CgkJaWYgKCF0aGlzLm9wdGlvbnMuY2xpY2thYmxlICYmICF0aGlzLm9wdGlvbnMucG9pbnRlckV2ZW50cykgewoJCQl0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgncG9pbnRlci1ldmVudHMnLCAnbm9uZScpOwoJCX0KCQl0aGlzLl91cGRhdGVTdHlsZSgpOwoJfSwKCglfdXBkYXRlU3R5bGU6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5vcHRpb25zLnN0cm9rZSkgewoJCQl0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgdGhpcy5vcHRpb25zLmNvbG9yKTsKCQkJdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1vcGFjaXR5JywgdGhpcy5vcHRpb25zLm9wYWNpdHkpOwoJCQl0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgdGhpcy5vcHRpb25zLndlaWdodCk7CgkJCWlmICh0aGlzLm9wdGlvbnMuZGFzaEFycmF5KSB7CgkJCQl0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLWRhc2hhcnJheScsIHRoaXMub3B0aW9ucy5kYXNoQXJyYXkpOwoJCQl9IGVsc2UgewoJCQkJdGhpcy5fcGF0aC5yZW1vdmVBdHRyaWJ1dGUoJ3N0cm9rZS1kYXNoYXJyYXknKTsKCQkJfQoJCQlpZiAodGhpcy5vcHRpb25zLmxpbmVDYXApIHsKCQkJCXRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCdzdHJva2UtbGluZWNhcCcsIHRoaXMub3B0aW9ucy5saW5lQ2FwKTsKCQkJfQoJCQlpZiAodGhpcy5vcHRpb25zLmxpbmVKb2luKSB7CgkJCQl0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLWxpbmVqb2luJywgdGhpcy5vcHRpb25zLmxpbmVKb2luKTsKCQkJfQoJCX0gZWxzZSB7CgkJCXRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnbm9uZScpOwoJCX0KCQlpZiAodGhpcy5vcHRpb25zLmZpbGwpIHsKCQkJdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCB0aGlzLm9wdGlvbnMuZmlsbENvbG9yIHx8IHRoaXMub3B0aW9ucy5jb2xvcik7CgkJCXRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCdmaWxsLW9wYWNpdHknLCB0aGlzLm9wdGlvbnMuZmlsbE9wYWNpdHkpOwoJCX0gZWxzZSB7CgkJCXRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCdmaWxsJywgJ25vbmUnKTsKCQl9Cgl9LAoKCV91cGRhdGVQYXRoOiBmdW5jdGlvbiAoKSB7CgkJdmFyIHN0ciA9IHRoaXMuZ2V0UGF0aFN0cmluZygpOwoJCWlmICghc3RyKSB7CgkJCS8vIGZpeCB3ZWJraXQgZW1wdHkgc3RyaW5nIHBhcnNpbmcgYnVnCgkJCXN0ciA9ICdNMCAwJzsKCQl9CgkJdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoJ2QnLCBzdHIpOwoJfSwKCgkvLyBUT0RPIHJlbW92ZSBkdXBsaWNhdGlvbiB3aXRoIEwuTWFwCglfaW5pdEV2ZW50czogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLm9wdGlvbnMuY2xpY2thYmxlKSB7CgkJCWlmIChMLkJyb3dzZXIuc3ZnIHx8ICFMLkJyb3dzZXIudm1sKSB7CgkJCQlMLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fcGF0aCwgJ2xlYWZsZXQtY2xpY2thYmxlJyk7CgkJCX0KCgkJCUwuRG9tRXZlbnQub24odGhpcy5fY29udGFpbmVyLCAnY2xpY2snLCB0aGlzLl9vbk1vdXNlQ2xpY2ssIHRoaXMpOwoKCQkJdmFyIGV2ZW50cyA9IFsnZGJsY2xpY2snLCAnbW91c2Vkb3duJywgJ21vdXNlb3ZlcicsCgkJCSAgICAgICAgICAgICAgJ21vdXNlb3V0JywgJ21vdXNlbW92ZScsICdjb250ZXh0bWVudSddOwoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykgewoJCQkJTC5Eb21FdmVudC5vbih0aGlzLl9jb250YWluZXIsIGV2ZW50c1tpXSwgdGhpcy5fZmlyZU1vdXNlRXZlbnQsIHRoaXMpOwoJCQl9CgkJfQoJfSwKCglfb25Nb3VzZUNsaWNrOiBmdW5jdGlvbiAoZSkgewoJCWlmICh0aGlzLl9tYXAuZHJhZ2dpbmcgJiYgdGhpcy5fbWFwLmRyYWdnaW5nLm1vdmVkKCkpIHsgcmV0dXJuOyB9CgoJCXRoaXMuX2ZpcmVNb3VzZUV2ZW50KGUpOwoJfSwKCglfZmlyZU1vdXNlRXZlbnQ6IGZ1bmN0aW9uIChlKSB7CgkJaWYgKCF0aGlzLmhhc0V2ZW50TGlzdGVuZXJzKGUudHlwZSkpIHsgcmV0dXJuOyB9CgoJCXZhciBtYXAgPSB0aGlzLl9tYXAsCgkJICAgIGNvbnRhaW5lclBvaW50ID0gbWFwLm1vdXNlRXZlbnRUb0NvbnRhaW5lclBvaW50KGUpLAoJCSAgICBsYXllclBvaW50ID0gbWFwLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KGNvbnRhaW5lclBvaW50KSwKCQkgICAgbGF0bG5nID0gbWFwLmxheWVyUG9pbnRUb0xhdExuZyhsYXllclBvaW50KTsKCgkJdGhpcy5maXJlKGUudHlwZSwgewoJCQlsYXRsbmc6IGxhdGxuZywKCQkJbGF5ZXJQb2ludDogbGF5ZXJQb2ludCwKCQkJY29udGFpbmVyUG9pbnQ6IGNvbnRhaW5lclBvaW50LAoJCQlvcmlnaW5hbEV2ZW50OiBlCgkJfSk7CgoJCWlmIChlLnR5cGUgPT09ICdjb250ZXh0bWVudScpIHsKCQkJTC5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdChlKTsKCQl9CgkJaWYgKGUudHlwZSAhPT0gJ21vdXNlbW92ZScpIHsKCQkJTC5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24oZSk7CgkJfQoJfQp9KTsKCkwuTWFwLmluY2x1ZGUoewoJX2luaXRQYXRoUm9vdDogZnVuY3Rpb24gKCkgewoJCWlmICghdGhpcy5fcGF0aFJvb3QpIHsKCQkJdGhpcy5fcGF0aFJvb3QgPSBMLlBhdGgucHJvdG90eXBlLl9jcmVhdGVFbGVtZW50KCdzdmcnKTsKCQkJdGhpcy5fcGFuZXMub3ZlcmxheVBhbmUuYXBwZW5kQ2hpbGQodGhpcy5fcGF0aFJvb3QpOwoKCQkJaWYgKHRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uICYmIEwuQnJvd3Nlci5hbnkzZCkgewoJCQkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX3BhdGhSb290LCAnbGVhZmxldC16b29tLWFuaW1hdGVkJyk7CgoJCQkJdGhpcy5vbih7CgkJCQkJJ3pvb21hbmltJzogdGhpcy5fYW5pbWF0ZVBhdGhab29tLAoJCQkJCSd6b29tZW5kJzogdGhpcy5fZW5kUGF0aFpvb20KCQkJCX0pOwoJCQl9IGVsc2UgewoJCQkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX3BhdGhSb290LCAnbGVhZmxldC16b29tLWhpZGUnKTsKCQkJfQoKCQkJdGhpcy5vbignbW92ZWVuZCcsIHRoaXMuX3VwZGF0ZVN2Z1ZpZXdwb3J0KTsKCQkJdGhpcy5fdXBkYXRlU3ZnVmlld3BvcnQoKTsKCQl9Cgl9LAoKCV9hbmltYXRlUGF0aFpvb206IGZ1bmN0aW9uIChlKSB7CgkJdmFyIHNjYWxlID0gdGhpcy5nZXRab29tU2NhbGUoZS56b29tKSwKCQkgICAgb2Zmc2V0ID0gdGhpcy5fZ2V0Q2VudGVyT2Zmc2V0KGUuY2VudGVyKS5fbXVsdGlwbHlCeSgtc2NhbGUpLl9hZGQodGhpcy5fcGF0aFZpZXdwb3J0Lm1pbik7CgoJCXRoaXMuX3BhdGhSb290LnN0eWxlW0wuRG9tVXRpbC5UUkFOU0ZPUk1dID0KCQkgICAgICAgIEwuRG9tVXRpbC5nZXRUcmFuc2xhdGVTdHJpbmcob2Zmc2V0KSArICcgc2NhbGUoJyArIHNjYWxlICsgJykgJzsKCgkJdGhpcy5fcGF0aFpvb21pbmcgPSB0cnVlOwoJfSwKCglfZW5kUGF0aFpvb206IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9wYXRoWm9vbWluZyA9IGZhbHNlOwoJfSwKCglfdXBkYXRlU3ZnVmlld3BvcnQ6IGZ1bmN0aW9uICgpIHsKCgkJaWYgKHRoaXMuX3BhdGhab29taW5nKSB7CgkJCS8vIERvIG5vdCB1cGRhdGUgU1ZHcyB3aGlsZSBhIHpvb20gYW5pbWF0aW9uIGlzIGdvaW5nIG9uIG90aGVyd2lzZSB0aGUgYW5pbWF0aW9uIHdpbGwgYnJlYWsuCgkJCS8vIFdoZW4gdGhlIHpvb20gYW5pbWF0aW9uIGVuZHMgd2Ugd2lsbCBiZSB1cGRhdGVkIGFnYWluIGFueXdheQoJCQkvLyBUaGlzIGZpeGVzIHRoZSBjYXNlIHdoZXJlIHlvdSBkbyBhIG1vbWVudHVtIG1vdmUgYW5kIHpvb20gd2hpbGUgdGhlIG1vdmUgaXMgc3RpbGwgb25nb2luZy4KCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5fdXBkYXRlUGF0aFZpZXdwb3J0KCk7CgoJCXZhciB2cCA9IHRoaXMuX3BhdGhWaWV3cG9ydCwKCQkgICAgbWluID0gdnAubWluLAoJCSAgICBtYXggPSB2cC5tYXgsCgkJICAgIHdpZHRoID0gbWF4LnggLSBtaW4ueCwKCQkgICAgaGVpZ2h0ID0gbWF4LnkgLSBtaW4ueSwKCQkgICAgcm9vdCA9IHRoaXMuX3BhdGhSb290LAoJCSAgICBwYW5lID0gdGhpcy5fcGFuZXMub3ZlcmxheVBhbmU7CgoJCS8vIEhhY2sgdG8gbWFrZSBmbGlja2VyIG9uIGRyYWcgZW5kIG9uIG1vYmlsZSB3ZWJraXQgbGVzcyBpcnJpdGF0aW5nCgkJaWYgKEwuQnJvd3Nlci5tb2JpbGVXZWJraXQpIHsKCQkJcGFuZS5yZW1vdmVDaGlsZChyb290KTsKCQl9CgoJCUwuRG9tVXRpbC5zZXRQb3NpdGlvbihyb290LCBtaW4pOwoJCXJvb3Quc2V0QXR0cmlidXRlKCd3aWR0aCcsIHdpZHRoKTsKCQlyb290LnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgaGVpZ2h0KTsKCQlyb290LnNldEF0dHJpYnV0ZSgndmlld0JveCcsIFttaW4ueCwgbWluLnksIHdpZHRoLCBoZWlnaHRdLmpvaW4oJyAnKSk7CgoJCWlmIChMLkJyb3dzZXIubW9iaWxlV2Via2l0KSB7CgkJCXBhbmUuYXBwZW5kQ2hpbGQocm9vdCk7CgkJfQoJfQp9KTsKCgovKgogKiBQb3B1cCBleHRlbnNpb24gdG8gTC5QYXRoIChwb2x5bGluZXMsIHBvbHlnb25zLCBjaXJjbGVzKSwgYWRkaW5nIHBvcHVwLXJlbGF0ZWQgbWV0aG9kcy4KICovCgpMLlBhdGguaW5jbHVkZSh7CgoJYmluZFBvcHVwOiBmdW5jdGlvbiAoY29udGVudCwgb3B0aW9ucykgewoKCQlpZiAoY29udGVudCBpbnN0YW5jZW9mIEwuUG9wdXApIHsKCQkJdGhpcy5fcG9wdXAgPSBjb250ZW50OwoJCX0gZWxzZSB7CgkJCWlmICghdGhpcy5fcG9wdXAgfHwgb3B0aW9ucykgewoJCQkJdGhpcy5fcG9wdXAgPSBuZXcgTC5Qb3B1cChvcHRpb25zLCB0aGlzKTsKCQkJfQoJCQl0aGlzLl9wb3B1cC5zZXRDb250ZW50KGNvbnRlbnQpOwoJCX0KCgkJaWYgKCF0aGlzLl9wb3B1cEhhbmRsZXJzQWRkZWQpIHsKCQkJdGhpcwoJCQkgICAgLm9uKCdjbGljaycsIHRoaXMuX29wZW5Qb3B1cCwgdGhpcykKCQkJICAgIC5vbigncmVtb3ZlJywgdGhpcy5jbG9zZVBvcHVwLCB0aGlzKTsKCgkJCXRoaXMuX3BvcHVwSGFuZGxlcnNBZGRlZCA9IHRydWU7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJdW5iaW5kUG9wdXA6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fcG9wdXApIHsKCQkJdGhpcy5fcG9wdXAgPSBudWxsOwoJCQl0aGlzCgkJCSAgICAub2ZmKCdjbGljaycsIHRoaXMuX29wZW5Qb3B1cCkKCQkJICAgIC5vZmYoJ3JlbW92ZScsIHRoaXMuY2xvc2VQb3B1cCk7CgoJCQl0aGlzLl9wb3B1cEhhbmRsZXJzQWRkZWQgPSBmYWxzZTsKCQl9CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCW9wZW5Qb3B1cDogZnVuY3Rpb24gKGxhdGxuZykgewoKCQlpZiAodGhpcy5fcG9wdXApIHsKCQkJLy8gb3BlbiB0aGUgcG9wdXAgZnJvbSBvbmUgb2YgdGhlIHBhdGgncyBwb2ludHMgaWYgbm90IHNwZWNpZmllZAoJCQlsYXRsbmcgPSBsYXRsbmcgfHwgdGhpcy5fbGF0bG5nIHx8CgkJCSAgICAgICAgIHRoaXMuX2xhdGxuZ3NbTWF0aC5mbG9vcih0aGlzLl9sYXRsbmdzLmxlbmd0aCAvIDIpXTsKCgkJCXRoaXMuX29wZW5Qb3B1cCh7bGF0bG5nOiBsYXRsbmd9KTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCgljbG9zZVBvcHVwOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX3BvcHVwKSB7CgkJCXRoaXMuX3BvcHVwLl9jbG9zZSgpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJX29wZW5Qb3B1cDogZnVuY3Rpb24gKGUpIHsKCQl0aGlzLl9wb3B1cC5zZXRMYXRMbmcoZS5sYXRsbmcpOwoJCXRoaXMuX21hcC5vcGVuUG9wdXAodGhpcy5fcG9wdXApOwoJfQp9KTsKCgovKgogKiBWZWN0b3IgcmVuZGVyaW5nIGZvciBJRTYtOCB0aHJvdWdoIFZNTC4KICogVGhhbmtzIHRvIERtaXRyeSBCYXJhbm92c2t5IGFuZCBoaXMgUmFwaGFlbCBsaWJyYXJ5IGZvciBpbnNwaXJhdGlvbiEKICovCgpMLkJyb3dzZXIudm1sID0gIUwuQnJvd3Nlci5zdmcgJiYgKGZ1bmN0aW9uICgpIHsKCXRyeSB7CgkJdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCWRpdi5pbm5lckhUTUwgPSAnPHY6c2hhcGUgYWRqPSIxIi8+JzsKCgkJdmFyIHNoYXBlID0gZGl2LmZpcnN0Q2hpbGQ7CgkJc2hhcGUuc3R5bGUuYmVoYXZpb3IgPSAndXJsKCNkZWZhdWx0I1ZNTCknOwoKCQlyZXR1cm4gc2hhcGUgJiYgKHR5cGVvZiBzaGFwZS5hZGogPT09ICdvYmplY3QnKTsKCgl9IGNhdGNoIChlKSB7CgkJcmV0dXJuIGZhbHNlOwoJfQp9KCkpOwoKTC5QYXRoID0gTC5Ccm93c2VyLnN2ZyB8fCAhTC5Ccm93c2VyLnZtbCA/IEwuUGF0aCA6IEwuUGF0aC5leHRlbmQoewoJc3RhdGljczogewoJCVZNTDogdHJ1ZSwKCQlDTElQX1BBRERJTkc6IDAuMDIKCX0sCgoJX2NyZWF0ZUVsZW1lbnQ6IChmdW5jdGlvbiAoKSB7CgkJdHJ5IHsKCQkJZG9jdW1lbnQubmFtZXNwYWNlcy5hZGQoJ2x2bWwnLCAndXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTp2bWwnKTsKCQkJcmV0dXJuIGZ1bmN0aW9uIChuYW1lKSB7CgkJCQlyZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnPGx2bWw6JyArIG5hbWUgKyAnIGNsYXNzPSJsdm1sIj4nKTsKCQkJfTsKCQl9IGNhdGNoIChlKSB7CgkJCXJldHVybiBmdW5jdGlvbiAobmFtZSkgewoJCQkJcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoCgkJCQkgICAgICAgICc8JyArIG5hbWUgKyAnIHhtbG5zPSJ1cm46c2NoZW1hcy1taWNyb3NvZnQuY29tOnZtbCIgY2xhc3M9Imx2bWwiPicpOwoJCQl9OwoJCX0KCX0oKSksCgoJX2luaXRQYXRoOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGNvbnRhaW5lciA9IHRoaXMuX2NvbnRhaW5lciA9IHRoaXMuX2NyZWF0ZUVsZW1lbnQoJ3NoYXBlJyk7CgoJCUwuRG9tVXRpbC5hZGRDbGFzcyhjb250YWluZXIsICdsZWFmbGV0LXZtbC1zaGFwZScgKwoJCQkodGhpcy5vcHRpb25zLmNsYXNzTmFtZSA/ICcgJyArIHRoaXMub3B0aW9ucy5jbGFzc05hbWUgOiAnJykpOwoKCQlpZiAodGhpcy5vcHRpb25zLmNsaWNrYWJsZSkgewoJCQlMLkRvbVV0aWwuYWRkQ2xhc3MoY29udGFpbmVyLCAnbGVhZmxldC1jbGlja2FibGUnKTsKCQl9CgoJCWNvbnRhaW5lci5jb29yZHNpemUgPSAnMSAxJzsKCgkJdGhpcy5fcGF0aCA9IHRoaXMuX2NyZWF0ZUVsZW1lbnQoJ3BhdGgnKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5fcGF0aCk7CgoJCXRoaXMuX21hcC5fcGF0aFJvb3QuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTsKCX0sCgoJX2luaXRTdHlsZTogZnVuY3Rpb24gKCkgewoJCXRoaXMuX3VwZGF0ZVN0eWxlKCk7Cgl9LAoKCV91cGRhdGVTdHlsZTogZnVuY3Rpb24gKCkgewoJCXZhciBzdHJva2UgPSB0aGlzLl9zdHJva2UsCgkJICAgIGZpbGwgPSB0aGlzLl9maWxsLAoJCSAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLAoJCSAgICBjb250YWluZXIgPSB0aGlzLl9jb250YWluZXI7CgoJCWNvbnRhaW5lci5zdHJva2VkID0gb3B0aW9ucy5zdHJva2U7CgkJY29udGFpbmVyLmZpbGxlZCA9IG9wdGlvbnMuZmlsbDsKCgkJaWYgKG9wdGlvbnMuc3Ryb2tlKSB7CgkJCWlmICghc3Ryb2tlKSB7CgkJCQlzdHJva2UgPSB0aGlzLl9zdHJva2UgPSB0aGlzLl9jcmVhdGVFbGVtZW50KCdzdHJva2UnKTsKCQkJCXN0cm9rZS5lbmRjYXAgPSAncm91bmQnOwoJCQkJY29udGFpbmVyLmFwcGVuZENoaWxkKHN0cm9rZSk7CgkJCX0KCQkJc3Ryb2tlLndlaWdodCA9IG9wdGlvbnMud2VpZ2h0ICsgJ3B4JzsKCQkJc3Ryb2tlLmNvbG9yID0gb3B0aW9ucy5jb2xvcjsKCQkJc3Ryb2tlLm9wYWNpdHkgPSBvcHRpb25zLm9wYWNpdHk7CgoJCQlpZiAob3B0aW9ucy5kYXNoQXJyYXkpIHsKCQkJCXN0cm9rZS5kYXNoU3R5bGUgPSBMLlV0aWwuaXNBcnJheShvcHRpb25zLmRhc2hBcnJheSkgPwoJCQkJICAgIG9wdGlvbnMuZGFzaEFycmF5LmpvaW4oJyAnKSA6CgkJCQkgICAgb3B0aW9ucy5kYXNoQXJyYXkucmVwbGFjZSgvKCAqLCAqKS9nLCAnICcpOwoJCQl9IGVsc2UgewoJCQkJc3Ryb2tlLmRhc2hTdHlsZSA9ICcnOwoJCQl9CgkJCWlmIChvcHRpb25zLmxpbmVDYXApIHsKCQkJCXN0cm9rZS5lbmRjYXAgPSBvcHRpb25zLmxpbmVDYXAucmVwbGFjZSgnYnV0dCcsICdmbGF0Jyk7CgkJCX0KCQkJaWYgKG9wdGlvbnMubGluZUpvaW4pIHsKCQkJCXN0cm9rZS5qb2luc3R5bGUgPSBvcHRpb25zLmxpbmVKb2luOwoJCQl9CgoJCX0gZWxzZSBpZiAoc3Ryb2tlKSB7CgkJCWNvbnRhaW5lci5yZW1vdmVDaGlsZChzdHJva2UpOwoJCQl0aGlzLl9zdHJva2UgPSBudWxsOwoJCX0KCgkJaWYgKG9wdGlvbnMuZmlsbCkgewoJCQlpZiAoIWZpbGwpIHsKCQkJCWZpbGwgPSB0aGlzLl9maWxsID0gdGhpcy5fY3JlYXRlRWxlbWVudCgnZmlsbCcpOwoJCQkJY29udGFpbmVyLmFwcGVuZENoaWxkKGZpbGwpOwoJCQl9CgkJCWZpbGwuY29sb3IgPSBvcHRpb25zLmZpbGxDb2xvciB8fCBvcHRpb25zLmNvbG9yOwoJCQlmaWxsLm9wYWNpdHkgPSBvcHRpb25zLmZpbGxPcGFjaXR5OwoKCQl9IGVsc2UgaWYgKGZpbGwpIHsKCQkJY29udGFpbmVyLnJlbW92ZUNoaWxkKGZpbGwpOwoJCQl0aGlzLl9maWxsID0gbnVsbDsKCQl9Cgl9LAoKCV91cGRhdGVQYXRoOiBmdW5jdGlvbiAoKSB7CgkJdmFyIHN0eWxlID0gdGhpcy5fY29udGFpbmVyLnN0eWxlOwoKCQlzdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoJCXRoaXMuX3BhdGgudiA9IHRoaXMuZ2V0UGF0aFN0cmluZygpICsgJyAnOyAvLyB0aGUgc3BhY2UgZml4ZXMgSUUgZW1wdHkgcGF0aCBzdHJpbmcgYnVnCgkJc3R5bGUuZGlzcGxheSA9ICcnOwoJfQp9KTsKCkwuTWFwLmluY2x1ZGUoTC5Ccm93c2VyLnN2ZyB8fCAhTC5Ccm93c2VyLnZtbCA/IHt9IDogewoJX2luaXRQYXRoUm9vdDogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9wYXRoUm9vdCkgeyByZXR1cm47IH0KCgkJdmFyIHJvb3QgPSB0aGlzLl9wYXRoUm9vdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCXJvb3QuY2xhc3NOYW1lID0gJ2xlYWZsZXQtdm1sLWNvbnRhaW5lcic7CgkJdGhpcy5fcGFuZXMub3ZlcmxheVBhbmUuYXBwZW5kQ2hpbGQocm9vdCk7CgoJCXRoaXMub24oJ21vdmVlbmQnLCB0aGlzLl91cGRhdGVQYXRoVmlld3BvcnQpOwoJCXRoaXMuX3VwZGF0ZVBhdGhWaWV3cG9ydCgpOwoJfQp9KTsKCgovKgogKiBWZWN0b3IgcmVuZGVyaW5nIGZvciBhbGwgYnJvd3NlcnMgdGhhdCBzdXBwb3J0IGNhbnZhcy4KICovCgpMLkJyb3dzZXIuY2FudmFzID0gKGZ1bmN0aW9uICgpIHsKCXJldHVybiAhIWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLmdldENvbnRleHQ7Cn0oKSk7CgpMLlBhdGggPSAoTC5QYXRoLlNWRyAmJiAhd2luZG93LkxfUFJFRkVSX0NBTlZBUykgfHwgIUwuQnJvd3Nlci5jYW52YXMgPyBMLlBhdGggOiBMLlBhdGguZXh0ZW5kKHsKCXN0YXRpY3M6IHsKCQkvL0NMSVBfUEFERElORzogMC4wMiwgLy8gbm90IHN1cmUgaWYgdGhlcmUncyBhIG5lZWQgdG8gc2V0IGl0IHRvIGEgc21hbGwgdmFsdWUKCQlDQU5WQVM6IHRydWUsCgkJU1ZHOiBmYWxzZQoJfSwKCglyZWRyYXc6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fbWFwKSB7CgkJCXRoaXMucHJvamVjdExhdGxuZ3MoKTsKCQkJdGhpcy5fcmVxdWVzdFVwZGF0ZSgpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJc2V0U3R5bGU6IGZ1bmN0aW9uIChzdHlsZSkgewoJCUwuc2V0T3B0aW9ucyh0aGlzLCBzdHlsZSk7CgoJCWlmICh0aGlzLl9tYXApIHsKCQkJdGhpcy5fdXBkYXRlU3R5bGUoKTsKCQkJdGhpcy5fcmVxdWVzdFVwZGF0ZSgpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJb25BZGQ6IGZ1bmN0aW9uIChtYXApIHsKCQl0aGlzLl9tYXAgPSBtYXA7CgoJCWlmICghdGhpcy5fY29udGFpbmVyKSB7CgkJCXRoaXMuX2luaXRFbGVtZW50cygpOwoJCQl0aGlzLl9pbml0RXZlbnRzKCk7CgkJfQoKCQl0aGlzLnByb2plY3RMYXRsbmdzKCk7CgkJdGhpcy5fdXBkYXRlUGF0aCgpOwoKCQlpZiAodGhpcy5fY29udGFpbmVyKSB7CgkJCXRoaXMuX21hcC5fcGF0aFJvb3QuYXBwZW5kQ2hpbGQodGhpcy5fY29udGFpbmVyKTsKCQl9CgoJCXRoaXMuZmlyZSgnYWRkJyk7CgoJCW1hcC5vbih7CgkJCSd2aWV3cmVzZXQnOiB0aGlzLnByb2plY3RMYXRsbmdzLAoJCQknbW92ZWVuZCc6IHRoaXMuX3VwZGF0ZVBhdGgsCgkJCSdjYW52YXNyZWRyYXcnOiB0aGlzLl91cGRhdGVQYXRoCgkJfSwgdGhpcyk7Cgl9LAoKCW9uUmVtb3ZlOiBmdW5jdGlvbiAobWFwKSB7CgkJbWFwCgkJICAgIC5vZmYoJ3ZpZXdyZXNldCcsIHRoaXMucHJvamVjdExhdGxuZ3MsIHRoaXMpCgkJICAgIC5vZmYoJ21vdmVlbmQnLCB0aGlzLl91cGRhdGVQYXRoLCB0aGlzKQoJCSAgICAub2ZmKCdjYW52YXNyZWRyYXcnLCB0aGlzLl91cGRhdGVQYXRoLCB0aGlzKTsKCgkJaWYgKHRoaXMub3B0aW9ucy5jbGlja2FibGUpIHsKCQkJdGhpcy5fbWFwLm9mZignY2xpY2snLCB0aGlzLl9vbkNsaWNrLCB0aGlzKTsKCQkJdGhpcy5fbWFwLm9mZignbW91c2Vtb3ZlJywgdGhpcy5fb25Nb3VzZU1vdmUsIHRoaXMpOwoJCX0KCgkJdGhpcy5fcmVxdWVzdFVwZGF0ZSgpOwoJCQoJCXRoaXMuZmlyZSgncmVtb3ZlJyk7CgkJdGhpcy5fbWFwID0gbnVsbDsKCX0sCgoJX3JlcXVlc3RVcGRhdGU6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fbWFwICYmICFMLlBhdGguX3VwZGF0ZVJlcXVlc3QpIHsKCQkJTC5QYXRoLl91cGRhdGVSZXF1ZXN0ID0gTC5VdGlsLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fZmlyZUNhbnZhc1JlZHJhdywgdGhpcy5fbWFwKTsKCQl9Cgl9LAoKCV9maXJlQ2FudmFzUmVkcmF3OiBmdW5jdGlvbiAoKSB7CgkJTC5QYXRoLl91cGRhdGVSZXF1ZXN0ID0gbnVsbDsKCQl0aGlzLmZpcmUoJ2NhbnZhc3JlZHJhdycpOwoJfSwKCglfaW5pdEVsZW1lbnRzOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fbWFwLl9pbml0UGF0aFJvb3QoKTsKCQl0aGlzLl9jdHggPSB0aGlzLl9tYXAuX2NhbnZhc0N0eDsKCX0sCgoJX3VwZGF0ZVN0eWxlOiBmdW5jdGlvbiAoKSB7CgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgoJCWlmIChvcHRpb25zLnN0cm9rZSkgewoJCQl0aGlzLl9jdHgubGluZVdpZHRoID0gb3B0aW9ucy53ZWlnaHQ7CgkJCXRoaXMuX2N0eC5zdHJva2VTdHlsZSA9IG9wdGlvbnMuY29sb3I7CgkJfQoJCWlmIChvcHRpb25zLmZpbGwpIHsKCQkJdGhpcy5fY3R4LmZpbGxTdHlsZSA9IG9wdGlvbnMuZmlsbENvbG9yIHx8IG9wdGlvbnMuY29sb3I7CgkJfQoJfSwKCglfZHJhd1BhdGg6IGZ1bmN0aW9uICgpIHsKCQl2YXIgaSwgaiwgbGVuLCBsZW4yLCBwb2ludCwgZHJhd01ldGhvZDsKCgkJdGhpcy5fY3R4LmJlZ2luUGF0aCgpOwoKCQlmb3IgKGkgPSAwLCBsZW4gPSB0aGlzLl9wYXJ0cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQlmb3IgKGogPSAwLCBsZW4yID0gdGhpcy5fcGFydHNbaV0ubGVuZ3RoOyBqIDwgbGVuMjsgaisrKSB7CgkJCQlwb2ludCA9IHRoaXMuX3BhcnRzW2ldW2pdOwoJCQkJZHJhd01ldGhvZCA9IChqID09PSAwID8gJ21vdmUnIDogJ2xpbmUnKSArICdUbyc7CgoJCQkJdGhpcy5fY3R4W2RyYXdNZXRob2RdKHBvaW50LngsIHBvaW50LnkpOwoJCQl9CgkJCS8vIFRPRE8gcmVmYWN0b3IgdWdseSBoYWNrCgkJCWlmICh0aGlzIGluc3RhbmNlb2YgTC5Qb2x5Z29uKSB7CgkJCQl0aGlzLl9jdHguY2xvc2VQYXRoKCk7CgkJCX0KCQl9Cgl9LAoKCV9jaGVja0lmRW1wdHk6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gIXRoaXMuX3BhcnRzLmxlbmd0aDsKCX0sCgoJX3VwZGF0ZVBhdGg6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fY2hlY2tJZkVtcHR5KCkpIHsgcmV0dXJuOyB9CgoJCXZhciBjdHggPSB0aGlzLl9jdHgsCgkJICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgoJCXRoaXMuX2RyYXdQYXRoKCk7CgkJY3R4LnNhdmUoKTsKCQl0aGlzLl91cGRhdGVTdHlsZSgpOwoKCQlpZiAob3B0aW9ucy5maWxsKSB7CgkJCWN0eC5nbG9iYWxBbHBoYSA9IG9wdGlvbnMuZmlsbE9wYWNpdHk7CgkJCWN0eC5maWxsKCk7CgkJfQoKCQlpZiAob3B0aW9ucy5zdHJva2UpIHsKCQkJY3R4Lmdsb2JhbEFscGhhID0gb3B0aW9ucy5vcGFjaXR5OwoJCQljdHguc3Ryb2tlKCk7CgkJfQoKCQljdHgucmVzdG9yZSgpOwoKCQkvLyBUT0RPIG9wdGltaXphdGlvbjogMSBmaWxsL3N0cm9rZSBmb3IgYWxsIGZlYXR1cmVzIHdpdGggZXF1YWwgc3R5bGUgaW5zdGVhZCBvZiAxIGZvciBlYWNoIGZlYXR1cmUKCX0sCgoJX2luaXRFdmVudHM6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5vcHRpb25zLmNsaWNrYWJsZSkgewoJCQkvLyBUT0RPIGRibGNsaWNrCgkJCXRoaXMuX21hcC5vbignbW91c2Vtb3ZlJywgdGhpcy5fb25Nb3VzZU1vdmUsIHRoaXMpOwoJCQl0aGlzLl9tYXAub24oJ2NsaWNrJywgdGhpcy5fb25DbGljaywgdGhpcyk7CgkJfQoJfSwKCglfb25DbGljazogZnVuY3Rpb24gKGUpIHsKCQlpZiAodGhpcy5fY29udGFpbnNQb2ludChlLmxheWVyUG9pbnQpKSB7CgkJCXRoaXMuZmlyZSgnY2xpY2snLCBlKTsKCQl9Cgl9LAoKCV9vbk1vdXNlTW92ZTogZnVuY3Rpb24gKGUpIHsKCQlpZiAoIXRoaXMuX21hcCB8fCB0aGlzLl9tYXAuX2FuaW1hdGluZ1pvb20pIHsgcmV0dXJuOyB9CgoJCS8vIFRPRE8gZG9uJ3QgZG8gb24gZWFjaCBtb3ZlCgkJaWYgKHRoaXMuX2NvbnRhaW5zUG9pbnQoZS5sYXllclBvaW50KSkgewoJCQl0aGlzLl9jdHguY2FudmFzLnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJzsKCQkJdGhpcy5fbW91c2VJbnNpZGUgPSB0cnVlOwoJCQl0aGlzLmZpcmUoJ21vdXNlb3ZlcicsIGUpOwoKCQl9IGVsc2UgaWYgKHRoaXMuX21vdXNlSW5zaWRlKSB7CgkJCXRoaXMuX2N0eC5jYW52YXMuc3R5bGUuY3Vyc29yID0gJyc7CgkJCXRoaXMuX21vdXNlSW5zaWRlID0gZmFsc2U7CgkJCXRoaXMuZmlyZSgnbW91c2VvdXQnLCBlKTsKCQl9Cgl9Cn0pOwoKTC5NYXAuaW5jbHVkZSgoTC5QYXRoLlNWRyAmJiAhd2luZG93LkxfUFJFRkVSX0NBTlZBUykgfHwgIUwuQnJvd3Nlci5jYW52YXMgPyB7fSA6IHsKCV9pbml0UGF0aFJvb3Q6IGZ1bmN0aW9uICgpIHsKCQl2YXIgcm9vdCA9IHRoaXMuX3BhdGhSb290LAoJCSAgICBjdHg7CgoJCWlmICghcm9vdCkgewoJCQlyb290ID0gdGhpcy5fcGF0aFJvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKCQkJcm9vdC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CgkJCWN0eCA9IHRoaXMuX2NhbnZhc0N0eCA9IHJvb3QuZ2V0Q29udGV4dCgnMmQnKTsKCgkJCWN0eC5saW5lQ2FwID0gJ3JvdW5kJzsKCQkJY3R4LmxpbmVKb2luID0gJ3JvdW5kJzsKCgkJCXRoaXMuX3BhbmVzLm92ZXJsYXlQYW5lLmFwcGVuZENoaWxkKHJvb3QpOwoKCQkJaWYgKHRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uKSB7CgkJCQl0aGlzLl9wYXRoUm9vdC5jbGFzc05hbWUgPSAnbGVhZmxldC16b29tLWFuaW1hdGVkJzsKCQkJCXRoaXMub24oJ3pvb21hbmltJywgdGhpcy5fYW5pbWF0ZVBhdGhab29tKTsKCQkJCXRoaXMub24oJ3pvb21lbmQnLCB0aGlzLl9lbmRQYXRoWm9vbSk7CgkJCX0KCQkJdGhpcy5vbignbW92ZWVuZCcsIHRoaXMuX3VwZGF0ZUNhbnZhc1ZpZXdwb3J0KTsKCQkJdGhpcy5vbignY2FudmFzcmVkcmF3JywgdGhpcy5fdXBkYXRlQ2FudmFzVmlld3BvcnQpOwoJCQl0aGlzLl91cGRhdGVDYW52YXNWaWV3cG9ydCgpOwoJCX0KCX0sCgoJX3VwZGF0ZUNhbnZhc1ZpZXdwb3J0OiBmdW5jdGlvbiAoKSB7CgkJLy8gZG9uJ3QgcmVkcmF3IHdoaWxlIHpvb21pbmcuIFNlZSBfdXBkYXRlU3ZnVmlld3BvcnQgZm9yIG1vcmUgZGV0YWlscwoJCWlmICh0aGlzLl9wYXRoWm9vbWluZykgeyByZXR1cm47IH0KCQl0aGlzLl91cGRhdGVQYXRoVmlld3BvcnQoKTsKCgkJdmFyIHZwID0gdGhpcy5fcGF0aFZpZXdwb3J0LAoJCSAgICBtaW4gPSB2cC5taW4sCgkJICAgIHNpemUgPSB2cC5tYXguc3VidHJhY3QobWluKSwKCQkgICAgcm9vdCA9IHRoaXMuX3BhdGhSb290OwoKCQkvL1RPRE8gY2hlY2sgaWYgdGhpcyB3b3JrcyBwcm9wZXJseSBvbiBtb2JpbGUgd2Via2l0CgkJTC5Eb21VdGlsLnNldFBvc2l0aW9uKHJvb3QsIG1pbik7CgkJcm9vdC53aWR0aCA9IHNpemUueDsKCQlyb290LmhlaWdodCA9IHNpemUueTsKCQlyb290LmdldENvbnRleHQoJzJkJykudHJhbnNsYXRlKC1taW4ueCwgLW1pbi55KTsKCX0KfSk7CgoKLyoKICogTC5MaW5lVXRpbCBjb250YWlucyBkaWZmZXJlbnQgdXRpbGl0eSBmdW5jdGlvbnMgZm9yIGxpbmUgc2VnbWVudHMKICogYW5kIHBvbHlsaW5lcyAoY2xpcHBpbmcsIHNpbXBsaWZpY2F0aW9uLCBkaXN0YW5jZXMsIGV0Yy4pCiAqLwoKLypqc2hpbnQgYml0d2lzZTpmYWxzZSAqLyAvLyBhbGxvdyBiaXR3aXNlIG9wZXJhdGlvbnMgZm9yIHRoaXMgZmlsZQoKTC5MaW5lVXRpbCA9IHsKCgkvLyBTaW1wbGlmeSBwb2x5bGluZSB3aXRoIHZlcnRleCByZWR1Y3Rpb24gYW5kIERvdWdsYXMtUGV1Y2tlciBzaW1wbGlmaWNhdGlvbi4KCS8vIEltcHJvdmVzIHJlbmRlcmluZyBwZXJmb3JtYW5jZSBkcmFtYXRpY2FsbHkgYnkgbGVzc2VuaW5nIHRoZSBudW1iZXIgb2YgcG9pbnRzIHRvIGRyYXcuCgoJc2ltcGxpZnk6IGZ1bmN0aW9uICgvKlBvaW50W10qLyBwb2ludHMsIC8qTnVtYmVyKi8gdG9sZXJhbmNlKSB7CgkJaWYgKCF0b2xlcmFuY2UgfHwgIXBvaW50cy5sZW5ndGgpIHsKCQkJcmV0dXJuIHBvaW50cy5zbGljZSgpOwoJCX0KCgkJdmFyIHNxVG9sZXJhbmNlID0gdG9sZXJhbmNlICogdG9sZXJhbmNlOwoKCQkvLyBzdGFnZSAxOiB2ZXJ0ZXggcmVkdWN0aW9uCgkJcG9pbnRzID0gdGhpcy5fcmVkdWNlUG9pbnRzKHBvaW50cywgc3FUb2xlcmFuY2UpOwoKCQkvLyBzdGFnZSAyOiBEb3VnbGFzLVBldWNrZXIgc2ltcGxpZmljYXRpb24KCQlwb2ludHMgPSB0aGlzLl9zaW1wbGlmeURQKHBvaW50cywgc3FUb2xlcmFuY2UpOwoKCQlyZXR1cm4gcG9pbnRzOwoJfSwKCgkvLyBkaXN0YW5jZSBmcm9tIGEgcG9pbnQgdG8gYSBzZWdtZW50IGJldHdlZW4gdHdvIHBvaW50cwoJcG9pbnRUb1NlZ21lbnREaXN0YW5jZTogIGZ1bmN0aW9uICgvKlBvaW50Ki8gcCwgLypQb2ludCovIHAxLCAvKlBvaW50Ki8gcDIpIHsKCQlyZXR1cm4gTWF0aC5zcXJ0KHRoaXMuX3NxQ2xvc2VzdFBvaW50T25TZWdtZW50KHAsIHAxLCBwMiwgdHJ1ZSkpOwoJfSwKCgljbG9zZXN0UG9pbnRPblNlZ21lbnQ6IGZ1bmN0aW9uICgvKlBvaW50Ki8gcCwgLypQb2ludCovIHAxLCAvKlBvaW50Ki8gcDIpIHsKCQlyZXR1cm4gdGhpcy5fc3FDbG9zZXN0UG9pbnRPblNlZ21lbnQocCwgcDEsIHAyKTsKCX0sCgoJLy8gRG91Z2xhcy1QZXVja2VyIHNpbXBsaWZpY2F0aW9uLCBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Eb3VnbGFzLVBldWNrZXJfYWxnb3JpdGhtCglfc2ltcGxpZnlEUDogZnVuY3Rpb24gKHBvaW50cywgc3FUb2xlcmFuY2UpIHsKCgkJdmFyIGxlbiA9IHBvaW50cy5sZW5ndGgsCgkJICAgIEFycmF5Q29uc3RydWN0b3IgPSB0eXBlb2YgVWludDhBcnJheSAhPT0gdW5kZWZpbmVkICsgJycgPyBVaW50OEFycmF5IDogQXJyYXksCgkJICAgIG1hcmtlcnMgPSBuZXcgQXJyYXlDb25zdHJ1Y3RvcihsZW4pOwoKCQltYXJrZXJzWzBdID0gbWFya2Vyc1tsZW4gLSAxXSA9IDE7CgoJCXRoaXMuX3NpbXBsaWZ5RFBTdGVwKHBvaW50cywgbWFya2Vycywgc3FUb2xlcmFuY2UsIDAsIGxlbiAtIDEpOwoKCQl2YXIgaSwKCQkgICAgbmV3UG9pbnRzID0gW107CgoJCWZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgewoJCQlpZiAobWFya2Vyc1tpXSkgewoJCQkJbmV3UG9pbnRzLnB1c2gocG9pbnRzW2ldKTsKCQkJfQoJCX0KCgkJcmV0dXJuIG5ld1BvaW50czsKCX0sCgoJX3NpbXBsaWZ5RFBTdGVwOiBmdW5jdGlvbiAocG9pbnRzLCBtYXJrZXJzLCBzcVRvbGVyYW5jZSwgZmlyc3QsIGxhc3QpIHsKCgkJdmFyIG1heFNxRGlzdCA9IDAsCgkJICAgIGluZGV4LCBpLCBzcURpc3Q7CgoJCWZvciAoaSA9IGZpcnN0ICsgMTsgaSA8PSBsYXN0IC0gMTsgaSsrKSB7CgkJCXNxRGlzdCA9IHRoaXMuX3NxQ2xvc2VzdFBvaW50T25TZWdtZW50KHBvaW50c1tpXSwgcG9pbnRzW2ZpcnN0XSwgcG9pbnRzW2xhc3RdLCB0cnVlKTsKCgkJCWlmIChzcURpc3QgPiBtYXhTcURpc3QpIHsKCQkJCWluZGV4ID0gaTsKCQkJCW1heFNxRGlzdCA9IHNxRGlzdDsKCQkJfQoJCX0KCgkJaWYgKG1heFNxRGlzdCA+IHNxVG9sZXJhbmNlKSB7CgkJCW1hcmtlcnNbaW5kZXhdID0gMTsKCgkJCXRoaXMuX3NpbXBsaWZ5RFBTdGVwKHBvaW50cywgbWFya2Vycywgc3FUb2xlcmFuY2UsIGZpcnN0LCBpbmRleCk7CgkJCXRoaXMuX3NpbXBsaWZ5RFBTdGVwKHBvaW50cywgbWFya2Vycywgc3FUb2xlcmFuY2UsIGluZGV4LCBsYXN0KTsKCQl9Cgl9LAoKCS8vIHJlZHVjZSBwb2ludHMgdGhhdCBhcmUgdG9vIGNsb3NlIHRvIGVhY2ggb3RoZXIgdG8gYSBzaW5nbGUgcG9pbnQKCV9yZWR1Y2VQb2ludHM6IGZ1bmN0aW9uIChwb2ludHMsIHNxVG9sZXJhbmNlKSB7CgkJdmFyIHJlZHVjZWRQb2ludHMgPSBbcG9pbnRzWzBdXTsKCgkJZm9yICh2YXIgaSA9IDEsIHByZXYgPSAwLCBsZW4gPSBwb2ludHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJaWYgKHRoaXMuX3NxRGlzdChwb2ludHNbaV0sIHBvaW50c1twcmV2XSkgPiBzcVRvbGVyYW5jZSkgewoJCQkJcmVkdWNlZFBvaW50cy5wdXNoKHBvaW50c1tpXSk7CgkJCQlwcmV2ID0gaTsKCQkJfQoJCX0KCQlpZiAocHJldiA8IGxlbiAtIDEpIHsKCQkJcmVkdWNlZFBvaW50cy5wdXNoKHBvaW50c1tsZW4gLSAxXSk7CgkJfQoJCXJldHVybiByZWR1Y2VkUG9pbnRzOwoJfSwKCgkvLyBDb2hlbi1TdXRoZXJsYW5kIGxpbmUgY2xpcHBpbmcgYWxnb3JpdGhtLgoJLy8gVXNlZCB0byBhdm9pZCByZW5kZXJpbmcgcGFydHMgb2YgYSBwb2x5bGluZSB0aGF0IGFyZSBub3QgY3VycmVudGx5IHZpc2libGUuCgoJY2xpcFNlZ21lbnQ6IGZ1bmN0aW9uIChhLCBiLCBib3VuZHMsIHVzZUxhc3RDb2RlKSB7CgkJdmFyIGNvZGVBID0gdXNlTGFzdENvZGUgPyB0aGlzLl9sYXN0Q29kZSA6IHRoaXMuX2dldEJpdENvZGUoYSwgYm91bmRzKSwKCQkgICAgY29kZUIgPSB0aGlzLl9nZXRCaXRDb2RlKGIsIGJvdW5kcyksCgoJCSAgICBjb2RlT3V0LCBwLCBuZXdDb2RlOwoKCQkvLyBzYXZlIDJuZCBjb2RlIHRvIGF2b2lkIGNhbGN1bGF0aW5nIGl0IG9uIHRoZSBuZXh0IHNlZ21lbnQKCQl0aGlzLl9sYXN0Q29kZSA9IGNvZGVCOwoKCQl3aGlsZSAodHJ1ZSkgewoJCQkvLyBpZiBhLGIgaXMgaW5zaWRlIHRoZSBjbGlwIHdpbmRvdyAodHJpdmlhbCBhY2NlcHQpCgkJCWlmICghKGNvZGVBIHwgY29kZUIpKSB7CgkJCQlyZXR1cm4gW2EsIGJdOwoJCQkvLyBpZiBhLGIgaXMgb3V0c2lkZSB0aGUgY2xpcCB3aW5kb3cgKHRyaXZpYWwgcmVqZWN0KQoJCQl9IGVsc2UgaWYgKGNvZGVBICYgY29kZUIpIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJLy8gb3RoZXIgY2FzZXMKCQkJfSBlbHNlIHsKCQkJCWNvZGVPdXQgPSBjb2RlQSB8fCBjb2RlQjsKCQkJCXAgPSB0aGlzLl9nZXRFZGdlSW50ZXJzZWN0aW9uKGEsIGIsIGNvZGVPdXQsIGJvdW5kcyk7CgkJCQluZXdDb2RlID0gdGhpcy5fZ2V0Qml0Q29kZShwLCBib3VuZHMpOwoKCQkJCWlmIChjb2RlT3V0ID09PSBjb2RlQSkgewoJCQkJCWEgPSBwOwoJCQkJCWNvZGVBID0gbmV3Q29kZTsKCQkJCX0gZWxzZSB7CgkJCQkJYiA9IHA7CgkJCQkJY29kZUIgPSBuZXdDb2RlOwoJCQkJfQoJCQl9CgkJfQoJfSwKCglfZ2V0RWRnZUludGVyc2VjdGlvbjogZnVuY3Rpb24gKGEsIGIsIGNvZGUsIGJvdW5kcykgewoJCXZhciBkeCA9IGIueCAtIGEueCwKCQkgICAgZHkgPSBiLnkgLSBhLnksCgkJICAgIG1pbiA9IGJvdW5kcy5taW4sCgkJICAgIG1heCA9IGJvdW5kcy5tYXg7CgoJCWlmIChjb2RlICYgOCkgeyAvLyB0b3AKCQkJcmV0dXJuIG5ldyBMLlBvaW50KGEueCArIGR4ICogKG1heC55IC0gYS55KSAvIGR5LCBtYXgueSk7CgkJfSBlbHNlIGlmIChjb2RlICYgNCkgeyAvLyBib3R0b20KCQkJcmV0dXJuIG5ldyBMLlBvaW50KGEueCArIGR4ICogKG1pbi55IC0gYS55KSAvIGR5LCBtaW4ueSk7CgkJfSBlbHNlIGlmIChjb2RlICYgMikgeyAvLyByaWdodAoJCQlyZXR1cm4gbmV3IEwuUG9pbnQobWF4LngsIGEueSArIGR5ICogKG1heC54IC0gYS54KSAvIGR4KTsKCQl9IGVsc2UgaWYgKGNvZGUgJiAxKSB7IC8vIGxlZnQKCQkJcmV0dXJuIG5ldyBMLlBvaW50KG1pbi54LCBhLnkgKyBkeSAqIChtaW4ueCAtIGEueCkgLyBkeCk7CgkJfQoJfSwKCglfZ2V0Qml0Q29kZTogZnVuY3Rpb24gKC8qUG9pbnQqLyBwLCBib3VuZHMpIHsKCQl2YXIgY29kZSA9IDA7CgoJCWlmIChwLnggPCBib3VuZHMubWluLngpIHsgLy8gbGVmdAoJCQljb2RlIHw9IDE7CgkJfSBlbHNlIGlmIChwLnggPiBib3VuZHMubWF4LngpIHsgLy8gcmlnaHQKCQkJY29kZSB8PSAyOwoJCX0KCQlpZiAocC55IDwgYm91bmRzLm1pbi55KSB7IC8vIGJvdHRvbQoJCQljb2RlIHw9IDQ7CgkJfSBlbHNlIGlmIChwLnkgPiBib3VuZHMubWF4LnkpIHsgLy8gdG9wCgkJCWNvZGUgfD0gODsKCQl9CgoJCXJldHVybiBjb2RlOwoJfSwKCgkvLyBzcXVhcmUgZGlzdGFuY2UgKHRvIGF2b2lkIHVubmVjZXNzYXJ5IE1hdGguc3FydCBjYWxscykKCV9zcURpc3Q6IGZ1bmN0aW9uIChwMSwgcDIpIHsKCQl2YXIgZHggPSBwMi54IC0gcDEueCwKCQkgICAgZHkgPSBwMi55IC0gcDEueTsKCQlyZXR1cm4gZHggKiBkeCArIGR5ICogZHk7Cgl9LAoKCS8vIHJldHVybiBjbG9zZXN0IHBvaW50IG9uIHNlZ21lbnQgb3IgZGlzdGFuY2UgdG8gdGhhdCBwb2ludAoJX3NxQ2xvc2VzdFBvaW50T25TZWdtZW50OiBmdW5jdGlvbiAocCwgcDEsIHAyLCBzcURpc3QpIHsKCQl2YXIgeCA9IHAxLngsCgkJICAgIHkgPSBwMS55LAoJCSAgICBkeCA9IHAyLnggLSB4LAoJCSAgICBkeSA9IHAyLnkgLSB5LAoJCSAgICBkb3QgPSBkeCAqIGR4ICsgZHkgKiBkeSwKCQkgICAgdDsKCgkJaWYgKGRvdCA+IDApIHsKCQkJdCA9ICgocC54IC0geCkgKiBkeCArIChwLnkgLSB5KSAqIGR5KSAvIGRvdDsKCgkJCWlmICh0ID4gMSkgewoJCQkJeCA9IHAyLng7CgkJCQl5ID0gcDIueTsKCQkJfSBlbHNlIGlmICh0ID4gMCkgewoJCQkJeCArPSBkeCAqIHQ7CgkJCQl5ICs9IGR5ICogdDsKCQkJfQoJCX0KCgkJZHggPSBwLnggLSB4OwoJCWR5ID0gcC55IC0geTsKCgkJcmV0dXJuIHNxRGlzdCA/IGR4ICogZHggKyBkeSAqIGR5IDogbmV3IEwuUG9pbnQoeCwgeSk7Cgl9Cn07CgoKLyoKICogTC5Qb2x5bGluZSBpcyB1c2VkIHRvIGRpc3BsYXkgcG9seWxpbmVzIG9uIGEgbWFwLgogKi8KCkwuUG9seWxpbmUgPSBMLlBhdGguZXh0ZW5kKHsKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChsYXRsbmdzLCBvcHRpb25zKSB7CgkJTC5QYXRoLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucyk7CgoJCXRoaXMuX2xhdGxuZ3MgPSB0aGlzLl9jb252ZXJ0TGF0TG5ncyhsYXRsbmdzKTsKCX0sCgoJb3B0aW9uczogewoJCS8vIGhvdyBtdWNoIHRvIHNpbXBsaWZ5IHRoZSBwb2x5bGluZSBvbiBlYWNoIHpvb20gbGV2ZWwKCQkvLyBtb3JlID0gYmV0dGVyIHBlcmZvcm1hbmNlIGFuZCBzbW9vdGhlciBsb29rLCBsZXNzID0gbW9yZSBhY2N1cmF0ZQoJCXNtb290aEZhY3RvcjogMS4wLAoJCW5vQ2xpcDogZmFsc2UKCX0sCgoJcHJvamVjdExhdGxuZ3M6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9vcmlnaW5hbFBvaW50cyA9IFtdOwoKCQlmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5fbGF0bG5ncy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQl0aGlzLl9vcmlnaW5hbFBvaW50c1tpXSA9IHRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQodGhpcy5fbGF0bG5nc1tpXSk7CgkJfQoJfSwKCglnZXRQYXRoU3RyaW5nOiBmdW5jdGlvbiAoKSB7CgkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX3BhcnRzLmxlbmd0aCwgc3RyID0gJyc7IGkgPCBsZW47IGkrKykgewoJCQlzdHIgKz0gdGhpcy5fZ2V0UGF0aFBhcnRTdHIodGhpcy5fcGFydHNbaV0pOwoJCX0KCQlyZXR1cm4gc3RyOwoJfSwKCglnZXRMYXRMbmdzOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRoaXMuX2xhdGxuZ3M7Cgl9LAoKCXNldExhdExuZ3M6IGZ1bmN0aW9uIChsYXRsbmdzKSB7CgkJdGhpcy5fbGF0bG5ncyA9IHRoaXMuX2NvbnZlcnRMYXRMbmdzKGxhdGxuZ3MpOwoJCXJldHVybiB0aGlzLnJlZHJhdygpOwoJfSwKCglhZGRMYXRMbmc6IGZ1bmN0aW9uIChsYXRsbmcpIHsKCQl0aGlzLl9sYXRsbmdzLnB1c2goTC5sYXRMbmcobGF0bG5nKSk7CgkJcmV0dXJuIHRoaXMucmVkcmF3KCk7Cgl9LAoKCXNwbGljZUxhdExuZ3M6IGZ1bmN0aW9uICgpIHsgLy8gKE51bWJlciBpbmRleCwgTnVtYmVyIGhvd01hbnkpCgkJdmFyIHJlbW92ZWQgPSBbXS5zcGxpY2UuYXBwbHkodGhpcy5fbGF0bG5ncywgYXJndW1lbnRzKTsKCQl0aGlzLl9jb252ZXJ0TGF0TG5ncyh0aGlzLl9sYXRsbmdzLCB0cnVlKTsKCQl0aGlzLnJlZHJhdygpOwoJCXJldHVybiByZW1vdmVkOwoJfSwKCgljbG9zZXN0TGF5ZXJQb2ludDogZnVuY3Rpb24gKHApIHsKCQl2YXIgbWluRGlzdGFuY2UgPSBJbmZpbml0eSwgcGFydHMgPSB0aGlzLl9wYXJ0cywgcDEsIHAyLCBtaW5Qb2ludCA9IG51bGw7CgoJCWZvciAodmFyIGogPSAwLCBqTGVuID0gcGFydHMubGVuZ3RoOyBqIDwgakxlbjsgaisrKSB7CgkJCXZhciBwb2ludHMgPSBwYXJ0c1tqXTsKCQkJZm9yICh2YXIgaSA9IDEsIGxlbiA9IHBvaW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQkJcDEgPSBwb2ludHNbaSAtIDFdOwoJCQkJcDIgPSBwb2ludHNbaV07CgkJCQl2YXIgc3FEaXN0ID0gTC5MaW5lVXRpbC5fc3FDbG9zZXN0UG9pbnRPblNlZ21lbnQocCwgcDEsIHAyLCB0cnVlKTsKCQkJCWlmIChzcURpc3QgPCBtaW5EaXN0YW5jZSkgewoJCQkJCW1pbkRpc3RhbmNlID0gc3FEaXN0OwoJCQkJCW1pblBvaW50ID0gTC5MaW5lVXRpbC5fc3FDbG9zZXN0UG9pbnRPblNlZ21lbnQocCwgcDEsIHAyKTsKCQkJCX0KCQkJfQoJCX0KCQlpZiAobWluUG9pbnQpIHsKCQkJbWluUG9pbnQuZGlzdGFuY2UgPSBNYXRoLnNxcnQobWluRGlzdGFuY2UpOwoJCX0KCQlyZXR1cm4gbWluUG9pbnQ7Cgl9LAoKCWdldEJvdW5kczogZnVuY3Rpb24gKCkgewoJCXJldHVybiBuZXcgTC5MYXRMbmdCb3VuZHModGhpcy5nZXRMYXRMbmdzKCkpOwoJfSwKCglfY29udmVydExhdExuZ3M6IGZ1bmN0aW9uIChsYXRsbmdzLCBvdmVyd3JpdGUpIHsKCQl2YXIgaSwgbGVuLCB0YXJnZXQgPSBvdmVyd3JpdGUgPyBsYXRsbmdzIDogW107CgoJCWZvciAoaSA9IDAsIGxlbiA9IGxhdGxuZ3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJaWYgKEwuVXRpbC5pc0FycmF5KGxhdGxuZ3NbaV0pICYmIHR5cGVvZiBsYXRsbmdzW2ldWzBdICE9PSAnbnVtYmVyJykgewoJCQkJcmV0dXJuOwoJCQl9CgkJCXRhcmdldFtpXSA9IEwubGF0TG5nKGxhdGxuZ3NbaV0pOwoJCX0KCQlyZXR1cm4gdGFyZ2V0OwoJfSwKCglfaW5pdEV2ZW50czogZnVuY3Rpb24gKCkgewoJCUwuUGF0aC5wcm90b3R5cGUuX2luaXRFdmVudHMuY2FsbCh0aGlzKTsKCX0sCgoJX2dldFBhdGhQYXJ0U3RyOiBmdW5jdGlvbiAocG9pbnRzKSB7CgkJdmFyIHJvdW5kID0gTC5QYXRoLlZNTDsKCgkJZm9yICh2YXIgaiA9IDAsIGxlbjIgPSBwb2ludHMubGVuZ3RoLCBzdHIgPSAnJywgcDsgaiA8IGxlbjI7IGorKykgewoJCQlwID0gcG9pbnRzW2pdOwoJCQlpZiAocm91bmQpIHsKCQkJCXAuX3JvdW5kKCk7CgkJCX0KCQkJc3RyICs9IChqID8gJ0wnIDogJ00nKSArIHAueCArICcgJyArIHAueTsKCQl9CgkJcmV0dXJuIHN0cjsKCX0sCgoJX2NsaXBQb2ludHM6IGZ1bmN0aW9uICgpIHsKCQl2YXIgcG9pbnRzID0gdGhpcy5fb3JpZ2luYWxQb2ludHMsCgkJICAgIGxlbiA9IHBvaW50cy5sZW5ndGgsCgkJICAgIGksIGssIHNlZ21lbnQ7CgoJCWlmICh0aGlzLm9wdGlvbnMubm9DbGlwKSB7CgkJCXRoaXMuX3BhcnRzID0gW3BvaW50c107CgkJCXJldHVybjsKCQl9CgoJCXRoaXMuX3BhcnRzID0gW107CgoJCXZhciBwYXJ0cyA9IHRoaXMuX3BhcnRzLAoJCSAgICB2cCA9IHRoaXMuX21hcC5fcGF0aFZpZXdwb3J0LAoJCSAgICBsdSA9IEwuTGluZVV0aWw7CgoJCWZvciAoaSA9IDAsIGsgPSAwOyBpIDwgbGVuIC0gMTsgaSsrKSB7CgkJCXNlZ21lbnQgPSBsdS5jbGlwU2VnbWVudChwb2ludHNbaV0sIHBvaW50c1tpICsgMV0sIHZwLCBpKTsKCQkJaWYgKCFzZWdtZW50KSB7CgkJCQljb250aW51ZTsKCQkJfQoKCQkJcGFydHNba10gPSBwYXJ0c1trXSB8fCBbXTsKCQkJcGFydHNba10ucHVzaChzZWdtZW50WzBdKTsKCgkJCS8vIGlmIHNlZ21lbnQgZ29lcyBvdXQgb2Ygc2NyZWVuLCBvciBpdCdzIHRoZSBsYXN0IG9uZSwgaXQncyB0aGUgZW5kIG9mIHRoZSBsaW5lIHBhcnQKCQkJaWYgKChzZWdtZW50WzFdICE9PSBwb2ludHNbaSArIDFdKSB8fCAoaSA9PT0gbGVuIC0gMikpIHsKCQkJCXBhcnRzW2tdLnB1c2goc2VnbWVudFsxXSk7CgkJCQlrKys7CgkJCX0KCQl9Cgl9LAoKCS8vIHNpbXBsaWZ5IGVhY2ggY2xpcHBlZCBwYXJ0IG9mIHRoZSBwb2x5bGluZQoJX3NpbXBsaWZ5UG9pbnRzOiBmdW5jdGlvbiAoKSB7CgkJdmFyIHBhcnRzID0gdGhpcy5fcGFydHMsCgkJICAgIGx1ID0gTC5MaW5lVXRpbDsKCgkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHBhcnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCXBhcnRzW2ldID0gbHUuc2ltcGxpZnkocGFydHNbaV0sIHRoaXMub3B0aW9ucy5zbW9vdGhGYWN0b3IpOwoJCX0KCX0sCgoJX3VwZGF0ZVBhdGg6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIXRoaXMuX21hcCkgeyByZXR1cm47IH0KCgkJdGhpcy5fY2xpcFBvaW50cygpOwoJCXRoaXMuX3NpbXBsaWZ5UG9pbnRzKCk7CgoJCUwuUGF0aC5wcm90b3R5cGUuX3VwZGF0ZVBhdGguY2FsbCh0aGlzKTsKCX0KfSk7CgpMLnBvbHlsaW5lID0gZnVuY3Rpb24gKGxhdGxuZ3MsIG9wdGlvbnMpIHsKCXJldHVybiBuZXcgTC5Qb2x5bGluZShsYXRsbmdzLCBvcHRpb25zKTsKfTsKCgovKgogKiBMLlBvbHlVdGlsIGNvbnRhaW5zIHV0aWxpdHkgZnVuY3Rpb25zIGZvciBwb2x5Z29ucyAoY2xpcHBpbmcsIGV0Yy4pLgogKi8KCi8qanNoaW50IGJpdHdpc2U6ZmFsc2UgKi8gLy8gYWxsb3cgYml0d2lzZSBvcGVyYXRpb25zIGhlcmUKCkwuUG9seVV0aWwgPSB7fTsKCi8qCiAqIFN1dGhlcmxhbmQtSG9kZ2VtYW4gcG9seWdvbiBjbGlwcGluZyBhbGdvcml0aG0uCiAqIFVzZWQgdG8gYXZvaWQgcmVuZGVyaW5nIHBhcnRzIG9mIGEgcG9seWdvbiB0aGF0IGFyZSBub3QgY3VycmVudGx5IHZpc2libGUuCiAqLwpMLlBvbHlVdGlsLmNsaXBQb2x5Z29uID0gZnVuY3Rpb24gKHBvaW50cywgYm91bmRzKSB7Cgl2YXIgY2xpcHBlZFBvaW50cywKCSAgICBlZGdlcyA9IFsxLCA0LCAyLCA4XSwKCSAgICBpLCBqLCBrLAoJICAgIGEsIGIsCgkgICAgbGVuLCBlZGdlLCBwLAoJICAgIGx1ID0gTC5MaW5lVXRpbDsKCglmb3IgKGkgPSAwLCBsZW4gPSBwb2ludHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQlwb2ludHNbaV0uX2NvZGUgPSBsdS5fZ2V0Qml0Q29kZShwb2ludHNbaV0sIGJvdW5kcyk7Cgl9CgoJLy8gZm9yIGVhY2ggZWRnZSAobGVmdCwgYm90dG9tLCByaWdodCwgdG9wKQoJZm9yIChrID0gMDsgayA8IDQ7IGsrKykgewoJCWVkZ2UgPSBlZGdlc1trXTsKCQljbGlwcGVkUG9pbnRzID0gW107CgoJCWZvciAoaSA9IDAsIGxlbiA9IHBvaW50cy5sZW5ndGgsIGogPSBsZW4gLSAxOyBpIDwgbGVuOyBqID0gaSsrKSB7CgkJCWEgPSBwb2ludHNbaV07CgkJCWIgPSBwb2ludHNbal07CgoJCQkvLyBpZiBhIGlzIGluc2lkZSB0aGUgY2xpcCB3aW5kb3cKCQkJaWYgKCEoYS5fY29kZSAmIGVkZ2UpKSB7CgkJCQkvLyBpZiBiIGlzIG91dHNpZGUgdGhlIGNsaXAgd2luZG93IChhLT5iIGdvZXMgb3V0IG9mIHNjcmVlbikKCQkJCWlmIChiLl9jb2RlICYgZWRnZSkgewoJCQkJCXAgPSBsdS5fZ2V0RWRnZUludGVyc2VjdGlvbihiLCBhLCBlZGdlLCBib3VuZHMpOwoJCQkJCXAuX2NvZGUgPSBsdS5fZ2V0Qml0Q29kZShwLCBib3VuZHMpOwoJCQkJCWNsaXBwZWRQb2ludHMucHVzaChwKTsKCQkJCX0KCQkJCWNsaXBwZWRQb2ludHMucHVzaChhKTsKCgkJCS8vIGVsc2UgaWYgYiBpcyBpbnNpZGUgdGhlIGNsaXAgd2luZG93IChhLT5iIGVudGVycyB0aGUgc2NyZWVuKQoJCQl9IGVsc2UgaWYgKCEoYi5fY29kZSAmIGVkZ2UpKSB7CgkJCQlwID0gbHUuX2dldEVkZ2VJbnRlcnNlY3Rpb24oYiwgYSwgZWRnZSwgYm91bmRzKTsKCQkJCXAuX2NvZGUgPSBsdS5fZ2V0Qml0Q29kZShwLCBib3VuZHMpOwoJCQkJY2xpcHBlZFBvaW50cy5wdXNoKHApOwoJCQl9CgkJfQoJCXBvaW50cyA9IGNsaXBwZWRQb2ludHM7Cgl9CgoJcmV0dXJuIHBvaW50czsKfTsKCgovKgogKiBMLlBvbHlnb24gaXMgdXNlZCB0byBkaXNwbGF5IHBvbHlnb25zIG9uIGEgbWFwLgogKi8KCkwuUG9seWdvbiA9IEwuUG9seWxpbmUuZXh0ZW5kKHsKCW9wdGlvbnM6IHsKCQlmaWxsOiB0cnVlCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChsYXRsbmdzLCBvcHRpb25zKSB7CgkJTC5Qb2x5bGluZS5wcm90b3R5cGUuaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGxhdGxuZ3MsIG9wdGlvbnMpOwoJCXRoaXMuX2luaXRXaXRoSG9sZXMobGF0bG5ncyk7Cgl9LAoKCV9pbml0V2l0aEhvbGVzOiBmdW5jdGlvbiAobGF0bG5ncykgewoJCXZhciBpLCBsZW4sIGhvbGU7CgkJaWYgKGxhdGxuZ3MgJiYgTC5VdGlsLmlzQXJyYXkobGF0bG5nc1swXSkgJiYgKHR5cGVvZiBsYXRsbmdzWzBdWzBdICE9PSAnbnVtYmVyJykpIHsKCQkJdGhpcy5fbGF0bG5ncyA9IHRoaXMuX2NvbnZlcnRMYXRMbmdzKGxhdGxuZ3NbMF0pOwoJCQl0aGlzLl9ob2xlcyA9IGxhdGxuZ3Muc2xpY2UoMSk7CgoJCQlmb3IgKGkgPSAwLCBsZW4gPSB0aGlzLl9ob2xlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQkJaG9sZSA9IHRoaXMuX2hvbGVzW2ldID0gdGhpcy5fY29udmVydExhdExuZ3ModGhpcy5faG9sZXNbaV0pOwoJCQkJaWYgKGhvbGVbMF0uZXF1YWxzKGhvbGVbaG9sZS5sZW5ndGggLSAxXSkpIHsKCQkJCQlob2xlLnBvcCgpOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBmaWx0ZXIgb3V0IGxhc3QgcG9pbnQgaWYgaXRzIGVxdWFsIHRvIHRoZSBmaXJzdCBvbmUKCQlsYXRsbmdzID0gdGhpcy5fbGF0bG5nczsKCgkJaWYgKGxhdGxuZ3MubGVuZ3RoID49IDIgJiYgbGF0bG5nc1swXS5lcXVhbHMobGF0bG5nc1tsYXRsbmdzLmxlbmd0aCAtIDFdKSkgewoJCQlsYXRsbmdzLnBvcCgpOwoJCX0KCX0sCgoJcHJvamVjdExhdGxuZ3M6IGZ1bmN0aW9uICgpIHsKCQlMLlBvbHlsaW5lLnByb3RvdHlwZS5wcm9qZWN0TGF0bG5ncy5jYWxsKHRoaXMpOwoKCQkvLyBwcm9qZWN0IHBvbHlnb24gaG9sZXMgcG9pbnRzCgkJLy8gVE9ETyBtb3ZlIHRoaXMgbG9naWMgdG8gUG9seWxpbmUgdG8gZ2V0IHJpZCBvZiBkdXBsaWNhdGlvbgoJCXRoaXMuX2hvbGVQb2ludHMgPSBbXTsKCgkJaWYgKCF0aGlzLl9ob2xlcykgeyByZXR1cm47IH0KCgkJdmFyIGksIGosIGxlbiwgbGVuMjsKCgkJZm9yIChpID0gMCwgbGVuID0gdGhpcy5faG9sZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJdGhpcy5faG9sZVBvaW50c1tpXSA9IFtdOwoKCQkJZm9yIChqID0gMCwgbGVuMiA9IHRoaXMuX2hvbGVzW2ldLmxlbmd0aDsgaiA8IGxlbjI7IGorKykgewoJCQkJdGhpcy5faG9sZVBvaW50c1tpXVtqXSA9IHRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQodGhpcy5faG9sZXNbaV1bal0pOwoJCQl9CgkJfQoJfSwKCglzZXRMYXRMbmdzOiBmdW5jdGlvbiAobGF0bG5ncykgewoJCWlmIChsYXRsbmdzICYmIEwuVXRpbC5pc0FycmF5KGxhdGxuZ3NbMF0pICYmICh0eXBlb2YgbGF0bG5nc1swXVswXSAhPT0gJ251bWJlcicpKSB7CgkJCXRoaXMuX2luaXRXaXRoSG9sZXMobGF0bG5ncyk7CgkJCXJldHVybiB0aGlzLnJlZHJhdygpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBMLlBvbHlsaW5lLnByb3RvdHlwZS5zZXRMYXRMbmdzLmNhbGwodGhpcywgbGF0bG5ncyk7CgkJfQoJfSwKCglfY2xpcFBvaW50czogZnVuY3Rpb24gKCkgewoJCXZhciBwb2ludHMgPSB0aGlzLl9vcmlnaW5hbFBvaW50cywKCQkgICAgbmV3UGFydHMgPSBbXTsKCgkJdGhpcy5fcGFydHMgPSBbcG9pbnRzXS5jb25jYXQodGhpcy5faG9sZVBvaW50cyk7CgoJCWlmICh0aGlzLm9wdGlvbnMubm9DbGlwKSB7IHJldHVybjsgfQoKCQlmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5fcGFydHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJdmFyIGNsaXBwZWQgPSBMLlBvbHlVdGlsLmNsaXBQb2x5Z29uKHRoaXMuX3BhcnRzW2ldLCB0aGlzLl9tYXAuX3BhdGhWaWV3cG9ydCk7CgkJCWlmIChjbGlwcGVkLmxlbmd0aCkgewoJCQkJbmV3UGFydHMucHVzaChjbGlwcGVkKTsKCQkJfQoJCX0KCgkJdGhpcy5fcGFydHMgPSBuZXdQYXJ0czsKCX0sCgoJX2dldFBhdGhQYXJ0U3RyOiBmdW5jdGlvbiAocG9pbnRzKSB7CgkJdmFyIHN0ciA9IEwuUG9seWxpbmUucHJvdG90eXBlLl9nZXRQYXRoUGFydFN0ci5jYWxsKHRoaXMsIHBvaW50cyk7CgkJcmV0dXJuIHN0ciArIChMLkJyb3dzZXIuc3ZnID8gJ3onIDogJ3gnKTsKCX0KfSk7CgpMLnBvbHlnb24gPSBmdW5jdGlvbiAobGF0bG5ncywgb3B0aW9ucykgewoJcmV0dXJuIG5ldyBMLlBvbHlnb24obGF0bG5ncywgb3B0aW9ucyk7Cn07CgoKLyoKICogQ29udGFpbnMgTC5NdWx0aVBvbHlsaW5lIGFuZCBMLk11bHRpUG9seWdvbiBsYXllcnMuCiAqLwoKKGZ1bmN0aW9uICgpIHsKCWZ1bmN0aW9uIGNyZWF0ZU11bHRpKEtsYXNzKSB7CgoJCXJldHVybiBMLkZlYXR1cmVHcm91cC5leHRlbmQoewoKCQkJaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGxhdGxuZ3MsIG9wdGlvbnMpIHsKCQkJCXRoaXMuX2xheWVycyA9IHt9OwoJCQkJdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnM7CgkJCQl0aGlzLnNldExhdExuZ3MobGF0bG5ncyk7CgkJCX0sCgoJCQlzZXRMYXRMbmdzOiBmdW5jdGlvbiAobGF0bG5ncykgewoJCQkJdmFyIGkgPSAwLAoJCQkJICAgIGxlbiA9IGxhdGxuZ3MubGVuZ3RoOwoKCQkJCXRoaXMuZWFjaExheWVyKGZ1bmN0aW9uIChsYXllcikgewoJCQkJCWlmIChpIDwgbGVuKSB7CgkJCQkJCWxheWVyLnNldExhdExuZ3MobGF0bG5nc1tpKytdKTsKCQkJCQl9IGVsc2UgewoJCQkJCQl0aGlzLnJlbW92ZUxheWVyKGxheWVyKTsKCQkJCQl9CgkJCQl9LCB0aGlzKTsKCgkJCQl3aGlsZSAoaSA8IGxlbikgewoJCQkJCXRoaXMuYWRkTGF5ZXIobmV3IEtsYXNzKGxhdGxuZ3NbaSsrXSwgdGhpcy5fb3B0aW9ucykpOwoJCQkJfQoKCQkJCXJldHVybiB0aGlzOwoJCQl9LAoKCQkJZ2V0TGF0TG5nczogZnVuY3Rpb24gKCkgewoJCQkJdmFyIGxhdGxuZ3MgPSBbXTsKCgkJCQl0aGlzLmVhY2hMYXllcihmdW5jdGlvbiAobGF5ZXIpIHsKCQkJCQlsYXRsbmdzLnB1c2gobGF5ZXIuZ2V0TGF0TG5ncygpKTsKCQkJCX0pOwoKCQkJCXJldHVybiBsYXRsbmdzOwoJCQl9CgkJfSk7Cgl9CgoJTC5NdWx0aVBvbHlsaW5lID0gY3JlYXRlTXVsdGkoTC5Qb2x5bGluZSk7CglMLk11bHRpUG9seWdvbiA9IGNyZWF0ZU11bHRpKEwuUG9seWdvbik7CgoJTC5tdWx0aVBvbHlsaW5lID0gZnVuY3Rpb24gKGxhdGxuZ3MsIG9wdGlvbnMpIHsKCQlyZXR1cm4gbmV3IEwuTXVsdGlQb2x5bGluZShsYXRsbmdzLCBvcHRpb25zKTsKCX07CgoJTC5tdWx0aVBvbHlnb24gPSBmdW5jdGlvbiAobGF0bG5ncywgb3B0aW9ucykgewoJCXJldHVybiBuZXcgTC5NdWx0aVBvbHlnb24obGF0bG5ncywgb3B0aW9ucyk7Cgl9Owp9KCkpOwoKCi8qCiAqIEwuUmVjdGFuZ2xlIGV4dGVuZHMgUG9seWdvbiBhbmQgY3JlYXRlcyBhIHJlY3RhbmdsZSB3aGVuIHBhc3NlZCBhIExhdExuZ0JvdW5kcyBvYmplY3QuCiAqLwoKTC5SZWN0YW5nbGUgPSBMLlBvbHlnb24uZXh0ZW5kKHsKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChsYXRMbmdCb3VuZHMsIG9wdGlvbnMpIHsKCQlMLlBvbHlnb24ucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLCB0aGlzLl9ib3VuZHNUb0xhdExuZ3MobGF0TG5nQm91bmRzKSwgb3B0aW9ucyk7Cgl9LAoKCXNldEJvdW5kczogZnVuY3Rpb24gKGxhdExuZ0JvdW5kcykgewoJCXRoaXMuc2V0TGF0TG5ncyh0aGlzLl9ib3VuZHNUb0xhdExuZ3MobGF0TG5nQm91bmRzKSk7Cgl9LAoKCV9ib3VuZHNUb0xhdExuZ3M6IGZ1bmN0aW9uIChsYXRMbmdCb3VuZHMpIHsKCQlsYXRMbmdCb3VuZHMgPSBMLmxhdExuZ0JvdW5kcyhsYXRMbmdCb3VuZHMpOwoJCXJldHVybiBbCgkJCWxhdExuZ0JvdW5kcy5nZXRTb3V0aFdlc3QoKSwKCQkJbGF0TG5nQm91bmRzLmdldE5vcnRoV2VzdCgpLAoJCQlsYXRMbmdCb3VuZHMuZ2V0Tm9ydGhFYXN0KCksCgkJCWxhdExuZ0JvdW5kcy5nZXRTb3V0aEVhc3QoKQoJCV07Cgl9Cn0pOwoKTC5yZWN0YW5nbGUgPSBmdW5jdGlvbiAobGF0TG5nQm91bmRzLCBvcHRpb25zKSB7CglyZXR1cm4gbmV3IEwuUmVjdGFuZ2xlKGxhdExuZ0JvdW5kcywgb3B0aW9ucyk7Cn07CgoKLyoKICogTC5DaXJjbGUgaXMgYSBjaXJjbGUgb3ZlcmxheSAod2l0aCBhIGNlcnRhaW4gcmFkaXVzIGluIG1ldGVycykuCiAqLwoKTC5DaXJjbGUgPSBMLlBhdGguZXh0ZW5kKHsKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChsYXRsbmcsIHJhZGl1cywgb3B0aW9ucykgewoJCUwuUGF0aC5wcm90b3R5cGUuaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMpOwoKCQl0aGlzLl9sYXRsbmcgPSBMLmxhdExuZyhsYXRsbmcpOwoJCXRoaXMuX21SYWRpdXMgPSByYWRpdXM7Cgl9LAoKCW9wdGlvbnM6IHsKCQlmaWxsOiB0cnVlCgl9LAoKCXNldExhdExuZzogZnVuY3Rpb24gKGxhdGxuZykgewoJCXRoaXMuX2xhdGxuZyA9IEwubGF0TG5nKGxhdGxuZyk7CgkJcmV0dXJuIHRoaXMucmVkcmF3KCk7Cgl9LAoKCXNldFJhZGl1czogZnVuY3Rpb24gKHJhZGl1cykgewoJCXRoaXMuX21SYWRpdXMgPSByYWRpdXM7CgkJcmV0dXJuIHRoaXMucmVkcmF3KCk7Cgl9LAoKCXByb2plY3RMYXRsbmdzOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGxuZ1JhZGl1cyA9IHRoaXMuX2dldExuZ1JhZGl1cygpLAoJCSAgICBsYXRsbmcgPSB0aGlzLl9sYXRsbmcsCgkJICAgIHBvaW50TGVmdCA9IHRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQoW2xhdGxuZy5sYXQsIGxhdGxuZy5sbmcgLSBsbmdSYWRpdXNdKTsKCgkJdGhpcy5fcG9pbnQgPSB0aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KGxhdGxuZyk7CgkJdGhpcy5fcmFkaXVzID0gTWF0aC5tYXgodGhpcy5fcG9pbnQueCAtIHBvaW50TGVmdC54LCAxKTsKCX0sCgoJZ2V0Qm91bmRzOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGxuZ1JhZGl1cyA9IHRoaXMuX2dldExuZ1JhZGl1cygpLAoJCSAgICBsYXRSYWRpdXMgPSAodGhpcy5fbVJhZGl1cyAvIDQwMDc1MDE3KSAqIDM2MCwKCQkgICAgbGF0bG5nID0gdGhpcy5fbGF0bG5nOwoKCQlyZXR1cm4gbmV3IEwuTGF0TG5nQm91bmRzKAoJCSAgICAgICAgW2xhdGxuZy5sYXQgLSBsYXRSYWRpdXMsIGxhdGxuZy5sbmcgLSBsbmdSYWRpdXNdLAoJCSAgICAgICAgW2xhdGxuZy5sYXQgKyBsYXRSYWRpdXMsIGxhdGxuZy5sbmcgKyBsbmdSYWRpdXNdKTsKCX0sCgoJZ2V0TGF0TG5nOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRoaXMuX2xhdGxuZzsKCX0sCgoJZ2V0UGF0aFN0cmluZzogZnVuY3Rpb24gKCkgewoJCXZhciBwID0gdGhpcy5fcG9pbnQsCgkJICAgIHIgPSB0aGlzLl9yYWRpdXM7CgoJCWlmICh0aGlzLl9jaGVja0lmRW1wdHkoKSkgewoJCQlyZXR1cm4gJyc7CgkJfQoKCQlpZiAoTC5Ccm93c2VyLnN2ZykgewoJCQlyZXR1cm4gJ00nICsgcC54ICsgJywnICsgKHAueSAtIHIpICsKCQkJICAgICAgICdBJyArIHIgKyAnLCcgKyByICsgJywwLDEsMSwnICsKCQkJICAgICAgIChwLnggLSAwLjEpICsgJywnICsgKHAueSAtIHIpICsgJyB6JzsKCQl9IGVsc2UgewoJCQlwLl9yb3VuZCgpOwoJCQlyID0gTWF0aC5yb3VuZChyKTsKCQkJcmV0dXJuICdBTCAnICsgcC54ICsgJywnICsgcC55ICsgJyAnICsgciArICcsJyArIHIgKyAnIDAsJyArICg2NTUzNSAqIDM2MCk7CgkJfQoJfSwKCglnZXRSYWRpdXM6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5fbVJhZGl1czsKCX0sCgoJLy8gVE9ETyBFYXJ0aCBoYXJkY29kZWQsIG1vdmUgaW50byBwcm9qZWN0aW9uIGNvZGUhCgoJX2dldExhdFJhZGl1czogZnVuY3Rpb24gKCkgewoJCXJldHVybiAodGhpcy5fbVJhZGl1cyAvIDQwMDc1MDE3KSAqIDM2MDsKCX0sCgoJX2dldExuZ1JhZGl1czogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9nZXRMYXRSYWRpdXMoKSAvIE1hdGguY29zKEwuTGF0TG5nLkRFR19UT19SQUQgKiB0aGlzLl9sYXRsbmcubGF0KTsKCX0sCgoJX2NoZWNrSWZFbXB0eTogZnVuY3Rpb24gKCkgewoJCWlmICghdGhpcy5fbWFwKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJdmFyIHZwID0gdGhpcy5fbWFwLl9wYXRoVmlld3BvcnQsCgkJICAgIHIgPSB0aGlzLl9yYWRpdXMsCgkJICAgIHAgPSB0aGlzLl9wb2ludDsKCgkJcmV0dXJuIHAueCAtIHIgPiB2cC5tYXgueCB8fCBwLnkgLSByID4gdnAubWF4LnkgfHwKCQkgICAgICAgcC54ICsgciA8IHZwLm1pbi54IHx8IHAueSArIHIgPCB2cC5taW4ueTsKCX0KfSk7CgpMLmNpcmNsZSA9IGZ1bmN0aW9uIChsYXRsbmcsIHJhZGl1cywgb3B0aW9ucykgewoJcmV0dXJuIG5ldyBMLkNpcmNsZShsYXRsbmcsIHJhZGl1cywgb3B0aW9ucyk7Cn07CgoKLyoKICogTC5DaXJjbGVNYXJrZXIgaXMgYSBjaXJjbGUgb3ZlcmxheSB3aXRoIGEgcGVybWFuZW50IHBpeGVsIHJhZGl1cy4KICovCgpMLkNpcmNsZU1hcmtlciA9IEwuQ2lyY2xlLmV4dGVuZCh7CglvcHRpb25zOiB7CgkJcmFkaXVzOiAxMCwKCQl3ZWlnaHQ6IDIKCX0sCgoJaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGxhdGxuZywgb3B0aW9ucykgewoJCUwuQ2lyY2xlLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcywgbGF0bG5nLCBudWxsLCBvcHRpb25zKTsKCQl0aGlzLl9yYWRpdXMgPSB0aGlzLm9wdGlvbnMucmFkaXVzOwoJfSwKCglwcm9qZWN0TGF0bG5nczogZnVuY3Rpb24gKCkgewoJCXRoaXMuX3BvaW50ID0gdGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludCh0aGlzLl9sYXRsbmcpOwoJfSwKCglfdXBkYXRlU3R5bGUgOiBmdW5jdGlvbiAoKSB7CgkJTC5DaXJjbGUucHJvdG90eXBlLl91cGRhdGVTdHlsZS5jYWxsKHRoaXMpOwoJCXRoaXMuc2V0UmFkaXVzKHRoaXMub3B0aW9ucy5yYWRpdXMpOwoJfSwKCglzZXRMYXRMbmc6IGZ1bmN0aW9uIChsYXRsbmcpIHsKCQlMLkNpcmNsZS5wcm90b3R5cGUuc2V0TGF0TG5nLmNhbGwodGhpcywgbGF0bG5nKTsKCQlpZiAodGhpcy5fcG9wdXAgJiYgdGhpcy5fcG9wdXAuX2lzT3BlbikgewoJCQl0aGlzLl9wb3B1cC5zZXRMYXRMbmcobGF0bG5nKTsKCQl9CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXNldFJhZGl1czogZnVuY3Rpb24gKHJhZGl1cykgewoJCXRoaXMub3B0aW9ucy5yYWRpdXMgPSB0aGlzLl9yYWRpdXMgPSByYWRpdXM7CgkJcmV0dXJuIHRoaXMucmVkcmF3KCk7Cgl9LAoKCWdldFJhZGl1czogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9yYWRpdXM7Cgl9Cn0pOwoKTC5jaXJjbGVNYXJrZXIgPSBmdW5jdGlvbiAobGF0bG5nLCBvcHRpb25zKSB7CglyZXR1cm4gbmV3IEwuQ2lyY2xlTWFya2VyKGxhdGxuZywgb3B0aW9ucyk7Cn07CgoKLyoKICogRXh0ZW5kcyBMLlBvbHlsaW5lIHRvIGJlIGFibGUgdG8gbWFudWFsbHkgZGV0ZWN0IGNsaWNrcyBvbiBDYW52YXMtcmVuZGVyZWQgcG9seWxpbmVzLgogKi8KCkwuUG9seWxpbmUuaW5jbHVkZSghTC5QYXRoLkNBTlZBUyA/IHt9IDogewoJX2NvbnRhaW5zUG9pbnQ6IGZ1bmN0aW9uIChwLCBjbG9zZWQpIHsKCQl2YXIgaSwgaiwgaywgbGVuLCBsZW4yLCBkaXN0LCBwYXJ0LAoJCSAgICB3ID0gdGhpcy5vcHRpb25zLndlaWdodCAvIDI7CgoJCWlmIChMLkJyb3dzZXIudG91Y2gpIHsKCQkJdyArPSAxMDsgLy8gcG9seWxpbmUgY2xpY2sgdG9sZXJhbmNlIG9uIHRvdWNoIGRldmljZXMKCQl9CgoJCWZvciAoaSA9IDAsIGxlbiA9IHRoaXMuX3BhcnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCXBhcnQgPSB0aGlzLl9wYXJ0c1tpXTsKCQkJZm9yIChqID0gMCwgbGVuMiA9IHBhcnQubGVuZ3RoLCBrID0gbGVuMiAtIDE7IGogPCBsZW4yOyBrID0gaisrKSB7CgkJCQlpZiAoIWNsb3NlZCAmJiAoaiA9PT0gMCkpIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCgkJCQlkaXN0ID0gTC5MaW5lVXRpbC5wb2ludFRvU2VnbWVudERpc3RhbmNlKHAsIHBhcnRba10sIHBhcnRbal0pOwoKCQkJCWlmIChkaXN0IDw9IHcpIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCQkJfQoJCX0KCQlyZXR1cm4gZmFsc2U7Cgl9Cn0pOwoKCi8qCiAqIEV4dGVuZHMgTC5Qb2x5Z29uIHRvIGJlIGFibGUgdG8gbWFudWFsbHkgZGV0ZWN0IGNsaWNrcyBvbiBDYW52YXMtcmVuZGVyZWQgcG9seWdvbnMuCiAqLwoKTC5Qb2x5Z29uLmluY2x1ZGUoIUwuUGF0aC5DQU5WQVMgPyB7fSA6IHsKCV9jb250YWluc1BvaW50OiBmdW5jdGlvbiAocCkgewoJCXZhciBpbnNpZGUgPSBmYWxzZSwKCQkgICAgcGFydCwgcDEsIHAyLAoJCSAgICBpLCBqLCBrLAoJCSAgICBsZW4sIGxlbjI7CgoJCS8vIFRPRE8gb3B0aW1pemF0aW9uOiBjaGVjayBpZiB3aXRoaW4gYm91bmRzIGZpcnN0CgoJCWlmIChMLlBvbHlsaW5lLnByb3RvdHlwZS5fY29udGFpbnNQb2ludC5jYWxsKHRoaXMsIHAsIHRydWUpKSB7CgkJCS8vIGNsaWNrIG9uIHBvbHlnb24gYm9yZGVyCgkJCXJldHVybiB0cnVlOwoJCX0KCgkJLy8gcmF5IGNhc3RpbmcgYWxnb3JpdGhtIGZvciBkZXRlY3RpbmcgaWYgcG9pbnQgaXMgaW4gcG9seWdvbgoKCQlmb3IgKGkgPSAwLCBsZW4gPSB0aGlzLl9wYXJ0cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQlwYXJ0ID0gdGhpcy5fcGFydHNbaV07CgoJCQlmb3IgKGogPSAwLCBsZW4yID0gcGFydC5sZW5ndGgsIGsgPSBsZW4yIC0gMTsgaiA8IGxlbjI7IGsgPSBqKyspIHsKCQkJCXAxID0gcGFydFtqXTsKCQkJCXAyID0gcGFydFtrXTsKCgkJCQlpZiAoKChwMS55ID4gcC55KSAhPT0gKHAyLnkgPiBwLnkpKSAmJgoJCQkJCQkocC54IDwgKHAyLnggLSBwMS54KSAqIChwLnkgLSBwMS55KSAvIChwMi55IC0gcDEueSkgKyBwMS54KSkgewoJCQkJCWluc2lkZSA9ICFpbnNpZGU7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBpbnNpZGU7Cgl9Cn0pOwoKCi8qCiAqIEV4dGVuZHMgTC5DaXJjbGUgd2l0aCBDYW52YXMtc3BlY2lmaWMgY29kZS4KICovCgpMLkNpcmNsZS5pbmNsdWRlKCFMLlBhdGguQ0FOVkFTID8ge30gOiB7CglfZHJhd1BhdGg6IGZ1bmN0aW9uICgpIHsKCQl2YXIgcCA9IHRoaXMuX3BvaW50OwoJCXRoaXMuX2N0eC5iZWdpblBhdGgoKTsKCQl0aGlzLl9jdHguYXJjKHAueCwgcC55LCB0aGlzLl9yYWRpdXMsIDAsIE1hdGguUEkgKiAyLCBmYWxzZSk7Cgl9LAoKCV9jb250YWluc1BvaW50OiBmdW5jdGlvbiAocCkgewoJCXZhciBjZW50ZXIgPSB0aGlzLl9wb2ludCwKCQkgICAgdzIgPSB0aGlzLm9wdGlvbnMuc3Ryb2tlID8gdGhpcy5vcHRpb25zLndlaWdodCAvIDIgOiAwOwoKCQlyZXR1cm4gKHAuZGlzdGFuY2VUbyhjZW50ZXIpIDw9IHRoaXMuX3JhZGl1cyArIHcyKTsKCX0KfSk7CgoKLyoKICogQ2lyY2xlTWFya2VyIGNhbnZhcyBzcGVjaWZpYyBkcmF3aW5nIHBhcnRzLgogKi8KCkwuQ2lyY2xlTWFya2VyLmluY2x1ZGUoIUwuUGF0aC5DQU5WQVMgPyB7fSA6IHsKCV91cGRhdGVTdHlsZTogZnVuY3Rpb24gKCkgewoJCUwuUGF0aC5wcm90b3R5cGUuX3VwZGF0ZVN0eWxlLmNhbGwodGhpcyk7Cgl9Cn0pOwoKCi8qCiAqIEwuR2VvSlNPTiB0dXJucyBhbnkgR2VvSlNPTiBkYXRhIGludG8gYSBMZWFmbGV0IGxheWVyLgogKi8KCkwuR2VvSlNPTiA9IEwuRmVhdHVyZUdyb3VwLmV4dGVuZCh7CgoJaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGdlb2pzb24sIG9wdGlvbnMpIHsKCQlMLnNldE9wdGlvbnModGhpcywgb3B0aW9ucyk7CgoJCXRoaXMuX2xheWVycyA9IHt9OwoKCQlpZiAoZ2VvanNvbikgewoJCQl0aGlzLmFkZERhdGEoZ2VvanNvbik7CgkJfQoJfSwKCglhZGREYXRhOiBmdW5jdGlvbiAoZ2VvanNvbikgewoJCXZhciBmZWF0dXJlcyA9IEwuVXRpbC5pc0FycmF5KGdlb2pzb24pID8gZ2VvanNvbiA6IGdlb2pzb24uZmVhdHVyZXMsCgkJICAgIGksIGxlbiwgZmVhdHVyZTsKCgkJaWYgKGZlYXR1cmVzKSB7CgkJCWZvciAoaSA9IDAsIGxlbiA9IGZlYXR1cmVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCQkvLyBPbmx5IGFkZCB0aGlzIGlmIGdlb21ldHJ5IG9yIGdlb21ldHJpZXMgYXJlIHNldCBhbmQgbm90IG51bGwKCQkJCWZlYXR1cmUgPSBmZWF0dXJlc1tpXTsKCQkJCWlmIChmZWF0dXJlLmdlb21ldHJpZXMgfHwgZmVhdHVyZS5nZW9tZXRyeSB8fCBmZWF0dXJlLmZlYXR1cmVzIHx8IGZlYXR1cmUuY29vcmRpbmF0ZXMpIHsKCQkJCQl0aGlzLmFkZERhdGEoZmVhdHVyZXNbaV0pOwoJCQkJfQoJCQl9CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgoJCWlmIChvcHRpb25zLmZpbHRlciAmJiAhb3B0aW9ucy5maWx0ZXIoZ2VvanNvbikpIHsgcmV0dXJuOyB9CgoJCXZhciBsYXllciA9IEwuR2VvSlNPTi5nZW9tZXRyeVRvTGF5ZXIoZ2VvanNvbiwgb3B0aW9ucy5wb2ludFRvTGF5ZXIsIG9wdGlvbnMuY29vcmRzVG9MYXRMbmcsIG9wdGlvbnMpOwoJCWxheWVyLmZlYXR1cmUgPSBMLkdlb0pTT04uYXNGZWF0dXJlKGdlb2pzb24pOwoKCQlsYXllci5kZWZhdWx0T3B0aW9ucyA9IGxheWVyLm9wdGlvbnM7CgkJdGhpcy5yZXNldFN0eWxlKGxheWVyKTsKCgkJaWYgKG9wdGlvbnMub25FYWNoRmVhdHVyZSkgewoJCQlvcHRpb25zLm9uRWFjaEZlYXR1cmUoZ2VvanNvbiwgbGF5ZXIpOwoJCX0KCgkJcmV0dXJuIHRoaXMuYWRkTGF5ZXIobGF5ZXIpOwoJfSwKCglyZXNldFN0eWxlOiBmdW5jdGlvbiAobGF5ZXIpIHsKCQl2YXIgc3R5bGUgPSB0aGlzLm9wdGlvbnMuc3R5bGU7CgkJaWYgKHN0eWxlKSB7CgkJCS8vIHJlc2V0IGFueSBjdXN0b20gc3R5bGVzCgkJCUwuVXRpbC5leHRlbmQobGF5ZXIub3B0aW9ucywgbGF5ZXIuZGVmYXVsdE9wdGlvbnMpOwoKCQkJdGhpcy5fc2V0TGF5ZXJTdHlsZShsYXllciwgc3R5bGUpOwoJCX0KCX0sCgoJc2V0U3R5bGU6IGZ1bmN0aW9uIChzdHlsZSkgewoJCXRoaXMuZWFjaExheWVyKGZ1bmN0aW9uIChsYXllcikgewoJCQl0aGlzLl9zZXRMYXllclN0eWxlKGxheWVyLCBzdHlsZSk7CgkJfSwgdGhpcyk7Cgl9LAoKCV9zZXRMYXllclN0eWxlOiBmdW5jdGlvbiAobGF5ZXIsIHN0eWxlKSB7CgkJaWYgKHR5cGVvZiBzdHlsZSA9PT0gJ2Z1bmN0aW9uJykgewoJCQlzdHlsZSA9IHN0eWxlKGxheWVyLmZlYXR1cmUpOwoJCX0KCQlpZiAobGF5ZXIuc2V0U3R5bGUpIHsKCQkJbGF5ZXIuc2V0U3R5bGUoc3R5bGUpOwoJCX0KCX0KfSk7CgpMLmV4dGVuZChMLkdlb0pTT04sIHsKCWdlb21ldHJ5VG9MYXllcjogZnVuY3Rpb24gKGdlb2pzb24sIHBvaW50VG9MYXllciwgY29vcmRzVG9MYXRMbmcsIHZlY3Rvck9wdGlvbnMpIHsKCQl2YXIgZ2VvbWV0cnkgPSBnZW9qc29uLnR5cGUgPT09ICdGZWF0dXJlJyA/IGdlb2pzb24uZ2VvbWV0cnkgOiBnZW9qc29uLAoJCSAgICBjb29yZHMgPSBnZW9tZXRyeS5jb29yZGluYXRlcywKCQkgICAgbGF5ZXJzID0gW10sCgkJICAgIGxhdGxuZywgbGF0bG5ncywgaSwgbGVuOwoKCQljb29yZHNUb0xhdExuZyA9IGNvb3Jkc1RvTGF0TG5nIHx8IHRoaXMuY29vcmRzVG9MYXRMbmc7CgoJCXN3aXRjaCAoZ2VvbWV0cnkudHlwZSkgewoJCWNhc2UgJ1BvaW50JzoKCQkJbGF0bG5nID0gY29vcmRzVG9MYXRMbmcoY29vcmRzKTsKCQkJcmV0dXJuIHBvaW50VG9MYXllciA/IHBvaW50VG9MYXllcihnZW9qc29uLCBsYXRsbmcpIDogbmV3IEwuTWFya2VyKGxhdGxuZyk7CgoJCWNhc2UgJ011bHRpUG9pbnQnOgoJCQlmb3IgKGkgPSAwLCBsZW4gPSBjb29yZHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJCWxhdGxuZyA9IGNvb3Jkc1RvTGF0TG5nKGNvb3Jkc1tpXSk7CgkJCQlsYXllcnMucHVzaChwb2ludFRvTGF5ZXIgPyBwb2ludFRvTGF5ZXIoZ2VvanNvbiwgbGF0bG5nKSA6IG5ldyBMLk1hcmtlcihsYXRsbmcpKTsKCQkJfQoJCQlyZXR1cm4gbmV3IEwuRmVhdHVyZUdyb3VwKGxheWVycyk7CgoJCWNhc2UgJ0xpbmVTdHJpbmcnOgoJCQlsYXRsbmdzID0gdGhpcy5jb29yZHNUb0xhdExuZ3MoY29vcmRzLCAwLCBjb29yZHNUb0xhdExuZyk7CgkJCXJldHVybiBuZXcgTC5Qb2x5bGluZShsYXRsbmdzLCB2ZWN0b3JPcHRpb25zKTsKCgkJY2FzZSAnUG9seWdvbic6CgkJCWlmIChjb29yZHMubGVuZ3RoID09PSAyICYmICFjb29yZHNbMV0ubGVuZ3RoKSB7CgkJCQl0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgR2VvSlNPTiBvYmplY3QuJyk7CgkJCX0KCQkJbGF0bG5ncyA9IHRoaXMuY29vcmRzVG9MYXRMbmdzKGNvb3JkcywgMSwgY29vcmRzVG9MYXRMbmcpOwoJCQlyZXR1cm4gbmV3IEwuUG9seWdvbihsYXRsbmdzLCB2ZWN0b3JPcHRpb25zKTsKCgkJY2FzZSAnTXVsdGlMaW5lU3RyaW5nJzoKCQkJbGF0bG5ncyA9IHRoaXMuY29vcmRzVG9MYXRMbmdzKGNvb3JkcywgMSwgY29vcmRzVG9MYXRMbmcpOwoJCQlyZXR1cm4gbmV3IEwuTXVsdGlQb2x5bGluZShsYXRsbmdzLCB2ZWN0b3JPcHRpb25zKTsKCgkJY2FzZSAnTXVsdGlQb2x5Z29uJzoKCQkJbGF0bG5ncyA9IHRoaXMuY29vcmRzVG9MYXRMbmdzKGNvb3JkcywgMiwgY29vcmRzVG9MYXRMbmcpOwoJCQlyZXR1cm4gbmV3IEwuTXVsdGlQb2x5Z29uKGxhdGxuZ3MsIHZlY3Rvck9wdGlvbnMpOwoKCQljYXNlICdHZW9tZXRyeUNvbGxlY3Rpb24nOgoJCQlmb3IgKGkgPSAwLCBsZW4gPSBnZW9tZXRyeS5nZW9tZXRyaWVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgoJCQkJbGF5ZXJzLnB1c2godGhpcy5nZW9tZXRyeVRvTGF5ZXIoewoJCQkJCWdlb21ldHJ5OiBnZW9tZXRyeS5nZW9tZXRyaWVzW2ldLAoJCQkJCXR5cGU6ICdGZWF0dXJlJywKCQkJCQlwcm9wZXJ0aWVzOiBnZW9qc29uLnByb3BlcnRpZXMKCQkJCX0sIHBvaW50VG9MYXllciwgY29vcmRzVG9MYXRMbmcsIHZlY3Rvck9wdGlvbnMpKTsKCQkJfQoJCQlyZXR1cm4gbmV3IEwuRmVhdHVyZUdyb3VwKGxheWVycyk7CgoJCWRlZmF1bHQ6CgkJCXRocm93IG5ldyBFcnJvcignSW52YWxpZCBHZW9KU09OIG9iamVjdC4nKTsKCQl9Cgl9LAoKCWNvb3Jkc1RvTGF0TG5nOiBmdW5jdGlvbiAoY29vcmRzKSB7IC8vIChBcnJheVssIEJvb2xlYW5dKSAtPiBMYXRMbmcKCQlyZXR1cm4gbmV3IEwuTGF0TG5nKGNvb3Jkc1sxXSwgY29vcmRzWzBdLCBjb29yZHNbMl0pOwoJfSwKCgljb29yZHNUb0xhdExuZ3M6IGZ1bmN0aW9uIChjb29yZHMsIGxldmVsc0RlZXAsIGNvb3Jkc1RvTGF0TG5nKSB7IC8vIChBcnJheVssIE51bWJlciwgRnVuY3Rpb25dKSAtPiBBcnJheQoJCXZhciBsYXRsbmcsIGksIGxlbiwKCQkgICAgbGF0bG5ncyA9IFtdOwoKCQlmb3IgKGkgPSAwLCBsZW4gPSBjb29yZHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJbGF0bG5nID0gbGV2ZWxzRGVlcCA/CgkJCSAgICAgICAgdGhpcy5jb29yZHNUb0xhdExuZ3MoY29vcmRzW2ldLCBsZXZlbHNEZWVwIC0gMSwgY29vcmRzVG9MYXRMbmcpIDoKCQkJICAgICAgICAoY29vcmRzVG9MYXRMbmcgfHwgdGhpcy5jb29yZHNUb0xhdExuZykoY29vcmRzW2ldKTsKCgkJCWxhdGxuZ3MucHVzaChsYXRsbmcpOwoJCX0KCgkJcmV0dXJuIGxhdGxuZ3M7Cgl9LAoKCWxhdExuZ1RvQ29vcmRzOiBmdW5jdGlvbiAobGF0bG5nKSB7CgkJdmFyIGNvb3JkcyA9IFtsYXRsbmcubG5nLCBsYXRsbmcubGF0XTsKCgkJaWYgKGxhdGxuZy5hbHQgIT09IHVuZGVmaW5lZCkgewoJCQljb29yZHMucHVzaChsYXRsbmcuYWx0KTsKCQl9CgkJcmV0dXJuIGNvb3JkczsKCX0sCgoJbGF0TG5nc1RvQ29vcmRzOiBmdW5jdGlvbiAobGF0TG5ncykgewoJCXZhciBjb29yZHMgPSBbXTsKCgkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxhdExuZ3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJY29vcmRzLnB1c2goTC5HZW9KU09OLmxhdExuZ1RvQ29vcmRzKGxhdExuZ3NbaV0pKTsKCQl9CgoJCXJldHVybiBjb29yZHM7Cgl9LAoKCWdldEZlYXR1cmU6IGZ1bmN0aW9uIChsYXllciwgbmV3R2VvbWV0cnkpIHsKCQlyZXR1cm4gbGF5ZXIuZmVhdHVyZSA/IEwuZXh0ZW5kKHt9LCBsYXllci5mZWF0dXJlLCB7Z2VvbWV0cnk6IG5ld0dlb21ldHJ5fSkgOiBMLkdlb0pTT04uYXNGZWF0dXJlKG5ld0dlb21ldHJ5KTsKCX0sCgoJYXNGZWF0dXJlOiBmdW5jdGlvbiAoZ2VvSlNPTikgewoJCWlmIChnZW9KU09OLnR5cGUgPT09ICdGZWF0dXJlJykgewoJCQlyZXR1cm4gZ2VvSlNPTjsKCQl9CgoJCXJldHVybiB7CgkJCXR5cGU6ICdGZWF0dXJlJywKCQkJcHJvcGVydGllczoge30sCgkJCWdlb21ldHJ5OiBnZW9KU09OCgkJfTsKCX0KfSk7Cgp2YXIgUG9pbnRUb0dlb0pTT04gPSB7Cgl0b0dlb0pTT046IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gTC5HZW9KU09OLmdldEZlYXR1cmUodGhpcywgewoJCQl0eXBlOiAnUG9pbnQnLAoJCQljb29yZGluYXRlczogTC5HZW9KU09OLmxhdExuZ1RvQ29vcmRzKHRoaXMuZ2V0TGF0TG5nKCkpCgkJfSk7Cgl9Cn07CgpMLk1hcmtlci5pbmNsdWRlKFBvaW50VG9HZW9KU09OKTsKTC5DaXJjbGUuaW5jbHVkZShQb2ludFRvR2VvSlNPTik7CkwuQ2lyY2xlTWFya2VyLmluY2x1ZGUoUG9pbnRUb0dlb0pTT04pOwoKTC5Qb2x5bGluZS5pbmNsdWRlKHsKCXRvR2VvSlNPTjogZnVuY3Rpb24gKCkgewoJCXJldHVybiBMLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLCB7CgkJCXR5cGU6ICdMaW5lU3RyaW5nJywKCQkJY29vcmRpbmF0ZXM6IEwuR2VvSlNPTi5sYXRMbmdzVG9Db29yZHModGhpcy5nZXRMYXRMbmdzKCkpCgkJfSk7Cgl9Cn0pOwoKTC5Qb2x5Z29uLmluY2x1ZGUoewoJdG9HZW9KU09OOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGNvb3JkcyA9IFtMLkdlb0pTT04ubGF0TG5nc1RvQ29vcmRzKHRoaXMuZ2V0TGF0TG5ncygpKV0sCgkJICAgIGksIGxlbiwgaG9sZTsKCgkJY29vcmRzWzBdLnB1c2goY29vcmRzWzBdWzBdKTsKCgkJaWYgKHRoaXMuX2hvbGVzKSB7CgkJCWZvciAoaSA9IDAsIGxlbiA9IHRoaXMuX2hvbGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCQlob2xlID0gTC5HZW9KU09OLmxhdExuZ3NUb0Nvb3Jkcyh0aGlzLl9ob2xlc1tpXSk7CgkJCQlob2xlLnB1c2goaG9sZVswXSk7CgkJCQljb29yZHMucHVzaChob2xlKTsKCQkJfQoJCX0KCgkJcmV0dXJuIEwuR2VvSlNPTi5nZXRGZWF0dXJlKHRoaXMsIHsKCQkJdHlwZTogJ1BvbHlnb24nLAoJCQljb29yZGluYXRlczogY29vcmRzCgkJfSk7Cgl9Cn0pOwoKKGZ1bmN0aW9uICgpIHsKCWZ1bmN0aW9uIG11bHRpVG9HZW9KU09OKHR5cGUpIHsKCQlyZXR1cm4gZnVuY3Rpb24gKCkgewoJCQl2YXIgY29vcmRzID0gW107CgoJCQl0aGlzLmVhY2hMYXllcihmdW5jdGlvbiAobGF5ZXIpIHsKCQkJCWNvb3Jkcy5wdXNoKGxheWVyLnRvR2VvSlNPTigpLmdlb21ldHJ5LmNvb3JkaW5hdGVzKTsKCQkJfSk7CgoJCQlyZXR1cm4gTC5HZW9KU09OLmdldEZlYXR1cmUodGhpcywgewoJCQkJdHlwZTogdHlwZSwKCQkJCWNvb3JkaW5hdGVzOiBjb29yZHMKCQkJfSk7CgkJfTsKCX0KCglMLk11bHRpUG9seWxpbmUuaW5jbHVkZSh7dG9HZW9KU09OOiBtdWx0aVRvR2VvSlNPTignTXVsdGlMaW5lU3RyaW5nJyl9KTsKCUwuTXVsdGlQb2x5Z29uLmluY2x1ZGUoe3RvR2VvSlNPTjogbXVsdGlUb0dlb0pTT04oJ011bHRpUG9seWdvbicpfSk7CgoJTC5MYXllckdyb3VwLmluY2x1ZGUoewoJCXRvR2VvSlNPTjogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGdlb21ldHJ5ID0gdGhpcy5mZWF0dXJlICYmIHRoaXMuZmVhdHVyZS5nZW9tZXRyeSwKCQkJCWpzb25zID0gW10sCgkJCQlqc29uOwoKCQkJaWYgKGdlb21ldHJ5ICYmIGdlb21ldHJ5LnR5cGUgPT09ICdNdWx0aVBvaW50JykgewoJCQkJcmV0dXJuIG11bHRpVG9HZW9KU09OKCdNdWx0aVBvaW50JykuY2FsbCh0aGlzKTsKCQkJfQoKCQkJdmFyIGlzR2VvbWV0cnlDb2xsZWN0aW9uID0gZ2VvbWV0cnkgJiYgZ2VvbWV0cnkudHlwZSA9PT0gJ0dlb21ldHJ5Q29sbGVjdGlvbic7CgoJCQl0aGlzLmVhY2hMYXllcihmdW5jdGlvbiAobGF5ZXIpIHsKCQkJCWlmIChsYXllci50b0dlb0pTT04pIHsKCQkJCQlqc29uID0gbGF5ZXIudG9HZW9KU09OKCk7CgkJCQkJanNvbnMucHVzaChpc0dlb21ldHJ5Q29sbGVjdGlvbiA/IGpzb24uZ2VvbWV0cnkgOiBMLkdlb0pTT04uYXNGZWF0dXJlKGpzb24pKTsKCQkJCX0KCQkJfSk7CgoJCQlpZiAoaXNHZW9tZXRyeUNvbGxlY3Rpb24pIHsKCQkJCXJldHVybiBMLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLCB7CgkJCQkJZ2VvbWV0cmllczoganNvbnMsCgkJCQkJdHlwZTogJ0dlb21ldHJ5Q29sbGVjdGlvbicKCQkJCX0pOwoJCQl9CgoJCQlyZXR1cm4gewoJCQkJdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywKCQkJCWZlYXR1cmVzOiBqc29ucwoJCQl9OwoJCX0KCX0pOwp9KCkpOwoKTC5nZW9Kc29uID0gZnVuY3Rpb24gKGdlb2pzb24sIG9wdGlvbnMpIHsKCXJldHVybiBuZXcgTC5HZW9KU09OKGdlb2pzb24sIG9wdGlvbnMpOwp9OwoKCi8qCiAqIEwuRG9tRXZlbnQgY29udGFpbnMgZnVuY3Rpb25zIGZvciB3b3JraW5nIHdpdGggRE9NIGV2ZW50cy4KICovCgpMLkRvbUV2ZW50ID0gewoJLyogaW5zcGlyZWQgYnkgSm9obiBSZXNpZywgRGVhbiBFZHdhcmRzIGFuZCBZVUkgYWRkRXZlbnQgaW1wbGVtZW50YXRpb25zICovCglhZGRMaXN0ZW5lcjogZnVuY3Rpb24gKG9iaiwgdHlwZSwgZm4sIGNvbnRleHQpIHsgLy8gKEhUTUxFbGVtZW50LCBTdHJpbmcsIEZ1bmN0aW9uWywgT2JqZWN0XSkKCgkJdmFyIGlkID0gTC5zdGFtcChmbiksCgkJICAgIGtleSA9ICdfbGVhZmxldF8nICsgdHlwZSArIGlkLAoJCSAgICBoYW5kbGVyLCBvcmlnaW5hbEhhbmRsZXIsIG5ld1R5cGU7CgoJCWlmIChvYmpba2V5XSkgeyByZXR1cm4gdGhpczsgfQoKCQloYW5kbGVyID0gZnVuY3Rpb24gKGUpIHsKCQkJcmV0dXJuIGZuLmNhbGwoY29udGV4dCB8fCBvYmosIGUgfHwgTC5Eb21FdmVudC5fZ2V0RXZlbnQoKSk7CgkJfTsKCgkJaWYgKEwuQnJvd3Nlci5wb2ludGVyICYmIHR5cGUuaW5kZXhPZigndG91Y2gnKSA9PT0gMCkgewoJCQlyZXR1cm4gdGhpcy5hZGRQb2ludGVyTGlzdGVuZXIob2JqLCB0eXBlLCBoYW5kbGVyLCBpZCk7CgkJfQoJCWlmIChMLkJyb3dzZXIudG91Y2ggJiYgKHR5cGUgPT09ICdkYmxjbGljaycpICYmIHRoaXMuYWRkRG91YmxlVGFwTGlzdGVuZXIpIHsKCQkJdGhpcy5hZGREb3VibGVUYXBMaXN0ZW5lcihvYmosIGhhbmRsZXIsIGlkKTsKCQl9CgoJCWlmICgnYWRkRXZlbnRMaXN0ZW5lcicgaW4gb2JqKSB7CgoJCQlpZiAodHlwZSA9PT0gJ21vdXNld2hlZWwnKSB7CgkJCQlvYmouYWRkRXZlbnRMaXN0ZW5lcignRE9NTW91c2VTY3JvbGwnLCBoYW5kbGVyLCBmYWxzZSk7CgkJCQlvYmouYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBoYW5kbGVyLCBmYWxzZSk7CgoJCQl9IGVsc2UgaWYgKCh0eXBlID09PSAnbW91c2VlbnRlcicpIHx8ICh0eXBlID09PSAnbW91c2VsZWF2ZScpKSB7CgoJCQkJb3JpZ2luYWxIYW5kbGVyID0gaGFuZGxlcjsKCQkJCW5ld1R5cGUgPSAodHlwZSA9PT0gJ21vdXNlZW50ZXInID8gJ21vdXNlb3ZlcicgOiAnbW91c2VvdXQnKTsKCgkJCQloYW5kbGVyID0gZnVuY3Rpb24gKGUpIHsKCQkJCQlpZiAoIUwuRG9tRXZlbnQuX2NoZWNrTW91c2Uob2JqLCBlKSkgeyByZXR1cm47IH0KCQkJCQlyZXR1cm4gb3JpZ2luYWxIYW5kbGVyKGUpOwoJCQkJfTsKCgkJCQlvYmouYWRkRXZlbnRMaXN0ZW5lcihuZXdUeXBlLCBoYW5kbGVyLCBmYWxzZSk7CgoJCQl9IGVsc2UgaWYgKHR5cGUgPT09ICdjbGljaycgJiYgTC5Ccm93c2VyLmFuZHJvaWQpIHsKCQkJCW9yaWdpbmFsSGFuZGxlciA9IGhhbmRsZXI7CgkJCQloYW5kbGVyID0gZnVuY3Rpb24gKGUpIHsKCQkJCQlyZXR1cm4gTC5Eb21FdmVudC5fZmlsdGVyQ2xpY2soZSwgb3JpZ2luYWxIYW5kbGVyKTsKCQkJCX07CgoJCQkJb2JqLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlciwgZmFsc2UpOwoJCQl9IGVsc2UgewoJCQkJb2JqLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlciwgZmFsc2UpOwoJCQl9CgoJCX0gZWxzZSBpZiAoJ2F0dGFjaEV2ZW50JyBpbiBvYmopIHsKCQkJb2JqLmF0dGFjaEV2ZW50KCdvbicgKyB0eXBlLCBoYW5kbGVyKTsKCQl9CgoJCW9ialtrZXldID0gaGFuZGxlcjsKCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXJlbW92ZUxpc3RlbmVyOiBmdW5jdGlvbiAob2JqLCB0eXBlLCBmbikgeyAgLy8gKEhUTUxFbGVtZW50LCBTdHJpbmcsIEZ1bmN0aW9uKQoKCQl2YXIgaWQgPSBMLnN0YW1wKGZuKSwKCQkgICAga2V5ID0gJ19sZWFmbGV0XycgKyB0eXBlICsgaWQsCgkJICAgIGhhbmRsZXIgPSBvYmpba2V5XTsKCgkJaWYgKCFoYW5kbGVyKSB7IHJldHVybiB0aGlzOyB9CgoJCWlmIChMLkJyb3dzZXIucG9pbnRlciAmJiB0eXBlLmluZGV4T2YoJ3RvdWNoJykgPT09IDApIHsKCQkJdGhpcy5yZW1vdmVQb2ludGVyTGlzdGVuZXIob2JqLCB0eXBlLCBpZCk7CgkJfSBlbHNlIGlmIChMLkJyb3dzZXIudG91Y2ggJiYgKHR5cGUgPT09ICdkYmxjbGljaycpICYmIHRoaXMucmVtb3ZlRG91YmxlVGFwTGlzdGVuZXIpIHsKCQkJdGhpcy5yZW1vdmVEb3VibGVUYXBMaXN0ZW5lcihvYmosIGlkKTsKCgkJfSBlbHNlIGlmICgncmVtb3ZlRXZlbnRMaXN0ZW5lcicgaW4gb2JqKSB7CgoJCQlpZiAodHlwZSA9PT0gJ21vdXNld2hlZWwnKSB7CgkJCQlvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcignRE9NTW91c2VTY3JvbGwnLCBoYW5kbGVyLCBmYWxzZSk7CgkJCQlvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBoYW5kbGVyLCBmYWxzZSk7CgoJCQl9IGVsc2UgaWYgKCh0eXBlID09PSAnbW91c2VlbnRlcicpIHx8ICh0eXBlID09PSAnbW91c2VsZWF2ZScpKSB7CgkJCQlvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcigodHlwZSA9PT0gJ21vdXNlZW50ZXInID8gJ21vdXNlb3ZlcicgOiAnbW91c2VvdXQnKSwgaGFuZGxlciwgZmFsc2UpOwoJCQl9IGVsc2UgewoJCQkJb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlciwgZmFsc2UpOwoJCQl9CgkJfSBlbHNlIGlmICgnZGV0YWNoRXZlbnQnIGluIG9iaikgewoJCQlvYmouZGV0YWNoRXZlbnQoJ29uJyArIHR5cGUsIGhhbmRsZXIpOwoJCX0KCgkJb2JqW2tleV0gPSBudWxsOwoKCQlyZXR1cm4gdGhpczsKCX0sCgoJc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbiAoZSkgewoKCQlpZiAoZS5zdG9wUHJvcGFnYXRpb24pIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9IGVsc2UgewoJCQllLmNhbmNlbEJ1YmJsZSA9IHRydWU7CgkJfQoJCUwuRG9tRXZlbnQuX3NraXBwZWQoZSk7CgoJCXJldHVybiB0aGlzOwoJfSwKCglkaXNhYmxlU2Nyb2xsUHJvcGFnYXRpb246IGZ1bmN0aW9uIChlbCkgewoJCXZhciBzdG9wID0gTC5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb247CgoJCXJldHVybiBMLkRvbUV2ZW50CgkJCS5vbihlbCwgJ21vdXNld2hlZWwnLCBzdG9wKQoJCQkub24oZWwsICdNb3pNb3VzZVBpeGVsU2Nyb2xsJywgc3RvcCk7Cgl9LAoKCWRpc2FibGVDbGlja1Byb3BhZ2F0aW9uOiBmdW5jdGlvbiAoZWwpIHsKCQl2YXIgc3RvcCA9IEwuRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uOwoKCQlmb3IgKHZhciBpID0gTC5EcmFnZ2FibGUuU1RBUlQubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKCQkJTC5Eb21FdmVudC5vbihlbCwgTC5EcmFnZ2FibGUuU1RBUlRbaV0sIHN0b3ApOwoJCX0KCgkJcmV0dXJuIEwuRG9tRXZlbnQKCQkJLm9uKGVsLCAnY2xpY2snLCBMLkRvbUV2ZW50Ll9mYWtlU3RvcCkKCQkJLm9uKGVsLCAnZGJsY2xpY2snLCBzdG9wKTsKCX0sCgoJcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uIChlKSB7CgoJCWlmIChlLnByZXZlbnREZWZhdWx0KSB7CgkJCWUucHJldmVudERlZmF1bHQoKTsKCQl9IGVsc2UgewoJCQllLnJldHVyblZhbHVlID0gZmFsc2U7CgkJfQoJCXJldHVybiB0aGlzOwoJfSwKCglzdG9wOiBmdW5jdGlvbiAoZSkgewoJCXJldHVybiBMLkRvbUV2ZW50CgkJCS5wcmV2ZW50RGVmYXVsdChlKQoJCQkuc3RvcFByb3BhZ2F0aW9uKGUpOwoJfSwKCglnZXRNb3VzZVBvc2l0aW9uOiBmdW5jdGlvbiAoZSwgY29udGFpbmVyKSB7CgkJaWYgKCFjb250YWluZXIpIHsKCQkJcmV0dXJuIG5ldyBMLlBvaW50KGUuY2xpZW50WCwgZS5jbGllbnRZKTsKCQl9CgoJCXZhciByZWN0ID0gY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoKCQlyZXR1cm4gbmV3IEwuUG9pbnQoCgkJCWUuY2xpZW50WCAtIHJlY3QubGVmdCAtIGNvbnRhaW5lci5jbGllbnRMZWZ0LAoJCQllLmNsaWVudFkgLSByZWN0LnRvcCAtIGNvbnRhaW5lci5jbGllbnRUb3ApOwoJfSwKCglnZXRXaGVlbERlbHRhOiBmdW5jdGlvbiAoZSkgewoKCQl2YXIgZGVsdGEgPSAwOwoKCQlpZiAoZS53aGVlbERlbHRhKSB7CgkJCWRlbHRhID0gZS53aGVlbERlbHRhIC8gMTIwOwoJCX0KCQlpZiAoZS5kZXRhaWwpIHsKCQkJZGVsdGEgPSAtZS5kZXRhaWwgLyAzOwoJCX0KCQlyZXR1cm4gZGVsdGE7Cgl9LAoKCV9za2lwRXZlbnRzOiB7fSwKCglfZmFrZVN0b3A6IGZ1bmN0aW9uIChlKSB7CgkJLy8gZmFrZXMgc3RvcFByb3BhZ2F0aW9uIGJ5IHNldHRpbmcgYSBzcGVjaWFsIGV2ZW50IGZsYWcsIGNoZWNrZWQvcmVzZXQgd2l0aCBMLkRvbUV2ZW50Ll9za2lwcGVkKGUpCgkJTC5Eb21FdmVudC5fc2tpcEV2ZW50c1tlLnR5cGVdID0gdHJ1ZTsKCX0sCgoJX3NraXBwZWQ6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIHNraXBwZWQgPSB0aGlzLl9za2lwRXZlbnRzW2UudHlwZV07CgkJLy8gcmVzZXQgd2hlbiBjaGVja2luZywgYXMgaXQncyBvbmx5IHVzZWQgaW4gbWFwIGNvbnRhaW5lciBhbmQgcHJvcGFnYXRlcyBvdXRzaWRlIG9mIHRoZSBtYXAKCQl0aGlzLl9za2lwRXZlbnRzW2UudHlwZV0gPSBmYWxzZTsKCQlyZXR1cm4gc2tpcHBlZDsKCX0sCgoJLy8gY2hlY2sgaWYgZWxlbWVudCByZWFsbHkgbGVmdC9lbnRlcmVkIHRoZSBldmVudCB0YXJnZXQgKGZvciBtb3VzZWVudGVyL21vdXNlbGVhdmUpCglfY2hlY2tNb3VzZTogZnVuY3Rpb24gKGVsLCBlKSB7CgoJCXZhciByZWxhdGVkID0gZS5yZWxhdGVkVGFyZ2V0OwoKCQlpZiAoIXJlbGF0ZWQpIHsgcmV0dXJuIHRydWU7IH0KCgkJdHJ5IHsKCQkJd2hpbGUgKHJlbGF0ZWQgJiYgKHJlbGF0ZWQgIT09IGVsKSkgewoJCQkJcmVsYXRlZCA9IHJlbGF0ZWQucGFyZW50Tm9kZTsKCQkJfQoJCX0gY2F0Y2ggKGVycikgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCXJldHVybiAocmVsYXRlZCAhPT0gZWwpOwoJfSwKCglfZ2V0RXZlbnQ6IGZ1bmN0aW9uICgpIHsgLy8gZXZpbCBtYWdpYyBmb3IgSUUKCQkvKmpzaGludCBub2FyZzpmYWxzZSAqLwoJCXZhciBlID0gd2luZG93LmV2ZW50OwoJCWlmICghZSkgewoJCQl2YXIgY2FsbGVyID0gYXJndW1lbnRzLmNhbGxlZS5jYWxsZXI7CgkJCXdoaWxlIChjYWxsZXIpIHsKCQkJCWUgPSBjYWxsZXJbJ2FyZ3VtZW50cyddWzBdOwoJCQkJaWYgKGUgJiYgd2luZG93LkV2ZW50ID09PSBlLmNvbnN0cnVjdG9yKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYWxsZXIgPSBjYWxsZXIuY2FsbGVyOwoJCQl9CgkJfQoJCXJldHVybiBlOwoJfSwKCgkvLyB0aGlzIGlzIGEgaG9ycmlibGUgd29ya2Fyb3VuZCBmb3IgYSBidWcgaW4gQW5kcm9pZCB3aGVyZSBhIHNpbmdsZSB0b3VjaCB0cmlnZ2VycyB0d28gY2xpY2sgZXZlbnRzCglfZmlsdGVyQ2xpY2s6IGZ1bmN0aW9uIChlLCBoYW5kbGVyKSB7CgkJdmFyIHRpbWVTdGFtcCA9IChlLnRpbWVTdGFtcCB8fCBlLm9yaWdpbmFsRXZlbnQudGltZVN0YW1wKSwKCQkJZWxhcHNlZCA9IEwuRG9tRXZlbnQuX2xhc3RDbGljayAmJiAodGltZVN0YW1wIC0gTC5Eb21FdmVudC5fbGFzdENsaWNrKTsKCgkJLy8gYXJlIHRoZXkgY2xvc2VyIHRvZ2V0aGVyIHRoYW4gNTAwbXMgeWV0IG1vcmUgdGhhbiAxMDBtcz8KCQkvLyBBbmRyb2lkIHR5cGljYWxseSB0cmlnZ2VycyB0aGVtIH4zMDBtcyBhcGFydCB3aGlsZSBtdWx0aXBsZSBsaXN0ZW5lcnMKCQkvLyBvbiB0aGUgc2FtZSBldmVudCBzaG91bGQgYmUgdHJpZ2dlcmVkIGZhciBmYXN0ZXI7CgkJLy8gb3IgY2hlY2sgaWYgY2xpY2sgaXMgc2ltdWxhdGVkIG9uIHRoZSBlbGVtZW50LCBhbmQgaWYgaXQgaXMsIHJlamVjdCBhbnkgbm9uLXNpbXVsYXRlZCBldmVudHMKCgkJaWYgKChlbGFwc2VkICYmIGVsYXBzZWQgPiAxMDAgJiYgZWxhcHNlZCA8IDUwMCkgfHwgKGUudGFyZ2V0Ll9zaW11bGF0ZWRDbGljayAmJiAhZS5fc2ltdWxhdGVkKSkgewoJCQlMLkRvbUV2ZW50LnN0b3AoZSk7CgkJCXJldHVybjsKCQl9CgkJTC5Eb21FdmVudC5fbGFzdENsaWNrID0gdGltZVN0YW1wOwoKCQlyZXR1cm4gaGFuZGxlcihlKTsKCX0KfTsKCkwuRG9tRXZlbnQub24gPSBMLkRvbUV2ZW50LmFkZExpc3RlbmVyOwpMLkRvbUV2ZW50Lm9mZiA9IEwuRG9tRXZlbnQucmVtb3ZlTGlzdGVuZXI7CgoKLyoKICogTC5EcmFnZ2FibGUgYWxsb3dzIHlvdSB0byBhZGQgZHJhZ2dpbmcgY2FwYWJpbGl0aWVzIHRvIGFueSBlbGVtZW50LiBTdXBwb3J0cyBtb2JpbGUgZGV2aWNlcyB0b28uCiAqLwoKTC5EcmFnZ2FibGUgPSBMLkNsYXNzLmV4dGVuZCh7CglpbmNsdWRlczogTC5NaXhpbi5FdmVudHMsCgoJc3RhdGljczogewoJCVNUQVJUOiBMLkJyb3dzZXIudG91Y2ggPyBbJ3RvdWNoc3RhcnQnLCAnbW91c2Vkb3duJ10gOiBbJ21vdXNlZG93biddLAoJCUVORDogewoJCQltb3VzZWRvd246ICdtb3VzZXVwJywKCQkJdG91Y2hzdGFydDogJ3RvdWNoZW5kJywKCQkJcG9pbnRlcmRvd246ICd0b3VjaGVuZCcsCgkJCU1TUG9pbnRlckRvd246ICd0b3VjaGVuZCcKCQl9LAoJCU1PVkU6IHsKCQkJbW91c2Vkb3duOiAnbW91c2Vtb3ZlJywKCQkJdG91Y2hzdGFydDogJ3RvdWNobW92ZScsCgkJCXBvaW50ZXJkb3duOiAndG91Y2htb3ZlJywKCQkJTVNQb2ludGVyRG93bjogJ3RvdWNobW92ZScKCQl9Cgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChlbGVtZW50LCBkcmFnU3RhcnRUYXJnZXQpIHsKCQl0aGlzLl9lbGVtZW50ID0gZWxlbWVudDsKCQl0aGlzLl9kcmFnU3RhcnRUYXJnZXQgPSBkcmFnU3RhcnRUYXJnZXQgfHwgZWxlbWVudDsKCX0sCgoJZW5hYmxlOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX2VuYWJsZWQpIHsgcmV0dXJuOyB9CgoJCWZvciAodmFyIGkgPSBMLkRyYWdnYWJsZS5TVEFSVC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewoJCQlMLkRvbUV2ZW50Lm9uKHRoaXMuX2RyYWdTdGFydFRhcmdldCwgTC5EcmFnZ2FibGUuU1RBUlRbaV0sIHRoaXMuX29uRG93biwgdGhpcyk7CgkJfQoKCQl0aGlzLl9lbmFibGVkID0gdHJ1ZTsKCX0sCgoJZGlzYWJsZTogZnVuY3Rpb24gKCkgewoJCWlmICghdGhpcy5fZW5hYmxlZCkgeyByZXR1cm47IH0KCgkJZm9yICh2YXIgaSA9IEwuRHJhZ2dhYmxlLlNUQVJULmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CgkJCUwuRG9tRXZlbnQub2ZmKHRoaXMuX2RyYWdTdGFydFRhcmdldCwgTC5EcmFnZ2FibGUuU1RBUlRbaV0sIHRoaXMuX29uRG93biwgdGhpcyk7CgkJfQoKCQl0aGlzLl9lbmFibGVkID0gZmFsc2U7CgkJdGhpcy5fbW92ZWQgPSBmYWxzZTsKCX0sCgoJX29uRG93bjogZnVuY3Rpb24gKGUpIHsKCQl0aGlzLl9tb3ZlZCA9IGZhbHNlOwoKCQlpZiAoZS5zaGlmdEtleSB8fCAoKGUud2hpY2ggIT09IDEpICYmIChlLmJ1dHRvbiAhPT0gMSkgJiYgIWUudG91Y2hlcykpIHsgcmV0dXJuOyB9CgoJCUwuRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKGUpOwoKCQlpZiAoTC5EcmFnZ2FibGUuX2Rpc2FibGVkKSB7IHJldHVybjsgfQoKCQlMLkRvbVV0aWwuZGlzYWJsZUltYWdlRHJhZygpOwoJCUwuRG9tVXRpbC5kaXNhYmxlVGV4dFNlbGVjdGlvbigpOwoKCQlpZiAodGhpcy5fbW92aW5nKSB7IHJldHVybjsgfQoKCQl2YXIgZmlyc3QgPSBlLnRvdWNoZXMgPyBlLnRvdWNoZXNbMF0gOiBlOwoKCQl0aGlzLl9zdGFydFBvaW50ID0gbmV3IEwuUG9pbnQoZmlyc3QuY2xpZW50WCwgZmlyc3QuY2xpZW50WSk7CgkJdGhpcy5fc3RhcnRQb3MgPSB0aGlzLl9uZXdQb3MgPSBMLkRvbVV0aWwuZ2V0UG9zaXRpb24odGhpcy5fZWxlbWVudCk7CgoJCUwuRG9tRXZlbnQKCQkgICAgLm9uKGRvY3VtZW50LCBMLkRyYWdnYWJsZS5NT1ZFW2UudHlwZV0sIHRoaXMuX29uTW92ZSwgdGhpcykKCQkgICAgLm9uKGRvY3VtZW50LCBMLkRyYWdnYWJsZS5FTkRbZS50eXBlXSwgdGhpcy5fb25VcCwgdGhpcyk7Cgl9LAoKCV9vbk1vdmU6IGZ1bmN0aW9uIChlKSB7CgkJaWYgKGUudG91Y2hlcyAmJiBlLnRvdWNoZXMubGVuZ3RoID4gMSkgewoJCQl0aGlzLl9tb3ZlZCA9IHRydWU7CgkJCXJldHVybjsKCQl9CgoJCXZhciBmaXJzdCA9IChlLnRvdWNoZXMgJiYgZS50b3VjaGVzLmxlbmd0aCA9PT0gMSA/IGUudG91Y2hlc1swXSA6IGUpLAoJCSAgICBuZXdQb2ludCA9IG5ldyBMLlBvaW50KGZpcnN0LmNsaWVudFgsIGZpcnN0LmNsaWVudFkpLAoJCSAgICBvZmZzZXQgPSBuZXdQb2ludC5zdWJ0cmFjdCh0aGlzLl9zdGFydFBvaW50KTsKCgkJaWYgKCFvZmZzZXQueCAmJiAhb2Zmc2V0LnkpIHsgcmV0dXJuOyB9CgkJaWYgKEwuQnJvd3Nlci50b3VjaCAmJiBNYXRoLmFicyhvZmZzZXQueCkgKyBNYXRoLmFicyhvZmZzZXQueSkgPCAzKSB7IHJldHVybjsgfQoKCQlMLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KGUpOwoKCQlpZiAoIXRoaXMuX21vdmVkKSB7CgkJCXRoaXMuZmlyZSgnZHJhZ3N0YXJ0Jyk7CgoJCQl0aGlzLl9tb3ZlZCA9IHRydWU7CgkJCXRoaXMuX3N0YXJ0UG9zID0gTC5Eb21VdGlsLmdldFBvc2l0aW9uKHRoaXMuX2VsZW1lbnQpLnN1YnRyYWN0KG9mZnNldCk7CgoJCQlMLkRvbVV0aWwuYWRkQ2xhc3MoZG9jdW1lbnQuYm9keSwgJ2xlYWZsZXQtZHJhZ2dpbmcnKTsKCQkJdGhpcy5fbGFzdFRhcmdldCA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDsKCQkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX2xhc3RUYXJnZXQsICdsZWFmbGV0LWRyYWctdGFyZ2V0Jyk7CgkJfQoKCQl0aGlzLl9uZXdQb3MgPSB0aGlzLl9zdGFydFBvcy5hZGQob2Zmc2V0KTsKCQl0aGlzLl9tb3ZpbmcgPSB0cnVlOwoKCQlMLlV0aWwuY2FuY2VsQW5pbUZyYW1lKHRoaXMuX2FuaW1SZXF1ZXN0KTsKCQl0aGlzLl9hbmltUmVxdWVzdCA9IEwuVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKHRoaXMuX3VwZGF0ZVBvc2l0aW9uLCB0aGlzLCB0cnVlLCB0aGlzLl9kcmFnU3RhcnRUYXJnZXQpOwoJfSwKCglfdXBkYXRlUG9zaXRpb246IGZ1bmN0aW9uICgpIHsKCQl0aGlzLmZpcmUoJ3ByZWRyYWcnKTsKCQlMLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fZWxlbWVudCwgdGhpcy5fbmV3UG9zKTsKCQl0aGlzLmZpcmUoJ2RyYWcnKTsKCX0sCgoJX29uVXA6IGZ1bmN0aW9uICgpIHsKCQlMLkRvbVV0aWwucmVtb3ZlQ2xhc3MoZG9jdW1lbnQuYm9keSwgJ2xlYWZsZXQtZHJhZ2dpbmcnKTsKCgkJaWYgKHRoaXMuX2xhc3RUYXJnZXQpIHsKCQkJTC5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX2xhc3RUYXJnZXQsICdsZWFmbGV0LWRyYWctdGFyZ2V0Jyk7CgkJCXRoaXMuX2xhc3RUYXJnZXQgPSBudWxsOwoJCX0KCgkJZm9yICh2YXIgaSBpbiBMLkRyYWdnYWJsZS5NT1ZFKSB7CgkJCUwuRG9tRXZlbnQKCQkJICAgIC5vZmYoZG9jdW1lbnQsIEwuRHJhZ2dhYmxlLk1PVkVbaV0sIHRoaXMuX29uTW92ZSkKCQkJICAgIC5vZmYoZG9jdW1lbnQsIEwuRHJhZ2dhYmxlLkVORFtpXSwgdGhpcy5fb25VcCk7CgkJfQoKCQlMLkRvbVV0aWwuZW5hYmxlSW1hZ2VEcmFnKCk7CgkJTC5Eb21VdGlsLmVuYWJsZVRleHRTZWxlY3Rpb24oKTsKCgkJaWYgKHRoaXMuX21vdmVkICYmIHRoaXMuX21vdmluZykgewoJCQkvLyBlbnN1cmUgZHJhZyBpcyBub3QgZmlyZWQgYWZ0ZXIgZHJhZ2VuZAoJCQlMLlV0aWwuY2FuY2VsQW5pbUZyYW1lKHRoaXMuX2FuaW1SZXF1ZXN0KTsKCgkJCXRoaXMuZmlyZSgnZHJhZ2VuZCcsIHsKCQkJCWRpc3RhbmNlOiB0aGlzLl9uZXdQb3MuZGlzdGFuY2VUbyh0aGlzLl9zdGFydFBvcykKCQkJfSk7CgkJfQoKCQl0aGlzLl9tb3ZpbmcgPSBmYWxzZTsKCX0KfSk7CgoKLyoKCUwuSGFuZGxlciBpcyBhIGJhc2UgY2xhc3MgZm9yIGhhbmRsZXIgY2xhc3NlcyB0aGF0IGFyZSB1c2VkIGludGVybmFsbHkgdG8gaW5qZWN0CglpbnRlcmFjdGlvbiBmZWF0dXJlcyBsaWtlIGRyYWdnaW5nIHRvIGNsYXNzZXMgbGlrZSBNYXAgYW5kIE1hcmtlci4KKi8KCkwuSGFuZGxlciA9IEwuQ2xhc3MuZXh0ZW5kKHsKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChtYXApIHsKCQl0aGlzLl9tYXAgPSBtYXA7Cgl9LAoKCWVuYWJsZTogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9lbmFibGVkKSB7IHJldHVybjsgfQoKCQl0aGlzLl9lbmFibGVkID0gdHJ1ZTsKCQl0aGlzLmFkZEhvb2tzKCk7Cgl9LAoKCWRpc2FibGU6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIXRoaXMuX2VuYWJsZWQpIHsgcmV0dXJuOyB9CgoJCXRoaXMuX2VuYWJsZWQgPSBmYWxzZTsKCQl0aGlzLnJlbW92ZUhvb2tzKCk7Cgl9LAoKCWVuYWJsZWQ6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gISF0aGlzLl9lbmFibGVkOwoJfQp9KTsKCgovKgogKiBMLkhhbmRsZXIuTWFwRHJhZyBpcyB1c2VkIHRvIG1ha2UgdGhlIG1hcCBkcmFnZ2FibGUgKHdpdGggcGFubmluZyBpbmVydGlhKSwgZW5hYmxlZCBieSBkZWZhdWx0LgogKi8KCkwuTWFwLm1lcmdlT3B0aW9ucyh7CglkcmFnZ2luZzogdHJ1ZSwKCglpbmVydGlhOiAhTC5Ccm93c2VyLmFuZHJvaWQyMywKCWluZXJ0aWFEZWNlbGVyYXRpb246IDM0MDAsIC8vIHB4L3NeMgoJaW5lcnRpYU1heFNwZWVkOiBJbmZpbml0eSwgLy8gcHgvcwoJaW5lcnRpYVRocmVzaG9sZDogTC5Ccm93c2VyLnRvdWNoID8gMzIgOiAxOCwgLy8gbXMKCWVhc2VMaW5lYXJpdHk6IDAuMjUsCgoJLy8gVE9ETyByZWZhY3RvciwgbW92ZSB0byBDUlMKCXdvcmxkQ29weUp1bXA6IGZhbHNlCn0pOwoKTC5NYXAuRHJhZyA9IEwuSGFuZGxlci5leHRlbmQoewoJYWRkSG9va3M6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIXRoaXMuX2RyYWdnYWJsZSkgewoJCQl2YXIgbWFwID0gdGhpcy5fbWFwOwoKCQkJdGhpcy5fZHJhZ2dhYmxlID0gbmV3IEwuRHJhZ2dhYmxlKG1hcC5fbWFwUGFuZSwgbWFwLl9jb250YWluZXIpOwoKCQkJdGhpcy5fZHJhZ2dhYmxlLm9uKHsKCQkJCSdkcmFnc3RhcnQnOiB0aGlzLl9vbkRyYWdTdGFydCwKCQkJCSdkcmFnJzogdGhpcy5fb25EcmFnLAoJCQkJJ2RyYWdlbmQnOiB0aGlzLl9vbkRyYWdFbmQKCQkJfSwgdGhpcyk7CgoJCQlpZiAobWFwLm9wdGlvbnMud29ybGRDb3B5SnVtcCkgewoJCQkJdGhpcy5fZHJhZ2dhYmxlLm9uKCdwcmVkcmFnJywgdGhpcy5fb25QcmVEcmFnLCB0aGlzKTsKCQkJCW1hcC5vbigndmlld3Jlc2V0JywgdGhpcy5fb25WaWV3UmVzZXQsIHRoaXMpOwoKCQkJCW1hcC53aGVuUmVhZHkodGhpcy5fb25WaWV3UmVzZXQsIHRoaXMpOwoJCQl9CgkJfQoJCXRoaXMuX2RyYWdnYWJsZS5lbmFibGUoKTsKCX0sCgoJcmVtb3ZlSG9va3M6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9kcmFnZ2FibGUuZGlzYWJsZSgpOwoJfSwKCgltb3ZlZDogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9kcmFnZ2FibGUgJiYgdGhpcy5fZHJhZ2dhYmxlLl9tb3ZlZDsKCX0sCgoJX29uRHJhZ1N0YXJ0OiBmdW5jdGlvbiAoKSB7CgkJdmFyIG1hcCA9IHRoaXMuX21hcDsKCgkJaWYgKG1hcC5fcGFuQW5pbSkgewoJCQltYXAuX3BhbkFuaW0uc3RvcCgpOwoJCX0KCgkJbWFwCgkJICAgIC5maXJlKCdtb3Zlc3RhcnQnKQoJCSAgICAuZmlyZSgnZHJhZ3N0YXJ0Jyk7CgoJCWlmIChtYXAub3B0aW9ucy5pbmVydGlhKSB7CgkJCXRoaXMuX3Bvc2l0aW9ucyA9IFtdOwoJCQl0aGlzLl90aW1lcyA9IFtdOwoJCX0KCX0sCgoJX29uRHJhZzogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9tYXAub3B0aW9ucy5pbmVydGlhKSB7CgkJCXZhciB0aW1lID0gdGhpcy5fbGFzdFRpbWUgPSArbmV3IERhdGUoKSwKCQkJICAgIHBvcyA9IHRoaXMuX2xhc3RQb3MgPSB0aGlzLl9kcmFnZ2FibGUuX25ld1BvczsKCgkJCXRoaXMuX3Bvc2l0aW9ucy5wdXNoKHBvcyk7CgkJCXRoaXMuX3RpbWVzLnB1c2godGltZSk7CgoJCQlpZiAodGltZSAtIHRoaXMuX3RpbWVzWzBdID4gMjAwKSB7CgkJCQl0aGlzLl9wb3NpdGlvbnMuc2hpZnQoKTsKCQkJCXRoaXMuX3RpbWVzLnNoaWZ0KCk7CgkJCX0KCQl9CgoJCXRoaXMuX21hcAoJCSAgICAuZmlyZSgnbW92ZScpCgkJICAgIC5maXJlKCdkcmFnJyk7Cgl9LAoKCV9vblZpZXdSZXNldDogZnVuY3Rpb24gKCkgewoJCS8vIFRPRE8gZml4IGhhcmRjb2RlZCBFYXJ0aCB2YWx1ZXMKCQl2YXIgcHhDZW50ZXIgPSB0aGlzLl9tYXAuZ2V0U2l6ZSgpLl9kaXZpZGVCeSgyKSwKCQkgICAgcHhXb3JsZENlbnRlciA9IHRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQoWzAsIDBdKTsKCgkJdGhpcy5faW5pdGlhbFdvcmxkT2Zmc2V0ID0gcHhXb3JsZENlbnRlci5zdWJ0cmFjdChweENlbnRlcikueDsKCQl0aGlzLl93b3JsZFdpZHRoID0gdGhpcy5fbWFwLnByb2plY3QoWzAsIDE4MF0pLng7Cgl9LAoKCV9vblByZURyYWc6IGZ1bmN0aW9uICgpIHsKCQkvLyBUT0RPIHJlZmFjdG9yIHRvIGJlIGFibGUgdG8gYWRqdXN0IG1hcCBwYW5lIHBvc2l0aW9uIGFmdGVyIHpvb20KCQl2YXIgd29ybGRXaWR0aCA9IHRoaXMuX3dvcmxkV2lkdGgsCgkJICAgIGhhbGZXaWR0aCA9IE1hdGgucm91bmQod29ybGRXaWR0aCAvIDIpLAoJCSAgICBkeCA9IHRoaXMuX2luaXRpYWxXb3JsZE9mZnNldCwKCQkgICAgeCA9IHRoaXMuX2RyYWdnYWJsZS5fbmV3UG9zLngsCgkJICAgIG5ld1gxID0gKHggLSBoYWxmV2lkdGggKyBkeCkgJSB3b3JsZFdpZHRoICsgaGFsZldpZHRoIC0gZHgsCgkJICAgIG5ld1gyID0gKHggKyBoYWxmV2lkdGggKyBkeCkgJSB3b3JsZFdpZHRoIC0gaGFsZldpZHRoIC0gZHgsCgkJICAgIG5ld1ggPSBNYXRoLmFicyhuZXdYMSArIGR4KSA8IE1hdGguYWJzKG5ld1gyICsgZHgpID8gbmV3WDEgOiBuZXdYMjsKCgkJdGhpcy5fZHJhZ2dhYmxlLl9uZXdQb3MueCA9IG5ld1g7Cgl9LAoKCV9vbkRyYWdFbmQ6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIG1hcCA9IHRoaXMuX21hcCwKCQkgICAgb3B0aW9ucyA9IG1hcC5vcHRpb25zLAoJCSAgICBkZWxheSA9ICtuZXcgRGF0ZSgpIC0gdGhpcy5fbGFzdFRpbWUsCgoJCSAgICBub0luZXJ0aWEgPSAhb3B0aW9ucy5pbmVydGlhIHx8IGRlbGF5ID4gb3B0aW9ucy5pbmVydGlhVGhyZXNob2xkIHx8ICF0aGlzLl9wb3NpdGlvbnNbMF07CgoJCW1hcC5maXJlKCdkcmFnZW5kJywgZSk7CgoJCWlmIChub0luZXJ0aWEpIHsKCQkJbWFwLmZpcmUoJ21vdmVlbmQnKTsKCgkJfSBlbHNlIHsKCgkJCXZhciBkaXJlY3Rpb24gPSB0aGlzLl9sYXN0UG9zLnN1YnRyYWN0KHRoaXMuX3Bvc2l0aW9uc1swXSksCgkJCSAgICBkdXJhdGlvbiA9ICh0aGlzLl9sYXN0VGltZSArIGRlbGF5IC0gdGhpcy5fdGltZXNbMF0pIC8gMTAwMCwKCQkJICAgIGVhc2UgPSBvcHRpb25zLmVhc2VMaW5lYXJpdHksCgoJCQkgICAgc3BlZWRWZWN0b3IgPSBkaXJlY3Rpb24ubXVsdGlwbHlCeShlYXNlIC8gZHVyYXRpb24pLAoJCQkgICAgc3BlZWQgPSBzcGVlZFZlY3Rvci5kaXN0YW5jZVRvKFswLCAwXSksCgoJCQkgICAgbGltaXRlZFNwZWVkID0gTWF0aC5taW4ob3B0aW9ucy5pbmVydGlhTWF4U3BlZWQsIHNwZWVkKSwKCQkJICAgIGxpbWl0ZWRTcGVlZFZlY3RvciA9IHNwZWVkVmVjdG9yLm11bHRpcGx5QnkobGltaXRlZFNwZWVkIC8gc3BlZWQpLAoKCQkJICAgIGRlY2VsZXJhdGlvbkR1cmF0aW9uID0gbGltaXRlZFNwZWVkIC8gKG9wdGlvbnMuaW5lcnRpYURlY2VsZXJhdGlvbiAqIGVhc2UpLAoJCQkgICAgb2Zmc2V0ID0gbGltaXRlZFNwZWVkVmVjdG9yLm11bHRpcGx5QnkoLWRlY2VsZXJhdGlvbkR1cmF0aW9uIC8gMikucm91bmQoKTsKCgkJCWlmICghb2Zmc2V0LnggfHwgIW9mZnNldC55KSB7CgkJCQltYXAuZmlyZSgnbW92ZWVuZCcpOwoKCQkJfSBlbHNlIHsKCQkJCW9mZnNldCA9IG1hcC5fbGltaXRPZmZzZXQob2Zmc2V0LCBtYXAub3B0aW9ucy5tYXhCb3VuZHMpOwoKCQkJCUwuVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uICgpIHsKCQkJCQltYXAucGFuQnkob2Zmc2V0LCB7CgkJCQkJCWR1cmF0aW9uOiBkZWNlbGVyYXRpb25EdXJhdGlvbiwKCQkJCQkJZWFzZUxpbmVhcml0eTogZWFzZSwKCQkJCQkJbm9Nb3ZlU3RhcnQ6IHRydWUKCQkJCQl9KTsKCQkJCX0pOwoJCQl9CgkJfQoJfQp9KTsKCkwuTWFwLmFkZEluaXRIb29rKCdhZGRIYW5kbGVyJywgJ2RyYWdnaW5nJywgTC5NYXAuRHJhZyk7CgoKLyoKICogTC5IYW5kbGVyLkRvdWJsZUNsaWNrWm9vbSBpcyB1c2VkIHRvIGhhbmRsZSBkb3VibGUtY2xpY2sgem9vbSBvbiB0aGUgbWFwLCBlbmFibGVkIGJ5IGRlZmF1bHQuCiAqLwoKTC5NYXAubWVyZ2VPcHRpb25zKHsKCWRvdWJsZUNsaWNrWm9vbTogdHJ1ZQp9KTsKCkwuTWFwLkRvdWJsZUNsaWNrWm9vbSA9IEwuSGFuZGxlci5leHRlbmQoewoJYWRkSG9va3M6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9tYXAub24oJ2RibGNsaWNrJywgdGhpcy5fb25Eb3VibGVDbGljaywgdGhpcyk7Cgl9LAoKCXJlbW92ZUhvb2tzOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fbWFwLm9mZignZGJsY2xpY2snLCB0aGlzLl9vbkRvdWJsZUNsaWNrLCB0aGlzKTsKCX0sCgoJX29uRG91YmxlQ2xpY2s6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIG1hcCA9IHRoaXMuX21hcCwKCQkgICAgem9vbSA9IG1hcC5nZXRab29tKCkgKyAoZS5vcmlnaW5hbEV2ZW50LnNoaWZ0S2V5ID8gLTEgOiAxKTsKCgkJaWYgKG1hcC5vcHRpb25zLmRvdWJsZUNsaWNrWm9vbSA9PT0gJ2NlbnRlcicpIHsKCQkJbWFwLnNldFpvb20oem9vbSk7CgkJfSBlbHNlIHsKCQkJbWFwLnNldFpvb21Bcm91bmQoZS5jb250YWluZXJQb2ludCwgem9vbSk7CgkJfQoJfQp9KTsKCkwuTWFwLmFkZEluaXRIb29rKCdhZGRIYW5kbGVyJywgJ2RvdWJsZUNsaWNrWm9vbScsIEwuTWFwLkRvdWJsZUNsaWNrWm9vbSk7CgoKLyoKICogTC5IYW5kbGVyLlNjcm9sbFdoZWVsWm9vbSBpcyB1c2VkIGJ5IEwuTWFwIHRvIGVuYWJsZSBtb3VzZSBzY3JvbGwgd2hlZWwgem9vbSBvbiB0aGUgbWFwLgogKi8KCkwuTWFwLm1lcmdlT3B0aW9ucyh7CglzY3JvbGxXaGVlbFpvb206IHRydWUKfSk7CgpMLk1hcC5TY3JvbGxXaGVlbFpvb20gPSBMLkhhbmRsZXIuZXh0ZW5kKHsKCWFkZEhvb2tzOiBmdW5jdGlvbiAoKSB7CgkJTC5Eb21FdmVudC5vbih0aGlzLl9tYXAuX2NvbnRhaW5lciwgJ21vdXNld2hlZWwnLCB0aGlzLl9vbldoZWVsU2Nyb2xsLCB0aGlzKTsKCQlMLkRvbUV2ZW50Lm9uKHRoaXMuX21hcC5fY29udGFpbmVyLCAnTW96TW91c2VQaXhlbFNjcm9sbCcsIEwuRG9tRXZlbnQucHJldmVudERlZmF1bHQpOwoJCXRoaXMuX2RlbHRhID0gMDsKCX0sCgoJcmVtb3ZlSG9va3M6IGZ1bmN0aW9uICgpIHsKCQlMLkRvbUV2ZW50Lm9mZih0aGlzLl9tYXAuX2NvbnRhaW5lciwgJ21vdXNld2hlZWwnLCB0aGlzLl9vbldoZWVsU2Nyb2xsKTsKCQlMLkRvbUV2ZW50Lm9mZih0aGlzLl9tYXAuX2NvbnRhaW5lciwgJ01vek1vdXNlUGl4ZWxTY3JvbGwnLCBMLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KTsKCX0sCgoJX29uV2hlZWxTY3JvbGw6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIGRlbHRhID0gTC5Eb21FdmVudC5nZXRXaGVlbERlbHRhKGUpOwoKCQl0aGlzLl9kZWx0YSArPSBkZWx0YTsKCQl0aGlzLl9sYXN0TW91c2VQb3MgPSB0aGlzLl9tYXAubW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQoZSk7CgoJCWlmICghdGhpcy5fc3RhcnRUaW1lKSB7CgkJCXRoaXMuX3N0YXJ0VGltZSA9ICtuZXcgRGF0ZSgpOwoJCX0KCgkJdmFyIGxlZnQgPSBNYXRoLm1heCg0MCAtICgrbmV3IERhdGUoKSAtIHRoaXMuX3N0YXJ0VGltZSksIDApOwoKCQljbGVhclRpbWVvdXQodGhpcy5fdGltZXIpOwoJCXRoaXMuX3RpbWVyID0gc2V0VGltZW91dChMLmJpbmQodGhpcy5fcGVyZm9ybVpvb20sIHRoaXMpLCBsZWZ0KTsKCgkJTC5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdChlKTsKCQlMLkRvbUV2ZW50LnN0b3BQcm9wYWdhdGlvbihlKTsKCX0sCgoJX3BlcmZvcm1ab29tOiBmdW5jdGlvbiAoKSB7CgkJdmFyIG1hcCA9IHRoaXMuX21hcCwKCQkgICAgZGVsdGEgPSB0aGlzLl9kZWx0YSwKCQkgICAgem9vbSA9IG1hcC5nZXRab29tKCk7CgoJCWRlbHRhID0gZGVsdGEgPiAwID8gTWF0aC5jZWlsKGRlbHRhKSA6IE1hdGguZmxvb3IoZGVsdGEpOwoJCWRlbHRhID0gTWF0aC5tYXgoTWF0aC5taW4oZGVsdGEsIDQpLCAtNCk7CgkJZGVsdGEgPSBtYXAuX2xpbWl0Wm9vbSh6b29tICsgZGVsdGEpIC0gem9vbTsKCgkJdGhpcy5fZGVsdGEgPSAwOwoJCXRoaXMuX3N0YXJ0VGltZSA9IG51bGw7CgoJCWlmICghZGVsdGEpIHsgcmV0dXJuOyB9CgoJCWlmIChtYXAub3B0aW9ucy5zY3JvbGxXaGVlbFpvb20gPT09ICdjZW50ZXInKSB7CgkJCW1hcC5zZXRab29tKHpvb20gKyBkZWx0YSk7CgkJfSBlbHNlIHsKCQkJbWFwLnNldFpvb21Bcm91bmQodGhpcy5fbGFzdE1vdXNlUG9zLCB6b29tICsgZGVsdGEpOwoJCX0KCX0KfSk7CgpMLk1hcC5hZGRJbml0SG9vaygnYWRkSGFuZGxlcicsICdzY3JvbGxXaGVlbFpvb20nLCBMLk1hcC5TY3JvbGxXaGVlbFpvb20pOwoKCi8qCiAqIEV4dGVuZHMgdGhlIGV2ZW50IGhhbmRsaW5nIGNvZGUgd2l0aCBkb3VibGUgdGFwIHN1cHBvcnQgZm9yIG1vYmlsZSBicm93c2Vycy4KICovCgpMLmV4dGVuZChMLkRvbUV2ZW50LCB7CgoJX3RvdWNoc3RhcnQ6IEwuQnJvd3Nlci5tc1BvaW50ZXIgPyAnTVNQb2ludGVyRG93bicgOiBMLkJyb3dzZXIucG9pbnRlciA/ICdwb2ludGVyZG93bicgOiAndG91Y2hzdGFydCcsCglfdG91Y2hlbmQ6IEwuQnJvd3Nlci5tc1BvaW50ZXIgPyAnTVNQb2ludGVyVXAnIDogTC5Ccm93c2VyLnBvaW50ZXIgPyAncG9pbnRlcnVwJyA6ICd0b3VjaGVuZCcsCgoJLy8gaW5zcGlyZWQgYnkgWmVwdG8gdG91Y2ggY29kZSBieSBUaG9tYXMgRnVjaHMKCWFkZERvdWJsZVRhcExpc3RlbmVyOiBmdW5jdGlvbiAob2JqLCBoYW5kbGVyLCBpZCkgewoJCXZhciBsYXN0LAoJCSAgICBkb3VibGVUYXAgPSBmYWxzZSwKCQkgICAgZGVsYXkgPSAyNTAsCgkJICAgIHRvdWNoLAoJCSAgICBwcmUgPSAnX2xlYWZsZXRfJywKCQkgICAgdG91Y2hzdGFydCA9IHRoaXMuX3RvdWNoc3RhcnQsCgkJICAgIHRvdWNoZW5kID0gdGhpcy5fdG91Y2hlbmQsCgkJICAgIHRyYWNrZWRUb3VjaGVzID0gW107CgoJCWZ1bmN0aW9uIG9uVG91Y2hTdGFydChlKSB7CgkJCXZhciBjb3VudDsKCgkJCWlmIChMLkJyb3dzZXIucG9pbnRlcikgewoJCQkJdHJhY2tlZFRvdWNoZXMucHVzaChlLnBvaW50ZXJJZCk7CgkJCQljb3VudCA9IHRyYWNrZWRUb3VjaGVzLmxlbmd0aDsKCQkJfSBlbHNlIHsKCQkJCWNvdW50ID0gZS50b3VjaGVzLmxlbmd0aDsKCQkJfQoJCQlpZiAoY291bnQgPiAxKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCXZhciBub3cgPSBEYXRlLm5vdygpLAoJCQkJZGVsdGEgPSBub3cgLSAobGFzdCB8fCBub3cpOwoKCQkJdG91Y2ggPSBlLnRvdWNoZXMgPyBlLnRvdWNoZXNbMF0gOiBlOwoJCQlkb3VibGVUYXAgPSAoZGVsdGEgPiAwICYmIGRlbHRhIDw9IGRlbGF5KTsKCQkJbGFzdCA9IG5vdzsKCQl9CgoJCWZ1bmN0aW9uIG9uVG91Y2hFbmQoZSkgewoJCQlpZiAoTC5Ccm93c2VyLnBvaW50ZXIpIHsKCQkJCXZhciBpZHggPSB0cmFja2VkVG91Y2hlcy5pbmRleE9mKGUucG9pbnRlcklkKTsKCQkJCWlmIChpZHggPT09IC0xKSB7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJdHJhY2tlZFRvdWNoZXMuc3BsaWNlKGlkeCwgMSk7CgkJCX0KCgkJCWlmIChkb3VibGVUYXApIHsKCQkJCWlmIChMLkJyb3dzZXIucG9pbnRlcikgewoJCQkJCS8vIHdvcmsgYXJvdW5kIC50eXBlIGJlaW5nIHJlYWRvbmx5IHdpdGggTVNQb2ludGVyKiBldmVudHMKCQkJCQl2YXIgbmV3VG91Y2ggPSB7IH0sCgkJCQkJCXByb3A7CgoJCQkJCS8vIGpzaGludCBmb3JpbjpmYWxzZQoJCQkJCWZvciAodmFyIGkgaW4gdG91Y2gpIHsKCQkJCQkJcHJvcCA9IHRvdWNoW2ldOwoJCQkJCQlpZiAodHlwZW9mIHByb3AgPT09ICdmdW5jdGlvbicpIHsKCQkJCQkJCW5ld1RvdWNoW2ldID0gcHJvcC5iaW5kKHRvdWNoKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCW5ld1RvdWNoW2ldID0gcHJvcDsKCQkJCQkJfQoJCQkJCX0KCQkJCQl0b3VjaCA9IG5ld1RvdWNoOwoJCQkJfQoJCQkJdG91Y2gudHlwZSA9ICdkYmxjbGljayc7CgkJCQloYW5kbGVyKHRvdWNoKTsKCQkJCWxhc3QgPSBudWxsOwoJCQl9CgkJfQoJCW9ialtwcmUgKyB0b3VjaHN0YXJ0ICsgaWRdID0gb25Ub3VjaFN0YXJ0OwoJCW9ialtwcmUgKyB0b3VjaGVuZCArIGlkXSA9IG9uVG91Y2hFbmQ7CgoJCS8vIG9uIHBvaW50ZXIgd2UgbmVlZCB0byBsaXN0ZW4gb24gdGhlIGRvY3VtZW50LCBvdGhlcndpc2UgYSBkcmFnIHN0YXJ0aW5nIG9uIHRoZSBtYXAgYW5kIG1vdmluZyBvZmYgc2NyZWVuCgkJLy8gd2lsbCBub3QgY29tZSB0aHJvdWdoIHRvIHVzLCBzbyB3ZSB3aWxsIGxvc2UgdHJhY2sgb2YgaG93IG1hbnkgdG91Y2hlcyBhcmUgb25nb2luZwoJCXZhciBlbmRFbGVtZW50ID0gTC5Ccm93c2VyLnBvaW50ZXIgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgOiBvYmo7CgoJCW9iai5hZGRFdmVudExpc3RlbmVyKHRvdWNoc3RhcnQsIG9uVG91Y2hTdGFydCwgZmFsc2UpOwoJCWVuZEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih0b3VjaGVuZCwgb25Ub3VjaEVuZCwgZmFsc2UpOwoKCQlpZiAoTC5Ccm93c2VyLnBvaW50ZXIpIHsKCQkJZW5kRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKEwuRG9tRXZlbnQuUE9JTlRFUl9DQU5DRUwsIG9uVG91Y2hFbmQsIGZhbHNlKTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCglyZW1vdmVEb3VibGVUYXBMaXN0ZW5lcjogZnVuY3Rpb24gKG9iaiwgaWQpIHsKCQl2YXIgcHJlID0gJ19sZWFmbGV0Xyc7CgoJCW9iai5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuX3RvdWNoc3RhcnQsIG9ialtwcmUgKyB0aGlzLl90b3VjaHN0YXJ0ICsgaWRdLCBmYWxzZSk7CgkJKEwuQnJvd3Nlci5wb2ludGVyID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50IDogb2JqKS5yZW1vdmVFdmVudExpc3RlbmVyKAoJCSAgICAgICAgdGhpcy5fdG91Y2hlbmQsIG9ialtwcmUgKyB0aGlzLl90b3VjaGVuZCArIGlkXSwgZmFsc2UpOwoKCQlpZiAoTC5Ccm93c2VyLnBvaW50ZXIpIHsKCQkJZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoTC5Eb21FdmVudC5QT0lOVEVSX0NBTkNFTCwgb2JqW3ByZSArIHRoaXMuX3RvdWNoZW5kICsgaWRdLAoJCQkJZmFsc2UpOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9Cn0pOwoKCi8qCiAqIEV4dGVuZHMgTC5Eb21FdmVudCB0byBwcm92aWRlIHRvdWNoIHN1cHBvcnQgZm9yIEludGVybmV0IEV4cGxvcmVyIGFuZCBXaW5kb3dzLWJhc2VkIGRldmljZXMuCiAqLwoKTC5leHRlbmQoTC5Eb21FdmVudCwgewoKCS8vc3RhdGljCglQT0lOVEVSX0RPV046IEwuQnJvd3Nlci5tc1BvaW50ZXIgPyAnTVNQb2ludGVyRG93bicgOiAncG9pbnRlcmRvd24nLAoJUE9JTlRFUl9NT1ZFOiBMLkJyb3dzZXIubXNQb2ludGVyID8gJ01TUG9pbnRlck1vdmUnIDogJ3BvaW50ZXJtb3ZlJywKCVBPSU5URVJfVVA6IEwuQnJvd3Nlci5tc1BvaW50ZXIgPyAnTVNQb2ludGVyVXAnIDogJ3BvaW50ZXJ1cCcsCglQT0lOVEVSX0NBTkNFTDogTC5Ccm93c2VyLm1zUG9pbnRlciA/ICdNU1BvaW50ZXJDYW5jZWwnIDogJ3BvaW50ZXJjYW5jZWwnLAoKCV9wb2ludGVyczogW10sCglfcG9pbnRlckRvY3VtZW50TGlzdGVuZXI6IGZhbHNlLAoKCS8vIFByb3ZpZGVzIGEgdG91Y2ggZXZlbnRzIHdyYXBwZXIgZm9yIChtcylwb2ludGVyIGV2ZW50cy4KCS8vIEJhc2VkIG9uIGNoYW5nZXMgYnkgdmVwcm96YSBodHRwczovL2dpdGh1Yi5jb20vQ2xvdWRNYWRlL0xlYWZsZXQvcHVsbC8xMDE5CgkvL3JlZiBodHRwOi8vd3d3LnczLm9yZy9UUi9wb2ludGVyZXZlbnRzLyBodHRwczovL3d3dy53My5vcmcvQnVncy9QdWJsaWMvc2hvd19idWcuY2dpP2lkPTIyODkwCgoJYWRkUG9pbnRlckxpc3RlbmVyOiBmdW5jdGlvbiAob2JqLCB0eXBlLCBoYW5kbGVyLCBpZCkgewoKCQlzd2l0Y2ggKHR5cGUpIHsKCQljYXNlICd0b3VjaHN0YXJ0JzoKCQkJcmV0dXJuIHRoaXMuYWRkUG9pbnRlckxpc3RlbmVyU3RhcnQob2JqLCB0eXBlLCBoYW5kbGVyLCBpZCk7CgkJY2FzZSAndG91Y2hlbmQnOgoJCQlyZXR1cm4gdGhpcy5hZGRQb2ludGVyTGlzdGVuZXJFbmQob2JqLCB0eXBlLCBoYW5kbGVyLCBpZCk7CgkJY2FzZSAndG91Y2htb3ZlJzoKCQkJcmV0dXJuIHRoaXMuYWRkUG9pbnRlckxpc3RlbmVyTW92ZShvYmosIHR5cGUsIGhhbmRsZXIsIGlkKTsKCQlkZWZhdWx0OgoJCQl0aHJvdyAnVW5rbm93biB0b3VjaCBldmVudCB0eXBlJzsKCQl9Cgl9LAoKCWFkZFBvaW50ZXJMaXN0ZW5lclN0YXJ0OiBmdW5jdGlvbiAob2JqLCB0eXBlLCBoYW5kbGVyLCBpZCkgewoJCXZhciBwcmUgPSAnX2xlYWZsZXRfJywKCQkgICAgcG9pbnRlcnMgPSB0aGlzLl9wb2ludGVyczsKCgkJdmFyIGNiID0gZnVuY3Rpb24gKGUpIHsKCgkJCUwuRG9tRXZlbnQucHJldmVudERlZmF1bHQoZSk7CgoJCQl2YXIgYWxyZWFkeUluQXJyYXkgPSBmYWxzZTsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBwb2ludGVycy5sZW5ndGg7IGkrKykgewoJCQkJaWYgKHBvaW50ZXJzW2ldLnBvaW50ZXJJZCA9PT0gZS5wb2ludGVySWQpIHsKCQkJCQlhbHJlYWR5SW5BcnJheSA9IHRydWU7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJaWYgKCFhbHJlYWR5SW5BcnJheSkgewoJCQkJcG9pbnRlcnMucHVzaChlKTsKCQkJfQoKCQkJZS50b3VjaGVzID0gcG9pbnRlcnMuc2xpY2UoKTsKCQkJZS5jaGFuZ2VkVG91Y2hlcyA9IFtlXTsKCgkJCWhhbmRsZXIoZSk7CgkJfTsKCgkJb2JqW3ByZSArICd0b3VjaHN0YXJ0JyArIGlkXSA9IGNiOwoJCW9iai5hZGRFdmVudExpc3RlbmVyKHRoaXMuUE9JTlRFUl9ET1dOLCBjYiwgZmFsc2UpOwoKCQkvLyBuZWVkIHRvIGFsc28gbGlzdGVuIGZvciBlbmQgZXZlbnRzIHRvIGtlZXAgdGhlIF9wb2ludGVycyBsaXN0IGFjY3VyYXRlCgkJLy8gdGhpcyBuZWVkcyB0byBiZSBvbiB0aGUgYm9keSBhbmQgbmV2ZXIgZ28gYXdheQoJCWlmICghdGhpcy5fcG9pbnRlckRvY3VtZW50TGlzdGVuZXIpIHsKCQkJdmFyIGludGVybmFsQ2IgPSBmdW5jdGlvbiAoZSkgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBwb2ludGVycy5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChwb2ludGVyc1tpXS5wb2ludGVySWQgPT09IGUucG9pbnRlcklkKSB7CgkJCQkJCXBvaW50ZXJzLnNwbGljZShpLCAxKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9OwoJCQkvL1dlIGxpc3RlbiBvbiB0aGUgZG9jdW1lbnRFbGVtZW50IGFzIGFueSBkcmFncyB0aGF0IGVuZCBieSBtb3ZpbmcgdGhlIHRvdWNoIG9mZiB0aGUgc2NyZWVuIGdldCBmaXJlZCB0aGVyZQoJCQlkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLlBPSU5URVJfVVAsIGludGVybmFsQ2IsIGZhbHNlKTsKCQkJZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIodGhpcy5QT0lOVEVSX0NBTkNFTCwgaW50ZXJuYWxDYiwgZmFsc2UpOwoKCQkJdGhpcy5fcG9pbnRlckRvY3VtZW50TGlzdGVuZXIgPSB0cnVlOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWFkZFBvaW50ZXJMaXN0ZW5lck1vdmU6IGZ1bmN0aW9uIChvYmosIHR5cGUsIGhhbmRsZXIsIGlkKSB7CgkJdmFyIHByZSA9ICdfbGVhZmxldF8nLAoJCSAgICB0b3VjaGVzID0gdGhpcy5fcG9pbnRlcnM7CgoJCWZ1bmN0aW9uIGNiKGUpIHsKCgkJCS8vIGRvbid0IGZpcmUgdG91Y2ggbW92ZXMgd2hlbiBtb3VzZSBpc24ndCBkb3duCgkJCWlmICgoZS5wb2ludGVyVHlwZSA9PT0gZS5NU1BPSU5URVJfVFlQRV9NT1VTRSB8fCBlLnBvaW50ZXJUeXBlID09PSAnbW91c2UnKSAmJiBlLmJ1dHRvbnMgPT09IDApIHsgcmV0dXJuOyB9CgoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRvdWNoZXMubGVuZ3RoOyBpKyspIHsKCQkJCWlmICh0b3VjaGVzW2ldLnBvaW50ZXJJZCA9PT0gZS5wb2ludGVySWQpIHsKCQkJCQl0b3VjaGVzW2ldID0gZTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoKCQkJZS50b3VjaGVzID0gdG91Y2hlcy5zbGljZSgpOwoJCQllLmNoYW5nZWRUb3VjaGVzID0gW2VdOwoKCQkJaGFuZGxlcihlKTsKCQl9CgoJCW9ialtwcmUgKyAndG91Y2htb3ZlJyArIGlkXSA9IGNiOwoJCW9iai5hZGRFdmVudExpc3RlbmVyKHRoaXMuUE9JTlRFUl9NT1ZFLCBjYiwgZmFsc2UpOwoKCQlyZXR1cm4gdGhpczsKCX0sCgoJYWRkUG9pbnRlckxpc3RlbmVyRW5kOiBmdW5jdGlvbiAob2JqLCB0eXBlLCBoYW5kbGVyLCBpZCkgewoJCXZhciBwcmUgPSAnX2xlYWZsZXRfJywKCQkgICAgdG91Y2hlcyA9IHRoaXMuX3BvaW50ZXJzOwoKCQl2YXIgY2IgPSBmdW5jdGlvbiAoZSkgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRvdWNoZXMubGVuZ3RoOyBpKyspIHsKCQkJCWlmICh0b3VjaGVzW2ldLnBvaW50ZXJJZCA9PT0gZS5wb2ludGVySWQpIHsKCQkJCQl0b3VjaGVzLnNwbGljZShpLCAxKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoKCQkJZS50b3VjaGVzID0gdG91Y2hlcy5zbGljZSgpOwoJCQllLmNoYW5nZWRUb3VjaGVzID0gW2VdOwoKCQkJaGFuZGxlcihlKTsKCQl9OwoKCQlvYmpbcHJlICsgJ3RvdWNoZW5kJyArIGlkXSA9IGNiOwoJCW9iai5hZGRFdmVudExpc3RlbmVyKHRoaXMuUE9JTlRFUl9VUCwgY2IsIGZhbHNlKTsKCQlvYmouYWRkRXZlbnRMaXN0ZW5lcih0aGlzLlBPSU5URVJfQ0FOQ0VMLCBjYiwgZmFsc2UpOwoKCQlyZXR1cm4gdGhpczsKCX0sCgoJcmVtb3ZlUG9pbnRlckxpc3RlbmVyOiBmdW5jdGlvbiAob2JqLCB0eXBlLCBpZCkgewoJCXZhciBwcmUgPSAnX2xlYWZsZXRfJywKCQkgICAgY2IgPSBvYmpbcHJlICsgdHlwZSArIGlkXTsKCgkJc3dpdGNoICh0eXBlKSB7CgkJY2FzZSAndG91Y2hzdGFydCc6CgkJCW9iai5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuUE9JTlRFUl9ET1dOLCBjYiwgZmFsc2UpOwoJCQlicmVhazsKCQljYXNlICd0b3VjaG1vdmUnOgoJCQlvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLlBPSU5URVJfTU9WRSwgY2IsIGZhbHNlKTsKCQkJYnJlYWs7CgkJY2FzZSAndG91Y2hlbmQnOgoJCQlvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLlBPSU5URVJfVVAsIGNiLCBmYWxzZSk7CgkJCW9iai5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuUE9JTlRFUl9DQU5DRUwsIGNiLCBmYWxzZSk7CgkJCWJyZWFrOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9Cn0pOwoKCi8qCiAqIEwuSGFuZGxlci5Ub3VjaFpvb20gaXMgdXNlZCBieSBMLk1hcCB0byBhZGQgcGluY2ggem9vbSBvbiBzdXBwb3J0ZWQgbW9iaWxlIGJyb3dzZXJzLgogKi8KCkwuTWFwLm1lcmdlT3B0aW9ucyh7Cgl0b3VjaFpvb206IEwuQnJvd3Nlci50b3VjaCAmJiAhTC5Ccm93c2VyLmFuZHJvaWQyMywKCWJvdW5jZUF0Wm9vbUxpbWl0czogdHJ1ZQp9KTsKCkwuTWFwLlRvdWNoWm9vbSA9IEwuSGFuZGxlci5leHRlbmQoewoJYWRkSG9va3M6IGZ1bmN0aW9uICgpIHsKCQlMLkRvbUV2ZW50Lm9uKHRoaXMuX21hcC5fY29udGFpbmVyLCAndG91Y2hzdGFydCcsIHRoaXMuX29uVG91Y2hTdGFydCwgdGhpcyk7Cgl9LAoKCXJlbW92ZUhvb2tzOiBmdW5jdGlvbiAoKSB7CgkJTC5Eb21FdmVudC5vZmYodGhpcy5fbWFwLl9jb250YWluZXIsICd0b3VjaHN0YXJ0JywgdGhpcy5fb25Ub3VjaFN0YXJ0LCB0aGlzKTsKCX0sCgoJX29uVG91Y2hTdGFydDogZnVuY3Rpb24gKGUpIHsKCQl2YXIgbWFwID0gdGhpcy5fbWFwOwoKCQlpZiAoIWUudG91Y2hlcyB8fCBlLnRvdWNoZXMubGVuZ3RoICE9PSAyIHx8IG1hcC5fYW5pbWF0aW5nWm9vbSB8fCB0aGlzLl96b29taW5nKSB7IHJldHVybjsgfQoKCQl2YXIgcDEgPSBtYXAubW91c2VFdmVudFRvTGF5ZXJQb2ludChlLnRvdWNoZXNbMF0pLAoJCSAgICBwMiA9IG1hcC5tb3VzZUV2ZW50VG9MYXllclBvaW50KGUudG91Y2hlc1sxXSksCgkJICAgIHZpZXdDZW50ZXIgPSBtYXAuX2dldENlbnRlckxheWVyUG9pbnQoKTsKCgkJdGhpcy5fc3RhcnRDZW50ZXIgPSBwMS5hZGQocDIpLl9kaXZpZGVCeSgyKTsKCQl0aGlzLl9zdGFydERpc3QgPSBwMS5kaXN0YW5jZVRvKHAyKTsKCgkJdGhpcy5fbW92ZWQgPSBmYWxzZTsKCQl0aGlzLl96b29taW5nID0gdHJ1ZTsKCgkJdGhpcy5fY2VudGVyT2Zmc2V0ID0gdmlld0NlbnRlci5zdWJ0cmFjdCh0aGlzLl9zdGFydENlbnRlcik7CgoJCWlmIChtYXAuX3BhbkFuaW0pIHsKCQkJbWFwLl9wYW5BbmltLnN0b3AoKTsKCQl9CgoJCUwuRG9tRXZlbnQKCQkgICAgLm9uKGRvY3VtZW50LCAndG91Y2htb3ZlJywgdGhpcy5fb25Ub3VjaE1vdmUsIHRoaXMpCgkJICAgIC5vbihkb2N1bWVudCwgJ3RvdWNoZW5kJywgdGhpcy5fb25Ub3VjaEVuZCwgdGhpcyk7CgoJCUwuRG9tRXZlbnQucHJldmVudERlZmF1bHQoZSk7Cgl9LAoKCV9vblRvdWNoTW92ZTogZnVuY3Rpb24gKGUpIHsKCQl2YXIgbWFwID0gdGhpcy5fbWFwOwoKCQlpZiAoIWUudG91Y2hlcyB8fCBlLnRvdWNoZXMubGVuZ3RoICE9PSAyIHx8ICF0aGlzLl96b29taW5nKSB7IHJldHVybjsgfQoKCQl2YXIgcDEgPSBtYXAubW91c2VFdmVudFRvTGF5ZXJQb2ludChlLnRvdWNoZXNbMF0pLAoJCSAgICBwMiA9IG1hcC5tb3VzZUV2ZW50VG9MYXllclBvaW50KGUudG91Y2hlc1sxXSk7CgoJCXRoaXMuX3NjYWxlID0gcDEuZGlzdGFuY2VUbyhwMikgLyB0aGlzLl9zdGFydERpc3Q7CgkJdGhpcy5fZGVsdGEgPSBwMS5fYWRkKHAyKS5fZGl2aWRlQnkoMikuX3N1YnRyYWN0KHRoaXMuX3N0YXJ0Q2VudGVyKTsKCgkJaWYgKHRoaXMuX3NjYWxlID09PSAxKSB7IHJldHVybjsgfQoKCQlpZiAoIW1hcC5vcHRpb25zLmJvdW5jZUF0Wm9vbUxpbWl0cykgewoJCQlpZiAoKG1hcC5nZXRab29tKCkgPT09IG1hcC5nZXRNaW5ab29tKCkgJiYgdGhpcy5fc2NhbGUgPCAxKSB8fAoJCQkgICAgKG1hcC5nZXRab29tKCkgPT09IG1hcC5nZXRNYXhab29tKCkgJiYgdGhpcy5fc2NhbGUgPiAxKSkgeyByZXR1cm47IH0KCQl9CgoJCWlmICghdGhpcy5fbW92ZWQpIHsKCQkJTC5Eb21VdGlsLmFkZENsYXNzKG1hcC5fbWFwUGFuZSwgJ2xlYWZsZXQtdG91Y2hpbmcnKTsKCgkJCW1hcAoJCQkgICAgLmZpcmUoJ21vdmVzdGFydCcpCgkJCSAgICAuZmlyZSgnem9vbXN0YXJ0Jyk7CgoJCQl0aGlzLl9tb3ZlZCA9IHRydWU7CgkJfQoKCQlMLlV0aWwuY2FuY2VsQW5pbUZyYW1lKHRoaXMuX2FuaW1SZXF1ZXN0KTsKCQl0aGlzLl9hbmltUmVxdWVzdCA9IEwuVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKAoJCSAgICAgICAgdGhpcy5fdXBkYXRlT25Nb3ZlLCB0aGlzLCB0cnVlLCB0aGlzLl9tYXAuX2NvbnRhaW5lcik7CgoJCUwuRG9tRXZlbnQucHJldmVudERlZmF1bHQoZSk7Cgl9LAoKCV91cGRhdGVPbk1vdmU6IGZ1bmN0aW9uICgpIHsKCQl2YXIgbWFwID0gdGhpcy5fbWFwLAoJCSAgICBvcmlnaW4gPSB0aGlzLl9nZXRTY2FsZU9yaWdpbigpLAoJCSAgICBjZW50ZXIgPSBtYXAubGF5ZXJQb2ludFRvTGF0TG5nKG9yaWdpbiksCgkJICAgIHpvb20gPSBtYXAuZ2V0U2NhbGVab29tKHRoaXMuX3NjYWxlKTsKCgkJbWFwLl9hbmltYXRlWm9vbShjZW50ZXIsIHpvb20sIHRoaXMuX3N0YXJ0Q2VudGVyLCB0aGlzLl9zY2FsZSwgdGhpcy5fZGVsdGEsIGZhbHNlLCB0cnVlKTsKCX0sCgoJX29uVG91Y2hFbmQ6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIXRoaXMuX21vdmVkIHx8ICF0aGlzLl96b29taW5nKSB7CgkJCXRoaXMuX3pvb21pbmcgPSBmYWxzZTsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIG1hcCA9IHRoaXMuX21hcDsKCgkJdGhpcy5fem9vbWluZyA9IGZhbHNlOwoJCUwuRG9tVXRpbC5yZW1vdmVDbGFzcyhtYXAuX21hcFBhbmUsICdsZWFmbGV0LXRvdWNoaW5nJyk7CgkJTC5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltUmVxdWVzdCk7CgoJCUwuRG9tRXZlbnQKCQkgICAgLm9mZihkb2N1bWVudCwgJ3RvdWNobW92ZScsIHRoaXMuX29uVG91Y2hNb3ZlKQoJCSAgICAub2ZmKGRvY3VtZW50LCAndG91Y2hlbmQnLCB0aGlzLl9vblRvdWNoRW5kKTsKCgkJdmFyIG9yaWdpbiA9IHRoaXMuX2dldFNjYWxlT3JpZ2luKCksCgkJICAgIGNlbnRlciA9IG1hcC5sYXllclBvaW50VG9MYXRMbmcob3JpZ2luKSwKCgkJICAgIG9sZFpvb20gPSBtYXAuZ2V0Wm9vbSgpLAoJCSAgICBmbG9hdFpvb21EZWx0YSA9IG1hcC5nZXRTY2FsZVpvb20odGhpcy5fc2NhbGUpIC0gb2xkWm9vbSwKCQkgICAgcm91bmRab29tRGVsdGEgPSAoZmxvYXRab29tRGVsdGEgPiAwID8KCQkgICAgICAgICAgICBNYXRoLmNlaWwoZmxvYXRab29tRGVsdGEpIDogTWF0aC5mbG9vcihmbG9hdFpvb21EZWx0YSkpLAoKCQkgICAgem9vbSA9IG1hcC5fbGltaXRab29tKG9sZFpvb20gKyByb3VuZFpvb21EZWx0YSksCgkJICAgIHNjYWxlID0gbWFwLmdldFpvb21TY2FsZSh6b29tKSAvIHRoaXMuX3NjYWxlOwoKCQltYXAuX2FuaW1hdGVab29tKGNlbnRlciwgem9vbSwgb3JpZ2luLCBzY2FsZSk7Cgl9LAoKCV9nZXRTY2FsZU9yaWdpbjogZnVuY3Rpb24gKCkgewoJCXZhciBjZW50ZXJPZmZzZXQgPSB0aGlzLl9jZW50ZXJPZmZzZXQuc3VidHJhY3QodGhpcy5fZGVsdGEpLmRpdmlkZUJ5KHRoaXMuX3NjYWxlKTsKCQlyZXR1cm4gdGhpcy5fc3RhcnRDZW50ZXIuYWRkKGNlbnRlck9mZnNldCk7Cgl9Cn0pOwoKTC5NYXAuYWRkSW5pdEhvb2soJ2FkZEhhbmRsZXInLCAndG91Y2hab29tJywgTC5NYXAuVG91Y2hab29tKTsKCgovKgogKiBMLk1hcC5UYXAgaXMgdXNlZCB0byBlbmFibGUgbW9iaWxlIGhhY2tzIGxpa2UgcXVpY2sgdGFwcyBhbmQgbG9uZyBob2xkLgogKi8KCkwuTWFwLm1lcmdlT3B0aW9ucyh7Cgl0YXA6IHRydWUsCgl0YXBUb2xlcmFuY2U6IDE1Cn0pOwoKTC5NYXAuVGFwID0gTC5IYW5kbGVyLmV4dGVuZCh7CglhZGRIb29rczogZnVuY3Rpb24gKCkgewoJCUwuRG9tRXZlbnQub24odGhpcy5fbWFwLl9jb250YWluZXIsICd0b3VjaHN0YXJ0JywgdGhpcy5fb25Eb3duLCB0aGlzKTsKCX0sCgoJcmVtb3ZlSG9va3M6IGZ1bmN0aW9uICgpIHsKCQlMLkRvbUV2ZW50Lm9mZih0aGlzLl9tYXAuX2NvbnRhaW5lciwgJ3RvdWNoc3RhcnQnLCB0aGlzLl9vbkRvd24sIHRoaXMpOwoJfSwKCglfb25Eb3duOiBmdW5jdGlvbiAoZSkgewoJCWlmICghZS50b3VjaGVzKSB7IHJldHVybjsgfQoKCQlMLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KGUpOwoKCQl0aGlzLl9maXJlQ2xpY2sgPSB0cnVlOwoKCQkvLyBkb24ndCBzaW11bGF0ZSBjbGljayBvciB0cmFjayBsb25ncHJlc3MgaWYgbW9yZSB0aGFuIDEgdG91Y2gKCQlpZiAoZS50b3VjaGVzLmxlbmd0aCA+IDEpIHsKCQkJdGhpcy5fZmlyZUNsaWNrID0gZmFsc2U7CgkJCWNsZWFyVGltZW91dCh0aGlzLl9ob2xkVGltZW91dCk7CgkJCXJldHVybjsKCQl9CgoJCXZhciBmaXJzdCA9IGUudG91Y2hlc1swXSwKCQkgICAgZWwgPSBmaXJzdC50YXJnZXQ7CgoJCXRoaXMuX3N0YXJ0UG9zID0gdGhpcy5fbmV3UG9zID0gbmV3IEwuUG9pbnQoZmlyc3QuY2xpZW50WCwgZmlyc3QuY2xpZW50WSk7CgoJCS8vIGlmIHRvdWNoaW5nIGEgbGluaywgaGlnaGxpZ2h0IGl0CgkJaWYgKGVsLnRhZ05hbWUgJiYgZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnYScpIHsKCQkJTC5Eb21VdGlsLmFkZENsYXNzKGVsLCAnbGVhZmxldC1hY3RpdmUnKTsKCQl9CgoJCS8vIHNpbXVsYXRlIGxvbmcgaG9sZCBidXQgc2V0dGluZyBhIHRpbWVvdXQKCQl0aGlzLl9ob2xkVGltZW91dCA9IHNldFRpbWVvdXQoTC5iaW5kKGZ1bmN0aW9uICgpIHsKCQkJaWYgKHRoaXMuX2lzVGFwVmFsaWQoKSkgewoJCQkJdGhpcy5fZmlyZUNsaWNrID0gZmFsc2U7CgkJCQl0aGlzLl9vblVwKCk7CgkJCQl0aGlzLl9zaW11bGF0ZUV2ZW50KCdjb250ZXh0bWVudScsIGZpcnN0KTsKCQkJfQoJCX0sIHRoaXMpLCAxMDAwKTsKCgkJTC5Eb21FdmVudAoJCQkub24oZG9jdW1lbnQsICd0b3VjaG1vdmUnLCB0aGlzLl9vbk1vdmUsIHRoaXMpCgkJCS5vbihkb2N1bWVudCwgJ3RvdWNoZW5kJywgdGhpcy5fb25VcCwgdGhpcyk7Cgl9LAoKCV9vblVwOiBmdW5jdGlvbiAoZSkgewoJCWNsZWFyVGltZW91dCh0aGlzLl9ob2xkVGltZW91dCk7CgoJCUwuRG9tRXZlbnQKCQkJLm9mZihkb2N1bWVudCwgJ3RvdWNobW92ZScsIHRoaXMuX29uTW92ZSwgdGhpcykKCQkJLm9mZihkb2N1bWVudCwgJ3RvdWNoZW5kJywgdGhpcy5fb25VcCwgdGhpcyk7CgoJCWlmICh0aGlzLl9maXJlQ2xpY2sgJiYgZSAmJiBlLmNoYW5nZWRUb3VjaGVzKSB7CgoJCQl2YXIgZmlyc3QgPSBlLmNoYW5nZWRUb3VjaGVzWzBdLAoJCQkgICAgZWwgPSBmaXJzdC50YXJnZXQ7CgoJCQlpZiAoZWwgJiYgZWwudGFnTmFtZSAmJiBlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdhJykgewoJCQkJTC5Eb21VdGlsLnJlbW92ZUNsYXNzKGVsLCAnbGVhZmxldC1hY3RpdmUnKTsKCQkJfQoKCQkJLy8gc2ltdWxhdGUgY2xpY2sgaWYgdGhlIHRvdWNoIGRpZG4ndCBtb3ZlIHRvbyBtdWNoCgkJCWlmICh0aGlzLl9pc1RhcFZhbGlkKCkpIHsKCQkJCXRoaXMuX3NpbXVsYXRlRXZlbnQoJ2NsaWNrJywgZmlyc3QpOwoJCQl9CgkJfQoJfSwKCglfaXNUYXBWYWxpZDogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9uZXdQb3MuZGlzdGFuY2VUbyh0aGlzLl9zdGFydFBvcykgPD0gdGhpcy5fbWFwLm9wdGlvbnMudGFwVG9sZXJhbmNlOwoJfSwKCglfb25Nb3ZlOiBmdW5jdGlvbiAoZSkgewoJCXZhciBmaXJzdCA9IGUudG91Y2hlc1swXTsKCQl0aGlzLl9uZXdQb3MgPSBuZXcgTC5Qb2ludChmaXJzdC5jbGllbnRYLCBmaXJzdC5jbGllbnRZKTsKCX0sCgoJX3NpbXVsYXRlRXZlbnQ6IGZ1bmN0aW9uICh0eXBlLCBlKSB7CgkJdmFyIHNpbXVsYXRlZEV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ01vdXNlRXZlbnRzJyk7CgoJCXNpbXVsYXRlZEV2ZW50Ll9zaW11bGF0ZWQgPSB0cnVlOwoJCWUudGFyZ2V0Ll9zaW11bGF0ZWRDbGljayA9IHRydWU7CgoJCXNpbXVsYXRlZEV2ZW50LmluaXRNb3VzZUV2ZW50KAoJCSAgICAgICAgdHlwZSwgdHJ1ZSwgdHJ1ZSwgd2luZG93LCAxLAoJCSAgICAgICAgZS5zY3JlZW5YLCBlLnNjcmVlblksCgkJICAgICAgICBlLmNsaWVudFgsIGUuY2xpZW50WSwKCQkgICAgICAgIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAwLCBudWxsKTsKCgkJZS50YXJnZXQuZGlzcGF0Y2hFdmVudChzaW11bGF0ZWRFdmVudCk7Cgl9Cn0pOwoKaWYgKEwuQnJvd3Nlci50b3VjaCAmJiAhTC5Ccm93c2VyLnBvaW50ZXIpIHsKCUwuTWFwLmFkZEluaXRIb29rKCdhZGRIYW5kbGVyJywgJ3RhcCcsIEwuTWFwLlRhcCk7Cn0KCgovKgogKiBMLkhhbmRsZXIuU2hpZnREcmFnWm9vbSBpcyB1c2VkIHRvIGFkZCBzaGlmdC1kcmFnIHpvb20gaW50ZXJhY3Rpb24gdG8gdGhlIG1hcAogICogKHpvb20gdG8gYSBzZWxlY3RlZCBib3VuZGluZyBib3gpLCBlbmFibGVkIGJ5IGRlZmF1bHQuCiAqLwoKTC5NYXAubWVyZ2VPcHRpb25zKHsKCWJveFpvb206IHRydWUKfSk7CgpMLk1hcC5Cb3hab29tID0gTC5IYW5kbGVyLmV4dGVuZCh7Cglpbml0aWFsaXplOiBmdW5jdGlvbiAobWFwKSB7CgkJdGhpcy5fbWFwID0gbWFwOwoJCXRoaXMuX2NvbnRhaW5lciA9IG1hcC5fY29udGFpbmVyOwoJCXRoaXMuX3BhbmUgPSBtYXAuX3BhbmVzLm92ZXJsYXlQYW5lOwoJCXRoaXMuX21vdmVkID0gZmFsc2U7Cgl9LAoKCWFkZEhvb2tzOiBmdW5jdGlvbiAoKSB7CgkJTC5Eb21FdmVudC5vbih0aGlzLl9jb250YWluZXIsICdtb3VzZWRvd24nLCB0aGlzLl9vbk1vdXNlRG93biwgdGhpcyk7Cgl9LAoKCXJlbW92ZUhvb2tzOiBmdW5jdGlvbiAoKSB7CgkJTC5Eb21FdmVudC5vZmYodGhpcy5fY29udGFpbmVyLCAnbW91c2Vkb3duJywgdGhpcy5fb25Nb3VzZURvd24pOwoJCXRoaXMuX21vdmVkID0gZmFsc2U7Cgl9LAoKCW1vdmVkOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRoaXMuX21vdmVkOwoJfSwKCglfb25Nb3VzZURvd246IGZ1bmN0aW9uIChlKSB7CgkJdGhpcy5fbW92ZWQgPSBmYWxzZTsKCgkJaWYgKCFlLnNoaWZ0S2V5IHx8ICgoZS53aGljaCAhPT0gMSkgJiYgKGUuYnV0dG9uICE9PSAxKSkpIHsgcmV0dXJuIGZhbHNlOyB9CgoJCUwuRG9tVXRpbC5kaXNhYmxlVGV4dFNlbGVjdGlvbigpOwoJCUwuRG9tVXRpbC5kaXNhYmxlSW1hZ2VEcmFnKCk7CgoJCXRoaXMuX3N0YXJ0TGF5ZXJQb2ludCA9IHRoaXMuX21hcC5tb3VzZUV2ZW50VG9MYXllclBvaW50KGUpOwoKCQlMLkRvbUV2ZW50CgkJICAgIC5vbihkb2N1bWVudCwgJ21vdXNlbW92ZScsIHRoaXMuX29uTW91c2VNb3ZlLCB0aGlzKQoJCSAgICAub24oZG9jdW1lbnQsICdtb3VzZXVwJywgdGhpcy5fb25Nb3VzZVVwLCB0aGlzKQoJCSAgICAub24oZG9jdW1lbnQsICdrZXlkb3duJywgdGhpcy5fb25LZXlEb3duLCB0aGlzKTsKCX0sCgoJX29uTW91c2VNb3ZlOiBmdW5jdGlvbiAoZSkgewoJCWlmICghdGhpcy5fbW92ZWQpIHsKCQkJdGhpcy5fYm94ID0gTC5Eb21VdGlsLmNyZWF0ZSgnZGl2JywgJ2xlYWZsZXQtem9vbS1ib3gnLCB0aGlzLl9wYW5lKTsKCQkJTC5Eb21VdGlsLnNldFBvc2l0aW9uKHRoaXMuX2JveCwgdGhpcy5fc3RhcnRMYXllclBvaW50KTsKCgkJCS8vVE9ETyByZWZhY3RvcjogbW92ZSBjdXJzb3IgdG8gc3R5bGVzCgkJCXRoaXMuX2NvbnRhaW5lci5zdHlsZS5jdXJzb3IgPSAnY3Jvc3NoYWlyJzsKCQkJdGhpcy5fbWFwLmZpcmUoJ2JveHpvb21zdGFydCcpOwoJCX0KCgkJdmFyIHN0YXJ0UG9pbnQgPSB0aGlzLl9zdGFydExheWVyUG9pbnQsCgkJICAgIGJveCA9IHRoaXMuX2JveCwKCgkJICAgIGxheWVyUG9pbnQgPSB0aGlzLl9tYXAubW91c2VFdmVudFRvTGF5ZXJQb2ludChlKSwKCQkgICAgb2Zmc2V0ID0gbGF5ZXJQb2ludC5zdWJ0cmFjdChzdGFydFBvaW50KSwKCgkJICAgIG5ld1BvcyA9IG5ldyBMLlBvaW50KAoJCSAgICAgICAgTWF0aC5taW4obGF5ZXJQb2ludC54LCBzdGFydFBvaW50LngpLAoJCSAgICAgICAgTWF0aC5taW4obGF5ZXJQb2ludC55LCBzdGFydFBvaW50LnkpKTsKCgkJTC5Eb21VdGlsLnNldFBvc2l0aW9uKGJveCwgbmV3UG9zKTsKCgkJdGhpcy5fbW92ZWQgPSB0cnVlOwoKCQkvLyBUT0RPIHJlZmFjdG9yOiByZW1vdmUgaGFyZGNvZGVkIDQgcGl4ZWxzCgkJYm94LnN0eWxlLndpZHRoICA9IChNYXRoLm1heCgwLCBNYXRoLmFicyhvZmZzZXQueCkgLSA0KSkgKyAncHgnOwoJCWJveC5zdHlsZS5oZWlnaHQgPSAoTWF0aC5tYXgoMCwgTWF0aC5hYnMob2Zmc2V0LnkpIC0gNCkpICsgJ3B4JzsKCX0sCgoJX2ZpbmlzaDogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9tb3ZlZCkgewoJCQl0aGlzLl9wYW5lLnJlbW92ZUNoaWxkKHRoaXMuX2JveCk7CgkJCXRoaXMuX2NvbnRhaW5lci5zdHlsZS5jdXJzb3IgPSAnJzsKCQl9CgoJCUwuRG9tVXRpbC5lbmFibGVUZXh0U2VsZWN0aW9uKCk7CgkJTC5Eb21VdGlsLmVuYWJsZUltYWdlRHJhZygpOwoKCQlMLkRvbUV2ZW50CgkJICAgIC5vZmYoZG9jdW1lbnQsICdtb3VzZW1vdmUnLCB0aGlzLl9vbk1vdXNlTW92ZSkKCQkgICAgLm9mZihkb2N1bWVudCwgJ21vdXNldXAnLCB0aGlzLl9vbk1vdXNlVXApCgkJICAgIC5vZmYoZG9jdW1lbnQsICdrZXlkb3duJywgdGhpcy5fb25LZXlEb3duKTsKCX0sCgoJX29uTW91c2VVcDogZnVuY3Rpb24gKGUpIHsKCgkJdGhpcy5fZmluaXNoKCk7CgoJCXZhciBtYXAgPSB0aGlzLl9tYXAsCgkJICAgIGxheWVyUG9pbnQgPSBtYXAubW91c2VFdmVudFRvTGF5ZXJQb2ludChlKTsKCgkJaWYgKHRoaXMuX3N0YXJ0TGF5ZXJQb2ludC5lcXVhbHMobGF5ZXJQb2ludCkpIHsgcmV0dXJuOyB9CgoJCXZhciBib3VuZHMgPSBuZXcgTC5MYXRMbmdCb3VuZHMoCgkJICAgICAgICBtYXAubGF5ZXJQb2ludFRvTGF0TG5nKHRoaXMuX3N0YXJ0TGF5ZXJQb2ludCksCgkJICAgICAgICBtYXAubGF5ZXJQb2ludFRvTGF0TG5nKGxheWVyUG9pbnQpKTsKCgkJbWFwLmZpdEJvdW5kcyhib3VuZHMpOwoKCQltYXAuZmlyZSgnYm94em9vbWVuZCcsIHsKCQkJYm94Wm9vbUJvdW5kczogYm91bmRzCgkJfSk7Cgl9LAoKCV9vbktleURvd246IGZ1bmN0aW9uIChlKSB7CgkJaWYgKGUua2V5Q29kZSA9PT0gMjcpIHsKCQkJdGhpcy5fZmluaXNoKCk7CgkJfQoJfQp9KTsKCkwuTWFwLmFkZEluaXRIb29rKCdhZGRIYW5kbGVyJywgJ2JveFpvb20nLCBMLk1hcC5Cb3hab29tKTsKCgovKgogKiBMLk1hcC5LZXlib2FyZCBpcyBoYW5kbGluZyBrZXlib2FyZCBpbnRlcmFjdGlvbiB3aXRoIHRoZSBtYXAsIGVuYWJsZWQgYnkgZGVmYXVsdC4KICovCgpMLk1hcC5tZXJnZU9wdGlvbnMoewoJa2V5Ym9hcmQ6IHRydWUsCglrZXlib2FyZFBhbk9mZnNldDogODAsCglrZXlib2FyZFpvb21PZmZzZXQ6IDEKfSk7CgpMLk1hcC5LZXlib2FyZCA9IEwuSGFuZGxlci5leHRlbmQoewoKCWtleUNvZGVzOiB7CgkJbGVmdDogICAgWzM3XSwKCQlyaWdodDogICBbMzldLAoJCWRvd246ICAgIFs0MF0sCgkJdXA6ICAgICAgWzM4XSwKCQl6b29tSW46ICBbMTg3LCAxMDcsIDYxLCAxNzFdLAoJCXpvb21PdXQ6IFsxODksIDEwOSwgMTczXQoJfSwKCglpbml0aWFsaXplOiBmdW5jdGlvbiAobWFwKSB7CgkJdGhpcy5fbWFwID0gbWFwOwoKCQl0aGlzLl9zZXRQYW5PZmZzZXQobWFwLm9wdGlvbnMua2V5Ym9hcmRQYW5PZmZzZXQpOwoJCXRoaXMuX3NldFpvb21PZmZzZXQobWFwLm9wdGlvbnMua2V5Ym9hcmRab29tT2Zmc2V0KTsKCX0sCgoJYWRkSG9va3M6IGZ1bmN0aW9uICgpIHsKCQl2YXIgY29udGFpbmVyID0gdGhpcy5fbWFwLl9jb250YWluZXI7CgoJCS8vIG1ha2UgdGhlIGNvbnRhaW5lciBmb2N1c2FibGUgYnkgdGFiYmluZwoJCWlmIChjb250YWluZXIudGFiSW5kZXggPT09IC0xKSB7CgkJCWNvbnRhaW5lci50YWJJbmRleCA9ICcwJzsKCQl9CgoJCUwuRG9tRXZlbnQKCQkgICAgLm9uKGNvbnRhaW5lciwgJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cywgdGhpcykKCQkgICAgLm9uKGNvbnRhaW5lciwgJ2JsdXInLCB0aGlzLl9vbkJsdXIsIHRoaXMpCgkJICAgIC5vbihjb250YWluZXIsICdtb3VzZWRvd24nLCB0aGlzLl9vbk1vdXNlRG93biwgdGhpcyk7CgoJCXRoaXMuX21hcAoJCSAgICAub24oJ2ZvY3VzJywgdGhpcy5fYWRkSG9va3MsIHRoaXMpCgkJICAgIC5vbignYmx1cicsIHRoaXMuX3JlbW92ZUhvb2tzLCB0aGlzKTsKCX0sCgoJcmVtb3ZlSG9va3M6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9yZW1vdmVIb29rcygpOwoKCQl2YXIgY29udGFpbmVyID0gdGhpcy5fbWFwLl9jb250YWluZXI7CgoJCUwuRG9tRXZlbnQKCQkgICAgLm9mZihjb250YWluZXIsICdmb2N1cycsIHRoaXMuX29uRm9jdXMsIHRoaXMpCgkJICAgIC5vZmYoY29udGFpbmVyLCAnYmx1cicsIHRoaXMuX29uQmx1ciwgdGhpcykKCQkgICAgLm9mZihjb250YWluZXIsICdtb3VzZWRvd24nLCB0aGlzLl9vbk1vdXNlRG93biwgdGhpcyk7CgoJCXRoaXMuX21hcAoJCSAgICAub2ZmKCdmb2N1cycsIHRoaXMuX2FkZEhvb2tzLCB0aGlzKQoJCSAgICAub2ZmKCdibHVyJywgdGhpcy5fcmVtb3ZlSG9va3MsIHRoaXMpOwoJfSwKCglfb25Nb3VzZURvd246IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fZm9jdXNlZCkgeyByZXR1cm47IH0KCgkJdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5LAoJCSAgICBkb2NFbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwKCQkgICAgdG9wID0gYm9keS5zY3JvbGxUb3AgfHwgZG9jRWwuc2Nyb2xsVG9wLAoJCSAgICBsZWZ0ID0gYm9keS5zY3JvbGxMZWZ0IHx8IGRvY0VsLnNjcm9sbExlZnQ7CgoJCXRoaXMuX21hcC5fY29udGFpbmVyLmZvY3VzKCk7CgoJCXdpbmRvdy5zY3JvbGxUbyhsZWZ0LCB0b3ApOwoJfSwKCglfb25Gb2N1czogZnVuY3Rpb24gKCkgewoJCXRoaXMuX2ZvY3VzZWQgPSB0cnVlOwoJCXRoaXMuX21hcC5maXJlKCdmb2N1cycpOwoJfSwKCglfb25CbHVyOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fZm9jdXNlZCA9IGZhbHNlOwoJCXRoaXMuX21hcC5maXJlKCdibHVyJyk7Cgl9LAoKCV9zZXRQYW5PZmZzZXQ6IGZ1bmN0aW9uIChwYW4pIHsKCQl2YXIga2V5cyA9IHRoaXMuX3BhbktleXMgPSB7fSwKCQkgICAgY29kZXMgPSB0aGlzLmtleUNvZGVzLAoJCSAgICBpLCBsZW47CgoJCWZvciAoaSA9IDAsIGxlbiA9IGNvZGVzLmxlZnQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJa2V5c1tjb2Rlcy5sZWZ0W2ldXSA9IFstMSAqIHBhbiwgMF07CgkJfQoJCWZvciAoaSA9IDAsIGxlbiA9IGNvZGVzLnJpZ2h0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCWtleXNbY29kZXMucmlnaHRbaV1dID0gW3BhbiwgMF07CgkJfQoJCWZvciAoaSA9IDAsIGxlbiA9IGNvZGVzLmRvd24ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJa2V5c1tjb2Rlcy5kb3duW2ldXSA9IFswLCBwYW5dOwoJCX0KCQlmb3IgKGkgPSAwLCBsZW4gPSBjb2Rlcy51cC5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQlrZXlzW2NvZGVzLnVwW2ldXSA9IFswLCAtMSAqIHBhbl07CgkJfQoJfSwKCglfc2V0Wm9vbU9mZnNldDogZnVuY3Rpb24gKHpvb20pIHsKCQl2YXIga2V5cyA9IHRoaXMuX3pvb21LZXlzID0ge30sCgkJICAgIGNvZGVzID0gdGhpcy5rZXlDb2RlcywKCQkgICAgaSwgbGVuOwoKCQlmb3IgKGkgPSAwLCBsZW4gPSBjb2Rlcy56b29tSW4ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJa2V5c1tjb2Rlcy56b29tSW5baV1dID0gem9vbTsKCQl9CgkJZm9yIChpID0gMCwgbGVuID0gY29kZXMuem9vbU91dC5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQlrZXlzW2NvZGVzLnpvb21PdXRbaV1dID0gLXpvb207CgkJfQoJfSwKCglfYWRkSG9va3M6IGZ1bmN0aW9uICgpIHsKCQlMLkRvbUV2ZW50Lm9uKGRvY3VtZW50LCAna2V5ZG93bicsIHRoaXMuX29uS2V5RG93biwgdGhpcyk7Cgl9LAoKCV9yZW1vdmVIb29rczogZnVuY3Rpb24gKCkgewoJCUwuRG9tRXZlbnQub2ZmKGRvY3VtZW50LCAna2V5ZG93bicsIHRoaXMuX29uS2V5RG93biwgdGhpcyk7Cgl9LAoKCV9vbktleURvd246IGZ1bmN0aW9uIChlKSB7CgkJdmFyIGtleSA9IGUua2V5Q29kZSwKCQkgICAgbWFwID0gdGhpcy5fbWFwOwoKCQlpZiAoa2V5IGluIHRoaXMuX3BhbktleXMpIHsKCgkJCWlmIChtYXAuX3BhbkFuaW0gJiYgbWFwLl9wYW5BbmltLl9pblByb2dyZXNzKSB7IHJldHVybjsgfQoKCQkJbWFwLnBhbkJ5KHRoaXMuX3BhbktleXNba2V5XSk7CgoJCQlpZiAobWFwLm9wdGlvbnMubWF4Qm91bmRzKSB7CgkJCQltYXAucGFuSW5zaWRlQm91bmRzKG1hcC5vcHRpb25zLm1heEJvdW5kcyk7CgkJCX0KCgkJfSBlbHNlIGlmIChrZXkgaW4gdGhpcy5fem9vbUtleXMpIHsKCQkJbWFwLnNldFpvb20obWFwLmdldFpvb20oKSArIHRoaXMuX3pvb21LZXlzW2tleV0pOwoKCQl9IGVsc2UgewoJCQlyZXR1cm47CgkJfQoKCQlMLkRvbUV2ZW50LnN0b3AoZSk7Cgl9Cn0pOwoKTC5NYXAuYWRkSW5pdEhvb2soJ2FkZEhhbmRsZXInLCAna2V5Ym9hcmQnLCBMLk1hcC5LZXlib2FyZCk7CgoKLyoKICogTC5IYW5kbGVyLk1hcmtlckRyYWcgaXMgdXNlZCBpbnRlcm5hbGx5IGJ5IEwuTWFya2VyIHRvIG1ha2UgdGhlIG1hcmtlcnMgZHJhZ2dhYmxlLgogKi8KCkwuSGFuZGxlci5NYXJrZXJEcmFnID0gTC5IYW5kbGVyLmV4dGVuZCh7Cglpbml0aWFsaXplOiBmdW5jdGlvbiAobWFya2VyKSB7CgkJdGhpcy5fbWFya2VyID0gbWFya2VyOwoJfSwKCglhZGRIb29rczogZnVuY3Rpb24gKCkgewoJCXZhciBpY29uID0gdGhpcy5fbWFya2VyLl9pY29uOwoJCWlmICghdGhpcy5fZHJhZ2dhYmxlKSB7CgkJCXRoaXMuX2RyYWdnYWJsZSA9IG5ldyBMLkRyYWdnYWJsZShpY29uLCBpY29uKTsKCQl9CgoJCXRoaXMuX2RyYWdnYWJsZQoJCQkub24oJ2RyYWdzdGFydCcsIHRoaXMuX29uRHJhZ1N0YXJ0LCB0aGlzKQoJCQkub24oJ2RyYWcnLCB0aGlzLl9vbkRyYWcsIHRoaXMpCgkJCS5vbignZHJhZ2VuZCcsIHRoaXMuX29uRHJhZ0VuZCwgdGhpcyk7CgkJdGhpcy5fZHJhZ2dhYmxlLmVuYWJsZSgpOwoJCUwuRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl9tYXJrZXIuX2ljb24sICdsZWFmbGV0LW1hcmtlci1kcmFnZ2FibGUnKTsKCX0sCgoJcmVtb3ZlSG9va3M6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9kcmFnZ2FibGUKCQkJLm9mZignZHJhZ3N0YXJ0JywgdGhpcy5fb25EcmFnU3RhcnQsIHRoaXMpCgkJCS5vZmYoJ2RyYWcnLCB0aGlzLl9vbkRyYWcsIHRoaXMpCgkJCS5vZmYoJ2RyYWdlbmQnLCB0aGlzLl9vbkRyYWdFbmQsIHRoaXMpOwoKCQl0aGlzLl9kcmFnZ2FibGUuZGlzYWJsZSgpOwoJCUwuRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl9tYXJrZXIuX2ljb24sICdsZWFmbGV0LW1hcmtlci1kcmFnZ2FibGUnKTsKCX0sCgoJbW92ZWQ6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5fZHJhZ2dhYmxlICYmIHRoaXMuX2RyYWdnYWJsZS5fbW92ZWQ7Cgl9LAoKCV9vbkRyYWdTdGFydDogZnVuY3Rpb24gKCkgewoJCXRoaXMuX21hcmtlcgoJCSAgICAuY2xvc2VQb3B1cCgpCgkJICAgIC5maXJlKCdtb3Zlc3RhcnQnKQoJCSAgICAuZmlyZSgnZHJhZ3N0YXJ0Jyk7Cgl9LAoKCV9vbkRyYWc6IGZ1bmN0aW9uICgpIHsKCQl2YXIgbWFya2VyID0gdGhpcy5fbWFya2VyLAoJCSAgICBzaGFkb3cgPSBtYXJrZXIuX3NoYWRvdywKCQkgICAgaWNvblBvcyA9IEwuRG9tVXRpbC5nZXRQb3NpdGlvbihtYXJrZXIuX2ljb24pLAoJCSAgICBsYXRsbmcgPSBtYXJrZXIuX21hcC5sYXllclBvaW50VG9MYXRMbmcoaWNvblBvcyk7CgoJCS8vIHVwZGF0ZSBzaGFkb3cgcG9zaXRpb24KCQlpZiAoc2hhZG93KSB7CgkJCUwuRG9tVXRpbC5zZXRQb3NpdGlvbihzaGFkb3csIGljb25Qb3MpOwoJCX0KCgkJbWFya2VyLl9sYXRsbmcgPSBsYXRsbmc7CgoJCW1hcmtlcgoJCSAgICAuZmlyZSgnbW92ZScsIHtsYXRsbmc6IGxhdGxuZ30pCgkJICAgIC5maXJlKCdkcmFnJyk7Cgl9LAoKCV9vbkRyYWdFbmQ6IGZ1bmN0aW9uIChlKSB7CgkJdGhpcy5fbWFya2VyCgkJICAgIC5maXJlKCdtb3ZlZW5kJykKCQkgICAgLmZpcmUoJ2RyYWdlbmQnLCBlKTsKCX0KfSk7CgoKLyoKICogTC5Db250cm9sIGlzIGEgYmFzZSBjbGFzcyBmb3IgaW1wbGVtZW50aW5nIG1hcCBjb250cm9scy4gSGFuZGxlcyBwb3NpdGlvbmluZy4KICogQWxsIG90aGVyIGNvbnRyb2xzIGV4dGVuZCBmcm9tIHRoaXMgY2xhc3MuCiAqLwoKTC5Db250cm9sID0gTC5DbGFzcy5leHRlbmQoewoJb3B0aW9uczogewoJCXBvc2l0aW9uOiAndG9wcmlnaHQnCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CgkJTC5zZXRPcHRpb25zKHRoaXMsIG9wdGlvbnMpOwoJfSwKCglnZXRQb3NpdGlvbjogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLm9wdGlvbnMucG9zaXRpb247Cgl9LAoKCXNldFBvc2l0aW9uOiBmdW5jdGlvbiAocG9zaXRpb24pIHsKCQl2YXIgbWFwID0gdGhpcy5fbWFwOwoKCQlpZiAobWFwKSB7CgkJCW1hcC5yZW1vdmVDb250cm9sKHRoaXMpOwoJCX0KCgkJdGhpcy5vcHRpb25zLnBvc2l0aW9uID0gcG9zaXRpb247CgoJCWlmIChtYXApIHsKCQkJbWFwLmFkZENvbnRyb2wodGhpcyk7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJZ2V0Q29udGFpbmVyOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRoaXMuX2NvbnRhaW5lcjsKCX0sCgoJYWRkVG86IGZ1bmN0aW9uIChtYXApIHsKCQl0aGlzLl9tYXAgPSBtYXA7CgoJCXZhciBjb250YWluZXIgPSB0aGlzLl9jb250YWluZXIgPSB0aGlzLm9uQWRkKG1hcCksCgkJICAgIHBvcyA9IHRoaXMuZ2V0UG9zaXRpb24oKSwKCQkgICAgY29ybmVyID0gbWFwLl9jb250cm9sQ29ybmVyc1twb3NdOwoKCQlMLkRvbVV0aWwuYWRkQ2xhc3MoY29udGFpbmVyLCAnbGVhZmxldC1jb250cm9sJyk7CgoJCWlmIChwb3MuaW5kZXhPZignYm90dG9tJykgIT09IC0xKSB7CgkJCWNvcm5lci5pbnNlcnRCZWZvcmUoY29udGFpbmVyLCBjb3JuZXIuZmlyc3RDaGlsZCk7CgkJfSBlbHNlIHsKCQkJY29ybmVyLmFwcGVuZENoaWxkKGNvbnRhaW5lcik7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJcmVtb3ZlRnJvbTogZnVuY3Rpb24gKG1hcCkgewoJCXZhciBwb3MgPSB0aGlzLmdldFBvc2l0aW9uKCksCgkJICAgIGNvcm5lciA9IG1hcC5fY29udHJvbENvcm5lcnNbcG9zXTsKCgkJY29ybmVyLnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRhaW5lcik7CgkJdGhpcy5fbWFwID0gbnVsbDsKCgkJaWYgKHRoaXMub25SZW1vdmUpIHsKCQkJdGhpcy5vblJlbW92ZShtYXApOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCV9yZWZvY3VzT25NYXA6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fbWFwKSB7CgkJCXRoaXMuX21hcC5nZXRDb250YWluZXIoKS5mb2N1cygpOwoJCX0KCX0KfSk7CgpMLmNvbnRyb2wgPSBmdW5jdGlvbiAob3B0aW9ucykgewoJcmV0dXJuIG5ldyBMLkNvbnRyb2wob3B0aW9ucyk7Cn07CgoKLy8gYWRkcyBjb250cm9sLXJlbGF0ZWQgbWV0aG9kcyB0byBMLk1hcAoKTC5NYXAuaW5jbHVkZSh7CglhZGRDb250cm9sOiBmdW5jdGlvbiAoY29udHJvbCkgewoJCWNvbnRyb2wuYWRkVG8odGhpcyk7CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXJlbW92ZUNvbnRyb2w6IGZ1bmN0aW9uIChjb250cm9sKSB7CgkJY29udHJvbC5yZW1vdmVGcm9tKHRoaXMpOwoJCXJldHVybiB0aGlzOwoJfSwKCglfaW5pdENvbnRyb2xQb3M6IGZ1bmN0aW9uICgpIHsKCQl2YXIgY29ybmVycyA9IHRoaXMuX2NvbnRyb2xDb3JuZXJzID0ge30sCgkJICAgIGwgPSAnbGVhZmxldC0nLAoJCSAgICBjb250YWluZXIgPSB0aGlzLl9jb250cm9sQ29udGFpbmVyID0KCQkgICAgICAgICAgICBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCBsICsgJ2NvbnRyb2wtY29udGFpbmVyJywgdGhpcy5fY29udGFpbmVyKTsKCgkJZnVuY3Rpb24gY3JlYXRlQ29ybmVyKHZTaWRlLCBoU2lkZSkgewoJCQl2YXIgY2xhc3NOYW1lID0gbCArIHZTaWRlICsgJyAnICsgbCArIGhTaWRlOwoKCQkJY29ybmVyc1t2U2lkZSArIGhTaWRlXSA9IEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsIGNsYXNzTmFtZSwgY29udGFpbmVyKTsKCQl9CgoJCWNyZWF0ZUNvcm5lcigndG9wJywgJ2xlZnQnKTsKCQljcmVhdGVDb3JuZXIoJ3RvcCcsICdyaWdodCcpOwoJCWNyZWF0ZUNvcm5lcignYm90dG9tJywgJ2xlZnQnKTsKCQljcmVhdGVDb3JuZXIoJ2JvdHRvbScsICdyaWdodCcpOwoJfSwKCglfY2xlYXJDb250cm9sUG9zOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fY29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRyb2xDb250YWluZXIpOwoJfQp9KTsKCgovKgogKiBMLkNvbnRyb2wuWm9vbSBpcyB1c2VkIGZvciB0aGUgZGVmYXVsdCB6b29tIGJ1dHRvbnMgb24gdGhlIG1hcC4KICovCgpMLkNvbnRyb2wuWm9vbSA9IEwuQ29udHJvbC5leHRlbmQoewoJb3B0aW9uczogewoJCXBvc2l0aW9uOiAndG9wbGVmdCcsCgkJem9vbUluVGV4dDogJysnLAoJCXpvb21JblRpdGxlOiAnWm9vbSBpbicsCgkJem9vbU91dFRleHQ6ICctJywKCQl6b29tT3V0VGl0bGU6ICdab29tIG91dCcKCX0sCgoJb25BZGQ6IGZ1bmN0aW9uIChtYXApIHsKCQl2YXIgem9vbU5hbWUgPSAnbGVhZmxldC1jb250cm9sLXpvb20nLAoJCSAgICBjb250YWluZXIgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCB6b29tTmFtZSArICcgbGVhZmxldC1iYXInKTsKCgkJdGhpcy5fbWFwID0gbWFwOwoKCQl0aGlzLl96b29tSW5CdXR0b24gID0gdGhpcy5fY3JlYXRlQnV0dG9uKAoJCSAgICAgICAgdGhpcy5vcHRpb25zLnpvb21JblRleHQsIHRoaXMub3B0aW9ucy56b29tSW5UaXRsZSwKCQkgICAgICAgIHpvb21OYW1lICsgJy1pbicsICBjb250YWluZXIsIHRoaXMuX3pvb21JbiwgIHRoaXMpOwoJCXRoaXMuX3pvb21PdXRCdXR0b24gPSB0aGlzLl9jcmVhdGVCdXR0b24oCgkJICAgICAgICB0aGlzLm9wdGlvbnMuem9vbU91dFRleHQsIHRoaXMub3B0aW9ucy56b29tT3V0VGl0bGUsCgkJICAgICAgICB6b29tTmFtZSArICctb3V0JywgY29udGFpbmVyLCB0aGlzLl96b29tT3V0LCB0aGlzKTsKCgkJdGhpcy5fdXBkYXRlRGlzYWJsZWQoKTsKCQltYXAub24oJ3pvb21lbmQgem9vbWxldmVsc2NoYW5nZScsIHRoaXMuX3VwZGF0ZURpc2FibGVkLCB0aGlzKTsKCgkJcmV0dXJuIGNvbnRhaW5lcjsKCX0sCgoJb25SZW1vdmU6IGZ1bmN0aW9uIChtYXApIHsKCQltYXAub2ZmKCd6b29tZW5kIHpvb21sZXZlbHNjaGFuZ2UnLCB0aGlzLl91cGRhdGVEaXNhYmxlZCwgdGhpcyk7Cgl9LAoKCV96b29tSW46IGZ1bmN0aW9uIChlKSB7CgkJdGhpcy5fbWFwLnpvb21JbihlLnNoaWZ0S2V5ID8gMyA6IDEpOwoJfSwKCglfem9vbU91dDogZnVuY3Rpb24gKGUpIHsKCQl0aGlzLl9tYXAuem9vbU91dChlLnNoaWZ0S2V5ID8gMyA6IDEpOwoJfSwKCglfY3JlYXRlQnV0dG9uOiBmdW5jdGlvbiAoaHRtbCwgdGl0bGUsIGNsYXNzTmFtZSwgY29udGFpbmVyLCBmbiwgY29udGV4dCkgewoJCXZhciBsaW5rID0gTC5Eb21VdGlsLmNyZWF0ZSgnYScsIGNsYXNzTmFtZSwgY29udGFpbmVyKTsKCQlsaW5rLmlubmVySFRNTCA9IGh0bWw7CgkJbGluay5ocmVmID0gJyMnOwoJCWxpbmsudGl0bGUgPSB0aXRsZTsKCgkJdmFyIHN0b3AgPSBMLkRvbUV2ZW50LnN0b3BQcm9wYWdhdGlvbjsKCgkJTC5Eb21FdmVudAoJCSAgICAub24obGluaywgJ2NsaWNrJywgc3RvcCkKCQkgICAgLm9uKGxpbmssICdtb3VzZWRvd24nLCBzdG9wKQoJCSAgICAub24obGluaywgJ2RibGNsaWNrJywgc3RvcCkKCQkgICAgLm9uKGxpbmssICdjbGljaycsIEwuRG9tRXZlbnQucHJldmVudERlZmF1bHQpCgkJICAgIC5vbihsaW5rLCAnY2xpY2snLCBmbiwgY29udGV4dCkKCQkgICAgLm9uKGxpbmssICdjbGljaycsIHRoaXMuX3JlZm9jdXNPbk1hcCwgY29udGV4dCk7CgoJCXJldHVybiBsaW5rOwoJfSwKCglfdXBkYXRlRGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHsKCQl2YXIgbWFwID0gdGhpcy5fbWFwLAoJCQljbGFzc05hbWUgPSAnbGVhZmxldC1kaXNhYmxlZCc7CgoJCUwuRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl96b29tSW5CdXR0b24sIGNsYXNzTmFtZSk7CgkJTC5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX3pvb21PdXRCdXR0b24sIGNsYXNzTmFtZSk7CgoJCWlmIChtYXAuX3pvb20gPT09IG1hcC5nZXRNaW5ab29tKCkpIHsKCQkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX3pvb21PdXRCdXR0b24sIGNsYXNzTmFtZSk7CgkJfQoJCWlmIChtYXAuX3pvb20gPT09IG1hcC5nZXRNYXhab29tKCkpIHsKCQkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX3pvb21JbkJ1dHRvbiwgY2xhc3NOYW1lKTsKCQl9Cgl9Cn0pOwoKTC5NYXAubWVyZ2VPcHRpb25zKHsKCXpvb21Db250cm9sOiB0cnVlCn0pOwoKTC5NYXAuYWRkSW5pdEhvb2soZnVuY3Rpb24gKCkgewoJaWYgKHRoaXMub3B0aW9ucy56b29tQ29udHJvbCkgewoJCXRoaXMuem9vbUNvbnRyb2wgPSBuZXcgTC5Db250cm9sLlpvb20oKTsKCQl0aGlzLmFkZENvbnRyb2wodGhpcy56b29tQ29udHJvbCk7Cgl9Cn0pOwoKTC5jb250cm9sLnpvb20gPSBmdW5jdGlvbiAob3B0aW9ucykgewoJcmV0dXJuIG5ldyBMLkNvbnRyb2wuWm9vbShvcHRpb25zKTsKfTsKCgoKLyoKICogTC5Db250cm9sLkF0dHJpYnV0aW9uIGlzIHVzZWQgZm9yIGRpc3BsYXlpbmcgYXR0cmlidXRpb24gb24gdGhlIG1hcCAoYWRkZWQgYnkgZGVmYXVsdCkuCiAqLwoKTC5Db250cm9sLkF0dHJpYnV0aW9uID0gTC5Db250cm9sLmV4dGVuZCh7CglvcHRpb25zOiB7CgkJcG9zaXRpb246ICdib3R0b21yaWdodCcsCgkJcHJlZml4OiAnPGEgaHJlZj0iaHR0cDovL2xlYWZsZXRqcy5jb20iIHRpdGxlPSJBIEpTIGxpYnJhcnkgZm9yIGludGVyYWN0aXZlIG1hcHMiPkxlYWZsZXQ8L2E+JwoJfSwKCglpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewoJCUwuc2V0T3B0aW9ucyh0aGlzLCBvcHRpb25zKTsKCgkJdGhpcy5fYXR0cmlidXRpb25zID0ge307Cgl9LAoKCW9uQWRkOiBmdW5jdGlvbiAobWFwKSB7CgkJdGhpcy5fY29udGFpbmVyID0gTC5Eb21VdGlsLmNyZWF0ZSgnZGl2JywgJ2xlYWZsZXQtY29udHJvbC1hdHRyaWJ1dGlvbicpOwoJCUwuRG9tRXZlbnQuZGlzYWJsZUNsaWNrUHJvcGFnYXRpb24odGhpcy5fY29udGFpbmVyKTsKCgkJZm9yICh2YXIgaSBpbiBtYXAuX2xheWVycykgewoJCQlpZiAobWFwLl9sYXllcnNbaV0uZ2V0QXR0cmlidXRpb24pIHsKCQkJCXRoaXMuYWRkQXR0cmlidXRpb24obWFwLl9sYXllcnNbaV0uZ2V0QXR0cmlidXRpb24oKSk7CgkJCX0KCQl9CgkJCgkJbWFwCgkJICAgIC5vbignbGF5ZXJhZGQnLCB0aGlzLl9vbkxheWVyQWRkLCB0aGlzKQoJCSAgICAub24oJ2xheWVycmVtb3ZlJywgdGhpcy5fb25MYXllclJlbW92ZSwgdGhpcyk7CgoJCXRoaXMuX3VwZGF0ZSgpOwoKCQlyZXR1cm4gdGhpcy5fY29udGFpbmVyOwoJfSwKCglvblJlbW92ZTogZnVuY3Rpb24gKG1hcCkgewoJCW1hcAoJCSAgICAub2ZmKCdsYXllcmFkZCcsIHRoaXMuX29uTGF5ZXJBZGQpCgkJICAgIC5vZmYoJ2xheWVycmVtb3ZlJywgdGhpcy5fb25MYXllclJlbW92ZSk7CgoJfSwKCglzZXRQcmVmaXg6IGZ1bmN0aW9uIChwcmVmaXgpIHsKCQl0aGlzLm9wdGlvbnMucHJlZml4ID0gcHJlZml4OwoJCXRoaXMuX3VwZGF0ZSgpOwoJCXJldHVybiB0aGlzOwoJfSwKCglhZGRBdHRyaWJ1dGlvbjogZnVuY3Rpb24gKHRleHQpIHsKCQlpZiAoIXRleHQpIHsgcmV0dXJuOyB9CgoJCWlmICghdGhpcy5fYXR0cmlidXRpb25zW3RleHRdKSB7CgkJCXRoaXMuX2F0dHJpYnV0aW9uc1t0ZXh0XSA9IDA7CgkJfQoJCXRoaXMuX2F0dHJpYnV0aW9uc1t0ZXh0XSsrOwoKCQl0aGlzLl91cGRhdGUoKTsKCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXJlbW92ZUF0dHJpYnV0aW9uOiBmdW5jdGlvbiAodGV4dCkgewoJCWlmICghdGV4dCkgeyByZXR1cm47IH0KCgkJaWYgKHRoaXMuX2F0dHJpYnV0aW9uc1t0ZXh0XSkgewoJCQl0aGlzLl9hdHRyaWJ1dGlvbnNbdGV4dF0tLTsKCQkJdGhpcy5fdXBkYXRlKCk7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJX3VwZGF0ZTogZnVuY3Rpb24gKCkgewoJCWlmICghdGhpcy5fbWFwKSB7IHJldHVybjsgfQoKCQl2YXIgYXR0cmlicyA9IFtdOwoKCQlmb3IgKHZhciBpIGluIHRoaXMuX2F0dHJpYnV0aW9ucykgewoJCQlpZiAodGhpcy5fYXR0cmlidXRpb25zW2ldKSB7CgkJCQlhdHRyaWJzLnB1c2goaSk7CgkJCX0KCQl9CgoJCXZhciBwcmVmaXhBbmRBdHRyaWJzID0gW107CgoJCWlmICh0aGlzLm9wdGlvbnMucHJlZml4KSB7CgkJCXByZWZpeEFuZEF0dHJpYnMucHVzaCh0aGlzLm9wdGlvbnMucHJlZml4KTsKCQl9CgkJaWYgKGF0dHJpYnMubGVuZ3RoKSB7CgkJCXByZWZpeEFuZEF0dHJpYnMucHVzaChhdHRyaWJzLmpvaW4oJywgJykpOwoJCX0KCgkJdGhpcy5fY29udGFpbmVyLmlubmVySFRNTCA9IHByZWZpeEFuZEF0dHJpYnMuam9pbignIHwgJyk7Cgl9LAoKCV9vbkxheWVyQWRkOiBmdW5jdGlvbiAoZSkgewoJCWlmIChlLmxheWVyLmdldEF0dHJpYnV0aW9uKSB7CgkJCXRoaXMuYWRkQXR0cmlidXRpb24oZS5sYXllci5nZXRBdHRyaWJ1dGlvbigpKTsKCQl9Cgl9LAoKCV9vbkxheWVyUmVtb3ZlOiBmdW5jdGlvbiAoZSkgewoJCWlmIChlLmxheWVyLmdldEF0dHJpYnV0aW9uKSB7CgkJCXRoaXMucmVtb3ZlQXR0cmlidXRpb24oZS5sYXllci5nZXRBdHRyaWJ1dGlvbigpKTsKCQl9Cgl9Cn0pOwoKTC5NYXAubWVyZ2VPcHRpb25zKHsKCWF0dHJpYnV0aW9uQ29udHJvbDogdHJ1ZQp9KTsKCkwuTWFwLmFkZEluaXRIb29rKGZ1bmN0aW9uICgpIHsKCWlmICh0aGlzLm9wdGlvbnMuYXR0cmlidXRpb25Db250cm9sKSB7CgkJdGhpcy5hdHRyaWJ1dGlvbkNvbnRyb2wgPSAobmV3IEwuQ29udHJvbC5BdHRyaWJ1dGlvbigpKS5hZGRUbyh0aGlzKTsKCX0KfSk7CgpMLmNvbnRyb2wuYXR0cmlidXRpb24gPSBmdW5jdGlvbiAob3B0aW9ucykgewoJcmV0dXJuIG5ldyBMLkNvbnRyb2wuQXR0cmlidXRpb24ob3B0aW9ucyk7Cn07CgoKLyoKICogTC5Db250cm9sLlNjYWxlIGlzIHVzZWQgZm9yIGRpc3BsYXlpbmcgbWV0cmljL2ltcGVyaWFsIHNjYWxlIG9uIHRoZSBtYXAuCiAqLwoKTC5Db250cm9sLlNjYWxlID0gTC5Db250cm9sLmV4dGVuZCh7CglvcHRpb25zOiB7CgkJcG9zaXRpb246ICdib3R0b21sZWZ0JywKCQltYXhXaWR0aDogMTAwLAoJCW1ldHJpYzogdHJ1ZSwKCQlpbXBlcmlhbDogdHJ1ZSwKCQl1cGRhdGVXaGVuSWRsZTogZmFsc2UKCX0sCgoJb25BZGQ6IGZ1bmN0aW9uIChtYXApIHsKCQl0aGlzLl9tYXAgPSBtYXA7CgoJCXZhciBjbGFzc05hbWUgPSAnbGVhZmxldC1jb250cm9sLXNjYWxlJywKCQkgICAgY29udGFpbmVyID0gTC5Eb21VdGlsLmNyZWF0ZSgnZGl2JywgY2xhc3NOYW1lKSwKCQkgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9uczsKCgkJdGhpcy5fYWRkU2NhbGVzKG9wdGlvbnMsIGNsYXNzTmFtZSwgY29udGFpbmVyKTsKCgkJbWFwLm9uKG9wdGlvbnMudXBkYXRlV2hlbklkbGUgPyAnbW92ZWVuZCcgOiAnbW92ZScsIHRoaXMuX3VwZGF0ZSwgdGhpcyk7CgkJbWFwLndoZW5SZWFkeSh0aGlzLl91cGRhdGUsIHRoaXMpOwoKCQlyZXR1cm4gY29udGFpbmVyOwoJfSwKCglvblJlbW92ZTogZnVuY3Rpb24gKG1hcCkgewoJCW1hcC5vZmYodGhpcy5vcHRpb25zLnVwZGF0ZVdoZW5JZGxlID8gJ21vdmVlbmQnIDogJ21vdmUnLCB0aGlzLl91cGRhdGUsIHRoaXMpOwoJfSwKCglfYWRkU2NhbGVzOiBmdW5jdGlvbiAob3B0aW9ucywgY2xhc3NOYW1lLCBjb250YWluZXIpIHsKCQlpZiAob3B0aW9ucy5tZXRyaWMpIHsKCQkJdGhpcy5fbVNjYWxlID0gTC5Eb21VdGlsLmNyZWF0ZSgnZGl2JywgY2xhc3NOYW1lICsgJy1saW5lJywgY29udGFpbmVyKTsKCQl9CgkJaWYgKG9wdGlvbnMuaW1wZXJpYWwpIHsKCQkJdGhpcy5faVNjYWxlID0gTC5Eb21VdGlsLmNyZWF0ZSgnZGl2JywgY2xhc3NOYW1lICsgJy1saW5lJywgY29udGFpbmVyKTsKCQl9Cgl9LAoKCV91cGRhdGU6IGZ1bmN0aW9uICgpIHsKCQl2YXIgYm91bmRzID0gdGhpcy5fbWFwLmdldEJvdW5kcygpLAoJCSAgICBjZW50ZXJMYXQgPSBib3VuZHMuZ2V0Q2VudGVyKCkubGF0LAoJCSAgICBoYWxmV29ybGRNZXRlcnMgPSA2MzY3MDAwLjAgKiBNYXRoLlBJICogTWF0aC5jb3MoY2VudGVyTGF0ICogTWF0aC5QSSAvIDE4MCksCgkJICAgIGRpc3QgPSBoYWxmV29ybGRNZXRlcnMgKiAoYm91bmRzLmdldE5vcnRoRWFzdCgpLmxuZyAtIGJvdW5kcy5nZXRTb3V0aFdlc3QoKS5sbmcpIC8gMTgwLAoKCQkgICAgc2l6ZSA9IHRoaXMuX21hcC5nZXRTaXplKCksCgkJICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCgkJICAgIG1heE1ldGVycyA9IDA7CgoJCWlmIChzaXplLnggPiAwKSB7CgkJCW1heE1ldGVycyA9IGRpc3QgKiAob3B0aW9ucy5tYXhXaWR0aCAvIHNpemUueCk7CgkJfQoKCQl0aGlzLl91cGRhdGVTY2FsZXMob3B0aW9ucywgbWF4TWV0ZXJzKTsKCX0sCgoJX3VwZGF0ZVNjYWxlczogZnVuY3Rpb24gKG9wdGlvbnMsIG1heE1ldGVycykgewoJCWlmIChvcHRpb25zLm1ldHJpYyAmJiBtYXhNZXRlcnMpIHsKCQkJdGhpcy5fdXBkYXRlTWV0cmljKG1heE1ldGVycyk7CgkJfQoKCQlpZiAob3B0aW9ucy5pbXBlcmlhbCAmJiBtYXhNZXRlcnMpIHsKCQkJdGhpcy5fdXBkYXRlSW1wZXJpYWwobWF4TWV0ZXJzKTsKCQl9Cgl9LAoKCV91cGRhdGVNZXRyaWM6IGZ1bmN0aW9uIChtYXhNZXRlcnMpIHsKCQl2YXIgbWV0ZXJzID0gdGhpcy5fZ2V0Um91bmROdW0obWF4TWV0ZXJzKTsKCgkJdGhpcy5fbVNjYWxlLnN0eWxlLndpZHRoID0gdGhpcy5fZ2V0U2NhbGVXaWR0aChtZXRlcnMgLyBtYXhNZXRlcnMpICsgJ3B4JzsKCQl0aGlzLl9tU2NhbGUuaW5uZXJIVE1MID0gbWV0ZXJzIDwgMTAwMCA/IG1ldGVycyArICcgbScgOiAobWV0ZXJzIC8gMTAwMCkgKyAnIGttJzsKCX0sCgoJX3VwZGF0ZUltcGVyaWFsOiBmdW5jdGlvbiAobWF4TWV0ZXJzKSB7CgkJdmFyIG1heEZlZXQgPSBtYXhNZXRlcnMgKiAzLjI4MDgzOTksCgkJICAgIHNjYWxlID0gdGhpcy5faVNjYWxlLAoJCSAgICBtYXhNaWxlcywgbWlsZXMsIGZlZXQ7CgoJCWlmIChtYXhGZWV0ID4gNTI4MCkgewoJCQltYXhNaWxlcyA9IG1heEZlZXQgLyA1MjgwOwoJCQltaWxlcyA9IHRoaXMuX2dldFJvdW5kTnVtKG1heE1pbGVzKTsKCgkJCXNjYWxlLnN0eWxlLndpZHRoID0gdGhpcy5fZ2V0U2NhbGVXaWR0aChtaWxlcyAvIG1heE1pbGVzKSArICdweCc7CgkJCXNjYWxlLmlubmVySFRNTCA9IG1pbGVzICsgJyBtaSc7CgoJCX0gZWxzZSB7CgkJCWZlZXQgPSB0aGlzLl9nZXRSb3VuZE51bShtYXhGZWV0KTsKCgkJCXNjYWxlLnN0eWxlLndpZHRoID0gdGhpcy5fZ2V0U2NhbGVXaWR0aChmZWV0IC8gbWF4RmVldCkgKyAncHgnOwoJCQlzY2FsZS5pbm5lckhUTUwgPSBmZWV0ICsgJyBmdCc7CgkJfQoJfSwKCglfZ2V0U2NhbGVXaWR0aDogZnVuY3Rpb24gKHJhdGlvKSB7CgkJcmV0dXJuIE1hdGgucm91bmQodGhpcy5vcHRpb25zLm1heFdpZHRoICogcmF0aW8pIC0gMTA7Cgl9LAoKCV9nZXRSb3VuZE51bTogZnVuY3Rpb24gKG51bSkgewoJCXZhciBwb3cxMCA9IE1hdGgucG93KDEwLCAoTWF0aC5mbG9vcihudW0pICsgJycpLmxlbmd0aCAtIDEpLAoJCSAgICBkID0gbnVtIC8gcG93MTA7CgoJCWQgPSBkID49IDEwID8gMTAgOiBkID49IDUgPyA1IDogZCA+PSAzID8gMyA6IGQgPj0gMiA/IDIgOiAxOwoKCQlyZXR1cm4gcG93MTAgKiBkOwoJfQp9KTsKCkwuY29udHJvbC5zY2FsZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CglyZXR1cm4gbmV3IEwuQ29udHJvbC5TY2FsZShvcHRpb25zKTsKfTsKCgovKgogKiBMLkNvbnRyb2wuTGF5ZXJzIGlzIGEgY29udHJvbCB0byBhbGxvdyB1c2VycyB0byBzd2l0Y2ggYmV0d2VlbiBkaWZmZXJlbnQgbGF5ZXJzIG9uIHRoZSBtYXAuCiAqLwoKTC5Db250cm9sLkxheWVycyA9IEwuQ29udHJvbC5leHRlbmQoewoJb3B0aW9uczogewoJCWNvbGxhcHNlZDogdHJ1ZSwKCQlwb3NpdGlvbjogJ3RvcHJpZ2h0JywKCQlhdXRvWkluZGV4OiB0cnVlCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChiYXNlTGF5ZXJzLCBvdmVybGF5cywgb3B0aW9ucykgewoJCUwuc2V0T3B0aW9ucyh0aGlzLCBvcHRpb25zKTsKCgkJdGhpcy5fbGF5ZXJzID0ge307CgkJdGhpcy5fbGFzdFpJbmRleCA9IDA7CgkJdGhpcy5faGFuZGxpbmdDbGljayA9IGZhbHNlOwoKCQlmb3IgKHZhciBpIGluIGJhc2VMYXllcnMpIHsKCQkJdGhpcy5fYWRkTGF5ZXIoYmFzZUxheWVyc1tpXSwgaSk7CgkJfQoKCQlmb3IgKGkgaW4gb3ZlcmxheXMpIHsKCQkJdGhpcy5fYWRkTGF5ZXIob3ZlcmxheXNbaV0sIGksIHRydWUpOwoJCX0KCX0sCgoJb25BZGQ6IGZ1bmN0aW9uIChtYXApIHsKCQl0aGlzLl9pbml0TGF5b3V0KCk7CgkJdGhpcy5fdXBkYXRlKCk7CgoJCW1hcAoJCSAgICAub24oJ2xheWVyYWRkJywgdGhpcy5fb25MYXllckNoYW5nZSwgdGhpcykKCQkgICAgLm9uKCdsYXllcnJlbW92ZScsIHRoaXMuX29uTGF5ZXJDaGFuZ2UsIHRoaXMpOwoKCQlyZXR1cm4gdGhpcy5fY29udGFpbmVyOwoJfSwKCglvblJlbW92ZTogZnVuY3Rpb24gKG1hcCkgewoJCW1hcAoJCSAgICAub2ZmKCdsYXllcmFkZCcsIHRoaXMuX29uTGF5ZXJDaGFuZ2UsIHRoaXMpCgkJICAgIC5vZmYoJ2xheWVycmVtb3ZlJywgdGhpcy5fb25MYXllckNoYW5nZSwgdGhpcyk7Cgl9LAoKCWFkZEJhc2VMYXllcjogZnVuY3Rpb24gKGxheWVyLCBuYW1lKSB7CgkJdGhpcy5fYWRkTGF5ZXIobGF5ZXIsIG5hbWUpOwoJCXRoaXMuX3VwZGF0ZSgpOwoJCXJldHVybiB0aGlzOwoJfSwKCglhZGRPdmVybGF5OiBmdW5jdGlvbiAobGF5ZXIsIG5hbWUpIHsKCQl0aGlzLl9hZGRMYXllcihsYXllciwgbmFtZSwgdHJ1ZSk7CgkJdGhpcy5fdXBkYXRlKCk7CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXJlbW92ZUxheWVyOiBmdW5jdGlvbiAobGF5ZXIpIHsKCQl2YXIgaWQgPSBMLnN0YW1wKGxheWVyKTsKCQlkZWxldGUgdGhpcy5fbGF5ZXJzW2lkXTsKCQl0aGlzLl91cGRhdGUoKTsKCQlyZXR1cm4gdGhpczsKCX0sCgoJX2luaXRMYXlvdXQ6IGZ1bmN0aW9uICgpIHsKCQl2YXIgY2xhc3NOYW1lID0gJ2xlYWZsZXQtY29udHJvbC1sYXllcnMnLAoJCSAgICBjb250YWluZXIgPSB0aGlzLl9jb250YWluZXIgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCBjbGFzc05hbWUpOwoKCQkvL01ha2VzIHRoaXMgd29yayBvbiBJRTEwIFRvdWNoIGRldmljZXMgYnkgc3RvcHBpbmcgaXQgZnJvbSBmaXJpbmcgYSBtb3VzZW91dCBldmVudCB3aGVuIHRoZSB0b3VjaCBpcyByZWxlYXNlZAoJCWNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGFzcG9wdXAnLCB0cnVlKTsKCgkJaWYgKCFMLkJyb3dzZXIudG91Y2gpIHsKCQkJTC5Eb21FdmVudAoJCQkJLmRpc2FibGVDbGlja1Byb3BhZ2F0aW9uKGNvbnRhaW5lcikKCQkJCS5kaXNhYmxlU2Nyb2xsUHJvcGFnYXRpb24oY29udGFpbmVyKTsKCQl9IGVsc2UgewoJCQlMLkRvbUV2ZW50Lm9uKGNvbnRhaW5lciwgJ2NsaWNrJywgTC5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24pOwoJCX0KCgkJdmFyIGZvcm0gPSB0aGlzLl9mb3JtID0gTC5Eb21VdGlsLmNyZWF0ZSgnZm9ybScsIGNsYXNzTmFtZSArICctbGlzdCcpOwoKCQlpZiAodGhpcy5vcHRpb25zLmNvbGxhcHNlZCkgewoJCQlpZiAoIUwuQnJvd3Nlci5hbmRyb2lkKSB7CgkJCQlMLkRvbUV2ZW50CgkJCQkgICAgLm9uKGNvbnRhaW5lciwgJ21vdXNlb3ZlcicsIHRoaXMuX2V4cGFuZCwgdGhpcykKCQkJCSAgICAub24oY29udGFpbmVyLCAnbW91c2VvdXQnLCB0aGlzLl9jb2xsYXBzZSwgdGhpcyk7CgkJCX0KCQkJdmFyIGxpbmsgPSB0aGlzLl9sYXllcnNMaW5rID0gTC5Eb21VdGlsLmNyZWF0ZSgnYScsIGNsYXNzTmFtZSArICctdG9nZ2xlJywgY29udGFpbmVyKTsKCQkJbGluay5ocmVmID0gJyMnOwoJCQlsaW5rLnRpdGxlID0gJ0xheWVycyc7CgoJCQlpZiAoTC5Ccm93c2VyLnRvdWNoKSB7CgkJCQlMLkRvbUV2ZW50CgkJCQkgICAgLm9uKGxpbmssICdjbGljaycsIEwuRG9tRXZlbnQuc3RvcCkKCQkJCSAgICAub24obGluaywgJ2NsaWNrJywgdGhpcy5fZXhwYW5kLCB0aGlzKTsKCQkJfQoJCQllbHNlIHsKCQkJCUwuRG9tRXZlbnQub24obGluaywgJ2ZvY3VzJywgdGhpcy5fZXhwYW5kLCB0aGlzKTsKCQkJfQoJCQkvL1dvcmsgYXJvdW5kIGZvciBGaXJlZm94IGFuZHJvaWQgaXNzdWUgaHR0cHM6Ly9naXRodWIuY29tL0xlYWZsZXQvTGVhZmxldC9pc3N1ZXMvMjAzMwoJCQlMLkRvbUV2ZW50Lm9uKGZvcm0sICdjbGljaycsIGZ1bmN0aW9uICgpIHsKCQkJCXNldFRpbWVvdXQoTC5iaW5kKHRoaXMuX29uSW5wdXRDbGljaywgdGhpcyksIDApOwoJCQl9LCB0aGlzKTsKCgkJCXRoaXMuX21hcC5vbignY2xpY2snLCB0aGlzLl9jb2xsYXBzZSwgdGhpcyk7CgkJCS8vIFRPRE8ga2V5Ym9hcmQgYWNjZXNzaWJpbGl0eQoJCX0gZWxzZSB7CgkJCXRoaXMuX2V4cGFuZCgpOwoJCX0KCgkJdGhpcy5fYmFzZUxheWVyc0xpc3QgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCBjbGFzc05hbWUgKyAnLWJhc2UnLCBmb3JtKTsKCQl0aGlzLl9zZXBhcmF0b3IgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCBjbGFzc05hbWUgKyAnLXNlcGFyYXRvcicsIGZvcm0pOwoJCXRoaXMuX292ZXJsYXlzTGlzdCA9IEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsIGNsYXNzTmFtZSArICctb3ZlcmxheXMnLCBmb3JtKTsKCgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGZvcm0pOwoJfSwKCglfYWRkTGF5ZXI6IGZ1bmN0aW9uIChsYXllciwgbmFtZSwgb3ZlcmxheSkgewoJCXZhciBpZCA9IEwuc3RhbXAobGF5ZXIpOwoKCQl0aGlzLl9sYXllcnNbaWRdID0gewoJCQlsYXllcjogbGF5ZXIsCgkJCW5hbWU6IG5hbWUsCgkJCW92ZXJsYXk6IG92ZXJsYXkKCQl9OwoKCQlpZiAodGhpcy5vcHRpb25zLmF1dG9aSW5kZXggJiYgbGF5ZXIuc2V0WkluZGV4KSB7CgkJCXRoaXMuX2xhc3RaSW5kZXgrKzsKCQkJbGF5ZXIuc2V0WkluZGV4KHRoaXMuX2xhc3RaSW5kZXgpOwoJCX0KCX0sCgoJX3VwZGF0ZTogZnVuY3Rpb24gKCkgewoJCWlmICghdGhpcy5fY29udGFpbmVyKSB7CgkJCXJldHVybjsKCQl9CgoJCXRoaXMuX2Jhc2VMYXllcnNMaXN0LmlubmVySFRNTCA9ICcnOwoJCXRoaXMuX292ZXJsYXlzTGlzdC5pbm5lckhUTUwgPSAnJzsKCgkJdmFyIGJhc2VMYXllcnNQcmVzZW50ID0gZmFsc2UsCgkJICAgIG92ZXJsYXlzUHJlc2VudCA9IGZhbHNlLAoJCSAgICBpLCBvYmo7CgoJCWZvciAoaSBpbiB0aGlzLl9sYXllcnMpIHsKCQkJb2JqID0gdGhpcy5fbGF5ZXJzW2ldOwoJCQl0aGlzLl9hZGRJdGVtKG9iaik7CgkJCW92ZXJsYXlzUHJlc2VudCA9IG92ZXJsYXlzUHJlc2VudCB8fCBvYmoub3ZlcmxheTsKCQkJYmFzZUxheWVyc1ByZXNlbnQgPSBiYXNlTGF5ZXJzUHJlc2VudCB8fCAhb2JqLm92ZXJsYXk7CgkJfQoKCQl0aGlzLl9zZXBhcmF0b3Iuc3R5bGUuZGlzcGxheSA9IG92ZXJsYXlzUHJlc2VudCAmJiBiYXNlTGF5ZXJzUHJlc2VudCA/ICcnIDogJ25vbmUnOwoJfSwKCglfb25MYXllckNoYW5nZTogZnVuY3Rpb24gKGUpIHsKCQl2YXIgb2JqID0gdGhpcy5fbGF5ZXJzW0wuc3RhbXAoZS5sYXllcildOwoKCQlpZiAoIW9iaikgeyByZXR1cm47IH0KCgkJaWYgKCF0aGlzLl9oYW5kbGluZ0NsaWNrKSB7CgkJCXRoaXMuX3VwZGF0ZSgpOwoJCX0KCgkJdmFyIHR5cGUgPSBvYmoub3ZlcmxheSA/CgkJCShlLnR5cGUgPT09ICdsYXllcmFkZCcgPyAnb3ZlcmxheWFkZCcgOiAnb3ZlcmxheXJlbW92ZScpIDoKCQkJKGUudHlwZSA9PT0gJ2xheWVyYWRkJyA/ICdiYXNlbGF5ZXJjaGFuZ2UnIDogbnVsbCk7CgoJCWlmICh0eXBlKSB7CgkJCXRoaXMuX21hcC5maXJlKHR5cGUsIG9iaik7CgkJfQoJfSwKCgkvLyBJRTcgYnVncyBvdXQgaWYgeW91IGNyZWF0ZSBhIHJhZGlvIGR5bmFtaWNhbGx5LCBzbyB5b3UgaGF2ZSB0byBkbyBpdCB0aGlzIGhhY2t5IHdheSAoc2VlIGh0dHA6Ly9iaXQubHkvUHFZTEJlKQoJX2NyZWF0ZVJhZGlvRWxlbWVudDogZnVuY3Rpb24gKG5hbWUsIGNoZWNrZWQpIHsKCgkJdmFyIHJhZGlvSHRtbCA9ICc8aW5wdXQgdHlwZT0icmFkaW8iIGNsYXNzPSJsZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLXNlbGVjdG9yIiBuYW1lPSInICsgbmFtZSArICciJzsKCQlpZiAoY2hlY2tlZCkgewoJCQlyYWRpb0h0bWwgKz0gJyBjaGVja2VkPSJjaGVja2VkIic7CgkJfQoJCXJhZGlvSHRtbCArPSAnLz4nOwoKCQl2YXIgcmFkaW9GcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCXJhZGlvRnJhZ21lbnQuaW5uZXJIVE1MID0gcmFkaW9IdG1sOwoKCQlyZXR1cm4gcmFkaW9GcmFnbWVudC5maXJzdENoaWxkOwoJfSwKCglfYWRkSXRlbTogZnVuY3Rpb24gKG9iaikgewoJCXZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyksCgkJICAgIGlucHV0LAoJCSAgICBjaGVja2VkID0gdGhpcy5fbWFwLmhhc0xheWVyKG9iai5sYXllcik7CgoJCWlmIChvYmoub3ZlcmxheSkgewoJCQlpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CgkJCWlucHV0LnR5cGUgPSAnY2hlY2tib3gnOwoJCQlpbnB1dC5jbGFzc05hbWUgPSAnbGVhZmxldC1jb250cm9sLWxheWVycy1zZWxlY3Rvcic7CgkJCWlucHV0LmRlZmF1bHRDaGVja2VkID0gY2hlY2tlZDsKCQl9IGVsc2UgewoJCQlpbnB1dCA9IHRoaXMuX2NyZWF0ZVJhZGlvRWxlbWVudCgnbGVhZmxldC1iYXNlLWxheWVycycsIGNoZWNrZWQpOwoJCX0KCgkJaW5wdXQubGF5ZXJJZCA9IEwuc3RhbXAob2JqLmxheWVyKTsKCgkJTC5Eb21FdmVudC5vbihpbnB1dCwgJ2NsaWNrJywgdGhpcy5fb25JbnB1dENsaWNrLCB0aGlzKTsKCgkJdmFyIG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CgkJbmFtZS5pbm5lckhUTUwgPSAnICcgKyBvYmoubmFtZTsKCgkJbGFiZWwuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJCWxhYmVsLmFwcGVuZENoaWxkKG5hbWUpOwoKCQl2YXIgY29udGFpbmVyID0gb2JqLm92ZXJsYXkgPyB0aGlzLl9vdmVybGF5c0xpc3QgOiB0aGlzLl9iYXNlTGF5ZXJzTGlzdDsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQobGFiZWwpOwoKCQlyZXR1cm4gbGFiZWw7Cgl9LAoKCV9vbklucHV0Q2xpY2s6IGZ1bmN0aW9uICgpIHsKCQl2YXIgaSwgaW5wdXQsIG9iaiwKCQkgICAgaW5wdXRzID0gdGhpcy5fZm9ybS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKSwKCQkgICAgaW5wdXRzTGVuID0gaW5wdXRzLmxlbmd0aDsKCgkJdGhpcy5faGFuZGxpbmdDbGljayA9IHRydWU7CgoJCWZvciAoaSA9IDA7IGkgPCBpbnB1dHNMZW47IGkrKykgewoJCQlpbnB1dCA9IGlucHV0c1tpXTsKCQkJb2JqID0gdGhpcy5fbGF5ZXJzW2lucHV0LmxheWVySWRdOwoKCQkJaWYgKGlucHV0LmNoZWNrZWQgJiYgIXRoaXMuX21hcC5oYXNMYXllcihvYmoubGF5ZXIpKSB7CgkJCQl0aGlzLl9tYXAuYWRkTGF5ZXIob2JqLmxheWVyKTsKCgkJCX0gZWxzZSBpZiAoIWlucHV0LmNoZWNrZWQgJiYgdGhpcy5fbWFwLmhhc0xheWVyKG9iai5sYXllcikpIHsKCQkJCXRoaXMuX21hcC5yZW1vdmVMYXllcihvYmoubGF5ZXIpOwoJCQl9CgkJfQoKCQl0aGlzLl9oYW5kbGluZ0NsaWNrID0gZmFsc2U7CgoJCXRoaXMuX3JlZm9jdXNPbk1hcCgpOwoJfSwKCglfZXhwYW5kOiBmdW5jdGlvbiAoKSB7CgkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX2NvbnRhaW5lciwgJ2xlYWZsZXQtY29udHJvbC1sYXllcnMtZXhwYW5kZWQnKTsKCX0sCgoJX2NvbGxhcHNlOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fY29udGFpbmVyLmNsYXNzTmFtZSA9IHRoaXMuX2NvbnRhaW5lci5jbGFzc05hbWUucmVwbGFjZSgnIGxlYWZsZXQtY29udHJvbC1sYXllcnMtZXhwYW5kZWQnLCAnJyk7Cgl9Cn0pOwoKTC5jb250cm9sLmxheWVycyA9IGZ1bmN0aW9uIChiYXNlTGF5ZXJzLCBvdmVybGF5cywgb3B0aW9ucykgewoJcmV0dXJuIG5ldyBMLkNvbnRyb2wuTGF5ZXJzKGJhc2VMYXllcnMsIG92ZXJsYXlzLCBvcHRpb25zKTsKfTsKCgovKgogKiBMLlBvc0FuaW1hdGlvbiBpcyB1c2VkIGJ5IExlYWZsZXQgaW50ZXJuYWxseSBmb3IgcGFuIGFuaW1hdGlvbnMuCiAqLwoKTC5Qb3NBbmltYXRpb24gPSBMLkNsYXNzLmV4dGVuZCh7CglpbmNsdWRlczogTC5NaXhpbi5FdmVudHMsCgoJcnVuOiBmdW5jdGlvbiAoZWwsIG5ld1BvcywgZHVyYXRpb24sIGVhc2VMaW5lYXJpdHkpIHsgLy8gKEhUTUxFbGVtZW50LCBQb2ludFssIE51bWJlciwgTnVtYmVyXSkKCQl0aGlzLnN0b3AoKTsKCgkJdGhpcy5fZWwgPSBlbDsKCQl0aGlzLl9pblByb2dyZXNzID0gdHJ1ZTsKCQl0aGlzLl9uZXdQb3MgPSBuZXdQb3M7CgoJCXRoaXMuZmlyZSgnc3RhcnQnKTsKCgkJZWwuc3R5bGVbTC5Eb21VdGlsLlRSQU5TSVRJT05dID0gJ2FsbCAnICsgKGR1cmF0aW9uIHx8IDAuMjUpICsKCQkgICAgICAgICdzIGN1YmljLWJlemllcigwLDAsJyArIChlYXNlTGluZWFyaXR5IHx8IDAuNSkgKyAnLDEpJzsKCgkJTC5Eb21FdmVudC5vbihlbCwgTC5Eb21VdGlsLlRSQU5TSVRJT05fRU5ELCB0aGlzLl9vblRyYW5zaXRpb25FbmQsIHRoaXMpOwoJCUwuRG9tVXRpbC5zZXRQb3NpdGlvbihlbCwgbmV3UG9zKTsKCgkJLy8gdG9nZ2xlIHJlZmxvdywgQ2hyb21lIGZsaWNrZXJzIGZvciBzb21lIHJlYXNvbiBpZiB5b3UgZG9uJ3QgZG8gdGhpcwoJCUwuVXRpbC5mYWxzZUZuKGVsLm9mZnNldFdpZHRoKTsKCgkJLy8gdGhlcmUncyBubyBuYXRpdmUgd2F5IHRvIHRyYWNrIHZhbHVlIHVwZGF0ZXMgb2YgdHJhbnNpdGlvbmVkIHByb3BlcnRpZXMsIHNvIHdlIGltaXRhdGUgdGhpcwoJCXRoaXMuX3N0ZXBUaW1lciA9IHNldEludGVydmFsKEwuYmluZCh0aGlzLl9vblN0ZXAsIHRoaXMpLCA1MCk7Cgl9LAoKCXN0b3A6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIXRoaXMuX2luUHJvZ3Jlc3MpIHsgcmV0dXJuOyB9CgoJCS8vIGlmIHdlIGp1c3QgcmVtb3ZlZCB0aGUgdHJhbnNpdGlvbiBwcm9wZXJ0eSwgdGhlIGVsZW1lbnQgd291bGQganVtcCB0byBpdHMgZmluYWwgcG9zaXRpb24sCgkJLy8gc28gd2UgbmVlZCB0byBtYWtlIGl0IHN0YXkgYXQgdGhlIGN1cnJlbnQgcG9zaXRpb24KCgkJTC5Eb21VdGlsLnNldFBvc2l0aW9uKHRoaXMuX2VsLCB0aGlzLl9nZXRQb3MoKSk7CgkJdGhpcy5fb25UcmFuc2l0aW9uRW5kKCk7CgkJTC5VdGlsLmZhbHNlRm4odGhpcy5fZWwub2Zmc2V0V2lkdGgpOyAvLyBmb3JjZSByZWZsb3cgaW4gY2FzZSB3ZSBhcmUgYWJvdXQgdG8gc3RhcnQgYSBuZXcgYW5pbWF0aW9uCgl9LAoKCV9vblN0ZXA6IGZ1bmN0aW9uICgpIHsKCQl2YXIgc3RlcFBvcyA9IHRoaXMuX2dldFBvcygpOwoJCWlmICghc3RlcFBvcykgewoJCQl0aGlzLl9vblRyYW5zaXRpb25FbmQoKTsKCQkJcmV0dXJuOwoJCX0KCQkvLyBqc2hpbnQgY2FtZWxjYXNlOiBmYWxzZQoJCS8vIG1ha2UgTC5Eb21VdGlsLmdldFBvc2l0aW9uIHJldHVybiBpbnRlcm1lZGlhdGUgcG9zaXRpb24gdmFsdWUgZHVyaW5nIGFuaW1hdGlvbgoJCXRoaXMuX2VsLl9sZWFmbGV0X3BvcyA9IHN0ZXBQb3M7CgoJCXRoaXMuZmlyZSgnc3RlcCcpOwoJfSwKCgkvLyB5b3UgY2FuJ3QgZWFzaWx5IGdldCBpbnRlcm1lZGlhdGUgdmFsdWVzIG9mIHByb3BlcnRpZXMgYW5pbWF0ZWQgd2l0aCBDU1MzIFRyYW5zaXRpb25zLAoJLy8gd2UgbmVlZCB0byBwYXJzZSBjb21wdXRlZCBzdHlsZSAoaW4gY2FzZSBvZiB0cmFuc2Zvcm0gaXQgcmV0dXJucyBtYXRyaXggc3RyaW5nKQoKCV90cmFuc2Zvcm1SZTogLyhbLStdPyg/OlxkKlwuKT9cZCspXEQqLCAoWy0rXT8oPzpcZCpcLik/XGQrKVxEKlwpLywKCglfZ2V0UG9zOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGxlZnQsIHRvcCwgbWF0Y2hlcywKCQkgICAgZWwgPSB0aGlzLl9lbCwKCQkgICAgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCk7CgoJCWlmIChMLkJyb3dzZXIuYW55M2QpIHsKCQkJbWF0Y2hlcyA9IHN0eWxlW0wuRG9tVXRpbC5UUkFOU0ZPUk1dLm1hdGNoKHRoaXMuX3RyYW5zZm9ybVJlKTsKCQkJaWYgKCFtYXRjaGVzKSB7IHJldHVybjsgfQoJCQlsZWZ0ID0gcGFyc2VGbG9hdChtYXRjaGVzWzFdKTsKCQkJdG9wICA9IHBhcnNlRmxvYXQobWF0Y2hlc1syXSk7CgkJfSBlbHNlIHsKCQkJbGVmdCA9IHBhcnNlRmxvYXQoc3R5bGUubGVmdCk7CgkJCXRvcCAgPSBwYXJzZUZsb2F0KHN0eWxlLnRvcCk7CgkJfQoKCQlyZXR1cm4gbmV3IEwuUG9pbnQobGVmdCwgdG9wLCB0cnVlKTsKCX0sCgoJX29uVHJhbnNpdGlvbkVuZDogZnVuY3Rpb24gKCkgewoJCUwuRG9tRXZlbnQub2ZmKHRoaXMuX2VsLCBMLkRvbVV0aWwuVFJBTlNJVElPTl9FTkQsIHRoaXMuX29uVHJhbnNpdGlvbkVuZCwgdGhpcyk7CgoJCWlmICghdGhpcy5faW5Qcm9ncmVzcykgeyByZXR1cm47IH0KCQl0aGlzLl9pblByb2dyZXNzID0gZmFsc2U7CgoJCXRoaXMuX2VsLnN0eWxlW0wuRG9tVXRpbC5UUkFOU0lUSU9OXSA9ICcnOwoKCQkvLyBqc2hpbnQgY2FtZWxjYXNlOiBmYWxzZQoJCS8vIG1ha2Ugc3VyZSBMLkRvbVV0aWwuZ2V0UG9zaXRpb24gcmV0dXJucyB0aGUgZmluYWwgcG9zaXRpb24gdmFsdWUgYWZ0ZXIgYW5pbWF0aW9uCgkJdGhpcy5fZWwuX2xlYWZsZXRfcG9zID0gdGhpcy5fbmV3UG9zOwoKCQljbGVhckludGVydmFsKHRoaXMuX3N0ZXBUaW1lcik7CgoJCXRoaXMuZmlyZSgnc3RlcCcpLmZpcmUoJ2VuZCcpOwoJfQoKfSk7CgoKLyoKICogRXh0ZW5kcyBMLk1hcCB0byBoYW5kbGUgcGFubmluZyBhbmltYXRpb25zLgogKi8KCkwuTWFwLmluY2x1ZGUoewoKCXNldFZpZXc6IGZ1bmN0aW9uIChjZW50ZXIsIHpvb20sIG9wdGlvbnMpIHsKCgkJem9vbSA9IHpvb20gPT09IHVuZGVmaW5lZCA/IHRoaXMuX3pvb20gOiB0aGlzLl9saW1pdFpvb20oem9vbSk7CgkJY2VudGVyID0gdGhpcy5fbGltaXRDZW50ZXIoTC5sYXRMbmcoY2VudGVyKSwgem9vbSwgdGhpcy5vcHRpb25zLm1heEJvdW5kcyk7CgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgoJCWlmICh0aGlzLl9wYW5BbmltKSB7CgkJCXRoaXMuX3BhbkFuaW0uc3RvcCgpOwoJCX0KCgkJaWYgKHRoaXMuX2xvYWRlZCAmJiAhb3B0aW9ucy5yZXNldCAmJiBvcHRpb25zICE9PSB0cnVlKSB7CgoJCQlpZiAob3B0aW9ucy5hbmltYXRlICE9PSB1bmRlZmluZWQpIHsKCQkJCW9wdGlvbnMuem9vbSA9IEwuZXh0ZW5kKHthbmltYXRlOiBvcHRpb25zLmFuaW1hdGV9LCBvcHRpb25zLnpvb20pOwoJCQkJb3B0aW9ucy5wYW4gPSBMLmV4dGVuZCh7YW5pbWF0ZTogb3B0aW9ucy5hbmltYXRlfSwgb3B0aW9ucy5wYW4pOwoJCQl9CgoJCQkvLyB0cnkgYW5pbWF0aW5nIHBhbiBvciB6b29tCgkJCXZhciBhbmltYXRlZCA9ICh0aGlzLl96b29tICE9PSB6b29tKSA/CgkJCQl0aGlzLl90cnlBbmltYXRlZFpvb20gJiYgdGhpcy5fdHJ5QW5pbWF0ZWRab29tKGNlbnRlciwgem9vbSwgb3B0aW9ucy56b29tKSA6CgkJCQl0aGlzLl90cnlBbmltYXRlZFBhbihjZW50ZXIsIG9wdGlvbnMucGFuKTsKCgkJCWlmIChhbmltYXRlZCkgewoJCQkJLy8gcHJldmVudCByZXNpemUgaGFuZGxlciBjYWxsLCB0aGUgdmlldyB3aWxsIHJlZnJlc2ggYWZ0ZXIgYW5pbWF0aW9uIGFueXdheQoJCQkJY2xlYXJUaW1lb3V0KHRoaXMuX3NpemVUaW1lcik7CgkJCQlyZXR1cm4gdGhpczsKCQkJfQoJCX0KCgkJLy8gYW5pbWF0aW9uIGRpZG4ndCBzdGFydCwganVzdCByZXNldCB0aGUgbWFwIHZpZXcKCQl0aGlzLl9yZXNldFZpZXcoY2VudGVyLCB6b29tKTsKCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXBhbkJ5OiBmdW5jdGlvbiAob2Zmc2V0LCBvcHRpb25zKSB7CgkJb2Zmc2V0ID0gTC5wb2ludChvZmZzZXQpLnJvdW5kKCk7CgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgoJCWlmICghb2Zmc2V0LnggJiYgIW9mZnNldC55KSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJaWYgKCF0aGlzLl9wYW5BbmltKSB7CgkJCXRoaXMuX3BhbkFuaW0gPSBuZXcgTC5Qb3NBbmltYXRpb24oKTsKCgkJCXRoaXMuX3BhbkFuaW0ub24oewoJCQkJJ3N0ZXAnOiB0aGlzLl9vblBhblRyYW5zaXRpb25TdGVwLAoJCQkJJ2VuZCc6IHRoaXMuX29uUGFuVHJhbnNpdGlvbkVuZAoJCQl9LCB0aGlzKTsKCQl9CgoJCS8vIGRvbid0IGZpcmUgbW92ZXN0YXJ0IGlmIGFuaW1hdGluZyBpbmVydGlhCgkJaWYgKCFvcHRpb25zLm5vTW92ZVN0YXJ0KSB7CgkJCXRoaXMuZmlyZSgnbW92ZXN0YXJ0Jyk7CgkJfQoKCQkvLyBhbmltYXRlIHBhbiB1bmxlc3MgYW5pbWF0ZTogZmFsc2Ugc3BlY2lmaWVkCgkJaWYgKG9wdGlvbnMuYW5pbWF0ZSAhPT0gZmFsc2UpIHsKCQkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX21hcFBhbmUsICdsZWFmbGV0LXBhbi1hbmltJyk7CgoJCQl2YXIgbmV3UG9zID0gdGhpcy5fZ2V0TWFwUGFuZVBvcygpLnN1YnRyYWN0KG9mZnNldCk7CgkJCXRoaXMuX3BhbkFuaW0ucnVuKHRoaXMuX21hcFBhbmUsIG5ld1Bvcywgb3B0aW9ucy5kdXJhdGlvbiB8fCAwLjI1LCBvcHRpb25zLmVhc2VMaW5lYXJpdHkpOwoJCX0gZWxzZSB7CgkJCXRoaXMuX3Jhd1BhbkJ5KG9mZnNldCk7CgkJCXRoaXMuZmlyZSgnbW92ZScpLmZpcmUoJ21vdmVlbmQnKTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCglfb25QYW5UcmFuc2l0aW9uU3RlcDogZnVuY3Rpb24gKCkgewoJCXRoaXMuZmlyZSgnbW92ZScpOwoJfSwKCglfb25QYW5UcmFuc2l0aW9uRW5kOiBmdW5jdGlvbiAoKSB7CgkJTC5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX21hcFBhbmUsICdsZWFmbGV0LXBhbi1hbmltJyk7CgkJdGhpcy5maXJlKCdtb3ZlZW5kJyk7Cgl9LAoKCV90cnlBbmltYXRlZFBhbjogZnVuY3Rpb24gKGNlbnRlciwgb3B0aW9ucykgewoJCS8vIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUgbmV3IGFuZCBjdXJyZW50IGNlbnRlcnMgaW4gcGl4ZWxzCgkJdmFyIG9mZnNldCA9IHRoaXMuX2dldENlbnRlck9mZnNldChjZW50ZXIpLl9mbG9vcigpOwoKCQkvLyBkb24ndCBhbmltYXRlIHRvbyBmYXIgdW5sZXNzIGFuaW1hdGU6IHRydWUgc3BlY2lmaWVkIGluIG9wdGlvbnMKCQlpZiAoKG9wdGlvbnMgJiYgb3B0aW9ucy5hbmltYXRlKSAhPT0gdHJ1ZSAmJiAhdGhpcy5nZXRTaXplKCkuY29udGFpbnMob2Zmc2V0KSkgeyByZXR1cm4gZmFsc2U7IH0KCgkJdGhpcy5wYW5CeShvZmZzZXQsIG9wdGlvbnMpOwoKCQlyZXR1cm4gdHJ1ZTsKCX0KfSk7CgoKLyoKICogTC5Qb3NBbmltYXRpb24gZmFsbGJhY2sgaW1wbGVtZW50YXRpb24gdGhhdCBwb3dlcnMgTGVhZmxldCBwYW4gYW5pbWF0aW9ucwogKiBpbiBicm93c2VycyB0aGF0IGRvbid0IHN1cHBvcnQgQ1NTMyBUcmFuc2l0aW9ucy4KICovCgpMLlBvc0FuaW1hdGlvbiA9IEwuRG9tVXRpbC5UUkFOU0lUSU9OID8gTC5Qb3NBbmltYXRpb24gOiBMLlBvc0FuaW1hdGlvbi5leHRlbmQoewoKCXJ1bjogZnVuY3Rpb24gKGVsLCBuZXdQb3MsIGR1cmF0aW9uLCBlYXNlTGluZWFyaXR5KSB7IC8vIChIVE1MRWxlbWVudCwgUG9pbnRbLCBOdW1iZXIsIE51bWJlcl0pCgkJdGhpcy5zdG9wKCk7CgoJCXRoaXMuX2VsID0gZWw7CgkJdGhpcy5faW5Qcm9ncmVzcyA9IHRydWU7CgkJdGhpcy5fZHVyYXRpb24gPSBkdXJhdGlvbiB8fCAwLjI1OwoJCXRoaXMuX2Vhc2VPdXRQb3dlciA9IDEgLyBNYXRoLm1heChlYXNlTGluZWFyaXR5IHx8IDAuNSwgMC4yKTsKCgkJdGhpcy5fc3RhcnRQb3MgPSBMLkRvbVV0aWwuZ2V0UG9zaXRpb24oZWwpOwoJCXRoaXMuX29mZnNldCA9IG5ld1Bvcy5zdWJ0cmFjdCh0aGlzLl9zdGFydFBvcyk7CgkJdGhpcy5fc3RhcnRUaW1lID0gK25ldyBEYXRlKCk7CgoJCXRoaXMuZmlyZSgnc3RhcnQnKTsKCgkJdGhpcy5fYW5pbWF0ZSgpOwoJfSwKCglzdG9wOiBmdW5jdGlvbiAoKSB7CgkJaWYgKCF0aGlzLl9pblByb2dyZXNzKSB7IHJldHVybjsgfQoKCQl0aGlzLl9zdGVwKCk7CgkJdGhpcy5fY29tcGxldGUoKTsKCX0sCgoJX2FuaW1hdGU6IGZ1bmN0aW9uICgpIHsKCQkvLyBhbmltYXRpb24gbG9vcAoJCXRoaXMuX2FuaW1JZCA9IEwuVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKHRoaXMuX2FuaW1hdGUsIHRoaXMpOwoJCXRoaXMuX3N0ZXAoKTsKCX0sCgoJX3N0ZXA6IGZ1bmN0aW9uICgpIHsKCQl2YXIgZWxhcHNlZCA9ICgrbmV3IERhdGUoKSkgLSB0aGlzLl9zdGFydFRpbWUsCgkJICAgIGR1cmF0aW9uID0gdGhpcy5fZHVyYXRpb24gKiAxMDAwOwoKCQlpZiAoZWxhcHNlZCA8IGR1cmF0aW9uKSB7CgkJCXRoaXMuX3J1bkZyYW1lKHRoaXMuX2Vhc2VPdXQoZWxhcHNlZCAvIGR1cmF0aW9uKSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5fcnVuRnJhbWUoMSk7CgkJCXRoaXMuX2NvbXBsZXRlKCk7CgkJfQoJfSwKCglfcnVuRnJhbWU6IGZ1bmN0aW9uIChwcm9ncmVzcykgewoJCXZhciBwb3MgPSB0aGlzLl9zdGFydFBvcy5hZGQodGhpcy5fb2Zmc2V0Lm11bHRpcGx5QnkocHJvZ3Jlc3MpKTsKCQlMLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fZWwsIHBvcyk7CgoJCXRoaXMuZmlyZSgnc3RlcCcpOwoJfSwKCglfY29tcGxldGU6IGZ1bmN0aW9uICgpIHsKCQlMLlV0aWwuY2FuY2VsQW5pbUZyYW1lKHRoaXMuX2FuaW1JZCk7CgoJCXRoaXMuX2luUHJvZ3Jlc3MgPSBmYWxzZTsKCQl0aGlzLmZpcmUoJ2VuZCcpOwoJfSwKCglfZWFzZU91dDogZnVuY3Rpb24gKHQpIHsKCQlyZXR1cm4gMSAtIE1hdGgucG93KDEgLSB0LCB0aGlzLl9lYXNlT3V0UG93ZXIpOwoJfQp9KTsKCgovKgogKiBFeHRlbmRzIEwuTWFwIHRvIGhhbmRsZSB6b29tIGFuaW1hdGlvbnMuCiAqLwoKTC5NYXAubWVyZ2VPcHRpb25zKHsKCXpvb21BbmltYXRpb246IHRydWUsCgl6b29tQW5pbWF0aW9uVGhyZXNob2xkOiA0Cn0pOwoKaWYgKEwuRG9tVXRpbC5UUkFOU0lUSU9OKSB7CgoJTC5NYXAuYWRkSW5pdEhvb2soZnVuY3Rpb24gKCkgewoJCS8vIGRvbid0IGFuaW1hdGUgb24gYnJvd3NlcnMgd2l0aG91dCBoYXJkd2FyZS1hY2NlbGVyYXRlZCB0cmFuc2l0aW9ucyBvciBvbGQgQW5kcm9pZC9PcGVyYQoJCXRoaXMuX3pvb21BbmltYXRlZCA9IHRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uICYmIEwuRG9tVXRpbC5UUkFOU0lUSU9OICYmCgkJCQlMLkJyb3dzZXIuYW55M2QgJiYgIUwuQnJvd3Nlci5hbmRyb2lkMjMgJiYgIUwuQnJvd3Nlci5tb2JpbGVPcGVyYTsKCgkJLy8gem9vbSB0cmFuc2l0aW9ucyBydW4gd2l0aCB0aGUgc2FtZSBkdXJhdGlvbiBmb3IgYWxsIGxheWVycywgc28gaWYgb25lIG9mIHRyYW5zaXRpb25lbmQgZXZlbnRzCgkJLy8gaGFwcGVucyBhZnRlciBzdGFydGluZyB6b29tIGFuaW1hdGlvbiAocHJvcGFnYXRpbmcgdG8gdGhlIG1hcCBwYW5lKSwgd2Uga25vdyB0aGF0IGl0IGVuZGVkIGdsb2JhbGx5CgkJaWYgKHRoaXMuX3pvb21BbmltYXRlZCkgewoJCQlMLkRvbUV2ZW50Lm9uKHRoaXMuX21hcFBhbmUsIEwuRG9tVXRpbC5UUkFOU0lUSU9OX0VORCwgdGhpcy5fY2F0Y2hUcmFuc2l0aW9uRW5kLCB0aGlzKTsKCQl9Cgl9KTsKfQoKTC5NYXAuaW5jbHVkZSghTC5Eb21VdGlsLlRSQU5TSVRJT04gPyB7fSA6IHsKCglfY2F0Y2hUcmFuc2l0aW9uRW5kOiBmdW5jdGlvbiAoZSkgewoJCWlmICh0aGlzLl9hbmltYXRpbmdab29tICYmIGUucHJvcGVydHlOYW1lLmluZGV4T2YoJ3RyYW5zZm9ybScpID49IDApIHsKCQkJdGhpcy5fb25ab29tVHJhbnNpdGlvbkVuZCgpOwoJCX0KCX0sCgoJX25vdGhpbmdUb0FuaW1hdGU6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gIXRoaXMuX2NvbnRhaW5lci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdsZWFmbGV0LXpvb20tYW5pbWF0ZWQnKS5sZW5ndGg7Cgl9LAoKCV90cnlBbmltYXRlZFpvb206IGZ1bmN0aW9uIChjZW50ZXIsIHpvb20sIG9wdGlvbnMpIHsKCgkJaWYgKHRoaXMuX2FuaW1hdGluZ1pvb20pIHsgcmV0dXJuIHRydWU7IH0KCgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgoJCS8vIGRvbid0IGFuaW1hdGUgaWYgZGlzYWJsZWQsIG5vdCBzdXBwb3J0ZWQgb3Igem9vbSBkaWZmZXJlbmNlIGlzIHRvbyBsYXJnZQoJCWlmICghdGhpcy5fem9vbUFuaW1hdGVkIHx8IG9wdGlvbnMuYW5pbWF0ZSA9PT0gZmFsc2UgfHwgdGhpcy5fbm90aGluZ1RvQW5pbWF0ZSgpIHx8CgkJICAgICAgICBNYXRoLmFicyh6b29tIC0gdGhpcy5fem9vbSkgPiB0aGlzLm9wdGlvbnMuem9vbUFuaW1hdGlvblRocmVzaG9sZCkgeyByZXR1cm4gZmFsc2U7IH0KCgkJLy8gb2Zmc2V0IGlzIHRoZSBwaXhlbCBjb29yZHMgb2YgdGhlIHpvb20gb3JpZ2luIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IGNlbnRlcgoJCXZhciBzY2FsZSA9IHRoaXMuZ2V0Wm9vbVNjYWxlKHpvb20pLAoJCSAgICBvZmZzZXQgPSB0aGlzLl9nZXRDZW50ZXJPZmZzZXQoY2VudGVyKS5fZGl2aWRlQnkoMSAtIDEgLyBzY2FsZSksCgkJCW9yaWdpbiA9IHRoaXMuX2dldENlbnRlckxheWVyUG9pbnQoKS5fYWRkKG9mZnNldCk7CgoJCS8vIGRvbid0IGFuaW1hdGUgaWYgdGhlIHpvb20gb3JpZ2luIGlzbid0IHdpdGhpbiBvbmUgc2NyZWVuIGZyb20gdGhlIGN1cnJlbnQgY2VudGVyLCB1bmxlc3MgZm9yY2VkCgkJaWYgKG9wdGlvbnMuYW5pbWF0ZSAhPT0gdHJ1ZSAmJiAhdGhpcy5nZXRTaXplKCkuY29udGFpbnMob2Zmc2V0KSkgeyByZXR1cm4gZmFsc2U7IH0KCgkJdGhpcwoJCSAgICAuZmlyZSgnbW92ZXN0YXJ0JykKCQkgICAgLmZpcmUoJ3pvb21zdGFydCcpOwoKCQl0aGlzLl9hbmltYXRlWm9vbShjZW50ZXIsIHpvb20sIG9yaWdpbiwgc2NhbGUsIG51bGwsIHRydWUpOwoKCQlyZXR1cm4gdHJ1ZTsKCX0sCgoJX2FuaW1hdGVab29tOiBmdW5jdGlvbiAoY2VudGVyLCB6b29tLCBvcmlnaW4sIHNjYWxlLCBkZWx0YSwgYmFja3dhcmRzLCBmb3JUb3VjaFpvb20pIHsKCgkJaWYgKCFmb3JUb3VjaFpvb20pIHsKCQkJdGhpcy5fYW5pbWF0aW5nWm9vbSA9IHRydWU7CgkJfQoKCQkvLyBwdXQgdHJhbnNmb3JtIHRyYW5zaXRpb24gb24gYWxsIGxheWVycyB3aXRoIGxlYWZsZXQtem9vbS1hbmltYXRlZCBjbGFzcwoJCUwuRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl9tYXBQYW5lLCAnbGVhZmxldC16b29tLWFuaW0nKTsKCgkJLy8gcmVtZW1iZXIgd2hhdCBjZW50ZXIvem9vbSB0byBzZXQgYWZ0ZXIgYW5pbWF0aW9uCgkJdGhpcy5fYW5pbWF0ZVRvQ2VudGVyID0gY2VudGVyOwoJCXRoaXMuX2FuaW1hdGVUb1pvb20gPSB6b29tOwoKCQkvLyBkaXNhYmxlIGFueSBkcmFnZ2luZyBkdXJpbmcgYW5pbWF0aW9uCgkJaWYgKEwuRHJhZ2dhYmxlKSB7CgkJCUwuRHJhZ2dhYmxlLl9kaXNhYmxlZCA9IHRydWU7CgkJfQoKCQlMLlV0aWwucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiAoKSB7CgkJCXRoaXMuZmlyZSgnem9vbWFuaW0nLCB7CgkJCQljZW50ZXI6IGNlbnRlciwKCQkJCXpvb206IHpvb20sCgkJCQlvcmlnaW46IG9yaWdpbiwKCQkJCXNjYWxlOiBzY2FsZSwKCQkJCWRlbHRhOiBkZWx0YSwKCQkJCWJhY2t3YXJkczogYmFja3dhcmRzCgkJCX0pOwoJCX0sIHRoaXMpOwoJfSwKCglfb25ab29tVHJhbnNpdGlvbkVuZDogZnVuY3Rpb24gKCkgewoKCQl0aGlzLl9hbmltYXRpbmdab29tID0gZmFsc2U7CgoJCUwuRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl9tYXBQYW5lLCAnbGVhZmxldC16b29tLWFuaW0nKTsKCgkJdGhpcy5fcmVzZXRWaWV3KHRoaXMuX2FuaW1hdGVUb0NlbnRlciwgdGhpcy5fYW5pbWF0ZVRvWm9vbSwgdHJ1ZSwgdHJ1ZSk7CgoJCWlmIChMLkRyYWdnYWJsZSkgewoJCQlMLkRyYWdnYWJsZS5fZGlzYWJsZWQgPSBmYWxzZTsKCQl9Cgl9Cn0pOwoKCi8qCglab29tIGFuaW1hdGlvbiBsb2dpYyBmb3IgTC5UaWxlTGF5ZXIuCiovCgpMLlRpbGVMYXllci5pbmNsdWRlKHsKCV9hbmltYXRlWm9vbTogZnVuY3Rpb24gKGUpIHsKCQlpZiAoIXRoaXMuX2FuaW1hdGluZykgewoJCQl0aGlzLl9hbmltYXRpbmcgPSB0cnVlOwoJCQl0aGlzLl9wcmVwYXJlQmdCdWZmZXIoKTsKCQl9CgoJCXZhciBiZyA9IHRoaXMuX2JnQnVmZmVyLAoJCSAgICB0cmFuc2Zvcm0gPSBMLkRvbVV0aWwuVFJBTlNGT1JNLAoJCSAgICBpbml0aWFsVHJhbnNmb3JtID0gZS5kZWx0YSA/IEwuRG9tVXRpbC5nZXRUcmFuc2xhdGVTdHJpbmcoZS5kZWx0YSkgOiBiZy5zdHlsZVt0cmFuc2Zvcm1dLAoJCSAgICBzY2FsZVN0ciA9IEwuRG9tVXRpbC5nZXRTY2FsZVN0cmluZyhlLnNjYWxlLCBlLm9yaWdpbik7CgoJCWJnLnN0eWxlW3RyYW5zZm9ybV0gPSBlLmJhY2t3YXJkcyA/CgkJCQlzY2FsZVN0ciArICcgJyArIGluaXRpYWxUcmFuc2Zvcm0gOgoJCQkJaW5pdGlhbFRyYW5zZm9ybSArICcgJyArIHNjYWxlU3RyOwoJfSwKCglfZW5kWm9vbUFuaW06IGZ1bmN0aW9uICgpIHsKCQl2YXIgZnJvbnQgPSB0aGlzLl90aWxlQ29udGFpbmVyLAoJCSAgICBiZyA9IHRoaXMuX2JnQnVmZmVyOwoKCQlmcm9udC5zdHlsZS52aXNpYmlsaXR5ID0gJyc7CgkJZnJvbnQucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChmcm9udCk7IC8vIEJyaW5nIHRvIGZvcmUKCgkJLy8gZm9yY2UgcmVmbG93CgkJTC5VdGlsLmZhbHNlRm4oYmcub2Zmc2V0V2lkdGgpOwoKCQl0aGlzLl9hbmltYXRpbmcgPSBmYWxzZTsKCX0sCgoJX2NsZWFyQmdCdWZmZXI6IGZ1bmN0aW9uICgpIHsKCQl2YXIgbWFwID0gdGhpcy5fbWFwOwoKCQlpZiAobWFwICYmICFtYXAuX2FuaW1hdGluZ1pvb20gJiYgIW1hcC50b3VjaFpvb20uX3pvb21pbmcpIHsKCQkJdGhpcy5fYmdCdWZmZXIuaW5uZXJIVE1MID0gJyc7CgkJCXRoaXMuX2JnQnVmZmVyLnN0eWxlW0wuRG9tVXRpbC5UUkFOU0ZPUk1dID0gJyc7CgkJfQoJfSwKCglfcHJlcGFyZUJnQnVmZmVyOiBmdW5jdGlvbiAoKSB7CgoJCXZhciBmcm9udCA9IHRoaXMuX3RpbGVDb250YWluZXIsCgkJICAgIGJnID0gdGhpcy5fYmdCdWZmZXI7CgoJCS8vIGlmIGZvcmVncm91bmQgbGF5ZXIgZG9lc24ndCBoYXZlIG1hbnkgdGlsZXMgYnV0IGJnIGxheWVyIGRvZXMsCgkJLy8ga2VlcCB0aGUgZXhpc3RpbmcgYmcgbGF5ZXIgYW5kIGp1c3Qgem9vbSBpdCBzb21lIG1vcmUKCgkJdmFyIGJnTG9hZGVkID0gdGhpcy5fZ2V0TG9hZGVkVGlsZXNQZXJjZW50YWdlKGJnKSwKCQkgICAgZnJvbnRMb2FkZWQgPSB0aGlzLl9nZXRMb2FkZWRUaWxlc1BlcmNlbnRhZ2UoZnJvbnQpOwoKCQlpZiAoYmcgJiYgYmdMb2FkZWQgPiAwLjUgJiYgZnJvbnRMb2FkZWQgPCAwLjUpIHsKCgkJCWZyb250LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsKCQkJdGhpcy5fc3RvcExvYWRpbmdJbWFnZXMoZnJvbnQpOwoJCQlyZXR1cm47CgkJfQoKCQkvLyBwcmVwYXJlIHRoZSBidWZmZXIgdG8gYmVjb21lIHRoZSBmcm9udCB0aWxlIHBhbmUKCQliZy5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7CgkJYmcuc3R5bGVbTC5Eb21VdGlsLlRSQU5TRk9STV0gPSAnJzsKCgkJLy8gc3dpdGNoIG91dCB0aGUgY3VycmVudCBsYXllciB0byBiZSB0aGUgbmV3IGJnIGxheWVyIChhbmQgdmljZS12ZXJzYSkKCQl0aGlzLl90aWxlQ29udGFpbmVyID0gYmc7CgkJYmcgPSB0aGlzLl9iZ0J1ZmZlciA9IGZyb250OwoKCQl0aGlzLl9zdG9wTG9hZGluZ0ltYWdlcyhiZyk7CgoJCS8vcHJldmVudCBiZyBidWZmZXIgZnJvbSBjbGVhcmluZyByaWdodCBhZnRlciB6b29tCgkJY2xlYXJUaW1lb3V0KHRoaXMuX2NsZWFyQmdCdWZmZXJUaW1lcik7Cgl9LAoKCV9nZXRMb2FkZWRUaWxlc1BlcmNlbnRhZ2U6IGZ1bmN0aW9uIChjb250YWluZXIpIHsKCQl2YXIgdGlsZXMgPSBjb250YWluZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ltZycpLAoJCSAgICBpLCBsZW4sIGNvdW50ID0gMDsKCgkJZm9yIChpID0gMCwgbGVuID0gdGlsZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJaWYgKHRpbGVzW2ldLmNvbXBsZXRlKSB7CgkJCQljb3VudCsrOwoJCQl9CgkJfQoJCXJldHVybiBjb3VudCAvIGxlbjsKCX0sCgoJLy8gc3RvcHMgbG9hZGluZyBhbGwgdGlsZXMgaW4gdGhlIGJhY2tncm91bmQgbGF5ZXIKCV9zdG9wTG9hZGluZ0ltYWdlczogZnVuY3Rpb24gKGNvbnRhaW5lcikgewoJCXZhciB0aWxlcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGNvbnRhaW5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW1nJykpLAoJCSAgICBpLCBsZW4sIHRpbGU7CgoJCWZvciAoaSA9IDAsIGxlbiA9IHRpbGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCXRpbGUgPSB0aWxlc1tpXTsKCgkJCWlmICghdGlsZS5jb21wbGV0ZSkgewoJCQkJdGlsZS5vbmxvYWQgPSBMLlV0aWwuZmFsc2VGbjsKCQkJCXRpbGUub25lcnJvciA9IEwuVXRpbC5mYWxzZUZuOwoJCQkJdGlsZS5zcmMgPSBMLlV0aWwuZW1wdHlJbWFnZVVybDsKCgkJCQl0aWxlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGlsZSk7CgkJCX0KCQl9Cgl9Cn0pOwoKCi8qCiAqIFByb3ZpZGVzIEwuTWFwIHdpdGggY29udmVuaWVudCBzaG9ydGN1dHMgZm9yIHVzaW5nIGJyb3dzZXIgZ2VvbG9jYXRpb24gZmVhdHVyZXMuCiAqLwoKTC5NYXAuaW5jbHVkZSh7CglfZGVmYXVsdExvY2F0ZU9wdGlvbnM6IHsKCQl3YXRjaDogZmFsc2UsCgkJc2V0VmlldzogZmFsc2UsCgkJbWF4Wm9vbTogSW5maW5pdHksCgkJdGltZW91dDogMTAwMDAsCgkJbWF4aW11bUFnZTogMCwKCQllbmFibGVIaWdoQWNjdXJhY3k6IGZhbHNlCgl9LAoKCWxvY2F0ZTogZnVuY3Rpb24gKC8qT2JqZWN0Ki8gb3B0aW9ucykgewoKCQlvcHRpb25zID0gdGhpcy5fbG9jYXRlT3B0aW9ucyA9IEwuZXh0ZW5kKHRoaXMuX2RlZmF1bHRMb2NhdGVPcHRpb25zLCBvcHRpb25zKTsKCgkJaWYgKCFuYXZpZ2F0b3IuZ2VvbG9jYXRpb24pIHsKCQkJdGhpcy5faGFuZGxlR2VvbG9jYXRpb25FcnJvcih7CgkJCQljb2RlOiAwLAoJCQkJbWVzc2FnZTogJ0dlb2xvY2F0aW9uIG5vdCBzdXBwb3J0ZWQuJwoJCQl9KTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQl2YXIgb25SZXNwb25zZSA9IEwuYmluZCh0aGlzLl9oYW5kbGVHZW9sb2NhdGlvblJlc3BvbnNlLCB0aGlzKSwKCQkJb25FcnJvciA9IEwuYmluZCh0aGlzLl9oYW5kbGVHZW9sb2NhdGlvbkVycm9yLCB0aGlzKTsKCgkJaWYgKG9wdGlvbnMud2F0Y2gpIHsKCQkJdGhpcy5fbG9jYXRpb25XYXRjaElkID0KCQkJICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24ud2F0Y2hQb3NpdGlvbihvblJlc3BvbnNlLCBvbkVycm9yLCBvcHRpb25zKTsKCQl9IGVsc2UgewoJCQluYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKG9uUmVzcG9uc2UsIG9uRXJyb3IsIG9wdGlvbnMpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0sCgoJc3RvcExvY2F0ZTogZnVuY3Rpb24gKCkgewoJCWlmIChuYXZpZ2F0b3IuZ2VvbG9jYXRpb24pIHsKCQkJbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmNsZWFyV2F0Y2godGhpcy5fbG9jYXRpb25XYXRjaElkKTsKCQl9CgkJaWYgKHRoaXMuX2xvY2F0ZU9wdGlvbnMpIHsKCQkJdGhpcy5fbG9jYXRlT3B0aW9ucy5zZXRWaWV3ID0gZmFsc2U7CgkJfQoJCXJldHVybiB0aGlzOwoJfSwKCglfaGFuZGxlR2VvbG9jYXRpb25FcnJvcjogZnVuY3Rpb24gKGVycm9yKSB7CgkJdmFyIGMgPSBlcnJvci5jb2RlLAoJCSAgICBtZXNzYWdlID0gZXJyb3IubWVzc2FnZSB8fAoJCSAgICAgICAgICAgIChjID09PSAxID8gJ3Blcm1pc3Npb24gZGVuaWVkJyA6CgkJICAgICAgICAgICAgKGMgPT09IDIgPyAncG9zaXRpb24gdW5hdmFpbGFibGUnIDogJ3RpbWVvdXQnKSk7CgoJCWlmICh0aGlzLl9sb2NhdGVPcHRpb25zLnNldFZpZXcgJiYgIXRoaXMuX2xvYWRlZCkgewoJCQl0aGlzLmZpdFdvcmxkKCk7CgkJfQoKCQl0aGlzLmZpcmUoJ2xvY2F0aW9uZXJyb3InLCB7CgkJCWNvZGU6IGMsCgkJCW1lc3NhZ2U6ICdHZW9sb2NhdGlvbiBlcnJvcjogJyArIG1lc3NhZ2UgKyAnLicKCQl9KTsKCX0sCgoJX2hhbmRsZUdlb2xvY2F0aW9uUmVzcG9uc2U6IGZ1bmN0aW9uIChwb3MpIHsKCQl2YXIgbGF0ID0gcG9zLmNvb3Jkcy5sYXRpdHVkZSwKCQkgICAgbG5nID0gcG9zLmNvb3Jkcy5sb25naXR1ZGUsCgkJICAgIGxhdGxuZyA9IG5ldyBMLkxhdExuZyhsYXQsIGxuZyksCgoJCSAgICBsYXRBY2N1cmFjeSA9IDE4MCAqIHBvcy5jb29yZHMuYWNjdXJhY3kgLyA0MDA3NTAxNywKCQkgICAgbG5nQWNjdXJhY3kgPSBsYXRBY2N1cmFjeSAvIE1hdGguY29zKEwuTGF0TG5nLkRFR19UT19SQUQgKiBsYXQpLAoKCQkgICAgYm91bmRzID0gTC5sYXRMbmdCb3VuZHMoCgkJICAgICAgICAgICAgW2xhdCAtIGxhdEFjY3VyYWN5LCBsbmcgLSBsbmdBY2N1cmFjeV0sCgkJICAgICAgICAgICAgW2xhdCArIGxhdEFjY3VyYWN5LCBsbmcgKyBsbmdBY2N1cmFjeV0pLAoKCQkgICAgb3B0aW9ucyA9IHRoaXMuX2xvY2F0ZU9wdGlvbnM7CgoJCWlmIChvcHRpb25zLnNldFZpZXcpIHsKCQkJdmFyIHpvb20gPSBNYXRoLm1pbih0aGlzLmdldEJvdW5kc1pvb20oYm91bmRzKSwgb3B0aW9ucy5tYXhab29tKTsKCQkJdGhpcy5zZXRWaWV3KGxhdGxuZywgem9vbSk7CgkJfQoKCQl2YXIgZGF0YSA9IHsKCQkJbGF0bG5nOiBsYXRsbmcsCgkJCWJvdW5kczogYm91bmRzLAoJCQl0aW1lc3RhbXA6IHBvcy50aW1lc3RhbXAKCQl9OwoKCQlmb3IgKHZhciBpIGluIHBvcy5jb29yZHMpIHsKCQkJaWYgKHR5cGVvZiBwb3MuY29vcmRzW2ldID09PSAnbnVtYmVyJykgewoJCQkJZGF0YVtpXSA9IHBvcy5jb29yZHNbaV07CgkJCX0KCQl9CgoJCXRoaXMuZmlyZSgnbG9jYXRpb25mb3VuZCcsIGRhdGEpOwoJfQp9KTsKCgp9KHdpbmRvdywgZG9jdW1lbnQpKTsKCi8qCkdlb2Rlc2ljIGV4dGVuc2lvbiB0byBMZWFmbGV0IGxpYnJhcnksIGJ5IEZyYWdnZXIKaHR0cHM6Ly9naXRodWIuY29tL0ZyYWdnZXIvTGVhZmxldC5HZW9kZXNpYwpWZXJzaW9uIGZyb20gbWFzdGVyIGJyYW5jaCwgZGF0ZWQgQXByIDI2LCAyMDEzCk1vZGlmaWVkIGJ5IHFuc3RpZSAyMDEzLTA3LTE3IHRvIG1haW50YWluIGNvbXBhdGliaWxpdHkgd2l0aCBMZWFmbGV0LmRyYXcKKi8KKGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBnZW9kZXNpY1BvbHkoS2xhc3MsIGZpbGwpIHsKICAgIHJldHVybiBLbGFzcy5leHRlbmQoewogICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAobGF0bG5ncywgb3B0aW9ucykgewogICAgICAgIEtsYXNzLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcywgTC5nZW9kZXNpY0NvbnZlcnRMaW5lcyhsYXRsbmdzLCBmaWxsKSwgb3B0aW9ucyk7CiAgICAgICAgdGhpcy5fbGF0bG5nc2luaXQgPSB0aGlzLl9jb252ZXJ0TGF0TG5ncyhsYXRsbmdzKTsKICAgICAgfSwKICAgICAgZ2V0TGF0TG5nczogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLl9sYXRsbmdzaW5pdDsKICAgICAgfSwKICAgICAgc2V0TGF0TG5nczogZnVuY3Rpb24gKGxhdGxuZ3MpIHsKICAgICAgICB0aGlzLl9sYXRsbmdzaW5pdCA9IHRoaXMuX2NvbnZlcnRMYXRMbmdzKGxhdGxuZ3MpOwogICAgICAgIHJldHVybiB0aGlzLnJlZHJhdygpOwogICAgICB9LAogICAgICBhZGRMYXRMbmc6IGZ1bmN0aW9uIChsYXRsbmcpIHsKICAgICAgICB0aGlzLl9sYXRsbmdzaW5pdC5wdXNoKEwubGF0TG5nKGxhdGxuZykpOwogICAgICAgIHJldHVybiB0aGlzLnJlZHJhdygpOwogICAgICB9LAogICAgICBzcGxpY2VMYXRMbmdzOiBmdW5jdGlvbiAoKSB7IC8vIChOdW1iZXIgaW5kZXgsIE51bWJlciBob3dNYW55KQogICAgICAgIHZhciByZW1vdmVkID0gW10uc3BsaWNlLmFwcGx5KHRoaXMuX2xhdGxuZ3Npbml0LCBhcmd1bWVudHMpOwogICAgICAgIHRoaXMuX2NvbnZlcnRMYXRMbmdzKHRoaXMuX2xhdGxuZ3Npbml0KTsKICAgICAgICB0aGlzLnJlZHJhdygpOwogICAgICAgIHJldHVybiByZW1vdmVkOwogICAgICB9LAogICAgICByZWRyYXc6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2xhdGxuZ3MgPSB0aGlzLl9jb252ZXJ0TGF0TG5ncyhMLmdlb2Rlc2ljQ29udmVydExpbmVzKHRoaXMuX2xhdGxuZ3Npbml0LCBmaWxsKSk7CiAgICAgICAgcmV0dXJuIEtsYXNzLnByb3RvdHlwZS5yZWRyYXcuY2FsbCh0aGlzKTsKICAgICAgfQogICAgfSk7CiAgfQoKICAvLyBhbHRlcm5hdGl2ZSBnZW9kZXNpYyBsaW5lIGludGVybWVkaWF0ZSBwb2ludHMgZnVuY3Rpb24KICAvLyBhcyBub3J0aC9zb3V0aCBsaW5lcyBoYXZlIHZlcnkgbGl0dGxlIGN1cnZhdHVyZSBpbiB0aGUgcHJvamVjdGlvbiwgd2UgY2FtIHVzZSBsb25naXR1ZGUgKGVhc3Qvd2VzdCkgc2VwZXJhdGlvbgogIC8vIHRvIGNhbGN1bGF0ZSBpbnRlcm1lZGlhdGUgcG9pbnRzLiBob3BlZWZ1bGx5IHRoaXMgd2lsbCBhdm9pZCB0aGUgcm91bmRpbmcgaXNzdWVzIHNlZW4gaW4gdGhlIGZ1bGwgaW50ZXJtZWRpYXRlCiAgLy8gcG9pbnRzIGNvZGUgdGhhdCBoYXZlIGJlZW4gc2VlbgogIGZ1bmN0aW9uIGdlb2Rlc2ljQ29udmVydExpbmUoc3RhcnRMYXRMbmcsIGVuZExhdExuZywgY29udmVydGVkUG9pbnRzKSB7CiAgICB2YXIgUiA9IDYzNjcwMDAuMDsgLy8gZWFydGggcmFkaXVzIGluIG1ldGVycyAoZG9lc24ndCBoYXZlIHRvIGJlIGV4YWN0KQogICAgdmFyIGQyciA9IE1hdGguUEkvMTgwLjA7CiAgICB2YXIgcjJkID0gMTgwLjAvTWF0aC5QSTsKCiAgICAvLyBtYXRocyBiYXNlZCBvbiBodHRwOi8vd2lsbGlhbXMuYmVzdC52d2gubmV0L2F2Zm9ybS5odG0jSW50CgogICAgdmFyIGxhdDEgPSBzdGFydExhdExuZy5sYXQgKiBkMnI7CiAgICB2YXIgbGF0MiA9IGVuZExhdExuZy5sYXQgKiBkMnI7CiAgICB2YXIgbG5nMSA9IHN0YXJ0TGF0TG5nLmxuZyAqIGQycjsKICAgIHZhciBsbmcyID0gZW5kTGF0TG5nLmxuZyAqIGQycjsKCiAgICB2YXIgZExuZyA9IGxuZzItbG5nMTsKCiAgICB2YXIgc2VnbWVudHMgPSBNYXRoLmZsb29yKE1hdGguYWJzKGRMbmcgKiBSIC8gNTAwMCkpOwoKICAgIGlmIChzZWdtZW50cyA+IDEpIHsKICAgICAgLy8gcHJlLWNhbGN1bGF0ZSBzb21lIGNvbnN0YW50IHZhbHVlcyBmb3IgdGhlIGxvb3AKICAgICAgdmFyIHNpbkxhdDEgPSBNYXRoLnNpbihsYXQxKTsKICAgICAgdmFyIHNpbkxhdDIgPSBNYXRoLnNpbihsYXQyKTsKICAgICAgdmFyIGNvc0xhdDEgPSBNYXRoLmNvcyhsYXQxKTsKICAgICAgdmFyIGNvc0xhdDIgPSBNYXRoLmNvcyhsYXQyKTsKCiAgICAgIHZhciBzaW5MYXQxQ29zTGF0MiA9IHNpbkxhdDEqY29zTGF0MjsKICAgICAgdmFyIHNpbkxhdDJDb3NMYXQxID0gc2luTGF0Mipjb3NMYXQxOwoKICAgICAgdmFyIGNvc0xhdDFDb3NMYXQyU2luRExuZyA9IGNvc0xhdDEqY29zTGF0MipNYXRoLnNpbihkTG5nKTsKCiAgICAgIGZvciAodmFyIGk9MTsgaSA8IHNlZ21lbnRzOyBpKyspIHsKICAgICAgICB2YXIgaUxuZyA9IGxuZzErZExuZyooaS9zZWdtZW50cyk7CiAgICAgICAgdmFyIGlMYXQgPSBNYXRoLmF0YW4oIChzaW5MYXQxQ29zTGF0MipNYXRoLnNpbihsbmcyLWlMbmcpICsgc2luTGF0MkNvc0xhdDEqTWF0aC5zaW4oaUxuZy1sbmcxKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyBjb3NMYXQxQ29zTGF0MlNpbkRMbmcpCgogICAgICAgIHZhciBwb2ludCA9IEwubGF0TG5nICggW2lMYXQqcjJkLCBpTG5nKnIyZF0gKTsKICAgICAgICBjb252ZXJ0ZWRQb2ludHMucHVzaChwb2ludCk7CiAgICAgIH0KICAgIH0KCiAgICBjb252ZXJ0ZWRQb2ludHMucHVzaChMLmxhdExuZyhlbmRMYXRMbmcpKTsKICB9CgoKCiAgTC5nZW9kZXNpY0NvbnZlcnRMaW5lcyA9IGZ1bmN0aW9uIChsYXRsbmdzLCBmaWxsKSB7CiAgICBpZiAobGF0bG5ncy5sZW5ndGggPT0gMCkgewogICAgICByZXR1cm4gW107CiAgICB9CgogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxhdGxuZ3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgaWYgKEwuVXRpbC5pc0FycmF5KGxhdGxuZ3NbaV0pICYmIHR5cGVvZiBsYXRsbmdzW2ldWzBdICE9PSAnbnVtYmVyJykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsYXRsbmdzW2ldID0gTC5sYXRMbmcobGF0bG5nc1tpXSk7CiAgICB9CgogICAgLy8gZ2VvZGVzaWMgY2FsY3VsYXRpb25zIGhhdmUgaXNzdWVzIHdoZW4gY3Jvc3NpbmcgdGhlIGFudGktbWVyaWRpYW4uIHNvIG9mZnNldCB0aGUgcG9pbnRzCiAgICAvLyBzbyB0aGlzIGlzbid0IGFuIGlzc3VlLCB0aGVuIGFkZCBiYWNrIHRoZSBvZmZzZXQgYWZ0ZXJ3YXJkcwogICAgLy8gYSBjZW50ZXIgbG9uZ2l0dWRlIHdvdWxkIGJlIGlkZWFsIC0gYnV0IHRoZSBzdGFydCBwb2ludCBsb25naXR1ZGUgd2lsbCBiZSAnZ29vZCBlbm91Z2gnCiAgICB2YXIgbG5nT2Zmc2V0ID0gbGF0bG5nc1swXS5sbmc7CgogICAgLy8gcG9pbnRzIGFyZSB3cmFwcGVkIGFmdGVyIGJlaW5nIG9mZnNldCByZWxhdGl2ZSB0byB0aGUgZmlyc3QgcG9pbnQgY29vcmRpbmF0ZSwgc28gdGhleSdyZQogICAgLy8gd2l0aGluICstMTgwIGRlZ3JlZXMKICAgIGxhdGxuZ3MgPSBsYXRsbmdzLm1hcChmdW5jdGlvbihhKXsgcmV0dXJuIEwubGF0TG5nKGEubGF0LCBhLmxuZy1sbmdPZmZzZXQpLndyYXAoKTsgfSk7CgogICAgdmFyIGdlb2Rlc2ljbGF0bG5ncyA9IFtdOwoKICAgIGlmKCFmaWxsKSB7CiAgICAgIGdlb2Rlc2ljbGF0bG5ncy5wdXNoKGxhdGxuZ3NbMF0pOwogICAgfQogICAgZm9yIChpID0gMCwgbGVuID0gbGF0bG5ncy5sZW5ndGggLSAxOyBpIDwgbGVuOyBpKyspIHsKICAgICAgZ2VvZGVzaWNDb252ZXJ0TGluZShsYXRsbmdzW2ldLCBsYXRsbmdzW2krMV0sIGdlb2Rlc2ljbGF0bG5ncyk7CiAgICB9CiAgICBpZihmaWxsKSB7CiAgICAgIGdlb2Rlc2ljQ29udmVydExpbmUobGF0bG5nc1tsZW5dLCBsYXRsbmdzWzBdLCBnZW9kZXNpY2xhdGxuZ3MpOwogICAgfQoKICAgIC8vIG5vdyBhZGQgYmFjayB0aGUgb2Zmc2V0IHN1YnRyYWN0ZWQgYWJvdmUuIG5vIHdyYXBwaW5nIGhlcmUgLSB0aGUgZHJhd2luZyBjb2RlIGhhbmRsZXMKICAgIC8vIHRoaW5ncyBiZXR0ZXIgd2hlbiB0aGVyZSdzIG5vIHN1ZGRlbiBqdW1wcyBpbiBjb29yZGluYXRlcy4geWVzLCBsaW5lcyB3aWxsIGV4dGVuZAogICAgLy8gYmV5b25kICstMTgwIGRlZ3JlZXMgLSBidXQgdGhleSB3b24ndCBiZSAnYnJva2VuJwogICAgZ2VvZGVzaWNsYXRsbmdzID0gZ2VvZGVzaWNsYXRsbmdzLm1hcChmdW5jdGlvbihhKXsgcmV0dXJuIEwubGF0TG5nKGEubGF0LCBhLmxuZytsbmdPZmZzZXQpOyB9KTsKCiAgICByZXR1cm4gZ2VvZGVzaWNsYXRsbmdzOwogIH0KICAKICBMLkdlb2Rlc2ljUG9seWxpbmUgPSBnZW9kZXNpY1BvbHkoTC5Qb2x5bGluZSwgMCk7CiAgTC5HZW9kZXNpY1BvbHlnb24gPSBnZW9kZXNpY1BvbHkoTC5Qb2x5Z29uLCAxKTsKCiAgLy9MLkdlb2Rlc2ljTXVsdGlQb2x5bGluZSA9IGNyZWF0ZU11bHRpKEwuR2VvZGVzaWNQb2x5bGluZSk7CiAgLy9MLkdlb2Rlc2ljTXVsdGlQb2x5Z29uID0gY3JlYXRlTXVsdGkoTC5HZW9kZXNpY1BvbHlnb24pOwoKICAvKkwuR2VvZGVzaWNNdWx0aVBvbHlsaW5lID0gTC5NdWx0aVBvbHlsaW5lLmV4dGVuZCh7CiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAobGF0bG5ncywgb3B0aW9ucykgewogICAgICBMLk11bHRpUG9seWxpbmUucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBMLmdlb2Rlc2ljQ29udmVydExpbmVzKGxhdGxuZ3MpLCBvcHRpb25zKTsKICAgIH0KICB9KTsqLwoKICAvKkwuR2VvZGVzaWNNdWx0aVBvbHlnb24gPSBMLk11bHRpUG9seWdvbi5leHRlbmQoewogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGxhdGxuZ3MsIG9wdGlvbnMpIHsKICAgICAgTC5NdWx0aVBvbHlnb24ucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBMLmdlb2Rlc2ljQ29udmVydExpbmVzKGxhdGxuZ3MpLCBvcHRpb25zKTsKICAgIH0KICB9KTsqLwoKCiAgTC5HZW9kZXNpY0NpcmNsZSA9IEwuUG9seWdvbi5leHRlbmQoewogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGxhdGxuZywgcmFkaXVzLCBvcHRpb25zKSB7CiAgICAgIHRoaXMuX2xhdGxuZyA9IEwubGF0TG5nKGxhdGxuZyk7CiAgICAgIHRoaXMuX21SYWRpdXMgPSByYWRpdXM7CgogICAgICBwb2ludHMgPSB0aGlzLl9jYWxjUG9pbnRzKCk7CgogICAgICBMLlBvbHlnb24ucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBwb2ludHMsIG9wdGlvbnMpOwogICAgfSwKCiAgICBvcHRpb25zOiB7CiAgICAgIGZpbGw6IHRydWUKICAgIH0sCgogICAgc2V0TGF0TG5nOiBmdW5jdGlvbiAobGF0bG5nKSB7CiAgICAgIHRoaXMuX2xhdGxuZyA9IEwubGF0TG5nKGxhdGxuZyk7CiAgICAgIHBvaW50cyA9IHRoaXMuX2NhbGNQb2ludHMoKTsKICAgICAgdGhpcy5zZXRMYXRMbmdzKHBvaW50cyk7CiAgICB9LAoKICAgIHNldFJhZGl1czogZnVuY3Rpb24gKHJhZGl1cykgewogICAgICB0aGlzLl9tUmFkaXVzID0gcmFkaXVzOwogICAgICBwb2ludHMgPSB0aGlzLl9jYWxjUG9pbnRzKCk7CiAgICAgIHRoaXMuc2V0TGF0TG5ncyhwb2ludHMpOwoKICAgIH0sCgogICAgZ2V0TGF0TG5nOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9sYXRsbmc7CiAgICB9LAoKICAgIGdldFJhZGl1czogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl9tUmFkaXVzOwogICAgfSwKCgogICAgX2NhbGNQb2ludHM6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgUiA9IDYzNjcwMDAuMDsgLy9lYXJ0aCByYWRpdXMgaW4gbWV0ZXJzIChhcHByb3ggLSB0YWtlbiBmcm9tIGxlYWZsZXQgc291cmNlIGNvZGUpCiAgICAgIHZhciBkMnIgPSBNYXRoLlBJLzE4MC4wOwogICAgICB2YXIgcjJkID0gMTgwLjAvTWF0aC5QSTsKLy9jb25zb2xlLmxvZygiZ2VvZGVzaWNDaXJjbGU6IHJhZGl1cyA9ICIrdGhpcy5fbVJhZGl1cysibSwgY2VudHJlICIrdGhpcy5fbGF0bG5nLmxhdCsiLCIrdGhpcy5fbGF0bG5nLmxuZyk7CgogICAgICAvLyBjaXJjbGUgcmFkaXVzIGFzIGFuIGFuZ2xlIGZyb20gdGhlIGNlbnRyZSBvZiB0aGUgZWFydGgKICAgICAgdmFyIHJhZFJhZGl1cyA9IHRoaXMuX21SYWRpdXMgLyBSOwoKLy9jb25zb2xlLmxvZygiIChyYWRpdXMgaW4gcmFkaWFucyAiK3JhZFJhZGl1cyk7CgogICAgICAvLyBwcmUtY2FsY3VsYXRlIHZhcmlvdXMgdmFsdWVzIHVzZWQgZm9yIGV2ZXJ5IHBvaW50IG9uIHRoZSBjaXJjbGUKICAgICAgdmFyIGNlbnRyZUxhdCA9IHRoaXMuX2xhdGxuZy5sYXQgKiBkMnI7CiAgICAgIHZhciBjZW50cmVMbmcgPSB0aGlzLl9sYXRsbmcubG5nICogZDJyOwoKICAgICAgdmFyIGNvc0NlbnRyZUxhdCA9IE1hdGguY29zKGNlbnRyZUxhdCk7CiAgICAgIHZhciBzaW5DZW50cmVMYXQgPSBNYXRoLnNpbihjZW50cmVMYXQpOwoKICAgICAgdmFyIGNvc1JhZFJhZGl1cyA9IE1hdGguY29zKHJhZFJhZGl1cyk7CiAgICAgIHZhciBzaW5SYWRSYWRpdXMgPSBNYXRoLnNpbihyYWRSYWRpdXMpOwoKICAgICAgdmFyIGNhbGNMYXRMbmdBdEFuZ2xlID0gZnVuY3Rpb24oYW5nbGUpIHsKICAgICAgICB2YXIgbGF0ID0gTWF0aC5hc2luKHNpbkNlbnRyZUxhdCpjb3NSYWRSYWRpdXMgKyBjb3NDZW50cmVMYXQqc2luUmFkUmFkaXVzKk1hdGguY29zKGFuZ2xlKSk7CiAgICAgICAgdmFyIGxuZyA9IGNlbnRyZUxuZyArIE1hdGguYXRhbjIoTWF0aC5zaW4oYW5nbGUpKnNpblJhZFJhZGl1cypjb3NDZW50cmVMYXQsIGNvc1JhZFJhZGl1cy1zaW5DZW50cmVMYXQqTWF0aC5zaW4obGF0KSk7CgogICAgICAgIHJldHVybiBMLmxhdExuZyhsYXQgKiByMmQsbG5nICogcjJkKTsKICAgICAgfQoKCiAgICAgIHZhciBzZWdtZW50cyA9IE1hdGgubWF4KDQ4LE1hdGguZmxvb3IodGhpcy5fbVJhZGl1cy8xMDAwKSk7Ci8vY29uc29sZS5sb2coIiAoZHJhd2luZyBjaXJjbGUgYXMgIitzZWdtZW50cysiIGxpbmVzKSIpOwogICAgICB2YXIgcG9pbnRzID0gW107CiAgICAgIGZvciAodmFyIGk9MDsgaTxzZWdtZW50czsgaSsrKSB7CiAgICAgICAgdmFyIGFuZ2xlID0gTWF0aC5QSSoyL3NlZ21lbnRzKmk7CgogICAgICAgIHZhciBwb2ludCA9IGNhbGNMYXRMbmdBdEFuZ2xlKGFuZ2xlKQogICAgICAgIHBvaW50cy5wdXNoICggcG9pbnQgKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvaW50czsKICAgIH0sCgogIH0pOwoKCiAgTC5nZW9kZXNpY1BvbHlsaW5lID0gZnVuY3Rpb24gKGxhdGxuZ3MsIG9wdGlvbnMpIHsKICAgIHJldHVybiBuZXcgTC5HZW9kZXNpY1BvbHlsaW5lKGxhdGxuZ3MsIG9wdGlvbnMpOwogIH07CgogIEwuZ2VvZGVzaWNQb2x5Z29uID0gZnVuY3Rpb24gKGxhdGxuZ3MsIG9wdGlvbnMpIHsKICAgIHJldHVybiBuZXcgTC5HZW9kZXNpY1BvbHlnb24obGF0bG5ncywgb3B0aW9ucyk7CiAgfTsKICAKICAvKgogIEwuZ2VvZGVzaWNNdWx0aVBvbHlsaW5lID0gZnVuY3Rpb24gKGxhdGxuZ3MsIG9wdGlvbnMpIHsKICAgIHJldHVybiBuZXcgTC5HZW9kZXNpY011bHRpUG9seWxpbmUobGF0bG5ncywgb3B0aW9ucyk7CiAgfTsKCiAgTC5nZW9kZXNpY011bHRpUG9seWdvbiA9IGZ1bmN0aW9uIChsYXRsbmdzLCBvcHRpb25zKSB7CiAgICByZXR1cm4gbmV3IEwuR2VvZGVzaWNNdWx0aVBvbHlnb24obGF0bG5ncywgb3B0aW9ucyk7CiAgfTsKCiAgKi8KCiAgTC5nZW9kZXNpY0NpcmNsZSA9IGZ1bmN0aW9uIChsYXRsbmcsIHJhZGl1cywgb3B0aW9ucykgewogICAgcmV0dXJuIG5ldyBMLkdlb2Rlc2ljQ2lyY2xlKGxhdGxuZywgcmFkaXVzLCBvcHRpb25zKTsKICB9Cgp9KCkpOwoKLy8gbW9kaWZpZWQgdmVyc2lvbiBvZiBodHRwczovL2dpdGh1Yi5jb20vc2hyYW1vdi9sZWFmbGV0LXBsdWdpbnMuIEFsc28KLy8gY29udGFpbnMgdGhlIGRlZmF1bHQgSW5ncmVzcyBtYXAgc3R5bGUuCi8qCiAqIEdvb2dsZSBsYXllciB1c2luZyBHb29nbGUgTWFwcyBBUEkKICovCi8vKGZ1bmN0aW9uIChnb29nbGUsIEwpIHsKCkwuR29vZ2xlID0gTC5DbGFzcy5leHRlbmQoewoJaW5jbHVkZXM6IEwuTWl4aW4uRXZlbnRzLAoKCW9wdGlvbnM6IHsKCQltaW5ab29tOiAwLAoJCW1heFpvb206IDE4LAoJCXRpbGVTaXplOiAyNTYsCgkJc3ViZG9tYWluczogJ2FiYycsCgkJZXJyb3JUaWxlVXJsOiAnJywKCQlhdHRyaWJ1dGlvbjogJycsCgkJb3BhY2l0eTogMSwKCQljb250aW51b3VzV29ybGQ6IGZhbHNlLAoJCW5vV3JhcDogZmFsc2UsCgkJbWFwT3B0aW9uczogewoJCQliYWNrZ3JvdW5kQ29sb3I6ICcjZGRkZGRkJwoJCX0KCX0sCgoJLy8gUG9zc2libGUgdHlwZXM6IFNBVEVMTElURSwgUk9BRE1BUCwgSFlCUklELCBURVJSQUlOCglpbml0aWFsaXplOiBmdW5jdGlvbih0eXBlLCBvcHRpb25zKSB7CgkJTC5VdGlsLnNldE9wdGlvbnModGhpcywgb3B0aW9ucyk7CgoJCXRoaXMuX3JlYWR5ID0gZ29vZ2xlLm1hcHMuTWFwICE9IHVuZGVmaW5lZDsKCQlpZiAoIXRoaXMuX3JlYWR5KSBMLkdvb2dsZS5hc3luY1dhaXQucHVzaCh0aGlzKTsKCgkJdGhpcy5fdHlwZSA9IHR5cGUgfHwgJ1NBVEVMTElURSc7Cgl9LAoKCW9uQWRkOiBmdW5jdGlvbihtYXAsIGluc2VydEF0VGhlQm90dG9tKSB7CgkJdGhpcy5fbWFwID0gbWFwOwoJCXRoaXMuX2luc2VydEF0VGhlQm90dG9tID0gaW5zZXJ0QXRUaGVCb3R0b207CgoJCS8vIGNyZWF0ZSBhIGNvbnRhaW5lciBkaXYgZm9yIHRpbGVzCgkJdGhpcy5faW5pdENvbnRhaW5lcigpOwoJCXRoaXMuX2luaXRNYXBPYmplY3QoKTsKCgkJLy8gc2V0IHVwIGV2ZW50cwoJCW1hcC5vbigndmlld3Jlc2V0JywgdGhpcy5fcmVzZXRDYWxsYmFjaywgdGhpcyk7CgoJCXRoaXMuX2xpbWl0ZWRVcGRhdGUgPSBMLlV0aWwubGltaXRFeGVjQnlJbnRlcnZhbCh0aGlzLl91cGRhdGUsIDE1MCwgdGhpcyk7CgkJbWFwLm9uKCdtb3ZlJywgdGhpcy5fdXBkYXRlLCB0aGlzKTsKCgkJbWFwLm9uKCd6b29tYW5pbScsIHRoaXMuX2hhbmRsZVpvb21BbmltLCB0aGlzKTsKCgkJLy8yMHB4IGluc3RlYWQgb2YgMWVtIHRvIGF2b2lkIGEgc2xpZ2h0IG92ZXJsYXAgd2l0aCBnb29nbGUncyBhdHRyaWJ1dGlvbgoJCW1hcC5fY29udHJvbENvcm5lcnNbJ2JvdHRvbXJpZ2h0J10uc3R5bGUubWFyZ2luQm90dG9tID0gIjIwcHgiOwoKCQl0aGlzLl9yZXNldCgpOwoJCXRoaXMuX3VwZGF0ZSgpOwoJfSwKCglvblJlbW92ZTogZnVuY3Rpb24obWFwKSB7CgkJdGhpcy5fbWFwLl9jb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy5fY29udGFpbmVyKTsKCQkvL3RoaXMuX2NvbnRhaW5lciA9IG51bGw7CgoJCXRoaXMuX21hcC5vZmYoJ3ZpZXdyZXNldCcsIHRoaXMuX3Jlc2V0Q2FsbGJhY2ssIHRoaXMpOwoKCQl0aGlzLl9tYXAub2ZmKCdtb3ZlJywgdGhpcy5fdXBkYXRlLCB0aGlzKTsKCgkJdGhpcy5fbWFwLm9mZignem9vbWFuaW0nLCB0aGlzLl9oYW5kbGVab29tQW5pbSwgdGhpcyk7CgoJCW1hcC5fY29udHJvbENvcm5lcnNbJ2JvdHRvbXJpZ2h0J10uc3R5bGUubWFyZ2luQm90dG9tID0gIjBlbSI7CgkJLy90aGlzLl9tYXAub2ZmKCdtb3ZlZW5kJywgdGhpcy5fdXBkYXRlLCB0aGlzKTsKCX0sCgoJZ2V0QXR0cmlidXRpb246IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLm9wdGlvbnMuYXR0cmlidXRpb247Cgl9LAoKCXNldE9wYWNpdHk6IGZ1bmN0aW9uKG9wYWNpdHkpIHsKCQl0aGlzLm9wdGlvbnMub3BhY2l0eSA9IG9wYWNpdHk7CgkJaWYgKG9wYWNpdHkgPCAxKSB7CgkJCUwuRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2NvbnRhaW5lciwgb3BhY2l0eSk7CgkJfQoJfSwKCglzZXRFbGVtZW50U2l6ZTogZnVuY3Rpb24oZSwgc2l6ZSkgewoJCWUuc3R5bGUud2lkdGggPSBzaXplLnggKyAicHgiOwoJCWUuc3R5bGUuaGVpZ2h0ID0gc2l6ZS55ICsgInB4IjsKCX0sCgoJX2luaXRDb250YWluZXI6IGZ1bmN0aW9uKCkgewoJCXZhciB0aWxlUGFuZSA9IHRoaXMuX21hcC5fY29udGFpbmVyLAoJCQlmaXJzdCA9IHRpbGVQYW5lLmZpcnN0Q2hpbGQ7CgoJCWlmICghdGhpcy5fY29udGFpbmVyKSB7CgkJCXRoaXMuX2NvbnRhaW5lciA9IEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsICdsZWFmbGV0LWdvb2dsZS1sYXllciBsZWFmbGV0LXRvcCBsZWFmbGV0LWxlZnQnKTsKCQkJdGhpcy5fY29udGFpbmVyLmlkID0gIl9HTWFwQ29udGFpbmVyXyIgKyBMLlV0aWwuc3RhbXAodGhpcyk7CgkJCXRoaXMuX2NvbnRhaW5lci5zdHlsZS56SW5kZXggPSAiYXV0byI7CgkJfQoKCQlpZiAodHJ1ZSkgewoJCQl0aWxlUGFuZS5pbnNlcnRCZWZvcmUodGhpcy5fY29udGFpbmVyLCBmaXJzdCk7CgoJCQl0aGlzLnNldE9wYWNpdHkodGhpcy5vcHRpb25zLm9wYWNpdHkpOwoJCQl0aGlzLnNldEVsZW1lbnRTaXplKHRoaXMuX2NvbnRhaW5lciwgdGhpcy5fbWFwLmdldFNpemUoKSk7CgkJfQoJfSwKCglfaW5pdE1hcE9iamVjdDogZnVuY3Rpb24oKSB7CgkJaWYgKCF0aGlzLl9yZWFkeSkgcmV0dXJuOwoJCXRoaXMuX2dvb2dsZV9jZW50ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDAsIDApOwoJCXZhciBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKHRoaXMuX2NvbnRhaW5lciwgewoJCSAgICBjZW50ZXI6IHRoaXMuX2dvb2dsZV9jZW50ZXIsCgkJICAgIHpvb206IDAsCgkJICAgIHRpbHQ6IDAsCgkJICAgIG1hcFR5cGVJZDogZ29vZ2xlLm1hcHMuTWFwVHlwZUlkW3RoaXMuX3R5cGVdLAoJCSAgICBkaXNhYmxlRGVmYXVsdFVJOiB0cnVlLAoJCSAgICBrZXlib2FyZFNob3J0Y3V0czogZmFsc2UsCgkJICAgIGRyYWdnYWJsZTogZmFsc2UsCgkJICAgIGRpc2FibGVEb3VibGVDbGlja1pvb206IHRydWUsCgkJICAgIHNjcm9sbHdoZWVsOiBmYWxzZSwKCQkgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlLAoJCSAgICBzdHlsZXM6IHRoaXMub3B0aW9ucy5tYXBPcHRpb25zLnN0eWxlcywKCQkgICAgYmFja2dyb3VuZENvbG9yOiB0aGlzLm9wdGlvbnMubWFwT3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IKCQl9KTsKCgkJdmFyIF90aGlzID0gdGhpczsKCQl0aGlzLl9yZXBvc2l0aW9uID0gZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXJPbmNlKG1hcCwgImNlbnRlcl9jaGFuZ2VkIiwKCQkJZnVuY3Rpb24oKSB7IF90aGlzLm9uUmVwb3NpdGlvbigpOyB9KTsKCQl0aGlzLl9nb29nbGUgPSBtYXA7CgoJCWdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyT25jZShtYXAsICJpZGxlIiwKCQkJZnVuY3Rpb24oKSB7IF90aGlzLl9jaGVja1pvb21MZXZlbHMoKTsgfSk7Cgl9LAoKCV9jaGVja1pvb21MZXZlbHM6IGZ1bmN0aW9uKCkgewoJCS8vc2V0dGluZyB0aGUgem9vbSBsZXZlbCBvbiB0aGUgR29vZ2xlIG1hcCBtYXkgcmVzdWx0IGluIGEgZGlmZmVyZW50IHpvb20gbGV2ZWwgdGhhbiB0aGUgb25lIHJlcXVlc3RlZAoJCS8vKGl0IHdvbid0IGdvIGJleW9uZCB0aGUgbGV2ZWwgZm9yIHdoaWNoIHRoZXkgaGF2ZSBkYXRhKS4KCQkvLyB2ZXJpZnkgYW5kIG1ha2Ugc3VyZSB0aGUgem9vbSBsZXZlbHMgb24gYm90aCBMZWFmbGV0IGFuZCBHb29nbGUgbWFwcyBhcmUgY29uc2lzdGVudAoJCWlmICh0aGlzLl9nb29nbGUuZ2V0Wm9vbSgpICE9PSB0aGlzLl9tYXAuZ2V0Wm9vbSgpKSB7CgkJCS8vem9vbSBsZXZlbHMgYXJlIG91dCBvZiBzeW5jLiBTZXQgdGhlIGxlYWZsZXQgem9vbSBsZXZlbCB0byBtYXRjaCB0aGUgZ29vZ2xlIG9uZQoJCQl0aGlzLl9tYXAuc2V0Wm9vbSggdGhpcy5fZ29vZ2xlLmdldFpvb20oKSApOwoJCX0KCX0sCgoJX3Jlc2V0Q2FsbGJhY2s6IGZ1bmN0aW9uKGUpIHsKCQl0aGlzLl9yZXNldChlLmhhcmQpOwoJfSwKCglfcmVzZXQ6IGZ1bmN0aW9uKGNsZWFyT2xkQ29udGFpbmVyKSB7CgkJdGhpcy5faW5pdENvbnRhaW5lcigpOwoJfSwKCglfdXBkYXRlOiBmdW5jdGlvbihlKSB7CgkJaWYgKCF0aGlzLl9nb29nbGUpIHJldHVybjsKCQl0aGlzLl9yZXNpemUoKTsKCgkJdmFyIGNlbnRlciA9IGUgJiYgZS5sYXRsbmcgPyBlLmxhdGxuZyA6IHRoaXMuX21hcC5nZXRDZW50ZXIoKTsKCQl2YXIgX2NlbnRlciA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoY2VudGVyLmxhdCwgY2VudGVyLmxuZyk7CgoJCXRoaXMuX2dvb2dsZS5zZXRDZW50ZXIoX2NlbnRlcik7CgkJdGhpcy5fZ29vZ2xlLnNldFpvb20odGhpcy5fbWFwLmdldFpvb20oKSk7CgoJCXRoaXMuX2NoZWNrWm9vbUxldmVscygpOwoJCS8vdGhpcy5fZ29vZ2xlLmZpdEJvdW5kcyhnb29nbGVfYm91bmRzKTsKCX0sCgoJX3Jlc2l6ZTogZnVuY3Rpb24oKSB7CgkJdmFyIHNpemUgPSB0aGlzLl9tYXAuZ2V0U2l6ZSgpOwoJCWlmICh0aGlzLl9jb250YWluZXIuc3R5bGUud2lkdGggPT0gc2l6ZS54ICYmCgkJICAgIHRoaXMuX2NvbnRhaW5lci5zdHlsZS5oZWlnaHQgPT0gc2l6ZS55KQoJCQlyZXR1cm47CgkJdGhpcy5zZXRFbGVtZW50U2l6ZSh0aGlzLl9jb250YWluZXIsIHNpemUpOwoJCXRoaXMub25SZXBvc2l0aW9uKCk7Cgl9LAoKCglfaGFuZGxlWm9vbUFuaW06IGZ1bmN0aW9uIChlKSB7CgkJdmFyIGNlbnRlciA9IGUuY2VudGVyOwoJCXZhciBfY2VudGVyID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhjZW50ZXIubGF0LCBjZW50ZXIubG5nKTsKCgkJdGhpcy5fZ29vZ2xlLnNldENlbnRlcihfY2VudGVyKTsKCQl0aGlzLl9nb29nbGUuc2V0Wm9vbShlLnpvb20pOwoJfSwKCgoJb25SZXBvc2l0aW9uOiBmdW5jdGlvbigpIHsKCQlpZiAoIXRoaXMuX2dvb2dsZSkgcmV0dXJuOwoJCWdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodGhpcy5fZ29vZ2xlLCAicmVzaXplIik7Cgl9Cn0pOwoKTC5Hb29nbGUuYXN5bmNXYWl0ID0gW107CkwuR29vZ2xlLmFzeW5jSW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkgewoJdmFyIGk7Cglmb3IgKGkgPSAwOyBpIDwgTC5Hb29nbGUuYXN5bmNXYWl0Lmxlbmd0aDsgaSsrKSB7CgkJdmFyIG8gPSBMLkdvb2dsZS5hc3luY1dhaXRbaV07CgkJby5fcmVhZHkgPSB0cnVlOwoJCWlmIChvLl9jb250YWluZXIpIHsKCQkJby5faW5pdE1hcE9iamVjdCgpOwoJCQlvLl91cGRhdGUoKTsKCQl9Cgl9CglMLkdvb2dsZS5hc3luY1dhaXQgPSBbXTsKfTsKLy99KSh3aW5kb3cuZ29vZ2xlLCBMKQoKKGZ1bmN0aW9uKCl7dmFyIGY9W10uc2xpY2U7U3RyaW5nLnByb3RvdHlwZS5hdXRvTGluaz1mdW5jdGlvbigpe3ZhciBjLGUsZCxhLGI7YT0xPD1hcmd1bWVudHMubGVuZ3RoP2YuY2FsbChhcmd1bWVudHMsMCk6W107ZT0iIjtkPWFbMF07Yj0vKF58XHMpKCg/Omh0dHBzP3xmdHApOlwvXC9bXC1BLVowLTkrXHUwMDI2QCNcLyU/PX5ffCE6LC47XSpbXC1BLVowLTkrXHUwMDI2QCNcLyU9fl98XSkvZ2k7aWYoISgwPGEubGVuZ3RoKSlyZXR1cm4gdGhpcy5yZXBsYWNlKGIsIiQxPGEgaHJlZj0nJDInPiQyPC9hPiIpO2ZvcihjIGluIGQpYT1kW2NdLCJjYWxsYmFjayIhPT1jJiYoZSs9IiAiK2MrIj0nIithKyInIik7cmV0dXJuIHRoaXMucmVwbGFjZShiLGZ1bmN0aW9uKGEsYyxiKXthPSgiZnVuY3Rpb24iPT09dHlwZW9mIGQuY2FsbGJhY2s/ZC5jYWxsYmFjayhiKTp2b2lkIDApfHwiPGEgaHJlZj0nIitiKyInIitlKyI+IitiKyI8L2E+IjtyZXR1cm4iIitjK2F9KX19KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCl7LyoKIE92ZXJsYXBwaW5nTWFya2VyU3BpZGVyZmllcgpodHRwczovL2dpdGh1Yi5jb20vamF3ai9PdmVybGFwcGluZ01hcmtlclNwaWRlcmZpZXItTGVhZmxldApDb3B5cmlnaHQgKGMpIDIwMTEgLSAyMDEyIEdlb3JnZSBNYWNLZXJyb24KUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbmNlOiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UKTm90ZTogVGhlIExlYWZsZXQgbWFwcyBBUEkgbXVzdCBiZSBpbmNsdWRlZCAqYmVmb3JlKiB0aGlzIGNvZGUKKi8KKGZ1bmN0aW9uKCl7dmFyIHE9e30uaGFzT3duUHJvcGVydHkscj1bXS5zbGljZTtudWxsIT10aGlzLkwmJih0aGlzLk92ZXJsYXBwaW5nTWFya2VyU3BpZGVyZmllcj1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oYyxiKXt2YXIgYSxlLGcsZixkPXRoaXM7dGhpcy5tYXA9YztudWxsPT1iJiYoYj17fSk7Zm9yKGEgaW4gYilxLmNhbGwoYixhKSYmKGU9YlthXSx0aGlzW2FdPWUpO3RoaXMuaW5pdE1hcmtlckFycmF5cygpO3RoaXMubGlzdGVuZXJzPXt9O2Y9WyJjbGljayIsInpvb21lbmQiXTtlPTA7Zm9yKGc9Zi5sZW5ndGg7ZTxnO2UrKylhPWZbZV0sdGhpcy5tYXAuYWRkRXZlbnRMaXN0ZW5lcihhLGZ1bmN0aW9uKCl7cmV0dXJuIGQudW5zcGlkZXJmeSgpfSl9dmFyIGQsaztkPW4ucHJvdG90eXBlO2QuVkVSU0lPTj0iMC4yLjYiO2s9MipNYXRoLlBJO2Qua2VlcFNwaWRlcmZpZWQ9ITE7ZC5uZWFyYnlEaXN0YW5jZT0yMDtkLmNpcmNsZVNwaXJhbFN3aXRjaG92ZXI9OTtkLmNpcmNsZUZvb3RTZXBhcmF0aW9uPQoyNTtkLmNpcmNsZVN0YXJ0QW5nbGU9ay8xMjtkLnNwaXJhbEZvb3RTZXBhcmF0aW9uPTI4O2Quc3BpcmFsTGVuZ3RoU3RhcnQ9MTE7ZC5zcGlyYWxMZW5ndGhGYWN0b3I9NTtkLmxlZ1dlaWdodD0xLjU7ZC5sZWdDb2xvcnM9e3VzdWFsOiIjMjIyIixoaWdobGlnaHRlZDoiI2YwMCJ9O2QuaW5pdE1hcmtlckFycmF5cz1mdW5jdGlvbigpe3RoaXMubWFya2Vycz1bXTtyZXR1cm4gdGhpcy5tYXJrZXJMaXN0ZW5lcnM9W119O2QuYWRkTWFya2VyPWZ1bmN0aW9uKGMpe3ZhciBiLGE9dGhpcztpZihudWxsIT1jLl9vbXMpcmV0dXJuIHRoaXM7Yy5fb21zPSEwO2I9ZnVuY3Rpb24oKXtyZXR1cm4gYS5zcGlkZXJMaXN0ZW5lcihjKX07Yy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsYik7dGhpcy5tYXJrZXJMaXN0ZW5lcnMucHVzaChiKTt0aGlzLm1hcmtlcnMucHVzaChjKTtyZXR1cm4gdGhpc307ZC5nZXRNYXJrZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWFya2Vycy5zbGljZSgwKX07CmQucmVtb3ZlTWFya2VyPWZ1bmN0aW9uKGMpe3ZhciBiLGE7bnVsbCE9Yy5fb21zRGF0YSYmdGhpcy51bnNwaWRlcmZ5KCk7Yj10aGlzLmFyckluZGV4T2YodGhpcy5tYXJrZXJzLGMpO2lmKDA+YilyZXR1cm4gdGhpczthPXRoaXMubWFya2VyTGlzdGVuZXJzLnNwbGljZShiLDEpWzBdO2MucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLGEpO2RlbGV0ZSBjLl9vbXM7dGhpcy5tYXJrZXJzLnNwbGljZShiLDEpO3JldHVybiB0aGlzfTtkLmNsZWFyTWFya2Vycz1mdW5jdGlvbigpe3ZhciBjLGIsYSxlLGc7dGhpcy51bnNwaWRlcmZ5KCk7Zz10aGlzLm1hcmtlcnM7Yz1hPTA7Zm9yKGU9Zy5sZW5ndGg7YTxlO2M9KythKWI9Z1tjXSxjPXRoaXMubWFya2VyTGlzdGVuZXJzW2NdLGIucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLGMpLGRlbGV0ZSBiLl9vbXM7dGhpcy5pbml0TWFya2VyQXJyYXlzKCk7cmV0dXJuIHRoaXN9O2QuYWRkTGlzdGVuZXI9ZnVuY3Rpb24oYyxiKXt2YXIgYSwKZTsobnVsbCE9KGU9KGE9dGhpcy5saXN0ZW5lcnMpW2NdKT9lOmFbY109W10pLnB1c2goYik7cmV0dXJuIHRoaXN9O2QucmVtb3ZlTGlzdGVuZXI9ZnVuY3Rpb24oYyxiKXt2YXIgYTthPXRoaXMuYXJySW5kZXhPZih0aGlzLmxpc3RlbmVyc1tjXSxiKTswPmF8fHRoaXMubGlzdGVuZXJzW2NdLnNwbGljZShhLDEpO3JldHVybiB0aGlzfTtkLmNsZWFyTGlzdGVuZXJzPWZ1bmN0aW9uKGMpe3RoaXMubGlzdGVuZXJzW2NdPVtdO3JldHVybiB0aGlzfTtkLnRyaWdnZXI9ZnVuY3Rpb24oKXt2YXIgYyxiLGEsZSxnLGY7Yj1hcmd1bWVudHNbMF07Yz0yPD1hcmd1bWVudHMubGVuZ3RoP3IuY2FsbChhcmd1bWVudHMsMSk6W107Yj1udWxsIT0oYT10aGlzLmxpc3RlbmVyc1tiXSk/YTpbXTtmPVtdO2U9MDtmb3IoZz1iLmxlbmd0aDtlPGc7ZSsrKWE9YltlXSxmLnB1c2goYS5hcHBseShudWxsLGMpKTtyZXR1cm4gZn07ZC5nZW5lcmF0ZVB0c0NpcmNsZT1mdW5jdGlvbihjLGIpe3ZhciBhLGUsCmcsZixkO2c9dGhpcy5jaXJjbGVGb290U2VwYXJhdGlvbiooMitjKS9rO2U9ay9jO2Q9W107Zm9yKGE9Zj0wOzA8PWM/ZjxjOmY+YzthPTA8PWM/KytmOi0tZilhPXRoaXMuY2lyY2xlU3RhcnRBbmdsZSthKmUsZC5wdXNoKG5ldyBMLlBvaW50KGIueCtnKk1hdGguY29zKGEpLGIueStnKk1hdGguc2luKGEpKSk7cmV0dXJuIGR9O2QuZ2VuZXJhdGVQdHNTcGlyYWw9ZnVuY3Rpb24oYyxiKXt2YXIgYSxlLGcsZixkO2c9dGhpcy5zcGlyYWxMZW5ndGhTdGFydDthPTA7ZD1bXTtmb3IoZT1mPTA7MDw9Yz9mPGM6Zj5jO2U9MDw9Yz8rK2Y6LS1mKWErPXRoaXMuc3BpcmFsRm9vdFNlcGFyYXRpb24vZys1RS00KmUsZT1uZXcgTC5Qb2ludChiLngrZypNYXRoLmNvcyhhKSxiLnkrZypNYXRoLnNpbihhKSksZys9ayp0aGlzLnNwaXJhbExlbmd0aEZhY3Rvci9hLGQucHVzaChlKTtyZXR1cm4gZH07ZC5zcGlkZXJMaXN0ZW5lcj1mdW5jdGlvbihjKXt2YXIgYixhLGUsZyxmLGQsaCxrLGw7KGI9bnVsbCE9CmMuX29tc0RhdGEpJiZ0aGlzLmtlZXBTcGlkZXJmaWVkfHx0aGlzLnVuc3BpZGVyZnkoKTtpZihiKXJldHVybiB0aGlzLnRyaWdnZXIoImNsaWNrIixjKTtnPVtdO2Y9W107ZD10aGlzLm5lYXJieURpc3RhbmNlKnRoaXMubmVhcmJ5RGlzdGFuY2U7ZT10aGlzLm1hcC5sYXRMbmdUb0xheWVyUG9pbnQoYy5nZXRMYXRMbmcoKSk7bD10aGlzLm1hcmtlcnM7aD0wO2ZvcihrPWwubGVuZ3RoO2g8aztoKyspYj1sW2hdLHRoaXMubWFwLmhhc0xheWVyKGIpJiYoYT10aGlzLm1hcC5sYXRMbmdUb0xheWVyUG9pbnQoYi5nZXRMYXRMbmcoKSksdGhpcy5wdERpc3RhbmNlU3EoYSxlKTxkP2cucHVzaCh7bWFya2VyOmIsbWFya2VyUHQ6YX0pOmYucHVzaChiKSk7cmV0dXJuIDE9PT1nLmxlbmd0aD90aGlzLnRyaWdnZXIoImNsaWNrIixjKTp0aGlzLnNwaWRlcmZ5KGcsZil9O2QubWFrZUhpZ2hsaWdodExpc3RlbmVycz1mdW5jdGlvbihjKXt2YXIgYj10aGlzO3JldHVybntoaWdobGlnaHQ6ZnVuY3Rpb24oKXtyZXR1cm4gYy5fb21zRGF0YS5sZWcuc2V0U3R5bGUoe2NvbG9yOmIubGVnQ29sb3JzLmhpZ2hsaWdodGVkfSl9LAp1bmhpZ2hsaWdodDpmdW5jdGlvbigpe3JldHVybiBjLl9vbXNEYXRhLmxlZy5zZXRTdHlsZSh7Y29sb3I6Yi5sZWdDb2xvcnMudXN1YWx9KX19fTtkLnNwaWRlcmZ5PWZ1bmN0aW9uKGMsYil7dmFyIGEsZSxnLGQscCxoLGssbCxuLG07dGhpcy5zcGlkZXJmeWluZz0hMDttPWMubGVuZ3RoO2E9dGhpcy5wdEF2ZXJhZ2UoZnVuY3Rpb24oKXt2YXIgYSxiLGU7ZT1bXTthPTA7Zm9yKGI9Yy5sZW5ndGg7YTxiO2ErKylrPWNbYV0sZS5wdXNoKGsubWFya2VyUHQpO3JldHVybiBlfSgpKTtkPW0+PXRoaXMuY2lyY2xlU3BpcmFsU3dpdGNob3Zlcj90aGlzLmdlbmVyYXRlUHRzU3BpcmFsKG0sYSkucmV2ZXJzZSgpOnRoaXMuZ2VuZXJhdGVQdHNDaXJjbGUobSxhKTthPWZ1bmN0aW9uKCl7dmFyIGEsYixrLG09dGhpcztrPVtdO2E9MDtmb3IoYj1kLmxlbmd0aDthPGI7YSsrKWc9ZFthXSxlPXRoaXMubWFwLmxheWVyUG9pbnRUb0xhdExuZyhnKSxuPXRoaXMubWluRXh0cmFjdChjLGZ1bmN0aW9uKGEpe3JldHVybiBtLnB0RGlzdGFuY2VTcShhLm1hcmtlclB0LApnKX0pLGg9bi5tYXJrZXIscD1uZXcgTC5Qb2x5bGluZShbaC5nZXRMYXRMbmcoKSxlXSx7Y29sb3I6dGhpcy5sZWdDb2xvcnMudXN1YWwsd2VpZ2h0OnRoaXMubGVnV2VpZ2h0LGNsaWNrYWJsZTohMX0pLHRoaXMubWFwLmFkZExheWVyKHApLGguX29tc0RhdGE9e3VzdWFsUG9zaXRpb246aC5nZXRMYXRMbmcoKSxsZWc6cH0sdGhpcy5sZWdDb2xvcnMuaGlnaGxpZ2h0ZWQhPT10aGlzLmxlZ0NvbG9ycy51c3VhbCYmKGw9dGhpcy5tYWtlSGlnaGxpZ2h0TGlzdGVuZXJzKGgpLGguX29tc0RhdGEuaGlnaGxpZ2h0TGlzdGVuZXJzPWwsaC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLGwuaGlnaGxpZ2h0KSxoLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3V0IixsLnVuaGlnaGxpZ2h0KSksaC5zZXRMYXRMbmcoZSksaC5zZXRaSW5kZXhPZmZzZXQoMUU2KSxrLnB1c2goaCk7cmV0dXJuIGt9LmNhbGwodGhpcyk7ZGVsZXRlIHRoaXMuc3BpZGVyZnlpbmc7dGhpcy5zcGlkZXJmaWVkPSEwOwpyZXR1cm4gdGhpcy50cmlnZ2VyKCJzcGlkZXJmeSIsYSxiKX07ZC51bnNwaWRlcmZ5PWZ1bmN0aW9uKGMpe3ZhciBiLGEsZSxkLGYsayxoO251bGw9PWMmJihjPW51bGwpO2lmKG51bGw9PXRoaXMuc3BpZGVyZmllZClyZXR1cm4gdGhpczt0aGlzLnVuc3BpZGVyZnlpbmc9ITA7ZD1bXTtlPVtdO2g9dGhpcy5tYXJrZXJzO2Y9MDtmb3Ioaz1oLmxlbmd0aDtmPGs7ZisrKWI9aFtmXSxudWxsIT1iLl9vbXNEYXRhPyh0aGlzLm1hcC5yZW1vdmVMYXllcihiLl9vbXNEYXRhLmxlZyksYiE9PWMmJmIuc2V0TGF0TG5nKGIuX29tc0RhdGEudXN1YWxQb3NpdGlvbiksYi5zZXRaSW5kZXhPZmZzZXQoMCksYT1iLl9vbXNEYXRhLmhpZ2hsaWdodExpc3RlbmVycyxudWxsIT1hJiYoYi5yZW1vdmVFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLGEuaGlnaGxpZ2h0KSxiLnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1vdXNlb3V0IixhLnVuaGlnaGxpZ2h0KSksZGVsZXRlIGIuX29tc0RhdGEsZC5wdXNoKGIpKToKZS5wdXNoKGIpO2RlbGV0ZSB0aGlzLnVuc3BpZGVyZnlpbmc7ZGVsZXRlIHRoaXMuc3BpZGVyZmllZDt0aGlzLnRyaWdnZXIoInVuc3BpZGVyZnkiLGQsZSk7cmV0dXJuIHRoaXN9O2QucHREaXN0YW5jZVNxPWZ1bmN0aW9uKGMsYil7dmFyIGEsZTthPWMueC1iLng7ZT1jLnktYi55O3JldHVybiBhKmErZSplfTtkLnB0QXZlcmFnZT1mdW5jdGlvbihjKXt2YXIgYixhLGUsZCxmO2Q9YT1lPTA7Zm9yKGY9Yy5sZW5ndGg7ZDxmO2QrKyliPWNbZF0sYSs9Yi54LGUrPWIueTtjPWMubGVuZ3RoO3JldHVybiBuZXcgTC5Qb2ludChhL2MsZS9jKX07ZC5taW5FeHRyYWN0PWZ1bmN0aW9uKGMsYil7dmFyIGEsZCxnLGYsayxoO2c9az0wO2ZvcihoPWMubGVuZ3RoO2s8aDtnPSsraylpZihmPWNbZ10sZj1iKGYpLCJ1bmRlZmluZWQiPT09dHlwZW9mIGF8fG51bGw9PT1hfHxmPGQpZD1mLGE9ZztyZXR1cm4gYy5zcGxpY2UoYSwxKVswXX07ZC5hcnJJbmRleE9mPWZ1bmN0aW9uKGMsYil7dmFyIGEsCmQsZyxmO2lmKG51bGwhPWMuaW5kZXhPZilyZXR1cm4gYy5pbmRleE9mKGIpO2E9Zz0wO2ZvcihmPWMubGVuZ3RoO2c8ZjthPSsrZylpZihkPWNbYV0sZD09PWIpcmV0dXJuIGE7cmV0dXJuLTF9O3JldHVybiBufSgpKX0pLmNhbGwodGhpcyk7fSkuY2FsbCh0aGlzKTsKLyogTW9uIDE0IE9jdCAyMDEzIDEwOjU0OjU5IEJTVCAqLwoKCnRyeSB7IGNvbnNvbGUubG9nKCdkb25lIGxvYWRpbmcgaW5jbHVkZWQgSlMnKTsgfSBjYXRjaChlKSB7fQoKLy9ub3RlOiBubyBwcm90b2NvbCAtIHNvIHVzZXMgaHR0cCBvciBodHRwcyBhcyB1c2VkIG9uIHRoZSBjdXJyZW50IHBhZ2UKdmFyIEpRVUVSWSA9ICcvL2FqYXguZ29vZ2xlYXBpcy5jb20vYWpheC9saWJzL2pxdWVyeS8yLjEuMy9qcXVlcnkubWluLmpzJzsKdmFyIEpRVUVSWVVJID0gJy8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvanF1ZXJ5dWkvMS4xMS4zL2pxdWVyeS11aS5taW4uanMnOwoKLy8gYWZ0ZXIgYWxsIHNjcmlwdHMgaGF2ZSBsb2FkZWQsIGJvb3QgdGhlIGFjdHVhbCBhcHAKbG9hZChKUVVFUlkpLnRoZW4oSlFVRVJZVUkpLnRoZW5SdW4oYm9vdCk7CgoKOwoKd2luZG93LmNoYXQgPSBmdW5jdGlvbigpIHt9OwoKLy9XT1JLIElOIFBST0dSRVNTIC0gTk9UIFlFVCBVU0VEISEKd2luZG93LmNoYXQuY29tbVRhYnMgPSBbCi8vIGNoYW5uZWw6IHRoZSBDT01NIGNoYW5uZWwgKCd0YWInIHBhcmFtZXRlciBpbiBzZXJ2ZXIgcmVxdWVzdHMpCi8vIG5hbWU6IHZpc2libGUgbmFtZQovLyBpbnB1dFByb21wdDogc3RyaW5nIGZvciB0aGUgaW5wdXQgcHJvbXB0Ci8vIGlucHV0Q29sb3I6IChvcHRpb25hbCkgY29sb3IgZm9yIGlucHV0Ci8vIHNlbmRNZXNzYWdlOiAob3B0aW9uYWwpIGZ1bmN0aW9uIHRvIHNlbmQgdGhlIG1lc3NhZ2UgKHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IG9mIHNlbmRQbGV4dCkKLy8gZ2xvYmFsQm91bmRzOiAob3B0aW9uYWwpIGlmIHRydWUsIGFsd2F5cyB1c2UgZ2xvYmFsIGxhdExuZyBib3VuZHMKICB7Y2hhbm5lbDonYWxsJywgbmFtZTonQWxsJywgaW5wdXRQcm9tcHQ6ICdicm9hZGNhc3Q6JywgaW5wdXRDb2xvcjonI2Y2Nid9LAogIHtjaGFubmVsOidmYWN0aW9uJywgbmFtZTonQWFjdGlvbicsIGlucHV0UHJvbXB0OiAndGVsbCBmYWN0aW9uOid9LAogIHtjaGFubmVsOidhbGVydHMnLCBuYW1lOidBbGVydHMnLCBpbnB1dFByb21wdDogJ3RlbGwgSmFydmlzOicsIGlucHV0Q29sb3I6ICcjNjY2JywgZ2xvYmFsQm91bmRzOiB0cnVlLCBzZW5kTWVzc2FnZTogZnVuY3Rpb24oKSB7CiAgICBhbGVydCgiSmFydmlzOiBBIHN0cmFuZ2UgZ2FtZS4gVGhlIG9ubHkgd2lubmluZyBtb3ZlIGlzIG5vdCB0byBwbGF5LiBIb3cgYWJvdXQgYSBuaWNlIGdhbWUgb2YgY2hlc3M/XG4oWW91IGNhbid0IGNoYXQgdG8gdGhlICdhbGVydHMnIGNoYW5uZWwhKSIpOwogIH19LApdOwoKCndpbmRvdy5jaGF0LmhhbmRsZVRhYkNvbXBsZXRpb24gPSBmdW5jdGlvbigpIHsKICB2YXIgZWwgPSAkKCcjY2hhdGlucHV0IGlucHV0Jyk7CiAgdmFyIGN1clBvcyA9IGVsLmdldCgwKS5zZWxlY3Rpb25TdGFydDsKICB2YXIgdGV4dCA9IGVsLnZhbCgpOwogIHZhciB3b3JkID0gdGV4dC5zbGljZSgwLCBjdXJQb3MpLnJlcGxhY2UoLy4qXGIoW2EtejAtOS1fXSkvLCAnJDEnKS50b0xvd2VyQ2FzZSgpOwoKICB2YXIgbGlzdCA9ICQoJyNjaGF0ID4gZGl2OnZpc2libGUgbWFyaycpOwogIGxpc3QgPSBsaXN0Lm1hcChmdW5jdGlvbihpbmQsIG1hcmspIHsgcmV0dXJuICQobWFyaykudGV4dCgpOyB9ICk7CiAgbGlzdCA9IHVuaXF1ZUFycmF5KGxpc3QpOwoKICB2YXIgbmljayA9IG51bGw7CiAgZm9yKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHsKICAgIGlmKCFsaXN0W2ldLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCh3b3JkKSkgY29udGludWU7CiAgICBpZihuaWNrICYmIG5pY2sgIT09IGxpc3RbaV0pIHsKICAgICAgY29uc29sZS5sb2coJ01vcmUgdGhhbiBvbmUgbmljayBtYXRjaGVzLCBhYm9ydGluZy4gKCcrbGlzdFtpXSsnIHZzICcrbmljaysnKScpOwogICAgICByZXR1cm47CiAgICB9CiAgICBuaWNrID0gbGlzdFtpXTsKICB9CiAgaWYoIW5pY2spIHsKICAgIGNvbnNvbGUubG9nKCdObyBtYXRjaGVzIGZvciAnICsgd29yZCk7CiAgICByZXR1cm47CiAgfQoKICB2YXIgcG9zU3RhcnQgPSBjdXJQb3MgLSB3b3JkLmxlbmd0aDsKICB2YXIgbmV3VGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIHBvc1N0YXJ0KTsKICB2YXIgYXRQcmVzZW50ID0gdGV4dC5zdWJzdHJpbmcocG9zU3RhcnQtMSwgcG9zU3RhcnQpID09PSAnQCc7CiAgbmV3VGV4dCArPSAoYXRQcmVzZW50ID8gJycgOiAnQCcpICsgbmljayArICcgJzsKICBuZXdUZXh0ICs9IHRleHQuc3Vic3RyaW5nKGN1clBvcyk7CiAgZWwudmFsKG5ld1RleHQpOwp9CgovLwovLyBjbGVhciBtYW5hZ2VtZW50Ci8vCgoKd2luZG93LmNoYXQuX29sZEJCb3ggPSBudWxsOwp3aW5kb3cuY2hhdC5nZW5Qb3N0RGF0YSA9IGZ1bmN0aW9uKGNoYW5uZWwsIHN0b3JhZ2VIYXNoLCBnZXRPbGRlck1zZ3MpIHsKICBpZiAodHlwZW9mIGNoYW5uZWwgIT09ICdzdHJpbmcnKSB0aHJvdyAoJ0FQSSBjaGFuZ2VkOiBpc0ZhY3Rpb24gZmxhZyBub3cgYSBjaGFubmVsIHN0cmluZyAtIGFsbCwgZmFjdGlvbiwgYWxlcnRzJyk7CgogIHZhciBiID0gY2xhbXBMYXRMbmdCb3VuZHMobWFwLmdldEJvdW5kcygpKTsKCiAgLy8gc2V0IGEgY3VycmVudCBib3VuZGluZyBib3ggaWYgbm9uZSBzZXQgc28gZmFyCiAgaWYgKCFjaGF0Ll9vbGRCQm94KSBjaGF0Ll9vbGRCQm94ID0gYjsKCiAgLy8gdG8gYXZvaWQgdW5uZWNlc3NhcnkgY2hhdCByZWZyZXNoZXMsIGEgc21hbGwgZGlmZmVyZW5jZSBjb21wYXJlZCB0byB0aGUgcHJldmlvdXMgYm91bmRpbmcgYm94CiAgLy8gaXMgbm90IGNvbnNpZGVyZWQgZGlmZmVyZW50CiAgdmFyIENIQVRfQk9VTkRJTkdCT1hfU0FNRV9GQUNUT1IgPSAwLjE7CiAgLy8gaWYgdGhlIG9sZCBhbmQgbmV3IGJveCBjb250YWluIGVhY2ggb3RoZXIsIGFmdGVyIGV4cGFuZGluZyBieSB0aGUgZmFjdG9yLCBkb24ndCByZXNldCBjaGF0CiAgaWYgKCEoYi5wYWQoQ0hBVF9CT1VORElOR0JPWF9TQU1FX0ZBQ1RPUikuY29udGFpbnMoY2hhdC5fb2xkQkJveCkgJiYgY2hhdC5fb2xkQkJveC5wYWQoQ0hBVF9CT1VORElOR0JPWF9TQU1FX0ZBQ1RPUikuY29udGFpbnMoYikpKSB7CiAgICBjb25zb2xlLmxvZygnQm91bmRpbmcgQm94IGNoYW5nZWQsIGNoYXQgd2lsbCBiZSBjbGVhcmVkIChvbGQ6ICcrY2hhdC5fb2xkQkJveC50b0JCb3hTdHJpbmcoKSsnOyBuZXc6ICcrYi50b0JCb3hTdHJpbmcoKSsnKScpOwoKICAgICQoJyNjaGF0ID4gZGl2JykuZGF0YSgnbmVlZHNDbGVhcmluZycsIHRydWUpOwoKICAgIC8vIG5lZWQgdG8gcmVzZXQgdGhlc2UgZmxhZ3Mgbm93IGJlY2F1c2UgY2xlYXJpbmcgd2lsbCBvbmx5IG9jY3VyCiAgICAvLyBhZnRlciB0aGUgcmVxdWVzdCBpcyBmaW5pc2hlZCDigJMgaS5lLiB0aGVyZSB3b3VsZCBiZSBvbmUgYWxtb3N0CiAgICAvLyB1c2VsZXNzIHJlcXVlc3QuCiAgICBjaGF0Ll9mYWN0aW9uLmRhdGEgPSB7fTsKICAgIGNoYXQuX2ZhY3Rpb24ub2xkZXN0VGltZXN0YW1wID0gLTE7CiAgICBjaGF0Ll9mYWN0aW9uLm5ld2VzdFRpbWVzdGFtcCA9IC0xOwoKICAgIGNoYXQuX3B1YmxpYy5kYXRhID0ge307CiAgICBjaGF0Ll9wdWJsaWMub2xkZXN0VGltZXN0YW1wID0gLTE7CiAgICBjaGF0Ll9wdWJsaWMubmV3ZXN0VGltZXN0YW1wID0gLTE7CgogICAgY2hhdC5fYWxlcnRzLmRhdGEgPSB7fTsKICAgIGNoYXQuX2FsZXJ0cy5vbGRlc3RUaW1lc3RhbXAgPSAtMTsKICAgIGNoYXQuX2FsZXJ0cy5uZXdlc3RUaW1lc3RhbXAgPSAtMTsKCiAgICBjaGF0Ll9vbGRCQm94ID0gYjsKICB9CgogIHZhciBuZSA9IGIuZ2V0Tm9ydGhFYXN0KCk7CiAgdmFyIHN3ID0gYi5nZXRTb3V0aFdlc3QoKTsKICB2YXIgZGF0YSA9IHsKLy8gICAgZGVzaXJlZE51bUl0ZW1zOiBpc0ZhY3Rpb24gPyBDSEFUX0ZBQ1RJT05fSVRFTVMgOiBDSEFUX1BVQkxJQ19JVEVNUyAsCiAgICBtaW5MYXRFNjogTWF0aC5yb3VuZChzdy5sYXQqMUU2KSwKICAgIG1pbkxuZ0U2OiBNYXRoLnJvdW5kKHN3LmxuZyoxRTYpLAogICAgbWF4TGF0RTY6IE1hdGgucm91bmQobmUubGF0KjFFNiksCiAgICBtYXhMbmdFNjogTWF0aC5yb3VuZChuZS5sbmcqMUU2KSwKICAgIG1pblRpbWVzdGFtcE1zOiAtMSwKICAgIG1heFRpbWVzdGFtcE1zOiAtMSwKICAgIHRhYjogY2hhbm5lbCwKICB9CgogIGlmKGdldE9sZGVyTXNncykgewogICAgLy8gYXNrIGZvciBvbGRlciBjaGF0IHdoZW4gc2Nyb2xsaW5nIHVwCiAgICBkYXRhID0gJC5leHRlbmQoZGF0YSwge21heFRpbWVzdGFtcE1zOiBzdG9yYWdlSGFzaC5vbGRlc3RUaW1lc3RhbXB9KTsKICB9IGVsc2UgewogICAgLy8gYXNrIGZvciBuZXdlciBjaGF0CiAgICB2YXIgbWluID0gc3RvcmFnZUhhc2gubmV3ZXN0VGltZXN0YW1wOwogICAgLy8gdGhlIGluaXRpYWwgcmVxdWVzdCB3aWxsIGhhdmUgYm90aCB0aW1lc3RhbXAgdmFsdWVzIHNldCB0byAtMSwKICAgIC8vIHRodXMgd2UgcmVjZWl2ZSB0aGUgbmV3ZXN0IGRlc2lyZWROdW1JdGVtcy4gQWZ0ZXIgdGhhdCwgd2Ugd2lsbAogICAgLy8gb25seSByZWNlaXZlIG1lc3NhZ2VzIHdpdGggYSB0aW1lc3RhbXAgZ3JlYXRlciBvciBlcXVhbCB0byBtaW4KICAgIC8vIGFib3ZlLgogICAgLy8gQWZ0ZXIgcmVzdW1pbmcgZnJvbSBpZGxlLCB0aGVyZSBtaWdodCBiZSBtb3JlIG5ldyBtZXNzYWdlcyB0aGFuCiAgICAvLyBkZXNpcmVkTnVtSXRlbXMuIFNvIG9uIHRoZSBmaXJzdCByZXF1ZXN0LCB3ZSBhcmUgbm90IHJlYWxseSB1cCB0bwogICAgLy8gZGF0ZS4gV2Ugd2lsbCBldmVudHVhbGx5IGNhdGNoIHVwLCBhcyBsb25nIGFzIHRoZXJlIGFyZSBsZXNzIG5ldwogICAgLy8gbWVzc2FnZXMgdGhhbiBkZXNpcmVkTnVtSXRlbXMgcGVyIGVhY2ggcmVmcmVzaCBjeWNsZS4KICAgIC8vIEEgcHJvcGVyIHNvbHV0aW9uIHdvdWxkIGJlIHRvIHF1ZXJ5IHVudGlsIG5vIG1vcmUgbmV3IHJlc3VsdHMgYXJlCiAgICAvLyByZXR1cm5lZC4gQW5vdGhlciB3YXkgd291bGQgYmUgdG8gc2V0IGRlc2lyZWROdW1JdGVtcyB0byBhIHZlcnkKICAgIC8vIGxhcmdlIG51bWJlciBzbyB3ZSByZWFsbHkgZ2V0IGFsbCBuZXcgbWVzc2FnZXMgc2luY2UgdGhlIGxhc3QKICAgIC8vIHJlcXVlc3QuIFNldHRpbmcgZGVzaXJlZE51bUl0ZW1zIHRvIC0xIGRvZXMgdW5mb3J0dW5hdGVseSBub3QKICAgIC8vIHdvcmsuCiAgICAvLyBDdXJyZW50bHkgdGhpcyBlZGdlIGNhc2UgaXMgbm90IGhhbmRsZWQuIExldOKAmXMgc2VlIGlmIHRoaXMgaXMgYQogICAgLy8gcHJvYmxlbSBpbiBjcm93ZGVkIGFyZWFzLgogICAgJC5leHRlbmQoZGF0YSwge21pblRpbWVzdGFtcE1zOiBtaW59KTsKICAgIC8vIHdoZW4gcmVxdWVzdGluZyB3aXRoIGFuIGFjdHVhbCBtaW5pbXVtIHRpbWVzdGFtcCwgcmVxdWVzdCBvbGRlc3QgcmF0aGVyIHRoYW4gbmV3ZXN0IGZpcnN0LgogICAgLy8gdGhpcyBtYXRjaGVzIHRoZSBzdG9jayBpbnRlbCBzaXRlLCBhbmQgZW5zdXJlcyBubyBnYXBzIHdoZW4gY29udGludWluZyBhZnRlciBhbiBleHRlbmRlZCBpZGxlIHBlcmlvZAogICAgaWYgKG1pbiA+IC0xKSAkLmV4dGVuZChkYXRhLCB7YXNjZW5kaW5nVGltZXN0YW1wT3JkZXI6IHRydWV9KTsKICB9CiAgcmV0dXJuIGRhdGE7Cn0KCgoKLy8KLy8gZmFjdGlvbgovLwoKd2luZG93LmNoYXQuX3JlcXVlc3RGYWN0aW9uUnVubmluZyA9IGZhbHNlOwp3aW5kb3cuY2hhdC5yZXF1ZXN0RmFjdGlvbiA9IGZ1bmN0aW9uKGdldE9sZGVyTXNncywgaXNSZXRyeSkgewogIGlmKGNoYXQuX3JlcXVlc3RGYWN0aW9uUnVubmluZyAmJiAhaXNSZXRyeSkgcmV0dXJuOwogIGlmKGlzSWRsZSgpKSByZXR1cm4gcmVuZGVyVXBkYXRlU3RhdHVzKCk7CiAgY2hhdC5fcmVxdWVzdEZhY3Rpb25SdW5uaW5nID0gdHJ1ZTsKICAkKCIjY2hhdGNvbnRyb2xzIGE6Y29udGFpbnMoJ2ZhY3Rpb24nKSIpLmFkZENsYXNzKCdsb2FkaW5nJyk7CgogIHZhciBkID0gY2hhdC5nZW5Qb3N0RGF0YSgnZmFjdGlvbicsIGNoYXQuX2ZhY3Rpb24sIGdldE9sZGVyTXNncyk7CiAgdmFyIHIgPSB3aW5kb3cucG9zdEFqYXgoCiAgICAnZ2V0UGxleHRzJywKICAgIGQsCiAgICBmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCBqcVhIUikgeyBjaGF0LmhhbmRsZUZhY3Rpb24oZGF0YSwgZ2V0T2xkZXJNc2dzKTsgfSwKICAgIGlzUmV0cnkKICAgICAgPyBmdW5jdGlvbigpIHsgd2luZG93LmNoYXQuX3JlcXVlc3RGYWN0aW9uUnVubmluZyA9IGZhbHNlOyB9CiAgICAgIDogZnVuY3Rpb24oKSB7IHdpbmRvdy5jaGF0LnJlcXVlc3RGYWN0aW9uKGdldE9sZGVyTXNncywgdHJ1ZSkgfQogICk7Cn0KCgp3aW5kb3cuY2hhdC5fZmFjdGlvbiA9IHtkYXRhOnt9LCBvbGRlc3RUaW1lc3RhbXA6LTEsIG5ld2VzdFRpbWVzdGFtcDotMX07CndpbmRvdy5jaGF0LmhhbmRsZUZhY3Rpb24gPSBmdW5jdGlvbihkYXRhLCBvbGRlck1zZ3MpIHsKICBjaGF0Ll9yZXF1ZXN0RmFjdGlvblJ1bm5pbmcgPSBmYWxzZTsKICAkKCIjY2hhdGNvbnRyb2xzIGE6Y29udGFpbnMoJ2ZhY3Rpb24nKSIpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7CgogIGlmKCFkYXRhIHx8ICFkYXRhLnJlc3VsdCkgewogICAgd2luZG93LmZhaWxlZFJlcXVlc3RDb3VudCsrOwogICAgcmV0dXJuIGNvbnNvbGUud2FybignZmFjdGlvbiBjaGF0IGVycm9yLiBXYWl0aW5nIGZvciBuZXh0IGF1dG8tcmVmcmVzaC4nKTsKICB9CgogIGlmKGRhdGEucmVzdWx0Lmxlbmd0aCA9PT0gMCkgcmV0dXJuOwoKICB2YXIgb2xkID0gY2hhdC5fZmFjdGlvbi5vbGRlc3RUaW1lc3RhbXA7CiAgY2hhdC53cml0ZURhdGFUb0hhc2goZGF0YSwgY2hhdC5fZmFjdGlvbiwgZmFsc2UsIG9sZGVyTXNncyk7CiAgdmFyIG9sZE1zZ3NXZXJlQWRkZWQgPSBvbGQgIT09IGNoYXQuX2ZhY3Rpb24ub2xkZXN0VGltZXN0YW1wOwoKICBydW5Ib29rcygnZmFjdGlvbkNoYXREYXRhQXZhaWxhYmxlJywge3JhdzogZGF0YSwgcmVzdWx0OiBkYXRhLnJlc3VsdCwgcHJvY2Vzc2VkOiBjaGF0Ll9mYWN0aW9uLmRhdGF9KTsKCiAgd2luZG93LmNoYXQucmVuZGVyRmFjdGlvbihvbGRNc2dzV2VyZUFkZGVkKTsKfQoKd2luZG93LmNoYXQucmVuZGVyRmFjdGlvbiA9IGZ1bmN0aW9uKG9sZE1zZ3NXZXJlQWRkZWQpIHsKICBjaGF0LnJlbmRlckRhdGEoY2hhdC5fZmFjdGlvbi5kYXRhLCAnY2hhdGZhY3Rpb24nLCBvbGRNc2dzV2VyZUFkZGVkKTsKfQoKCi8vCi8vIGFsbAovLwoKd2luZG93LmNoYXQuX3JlcXVlc3RQdWJsaWNSdW5uaW5nID0gZmFsc2U7CndpbmRvdy5jaGF0LnJlcXVlc3RQdWJsaWMgPSBmdW5jdGlvbihnZXRPbGRlck1zZ3MsIGlzUmV0cnkpIHsKICBpZihjaGF0Ll9yZXF1ZXN0UHVibGljUnVubmluZyAmJiAhaXNSZXRyeSkgcmV0dXJuOwogIGlmKGlzSWRsZSgpKSByZXR1cm4gcmVuZGVyVXBkYXRlU3RhdHVzKCk7CiAgY2hhdC5fcmVxdWVzdFB1YmxpY1J1bm5pbmcgPSB0cnVlOwogICQoIiNjaGF0Y29udHJvbHMgYTpjb250YWlucygnYWxsJykiKS5hZGRDbGFzcygnbG9hZGluZycpOwoKICB2YXIgZCA9IGNoYXQuZ2VuUG9zdERhdGEoJ2FsbCcsIGNoYXQuX3B1YmxpYywgZ2V0T2xkZXJNc2dzKTsKICB2YXIgciA9IHdpbmRvdy5wb3N0QWpheCgKICAgICdnZXRQbGV4dHMnLAogICAgZCwKICAgIGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKSB7IGNoYXQuaGFuZGxlUHVibGljKGRhdGEsIGdldE9sZGVyTXNncyk7IH0sCiAgICBpc1JldHJ5CiAgICAgID8gZnVuY3Rpb24oKSB7IHdpbmRvdy5jaGF0Ll9yZXF1ZXN0UHVibGljUnVubmluZyA9IGZhbHNlOyB9CiAgICAgIDogZnVuY3Rpb24oKSB7IHdpbmRvdy5jaGF0LnJlcXVlc3RQdWJsaWMoZ2V0T2xkZXJNc2dzLCB0cnVlKSB9CiAgKTsKfQoKd2luZG93LmNoYXQuX3B1YmxpYyA9IHtkYXRhOnt9LCBvbGRlc3RUaW1lc3RhbXA6LTEsIG5ld2VzdFRpbWVzdGFtcDotMX07CndpbmRvdy5jaGF0LmhhbmRsZVB1YmxpYyA9IGZ1bmN0aW9uKGRhdGEsIG9sZGVyTXNncykgewogIGNoYXQuX3JlcXVlc3RQdWJsaWNSdW5uaW5nID0gZmFsc2U7CiAgJCgiI2NoYXRjb250cm9scyBhOmNvbnRhaW5zKCdhbGwnKSIpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7CgogIGlmKCFkYXRhIHx8ICFkYXRhLnJlc3VsdCkgewogICAgd2luZG93LmZhaWxlZFJlcXVlc3RDb3VudCsrOwogICAgcmV0dXJuIGNvbnNvbGUud2FybigncHVibGljIGNoYXQgZXJyb3IuIFdhaXRpbmcgZm9yIG5leHQgYXV0by1yZWZyZXNoLicpOwogIH0KCiAgaWYoZGF0YS5yZXN1bHQubGVuZ3RoID09PSAwKSByZXR1cm47CgogIHZhciBvbGQgPSBjaGF0Ll9wdWJsaWMub2xkZXN0VGltZXN0YW1wOwogIGNoYXQud3JpdGVEYXRhVG9IYXNoKGRhdGEsIGNoYXQuX3B1YmxpYywgdW5kZWZpbmVkLCBvbGRlck1zZ3MpOyAgIC8vTk9URTogaXNQdWJsaWMgcGFzc2VkIGFzIHVuZGVmaW5lZCAtIHRoaXMgaXMgdGhlICdhbGwnIGNoYW5uZWwsIHNvIG5vdCByZWFsbHkgcHVibGljIG9yIHByaXZhdGUKICB2YXIgb2xkTXNnc1dlcmVBZGRlZCA9IG9sZCAhPT0gY2hhdC5fcHVibGljLm9sZGVzdFRpbWVzdGFtcDsKCiAgcnVuSG9va3MoJ3B1YmxpY0NoYXREYXRhQXZhaWxhYmxlJywge3JhdzogZGF0YSwgcmVzdWx0OiBkYXRhLnJlc3VsdCwgcHJvY2Vzc2VkOiBjaGF0Ll9wdWJsaWMuZGF0YX0pOwoKICB3aW5kb3cuY2hhdC5yZW5kZXJQdWJsaWMob2xkTXNnc1dlcmVBZGRlZCk7Cgp9Cgp3aW5kb3cuY2hhdC5yZW5kZXJQdWJsaWMgPSBmdW5jdGlvbihvbGRNc2dzV2VyZUFkZGVkKSB7CiAgY2hhdC5yZW5kZXJEYXRhKGNoYXQuX3B1YmxpYy5kYXRhLCAnY2hhdGFsbCcsIG9sZE1zZ3NXZXJlQWRkZWQpOwp9CgoKLy8KLy8gYWxlcnRzCi8vCgp3aW5kb3cuY2hhdC5fcmVxdWVzdEFsZXJ0c1J1bm5pbmcgPSBmYWxzZTsKd2luZG93LmNoYXQucmVxdWVzdEFsZXJ0cyA9IGZ1bmN0aW9uKGdldE9sZGVyTXNncywgaXNSZXRyeSkgewogIGlmKGNoYXQuX3JlcXVlc3RBbGVydHNSdW5uaW5nICYmICFpc1JldHJ5KSByZXR1cm47CiAgaWYoaXNJZGxlKCkpIHJldHVybiByZW5kZXJVcGRhdGVTdGF0dXMoKTsKICBjaGF0Ll9yZXF1ZXN0QWxlcnRzUnVubmluZyA9IHRydWU7CiAgJCgiI2NoYXRjb250cm9scyBhOmNvbnRhaW5zKCdhbGVydHMnKSIpLmFkZENsYXNzKCdsb2FkaW5nJyk7CgogIHZhciBkID0gY2hhdC5nZW5Qb3N0RGF0YSgnYWxlcnRzJywgY2hhdC5fYWxlcnRzLCBnZXRPbGRlck1zZ3MpOwogIHZhciByID0gd2luZG93LnBvc3RBamF4KAogICAgJ2dldFBsZXh0cycsCiAgICBkLAogICAgZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHsgY2hhdC5oYW5kbGVBbGVydHMoZGF0YSwgZ2V0T2xkZXJNc2dzKTsgfSwKICAgIGlzUmV0cnkKICAgICAgPyBmdW5jdGlvbigpIHsgd2luZG93LmNoYXQuX3JlcXVlc3RBbGVydHNSdW5uaW5nID0gZmFsc2U7IH0KICAgICAgOiBmdW5jdGlvbigpIHsgd2luZG93LmNoYXQucmVxdWVzdEFsZXJ0cyhnZXRPbGRlck1zZ3MsIHRydWUpIH0KICApOwp9CgoKd2luZG93LmNoYXQuX2FsZXJ0cyA9IHtkYXRhOnt9LCBvbGRlc3RUaW1lc3RhbXA6LTEsIG5ld2VzdFRpbWVzdGFtcDotMX07CndpbmRvdy5jaGF0LmhhbmRsZUFsZXJ0cyA9IGZ1bmN0aW9uKGRhdGEsIG9sZGVyTXNncykgewogIGNoYXQuX3JlcXVlc3RBbGVydHNSdW5uaW5nID0gZmFsc2U7CiAgJCgiI2NoYXRjb250cm9scyBhOmNvbnRhaW5zKCdhbGVydHMnKSIpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7CgogIGlmKCFkYXRhIHx8ICFkYXRhLnJlc3VsdCkgewogICAgd2luZG93LmZhaWxlZFJlcXVlc3RDb3VudCsrOwogICAgcmV0dXJuIGNvbnNvbGUud2FybignYWxlcnRzIGNoYXQgZXJyb3IuIFdhaXRpbmcgZm9yIG5leHQgYXV0by1yZWZyZXNoLicpOwogIH0KCiAgaWYoZGF0YS5yZXN1bHQubGVuZ3RoID09PSAwKSByZXR1cm47CgogIHZhciBvbGQgPSBjaGF0Ll9hbGVydHMub2xkZXN0VGltZXN0YW1wOwogIGNoYXQud3JpdGVEYXRhVG9IYXNoKGRhdGEsIGNoYXQuX2FsZXJ0cywgdW5kZWZpbmVkLCBvbGRlck1zZ3MpOyAvL05PVEU6IGlzUHVibGljIHBhc3NlZCBhcyB1bmRlZmluZWQgLSBpdCdzIG5ldGhlciBwdWJsaWMgb3IgcHJpdmF0ZSEKICB2YXIgb2xkTXNnc1dlcmVBZGRlZCA9IG9sZCAhPT0gY2hhdC5fYWxlcnRzLm9sZGVzdFRpbWVzdGFtcDsKCi8vIG5vIGhvb3QgZm9yIGFsZXJ0cyAtIEFQSSBjaGFuZ2UgcGxhbm5lZCBoZXJlLi4uCi8vICBydW5Ib29rcygnYWxlcnRzQ2hhdERhdGFBdmFpbGFibGUnLCB7cmF3OiBkYXRhLCByZXN1bHQ6IGRhdGEucmVzdWx0LCBwcm9jZXNzZWQ6IGNoYXQuX2FsZXJ0cy5kYXRhfSk7CgogIHdpbmRvdy5jaGF0LnJlbmRlckFsZXJ0cyhvbGRNc2dzV2VyZUFkZGVkKTsKfQoKd2luZG93LmNoYXQucmVuZGVyQWxlcnRzID0gZnVuY3Rpb24ob2xkTXNnc1dlcmVBZGRlZCkgewogIGNoYXQucmVuZGVyRGF0YShjaGF0Ll9hbGVydHMuZGF0YSwgJ2NoYXRhbGVydHMnLCBvbGRNc2dzV2VyZUFkZGVkKTsKfQoKCgovLwovLyBjb21tb24KLy8KCndpbmRvdy5jaGF0Lm5pY2tuYW1lQ2xpY2tlZCA9IGZ1bmN0aW9uKGV2ZW50LCBuaWNrbmFtZSkgewogIHZhciBob29rRGF0YSA9IHsgZXZlbnQ6IGV2ZW50LCBuaWNrbmFtZTogbmlja25hbWUgfTsKICAKICBpZiAod2luZG93LnJ1bkhvb2tzKCduaWNrbmFtZUNsaWNrZWQnLCBob29rRGF0YSkpIHsKICAgIHdpbmRvdy5jaGF0LmFkZE5pY2tuYW1lKCdAJyArIG5pY2tuYW1lKTsKICB9CgogIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgcmV0dXJuIGZhbHNlOwp9Cgp3aW5kb3cuY2hhdC53cml0ZURhdGFUb0hhc2ggPSBmdW5jdGlvbihuZXdEYXRhLCBzdG9yYWdlSGFzaCwgaXNQdWJsaWNDaGFubmVsLCBpc09sZGVyTXNncykgewogICQuZWFjaChuZXdEYXRhLnJlc3VsdCwgZnVuY3Rpb24oaW5kLCBqc29uKSB7CiAgICAvLyBhdm9pZCBkdXBsaWNhdGVzCiAgICBpZihqc29uWzBdIGluIHN0b3JhZ2VIYXNoLmRhdGEpIHJldHVybiB0cnVlOwoKICAgIHZhciBpc1NlY3VyZU1lc3NhZ2UgPSBmYWxzZTsKICAgIHZhciBtc2dUb1BsYXllciA9IGZhbHNlOwoKICAgIHZhciB0aW1lID0ganNvblsxXTsKICAgIHZhciB0ZWFtID0ganNvblsyXS5wbGV4dC50ZWFtID09PSAnUkVTSVNUQU5DRScgPyBURUFNX1JFUyA6IFRFQU1fRU5MOwogICAgdmFyIGF1dG8gPSBqc29uWzJdLnBsZXh0LnBsZXh0VHlwZSAhPT0gJ1BMQVlFUl9HRU5FUkFURUQnOwogICAgdmFyIHN5c3RlbU5hcnJvd2Nhc3QgPSBqc29uWzJdLnBsZXh0LnBsZXh0VHlwZSA9PT0gJ1NZU1RFTV9OQVJST1dDQVNUJzsKCiAgICAvL3RyYWNrIG9sZGVzdCArIG5ld2VzdCB0aW1lc3RhbXBzCiAgICBpZiAoc3RvcmFnZUhhc2gub2xkZXN0VGltZXN0YW1wID09PSAtMSB8fCBzdG9yYWdlSGFzaC5vbGRlc3RUaW1lc3RhbXAgPiB0aW1lKSBzdG9yYWdlSGFzaC5vbGRlc3RUaW1lc3RhbXAgPSB0aW1lOwogICAgaWYgKHN0b3JhZ2VIYXNoLm5ld2VzdFRpbWVzdGFtcCA9PT0gLTEgfHwgc3RvcmFnZUhhc2gubmV3ZXN0VGltZXN0YW1wIDwgdGltZSkgc3RvcmFnZUhhc2gubmV3ZXN0VGltZXN0YW1wID0gdGltZTsKCiAgICAvL3JlbW92ZSAiWW91ciBYIG9uIFkgd2FzIGRlc3Ryb3llZCBieSBaIiBmcm9tIHRoZSBmYWN0aW9uIGNoYW5uZWwKLy8gICAgaWYgKHN5c3RlbU5hcnJvd2Nhc3QgJiYgIWlzUHVibGljQ2hhbm5lbCkgcmV0dXJuIHRydWU7CgogICAgdmFyIG1zZyA9ICcnLCBuaWNrID0gJyc7CiAgICAkLmVhY2goanNvblsyXS5wbGV4dC5tYXJrdXAsIGZ1bmN0aW9uKGluZCwgbWFya3VwKSB7CiAgICAgIHN3aXRjaChtYXJrdXBbMF0pIHsKICAgICAgY2FzZSAnU0VOREVSJzogLy8gdXNlciBnZW5lcmF0ZWQgbWVzc2FnZXMKICAgICAgICBuaWNrID0gbWFya3VwWzFdLnBsYWluLnNsaWNlKDAsIC0yKTsgLy8gY3V0IOKAnDog4oCdIGF0IGVuZAogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnUExBWUVSJzogLy8gYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgbWVzc2FnZXMKICAgICAgICBuaWNrID0gbWFya3VwWzFdLnBsYWluOwogICAgICAgIHRlYW0gPSBtYXJrdXBbMV0udGVhbSA9PT0gJ1JFU0lTVEFOQ0UnID8gVEVBTV9SRVMgOiBURUFNX0VOTDsKICAgICAgICBpZihpbmQgPiAwKSBtc2cgKz0gbmljazsgLy8gZG9u4oCZdCByZXBlYXQgbmljayBkaXJlY3RseQogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnVEVYVCc6CiAgICAgICAgbXNnICs9ICQoJzxkaXYvPicpLnRleHQobWFya3VwWzFdLnBsYWluKS5odG1sKCkuYXV0b0xpbmsoKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ0FUX1BMQVlFUic6CiAgICAgICAgdmFyIHRoaXNUb1BsYXllciA9IChtYXJrdXBbMV0ucGxhaW4gPT0gKCdAJyt3aW5kb3cuUExBWUVSLm5pY2tuYW1lKSk7CiAgICAgICAgdmFyIHNwYW5DbGFzcyA9IHRoaXNUb1BsYXllciA/ICJwbF9udWRnZV9tZSIgOiAobWFya3VwWzFdLnRlYW0gKyAiIHBsX251ZGdlX3BsYXllciIpOwogICAgICAgIHZhciBhdFBsYXllck5hbWUgPSBtYXJrdXBbMV0ucGxhaW4ucmVwbGFjZSgvXkAvLCAiIik7CiAgICAgICAgbXNnICs9ICQoJzxkaXYvPicpLmh0bWwoJCgnPHNwYW4vPicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgc3BhbkNsYXNzKQogICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdvbmNsaWNrJywid2luZG93LmNoYXQubmlja25hbWVDbGlja2VkKGV2ZW50LCAnIithdFBsYXllck5hbWUrIicpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAudGV4dChtYXJrdXBbMV0ucGxhaW4pKS5odG1sKCk7CiAgICAgICAgbXNnVG9QbGF5ZXIgPSBtc2dUb1BsYXllciB8fCB0aGlzVG9QbGF5ZXI7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdQT1JUQUwnOgogICAgICAgIHZhciBsYXRsbmcgPSBbbWFya3VwWzFdLmxhdEU2LzFFNiwgbWFya3VwWzFdLmxuZ0U2LzFFNl07CiAgICAgICAgdmFyIHBlcm1hID0gJy9pbnRlbD9sbD0nK2xhdGxuZ1swXSsnLCcrbGF0bG5nWzFdKycmej0xNyZwbGw9JytsYXRsbmdbMF0rJywnK2xhdGxuZ1sxXTsKICAgICAgICB2YXIganMgPSAnd2luZG93LnNlbGVjdFBvcnRhbEJ5TGF0TG5nKCcrbGF0bG5nWzBdKycsICcrbGF0bG5nWzFdKycpO3JldHVybiBmYWxzZSc7CgogICAgICAgIG1zZyArPSAnPGEgb25jbGljaz0iJytqcysnIicKICAgICAgICAgICsgJyB0aXRsZT0iJyttYXJrdXBbMV0uYWRkcmVzcysnIicKICAgICAgICAgICsgJyBocmVmPSInK3Blcm1hKyciIGNsYXNzPSJoZWxwIj4nCiAgICAgICAgICArIHdpbmRvdy5jaGF0LmdldENoYXRQb3J0YWxOYW1lKG1hcmt1cFsxXSkKICAgICAgICAgICsgJzwvYT4nOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnU0VDVVJFJzoKICAgICAgICAvL05PVEU6IHdlIHdvbid0IGFkZCB0aGUgJ1tzZWN1cmVdJyBzdHJpbmcgaGVyZSAtIGl0J2xsIGJlIGhhbmRsZWQgYmVsb3cgaW5zdGVhZAogICAgICAgIGlzU2VjdXJlTWVzc2FnZSA9IHRydWU7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIC8vaGFuZGxlIHVua25vd24gdHlwZXMgYnkgb3V0cHV0dGluZyB0aGUgcGxhaW4gdGV4dCB2ZXJzaW9uLCBtYXJrZWQgd2l0aCBpdCdzIHR5cGUKICAgICAgICBtc2cgKz0gJCgnPGRpdi8+JykudGV4dChtYXJrdXBbMF0rJzo8JyttYXJrdXBbMV0ucGxhaW4rJz4nKS5odG1sKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0pOwoKCi8vICAgIC8vc2tpcCBzZWN1cmUgbWVzc2FnZXMgb24gdGhlIHB1YmxpYyBjaGFubmVsCi8vICAgIGlmIChpc1B1YmxpY0NoYW5uZWwgJiYgaXNTZWN1cmVNZXNzYWdlKSByZXR1cm4gdHJ1ZTsKCi8vICAgIC8vc2tpcCBwdWJsaWMgbWVzc2FnZXMgKGUuZy4gQHBsYXllciBtZW50aW9ucykgb24gdGhlIHNlY3VyZSBjaGFubmVsCi8vICAgIGlmICgoIWlzUHVibGljQ2hhbm5lbCkgJiYgKCFpc1NlY3VyZU1lc3NhZ2UpKSByZXR1cm4gdHJ1ZTsKCgogICAgLy9OT1RFOiB0aGVzZSB0d28gYXJlIHJlZHVuZGFudCB3aXRoIHRoZSBhYm92ZSB0d28gdGVzdHMgaW4gcGxhY2UgLSBidXQgdGhpbmdzIGhhdmUgY2hhbmdlZC4uLgogICAgLy9mcm9tIHRoZSBzZXJ2ZXIsIHByaXZhdGUgY2hhbm5lbCBtZXNzYWdlcyBhcmUgZmxhZ2dlZCB3aXRoIGEgU0VDVVJFIHN0cmluZyAnW3NlY3VyZV0gJywgYW5kIGFwcGVhciBpbgogICAgLy9ib3RoIHRoZSBwdWJsaWMgYW5kIHByaXZhdGUgY2hhbm5lbHMKICAgIC8vd2UgZG9uJ3QgaW5jbHVkZSB0aGlzICdbc2VjdXJlXScgdGV4dCBhYm92ZSwgYXMgaXQncyByZWR1bmRhbnQgaW4gdGhlIGZhY3Rpb24tb25seSBjaGFubmVsCiAgICAvL2xldCdzIGFkZCBpdCBoZXJlIHRob3VnaCBpZiB3ZSBoYXZlIGEgc2VjdXJlIG1lc3NhZ2UgaW4gdGhlIHB1YmxpYyBjaGFubmVsLCBvciB0aGUgcmV2ZXJzZSBpZiBhIG5vbi1zZWN1cmUgaW4gdGhlIGZhY3Rpb24gb25lCiAgICBpZiAoIWF1dG8gJiYgIShpc1B1YmxpY0NoYW5uZWw9PT1mYWxzZSkgJiYgaXNTZWN1cmVNZXNzYWdlKSBtc2cgPSAnPHNwYW4gc3R5bGU9ImNvbG9yOiAjZjg4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjNTAwOyI+W2ZhY3Rpb25dPC9zcGFuPiAnICsgbXNnOwogICAgLy9hbmQsIGFkZCB0aGUgcmV2ZXJzZSAtIGEgJ3B1YmxpYycgbWFya2VyIHRvIG1lc3NhZ2VzIGluIHRoZSBwcml2YXRlIGNoYW5uZWwKICAgIGlmICghYXV0byAmJiAhKGlzUHVibGljQ2hhbm5lbD09PXRydWUpICYmICghaXNTZWN1cmVNZXNzYWdlKSkgbXNnID0gJzxzcGFuIHN0eWxlPSJjb2xvcjogI2ZmNjsgYmFja2dyb3VuZC1jb2xvcjogIzU1MCI+W3B1YmxpY108L3NwYW4+ICcgKyBtc2c7CgoKICAgIC8vIGZvcm1hdDogdGltZXN0YW1wLCBhdXRvZ2VuZXJhdGVkLCBIVE1MIG1lc3NhZ2UKICAgIHN0b3JhZ2VIYXNoLmRhdGFbanNvblswXV0gPSBbanNvblsxXSwgYXV0bywgY2hhdC5yZW5kZXJNc2cobXNnLCBuaWNrLCB0aW1lLCB0ZWFtLCBtc2dUb1BsYXllciwgc3lzdGVtTmFycm93Y2FzdCksIG5pY2tdOwoKICB9KTsKfQoKLy8gT3ZlcnJpZGUgcG9ydGFsIG5hbWVzIHRoYXQgYXJlIHVzZWQgb3ZlciBhbmQgb3Zlciwgc3VjaCBhcyAnVVMgUG9zdCBPZmZpY2UnCndpbmRvdy5jaGF0LmdldENoYXRQb3J0YWxOYW1lID0gZnVuY3Rpb24obWFya3VwKSB7CiAgdmFyIG5hbWUgPSBtYXJrdXAubmFtZTsKICBpZihuYW1lID09PSAnVVMgUG9zdCBPZmZpY2UnKSB7CiAgICB2YXIgYWRkcmVzcyA9IG1hcmt1cC5hZGRyZXNzLnNwbGl0KCcsJyk7CiAgICBuYW1lID0gJ1VTUFM6ICcgKyBhZGRyZXNzWzBdOwogIH0KICByZXR1cm4gbmFtZTsKfQoKLy8gcmVuZGVycyBkYXRhIGZyb20gdGhlIGRhdGEtaGFzaCB0byB0aGUgZWxlbWVudCBkZWZpbmVkIGJ5IHRoZSBnaXZlbgovLyBJRC4gU2V0IDNyZCBhcmd1bWVudCB0byB0cnVlIGlmIGl0IGlzIGxpa2VseSB0aGF0IG9sZCBkYXRhIGhhcyBiZWVuCi8vIGFkZGVkLiBMYXR0ZXIgaXMgb25seSByZXF1aXJlZCBmb3Igc2Nyb2xsaW5nLgp3aW5kb3cuY2hhdC5yZW5kZXJEYXRhID0gZnVuY3Rpb24oZGF0YSwgZWxlbWVudCwgbGlrZWx5V2VyZU9sZE1zZ3MpIHsKICB2YXIgZWxtID0gJCgnIycrZWxlbWVudCk7CiAgaWYoZWxtLmlzKCc6aGlkZGVuJykpIHJldHVybjsKCiAgLy8gZGlzY2FyZCBndWlkcyBhbmQgc29ydCBvbGQgdG8gbmV3Ci8vVE9ETz8gc3RhYmxlIHNvcnQsIHRvIHByZXNlcnZlIHNlcnZlciBtZXNzYWdlIG9yZGVyaW5nPyBvciBzb3J0IGJ5IEdVSUQgaWYgdGltZXN0YW1wcyBlcXVhbD8KICB2YXIgdmFscyA9ICQubWFwKGRhdGEsIGZ1bmN0aW9uKHYsIGspIHsgcmV0dXJuIFt2XTsgfSk7CiAgdmFscyA9IHZhbHMuc29ydChmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhWzBdLWJbMF07IH0pOwoKICAvLyByZW5kZXIgdG8gc3RyaW5nIHdpdGggZGF0ZSBzZXBhcmF0b3JzIGluc2VydGVkCiAgdmFyIG1zZ3MgPSAnJzsKICB2YXIgcHJldlRpbWUgPSBudWxsOwogICQuZWFjaCh2YWxzLCBmdW5jdGlvbihpbmQsIG1zZykgewogICAgdmFyIG5leHRUaW1lID0gbmV3IERhdGUobXNnWzBdKS50b0xvY2FsZURhdGVTdHJpbmcoKTsKICAgIGlmKHByZXZUaW1lICYmIHByZXZUaW1lICE9PSBuZXh0VGltZSkKICAgICAgbXNncyArPSBjaGF0LnJlbmRlckRpdmlkZXIobmV4dFRpbWUpOwogICAgbXNncyArPSBtc2dbMl07CiAgICBwcmV2VGltZSA9IG5leHRUaW1lOwogIH0pOwoKICB2YXIgc2Nyb2xsQmVmb3JlID0gc2Nyb2xsQm90dG9tKGVsbSk7CiAgZWxtLmh0bWwoJzx0YWJsZT4nICsgbXNncyArICc8L3RhYmxlPicpOwogIGNoYXQua2VlcFNjcm9sbFBvc2l0aW9uKGVsbSwgc2Nyb2xsQmVmb3JlLCBsaWtlbHlXZXJlT2xkTXNncyk7Cn0KCgp3aW5kb3cuY2hhdC5yZW5kZXJEaXZpZGVyID0gZnVuY3Rpb24odGV4dCkgewogIHZhciBkID0gJyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAnOwogIHJldHVybiAnPHRyPjx0ZCBjb2xzcGFuPSIzIiBzdHlsZT0icGFkZGluZy10b3A6M3B4Ij48c3VtbWFyeT7ilIAgJyArIHRleHQgKyBkICsgJzwvc3VtbWFyeT48L3RkPjwvdHI+JzsKfQoKCndpbmRvdy5jaGF0LnJlbmRlck1zZyA9IGZ1bmN0aW9uKG1zZywgbmljaywgdGltZSwgdGVhbSwgbXNnVG9QbGF5ZXIsIHN5c3RlbU5hcnJvd2Nhc3QpIHsKICB2YXIgdGEgPSB1bml4VGltZVRvSEhtbSh0aW1lKTsKICB2YXIgdGIgPSB1bml4VGltZVRvRGF0ZVRpbWVTdHJpbmcodGltZSwgdHJ1ZSk7CiAgLy9hZGQgPHNtYWxsPiB0YWdzIGFyb3VuZCB0aGUgbWlsbGlzZWNvbmRzCiAgdGIgPSAodGIuc2xpY2UoMCwxOSkrJzxzbWFsbCBjbGFzcz0ibWlsbGlzZWNvbmRzIj4nK3RiLnNsaWNlKDE5KSsnPC9zbWFsbD4nKS5yZXBsYWNlKC88L2csJyZsdDsnKS5yZXBsYWNlKC8+L2csJyZndDsnKS5yZXBsYWNlKC8iL2csJyZxdW90OycpOwoKICAvLyBoZWxwIGN1cnNvciB2aWEg4oCcI2NoYXQgdGltZeKAnQogIHZhciB0ID0gJzx0aW1lIHRpdGxlPSInK3RiKyciIGRhdGEtdGltZXN0YW1wPSInK3RpbWUrJyI+Jyt0YSsnPC90aW1lPic7CiAgaWYgKCBtc2dUb1BsYXllciApCiAgewogICAgdCA9ICc8ZGl2IGNsYXNzPSJwbF9udWRnZV9kYXRlIj4nICsgdCArICc8L2Rpdj48ZGl2IGNsYXNzPSJwbF9udWRnZV9wb2ludHlfc3BhY2VyIj48L2Rpdj4nOwogIH0KICBpZiAoc3lzdGVtTmFycm93Y2FzdCkKICB7CiAgICBtc2cgPSAnPGRpdiBjbGFzcz0ic3lzdGVtX25hcnJvd2Nhc3QiPicgKyBtc2cgKyAnPC9kaXY+JzsKICB9CiAgdmFyIGNvbG9yID0gQ09MT1JTW3RlYW1dOwogIGlmIChuaWNrID09PSB3aW5kb3cuUExBWUVSLm5pY2tuYW1lKSBjb2xvciA9ICcjZmQ2JzsgICAgLy9oaWdobGlnaHQgdGhpbmdzIHNhaWQvZG9uZSBieSB0aGUgcGxheWVyIGluIGEgdW5pcXVlIGNvbG91ciAoc2ltaWxhciB0byBAcGxheWVyIG1lbnRpb25zIGZyb20gb3RoZXJzIGluIHRoZSBjaGF0IHRleHQgaXRzZWxmKQogIHZhciBzID0gJ3N0eWxlPSJjdXJzb3I6cG9pbnRlcjsgY29sb3I6Jytjb2xvcisnIic7CiAgdmFyIGkgPSBbJzxzcGFuIGNsYXNzPSJpbnZpc2VwIj4mbHQ7PC9zcGFuPicsICc8c3BhbiBjbGFzcz0iaW52aXNlcCI+Jmd0Ozwvc3Bhbj4nXTsKICByZXR1cm4gJzx0cj48dGQ+Jyt0Kyc8L3RkPjx0ZD4nK2lbMF0rJzxtYXJrIGNsYXNzPSJuaWNrbmFtZSIgJyArIHMgKyAnPicrIG5pY2srJzwvbWFyaz4nK2lbMV0rJzwvdGQ+PHRkPicrbXNnKyc8L3RkPjwvdHI+JzsKfQoKd2luZG93LmNoYXQuYWRkTmlja25hbWU9IGZ1bmN0aW9uKG5pY2spIHsKICB2YXIgYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0dGV4dCIpOwogIGMudmFsdWUgPSBbYy52YWx1ZS50cmltKCksIG5pY2tdLmpvaW4oIiAiKS50cmltKCkgKyAiICI7CiAgYy5mb2N1cygpCn0KCgoKCndpbmRvdy5jaGF0LmdldEFjdGl2ZSA9IGZ1bmN0aW9uKCkgewogIHJldHVybiAkKCcjY2hhdGNvbnRyb2xzIC5hY3RpdmUnKS50ZXh0KCk7Cn0KCndpbmRvdy5jaGF0LnRhYlRvQ2hhbm5lbCA9IGZ1bmN0aW9uKHRhYikgewogIGlmICh0YWIgPT0gJ2ZhY3Rpb24nKSByZXR1cm4gJ2ZhY3Rpb24nOwogIGlmICh0YWIgPT0gJ2FsZXJ0cycpIHJldHVybiAnYWxlcnRzJzsKICByZXR1cm4gJ2FsbCc7Cn07CgoKCndpbmRvdy5jaGF0LnRvZ2dsZSA9IGZ1bmN0aW9uKCkgewogIHZhciBjID0gJCgnI2NoYXQsICNjaGF0Y29udHJvbHMnKTsKICBpZihjLmhhc0NsYXNzKCdleHBhbmQnKSkgewogICAgJCgnI2NoYXRjb250cm9scyBhOmZpcnN0JykuaHRtbCgnPHNwYW4gY2xhc3M9InRvZ2dsZSBleHBhbmQiPjwvc3Bhbj4nKTsKICAgIGMucmVtb3ZlQ2xhc3MoJ2V4cGFuZCcpOwogICAgdmFyIGRpdiA9ICQoJyNjaGF0ID4gZGl2OnZpc2libGUnKTsKICAgIGRpdi5kYXRhKCdpZ25vcmVOZXh0U2Nyb2xsJywgdHJ1ZSk7CiAgICBkaXYuc2Nyb2xsVG9wKDk5OTk5OTk5KTsgLy8gc2Nyb2xsIHRvIGJvdHRvbQogICAgJCgnLmxlYWZsZXQtY29udHJvbCcpLmNzcygnbWFyZ2luLWxlZnQnLCAnMTNweCcpOwogIH0gZWxzZSB7CiAgICAkKCcjY2hhdGNvbnRyb2xzIGE6Zmlyc3QnKS5odG1sKCc8c3BhbiBjbGFzcz0idG9nZ2xlIHNocmluayI+PC9zcGFuPicpOwogICAgYy5hZGRDbGFzcygnZXhwYW5kJyk7CiAgICAkKCcubGVhZmxldC1jb250cm9sJykuY3NzKCdtYXJnaW4tbGVmdCcsICc3MjBweCcpOwogICAgY2hhdC5uZWVkTW9yZU1lc3NhZ2VzKCk7CiAgfQp9CgoKLy8gY2FsbGVkIGJ5IHBsdWdpbnMgKG9yIG90aGVyIHRoaW5ncz8pIHRoYXQgbmVlZCB0byBtb25pdG9yIENPTU0gZGF0YSBzdHJlYW1zIHdoZW4gdGhlIHVzZXIgaXMgbm90IHZpZXdpbmcgdGhlbQovLyBpbnN0YW5jZTogYSB1bmlxdWUgc3RyaW5nIGlkZW50aWZ5aW5nIHRoZSBwbHVnaW4gcmVxdWVzdGluZyBiYWNrZ3JvdW5kIENPTU0KLy8gY2hhbm5lbDogZWl0aGVyICdhbGwnLCAnZmFjdGlvbicgb3IgKHNvb24pICdhbGVydHMnIC0gb3RoZXJzIHBvc3NpYmxlIGluIHRoZSBmdXR1cmUKLy8gZmxhZzogdHJ1ZSBmb3IgZGF0YSB3YW50ZWQsIGZhbHNlIGZvciBub3Qgd2FudGVkCndpbmRvdy5jaGF0LmJhY2tncm91bmRDaGFubmVsRGF0YSA9IGZ1bmN0aW9uKGluc3RhbmNlLGNoYW5uZWwsZmxhZykgewogIC8vZmlyc3QsIHN0b3JlIHRoZSBzdGF0ZSBmb3IgdGhpcyBpbnN0YW5jZQogIGlmICghd2luZG93LmNoYXQuYmFja2dyb3VuZEluc3RhbmNlQ2hhbm5lbCkgd2luZG93LmNoYXQuYmFja2dyb3VuZEluc3RhbmNlQ2hhbm5lbCA9IHt9OwogIGlmICghd2luZG93LmNoYXQuYmFja2dyb3VuZEluc3RhbmNlQ2hhbm5lbFtpbnN0YW5jZV0pIHdpbmRvdy5jaGF0LmJhY2tncm91bmRJbnN0YW5jZUNoYW5uZWxbaW5zdGFuY2VdID0ge307CiAgd2luZG93LmNoYXQuYmFja2dyb3VuZEluc3RhbmNlQ2hhbm5lbFtpbnN0YW5jZV1bY2hhbm5lbF0gPSBmbGFnOwoKICAvL25vdywgdG8gc2ltcGxpZnkgdGhlIHJlcXVlc3QgY29kZSwgbWVyZ2UgdGhlIGZsYWdzIGZvciBhbGwgaW5zdGFuY2VzIGludG8gb25lCiAgLy8gMS4gY2xlYXIgZXhpc3Rpbmcgb3ZlcmFsbCBmbGFncwogIHdpbmRvdy5jaGF0LmJhY2tncm91bmRDaGFubmVscyA9IHt9OwogIC8vIDIuIGZvciBlYWNoIGluc3RhbmNlIG1vbml0b3JpbmcgQ09NTS4uLgogICQuZWFjaCh3aW5kb3cuY2hhdC5iYWNrZ3JvdW5kSW5zdGFuY2VDaGFubmVsLCBmdW5jdGlvbihpbnN0YW5jZSxjaGFubmVscykgewogICAgLy8gMy4gYW5kIGZvciBlYWNoIGNoYW5uZWwgbW9uaXRvcmVkIGJ5IHRoaXMgaW5zdGFuY2UuLi4KICAgICQuZWFjaCh3aW5kb3cuY2hhdC5iYWNrZ3JvdW5kSW5zdGFuY2VDaGFubmVsW2luc3RhbmNlXSxmdW5jdGlvbihjaGFubmVsLGZsYWcpIHsKICAgICAgLy8gNC4gaWYgaXQncyBtb25pdG9yZWQsIHNldCB0aGUgY2hhbm5lbCBmbGFnCiAgICAgIGlmIChmbGFnKSB3aW5kb3cuY2hhdC5iYWNrZ3JvdW5kQ2hhbm5lbHNbY2hhbm5lbF0gPSB0cnVlOwogICAgfSk7CiAgfSk7Cgp9CgoKd2luZG93LmNoYXQucmVxdWVzdCA9IGZ1bmN0aW9uKCkgewogIGNvbnNvbGUubG9nKCdyZWZyZXNoaW5nIGNoYXQnKTsKICB2YXIgY2hhbm5lbCA9IGNoYXQudGFiVG9DaGFubmVsKGNoYXQuZ2V0QWN0aXZlKCkpOwogIGlmIChjaGFubmVsID09ICdmYWN0aW9uJyB8fCAod2luZG93LmNoYXQuYmFja2dyb3VuZENoYW5uZWxzICYmIHdpbmRvdy5jaGF0LmJhY2tncm91bmRDaGFubmVsc1snZmFjdGlvbiddKSkgewogICAgY2hhdC5yZXF1ZXN0RmFjdGlvbihmYWxzZSk7CiAgfQogIGlmIChjaGFubmVsID09ICdhbGwnIHx8ICh3aW5kb3cuY2hhdC5iYWNrZ3JvdW5kQ2hhbm5lbHMgJiYgd2luZG93LmNoYXQuYmFja2dyb3VuZENoYW5uZWxzWydhbGwnXSkpIHsKICAgIGNoYXQucmVxdWVzdFB1YmxpYyhmYWxzZSk7CiAgfQogIGlmIChjaGFubmVsID09ICdhbGVydHMnIHx8ICh3aW5kb3cuY2hhdC5iYWNrZ3JvdW5kQ2hhbm5lbHMgJiYgd2luZG93LmNoYXQuYmFja2dyb3VuZENoYW5uZWxzWydhbGVydHMnXSkpIHsKICAgIGNoYXQucmVxdWVzdEFsZXJ0cyhmYWxzZSk7CiAgfQp9CgoKLy8gY2hlY2tzIGlmIHRoZXJlIGFyZSBlbm91Z2ggbWVzc2FnZXMgaW4gdGhlIHNlbGVjdGVkIGNoYXQgdGFiIGFuZAovLyBsb2FkcyBtb3JlIGlmIG5vdC4Kd2luZG93LmNoYXQubmVlZE1vcmVNZXNzYWdlcyA9IGZ1bmN0aW9uKCkgewogIHZhciBhY3RpdmVUYWIgPSBjaGF0LmdldEFjdGl2ZSgpOwogIGlmKGFjdGl2ZVRhYiA9PT0gJ2RlYnVnJykgcmV0dXJuOwoKICB2YXIgYWN0aXZlQ2hhdCA9ICQoJyNjaGF0ID4gOnZpc2libGUnKTsKICBpZihhY3RpdmVDaGF0Lmxlbmd0aCA9PT0gMCkgcmV0dXJuOwoKICB2YXIgaGFzU2Nyb2xsYmFyID0gc2Nyb2xsQm90dG9tKGFjdGl2ZUNoYXQpICE9PSAwIHx8IGFjdGl2ZUNoYXQuc2Nyb2xsVG9wKCkgIT09IDA7CiAgdmFyIG5lYXJUb3AgPSBhY3RpdmVDaGF0LnNjcm9sbFRvcCgpIDw9IENIQVRfUkVRVUVTVF9TQ1JPTExfVE9QOwogIGlmKGhhc1Njcm9sbGJhciAmJiAhbmVhclRvcCkgcmV0dXJuOwoKICBjb25zb2xlLmxvZygnTm8gc2Nyb2xsYmFyIG9yIG5lYXIgdG9wIGluIGFjdGl2ZSBjaGF0LiBSZXF1ZXN0aW5nIG1vcmUgZGF0YS4nKTsKCiAgaWYoYWN0aXZlVGFiID09PSAnZmFjdGlvbicpCiAgICBjaGF0LnJlcXVlc3RGYWN0aW9uKHRydWUpOwogIGVsc2UKICAgIGNoYXQucmVxdWVzdFB1YmxpYyh0cnVlKTsKfTsKCgp3aW5kb3cuY2hhdC5jaG9vc2VUYWIgPSBmdW5jdGlvbih0YWIpIHsKICBpZiAodGFiICE9ICdhbGwnICYmIHRhYiAhPSAnZmFjdGlvbicgJiYgdGFiICE9ICdhbGVydHMnKSB7CiAgICBjb25zb2xlLndhcm4oJ2NoYXQgdGFiICInK3RhYisnIiByZXF1ZXN0ZWQgLSBidXQgb25seSAiYWxsIiwgImZhY3Rpb24iIGFuZCAiYWxlcnRzIiBhcmUgdmFsaWQgLSBhc3N1bWluZyAiYWxsIiB3YW50ZWQnKTsKICAgIHRhYiA9ICdhbGwnOwogIH0KCiAgdmFyIG9sZFRhYiA9IGNoYXQuZ2V0QWN0aXZlKCk7CgogIGxvY2FsU3RvcmFnZVsnaWl0Yy1jaGF0LXRhYiddID0gdGFiOwoKICB2YXIgbWFyayA9ICQoJyNjaGF0aW5wdXQgbWFyaycpOwogIHZhciBpbnB1dCA9ICQoJyNjaGF0aW5wdXQgaW5wdXQnKTsKCiAgJCgnI2NoYXRjb250cm9scyAuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwogICQoIiNjaGF0Y29udHJvbHMgYTpjb250YWlucygnIiArIHRhYiArICInKSIpLmFkZENsYXNzKCdhY3RpdmUnKTsKCiAgaWYgKHRhYiAhPSBvbGRUYWIpIHN0YXJ0UmVmcmVzaFRpbWVvdXQoMC4xKjEwMDApOyAvL29ubHkgY2hhdCB1c2VzIHRoZSByZWZyZXNoIHRpbWVyIHN0dWZmLCBzbyBhIHBlcmZlY3Qgd2F5IG9mIGZvcmNpbmcgYW4gZWFybHkgcmVmcmVzaCBhZnRlciBhIHRhYiBjaGFuZ2UKCiAgJCgnI2NoYXQgPiBkaXYnKS5oaWRlKCk7CgogIHZhciBlbG07CgogIHN3aXRjaCh0YWIpIHsKICAgIGNhc2UgJ2ZhY3Rpb24nOgogICAgICBpbnB1dC5jc3MoJ2NvbG9yJywgJycpOwogICAgICBtYXJrLmNzcygnY29sb3InLCAnJyk7CiAgICAgIG1hcmsudGV4dCgndGVsbCBmYWN0aW9uOicpOwoKICAgICAgY2hhdC5yZW5kZXJGYWN0aW9uKGZhbHNlKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSAnYWxsJzoKICAgICAgaW5wdXQuY3NzKCdjc3NUZXh0JywgJ2NvbG9yOiAjZjY2ICFpbXBvcnRhbnQnKTsKICAgICAgbWFyay5jc3MoJ2Nzc1RleHQnLCAnY29sb3I6ICNmNjYgIWltcG9ydGFudCcpOwogICAgICBtYXJrLnRleHQoJ2Jyb2FkY2FzdDonKTsKCiAgICAgIGNoYXQucmVuZGVyUHVibGljKGZhbHNlKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSAnYWxlcnRzJzoKICAgICAgbWFyay5jc3MoJ2Nzc1RleHQnLCAnY29sb3I6ICNiYmIgIWltcG9ydGFudCcpOwogICAgICBpbnB1dC5jc3MoJ2Nzc1RleHQnLCAnY29sb3I6ICNiYmIgIWltcG9ydGFudCcpOwogICAgICBtYXJrLnRleHQoJ3RlbGwgSmFydmlzOicpOwoKICAgICAgY2hhdC5yZW5kZXJBbGVydHMoZmFsc2UpOwogICAgICBicmVhazsKCiAgICBkZWZhdWx0OgogICAgICB0aHJvdygnY2hhdC5jaG9vc2VyIHdhcyBhc2tlZCB0byBoYW5kbGUgdW5rbm93biBidXR0b246ICcgKyB0dCk7CiAgfQoKICB2YXIgZWxtID0gJCgnI2NoYXQnICsgdGFiKTsKICBlbG0uc2hvdygpOwoKICBpZihlbG0uZGF0YSgnbmVlZHNTY3JvbGxUb3AnKSkgewogICAgZWxtLmRhdGEoJ2lnbm9yZU5leHRTY3JvbGwnLCB0cnVlKTsKICAgIGVsbS5zY3JvbGxUb3AoZWxtLmRhdGEoJ25lZWRzU2Nyb2xsVG9wJykpOwogICAgZWxtLmRhdGEoJ25lZWRzU2Nyb2xsVG9wJywgbnVsbCk7CiAgfQp9Cgp3aW5kb3cuY2hhdC5zaG93ID0gZnVuY3Rpb24obmFtZSkgewogICAgd2luZG93LmlzU21hcnRwaG9uZSgpCiAgICAgICAgPyAkKCcjdXBkYXRlc3RhdHVzJykuaGlkZSgpCiAgICAgICAgOiAkKCcjdXBkYXRlc3RhdHVzJykuc2hvdygpOwogICAgJCgnI2NoYXQsICNjaGF0aW5wdXQnKS5zaG93KCk7CgogICAgd2luZG93LmNoYXQuY2hvb3NlVGFiKG5hbWUpOwp9Cgp3aW5kb3cuY2hhdC5jaG9vc2VyID0gZnVuY3Rpb24oZXZlbnQpIHsKICB2YXIgdCA9ICQoZXZlbnQudGFyZ2V0KTsKICB2YXIgdGFiID0gdC50ZXh0KCk7CiAgd2luZG93LmNoYXQuY2hvb3NlVGFiKHRhYik7Cn0KCi8vIGNvbnRhaW5zIHRoZSBsb2dpYyB0byBrZWVwIHRoZSBjb3JyZWN0IHNjcm9sbCBwb3NpdGlvbi4Kd2luZG93LmNoYXQua2VlcFNjcm9sbFBvc2l0aW9uID0gZnVuY3Rpb24oYm94LCBzY3JvbGxCZWZvcmUsIGlzT2xkTXNncykgewogIC8vIElmIHNjcm9sbGVkIGRvd24gY29tcGxldGVseSwga2VlcCBpdCB0aGF0IHdheSBzbyBuZXcgbWVzc2FnZXMgY2FuCiAgLy8gYmUgc2VlbiBlYXNpbHkuIElmIHNjcm9sbGVkIHVwLCBvbmx5IG5lZWQgdG8gZml4IHNjcm9sbCBwb3NpdGlvbgogIC8vIHdoZW4gb2xkIG1lc3NhZ2VzIGFyZSBhZGRlZC4gTmV3IG1lc3NhZ2VzIGFkZGVkIGF0IHRoZSBib3R0b20gZG9u4oCZdAogIC8vIGNoYW5nZSB0aGUgdmlldyBhbmQgZW5hYmxpbmcgdGhpcyB3b3VsZCBtYWtlIHRoZSBjaGF0IHNjcm9sbCBkb3duCiAgLy8gZm9yIGV2ZXJ5IGFkZGVkIG1lc3NhZ2UsIGV2ZW4gaWYgdGhlIHVzZXIgd2FudHMgdG8gcmVhZCBvbGQgc3R1ZmYuCgogIGlmKGJveC5pcygnOmhpZGRlbicpICYmICFpc09sZE1zZ3MpIHsKICAgIGJveC5kYXRhKCduZWVkc1Njcm9sbFRvcCcsIDk5OTk5OTk5KTsKICAgIHJldHVybjsKICB9CgogIGlmKHNjcm9sbEJlZm9yZSA9PT0gMCB8fCBpc09sZE1zZ3MpIHsKICAgIGJveC5kYXRhKCdpZ25vcmVOZXh0U2Nyb2xsJywgdHJ1ZSk7CiAgICBib3guc2Nyb2xsVG9wKGJveC5zY3JvbGxUb3AoKSArIChzY3JvbGxCb3R0b20oYm94KS1zY3JvbGxCZWZvcmUpKTsKICB9Cn0KCgoKCi8vCi8vIHNldHVwCi8vCgp3aW5kb3cuY2hhdC5zZXR1cCA9IGZ1bmN0aW9uKCkgewogIGlmIChsb2NhbFN0b3JhZ2VbJ2lpdGMtY2hhdC10YWInXSkgewogICAgY2hhdC5jaG9vc2VUYWIobG9jYWxTdG9yYWdlWydpaXRjLWNoYXQtdGFiJ10pOwogfQoKICAkKCcjY2hhdGNvbnRyb2xzLCAjY2hhdCwgI2NoYXRpbnB1dCcpLnNob3coKTsKCiAgJCgnI2NoYXRjb250cm9scyBhOmZpcnN0JykuY2xpY2sod2luZG93LmNoYXQudG9nZ2xlKTsKICAkKCcjY2hhdGNvbnRyb2xzIGEnKS5lYWNoKGZ1bmN0aW9uKGluZCwgZWxtKSB7CiAgICBpZigkLmluQXJyYXkoJChlbG0pLnRleHQoKSwgWydhbGwnLCAnZmFjdGlvbicsICdhbGVydHMnXSkgIT09IC0xKQogICAgICAkKGVsbSkuY2xpY2sod2luZG93LmNoYXQuY2hvb3Nlcik7CiAgfSk7CgoKICAkKCcjY2hhdGlucHV0JykuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAkKCcjY2hhdGlucHV0IGlucHV0JykuZm9jdXMoKTsKICB9KTsKCiAgd2luZG93LmNoYXQuc2V0dXBUaW1lKCk7CiAgd2luZG93LmNoYXQuc2V0dXBQb3N0aW5nKCk7CgogICQoJyNjaGF0ZmFjdGlvbicpLnNjcm9sbChmdW5jdGlvbigpIHsKICAgIHZhciB0ID0gJCh0aGlzKTsKICAgIGlmKHQuZGF0YSgnaWdub3JlTmV4dFNjcm9sbCcpKSByZXR1cm4gdC5kYXRhKCdpZ25vcmVOZXh0U2Nyb2xsJywgZmFsc2UpOwogICAgaWYodC5zY3JvbGxUb3AoKSA8IENIQVRfUkVRVUVTVF9TQ1JPTExfVE9QKSBjaGF0LnJlcXVlc3RGYWN0aW9uKHRydWUpOwogICAgaWYoc2Nyb2xsQm90dG9tKHQpID09PSAwKSBjaGF0LnJlcXVlc3RGYWN0aW9uKGZhbHNlKTsKICB9KTsKCiAgJCgnI2NoYXRhbGwnKS5zY3JvbGwoZnVuY3Rpb24oKSB7CiAgICB2YXIgdCA9ICQodGhpcyk7CiAgICBpZih0LmRhdGEoJ2lnbm9yZU5leHRTY3JvbGwnKSkgcmV0dXJuIHQuZGF0YSgnaWdub3JlTmV4dFNjcm9sbCcsIGZhbHNlKTsKICAgIGlmKHQuc2Nyb2xsVG9wKCkgPCBDSEFUX1JFUVVFU1RfU0NST0xMX1RPUCkgY2hhdC5yZXF1ZXN0UHVibGljKHRydWUpOwogICAgaWYoc2Nyb2xsQm90dG9tKHQpID09PSAwKSBjaGF0LnJlcXVlc3RQdWJsaWMoZmFsc2UpOwogIH0pOwoKICAkKCcjY2hhdGFsZXJ0cycpLnNjcm9sbChmdW5jdGlvbigpIHsKICAgIHZhciB0ID0gJCh0aGlzKTsKICAgIGlmKHQuZGF0YSgnaWdub3JlTmV4dFNjcm9sbCcpKSByZXR1cm4gdC5kYXRhKCdpZ25vcmVOZXh0U2Nyb2xsJywgZmFsc2UpOwogICAgaWYodC5zY3JvbGxUb3AoKSA8IENIQVRfUkVRVUVTVF9TQ1JPTExfVE9QKSBjaGF0LnJlcXVlc3RBbGVydHModHJ1ZSk7CiAgICBpZihzY3JvbGxCb3R0b20odCkgPT09IDApIGNoYXQucmVxdWVzdEFsZXJ0cyhmYWxzZSk7CiAgfSk7CgogIHdpbmRvdy5yZXF1ZXN0cy5hZGRSZWZyZXNoRnVuY3Rpb24oY2hhdC5yZXF1ZXN0KTsKCiAgdmFyIGNscyA9IFBMQVlFUi50ZWFtID09PSAnUkVTSVNUQU5DRScgPyAncmVzJyA6ICdlbmwnOwogICQoJyNjaGF0aW5wdXQgbWFyaycpLmFkZENsYXNzKGNscyk7CgogICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcubmlja25hbWUnLCBmdW5jdGlvbihldmVudCkgewogICAgcmV0dXJuIHdpbmRvdy5jaGF0Lm5pY2tuYW1lQ2xpY2tlZChldmVudCwgJCh0aGlzKS50ZXh0KCkpOwogIH0pOwp9CgoKd2luZG93LmNoYXQuc2V0dXBUaW1lID0gZnVuY3Rpb24oKSB7CiAgdmFyIGlucHV0VGltZSA9ICQoJyNjaGF0aW5wdXQgdGltZScpOwogIHZhciB1cGRhdGVUaW1lID0gZnVuY3Rpb24oKSB7CiAgICBpZih3aW5kb3cuaXNJZGxlKCkpIHJldHVybjsKICAgIHZhciBkID0gbmV3IERhdGUoKTsKICAgIHZhciBoID0gZC5nZXRIb3VycygpICsgJyc7IGlmKGgubGVuZ3RoID09PSAxKSBoID0gJzAnICsgaDsKICAgIHZhciBtID0gZC5nZXRNaW51dGVzKCkgKyAnJzsgaWYobS5sZW5ndGggPT09IDEpIG0gPSAnMCcgKyBtOwogICAgaW5wdXRUaW1lLnRleHQoaCsnOicrbSk7CiAgICAvLyB1cGRhdGUgT04gdGhlIG1pbnV0ZSAoMW1zIGFmdGVyKQogICAgc2V0VGltZW91dCh1cGRhdGVUaW1lLCAoNjAgLSBkLmdldFNlY29uZHMoKSkgKiAxMDAwICsgMSk7CiAgfTsKICB1cGRhdGVUaW1lKCk7CiAgd2luZG93LmFkZFJlc3VtZUZ1bmN0aW9uKHVwZGF0ZVRpbWUpOwp9CgoKLy8KLy8gcG9zdGluZwovLwoKCndpbmRvdy5jaGF0LnNldHVwUG9zdGluZyA9IGZ1bmN0aW9uKCkgewogIGlmICghaXNTbWFydHBob25lKCkpIHsKICAgICQoJyNjaGF0aW5wdXQgaW5wdXQnKS5rZXlkb3duKGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIGtjID0gKGV2ZW50LmtleUNvZGUgPyBldmVudC5rZXlDb2RlIDogZXZlbnQud2hpY2gpOwogICAgICAgIGlmKGtjID09PSAxMykgeyAvLyBlbnRlcgogICAgICAgICAgY2hhdC5wb3N0TXNnKCk7CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0gZWxzZSBpZiAoa2MgPT09IDkpIHsgLy8gdGFiCiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgd2luZG93LmNoYXQuaGFuZGxlVGFiQ29tcGxldGlvbigpOwogICAgICAgIH0KICAgICAgfSBjYXRjaChlcnJvcikgewogICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICBkZWJ1Zy5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgfQogICAgfSk7CiAgfQoKICAkKCcjY2hhdGlucHV0Jykuc3VibWl0KGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgY2hhdC5wb3N0TXNnKCk7CiAgfSk7Cn0KCgp3aW5kb3cuY2hhdC5wb3N0TXNnID0gZnVuY3Rpb24oKSB7CiAgdmFyIGMgPSBjaGF0LmdldEFjdGl2ZSgpOwogIGlmKGMgPT0gJ2FsZXJ0cycpCiAgICByZXR1cm4gYWxlcnQoIkphcnZpczogQSBzdHJhbmdlIGdhbWUuIFRoZSBvbmx5IHdpbm5pbmcgbW92ZSBpcyBub3QgdG8gcGxheS4gSG93IGFib3V0IGEgbmljZSBnYW1lIG9mIGNoZXNzP1xuKFlvdSBjYW4ndCBjaGF0IHRvIHRoZSAnYWxlcnRzJyBjaGFubmVsISkiKTsKCiAgdmFyIG1zZyA9ICQudHJpbSgkKCcjY2hhdGlucHV0IGlucHV0JykudmFsKCkpOwogIGlmKCFtc2cgfHwgbXNnID09PSAnJykgcmV0dXJuOwoKICBpZihjID09PSAnZGVidWcnKSB7CiAgICB2YXIgcmVzdWx0OwogICAgdHJ5IHsKICAgICAgcmVzdWx0ID0gZXZhbChtc2cpOwogICAgfSBjYXRjaChlKSB7CiAgICAgIGlmKGUuc3RhY2spIGNvbnNvbGUuZXJyb3IoZS5zdGFjayk7CiAgICAgIHRocm93IGU7IC8vIHRvIHRyaWdnZXIgbmF0aXZlIGVycm9yIG1lc3NhZ2UKICAgIH0KICAgIGlmKHJlc3VsdCAhPT0gdW5kZWZpbmVkKQogICAgICBjb25zb2xlLmxvZyhyZXN1bHQudG9TdHJpbmcoKSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgdmFyIGxhdGxuZyA9IG1hcC5nZXRDZW50ZXIoKTsKCiAgdmFyIGRhdGEgPSB7bWVzc2FnZTogbXNnLAogICAgICAgICAgICAgIGxhdEU2OiBNYXRoLnJvdW5kKGxhdGxuZy5sYXQqMUU2KSwKICAgICAgICAgICAgICBsbmdFNjogTWF0aC5yb3VuZChsYXRsbmcubG5nKjFFNiksCiAgICAgICAgICAgICAgdGFiOiBjfTsKCiAgdmFyIGVyck1zZyA9ICdZb3VyIG1lc3NhZ2UgY291bGQgbm90IGJlIGRlbGl2ZXJlZC4gWW91IGNhbiBjb3B5JicgKwogICAgICAgICAgICAgICAncGFzdGUgaXQgaGVyZSBhbmQgdHJ5IGFnYWluIGlmIHlvdSB3YW50OlxuXG4nICsgbXNnOwoKICB3aW5kb3cucG9zdEFqYXgoJ3NlbmRQbGV4dCcsIGRhdGEsCiAgICBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICBpZihyZXNwb25zZS5lcnJvcikgYWxlcnQoZXJyTXNnKTsKICAgICAgc3RhcnRSZWZyZXNoVGltZW91dCgwLjEqMTAwMCk7IC8vb25seSBjaGF0IHVzZXMgdGhlIHJlZnJlc2ggdGltZXIgc3R1ZmYsIHNvIGEgcGVyZmVjdCB3YXkgb2YgZm9yY2luZyBhbiBlYXJseSByZWZyZXNoIGFmdGVyIGEgc2VuZCBtZXNzYWdlCiAgICB9LAogICAgZnVuY3Rpb24oKSB7CiAgICAgIGFsZXJ0KGVyck1zZyk7CiAgICB9CiAgKTsKCiAgJCgnI2NoYXRpbnB1dCBpbnB1dCcpLnZhbCgnJyk7Cn0KCgo7CgovLyBNQVAgREFUQSBDQUNIRSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBjYWNoZSBmb3IgbWFwIGRhdGEgdGlsZXMuIAoKd2luZG93LkRhdGFDYWNoZSA9IGZ1bmN0aW9uKCkgewogIHRoaXMuUkVRVUVTVF9DQUNIRV9GUkVTSF9BR0UgPSAzKjYwOyAgLy8gaWYgeW91bmdlciB0aGFuIHRoaXMsIHVzZSBkYXRhIGluIHRoZSBjYWNoZSByYXRoZXIgdGhhbiBmZXRjaGluZyBmcm9tIHRoZSBzZXJ2ZXIKCiAgdGhpcy5SRVFVRVNUX0NBQ0hFX01BWF9BR0UgPSA1KjYwOyAgLy8gbWF4aW11bSBjYWNoZSBhZ2UuIGVudHJpZXMgYXJlIGRlbGV0ZWQgZnJvbSB0aGUgY2FjaGUgYWZ0ZXIgdGhpcyB0aW1lCgogIC8vTk9URTogY2hhcmFjdGVycyBhcmUgMTYgYml0cyAoRUNNQVNjcmlwdCBzdGFuZGFyZCksIHNvIGRpdmlkZSBieXRlIHNpemUgYnkgdHdvIGZvciBjb3JyZWN0IGxpbWl0CiAgaWYgKEwuQnJvd3Nlci5tb2JpbGUpIHsKICAgIC8vIG9uIG1vYmlsZSBkZXZpY2VzLCBzbWFsbGVyIGNhY2hlIHNpemUKICAgIHRoaXMuUkVRVUVTVF9DQUNIRV9NQVhfSVRFTVMgPSAzMDA7ICAvLyBpZiBtb3JlIHRoYW4gdGhpcyBtYW55IGVudHJpZXMsIGV4cGlyZSBlYXJseQogICAgdGhpcy5SRVFVRVNUX0NBQ0hFX01BWF9DSEFSUyA9IDUwMDAwMDAvMjsgLy8gb3IgbW9yZSB0aGFuIHRoaXMgdG90YWwgc2l6ZQogIH0gZWxzZSB7CiAgICAvLyBidXQgb24gZGVza3RvcCwgYWxsb3cgbW9yZQogICAgdGhpcy5SRVFVRVNUX0NBQ0hFX01BWF9JVEVNUyA9IDEwMDA7ICAvLyBpZiBtb3JlIHRoYW4gdGhpcyBtYW55IGVudHJpZXMsIGV4cGlyZSBlYXJseQogICAgdGhpcy5SRVFVRVNUX0NBQ0hFX01BWF9DSEFSUyA9IDIwMDAwMDAwLzI7IC8vIG9yIG1vcmUgdGhhbiB0aGlzIHRvdGFsIHNpemUKICB9CgogIHRoaXMuX2NhY2hlID0ge307CiAgdGhpcy5fY2FjaGVDaGFyU2l6ZSA9IDA7CgogIHRoaXMuX2ludGVydmFsID0gdW5kZWZpbmVkOwoKfQoKd2luZG93LkRhdGFDYWNoZS5wcm90b3R5cGUuc3RvcmUgPSBmdW5jdGlvbihxayxkYXRhLGZyZXNoVGltZSkgewogIC8vIGZpeG1lPyBjb21tb24gYmVoYXZpb3VyIGZvciBvYmplY3RzIGlzIHRoYXQgcHJvcGVydGllcyBhcmUga2VwdCBpbiB0aGUgb3JkZXIgdGhleSdyZSBhZGRlZAogIC8vIHRoaXMgaXMgaGFuZHksIGFzIGl0IGFsbG93cyBlYXN5IHJldHJpZXZhbCBvZiB0aGUgb2xkZXN0IGVudHJpZXMgZm9yIGV4cGlyaW5nCiAgLy8gaG93ZXZlciwgdGhpcyBpcyBub3QgZ3VhcmFudGVlZCBieSB0aGUgc3RhbmRhcmRzLCBidXQgYWxsIG91ciBzdXBwb3J0ZWQgYnJvd3NlcnMgd29yayB0aGlzIHdheQoKICB0aGlzLnJlbW92ZShxayk7CgogIHZhciB0aW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CgogIGlmIChmcmVzaFRpbWU9PT11bmRlZmluZWQpIGZyZXNoVGltZSA9IHRoaXMuUkVRVUVTVF9DQUNIRV9GUkVTSF9BR0UqMTAwMDsKICB2YXIgZXhwaXJlID0gdGltZSArIGZyZXNoVGltZTsKCiAgdmFyIGRhdGFTdHIgPSBKU09OLnN0cmluZ2lmeShkYXRhKTsKCiAgdGhpcy5fY2FjaGVDaGFyU2l6ZSArPSBkYXRhU3RyLmxlbmd0aDsKICB0aGlzLl9jYWNoZVtxa10gPSB7IHRpbWU6IHRpbWUsIGV4cGlyZTogZXhwaXJlLCBkYXRhU3RyOiBkYXRhU3RyIH07Cn0KCndpbmRvdy5EYXRhQ2FjaGUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKHFrKSB7CiAgaWYgKHFrIGluIHRoaXMuX2NhY2hlKSB7CiAgICB0aGlzLl9jYWNoZUNoYXJTaXplIC09IHRoaXMuX2NhY2hlW3FrXS5kYXRhU3RyLmxlbmd0aDsKICAgIGRlbGV0ZSB0aGlzLl9jYWNoZVtxa107CiAgfQp9CgoKd2luZG93LkRhdGFDYWNoZS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24ocWspIHsKICBpZiAocWsgaW4gdGhpcy5fY2FjaGUpIHJldHVybiBKU09OLnBhcnNlKHRoaXMuX2NhY2hlW3FrXS5kYXRhU3RyKTsKICBlbHNlIHJldHVybiB1bmRlZmluZWQ7Cn0KCndpbmRvdy5EYXRhQ2FjaGUucHJvdG90eXBlLmdldFRpbWUgPSBmdW5jdGlvbihxaykgewogIGlmIChxayBpbiB0aGlzLl9jYWNoZSkgcmV0dXJuIHRoaXMuX2NhY2hlW3FrXS50aW1lOwogIGVsc2UgcmV0dXJuIDA7Cn0KCndpbmRvdy5EYXRhQ2FjaGUucHJvdG90eXBlLmlzRnJlc2ggPSBmdW5jdGlvbihxaykgewogIGlmIChxayBpbiB0aGlzLl9jYWNoZSkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHQgPSBkLmdldFRpbWUoKTsKICAgIGlmICh0aGlzLl9jYWNoZVtxa10uZXhwaXJlID49IHQpIHJldHVybiB0cnVlOwogICAgZWxzZSByZXR1cm4gZmFsc2U7CiAgfQoKICByZXR1cm4gdW5kZWZpbmVkOwp9Cgp3aW5kb3cuRGF0YUNhY2hlLnByb3RvdHlwZS5zdGFydEV4cGlyZUludGVydmFsID0gZnVuY3Rpb24ocGVyaW9kKSB7CiAgaWYgKHRoaXMuX2ludGVydmFsID09PSB1bmRlZmluZWQpIHsKICAgIHZhciBzYXZlZENvbnRleHQgPSB0aGlzOwogICAgdGhpcy5faW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCAoZnVuY3Rpb24oKSB7IHNhdmVkQ29udGV4dC5ydW5FeHBpcmUoKTsgfSwgcGVyaW9kKjEwMDApOwogIH0KfQoKd2luZG93LkRhdGFDYWNoZS5wcm90b3R5cGUuc3RvcEV4cGlyZUludGVydmFsID0gZnVuY3Rpb24oKSB7CiAgaWYgKHRoaXMuX2ludGVydmFsICE9PSB1bmRlZmluZWQpIHsKICAgIHN0b3BJbnRlcnZhbCAodGhpcy5faW50ZXJ2YWwpOwogICAgdGhpcy5faW50ZXJ2YWwgPSB1bmRlZmluZWQ7CiAgfQp9CgoKCndpbmRvdy5EYXRhQ2FjaGUucHJvdG90eXBlLnJ1bkV4cGlyZSA9IGZ1bmN0aW9uKCkgewogIHZhciBkID0gbmV3IERhdGUoKTsKICB2YXIgdCA9IGQuZ2V0VGltZSgpLXRoaXMuUkVRVUVTVF9DQUNIRV9NQVhfQUdFKjEwMDA7CgogIHZhciBjYWNoZVNpemUgPSBPYmplY3Qua2V5cyh0aGlzLl9jYWNoZSkubGVuZ3RoOwoKICBmb3IodmFyIHFrIGluIHRoaXMuX2NhY2hlKSB7CgogICAgLy8gZml4bWU/IG91ciBNQVhfU0laRSB0ZXN0IGhlcmUgYXNzdW1lcyB3ZSdyZSBwcm9jZXNzaW5nIHRoZSBvbGRlc3QgZmlyc3QuIHRoaXMgcmVsaWVzCiAgICAvLyBvbiBsb29waW5nIG92ZXIgb2JqZWN0IHByb3BlcnRpZXMgaW4gdGhlIG9yZGVyIHRoZXkgd2VyZSBhZGRlZC4gdGhpcyBpcyB0cnVlIGluIG1vc3QgYnJvd3NlcnMsCiAgICAvLyBidXQgaXMgbm90IGEgcmVxdWlyZW1lbnQgb2YgdGhlIHN0YW5kYXJkcwogICAgaWYgKGNhY2hlU2l6ZSA+IHRoaXMuUkVRVUVTVF9DQUNIRV9NQVhfSVRFTVMgfHwgdGhpcy5fY2FjaGVDaGFyU2l6ZSA+IHRoaXMuUkVRVUVTVF9DQUNIRV9NQVhfQ0hBUlMgfHwgdGhpcy5fY2FjaGVbcWtdLnRpbWUgPCB0KSB7CiAgICAgIHRoaXMuX2NhY2hlQ2hhclNpemUgLT0gdGhpcy5fY2FjaGVbcWtdLmRhdGFTdHIubGVuZ3RoOwogICAgICBkZWxldGUgdGhpcy5fY2FjaGVbcWtdOwogICAgICBjYWNoZVNpemUtLTsKICAgIH0KICB9Cn0KCgp3aW5kb3cuRGF0YUNhY2hlLnByb3RvdHlwZS5kZWJ1ZyA9IGZ1bmN0aW9uKCkgewovL05PVEU6IEVDTUFTY3JpcHQgc3RyaW5ncyB1c2UgMTYgYml0IGNoYXJzIChpdCdzIGluIHRoZSBzdGFuZGFyZCksIHNvIGNvbnZlcnQgZm9yIGJ5dGVzL0tiCiAgcmV0dXJuICdDYWNoZTogJytPYmplY3Qua2V5cyh0aGlzLl9jYWNoZSkubGVuZ3RoKycgaXRlbXMsICcrKHRoaXMuX2NhY2hlQ2hhclNpemUqMikudG9Mb2NhbGVTdHJpbmcoKSsnIGJ5dGVzICgnK01hdGguY2VpbCh0aGlzLl9jYWNoZUNoYXJTaXplLzUxMikudG9Mb2NhbGVTdHJpbmcoKSsnSyknOwp9CgoKOwoKCi8vIERFQlVHR0lORyBUT09MUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gbWVhbnQgdG8gYmUgdXNlZCBmcm9tIGJyb3dzZXIgZGVidWdnZXIgdG9vbHMgYW5kIHRoZSBsaWtlLgoKd2luZG93LmRlYnVnID0gZnVuY3Rpb24oKSB7fQoKd2luZG93LmRlYnVnLnJlbmRlckRldGFpbHMgPSBmdW5jdGlvbigpIHsKICBjb25zb2xlLmxvZygncG9ydGFsczogJyArIE9iamVjdC5rZXlzKHdpbmRvdy5wb3J0YWxzKS5sZW5ndGgpOwogIGNvbnNvbGUubG9nKCdsaW5rczogICAnICsgT2JqZWN0LmtleXMod2luZG93LmxpbmtzKS5sZW5ndGgpOwogIGNvbnNvbGUubG9nKCdmaWVsZHM6ICAnICsgT2JqZWN0LmtleXMod2luZG93LmZpZWxkcykubGVuZ3RoKTsKfQoKd2luZG93LmRlYnVnLnByaW50U3RhY2tUcmFjZSA9IGZ1bmN0aW9uKCkgewogIHZhciBlID0gbmV3IEVycm9yKCdkdW1teScpOwogIGNvbnNvbGUubG9nKGUuc3RhY2spOwogIHJldHVybiBlLnN0YWNrOwp9CgoKCndpbmRvdy5kZWJ1Zy5jb25zb2xlID0gZnVuY3Rpb24oKSB7CiAgJCgnI2RlYnVnY29uc29sZScpLnRleHQoKTsKfQoKd2luZG93LmRlYnVnLmNvbnNvbGUuc2hvdyA9IGZ1bmN0aW9uKCkgewogICAgJCgnI2NoYXQsICNjaGF0aW5wdXQnKS5zaG93KCk7CiAgICB3aW5kb3cuZGVidWcuY29uc29sZS5jcmVhdGUoKTsKICAgICQoJyNjaGF0aW5wdXQgbWFyaycpLmNzcygnY3NzVGV4dCcsICdjb2xvcjogI2JiYiAhaW1wb3J0YW50JykudGV4dCgnZGVidWc6Jyk7CiAgICAkKCcjY2hhdCA+IGRpdicpLmhpZGUoKTsKICAgICQoJyNkZWJ1Z2NvbnNvbGUnKS5zaG93KCk7CiAgICAkKCcjY2hhdGNvbnRyb2xzIC5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7CiAgICAkKCIjY2hhdGNvbnRyb2xzIGE6Y29udGFpbnMoJ2RlYnVnJykiKS5hZGRDbGFzcygnYWN0aXZlJyk7Cn0KCndpbmRvdy5kZWJ1Zy5jb25zb2xlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkgewogIGlmKCQoJyNkZWJ1Z2NvbnNvbGUnKS5sZW5ndGgpIHJldHVybjsKICAkKCcjY2hhdGNvbnRyb2xzJykuYXBwZW5kKCc8YT5kZWJ1ZzwvYT4nKTsKICAkKCcjY2hhdGNvbnRyb2xzIGE6bGFzdCcpLmNsaWNrKHdpbmRvdy5kZWJ1Zy5jb25zb2xlLnNob3cpOwogICQoJyNjaGF0JykuYXBwZW5kKCc8ZGl2IHN0eWxlPSJkaXNwbGF5OiBub25lIiBpZD0iZGVidWdjb25zb2xlIj48dGFibGU+PC90YWJsZT48L2Rpdj4nKTsKfQoKd2luZG93LmRlYnVnLmNvbnNvbGUucmVuZGVyTGluZSA9IGZ1bmN0aW9uKHRleHQsIGVycm9yVHlwZSkgewogIGRlYnVnLmNvbnNvbGUuY3JlYXRlKCk7CiAgc3dpdGNoKGVycm9yVHlwZSkgewogICAgY2FzZSAnZXJyb3InOiAgIHZhciBjb2xvciA9ICcjRkY0MjREJzsgYnJlYWs7CiAgICBjYXNlICd3YXJuaW5nJzogdmFyIGNvbG9yID0gJyNGRkRFNDInOyBicmVhazsKICAgIGRlZmF1bHQ6ICAgICAgICB2YXIgY29sb3IgPSAnI2VlZSc7CiAgfQogIGlmKHR5cGVvZiB0ZXh0ICE9PSAnc3RyaW5nJyAmJiB0eXBlb2YgdGV4dCAhPT0gJ251bWJlcicpIHsKICAgIHZhciBjYWNoZSA9IFtdOwogICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KHRleHQsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgaWYodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAhPT0gbnVsbCkgewogICAgICAgIGlmKGNhY2hlLmluZGV4T2YodmFsdWUpICE9PSAtMSkgewogICAgICAgICAgLy8gQ2lyY3VsYXIgcmVmZXJlbmNlIGZvdW5kLCBkaXNjYXJkIGtleQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyBTdG9yZSB2YWx1ZSBpbiBvdXIgY29sbGVjdGlvbgogICAgICAgIGNhY2hlLnB1c2godmFsdWUpOwogICAgICB9CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0pOwogICAgY2FjaGUgPSBudWxsOwogIH0KICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgdmFyIHRhID0gZC50b0xvY2FsZVRpbWVTdHJpbmcoKTsgLy8gcHJpbnQgbGluZSBpbnN0ZWFkIG1heWJlPwogIHZhciB0YiA9IGQudG9Mb2NhbGVTdHJpbmcoKTsKICB2YXIgdCA9ICc8dGltZSB0aXRsZT0iJyt0YisnIiBkYXRhLXRpbWVzdGFtcD0iJytkLmdldFRpbWUoKSsnIj4nK3RhKyc8L3RpbWU+JzsKICB2YXIgcyA9ICdzdHlsZT0iY29sb3I6Jytjb2xvcisnIic7CiAgdmFyIGwgPSAnPHRyPjx0ZD4nK3QrJzwvdGQ+PHRkPjxtYXJrICcrcysnPicrZXJyb3JUeXBlKyc8L21hcms+PC90ZD48dGQ+Jyt0ZXh0Kyc8L3RkPjwvdHI+JzsKICAkKCcjZGVidWdjb25zb2xlIHRhYmxlJykucHJlcGVuZChsKTsKfQoKd2luZG93LmRlYnVnLmNvbnNvbGUubG9nID0gZnVuY3Rpb24odGV4dCkgewogIGRlYnVnLmNvbnNvbGUucmVuZGVyTGluZSh0ZXh0LCAnbm90aWNlJyk7Cn0KCndpbmRvdy5kZWJ1Zy5jb25zb2xlLndhcm4gPSBmdW5jdGlvbih0ZXh0KSB7CiAgZGVidWcuY29uc29sZS5yZW5kZXJMaW5lKHRleHQsICd3YXJuaW5nJyk7Cn0KCndpbmRvdy5kZWJ1Zy5jb25zb2xlLmVycm9yID0gZnVuY3Rpb24odGV4dCkgewogIGRlYnVnLmNvbnNvbGUucmVuZGVyTGluZSh0ZXh0LCAnZXJyb3InKTsKfQoKd2luZG93LmRlYnVnLmNvbnNvbGUub3ZlcndyaXRlTmF0aXZlID0gZnVuY3Rpb24oKSB7CiAgd2luZG93LmRlYnVnLmNvbnNvbGUuY3JlYXRlKCk7CgogIHZhciBuYXRpdmVDb25zb2xlID0gd2luZG93LmNvbnNvbGU7CiAgd2luZG93LmNvbnNvbGUgPSB7fTsKCiAgZnVuY3Rpb24gb3ZlcndyaXRlKHdoaWNoKSB7CiAgICB3aW5kb3cuY29uc29sZVt3aGljaF0gPSBmdW5jdGlvbigpIHsKICAgICAgbmF0aXZlQ29uc29sZVt3aGljaF0uYXBwbHkobmF0aXZlQ29uc29sZSwgYXJndW1lbnRzKTsKICAgICAgd2luZG93LmRlYnVnLmNvbnNvbGVbd2hpY2hdLmFwcGx5KHdpbmRvdy5kZWJ1Zy5jb25zb2xlLCBhcmd1bWVudHMpOwogICAgfQogIH0KCiAgb3ZlcndyaXRlKCJsb2ciKTsKICBvdmVyd3JpdGUoIndhcm4iKTsKICBvdmVyd3JpdGUoImVycm9yIik7Cn0KCndpbmRvdy5kZWJ1Zy5jb25zb2xlLm92ZXJ3cml0ZU5hdGl2ZUlmUmVxdWlyZWQgPSBmdW5jdGlvbigpIHsKICBpZighd2luZG93LmNvbnNvbGUgfHwgTC5Ccm93c2VyLm1vYmlsZSkKICAgIHdpbmRvdy5kZWJ1Zy5jb25zb2xlLm92ZXJ3cml0ZU5hdGl2ZSgpOwp9CgoKOwoKLy8gRElBTE9HUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gSW5zcGlyZWQgYnkgVEVTIElJSTogTW9ycm93aW5kLiBMb25nIGxpdmUgSG91c2UgVGVsdmFubmkuIC8vLy8vLy8KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCi8qIFRoZSBnbG9iYWwgSUQgb2Ygb25zY3JlZW4gZGlhbG9ncy4KICogU3RhcnRzIGF0IDAuCiAqLwp3aW5kb3cuRElBTE9HX0lEID0gMDsKCi8qIEFsbCBvbnNjcmVlbiBkaWFsb2dzLCBrZXllZCBieSB0aGVpciBJRC4KICovCndpbmRvdy5ESUFMT0dTID0ge307CgovKiBUaGUgbnVtYmVyIG9mIGRpYWxvZ3Mgb24gc2NyZWVuLgogKi8Kd2luZG93LkRJQUxPR19DT1VOVCA9IDA7CgovKiBUaGUgZGlhbG9nIHRoYXQgaGFzIGZvY3VzLgogKi8Kd2luZG93LkRJQUxPR19GT0NVUyA9IG51bGw7CgovKiBDb250cm9scyBob3cgcXVpY2tseSB0aGUgc2xpZGUgdG9nZ2xlIGFuaW1hdGlvbgogKiBzaG91bGQgcGxheSBmb3IgZGlhbG9nIGNvbGxhcHNpbmcgYW5kIGV4cGFuZGluZy4KICovCndpbmRvdy5ESUFMT0dfU0xJREVfRFVSQVRJT04gPSAxMDA7CgovKiBDcmVhdGVzIGEgZGlhbG9nIGFuZCBwdXRzIGl0IG9uc2NyZWVuLiBUYWtlcyBvbmUgYXJndW1lbnQ6IG9wdGlvbnMsIGEgSlMgb2JqZWN0LgogKiA9PSBDb21tb24gb3B0aW9ucwogKiAodGV4dHxodG1sKTogVGhlIHRleHQgb3IgSFRNTCB0byBkaXNwbGF5IGluIHRoZSBkaWFsb2cuIFRleHQgaXMgYXV0by1jb252ZXJ0ZWQgdG8gSFRNTC4KICogdGl0bGU6IFRoZSBkaWFsb2cncyB0aXRsZS4KICogbW9kYWw6IFdoZXRoZXIgdG8gb3BlbiBhIG1vZGFsIGRpYWxvZy4gSW1wbGllcyBkcmFnZ2FibGU9ZmFsc2U7IGRpYWxvZ0NsYXNzPSd1aS1kaWFsb2ctbW9kYWwnLgogKiAgICAgICAgUGxlYXNlIG5vdGUgdGhhdCBtb2RhbCBkaWFsb2dzIGhpamFjayB0aGUgZW50aXJlIHNjcmVlbiBhbmQgc2hvdWxkIG9ubHkgYmUgdXNlZCBpbiB2ZXJ5CiAqICAgICAgICBzcGVjaWZpYyBjYXNlcy4gKElmIElJVEMgaXMgcnVubmluZyBvbiBtb2JpbGUsIG1vZGFsIHdpbGwgYWx3YXlzIGJlIHRydWUpLgogKiBpZDogICBBIHVuaXF1ZSBJRCBmb3IgdGhpcyBkaWFsb2cuIElmIGEgZGlhbG9nIHdpdGggaWQgYGlkJyBpcyBhbHJlYWR5IG9wZW4gYW5kIGRpYWxvZygpIGlzIGNhbGxlZAogKiAgICAgICBhZ2FpbiwgaXQgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNsb3NlZC4KICoKICogPT0gQ2FsbGJhY2tzCiAqIGNsb3NlQ2FsbGJhY2s6IEEgY2FsbGJhY2sgdG8gcnVuIG9uIGNsb3NlLiBUYWtlcyBubyBhcmd1bWVudHMuCiAqIGNvbGxhcHNlQ2FsbGJhY2s6IEEgY2FsbGJhY2sgdG8gcnVuIG9uIGRpYWxvZyBjb2xsYXBzZS4gIFRha2VzIG5vIGFyZ3VtZW50cy4KICogZXhwYW5kQ2FsbGJhY2s6ICAgQSBjYWxsYmFjayB0byBydW4gb24gZGlhbG9nIGV4cGFuc2lvbi4gVGFrZXMgbm8gYXJndW1lbnRzLgogKiBjb2xsYXBzZUV4cGFuZENhbGxiYWNrOiBBIGNhbGxiYWNrIHRvIHJ1biBvbiBib3RoIGNvbGxhcHNlIGFuZCBleHBhbmQgKG92ZXJyaWRlcyBjb2xsYXBzZUNhbGxiYWNrCiAqICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBleHBhbmRDYWxsYmFjaywgdGFrZXMgYSBib29sZWFuIGFyZ3VtZW50IGBjb2xsYXBzaW5nJyAtIHRydWUgaWYgY29sbGFwc2luZzsKICogICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UgaWYgZXhwYW5kaW5nKQogKiBmb2N1c0NhbGxiYWNrOiBBIGNhbGxiYWNrIHRvIHJ1biB3aGVuIHRoZSBkaWFsb2cgZ2FpbnMgZm9jdXMuCiAqIGJsdXJDYWxsYmFjazogIEEgY2FsbGJhY2sgdG8gcnVuIHdoZW4gdGhlIGRpYWxvZyBsb3NlcyBmb2N1cy4KICoKICogU2VlIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvQVBJLzEuOC9EaWFsb2cgZm9yIGEgbGlzdCBvZiBhbGwgdGhlIG9wdGlvbnMuIElmIHlvdSBwcmV2aW91c2x5CiAqIGFwcGxpZWQgYSBjbGFzcyB0byB5b3VyIGRpYWxvZyBhZnRlciBjcmVhdGluZyBpdCB3aXRoIGFsZXJ0KCksIGRpYWxvZ0NsYXNzIG1heSBiZSBwYXJ0aWN1bGFybHkKICogdXNlZnVsLgogKi8Kd2luZG93LmRpYWxvZyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAvLyBPdmVycmlkZSBmb3Igc21hcnRwaG9uZXMuIFByZXNlcnZlIGRlZmF1bHQgYmVoYXZpb3IgYW5kIGNyZWF0ZSBhIG1vZGFsIGRpYWxvZy4KICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICBpZihpc1NtYXJ0cGhvbmUoKSkgewogICAgb3B0aW9ucy5tb2RhbCA9IHRydWU7CiAgICBvcHRpb25zLndpZHRoID0gJ2F1dG8nOwogIH0KCiAgLy8gQnVpbGQgYW4gaWRlbnRpZmllciBmb3IgdGhpcyBkaWFsb2cKICB2YXIgaWQgPSAnZGlhbG9nLScgKyAob3B0aW9ucy5tb2RhbCA/ICdtb2RhbCcgOiAob3B0aW9ucy5pZCA/IG9wdGlvbnMuaWQgOiAnYW5vbi0nICsgd2luZG93LkRJQUxPR19JRCsrKSk7CiAgdmFyIGpxSUQgPSAnIycgKyBpZDsKICB2YXIgaHRtbCA9ICcnOwoKICAvLyBoaW50IGZvciBpaXRjIG1vYmlsZSB0aGF0IGEgZGlhbG9nIHdhcyBvcGVuZWQKICBpZiAodHlwZW9mIGFuZHJvaWQgIT09ICd1bmRlZmluZWQnICYmIGFuZHJvaWQgJiYgYW5kcm9pZC5kaWFsb2dPcGVuZWQpIHsKICAgIGFuZHJvaWQuZGlhbG9nT3BlbmVkKGlkLCB0cnVlKTsKICB9CgogIC8vIENvbnZlcnQgdGV4dCB0byBIVE1MIGlmIG5lY2Vzc2FyeQogIGlmKG9wdGlvbnMudGV4dCkgewogICAgaHRtbCA9IHdpbmRvdy5jb252ZXJ0VGV4dFRvVGFibGVNYWdpYyhvcHRpb25zLnRleHQpOwogIH0gZWxzZSBpZihvcHRpb25zLmh0bWwpIHsKICAgIGh0bWwgPSBvcHRpb25zLmh0bWw7CiAgfSBlbHNlIHsKICAgIGNvbnNvbGUubG9nKCd3aW5kb3cuZGlhbG9nOiB3YXJuaW5nOiBubyB0ZXh0IGluIGRpYWxvZycpOwogICAgaHRtbCA9IHdpbmRvdy5jb252ZXJ0VGV4dFRvVGFibGVNYWdpYygnJyk7CiAgfQoKICAvLyBNb2RhbCBkaWFsb2dzIHNob3VsZCBub3QgYmUgZHJhZ2dhYmxlCiAgaWYob3B0aW9ucy5tb2RhbCkgewogICAgb3B0aW9ucy5kaWFsb2dDbGFzcyA9ICd1aS1kaWFsb2ctbW9kYWwnOwogICAgb3B0aW9ucy5kcmFnZ2FibGUgPSBmYWxzZTsKICB9CgogIC8vIENsb3NlIG91dCBleGlzdGluZyBkaWFsb2dzLgogIGlmKHdpbmRvdy5ESUFMT0dTW2lkXSkgewogICAgdHJ5IHsKICAgICAgdmFyIHNlbGVjdG9yID0gJCh3aW5kb3cuRElBTE9HU1tpZF0pOwogICAgICBzZWxlY3Rvci5kaWFsb2coJ2Nsb3NlJyk7CiAgICAgIHNlbGVjdG9yLnJlbW92ZSgpOwogICAgfSBjYXRjaChlcnIpIHsKICAgICAgY29uc29sZS5sb2coJ3dpbmRvdy5kaWFsb2c6IFRyaWVkIHRvIGNsb3NlIG5vbmV4aXN0ZW50IGRpYWxvZyAnICsgaWQpOwogICAgfQogIH0KCiAgLy8gQ3JlYXRlIHRoZSB3aW5kb3csIGFwcGVuZGluZyBhIGRpdiB0byB0aGUgYm9keQogICQoJ2JvZHknKS5hcHBlbmQoJzxkaXYgaWQ9IicgKyBpZCArICciPjwvZGl2PicpOwogIHZhciBkaWFsb2cgPSAkKGpxSUQpLmRpYWxvZygkLmV4dGVuZCh0cnVlLCB7CiAgICBhdXRvT3BlbjogZmFsc2UsCiAgICBtb2RhbDogZmFsc2UsCiAgICBkcmFnZ2FibGU6IHRydWUsCiAgICBjbG9zZVRleHQ6ICcmbmJzcDsnLAogICAgdGl0bGU6ICcnLAogICAgYnV0dG9uczogewogICAgICAnT0snOiBmdW5jdGlvbigpIHsKICAgICAgICAkKHRoaXMpLmRpYWxvZygnY2xvc2UnKTsKICAgICAgfQogICAgfSwKICAgIG9wZW46IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGl0bGViYXIgPSAkKHRoaXMpLmNsb3Nlc3QoJy51aS1kaWFsb2cnKS5maW5kKCcudWktZGlhbG9nLXRpdGxlYmFyJyk7CiAgICAgIHRpdGxlYmFyLmZpbmQoJy51aS1kaWFsb2ctdGl0bGUnKS5hZGRDbGFzcygndWktZGlhbG9nLXRpdGxlLWFjdGl2ZScpOwogICAgICB2YXIgY2xvc2UgPSB0aXRsZWJhci5maW5kKCcudWktZGlhbG9nLXRpdGxlYmFyLWNsb3NlJyk7CgogICAgICAvLyBUaXRsZSBzaG91bGQgbm90IHNob3cgdXAgb24gbW91c2VvdmVyCiAgICAgIGNsb3NlLnJlbW92ZUF0dHIoJ3RpdGxlJykuYWRkQ2xhc3MoJ3VpLWRpYWxvZy10aXRsZWJhci1idXR0b24nKTsKCiAgICAgIGlmKCEkKHRoaXMpLmRpYWxvZygnb3B0aW9uJywgJ21vZGFsJykpIHsKICAgICAgICAvLyBTdGFydCBvdXQgd2l0aCBhIGNsb25lZCB2ZXJzaW9uIG9mIHRoZSBjbG9zZSBidXR0b24KICAgICAgICB2YXIgY29sbGFwc2UgPSBjbG9zZS5jbG9uZSgpOwoKICAgICAgICAvLyBDaGFuZ2UgaXQgaW50byBhIGNvbGxhcHNlIGJ1dHRvbiBhbmQgc2V0IHRoZSBjbGljayBoYW5kbGVyCiAgICAgICAgY29sbGFwc2UuYWRkQ2xhc3MoJ3VpLWRpYWxvZy10aXRsZWJhci1idXR0b24tY29sbGFwc2UgdWktZGlhbG9nLXRpdGxlYmFyLWJ1dHRvbi1jb2xsYXBzZS1leHBhbmRlZCcpOwogICAgICAgIGNvbGxhcHNlLmNsaWNrKCQucHJveHkoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgY29sbGFwc2VkID0gKCQodGhpcykuZGF0YSgnY29sbGFwc2VkJykgPT09IHRydWUpOwoKICAgICAgICAgIC8vIFJ1biBjYWxsYmFja3MgaWYgd2UgaGF2ZSB0aGVtCiAgICAgICAgICBpZigkKHRoaXMpLmRhdGEoJ2NvbGxhcHNlRXhwYW5kQ2FsbGJhY2snKSkgewogICAgICAgICAgICAkLnByb3h5KCQodGhpcykuZGF0YSgnY29sbGFwc2VFeHBhbmRDYWxsYmFjaycpLCB0aGlzKSghY29sbGFwc2VkKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmKCFjb2xsYXBzZWQgJiYgJCh0aGlzKS5kYXRhKCdjb2xsYXBzZUNhbGxiYWNrJykpIHsKICAgICAgICAgICAgICAkLnByb3h5KCQodGhpcykuZGF0YSgnY29sbGFwc2VDYWxsYmFjaycpLCB0aGlzKSgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbGxhcHNlZCAmJiAkKHRoaXMpLmRhdGEoJ2V4cGFuZENhbGxiYWNrJykpIHsKICAgICAgICAgICAgICAkLnByb3h5KCQodGhpcykuZGF0YSgnZXhwYW5kQ2FsbGJhY2snKSwgdGhpcykoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIEZpbmQgdGhlIGJ1dHRvbiBwYW5lIGFuZCBjb250ZW50IGRpYWxvZyBpbiB0aGlzIHVpLWRpYWxvZywgYW5kIGFkZCBvciByZW1vdmUgdGhlICdoaWRkZW4nIGNsYXNzLgogICAgICAgICAgdmFyIGRpYWxvZyAgID0gJCh0aGlzKS5jbG9zZXN0KCcudWktZGlhbG9nJyk7CiAgICAgICAgICB2YXIgc2VsZWN0b3IgPSBkaWFsb2cuZmluZCgnLnVpLWRpYWxvZy1jb250ZW50LC51aS1kaWFsb2ctYnV0dG9ucGFuZScpOwogICAgICAgICAgdmFyIGJ1dHRvbiAgID0gZGlhbG9nLmZpbmQoJy51aS1kaWFsb2ctdGl0bGViYXItYnV0dG9uLWNvbGxhcHNlJyk7CgogICAgICAgICAgLy8gU2xpZGUgdG9nZ2xlCiAgICAgICAgICAkKHNlbGVjdG9yKS5zbGlkZVRvZ2dsZSh7ZHVyYXRpb246IHdpbmRvdy5ESUFMT0dfU0xJREVfRFVSQVRJT059KTsKCiAgICAgICAgICBpZihjb2xsYXBzZWQpIHsKICAgICAgICAgICAgJChidXR0b24pLnJlbW92ZUNsYXNzKCd1aS1kaWFsb2ctdGl0bGViYXItYnV0dG9uLWNvbGxhcHNlLWNvbGxhcHNlZCcpOwogICAgICAgICAgICAkKGJ1dHRvbikuYWRkQ2xhc3MoJ3VpLWRpYWxvZy10aXRsZWJhci1idXR0b24tY29sbGFwc2UtZXhwYW5kZWQnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoYnV0dG9uKS5yZW1vdmVDbGFzcygndWktZGlhbG9nLXRpdGxlYmFyLWJ1dHRvbi1jb2xsYXBzZS1leHBhbmRlZCcpOwogICAgICAgICAgICAkKGJ1dHRvbikuYWRkQ2xhc3MoJ3VpLWRpYWxvZy10aXRsZWJhci1idXR0b24tY29sbGFwc2UtY29sbGFwc2VkJyk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gVG9nZ2xlIGNvbGxhcHNlZCBzdGF0ZQogICAgICAgICAgJCh0aGlzKS5kYXRhKCdjb2xsYXBzZWQnLCAhY29sbGFwc2VkKTsKICAgICAgICB9LCB0aGlzKSk7CgogICAgICAgIC8vIFB1dCBpdCBpbnRvIHRoZSB0aXRsZWJhcgogICAgICAgIHRpdGxlYmFyLnByZXBlbmQoY29sbGFwc2UpOwogICAgICAgIGNsb3NlLmFkZENsYXNzKCd1aS1kaWFsb2ctdGl0bGViYXItYnV0dG9uLWNsb3NlJyk7CiAgICAgIH0KCiAgICAgIHdpbmRvdy5ESUFMT0dTWyQodGhpcykuZGF0YSgnaWQnKV0gPSB0aGlzOwogICAgICB3aW5kb3cuRElBTE9HX0NPVU5UKys7CgogICAgICBjb25zb2xlLmxvZygnd2luZG93LmRpYWxvZzogJyArICQodGhpcykuZGF0YSgnaWQnKSArICcgKCcgKyAkKHRoaXMpLmRpYWxvZygnb3B0aW9uJywgJ3RpdGxlJykgKyAnKSBvcGVuZWQuICcgKyB3aW5kb3cuRElBTE9HX0NPVU5UICsgJyByZW1haW4uJyk7CiAgICB9LAogICAgY2xvc2U6IGZ1bmN0aW9uKCkgewogICAgICAvLyBSdW4gdGhlIGNsb3NlIGNhbGxiYWNrIGlmIHdlIGhhdmUgb25lCiAgICAgIGlmKCQodGhpcykuZGF0YSgnY2xvc2VDYWxsYmFjaycpKSB7CiAgICAgICAgJC5wcm94eSgkKHRoaXMpLmRhdGEoJ2Nsb3NlQ2FsbGJhY2snKSwgdGhpcykoKTsKICAgICAgfQoKICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgd2UgZG9uJ3Qga2VlcCBhIGRlYWQgZGlhbG9nIGluIGZvY3VzCiAgICAgIGlmKHdpbmRvdy5ESUFMT0dfRk9DVVMgJiYgJCh3aW5kb3cuRElBTE9HX0ZPQ1VTKS5kYXRhKCdpZCcpID09PSAkKHRoaXMpLmRhdGEoJ2lkJykpIHsKICAgICAgICB3aW5kb3cuRElBTE9HX0ZPQ1VTID0gbnVsbDsKICAgICAgfQoKICAgICAgLy8gRmluYWxpemUKICAgICAgZGVsZXRlIHdpbmRvdy5ESUFMT0dTWyQodGhpcykuZGF0YSgnaWQnKV07CgogICAgICB3aW5kb3cuRElBTE9HX0NPVU5ULS07CiAgICAgIGNvbnNvbGUubG9nKCd3aW5kb3cuZGlhbG9nOiAnICsgJCh0aGlzKS5kYXRhKCdpZCcpICsgJyAoJyArICQodGhpcykuZGlhbG9nKCdvcHRpb24nLCAndGl0bGUnKSArICcpIGNsb3NlZC4gJyArIHdpbmRvdy5ESUFMT0dfQ09VTlQgKyAnIHJlbWFpbi4nKTsKICAgICAgLy8gaGludCBmb3IgaWl0YyBtb2JpbGUgdGhhdCBhIGRpYWxvZyB3YXMgY2xvc2VkCiAgICAgIGlmICh0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCAmJiBhbmRyb2lkLmRpYWxvZ09wZW5lZCkgewogICAgICAgIGFuZHJvaWQuZGlhbG9nT3BlbmVkKGlkLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIC8vIHJlbW92ZSBmcm9tIERPTSBhbmQgZGVzdHJveQogICAgICAkKHRoaXMpLmRpYWxvZygnZGVzdHJveScpLnJlbW92ZSgpOwogICAgfSwKICAgIGZvY3VzOiBmdW5jdGlvbigpIHsKICAgICAgaWYoJCh0aGlzKS5kYXRhKCdmb2N1c0NhbGxiYWNrJykpIHsKICAgICAgICAkLnByb3h5KCQodGhpcykuZGF0YSgnZm9jdXNDYWxsYmFjaycpLCB0aGlzKSgpOwogICAgICB9CgogICAgICAvLyBCbHVyIHRoZSB3aW5kb3cgY3VycmVudGx5IGluIGZvY3VzIHVubGVzcyB3ZSdyZSBnYWluaW5nIGZvY3VzCiAgICAgIGlmKHdpbmRvdy5ESUFMT0dfRk9DVVMgJiYgJCh3aW5kb3cuRElBTE9HX0ZPQ1VTKS5kYXRhKCdpZCcpICE9PSAkKHRoaXMpLmRhdGEoJ2lkJykpIHsKICAgICAgICAkLnByb3h5KGZ1bmN0aW9uKGV2ZW50LCB1aSkgewogICAgICAgICAgaWYoJCh0aGlzKS5kYXRhKCdibHVyQ2FsbGJhY2snKSkgewogICAgICAgICAgICAkLnByb3h5KCQodGhpcykuZGF0YSgnYmx1ckNhbGxiYWNrJyksIHRoaXMpKCk7CiAgICAgICAgICB9CgogICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcudWktZGlhbG9nJykuZmluZCgnLnVpLWRpYWxvZy10aXRsZScpLnJlbW92ZUNsYXNzKCd1aS1kaWFsb2ctdGl0bGUtYWN0aXZlJykuYWRkQ2xhc3MoJ3VpLWRpYWxvZy10aXRsZS1pbmFjdGl2ZScpOwogICAgICAgIH0sIHdpbmRvdy5ESUFMT0dfRk9DVVMpKCk7CiAgICAgIH0KCiAgICAgIC8vIFRoaXMgZGlhbG9nIGlzIG5vdyBpbiBmb2N1cwogICAgICB3aW5kb3cuRElBTE9HX0ZPQ1VTID0gdGhpczsKICAgICAgLy8gaGludCBmb3IgaWl0YyBtb2JpbGUgdGhhdCBhIGRpYWxvZyB3YXMgZm9jdXNlZAogICAgICBpZiAodHlwZW9mIGFuZHJvaWQgIT09ICd1bmRlZmluZWQnICYmIGFuZHJvaWQgJiYgYW5kcm9pZC5kaWFsb2dGb2N1c2VkKSB7CiAgICAgICAgYW5kcm9pZC5kaWFsb2dGb2N1c2VkKCQod2luZG93LkRJQUxPR19GT0NVUykuZGF0YSgnaWQnKSk7CiAgICAgIH0KICAgICAgJCh0aGlzKS5jbG9zZXN0KCcudWktZGlhbG9nJykuZmluZCgnLnVpLWRpYWxvZy10aXRsZScpLnJlbW92ZUNsYXNzKCd1aS1kaWFsb2ctdGl0bGUtaW5hY3RpdmUnKS5hZGRDbGFzcygndWktZGlhbG9nLXRpdGxlLWFjdGl2ZScpOwogICAgfQogIH0sIG9wdGlvbnMpKTsKCiAgLy8gU2V0IEhUTUwgYW5kIElEcwogIGRpYWxvZy5odG1sKGh0bWwpOwogIGRpYWxvZy5kYXRhKCdpZCcsIGlkKTsKICBkaWFsb2cuZGF0YSgnanFJRCcsIGpxSUQpOwoKICAvLyBTZXQgY2FsbGJhY2tzCiAgZGlhbG9nLmRhdGEoJ2Nsb3NlQ2FsbGJhY2snLCBvcHRpb25zLmNsb3NlQ2FsbGJhY2spOwogIGRpYWxvZy5kYXRhKCdjb2xsYXBzZUNhbGxiYWNrJywgb3B0aW9ucy5jb2xsYXBzZUNhbGxiYWNrKTsKICBkaWFsb2cuZGF0YSgnZXhwYW5kQ2FsbGJhY2snLCBvcHRpb25zLmV4cGFuZENhbGxiYWNrKTsKICBkaWFsb2cuZGF0YSgnY29sbGFwc2VFeHBhbmRDYWxsYmFjaycsIG9wdGlvbnMuY29sbGFwc2VFeHBhbmRDYWxsYmFjayk7CiAgZGlhbG9nLmRhdGEoJ2ZvY3VzQ2FsbGJhY2snLCBvcHRpb25zLmZvY3VzQ2FsbGJhY2spOwogIGRpYWxvZy5kYXRhKCdibHVyQ2FsbGJhY2snLCBvcHRpb25zLmJsdXJDYWxsYmFjayk7CgogIGlmKG9wdGlvbnMubW9kYWwpIHsKICAgIC8vIHVpLW1vZGFsIGluY2x1ZGVzIG92ZXJyaWRlcyBmb3IgbW9kYWwgZGlhbG9ncwogICAgZGlhbG9nLnBhcmVudCgpLmFkZENsYXNzKCd1aS1tb2RhbCcpOwogIH0gZWxzZSB7CiAgICAvLyBFbmFibGUgc25hcHBpbmcKICAgIGRpYWxvZy5kaWFsb2coKS5wYXJlbnRzKCcudWktZGlhbG9nJykuZHJhZ2dhYmxlKCdvcHRpb24nLCAnc25hcCcsIHRydWUpOwogIH0KCiAgLy8gUnVuIGl0CiAgZGlhbG9nLmRpYWxvZygnb3BlbicpOwoKICByZXR1cm4gZGlhbG9nOwp9CgovKiBDcmVhdGVzIGFuIGFsZXJ0IGRpYWxvZyB3aXRoIGRlZmF1bHQgc2V0dGluZ3MuCiAqIElmIHlvdSB3YW50IG1vcmUgY29uZmlndXJhYmlsaXR5LCB1c2Ugd2luZG93LmRpYWxvZyBpbnN0ZWFkLgogKi8Kd2luZG93LmFsZXJ0ID0gZnVuY3Rpb24odGV4dCwgaXNIVE1MLCBjbG9zZUNhbGxiYWNrKSB7CiAgdmFyIG9iaiA9IHtjbG9zZUNhbGxiYWNrOiBjbG9zZUNhbGxiYWNrfTsKICBpZihpc0hUTUwpIHsKICAgIG9iai5odG1sID0gdGV4dDsKICB9IGVsc2UgewogICAgb2JqLnRleHQgPSB0ZXh0OwogIH0KCiAgcmV0dXJuIGRpYWxvZyhvYmopOwp9Cgp3aW5kb3cuc2V0dXBEaWFsb2dzID0gZnVuY3Rpb24oKSB7CiAgd2luZG93LkRJQUxPR19JRCA9IDA7CiAgd2luZG93LkRJQUxPR1MgICA9IHt9CiAgd2luZG93LkRJQUxPR19DT1VOVCA9IDA7CiAgd2luZG93LkRJQUxPR19GT0NVUyA9IG51bGw7Cn0KCgo7CgovLyBkZWNvZGUgdGhlIG9uLW5ldHdvcmsgYXJyYXkgZW50aXR5IGZvcm1hdCBpbnRvIGFuIG9iamVjdCBmb3JtYXQgY2xvc2VyIHRvIHRoYXQgdXNlZCBiZWZvcmUKLy8gbWFrZXMgbXVjaCBtb3JlIHNlbnNlIGFzIGFuIG9iamVjdCwgbWVhbnMgdGhhdCBleGlzdGluZyBjb2RlIGRpZG4ndCBuZWVkIHRvIGNoYW5nZSwgYW5kIGl0J3Mgd2hhdCB0aGUKLy8gc3RvY2sgaW50ZWwgc2l0ZSBkb2VzIGludGVybmFsbHkgdG9vICh0aGUgYXJyYXkgZm9ybWF0IGlzIG9ubHkgb24gdGhlIG5ldHdvcmspCgoKLy8gYW5vbnltb3VzIHdyYXBwZXIgZnVuY3Rpb24KKGZ1bmN0aW9uKCl7CiAgd2luZG93LmRlY29kZUFycmF5ID0gZnVuY3Rpb24oKXt9OwoKCiAgZnVuY3Rpb24gcGFyc2VNb2QoYXJyKSB7CiAgICBpZihhcnIgPT0gbnVsbCkgeyByZXR1cm4gbnVsbDsgfQogICAgcmV0dXJuIHsKICAgICAgb3duZXI6IGFyclswXSwKICAgICAgbmFtZTogYXJyWzFdLAogICAgICByYXJpdHk6IGFyclsyXSwKICAgICAgc3RhdHM6IGFyclszXSwKICAgIH07CiAgfQogIGZ1bmN0aW9uIHBhcnNlUmVzb25hdG9yKGFycikgewogICAgaWYoYXJyID09IG51bGwpIHsgcmV0dXJuIG51bGw7IH0KICAgIHJldHVybiB7CiAgICAgIG93bmVyOiBhcnJbMF0sCiAgICAgIGxldmVsOiBhcnJbMV0sCiAgICAgIGVuZXJneTogYXJyWzJdLAogICAgfTsKICB9CiAgZnVuY3Rpb24gcGFyc2VBcnRpZmFjdEJyaWVmKGFycikgewogICAgaWYgKGFyciA9PT0gbnVsbCkgcmV0dXJuIG51bGw7CgogICAgLy8gYXJyYXkgaW5kZXggMCBpcyBmb3IgZnJhZ21lbnRzIGF0IHRoZSBwb3J0YWwuIGluZGV4IDEgaXMgZm9yIHRhcmdldCBwb3J0YWxzCiAgICAvLyBlYWNoIG9mIHRob3NlIGlzIHR3byBkaW1lbnNpb25hbCAtIG5vdCBzdXJlIHdoeS4gcGFydCBvZiB0aGlzIGlzIHRvIGFsbG93IGZvciBtdWx0aXBsZSB0eXBlcyBvZiBhcnRpZmFjdHMsCiAgICAvLyB3aXRoIHRoZWlyIG93biB0YXJnZXRzLCBhY3RpdmUgYXQgb25jZSAtIGJ1dCBvbmUgbGV2ZWwgZm9yIHRoZSBhcnJheSBpcyBlbm91Z2ggZm9yIHRoYXQKCiAgICAvLyBtYWtpbmcgYSBndWVzcyAtIGZpcnN0IGxldmVsIGlzIGZvciBkaWZmZXJlbnQgYXJ0aWZhY3QgdHlwZXMsIHNlY29uZCBpbmRleCB3b3VsZCBhbGxvdyBmb3IKICAgIC8vIGV4dHJhIGRhdGEgZm9yIHRoYXQgYXJ0aWZhY3QgdHlwZQoKICAgIGZ1bmN0aW9uIGRlY29kZUFydGlmYWN0QXJyYXkoYXJyKSB7CiAgICAgIHZhciByZXN1bHQgPSB7fTsKICAgICAgZm9yICh2YXIgaT0wOyBpPGFyci5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIHdlJ2xsIHVzZSB0aGUgdHlwZSBhcyB0aGUga2V5IC0gYW5kIHN0b3JlIGFueSBhZGRpdGlvbmFsIGFycmF5IHZhbHVlcyBhcyB0aGUgdmFsdWUKICAgICAgICAvLyB0aGF0IHdpbGwgYmUgYW4gZW1wdHkgYXJyYXkgZm9yIG5vdywgc28gb25seSBvYmplY3Qga2V5cyBhcmUgdXNlZnVsIGRhdGEKICAgICAgICByZXN1bHRbYXJyW2ldWzBdXSA9IGFycltpXS5zbGljZSgxKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIGZyYWdtZW50OiBkZWNvZGVBcnRpZmFjdEFycmF5KGFyclswXSksCiAgICAgIHRhcmdldDogZGVjb2RlQXJ0aWZhY3RBcnJheShhcnJbMV0pLAogICAgfTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlQXJ0aWZhY3REZXRhaWwoYXJyKSB7CiAgICBpZiAoYXJyID09IG51bGwpIHsgcmV0dXJuIG51bGw7IH0KICAgIC8vIGVtcHR5IGFydGlmYWN0IGRhdGEgaXMgcG9pbnRsZXNzIC0gaWdub3JlIGl0CiAgICBpZiAoYXJyLmxlbmd0aCA9PSAzICYmIGFyclswXSA9PSAiIiAmJiBhcnJbMV0gPT0gIiIgJiYgYXJyWzJdLmxlbmd0aCA9PSAwKSB7IHJldHVybiBudWxsOyB9CiAgICByZXR1cm4gewogICAgICB0eXBlOiBhcnJbMF0sCiAgICAgIGRpc3BsYXlOYW1lOiBhcnJbMV0sCiAgICAgIGZyYWdtZW50czogYXJyWzJdLAogICAgfTsKICB9CgoKLy90aGVyZSdzIGFsc28gYSAncGxhY2Vob2xkZXInIHBvcnRhbCAtIGdlbmVyYXRlZCBmcm9tIHRoZSBkYXRhIGluIGxpbmtzL2ZpZWxkcy4gb25seSBoYXMgdGVhbS9sYXQvbG5nCgogIHZhciBDT1JFX1BPUlRBX0RBVEFfTEVOR1RIID0gNDsKICBmdW5jdGlvbiBjb3JlUG9ydGFsRGF0YShhKSB7CiAgICByZXR1cm4gewogICAgICAvLyBhWzBdID09IHR5cGUgKGFsd2F5cyAncCcpCiAgICAgIHRlYW06ICAgICAgICAgIGFbMV0sCiAgICAgIGxhdEU2OiAgICAgICAgIGFbMl0sCiAgICAgIGxuZ0U2OiAgICAgICAgIGFbM10KICAgIH0KICB9OwoKICB2YXIgU1VNTUFSWV9QT1JUQUxfREFUQV9MRU5HVEggPSAxNDsKICBmdW5jdGlvbiBzdW1tYXJ5UG9ydGFsRGF0YShhKSB7CiAgICByZXR1cm4gewogICAgICBsZXZlbDogICAgICAgICBhWzRdLAogICAgICBoZWFsdGg6ICAgICAgICBhWzVdLAogICAgICByZXNDb3VudDogICAgICBhWzZdLAogICAgICBpbWFnZTogICAgICAgICBhWzddLAogICAgICB0aXRsZTogICAgICAgICBhWzhdLAogICAgICBvcm5hbWVudHM6ICAgICBhWzldLAogICAgICBtaXNzaW9uOiAgICAgICBhWzEwXSwKICAgICAgbWlzc2lvbjUwcGx1czogYVsxMV0sCiAgICAgIGFydGlmYWN0QnJpZWY6IHBhcnNlQXJ0aWZhY3RCcmllZihhWzEyXSksCiAgICAgIHRpbWVzdGFtcDogICAgIGFbMTNdCiAgICB9OwogIH07CgogIHZhciBERVRBSUxFRF9QT1JUQUxfREFUQV9MRU5HVEggPSBTVU1NQVJZX1BPUlRBTF9EQVRBX0xFTkdUSCs0OwoKCiAgd2luZG93LmRlY29kZUFycmF5LnBvcnRhbFN1bW1hcnkgPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoIWEpIHJldHVybiB1bmRlZmluZWQ7CgogICAgaWYgKGFbMF0gIT0gJ3AnKSB0aHJvdyAnRXJyb3I6IGRlY29kZUFycmF5LnBvcnRhbFNVbW1hcnkgLSBub3QgYSBwb3J0YWwnOwoKICAgIGlmIChhLmxlbmd0aCA9PSBDT1JFX1BPUlRBX0RBVEFfTEVOR1RIKSB7CiAgICAgIHJldHVybiBjb3JlUG9ydGFsRGF0YShhKTsKICAgIH0KCiAgICAvLyBOT1RFOiBhbGxvdyBmb3IgZWl0aGVyIHN1bW1hcnkgb3IgZGV0YWlsZWQgcG9ydGFsIGRhdGEgdG8gYmUgcGFzc2VkIGluIGhlcmUsIGFzIGRldGFpbHMgYXJlIHNvbWV0aW1lcwogICAgLy8gcGFzc2VkIGludG8gY29kZSBvbmx5IGV4cGVjdGluZyBzdW1tYXJpZXMKICAgIGlmIChhLmxlbmd0aCAhPSBTVU1NQVJZX1BPUlRBTF9EQVRBX0xFTkdUSCAmJiBhLmxlbmd0aCAhPSBERVRBSUxFRF9QT1JUQUxfREFUQV9MRU5HVEgpIHsKICAgICAgY29uc29sZS53YXJuKCdQb3J0YWwgc3VtbWFyeSBsZW5ndGggY2hhbmdlZCAtIHBvcnRhbCBkZXRhaWxzIGxpa2VseSBicm9rZW4hJyk7CiAgICAgIGRlYnVnZ2VyOwogICAgfQoKICAgIHJldHVybiAkLmV4dGVuZChjb3JlUG9ydGFsRGF0YShhKSwgc3VtbWFyeVBvcnRhbERhdGEoYSkpOwogIH0KCiAgd2luZG93LmRlY29kZUFycmF5LnBvcnRhbERldGFpbCA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmICghYSkgcmV0dXJuIHVuZGVmaW5lZDsKCiAgICBpZiAoYVswXSAhPSAncCcpIHRocm93ICdFcnJvcjogZGVjb2RlQXJyYXkucG9ydGFsRGV0YWlsIC0gbm90IGEgcG9ydGFsJzsKCiAgICBpZiAoYS5sZW5ndGggIT0gREVUQUlMRURfUE9SVEFMX0RBVEFfTEVOR1RIKSB7CiAgICAgIGNvbnNvbGUud2FybignUG9ydGFsIGRldGFpbCBsZW5ndGggY2hhbmdlZCAtIHBvcnRhbCBkZXRhaWxzIG1heSBiZSB3cm9uZycpOwogICAgICBkZWJ1Z2dlcjsKICAgIH0KCiAgICAvL1RPRE8gbG9vayBhdCB0aGUgYXJyYXkgdmFsdWVzLCBtYWtlIGEgYmV0dGVyIGd1ZXNzIGFzIHRvIHdoaWNoIGluZGV4IHRoZSBtb2RzIHN0YXJ0IGF0LCByYXRoZXIgdGhhbiB1c2luZyB0aGUgaGFyZC1jb2RlZCBTVU1NQVJZX1BPUlRBTF9EQVRBX0xFTkdUSCBjb25zdGFudAoKCiAgICAvLyB0aGUgcG9ydGFsIGRldGFpbHMgYXJyYXkgaXMganVzdCBhbiBleHRlbnNpb24gb2YgdGhlIHBvcnRhbCBzdW1tYXJ5IGFycmF5CiAgICAvLyB0byBhbGxvdyBmb3IgbmlhbnRpYyBhZGRpbmcgbmV3IGl0ZW1zIGludG8gdGhlIGFycmF5IGJlZm9yZSB0aGUgZXh0ZW5kZWQgZGV0YWlscyBzdGFydCwKICAgIC8vIHVzZSB0aGUgbGVuZ3RoIG9mIHRoZSBzdW1tYXJ5IGFycmF5CiAgICByZXR1cm4gJC5leHRlbmQoY29yZVBvcnRhbERhdGEoYSksIHN1bW1hcnlQb3J0YWxEYXRhKGEpLHsKICAgICAgbW9kczogICAgICBhW1NVTU1BUllfUE9SVEFMX0RBVEFfTEVOR1RIKzBdLm1hcChwYXJzZU1vZCksCiAgICAgIHJlc29uYXRvcnM6YVtTVU1NQVJZX1BPUlRBTF9EQVRBX0xFTkdUSCsxXS5tYXAocGFyc2VSZXNvbmF0b3IpLAogICAgICBvd25lcjogICAgIGFbU1VNTUFSWV9QT1JUQUxfREFUQV9MRU5HVEgrMl0sCiAgICAgIGFydGlmYWN0RGV0YWlsOiAgcGFyc2VBcnRpZmFjdERldGFpbChhW1NVTU1BUllfUE9SVEFMX0RBVEFfTEVOR1RIKzNdKSwKICAgIH0pOwogICAgCiAgfQoKCn0pKCk7CgoKOwoKCgovLyBFTlRJVFkgREVUQUlMUyBUT09MUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIGhhbmQgYW55IG9mIHRoZXNlIGZ1bmN0aW9ucyB0aGUgZGV0YWlscy1oYXNoIG9mIGFuIGVudGl0eSAoaS5lLgovLyBwb3J0YWwsIGxpbmssIGZpZWxkKSBhbmQgdGhleSB3aWxsIHJldHVybiB1c2VmdWwgZGF0YS4KCgovLyBnaXZlbiB0aGUgZW50aXR5IGRldGFpbCBkYXRhLCByZXR1cm5zIHRoZSB0ZWFtIHRoZSBlbnRpdHkgYmVsb25ncwovLyB0by4gVXNlcyBURUFNXyogZW51bSB2YWx1ZXMuCndpbmRvdy5nZXRUZWFtID0gZnVuY3Rpb24oZGV0YWlscykgewogIHJldHVybiB0ZWFtU3RyaW5nVG9JZChkZXRhaWxzLnRlYW0pOwp9Cgp3aW5kb3cudGVhbVN0cmluZ1RvSWQgPSBmdW5jdGlvbih0ZWFtU3RyKSB7CiAgdmFyIHRlYW0gPSBURUFNX05PTkU7CiAgaWYodGVhbVN0ciA9PT0gJ0VOTElHSFRFTkVEJykgdGVhbSA9IFRFQU1fRU5MOwogIGlmKHRlYW1TdHIgPT09ICdSRVNJU1RBTkNFJykgdGVhbSA9IFRFQU1fUkVTOwogIGlmKHRlYW1TdHIgPT09ICdFJykgdGVhbSA9IFRFQU1fRU5MOwogIGlmKHRlYW1TdHIgPT09ICdSJykgdGVhbSA9IFRFQU1fUkVTOwogIHJldHVybiB0ZWFtOwp9CgoKCgo7CgovLyBhcyBvZiAyMDE0LTA4LTE0LCBOaWFudGljIGhhdmUgcmV0dXJuZWQgdG8gbWluaWZ5aW5nIHRoZSBqYXZhc2NyaXB0LiBUaGlzIG1lYW5zIHdlIG5vIGxvbmdlciBnZXQgdGhlIG5lbWVzaXMgb2JqZWN0Ci8vIGFuZCBpdCdzIHZhcmlvdXMgbWVtYmVyIG9iamVjdHMsIGZ1bmN0aW9ucywgZXRjLgovLyBzbyB3ZSBuZWVkIHRvIGV4dHJhY3Qgc29tZSBlc3NlbnRpYWwgcGFyYW1ldGVycyBmcm9tIHRoZSBjb2RlIGZvciBJSVRDIHRvIHVzZQoKd2luZG93LmV4dHJhY3RGcm9tU3RvY2sgPSBmdW5jdGlvbigpIHsKICB3aW5kb3cubmlhbnRpY19wYXJhbXMgPSB7fQoKICAvLyBleHRyYWN0IHRoZSBmb3JtZXIgbmVtZXNpcy5kYXNoYm9hcmQuY29uZmlnLkNVUlJFTlRfVkVSU0lPTiBmcm9tIHRoZSBjb2RlCiAgdmFyIHJlVmVyc2lvbiA9IG5ldyBSZWdFeHAoJyJYLUNTUkZUb2tlbiIuKlthLXpdLnY9IihbYS1mMC05XXs0MH0pIjsnKTsKCiAgdmFyIG1pbmlmaWVkID0gbmV3IFJlZ0V4cCgnXlthLXpBLVokXVthLXpBLVokMC05XT8kJyk7CgogIGZvciAodmFyIHRvcExldmVsIGluIHdpbmRvdykgewogICAgaWYgKG1pbmlmaWVkLnRlc3QodG9wTGV2ZWwpKSB7CiAgICAgIC8vIGEgbWluaWZpZWQgb2JqZWN0IC0gY2hlY2sgZm9yIG1pbmlmaWVkIHByb3RvdHlwZSBlbnRyaWVzCgogICAgICB2YXIgdG9wT2JqZWN0ID0gd2luZG93W3RvcExldmVsXTsKICAgICAgaWYgKHRvcE9iamVjdCAmJiB0b3BPYmplY3QucHJvdG90eXBlKSB7CgogICAgICAgIC8vIHRoZSBvYmplY3QgaGFzIGEgcHJvdG90eXBlIC0gaXRlcmF0ZSB0aHJvdWdoIHRoZSBwcm9wZXJ0aWVzIG9mIHRoYXQKICAgICAgICBmb3IgKHZhciBzZWNMZXZlbCBpbiB0b3BPYmplY3QucHJvdG90eXBlKSB7CiAgICAgICAgICBpZiAobWluaWZpZWQudGVzdChzZWNMZXZlbCkpIHsKICAgICAgICAgICAgLy8gbG9va3MgbGlrZSB3ZSd2ZSBmb3VuZCBhbiBvYmplY3Qgb2YgdGhlIGZvcm1hdCAiWFgucHJvdG90eXBlLllZIi4uLgogICAgICAgICAgICB2YXIgaXRlbSA9IHRvcE9iamVjdC5wcm90b3R5cGVbc2VjTGV2ZWxdOwoKICAgICAgICAgICAgaWYgKGl0ZW0gJiYgdHlwZW9mKGl0ZW0pID09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAvLyBhIGZ1bmN0aW9uIC0gdGVzdCBpdCBhZ2FpbnN0IHRoZSByZWxldmFudCByZWd1bGFyIGV4cHJlc3Npb25zCiAgICAgICAgICAgICAgdmFyIGZ1bmNTdHIgPSBpdGVtLnRvU3RyaW5nKCk7CgogICAgICAgICAgICAgIHZhciBtYXRjaCA9IHJlVmVyc2lvbi5leGVjKGZ1bmNTdHIpOwogICAgICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIGZvcm1lciBDVVJSRU5UX1ZFUlNJT04gaW4gJyt0b3BMZXZlbCsnLnByb3RvdHlwZS4nK3NlY0xldmVsKTsKICAgICAgICAgICAgICAgIG5pYW50aWNfcGFyYW1zLkNVUlJFTlRfVkVSU0lPTiA9IG1hdGNoWzFdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgIH0gLy9lbmQgJ2lmIC5wcm90b3R5cGUnCgogICAgICBpZiAodG9wT2JqZWN0ICYmIEFycmF5LmlzQXJyYXkgJiYgQXJyYXkuaXNBcnJheSh0b3BPYmplY3QpKSB7CiAgICAgICAgLy8gZmluZCBhbGwgbm9uLXplcm8gbGVuZ3RoIGFycmF5cyBjb250YWluaW5nIGp1c3QgbnVtYmVycwogICAgICAgIGlmICh0b3BPYmplY3QubGVuZ3RoPjApIHsKICAgICAgICAgIHZhciBqdXN0SW50cyA9IHRydWU7CiAgICAgICAgICBmb3IgKHZhciBpPTA7IGk8dG9wT2JqZWN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YodG9wT2JqZWN0W2ldKSAhPT0gJ251bWJlcicgfHwgdG9wT2JqZWN0W2ldICE9IHBhcnNlSW50KHRvcE9iamVjdFtpXSkpIHsKICAgICAgICAgICAgICBqdXN0SW50cyA9IGZhbHNlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoanVzdEludHMpIHsKCiAgICAgICAgICAgIC8vIGN1cnJlbnQgbGVuZ3RocyBhcmU6IDE3OiBaT09NX1RPX0xFVkVMLCAxNDogVElMRVNfUEVSX0VER0UKICAgICAgICAgICAgLy8gaG93ZXZlciwgc2xpZ2h0bHkgbG9uZ2VyIG9yIHNob3J0ZXIgYXJlIGEgcG9zc2liaWxpdHkgaW4gdGhlIGZ1dHVyZQoKICAgICAgICAgICAgaWYgKHRvcE9iamVjdC5sZW5ndGggPj0gMTIgJiYgdG9wT2JqZWN0Lmxlbmd0aCA8PSAxOCkgewogICAgICAgICAgICAgIC8vIGEgcmVhc29uYWJsZSBhcnJheSBsZW5ndGggZm9yIHRpbGUgcGFyYW1ldGVycwogICAgICAgICAgICAgIC8vIG5lZWQgdG8gZmluZCB0d28gdHlwZXM6CiAgICAgICAgICAgICAgLy8gYS4gcG9ydGFsIGxldmVsIGxpbWl0cy4gZGVjcmVhc2luZyBudW1iZXJzLCBzdGFydGluZyBhdCA4CiAgICAgICAgICAgICAgLy8gYi4gdGlsZXMgcGVyIGVkZ2UuIGluY3JlYXNpbmcgbnVtYmVycy4gY3VycmVudCBtYXggaXMgMzYwMDAsIDkwMDAgd2FzIHRoZSBwcmV2aW91cyB2YWx1ZSAtIDE4MDAwIGlzIGEgbGlrZWx5IHBvc3NpYmlsaXR5IHRvbwoKICAgICAgICAgICAgICBpZiAodG9wT2JqZWN0WzBdID09IDgpIHsKICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciB0aWxlIGxldmVscwogICAgICAgICAgICAgICAgdmFyIGRlY3JlYXNpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaT0xOyBpPHRvcE9iamVjdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICBpZiAodG9wT2JqZWN0W2ktMV0gPCB0b3BPYmplY3RbaV0pIHsKICAgICAgICAgICAgICAgICAgICBkZWNyZWFzaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChkZWNyZWFzaW5nKSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nICgnaW50IGFycmF5ICcrdG9wTGV2ZWwrJyBsb29rcyBsaWtlIFpPT01fVE9fTEVWRUw6ICcrSlNPTi5zdHJpbmdpZnkodG9wT2JqZWN0KSk7CiAgICAgICAgICAgICAgICAgIHdpbmRvdy5uaWFudGljX3BhcmFtcy5aT09NX1RPX0xFVkVMID0gdG9wT2JqZWN0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gLy8gZW5kIGlmICh0b3BPYmplY3RbMF0gPT0gOCkKCiAgICAgICAgICAgICAgLy8gMjAxNS0wNi0yNSAtIGNoYW5nZWQgdG8gdG9wIHZhbHVlIG9mIDY0MDAwLCB0aGVuIHRvIDMyMDAwIC0gYWxsb3cgZm9yIHRoZW0gdG8gcmVzdG9yZSBpdCBqdXN0IGluIGNhc2UKICAgICAgICAgICAgICBpZiAodG9wT2JqZWN0W3RvcE9iamVjdC5sZW5ndGgtMV0gPj0gOTAwMCAmJiB0b3BPYmplY3RbdG9wT2JqZWN0Lmxlbmd0aC0xXSA8PSA2NDAwMCkgewogICAgICAgICAgICAgICAgdmFyIGluY3JlYXNpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaT0xOyBpPHRvcE9iamVjdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICBpZiAodG9wT2JqZWN0W2ktMV0gPiB0b3BPYmplY3RbaV0pIHsKICAgICAgICAgICAgICAgICAgICBpbmNyZWFzaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpbmNyZWFzaW5nKSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nICgnaW50IGFycmF5ICcrdG9wTGV2ZWwrJyBsb29rcyBsaWtlIFRJTEVTX1BFUl9FREdFOiAnK0pTT04uc3RyaW5naWZ5KHRvcE9iamVjdCkpOwogICAgICAgICAgICAgICAgICB3aW5kb3cubmlhbnRpY19wYXJhbXMuVElMRVNfUEVSX0VER0UgPSB0b3BPYmplY3Q7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIH0gLy9lbmQgaWYgKHRvcE9iamVjdFt0b3BPYmplY3QubGVuZ3RoLTFdID09IDkwMDApIHsKCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCgogICAgfQogIH0KCgogIGlmIChuaWFudGljX3BhcmFtcy5DVVJSRU5UX1ZFUlNJT04gPT09IHVuZGVmaW5lZCkgewogICAgZGlhbG9nKHsKICAgICAgdGl0bGU6ICdJSVRDIEJyb2tlbicsCiAgICAgIGh0bWw6ICc8cD5JSVRDIGZhaWxlZCB0byBleHRyYWN0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXJzIGZyb20gdGhlIGludGVsIHNpdGU8L3A+JwogICAgICAgICAgICsnPHA+VGhpcyBjYW4gaGFwcGVuIGFmdGVyIE5pYW50aWMgdXBkYXRlIHRoZSBzdGFuZGFyZCBpbnRlbCBzaXRlLiBBIGZpeCB3aWxsIGJlIG5lZWRlZCBmcm9tIHRoZSBJSVRDIGRldmVsb3BlcnMuPC9wPicsCiAgICB9KTsKCiAgICBjb25zb2xlLmxvZygnRGlzY292ZXJlZCBwYXJhbWV0ZXJzJyk7CiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh3aW5kb3cubmlhbnRpY19wYXJhbXMsbnVsbCwyKSk7CgogICAgdGhyb3coJ0Vycm9yOiBJSVRDIGZhaWxlZCB0byBleHRyYWN0IENVUlJFTlRfVkVSU0lPTiBzdHJpbmcgLSBjYW5ub3QgY29udGludWUnKTsKICB9Cgp9CgoKCjsKCgovLyBHQU1FIFNUQVRVUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIE1pbmRVbml0IGRpc3BsYXkKCgp3aW5kb3cudXBkYXRlR2FtZVNjb3JlID0gZnVuY3Rpb24oZGF0YSkgewogIGlmKCFkYXRhKSB7CiAgICAvLyBtb3ZlIHRoZSBwb3N0QWpheCBjYWxsIG9udG8gYSB2ZXJ5IHNob3J0IHRpbWVyLiB0aGlzIHdheSwgaWYgaXQgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgaXQgd29uJ3QgcHJldmVudCBJSVRDIGJvb3RpbmcKICAgIHNldFRpbWVvdXQgKGZ1bmN0aW9uKCkgeyB3aW5kb3cucG9zdEFqYXgoJ2dldEdhbWVTY29yZScsIHt9LCB3aW5kb3cudXBkYXRlR2FtZVNjb3JlKTsgfSwgMSk7CiAgICByZXR1cm47CiAgfQoKICBpZiAoZGF0YSAmJiBkYXRhLnJlc3VsdCkgewoKICAgIHZhciBlID0gcGFyc2VJbnQoZGF0YS5yZXN1bHRbMF0pOyAvL2VubGlnaHRlbmVkIHNjb3JlIGluIHJlc3VsdFswXQogICAgdmFyIHIgPSBwYXJzZUludChkYXRhLnJlc3VsdFsxXSk7IC8vcmVzaXN0YW5jZSBzY29yZSBpbiByZXN1bHRbMV0KICAgIHZhciBzID0gcitlOwogICAgdmFyIHJwID0gci9zKjEwMCwgZXAgPSBlL3MqMTAwOwogICAgciA9IGRpZ2l0cyhyKSwgZSA9IGRpZ2l0cyhlKTsKICAgIHZhciBycyA9ICc8c3BhbiBjbGFzcz0icmVzIiBzdHlsZT0id2lkdGg6JytycCsnJTsiPicrTWF0aC5yb3VuZChycCkrJyUmbmJzcDs8L3NwYW4+JzsKICAgIHZhciBlcyA9ICc8c3BhbiBjbGFzcz0iZW5sIiBzdHlsZT0id2lkdGg6JytlcCsnJTsiPiZuYnNwOycrTWF0aC5yb3VuZChlcCkrJyU8L3NwYW4+JzsKICAgICQoJyNnYW1lc3RhdCcpLmh0bWwocnMrZXMpLm9uZSgnY2xpY2snLCBmdW5jdGlvbigpIHsgd2luZG93LnVwZGF0ZUdhbWVTY29yZSgpIH0pOwogICAgLy8gaGVscCBjdXJzb3IgdmlhIOKAnCNnYW1lc3RhdCBzcGFu4oCdCiAgICAkKCcjZ2FtZXN0YXQnKS5hdHRyKCd0aXRsZScsICdSZXNpc3RhbmNlOlx0JytyKycgTWluZFVuaXRzXG5FbmxpZ2h0ZW5lZDpcdCcrZSsnIE1pbmRVbml0cycpOwogIH0gZWxzZSBpZiAoZGF0YSAmJiBkYXRhLmVycm9yKSB7CiAgICBjb25zb2xlLndhcm4oJ2dhbWUgc2NvcmUgZmFpbGVkIHRvIGxvYWQ6ICcrZGF0YS5lcnJvcik7CiAgfSBlbHNlIHsKICAgIGNvbnNvbGUud2FybignZ2FtZSBzY29yZSBmYWlsZWQgdG8gbG9hZCAtIHVua25vd24gcmVhc29uJyk7CiAgfQoKICAvLyBUT0RPOiBpZGxlIGhhbmRsaW5nIC0gZG9uJ3QgcmVmcmVzaCB3aGVuIElJVEMgaXMgaWRsZSEKICB3aW5kb3cuc2V0VGltZW91dCgnd2luZG93LnVwZGF0ZUdhbWVTY29yZScsIFJFRlJFU0hfR0FNRV9TQ09SRSoxMDAwKTsKfQoKCjsKCi8vIFBMVUdJTiBIT09LUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBQbHVnaW5zIG1heSBsaXN0ZW4gdG8gYW55IG51bWJlciBvZiBldmVudHMgYnkgc3BlY2lmeWluZyB0aGUgbmFtZSBvZgovLyB0aGUgZXZlbnQgdG8gbGlzdGVuIHRvIGFuZCBoYW5kaW5nIGEgZnVuY3Rpb24gdGhhdCBzaG91bGQgYmUgZXhlLQovLyBjdXRlZCB3aGVuIGFuIGV2ZW50IG9jY3Vycy4gQ2FsbGJhY2tzIHdpbGwgcmVjZWl2ZSBhZGRpdGlvbmFsIGRhdGEKLy8gdGhlIGV2ZW50IGNyZWF0ZWQgYXMgdGhlaXIgZmlyc3QgcGFyYW1ldGVyLiBUaGUgdmFsdWUgaXMgYWx3YXlzIGEKLy8gaGFzaCB0aGF0IGNvbnRhaW5zIG1vcmUgZGV0YWlscy4KLy8KLy8gRm9yIGV4YW1wbGUsIHRoaXMgbGluZSB3aWxsIGxpc3RlbiBmb3IgcG9ydGFscyB0byBiZSBhZGRlZCBhbmQgcHJpbnQKLy8gdGhlIGRhdGEgZ2VuZXJhdGVkIGJ5IHRoZSBldmVudCB0byB0aGUgY29uc29sZToKLy8gd2luZG93LmFkZEhvb2soJ3BvcnRhbEFkZGVkJywgZnVuY3Rpb24oZGF0YSkgeyBjb25zb2xlLmxvZyhkYXRhKSB9KTsKLy8KLy8gQm9vdCBob29rOiBib290aW5nIGlzIGhhbmRsZWQgZGlmZmVyZW50bHkgYmVjYXVzZSBJSVRDIG1heSBub3QgeWV0Ci8vICAgICAgICAgICAgYmUgYXZhaWxhYmxlLiBIYXZlIGEgbG9vayBhdCB0aGUgcGx1Z2lucyBpbiBwbHVnaW5zLy4gQWxsCi8vICAgICAgICAgICAgY29kZSBiZWZvcmUg4oCcLy8gUExVR0lOIFNUQVJU4oCdIGFuZCBhZnRlciDigJwvLyBQTFVHSU4gRU5E4oCdIGlzCi8vICAgICAgICAgICAgcmVxdWlyZWQgdG8gc3VjY2Vzc2Z1bGx5IGJvb3QgdGhlIHBsdWdpbi4KLy8KLy8gSGVyZeKAmXMgbW9yZSBzcGVjaWZpYyBpbmZvcm1hdGlvbiBhYm91dCBlYWNoIGV2ZW50OgovLyBwb3J0YWxTZWxlY3RlZDogY2FsbGVkIHdoZW4gcG9ydGFsIG9uIG1hcCBpcyBzZWxlY3RlZC91bnNlbGVjdGVkLgovLyAgICAgICAgICAgICAgUHJvdmlkZSBndWlkIG9mIHNlbGVjdGVkIGFuZCB1bnNlbGVjdGVkIHBvcnRhbC4KLy8gbWFwRGF0YVJlZnJlc2hTdGFydDogY2FsbGVkIHdoZW4gd2Ugc3RhcnQgcmVmcmVzaGluZyBtYXAgZGF0YQovLyBtYXBEYXRhRW50aXR5SW5qZWN0OiBjYWxsZWQganVzdCBhcyB3ZSBzdGFydCB0byByZW5kZXIgZGF0YS4gaGFzIGNhbGxiYWNrIHRvIGluamVjdCBjYWNoZWQgZW50aXRpZXMgaW50byB0aGUgbWFwIHJlbmRlcgovLyBtYXBEYXRhUmVmcmVzaEVuZDogY2FsbGVkIHdoZW4gd2UgY29tcGxldGUgdGhlIG1hcCBkYXRhIGxvYWQKLy8gcG9ydGFsQWRkZWQ6IGNhbGxlZCB3aGVuIGEgcG9ydGFsIGhhcyBiZWVuIHJlY2VpdmVkIGFuZCBpcyBhYm91dCB0bwovLyAgICAgICAgICAgICAgYmUgYWRkZWQgdG8gaXRzIGxheWVyIGdyb3VwLiBOb3RlIHRoYXQgdGhpcyBkb2VzIE5PVAovLyAgICAgICAgICAgICAgbWVhbiBpdCBpcyBhbHJlYWR5IHZpc2libGUgb3Igd2lsbCBiZSwgc2hvcnRseSBhZnRlci4KLy8gICAgICAgICAgICAgIElmIGEgcG9ydGFsIGlzIGFkZGVkIHRvIGEgaGlkZGVuIGxheWVyIGl0IG1heSBuZXZlciBiZQovLyAgICAgICAgICAgICAgc2hvd24gYXQgYWxsLiBJbmplY3Rpb24gcG9pbnQgaXMgaW4KLy8gICAgICAgICAgICAgIGNvZGUvbWFwX2RhdGEuanMjcmVuZGVyUG9ydGFsIG5lYXIgdGhlIGVuZC4gV2lsbCBoYW5kCi8vICAgICAgICAgICAgICB0aGUgTGVhZmxldCBDaXJjbGVNYXJrZXIgZm9yIHRoZSBwb3J0YWwgaW4gInBvcnRhbCIgdmFyLgovLyBsaW5rQWRkZWQ6ICAgY2FsbGVkIHdoZW4gYSBsaW5rIGlzIGFib3V0IHRvIGJlIGFkZGVkIHRvIHRoZSBtYXAKLy8gZmllbGRBZGRlZDogIGNhbGxlZCB3aGVuIGEgZmllbGQgaXMgYWJvdXQgdG8gYmUgYWRkZWQgdG8gdGhlIG1hcAovLyBwb3J0YWxEZXRhaWxzVXBkYXRlZDogZmlyZWQgYWZ0ZXIgdGhlIGRldGFpbHMgaW4gdGhlIHNpZGViYXIgaGF2ZQovLyAgICAgICAgICAgICAgYmVlbiAocmUtKXJlbmRlcmVkIFByb3ZpZGVzIGRhdGEgYWJvdXQgdGhlIHBvcnRhbCB0aGF0Ci8vICAgICAgICAgICAgICBoYXMgYmVlbiBzZWxlY3RlZC4KLy8gcHVibGljQ2hhdERhdGFBdmFpbGFibGU6IHRoaXMgaG9vayBydW5zIGFmdGVyIGRhdGEgZm9yIGFueSBvZiB0aGUKLy8gICAgICAgICAgICAgIHB1YmxpYyBjaGF0cyBoYXMgYmVlbiByZWNlaXZlZCBhbmQgcHJvY2Vzc2VkLCBidXQgbm90Ci8vICAgICAgICAgICAgICB5ZXQgYmVlbiBkaXNwbGF5ZWQuIFRoZSBkYXRhIGhhc2ggY29udGFpbnMgYm90aCB0aGUgdW4tCi8vICAgICAgICAgICAgICBwcm9jZXNzZWQgcmF3IGFqYXggcmVzcG9uc2UgYXMgd2VsbCBhcyB0aGUgcHJvY2Vzc2VkCi8vICAgICAgICAgICAgICBjaGF0IGRhdGEgdGhhdCBpcyBnb2luZyB0byBiZSB1c2VkIGZvciBkaXNwbGF5LgovLyBmYWN0aW9uQ2hhdERhdGFBdmFpbGFibGU6IHRoaXMgaG9vayBydW5zIGFmdGVyIGRhdGEgZm9yIHRoZSBmYWN0aW9uCi8vICAgICAgICAgICAgICBjaGF0IGhhcyBiZWVuIHJlY2VpdmVkIGFuZCBwcm9jZXNzZWQsIGJ1dCBub3QgeWV0IGJlZW4KLy8gICAgICAgICAgICAgIGRpc3BsYXllZC4gVGhlIGRhdGEgaGFzaCBjb250YWlucyBib3RoIHRoZSB1bnByb2Nlc3NlZAovLyAgICAgICAgICAgICAgcmF3IGFqYXggcmVzcG9uc2UgYXMgd2VsbCBhcyB0aGUgcHJvY2Vzc2VkIGNoYXQgZGF0YQovLyAgICAgICAgICAgICAgdGhhdCBpcyBnb2luZyB0byBiZSB1c2VkIGZvciBkaXNwbGF5LgovLyByZXF1ZXN0RmluaXNoZWQ6IERFUFJFQ0FURUQ6IGJlc3QgdG8gdXNlIG1hcERhdGFSZWZyZXNoRW5kIGluc3RlYWQKLy8gICAgICAgICAgICAgIGNhbGxlZCBhZnRlciBlYWNoIG1hcCBkYXRhIHJlcXVlc3QgZmluaXNoZWQuIEFyZ3VtZW50IGlzCi8vICAgICAgICAgICAgICB7c3VjY2VzczogYm9vbGVhbn0gaW5kaWNhdGVkIHRoZSByZXF1ZXN0IHN1Y2Nlc3Mgb3IgZmFpbC4KLy8gaWl0Y0xvYWRlZDogY2FsbGVkIGFmdGVyIElJVEMgYW5kIGFsbCBwbHVnaW5zIGxvYWRlZAovLyBwb3J0YWxEZXRhaWxMb2FkZWQ6IGNhbGxlZCB3aGVuIGEgcmVxdWVzdCB0byBsb2FkIGZ1bGwgcG9ydGFsIGRldGFpbAovLyAgICAgICAgICAgICAgY29tcGxldGVzLiBndWlkLCBzdWNjZXNzLCBkZXRhaWxzIHBhcmFtZXRlcnMKLy8gcGFuZUNoYW5nZWQgIGNhbGxlZCB3aGVuIHRoZSBjdXJyZW50IHBhbmUgaGFzIGNoYW5nZWQuIE9uIGRlc2t0b3AsCi8vICAgICAgICAgICAgICB0aGlzIG9ubHkgc2VsZWN0cyB0aGUgY3VycmVudCBjaGF0IHBhbmU7IG9uIG1vYmlsZSwgaXQKLy8gICAgICAgICAgICAgIGFsc28gc3dpdGNoZXMgYmV0d2VlbiBtYXAsIGluZm8gYW5kIG90aGVyIHBhbmVzIGRlZmluZWQKLy8gICAgICAgICAgICAgIGJ5IHBsdWdpbnMKCndpbmRvdy5faG9va3MgPSB7fQp3aW5kb3cuVkFMSURfSE9PS1MgPSBbCiAgJ3BvcnRhbFNlbGVjdGVkJywgJ3BvcnRhbERldGFpbHNVcGRhdGVkJywKICAnbWFwRGF0YVJlZnJlc2hTdGFydCcsICdtYXBEYXRhRW50aXR5SW5qZWN0JywgJ21hcERhdGFSZWZyZXNoRW5kJywKICAncG9ydGFsQWRkZWQnLCAnbGlua0FkZGVkJywgJ2ZpZWxkQWRkZWQnLAogICdwdWJsaWNDaGF0RGF0YUF2YWlsYWJsZScsICdmYWN0aW9uQ2hhdERhdGFBdmFpbGFibGUnLAogICdyZXF1ZXN0RmluaXNoZWQnLCAnbmlja25hbWVDbGlja2VkJywKICAnZ2VvU2VhcmNoJywgJ3NlYXJjaCcsICdpaXRjTG9hZGVkJywKICAncG9ydGFsRGV0YWlsTG9hZGVkJywgJ3BhbmVDaGFuZ2VkJ107Cgp3aW5kb3cucnVuSG9va3MgPSBmdW5jdGlvbihldmVudCwgZGF0YSkgewogIGlmKFZBTElEX0hPT0tTLmluZGV4T2YoZXZlbnQpID09PSAtMSkgdGhyb3coJ1Vua25vd24gZXZlbnQgdHlwZTogJyArIGV2ZW50KTsKCiAgaWYoIV9ob29rc1tldmVudF0pIHJldHVybiB0cnVlOwogIHZhciBpbnRlcnJ1cHRlZCA9IGZhbHNlOwogICQuZWFjaChfaG9va3NbZXZlbnRdLCBmdW5jdGlvbihpbmQsIGNhbGxiYWNrKSB7CiAgICB0cnkgewogICAgICBpZiAoY2FsbGJhY2soZGF0YSkgPT09IGZhbHNlKSB7CiAgICAgICAgaW50ZXJydXB0ZWQgPSB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsgIC8vYnJlYWsgZnJvbSAkLmVhY2gKICAgICAgfQogICAgfSBjYXRjaChlcnIpIHsKICAgICAgY29uc29sZS5lcnJvcignZXJyb3IgcnVubmluZyBob29rICcrZXZlbnQrJywgZXJyb3I6ICcrZXJyKTsKICAgICAgZGVidWdnZXI7CiAgICB9CiAgfSk7CiAgcmV0dXJuICFpbnRlcnJ1cHRlZDsKfQoKLy8gaGVscGVyIG1ldGhvZCB0byBhbGxvdyBwbHVnaW5zIHRvIGNyZWF0ZSBuZXcgaG9va3MKd2luZG93LnBsdWdpbkNyZWF0ZUhvb2sgPSBmdW5jdGlvbihldmVudCkgewogIGlmKCQuaW5BcnJheShldmVudCwgd2luZG93LlZBTElEX0hPT0tTKSA8IDApIHsKICAgIHdpbmRvdy5WQUxJRF9IT09LUy5wdXNoKGV2ZW50KTsKICB9Cn0KCgp3aW5kb3cuYWRkSG9vayA9IGZ1bmN0aW9uKGV2ZW50LCBjYWxsYmFjaykgewogIGlmKFZBTElEX0hPT0tTLmluZGV4T2YoZXZlbnQpID09PSAtMSkgewogICAgY29uc29sZS5lcnJvcignYWRkSG9vazogVW5rbm93biBldmVudCB0eXBlOiAnICsgZXZlbnQgKyAnIC0gaWdub3JpbmcnKTsKICAgIGRlYnVnZ2VyOwogICAgcmV0dXJuOwogIH0KCiAgaWYodHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSB0aHJvdygnQ2FsbGJhY2sgbXVzdCBiZSBhIGZ1bmN0aW9uLicpOwoKICBpZighX2hvb2tzW2V2ZW50XSkKICAgIF9ob29rc1tldmVudF0gPSBbY2FsbGJhY2tdOwogIGVsc2UKICAgIF9ob29rc1tldmVudF0ucHVzaChjYWxsYmFjayk7Cn0KCgo7CgovLyBJRExFIEhBTkRMSU5HIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgp3aW5kb3cuaWRsZVRpbWUgPSAwOyAvLyBpbiBzZWNvbmRzCndpbmRvdy5faWRsZVRpbWVMaW1pdCA9IE1BWF9JRExFX1RJTUU7Cgp2YXIgSURMRV9QT0xMX1RJTUUgPSAxMDsKCnZhciBpZGxlUG9sbCA9IGZ1bmN0aW9uKCkgewogIHZhciB3YXNJZGxlID0gaXNJZGxlKCk7CiAgd2luZG93LmlkbGVUaW1lICs9IElETEVfUE9MTF9USU1FOwoKICB2YXIgaGlkZGVuID0gKGRvY3VtZW50LmhpZGRlbiB8fCBkb2N1bWVudC53ZWJraXRIaWRkZW4gfHwgZG9jdW1lbnQubW96SGlkZGVuIHx8IGRvY3VtZW50Lm1zSGlkZGVuIHx8IGZhbHNlKTsKICBpZiAoaGlkZGVuKSB7CiAgICB3aW5kb3cuX2lkbGVUaW1lTGltaXQgPSB3aW5kb3cuUkVGUkVTSDsgLy8gc2V0IGEgc21hbGwgdGltZSBsaW1pdCBiZWZvcmUgZW50ZXJpbmcgaWRsZSBtb2RlCiAgfQogIGlmICghd2FzSWRsZSAmJiBpc0lkbGUoKSkgewogICAgY29uc29sZS5sb2coJ2lkbGVQb2xsOiBlbnRlcmluZyBpZGxlIG1vZGUnKTsKICB9Cn0KCnNldEludGVydmFsKGlkbGVQb2xsLCBJRExFX1BPTExfVElNRSoxMDAwKTsKCndpbmRvdy5pZGxlUmVzZXQgPSBmdW5jdGlvbiAoKSB7CiAgLy8gdXBkYXRlIGltbWVkaWF0ZWx5IHdoZW4gdGhlIHVzZXIgY29tZXMgYmFjawogIGlmKGlzSWRsZSgpKSB7CiAgICBjb25zb2xlLmxvZyAoJ2lkbGVSZXNldDogbGVhdmluZyBpZGxlIG1vZGUnKTsKICAgIHdpbmRvdy5pZGxlVGltZSA9IDA7CiAgICAkLmVhY2god2luZG93Ll9vblJlc3VtZUZ1bmN0aW9ucywgZnVuY3Rpb24oaW5kLCBmKSB7CiAgICAgIGYoKTsKICAgIH0pOwogIH0KICB3aW5kb3cuaWRsZVRpbWUgPSAwOwogIHdpbmRvdy5faWRsZVRpbWVMaW1pdCA9IE1BWF9JRExFX1RJTUU7Cn07Cgp3aW5kb3cuaWRsZVNldCA9IGZ1bmN0aW9uKCkgewogIHZhciB3YXNJZGxlID0gaXNJZGxlKCk7CgogIHdpbmRvdy5faWRsZVRpbWVMaW1pdCA9IDA7IC8vIGEgemVybyB0aW1lIGhlcmUgd2lsbCBjYXVzZSBpZGxlIHRvIHN0YXJ0IGltbWVkaWF0ZWx5CgogIGlmICghd2FzSWRsZSAmJiBpc0lkbGUoKSkgewogICAgY29uc29sZS5sb2cgKCdpZGxlU2V0OiBlbnRlcmluZyBpZGxlIG1vZGUnKTsKICB9Cn0KCgovLyBvbmx5IHJlc2V0IGlkbGUgb24gbW91c2UgbW92ZSB3aGVyZSB0aGUgY29vcmRpbmF0ZXMgYXJlIGFjdHVhbGx5IGRpZmZlcmVudC4KLy8gc29tZSBicm93c2VycyBzZW5kIHRoZSBldmVudCB3aGVuIG5vdCBtb3ZpbmchCnZhciBfbGFzdE1vdXNlWD0tMSwgX2xhc3RNb3VzZVk9LTE7CnZhciBpZGxlTW91c2VNb3ZlID0gZnVuY3Rpb24oZSkgewogIHZhciBkWCA9IF9sYXN0TW91c2VYLWUuY2xpZW50WDsKICB2YXIgZFkgPSBfbGFzdE1vdXNlWS1lLmNsaWVudFk7CiAgdmFyIGRlbHRhU3F1YXJlZCA9IGRYKmRYICsgZFkqZFk7CiAgLy8gb25seSB0cmVhdCBtb3ZlbWVudHMgb3ZlciAzIHBpeGVscyBhcyBlbm91Z2ggdG8gcmVzZXQgdXMKICBpZiAoZGVsdGFTcXVhcmVkID4gMyozKSB7CiAgICBfbGFzdE1vdXNlWCA9IGUuY2xpZW50WDsKICAgIF9sYXN0TW91c2VZID0gZS5jbGllbnRZOwogICAgaWRsZVJlc2V0KCk7CiAgfQp9Cgp3aW5kb3cuc2V0dXBJZGxlID0gZnVuY3Rpb24oKSB7CiAgJCgnYm9keScpLmtleXByZXNzKGlkbGVSZXNldCk7CiAgJCgnYm9keScpLm1vdXNlbW92ZShpZGxlTW91c2VNb3ZlKTsKfQoKCndpbmRvdy5pc0lkbGUgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gd2luZG93LmlkbGVUaW1lID49IHdpbmRvdy5faWRsZVRpbWVMaW1pdDsKfQoKd2luZG93Ll9vblJlc3VtZUZ1bmN0aW9ucyA9IFtdOwoKLy8gYWRkIHlvdXIgZnVuY3Rpb24gaGVyZSBpZiB5b3Ugd2FudCB0byBiZSBub3RpZmllZCB3aGVuIHRoZSB1c2VyCi8vIHJlc3VtZXMgZnJvbSBiZWluZyBpZGxlCndpbmRvdy5hZGRSZXN1bWVGdW5jdGlvbiA9IGZ1bmN0aW9uKGYpIHsKICB3aW5kb3cuX29uUmVzdW1lRnVuY3Rpb25zLnB1c2goZik7Cn0KCgo7CgoKLy8gTE9DQVRJT04gSEFORExJTkcgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBpLmUuIHNldHRpbmcgaW5pdGlhbCBwb3NpdGlvbiBhbmQgc3RvcmluZyBuZXcgcG9zaXRpb24gYWZ0ZXIgbW92aW5nCgovLyByZXRyaWV2ZXMgY3VycmVudCBwb3NpdGlvbiBmcm9tIG1hcCBhbmQgc3RvcmVzIGl0IGNvb2tpZXMKd2luZG93LnN0b3JlTWFwUG9zaXRpb24gPSBmdW5jdGlvbigpIHsKICB2YXIgbSA9IHdpbmRvdy5tYXAuZ2V0Q2VudGVyKCk7CgogIGlmKG1bJ2xhdCddID49IC05MCAgJiYgbVsnbGF0J10gPD0gOTApCiAgICB3cml0ZUNvb2tpZSgnaW5ncmVzcy5pbnRlbG1hcC5sYXQnLCBtWydsYXQnXSk7CgogIGlmKG1bJ2xuZyddID49IC0xODAgJiYgbVsnbG5nJ10gPD0gMTgwKQogICAgd3JpdGVDb29raWUoJ2luZ3Jlc3MuaW50ZWxtYXAubG5nJywgbVsnbG5nJ10pOwoKICB3cml0ZUNvb2tpZSgnaW5ncmVzcy5pbnRlbG1hcC56b29tJywgd2luZG93Lm1hcC5nZXRab29tKCkpOwp9CgoKLy8gZWl0aGVyIHJldHJpZXZlcyB0aGUgbGFzdCBzaG93biBwb3NpdGlvbiBmcm9tIGEgY29va2llLCBmcm9tIHRoZQovLyBVUkwgb3IgaWYgbmVpdGhlciBpcyBwcmVzZW50LCB2aWEgR2VvbG9jYXRpb24uIElmIHRoYXQgZmFpbHMsIGl0Ci8vIHJldHVybnMgYSBtYXAgdGhhdCBzaG93cyB0aGUgd2hvbGUgd29ybGQuCndpbmRvdy5nZXRQb3NpdGlvbiA9IGZ1bmN0aW9uKCkgewogIGlmKGdldFVSTFBhcmFtKCdsYXRFNicpICYmIGdldFVSTFBhcmFtKCdsbmdFNicpKSB7CiAgICBjb25zb2xlLmxvZygibWFwcG9zOiByZWFkaW5nIGVtYWlsIFVSTCBwYXJhbXMiKTsKICAgIHZhciBsYXQgPSBwYXJzZUludChnZXRVUkxQYXJhbSgnbGF0RTYnKSkvMUU2IHx8IDAuMDsKICAgIHZhciBsbmcgPSBwYXJzZUludChnZXRVUkxQYXJhbSgnbG5nRTYnKSkvMUU2IHx8IDAuMDsKICAgIHZhciB6ID0gcGFyc2VJbnQoZ2V0VVJMUGFyYW0oJ3onKSkgfHwgMTc7CiAgICByZXR1cm4ge2NlbnRlcjogbmV3IEwuTGF0TG5nKGxhdCwgbG5nKSwgem9vbTogen07CiAgfQoKICBpZihnZXRVUkxQYXJhbSgnbGwnKSkgewogICAgY29uc29sZS5sb2coIm1hcHBvczogcmVhZGluZyBzdG9jayBJbnRlbCBVUkwgcGFyYW1zIik7CiAgICB2YXIgbGF0ID0gcGFyc2VGbG9hdChnZXRVUkxQYXJhbSgnbGwnKS5zcGxpdCgiLCIpWzBdKSB8fCAwLjA7CiAgICB2YXIgbG5nID0gcGFyc2VGbG9hdChnZXRVUkxQYXJhbSgnbGwnKS5zcGxpdCgiLCIpWzFdKSB8fCAwLjA7CiAgICB2YXIgeiA9IHBhcnNlSW50KGdldFVSTFBhcmFtKCd6JykpIHx8IDE3OwogICAgcmV0dXJuIHtjZW50ZXI6IG5ldyBMLkxhdExuZyhsYXQsIGxuZyksIHpvb206IHp9OwogIH0KCiAgaWYocmVhZENvb2tpZSgnaW5ncmVzcy5pbnRlbG1hcC5sYXQnKSAmJiByZWFkQ29va2llKCdpbmdyZXNzLmludGVsbWFwLmxuZycpKSB7CiAgICBjb25zb2xlLmxvZygibWFwcG9zOiByZWFkaW5nIGNvb2tpZXMiKTsKICAgIHZhciBsYXQgPSBwYXJzZUZsb2F0KHJlYWRDb29raWUoJ2luZ3Jlc3MuaW50ZWxtYXAubGF0JykpIHx8IDAuMDsKICAgIHZhciBsbmcgPSBwYXJzZUZsb2F0KHJlYWRDb29raWUoJ2luZ3Jlc3MuaW50ZWxtYXAubG5nJykpIHx8IDAuMDsKICAgIHZhciB6ID0gcGFyc2VJbnQocmVhZENvb2tpZSgnaW5ncmVzcy5pbnRlbG1hcC56b29tJykpIHx8IDE3OwoKICAgIGlmKGxhdCA8IC05MCAgfHwgbGF0ID4gOTApIGxhdCA9IDAuMDsKICAgIGlmKGxuZyA8IC0xODAgfHwgbG5nID4gMTgwKSBsbmcgPSAwLjA7CgogICAgcmV0dXJuIHtjZW50ZXI6IG5ldyBMLkxhdExuZyhsYXQsIGxuZyksIHpvb206IHp9OwogIH0KCiAgc2V0VGltZW91dCgid2luZG93Lm1hcC5sb2NhdGUoe3NldFZpZXcgOiB0cnVlfSk7IiwgNTApOwoKICByZXR1cm4ge2NlbnRlcjogbmV3IEwuTGF0TG5nKDAuMCwgMC4wKSwgem9vbTogMX07Cn0KCgo7CgovLyBNQVAgREFUQSBSRVFVRVNUIENBTENVTEFUT1JTIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEluZ3Jlc3MgSW50ZWwgc3BsaXRzIHVwIHJlcXVlc3RzIGZvciBtYXAgZGF0YSAocG9ydGFscywgbGlua3MsCi8vIGZpZWxkcykgaW50byB0aWxlcy4gVG8gZ2V0IGRhdGEgZm9yIHRoZSBjdXJyZW50IHZpZXdwb3J0IChpLmUuIHdoYXQKLy8gaXMgY3VycmVudGx5IHZpc2libGUpIGl0IGZpcnN0IGNhbGN1bGF0ZXMgd2hpY2ggdGlsZXMgaW50ZXJzZWN0LgovLyBGb3IgYWxsIHRob3NlIHRpbGVzLCBpdCB0aGVuIGNhbGN1bGF0ZXMgdGhlIGxhdC9sbmcgYm91bmRzIG9mIHRoYXQKLy8gdGlsZSBhbmQgYSBxdWFka2V5LiBCb3RoIHRoZSBib3VuZHMgYW5kIHRoZSBxdWFka2V5IGFyZSDigJxzb21ld2hhdOKAnQovLyByZXF1aXJlZCB0byBnZXQgY29tcGxldGUgZGF0YS4KLy8KLy8gQ29udmVyc2lvbiBmdW5jdGlvbnMgY291cnRlc3kgb2YKLy8gaHR0cDovL3dpa2kub3BlbnN0cmVldG1hcC5vcmcvd2lraS9TbGlwcHlfbWFwX3RpbGVuYW1lcwoKCndpbmRvdy5zZXR1cERhdGFUaWxlUGFyYW1zID0gZnVuY3Rpb24oKSB7CiAgLy8gZGVmYXVsdCB2YWx1ZXMgLSB1c2VkIHRvIGZhbGwgYmFjayB0byBpZiB3ZSBjYW4ndCBkZXRlY3QgdGhvc2UgdXNlZCBpbiBzdG9jayBpbnRlbAogIHZhciBERUZBVUxUX1pPT01fVE9fVElMRVNfUEVSX0VER0UgPSBbMSwxLDEsNDAsNDAsODAsODAsMzIwLDEwMDAsMjAwMCwyMDAwLDQwMDAsODAwMCwxNjAwMCwxNjAwMCwzMjAwMF07CiAgdmFyIERFRkFVTFRfWk9PTV9UT19MRVZFTCA9IFs4LDgsOCw4LDcsNyw3LDYsNiw1LDQsNCwzLDIsMiwxLDFdOwoKICAvLyBzdG9jayBpbnRlbCBkb2Vzbid0IGhhdmUgdGhpcyBhcnJheSAodGhleSB1c2UgYSBzd2l0Y2ggc3RhdGVtZW50IGluc3RlYWQpLCBidXQgdGhpcyBpcyBmYXIgbmVhdGVyCiAgdmFyIERFRkFVTFRfWk9PTV9UT19MSU5LX0xFTkdUSCA9IFsyMDAwMDAsMjAwMDAwLDIwMDAwMCwyMDAwMDAsMjAwMDAwLDYwMDAwLDYwMDAwLDEwMDAwLDUwMDAsMjUwMCwyNTAwLDgwMCwzMDAsMCwwXTsKCiAgd2luZG93LlRJTEVfUEFSQU1TID0ge307CgogIC8vIG5vdCBpbiBzdG9jayB0byBkZXRlY3QgLSB3ZSdsbCBoYXZlIHRvIGFzc3VtZSB0aGUgYWJvdmUgdmFsdWVzLi4uCiAgd2luZG93LlRJTEVfUEFSQU1TLlpPT01fVE9fTElOS19MRU5HVEggPSBERUZBVUxUX1pPT01fVE9fTElOS19MRU5HVEg7CgoKICBpZiAobmlhbnRpY19wYXJhbXMuWk9PTV9UT19MRVZFTCAmJiBuaWFudGljX3BhcmFtcy5USUxFU19QRVJfRURHRSkgewogICAgd2luZG93LlRJTEVfUEFSQU1TLlpPT01fVE9fTEVWRUwgPSBuaWFudGljX3BhcmFtcy5aT09NX1RPX0xFVkVMOwogICAgd2luZG93LlRJTEVfUEFSQU1TLlRJTEVTX1BFUl9FREdFID0gbmlhbnRpY19wYXJhbXMuVElMRVNfUEVSX0VER0U7CgoKICAgIC8vIGxhenkgbnVtZXJpY2FsIGFycmF5IGNvbXBhcmlzb24KICAgIGlmICggSlNPTi5zdHJpbmdpZnkobmlhbnRpY19wYXJhbXMuWk9PTV9UT19MRVZFTCkgIT0gSlNPTi5zdHJpbmdpZnkoREVGQVVMVF9aT09NX1RPX0xFVkVMKSkgewogICAgICBjb25zb2xlLndhcm4oJ1RpbGUgcGFyYW1ldGVyIFpPT01fVE9fTEVWRUwgaGF2ZSBjaGFuZ2VkIGluIHN0b2NrIGludGVsLiBEZXRlY3RlZCBjb3JyZWN0IHZhbHVlcywgYnV0IGNvZGUgc2hvdWxkIGJlIHVwZGF0ZWQnKTsKICAgICAgZGVidWdnZXI7CiAgICB9CiAgICBpZiAoIEpTT04uc3RyaW5naWZ5KG5pYW50aWNfcGFyYW1zLlRJTEVTX1BFUl9FREdFKSAhPSBKU09OLnN0cmluZ2lmeShERUZBVUxUX1pPT01fVE9fVElMRVNfUEVSX0VER0UpKSB7CiAgICAgIGNvbnNvbGUud2FybignVGlsZSBwYXJhbWV0ZXIgVElMRVNfUEVSX0VER0UgaGF2ZSBjaGFuZ2VkIGluIHN0b2NrIGludGVsLiBEZXRlY3RlZCBjb3JyZWN0IHZhbHVlcywgYnV0IGNvZGUgc2hvdWxkIGJlIHVwZGF0ZWQnKTsKICAgICAgZGVidWdnZXI7CiAgICB9CgogIH0gZWxzZSB7CiAgICBkaWFsb2coewogICAgICB0aXRsZTogJ0lJVEMgV2FybmluZycsCiAgICAgIGh0bWw6ICI8cD5JSVRDIGZhaWxlZCB0byBkZXRlY3QgdGhlIFpPT01fVE9fTEVWRUwgYW5kL29yIFRJTEVTX1BFUl9FREdFIHNldHRpbmdzIGZyb20gdGhlIHN0b2NrIGludGVsIHNpdGUuPC9wPiIKICAgICAgICAgICArIjxwPklJVEMgaXMgbm93IHVzaW5nIGZhbGxiYWNrIGRlZmF1bHQgdmFsdWVzLiBIb3dldmVyLCBpZiBkZXRlY3Rpb24gaGFzIGZhaWxlZCBpdCdzIGxpa2VseSB0aGUgdmFsdWVzIGhhdmUgY2hhbmdlZC4iCiAgICAgICAgICAgKyIgSUlUQyBtYXkgbm90IGxvYWQgdGhlIG1hcCBpZiB0aGVzZSBkZWZhdWx0IHZhbHVlcyBhcmUgd3JvbmcuPC9wPiIsCiAgICB9KTsKCiAgICB3aW5kb3cuVElMRV9QQVJBTVMuWk9PTV9UT19MRVZFTCA9IERFRkFVTFRfWk9PTV9UT19MRVZFTDsKICAgIHdpbmRvdy5USUxFX1BBUkFNUy5USUxFU19QRVJfRURHRSA9IERFRkFVTFRfWk9PTV9UT19USUxFU19QRVJfRURHRTsKICB9CgogIC8vIDIwMTUtMDctMDE6IG5pYW50aWMgYWRkZWQgY29kZSB0byB0aGUgc3RvY2sgc2l0ZSB0aGF0IG92ZXJyaWRlcyB0aGUgbWluIHpvb20gbGV2ZWwgZm9yIHVuY2xhaW1lZCBwb3J0YWxzIHRvIDE1IGFuZCBhYm92ZQogIC8vIGluc3RlYWQgb2YgdXBkYXRpbmcgdGhlIHpvb20tdG8tbGV2ZWwgYXJyYXkuIG1ha2VzIG5vIHNlbnNlIHJlYWxseS4uLi4KICAvLyB3ZSdsbCBqdXN0IGNob3Agb2ZmIHRoZSBhcnJheSBhdCB0aGF0IHBvaW50LCBzbyB0aGUgY29kZSBkZWZhdWx0cyB0byBsZXZlbCAwICh1bmNsYWltZWQpIGV2ZXJ5d2hlcmUuLi4KICB3aW5kb3cuVElMRV9QQVJBTVMuWk9PTV9UT19MRVZFTCA9IHdpbmRvdy5USUxFX1BBUkFNUy5aT09NX1RPX0xFVkVMLnNsaWNlKDAsMTUpOwoKfQoKCndpbmRvdy5kZWJ1Z01hcFpvb21QYXJhbWV0ZXJzID0gZnVuY3Rpb24oKSB7CgogIC8vZm9yIGRlYnVnIHB1cnBvc2VzLCBsb2cgdGhlIHRpbGUgcGFyYW1zIHVzZWQgZm9yIGVhY2ggem9vbSBsZXZlbAogIGNvbnNvbGUubG9nKCdERUJVRzogTWFwIFpvb20gUGFyYW1ldGVycycpOwogIHZhciBkb25lWm9vbXMgPSB7fTsKICBmb3IgKHZhciB6PU1JTl9aT09NOyB6PD0yMTsgeisrKSB7CiAgICB2YXIgb3VyWm9vbSA9IGdldERhdGFab29tRm9yTWFwWm9vbSh6KTsKICAgIGNvbnNvbGUubG9nKCdERUJVRzogbWFwIHpvb20gJyt6Kyc6IElJVEMgcmVxdWVzdHMgJytvdXJab29tKyhvdXJab29tIT16PycgaW5zdGVhZCc6JycpKTsKICAgIGlmICghZG9uZVpvb21zW291clpvb21dKSB7CiAgICAgIHZhciBwYXJhbXMgPSBnZXRNYXBab29tVGlsZVBhcmFtZXRlcnMob3VyWm9vbSk7CiAgICAgIHZhciBtc2cgPSAnREVCVUc6IGRhdGEgem9vbSAnK291clpvb207CiAgICAgIGlmIChwYXJhbXMuaGFzUG9ydGFscykgewogICAgICAgIG1zZyArPSAnIGhhcyBwb3J0YWxzLCBMJytwYXJhbXMubGV2ZWwrJysnOwogICAgICB9IGVsc2UgewogICAgICAgIG1zZyArPSAnIE5PIHBvcnRhbHMgKHdhcyBMJytwYXJhbXMubGV2ZWwrJyspJzsKICAgICAgfQogICAgICBtc2cgKz0gJywgbWluTGlua0xlbmd0aD0nK3BhcmFtcy5taW5MaW5rTGVuZ3RoOwogICAgICBtc2cgKz0gJywgdGlsZXMgcGVyIGVkZ2U9JytwYXJhbXMudGlsZXNQZXJFZGdlOwogICAgICBjb25zb2xlLmxvZyhtc2cpOwogICAgICBkb25lWm9vbXNbb3VyWm9vbV0gPSB0cnVlOwogICAgfQogIH0KfQoKCgp3aW5kb3cuZ2V0TWFwWm9vbVRpbGVQYXJhbWV0ZXJzID0gZnVuY3Rpb24oem9vbSkgewoKCiAgLy8gdGhlIGN1cnJlbnQgQVBJIGFsbG93cyB0aGUgY2xpZW50IHRvIHJlcXVlc3QgYSBtaW5pbXVtIHBvcnRhbCBsZXZlbC4gdGhlIHdpbmRvdy5USUxFX1BBUkFNUy5aT09NX1RPX0xFVkVMIGxpc3QgYXJlIG1pbmltdW1zCiAgLy8gaG93ZXZlciwgaW4gbXkgdmlldywgdGhpcyBjYW4gcmV0dXJuIGV4Y2Vzc2l2ZSBudW1iZXJzIG9mIHBvcnRhbHMgaW4gbWFueSBjYXNlcy4gbGV0J3MgdHJ5IGFuIG9wdGlvbmFsIHJlZHVjdGlvbgogIC8vIG9mIGRldGFpbCBsZXZlbCBhdCBzb21lIHpvb20gbGV2ZWxzCgogIHZhciBsZXZlbCA9IHdpbmRvdy5USUxFX1BBUkFNUy5aT09NX1RPX0xFVkVMW3pvb21dIHx8IDA7ICAvLyBkZWZhdWx0IHRvIGxldmVsIDAgKGFsbCBwb3J0YWxzKSBpZiBub3QgaW4gYXJyYXkKCi8vICBpZiAod2luZG93LkNPTkZJR19aT09NX1NIT1dfTEVTU19QT1JUQUxTX1pPT01FRF9PVVQpIHsKLy8gICAgaWYgKGxldmVsIDw9IDcgJiYgbGV2ZWwgPj0gNCkgewovLyAgICAgIC8vIHJlZHVjZSBwb3J0YWwgZGV0YWlsIGxldmVsIGJ5IG9uZSAtIGhlbHBzIHJlZHVjZSBjbHV0dGVyCi8vICAgICAgbGV2ZWwgPSBsZXZlbCsxOwovLyAgICB9Ci8vICB9CgogIHZhciBtYXhUaWxlc1BlckVkZ2UgPSB3aW5kb3cuVElMRV9QQVJBTVMuVElMRVNfUEVSX0VER0Vbd2luZG93LlRJTEVfUEFSQU1TLlRJTEVTX1BFUl9FREdFLmxlbmd0aC0xXTsKCiAgcmV0dXJuIHsKICAgIGxldmVsOiBsZXZlbCwKICAgIG1heExldmVsOiB3aW5kb3cuVElMRV9QQVJBTVMuWk9PTV9UT19MRVZFTFt6b29tXSB8fCAwLCAgLy8gZm9yIHJlZmVyZW5jZSwgZm9yIGxvZyBwdXJwb3NlcywgZXRjCiAgICB0aWxlc1BlckVkZ2U6IHdpbmRvdy5USUxFX1BBUkFNUy5USUxFU19QRVJfRURHRVt6b29tXSB8fCBtYXhUaWxlc1BlckVkZ2UsCiAgICBtaW5MaW5rTGVuZ3RoOiB3aW5kb3cuVElMRV9QQVJBTVMuWk9PTV9UT19MSU5LX0xFTkdUSFt6b29tXSB8fCAwLAogICAgaGFzUG9ydGFsczogem9vbSA+PSB3aW5kb3cuVElMRV9QQVJBTVMuWk9PTV9UT19MSU5LX0xFTkdUSC5sZW5ndGgsICAvLyBubyBwb3J0YWxzIHJldHVybmVkIGF0IGFsbCB3aGVuIGxpbmsgbGVuZ3RoIGxpbWl0cyB0aGluZ3MKICAgIHpvb206IHpvb20gIC8vIGluY2x1ZGUgdGhlIHpvb20gbGV2ZWwsIGZvciByZWZlcmVuY2UKICB9Owp9CgoKd2luZG93LmdldERhdGFab29tRm9yTWFwWm9vbSA9IGZ1bmN0aW9uKHpvb20pIHsKICAvLyB3ZSBjYW4gZmV0Y2ggZGF0YSBhdCBhIHpvb20gbGV2ZWwgZGlmZmVyZW50IHRvIHRoZSBtYXAgem9vbS4KCiAgLy9OT1RFOiB0aGUgc3BlY2lmaWNzIG9mIHRoaXMgYXJlIHRpZ2h0bHkgY291cGxlZCB3aXRoIHRoZSBhYm92ZSBaT09NX1RPX0xFVkVMIGFuZCBUSUxFU19QRVJfRURHRSBhcnJheXMKCiAgLy8gZmlyc3RseSwgc29tZSBvZiBJSVRDcyB6b29tIGxldmVscywgZGVwZW5kaW5nIG9uIGJhc2UgbWFwIGxheWVyLCBjYW4gYmUgaGlnaGVyIHRoYW4gc3RvY2suIGxpbWl0IHpvb20gbGV2ZWwKICAvLyAoc3RvY2sgc2l0ZSBtYXggem9vbSBtYXkgdmFyeSBkZXBlbmRpbmcgb24gZ29vZ2xlIG1hcHMgZGV0YWlsIGluIHRoZSBhcmVhIC0gMjAgb3IgMjEgbWF4IGlzIGNvbW1vbikKICBpZiAoem9vbSA+IDIxKSB7CiAgICB6b29tID0gMjE7CiAgfQoKCiAgaWYgKCF3aW5kb3cuQ09ORklHX1pPT01fREVGQVVMVF9ERVRBSUxfTEVWRUwpIHsKCiAgICAvLyB0byBpbXByb3ZlIHRoZSBjYWNoZWluZyBwZXJmb3JtYW5jZSwgd2UgdHJ5IGFuZCBsaW1pdCB0aGUgbnVtYmVyIG9mIHpvb20gbGV2ZWxzIHdlIHJldHJpZXZlIGRhdGEgZm9yCiAgICAvLyB0byBhdm9pZCBpbXBhY3Rpbmcgc2VydmVyIGxvYWQsIHdlIGtlZXAgb3Vyc2VsdmVzIHJlc3RyaWN0ZWQgdG8gYSB6b29tIGxldmVsIHdpdGggdGhlIHNhbmUgbnVtYnJlCiAgICAvLyBvZiB0aWxlc1BlckVkZ2UgYW5kIHBvcnRhbCBsZXZlbHMgdmlzaWJsZQoKICAgIHZhciBvcmlnVGlsZVBhcmFtcyA9IGdldE1hcFpvb21UaWxlUGFyYW1ldGVycyh6b29tKTsKCiAgICB3aGlsZSAoem9vbSA+IE1JTl9aT09NKSB7CiAgICAgIHZhciBuZXdUaWxlUGFyYW1zID0gZ2V0TWFwWm9vbVRpbGVQYXJhbWV0ZXJzKHpvb20tMSk7CgogICAgICBpZiAoIG5ld1RpbGVQYXJhbXMudGlsZXNQZXJFZGdlICE9IG9yaWdUaWxlUGFyYW1zLnRpbGVzUGVyRWRnZQogICAgICAgIHx8IG5ld1RpbGVQYXJhbXMuaGFzUG9ydGFscyAhPSBvcmlnVGlsZVBhcmFtcy5oYXNQb3J0YWxzCiAgICAgICAgfHwgbmV3VGlsZVBhcmFtcy5sZXZlbCpuZXdUaWxlUGFyYW1zLmhhc1BvcnRhbHMgIT0gb3JpZ1RpbGVQYXJhbXMubGV2ZWwqb3JpZ1RpbGVQYXJhbXMuaGFzUG9ydGFscyAgLy8gbXVsdGlwbHkgYnkgJ2hhc1BvcnRhbHMnIGJvb2wgLSBzbyBjb21wYXJpc29uIGRvZXMgbm90IG1hdHRlciB3aGVuIG5vIHBvcnRhbHMgYXZhaWxhYmxlCiAgICAgICkgewogICAgICAgIC8vIHN3aXRjaGluZyB0byB6b29tLTEgd291bGQgcmVzdWx0IGluIGEgZGlmZmVyZW50IGRldGFpbCBsZXZlbCAtIHNvIHdlIGFib3J0IGNoYW5naW5nIHRoaW5ncwogICAgICAgIGJyZWFrOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGNoYW5naW5nIHRvIHpvb20gPSB6b29tLTEgcmVzdWx0cyBpbiBpZGVudGljYWwgdGlsZSBwYXJhbWV0ZXJzIC0gc28gd2UgY2FuIHNhZmVseSBzdGVwIGJhY2sKICAgICAgICAvLyB3aXRoIG5vIGluY3JlYXNlIGluIGVpdGhlciBzZXJ2ZXIgbG9hZCBvciBudW1iZXIgb2YgcmVxdWVzdHMKICAgICAgICB6b29tID0gem9vbS0xOwogICAgICB9CiAgICB9CgogIH0KCiAgcmV0dXJuIHpvb207Cn0KCgp3aW5kb3cubG5nVG9UaWxlID0gZnVuY3Rpb24obG5nLCBwYXJhbXMpIHsKICByZXR1cm4gTWF0aC5mbG9vcigobG5nICsgMTgwKSAvIDM2MCAqIHBhcmFtcy50aWxlc1BlckVkZ2UpOwp9Cgp3aW5kb3cubGF0VG9UaWxlID0gZnVuY3Rpb24obGF0LCBwYXJhbXMpIHsKICByZXR1cm4gTWF0aC5mbG9vcigoMSAtIE1hdGgubG9nKE1hdGgudGFuKGxhdCAqIE1hdGguUEkgLyAxODApICsKICAgIDEgLyBNYXRoLmNvcyhsYXQgKiBNYXRoLlBJIC8gMTgwKSkgLyBNYXRoLlBJKSAvIDIgKiBwYXJhbXMudGlsZXNQZXJFZGdlKTsKfQoKd2luZG93LnRpbGVUb0xuZyA9IGZ1bmN0aW9uKHgsIHBhcmFtcykgewogIHJldHVybiB4IC8gcGFyYW1zLnRpbGVzUGVyRWRnZSAqIDM2MCAtIDE4MDsKfQoKd2luZG93LnRpbGVUb0xhdCA9IGZ1bmN0aW9uKHksIHBhcmFtcykgewogIHZhciBuID0gTWF0aC5QSSAtIDIgKiBNYXRoLlBJICogeSAvIHBhcmFtcy50aWxlc1BlckVkZ2U7CiAgcmV0dXJuIDE4MCAvIE1hdGguUEkgKiBNYXRoLmF0YW4oMC41ICogKE1hdGguZXhwKG4pIC0gTWF0aC5leHAoLW4pKSk7Cn0KCndpbmRvdy5wb2ludFRvVGlsZUlkID0gZnVuY3Rpb24ocGFyYW1zLCB4LCB5KSB7Ci8vY2hhbmdlIHRvIHF1YWRrZXkgY29uc3RydWN0aW9uCi8vYXMgb2YgMjAxNC0wNS0wNjogem9vbV94X3lfbWlubHZsX21heGx2bF9tYXhoZWFsdGgKCiAgcmV0dXJuIHBhcmFtcy56b29tICsgIl8iICsgeCArICJfIiArIHkgKyAiXyIgKyBwYXJhbXMubGV2ZWwgKyAiXzhfMTAwIjsKfQoKCndpbmRvdy5nZXRSZXNvbmF0b3JMYXRMbmcgPSBmdW5jdGlvbihkaXN0LCBzbG90LCBwb3J0YWxMYXRMbmcpIHsKICAvLyBvZmZzZXQgaW4gbWV0ZXJzCiAgdmFyIGRuID0gZGlzdCpTTE9UX1RPX0xBVFtzbG90XTsKICB2YXIgZGUgPSBkaXN0KlNMT1RfVE9fTE5HW3Nsb3RdOwoKICAvLyBDb29yZGluYXRlIG9mZnNldCBpbiByYWRpYW5zCiAgdmFyIGRMYXQgPSBkbi9FQVJUSF9SQURJVVM7CiAgdmFyIGRMb24gPSBkZS8oRUFSVEhfUkFESVVTKk1hdGguY29zKE1hdGguUEkvMTgwKnBvcnRhbExhdExuZ1swXSkpOwoKICAvLyBPZmZzZXRQb3NpdGlvbiwgZGVjaW1hbCBkZWdyZWVzCiAgdmFyIGxhdDAgPSBwb3J0YWxMYXRMbmdbMF0gKyBkTGF0ICogMTgwL01hdGguUEk7CiAgdmFyIGxvbjAgPSBwb3J0YWxMYXRMbmdbMV0gKyBkTG9uICogMTgwL01hdGguUEk7CgogIHJldHVybiBbbGF0MCwgbG9uMF07Cn0KCgo7CgovLyBNQVAgREFUQSBERUJVRyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyB1c2VmdWwgYml0cyB0byBhc3Npc3QgZGVidWdnaW5nIG1hcCBkYXRhIHRpbGVzCgoKd2luZG93LlJlbmRlckRlYnVnVGlsZXMgPSBmdW5jdGlvbigpIHsKICB0aGlzLkNMRUFSX0NIRUNLX1RJTUUgPSBMLlBhdGguQ0FOVkFTID8gMi4wIDogMC41OwogIHRoaXMuRkFERV9USU1FID0gMi4wOwoKICB0aGlzLmRlYnVnVGlsZUxheWVyID0gTC5sYXllckdyb3VwKCk7CiAgd2luZG93LmFkZExheWVyR3JvdXAoIkRFQlVHIERhdGEgVGlsZXMiLCB0aGlzLmRlYnVnVGlsZUxheWVyLCBmYWxzZSk7CgogIHRoaXMuZGVidWdUaWxlVG9SZWN0YW5nbGUgPSB7fTsKICB0aGlzLmRlYnVnVGlsZUNsZWFyVGltZXMgPSB7fTsKICB0aGlzLnRpbWVyID0gdW5kZWZpbmVkOwp9Cgp3aW5kb3cuUmVuZGVyRGVidWdUaWxlcy5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsKICB0aGlzLmRlYnVnVGlsZUxheWVyLmNsZWFyTGF5ZXJzKCk7CiAgdGhpcy5kZWJ1Z1RpbGVUb1JlY3RhbmdsZSA9IHt9OwogIHRoaXMuZGVidWdUaWxlQ2xlYXJUaW1lcyA9IHt9Owp9Cgp3aW5kb3cuUmVuZGVyRGVidWdUaWxlcy5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oaWQsYm91bmRzKSB7CiAgdmFyIHMgPSB7Y29sb3I6ICcjNjY2Jywgd2VpZ2h0OiAyLCBvcGFjaXR5OiAwLjQsIGZpbGxDb2xvcjogJyM2NjYnLCBmaWxsT3BhY2l0eTogMC4xLCBjbGlja2FibGU6IGZhbHNlfTsKCiAgdmFyIGJvdW5kcyA9IG5ldyBMLkxhdExuZ0JvdW5kcyhib3VuZHMpOwogIGJvdW5kcyA9IGJvdW5kcy5wYWQoLTAuMDIpOwoKICB2YXIgbCA9IEwucmVjdGFuZ2xlKGJvdW5kcyxzKTsKICB0aGlzLmRlYnVnVGlsZVRvUmVjdGFuZ2xlW2lkXSA9IGw7CiAgdGhpcy5kZWJ1Z1RpbGVMYXllci5hZGRMYXllcihsKTsKICBpZiAobWFwLmhhc0xheWVyKHRoaXMuZGVidWdUaWxlTGF5ZXIpKSB7CiAgICAvLyBvbmx5IGJyaW5nIHRvIGJhY2sgaWYgd2UgaGF2ZSB0aGUgZGVidWcgbGF5ZXIgdHVybmVkIG9uCiAgICBsLmJyaW5nVG9CYWNrKCk7CiAgfQp9Cgp3aW5kb3cuUmVuZGVyRGVidWdUaWxlcy5wcm90b3R5cGUuc2V0Q29sb3VyID0gZnVuY3Rpb24oaWQsYm9yZGVyY29sLGZpbGxjb2wpIHsKICB2YXIgbCA9IHRoaXMuZGVidWdUaWxlVG9SZWN0YW5nbGVbaWRdOwogIGlmIChsKSB7CiAgICB2YXIgcyA9IHtjb2xvcjogYm9yZGVyY29sLCBmaWxsQ29sb3I6IGZpbGxjb2x9OwogICAgbC5zZXRTdHlsZShzKTsKICB9Cn0KCndpbmRvdy5SZW5kZXJEZWJ1Z1RpbGVzLnByb3RvdHlwZS5zZXRTdGF0ZSA9IGZ1bmN0aW9uKGlkLHN0YXRlKSB7CiAgdmFyIGNvbCA9ICcjZjBmJzsKICB2YXIgZmlsbCA9ICcjZjBmJzsKICB2YXIgY2xlYXJEZWxheSA9IC0xOwogIHN3aXRjaChzdGF0ZSkgewogICAgY2FzZSAnb2snOiBjb2w9JyMwZjAnOyBmaWxsPScjMGYwJzsgY2xlYXJEZWxheSA9IDI7IGJyZWFrOwogICAgY2FzZSAnZXJyb3InOiBjb2w9JyNmMDAnOyBmaWxsPScjZjAwJzsgY2xlYXJEZWxheSA9IDMwOyBicmVhazsKICAgIGNhc2UgJ2NhY2hlLWZyZXNoJzogY29sPScjMGYwJzsgZmlsbD0nI2ZmMCc7IGNsZWFyRGVsYXkgPSAyOyBicmVhazsKICAgIGNhc2UgJ2NhY2hlLXN0YWxlJzogY29sPScjZjAwJzsgZmlsbD0nI2ZmMCc7IGNsZWFyRGVsYXkgPSAxMDsgYnJlYWs7CiAgICBjYXNlICdyZXF1ZXN0ZWQnOiBjb2w9JyM2NmYnOyBmaWxsPScjNjZmJzsgYnJlYWs7CiAgICBjYXNlICdyZXRyeWluZyc6IGNvbD0nIzY2Nic7IGZpbGw9JyM2NjYnOyBicmVhazsKICAgIGNhc2UgJ3JlcXVlc3QtZmFpbCc6IGNvbD0nI2EwMCc7IGZpbGw9JyM2NjYnOyBicmVhazsKICAgIGNhc2UgJ3RpbGUtZmFpbCc6IGNvbD0nI2YwMCc7IGZpbGw9JyM2NjYnOyBicmVhazsKICAgIGNhc2UgJ3RpbGUtdGltZW91dCc6IGNvbD0nI2ZmMCc7IGZpbGw9JyM2NjYnOyBicmVhazsKICAgIGNhc2UgJ3JlbmRlci1xdWV1ZSc6IGNvbD0nI2YwZic7IGZpbGw9JyNmMGYnOyBicmVhazsKICB9CiAgdGhpcy5zZXRDb2xvdXIgKGlkLCBjb2wsIGZpbGwpOwogIGlmIChjbGVhckRlbGF5ID49IDApIHsKICAgIHZhciBjbGVhckF0ID0gRGF0ZS5ub3coKSArIGNsZWFyRGVsYXkqMTAwMDsKICAgIHRoaXMuZGVidWdUaWxlQ2xlYXJUaW1lc1tpZF0gPSBjbGVhckF0OwoKICAgIGlmICghdGhpcy50aW1lcikgewogICAgICB0aGlzLnN0YXJ0VGltZXIoY2xlYXJEZWxheSoxMDAwKTsKICAgIH0KICB9Cn0KCgp3aW5kb3cuUmVuZGVyRGVidWdUaWxlcy5wcm90b3R5cGUuc3RhcnRUaW1lciA9IGZ1bmN0aW9uKHdhaXRUaW1lKSB7CiAgdmFyIF90aGlzID0gdGhpczsKICBpZiAoIV90aGlzLnRpbWVyKSB7CiAgICAvLyBhIHRpbWVvdXQgb2YgMCBmaXJpbmcgdGhlIGFjdHVhbCB0aW1lb3V0IC0gaGVscHMgdGhpbmdzIHJ1biBzbW9vdGhlcgogICAgX3RoaXMudGltZXIgPSBzZXRUaW1lb3V0ICggZnVuY3Rpb24oKSB7CiAgICAgIF90aGlzLnRpbWVyID0gc2V0VGltZW91dCAoIGZ1bmN0aW9uKCkgeyBfdGhpcy50aW1lciA9IHVuZGVmaW5lZDsgX3RoaXMucnVuQ2xlYXJQYXNzKCk7IH0sIHdhaXRUaW1lICk7CiAgICB9LCAwKTsKICB9Cn0KCndpbmRvdy5SZW5kZXJEZWJ1Z1RpbGVzLnByb3RvdHlwZS5ydW5DbGVhclBhc3MgPSBmdW5jdGlvbigpIHsKCiAgdmFyIG5vdyA9IERhdGUubm93KCk7CiAgZm9yICh2YXIgaWQgaW4gdGhpcy5kZWJ1Z1RpbGVDbGVhclRpbWVzKSB7CiAgICB2YXIgZGlmZiA9IG5vdyAtIHRoaXMuZGVidWdUaWxlQ2xlYXJUaW1lc1tpZF07CiAgICBpZiAoZGlmZiA+IDApIHsKICAgICAgaWYgKGRpZmYgPiB0aGlzLkZBREVfVElNRSoxMDAwKSB7CiAgICAgICAgdGhpcy5kZWJ1Z1RpbGVMYXllci5yZW1vdmVMYXllcih0aGlzLmRlYnVnVGlsZVRvUmVjdGFuZ2xlW2lkXSk7CiAgICAgICAgZGVsZXRlIHRoaXMuZGVidWdUaWxlQ2xlYXJUaW1lc1tpZF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGZhZGUgPSAxLjAgLSAoZGlmZiAvICh0aGlzLkZBREVfVElNRSoxMDAwKSk7CgogICAgICAgIHRoaXMuZGVidWdUaWxlVG9SZWN0YW5nbGVbaWRdLnNldFN0eWxlICh7IG9wYWNpdHk6IDAuNCpmYWRlLCBmaWxsT3BhY2l0eTogMC4xKmZhZGUgfSk7CiAgICAgIH0KICAgIH0KICB9CgogIGlmIChPYmplY3Qua2V5cyh0aGlzLmRlYnVnVGlsZUNsZWFyVGltZXMpLmxlbmd0aCA+IDApIHsKICAgIHRoaXMuc3RhcnRUaW1lcih0aGlzLkNMRUFSX0NIRUNLX1RJTUUqMTAwMCk7CiAgfQp9CgoKOwoKLy8gTUFQIERBVEEgUkVOREVSIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBjbGFzcyB0byBoYW5kbGUgcmVuZGVyaW5nIGludG8gbGVhZmxldCB0aGUgSlNPTiBkYXRhIGZyb20gdGhlIHNlcnZlcnMKCgoKd2luZG93LlJlbmRlciA9IGZ1bmN0aW9uKCkgewogIHRoaXMucG9ydGFsTWFya2VyU2NhbGUgPSB1bmRlZmluZWQ7Cn0KCi8vIHN0YXJ0IGEgcmVuZGVyIHBhc3MuIGNhbGxlZCBhcyB3ZSBzdGFydCB0byBtYWtlIHRoZSBiYXRjaCBvZiBkYXRhIHJlcXVlc3RzIHRvIHRoZSBzZXJ2ZXJzCndpbmRvdy5SZW5kZXIucHJvdG90eXBlLnN0YXJ0UmVuZGVyUGFzcyA9IGZ1bmN0aW9uKGxldmVsLGJvdW5kcykgewogIHRoaXMuaXNSZW5kZXJpbmcgPSB0cnVlOwoKICB0aGlzLmRlbGV0ZWRHdWlkID0ge307ICAvLyBvYmplY3QgLSByZXByZXNlbnRzIHRoZSBzZXQgb2YgYWxsIGRlbGV0ZWQgZ2FtZSBlbnRpdHkgR1VJRHMgc2VlbiBpbiBhIHJlbmRlciBwYXNzCgogIHRoaXMuc2VlblBvcnRhbHNHdWlkID0ge307CiAgdGhpcy5zZWVuTGlua3NHdWlkID0ge307CiAgdGhpcy5zZWVuRmllbGRzR3VpZCA9IHt9OwoKICB0aGlzLmJvdW5kcyA9IGJvdW5kczsKICB0aGlzLmxldmVsID0gbGV2ZWw7CgogIC8vIHdlIHBhZCB0aGUgYm91bmRzIHVzZWQgZm9yIGNsZWFyaW5nIGEgbGl0bGUgYml0LCBhcyBlbnRpdGllcyBhcmUgc29tZXRpbWVzIHJldHVybmVkIG91dHNpZGUgb2YgdGhlaXIgc3BlY2lmaWVkIHRpbGUgYm91bmRhcmllcwogIC8vIHRoaXMgd2lsbCBqdXN0IGF2b2lkIGEgZmV3IGVudGl0eSByZW1vdmFscyBhdCBzdGFydCBvZiByZW5kZXIgd2hlbiB0aGV5J2xsIGp1c3QgYmUgYWRkZWQgYWdhaW4KICB2YXIgcGFkZGVkQm91bmRzID0gYm91bmRzLnBhZCgwLjEpOwoKICB0aGlzLmNsZWFyUG9ydGFsc091dHNpZGVCb3VuZHMocGFkZGVkQm91bmRzKTsKCiAgdGhpcy5jbGVhckxpbmtzT3V0c2lkZUJvdW5kcyhwYWRkZWRCb3VuZHMpOwogIHRoaXMuY2xlYXJGaWVsZHNPdXRzaWRlQm91bmRzKHBhZGRlZEJvdW5kcyk7CgoKICB0aGlzLnJlc2NhbGVQb3J0YWxNYXJrZXJzKCk7Cn0KCndpbmRvdy5SZW5kZXIucHJvdG90eXBlLmNsZWFyUG9ydGFsc091dHNpZGVCb3VuZHMgPSBmdW5jdGlvbihib3VuZHMpIHsKICB2YXIgY291bnQgPSAwOwogIGZvciAodmFyIGd1aWQgaW4gd2luZG93LnBvcnRhbHMpIHsKICAgIHZhciBwID0gcG9ydGFsc1tndWlkXTsKICAgIC8vIGNsZWFyIHBvcnRhbHMgb3V0c2lkZSB2aXNpYmxlIGJvdW5kcyAtIHVubGVzcyBpdCdzIHRoZSBzZWxlY3RlZCBwb3J0YWwsIG9yIGl0J3MgcmVsZXZhbnQgdG8gYXJ0aWZhY3RzCiAgICBpZiAoIWJvdW5kcy5jb250YWlucyhwLmdldExhdExuZygpKSAmJiBndWlkICE9PSBzZWxlY3RlZFBvcnRhbCAmJiAhYXJ0aWZhY3QuaXNJbnRlcmVzdGluZ1BvcnRhbChndWlkKSkgewogICAgICB0aGlzLmRlbGV0ZVBvcnRhbEVudGl0eShndWlkKTsKICAgICAgY291bnQrKzsKICAgIH0KICB9CiAgY29uc29sZS5sb2coJ1JlbmRlcjogZGVsZXRlZCAnK2NvdW50KycgcG9ydGFscyBieSBsZXZlbC9ib3VuZHMnKTsKfQoKd2luZG93LlJlbmRlci5wcm90b3R5cGUuY2xlYXJMaW5rc091dHNpZGVCb3VuZHMgPSBmdW5jdGlvbihib3VuZHMpIHsKICB2YXIgY291bnQgPSAwOwogIGZvciAodmFyIGd1aWQgaW4gd2luZG93LmxpbmtzKSB7CiAgICB2YXIgbCA9IGxpbmtzW2d1aWRdOwoKICAgIC8vIE5PVEU6IG91ciBnZW9kZXNpYyBsaW5lcyBjYW4gaGF2ZSBsb3RzIG9mIGludGVybWVkaWF0ZSBwb2ludHMuIHRoZSBib3VuZHMgY2FsY3VsYXRpb24gaGFzbid0IGJlZW4gb3B0aW1pc2VkIGZvciB0aGlzCiAgICAvLyBzbyBjYW4gYmUgcGFydGljdWxhcmx5IHNsb3cuIGEgc2ltcGxlIGJvdW5kcyBjaGVjayBiYXNlZCBvbiBzdGFydCtlbmQgcG9pbnQgd2lsbCBiZSBnb29kIGVub3VnaCBmb3IgdGhpcyBjaGVjawogICAgdmFyIGxscyA9IGwuZ2V0TGF0TG5ncygpOwogICAgdmFyIGxpbmtCb3VuZHMgPSBMLmxhdExuZ0JvdW5kcyhsbHMpOwoKICAgIGlmICghYm91bmRzLmludGVyc2VjdHMobGlua0JvdW5kcykpIHsKICAgICAgdGhpcy5kZWxldGVMaW5rRW50aXR5KGd1aWQpOwogICAgICBjb3VudCsrOwogICAgfQogIH0KICBjb25zb2xlLmxvZygnUmVuZGVyOiBkZWxldGVkICcrY291bnQrJyBsaW5rcyBieSBib3VuZHMnKTsKfQoKd2luZG93LlJlbmRlci5wcm90b3R5cGUuY2xlYXJGaWVsZHNPdXRzaWRlQm91bmRzID0gZnVuY3Rpb24oYm91bmRzKSB7CiAgdmFyIGNvdW50ID0gMDsKICBmb3IgKHZhciBndWlkIGluIHdpbmRvdy5maWVsZHMpIHsKICAgIHZhciBmID0gZmllbGRzW2d1aWRdOwoKICAgIC8vIE5PVEU6IG91ciBnZW9kZXNpYyBwb2x5cyBjYW4gaGF2ZSBsb3RzIG9mIGludGVybWVkaWF0ZSBwb2ludHMuIHRoZSBib3VuZHMgY2FsY3VsYXRpb24gaGFzbid0IGJlZW4gb3B0aW1pc2VkIGZvciB0aGlzCiAgICAvLyBzbyBjYW4gYmUgcGFydGljdWxhcmx5IHNsb3cuIGEgc2ltcGxlIGJvdW5kcyBjaGVjayBiYXNlZCBvbiBjb3JuZXIgcG9pbnRzIHdpbGwgYmUgZ29vZCBlbm91Z2ggZm9yIHRoaXMgY2hlY2sKICAgIHZhciBsbHMgPSBmLmdldExhdExuZ3MoKTsKICAgIHZhciBmaWVsZEJvdW5kcyA9IEwubGF0TG5nQm91bmRzKFtsbHNbMF0sbGxzWzFdXSkuZXh0ZW5kKGxsc1syXSk7CgogICAgaWYgKCFib3VuZHMuaW50ZXJzZWN0cyhmaWVsZEJvdW5kcykpIHsKICAgICAgdGhpcy5kZWxldGVGaWVsZEVudGl0eShndWlkKTsKICAgICAgY291bnQrKzsKICAgIH0KICB9CiAgY29uc29sZS5sb2coJ1JlbmRlcjogZGVsZXRlZCAnK2NvdW50KycgZmllbGRzIGJ5IGJvdW5kcycpOwp9CgoKLy8gcHJvY2VzcyBkZWxldGVkIGVudGl0eSBsaXN0IGFuZCBlbnRpdHkgZGF0YQp3aW5kb3cuUmVuZGVyLnByb3RvdHlwZS5wcm9jZXNzVGlsZURhdGEgPSBmdW5jdGlvbih0aWxlZGF0YSkgewogIHRoaXMucHJvY2Vzc0RlbGV0ZWRHYW1lRW50aXR5R3VpZHModGlsZWRhdGEuZGVsZXRlZEdhbWVFbnRpdHlHdWlkc3x8W10pOwogIHRoaXMucHJvY2Vzc0dhbWVFbnRpdGllcyh0aWxlZGF0YS5nYW1lRW50aXRpZXN8fFtdKTsKfQoKCndpbmRvdy5SZW5kZXIucHJvdG90eXBlLnByb2Nlc3NEZWxldGVkR2FtZUVudGl0eUd1aWRzID0gZnVuY3Rpb24oZGVsZXRlZCkgewogIGZvcih2YXIgaSBpbiBkZWxldGVkKSB7CiAgICB2YXIgZ3VpZCA9IGRlbGV0ZWRbaV07CgogICAgaWYgKCAhKGd1aWQgaW4gdGhpcy5kZWxldGVkR3VpZCkgKSB7CiAgICAgIHRoaXMuZGVsZXRlZEd1aWRbZ3VpZF0gPSB0cnVlOyAgLy8gZmxhZyB0aGlzIGd1aWQgYXMgaGF2aW5nIGJlaW5nIHByb2Nlc3NlZAoKICAgICAgaWYgKGd1aWQgPT0gc2VsZWN0ZWRQb3J0YWwpIHsKICAgICAgICAvLyB0aGUgcmFyZSBjYXNlIG9mIHRoZSBzZWxlY3RlZCBwb3J0YWwgYmVpbmcgZGVsZXRlZC4gY2xlYXIgdGhlIGRldGFpbHMgdGFiIGFuZCBkZXNlbGVjdCBpdAogICAgICAgIHJlbmRlclBvcnRhbERldGFpbHMobnVsbCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZGVsZXRlRW50aXR5KGd1aWQpOwoKICAgIH0KICB9Cgp9Cgp3aW5kb3cuUmVuZGVyLnByb3RvdHlwZS5wcm9jZXNzR2FtZUVudGl0aWVzID0gZnVuY3Rpb24oZW50aXRpZXMpIHsKCiAgLy8gd2UgbG9vcCB0aHJvdWdoIHRoZSBlbnRpdGllcyB0aHJlZSB0aW1lcyAtIGZvciBmaWVsZHMsIGxpbmtzIGFuZCBwb3J0YWxzIHNlcGFyYXRlbHkKICAvLyB0aGlzIGlzIGEgcmVhc29uYWJseSBlZmZpY2llbnQgd29yay1hcm91bmQgZm9yIGxlYWZsZXRqcyBsaW1pdGF0aW9ucyBvbiBzdmcgcmVuZGVyIG9yZGVyCgoKICBmb3IgKHZhciBpIGluIGVudGl0aWVzKSB7CiAgICB2YXIgZW50ID0gZW50aXRpZXNbaV07CiAgICBpZiAoZW50WzJdWzBdID09ICdyJyAmJiAhKGVudFswXSBpbiB0aGlzLmRlbGV0ZWRHdWlkKSkgewogICAgICB0aGlzLmNyZWF0ZUZpZWxkRW50aXR5KGVudCk7CiAgICB9CiAgfQoKICBmb3IgKHZhciBpIGluIGVudGl0aWVzKSB7CiAgICB2YXIgZW50ID0gZW50aXRpZXNbaV07CgogICAgaWYgKGVudFsyXVswXSA9PSAnZScgJiYgIShlbnRbMF0gaW4gdGhpcy5kZWxldGVkR3VpZCkpIHsKICAgICAgdGhpcy5jcmVhdGVMaW5rRW50aXR5KGVudCk7CiAgICB9CiAgfQoKICBmb3IgKHZhciBpIGluIGVudGl0aWVzKSB7CiAgICB2YXIgZW50ID0gZW50aXRpZXNbaV07CgogICAgaWYgKGVudFsyXVswXSA9PSAncCcgJiYgIShlbnRbMF0gaW4gdGhpcy5kZWxldGVkR3VpZCkpIHsKICAgICAgdGhpcy5jcmVhdGVQb3J0YWxFbnRpdHkoZW50KTsKICAgIH0KICB9Cn0KCgovLyBlbmQgYSByZW5kZXIgcGFzcy4gZG9lcyBhbnkgY2xlYW5pbmcgdXAgcmVxdWlyZWQsIHBvc3Rwb25lZCBwcm9jZXNzaW5nIG9mIGRhdGEsIGV0Yy4gY2FsbGVkIHdoZW4gdGhlIHJlbmRlcgovLyBpcyBjb25zaWRlcmVkIGNvbXBsZXRlCndpbmRvdy5SZW5kZXIucHJvdG90eXBlLmVuZFJlbmRlclBhc3MgPSBmdW5jdGlvbigpIHsKICB2YXIgY291bnRwPTAsY291bnRsPTAsY291bnRmPTA7CgogIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGVyZSBhcmUgYW55IGVudGl0aWVzIHdlIGhhdmVuJ3Qgc2Vlbi4gaWYgc28sIGRlbGV0ZSB0aGVtCiAgZm9yICh2YXIgZ3VpZCBpbiB3aW5kb3cucG9ydGFscykgewogICAgLy8gc3BlY2lhbCBjYXNlIGZvciBzZWxlY3RlZCBwb3J0YWwgLSBpdCdzIGtlcHQgZXZlbiBpZiBub3Qgc2VlbgogICAgLy8gYXJ0aWZhY3QgKGUuZy4gamFydmlzIHNoYXJkKSBwb3J0YWxzIGFyZSBhbHNvIGtlcHQgLSBidXQgdGhleSdyZSBhbHdheXMgJ3NlZW4nCiAgICBpZiAoIShndWlkIGluIHRoaXMuc2VlblBvcnRhbHNHdWlkKSAmJiBndWlkICE9PSBzZWxlY3RlZFBvcnRhbCkgewogICAgICB0aGlzLmRlbGV0ZVBvcnRhbEVudGl0eShndWlkKTsKICAgICAgY291bnRwKys7CiAgICB9CiAgfQogIGZvciAodmFyIGd1aWQgaW4gd2luZG93LmxpbmtzKSB7CiAgICBpZiAoIShndWlkIGluIHRoaXMuc2VlbkxpbmtzR3VpZCkpIHsKICAgICAgdGhpcy5kZWxldGVMaW5rRW50aXR5KGd1aWQpOwogICAgICBjb3VudGwrKzsKICAgIH0KICB9CiAgZm9yICh2YXIgZ3VpZCBpbiB3aW5kb3cuZmllbGRzKSB7CiAgICBpZiAoIShndWlkIGluIHRoaXMuc2VlbkZpZWxkc0d1aWQpKSB7CiAgICAgIHRoaXMuZGVsZXRlRmllbGRFbnRpdHkoZ3VpZCk7CiAgICAgIGNvdW50ZisrOwogICAgfQogIH0KCiAgY29uc29sZS5sb2coJ1JlbmRlcjogZW5kIGNsZWFudXA6IHJlbW92ZWQgJytjb3VudHArJyBwb3J0YWxzLCAnK2NvdW50bCsnIGxpbmtzLCAnK2NvdW50ZisnIGZpZWxkcycpOwoKICAvLyByZW9yZGVyIHBvcnRhbHMgdG8gYmUgYWZ0ZXIgbGlua3MvZmllbGRzCiAgdGhpcy5icmluZ1BvcnRhbHNUb0Zyb250KCk7CgogIHRoaXMuaXNSZW5kZXJpbmcgPSBmYWxzZTsKCiAgLy8gcmUtc2VsZWN0IHRoZSBzZWxlY3RlZCBwb3J0YWwsIHRvIHJlLXJlbmRlciB0aGUgc2lkZS1iYXIuIGVuc3VyZXMgdGhhdCBhbnkgZGF0YSBjYWxjdWxhdGVkIGZyb20gdGhlIG1hcCBkYXRhIGlzIHVwIHRvIGRhdGUKICBpZiAoc2VsZWN0ZWRQb3J0YWwpIHsKICAgIHJlbmRlclBvcnRhbERldGFpbHMgKHNlbGVjdGVkUG9ydGFsKTsKICB9Cn0KCndpbmRvdy5SZW5kZXIucHJvdG90eXBlLmJyaW5nUG9ydGFsc1RvRnJvbnQgPSBmdW5jdGlvbigpIHsKICBmb3IgKHZhciBsdmwgaW4gcG9ydGFsc0ZhY3Rpb25MYXllcnMpIHsKICAgIC8vIHBvcnRhbHMgYXJlIHN0b3JlZCBpbiBzZXBhcmF0ZSBsYXllcnMgcGVyIGZhY3Rpb24KICAgIC8vIHRvIGF2b2lkIGdpdmluZyB3ZWlnaHQgdG8gb25lIGZhY3Rpb24gb3IgYW5vdGhlciwgd2UnbGwgcHVzaCBwb3J0YWxzIHRvIGZyb250IGJhc2VkIG9uIEdVSUQgb3JkZXIKICAgIHZhciBsdmxQb3J0YWxzID0ge307CiAgICBmb3IgKHZhciBmYWMgaW4gcG9ydGFsc0ZhY3Rpb25MYXllcnNbbHZsXSkgewogICAgICB2YXIgbGF5ZXIgPSBwb3J0YWxzRmFjdGlvbkxheWVyc1tsdmxdW2ZhY107CiAgICAgIGlmIChsYXllci5fbWFwKSB7CiAgICAgICAgbGF5ZXIuZWFjaExheWVyIChmdW5jdGlvbihwKSB7CiAgICAgICAgICBsdmxQb3J0YWxzW3Aub3B0aW9ucy5ndWlkXSA9IHA7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgZ3VpZHMgPSBPYmplY3Qua2V5cyhsdmxQb3J0YWxzKTsKICAgIGd1aWRzLnNvcnQoKTsKCiAgICBmb3IgKHZhciBqIGluIGd1aWRzKSB7CiAgICAgIHZhciBndWlkID0gZ3VpZHNbal07CiAgICAgIGx2bFBvcnRhbHNbZ3VpZF0uYnJpbmdUb0Zyb250KCk7CiAgICB9CiAgfQoKICAvLyBhcnRpZmFjdCBwb3J0YWxzIGFyZSBhbHdheXMgYnJvdWdodCB0byB0aGUgZnJvbnQsIGFib3ZlIGFsbCBvdGhlcnMKICAkLmVhY2goYXJ0aWZhY3QuZ2V0SW50ZXJlc3RpbmdQb3J0YWxzKCksIGZ1bmN0aW9uKGksZ3VpZCkgewogICAgaWYgKHBvcnRhbHNbZ3VpZF0gJiYgcG9ydGFsc1tndWlkXS5fbWFwKSB7CiAgICAgIHBvcnRhbHNbZ3VpZF0uYnJpbmdUb0Zyb250KCk7CiAgICB9CiAgfSk7Cgp9CgoKd2luZG93LlJlbmRlci5wcm90b3R5cGUuZGVsZXRlRW50aXR5ID0gZnVuY3Rpb24oZ3VpZCkgewogIHRoaXMuZGVsZXRlUG9ydGFsRW50aXR5KGd1aWQpOwogIHRoaXMuZGVsZXRlTGlua0VudGl0eShndWlkKTsKICB0aGlzLmRlbGV0ZUZpZWxkRW50aXR5KGd1aWQpOwp9Cgp3aW5kb3cuUmVuZGVyLnByb3RvdHlwZS5kZWxldGVQb3J0YWxFbnRpdHkgPSBmdW5jdGlvbihndWlkKSB7CiAgaWYgKGd1aWQgaW4gd2luZG93LnBvcnRhbHMpIHsKICAgIHZhciBwID0gd2luZG93LnBvcnRhbHNbZ3VpZF07CiAgICB3aW5kb3cub3JuYW1lbnRzLnJlbW92ZVBvcnRhbChwKTsKICAgIHRoaXMucmVtb3ZlUG9ydGFsRnJvbU1hcExheWVyKHApOwogICAgZGVsZXRlIHdpbmRvdy5wb3J0YWxzW2d1aWRdOwogIH0KfQoKd2luZG93LlJlbmRlci5wcm90b3R5cGUuZGVsZXRlTGlua0VudGl0eSA9IGZ1bmN0aW9uKGd1aWQpIHsKICBpZiAoZ3VpZCBpbiB3aW5kb3cubGlua3MpIHsKICAgIHZhciBsID0gd2luZG93LmxpbmtzW2d1aWRdOwogICAgbGlua3NGYWN0aW9uTGF5ZXJzW2wub3B0aW9ucy50ZWFtXS5yZW1vdmVMYXllcihsKTsKICAgIGRlbGV0ZSB3aW5kb3cubGlua3NbZ3VpZF07CiAgfQp9CgoKd2luZG93LlJlbmRlci5wcm90b3R5cGUuZGVsZXRlRmllbGRFbnRpdHkgPSBmdW5jdGlvbihndWlkKSB7CiAgaWYgKGd1aWQgaW4gd2luZG93LmZpZWxkcykgewogICAgdmFyIGYgPSB3aW5kb3cuZmllbGRzW2d1aWRdOwogICAgdmFyIGZkID0gZi5vcHRpb25zLmRldGFpbHM7CgogICAgZmllbGRzRmFjdGlvbkxheWVyc1tmLm9wdGlvbnMudGVhbV0ucmVtb3ZlTGF5ZXIoZik7CiAgICBkZWxldGUgd2luZG93LmZpZWxkc1tndWlkXTsKICB9Cn0KCgp3aW5kb3cuUmVuZGVyLnByb3RvdHlwZS5jcmVhdGVQbGFjZWhvbGRlclBvcnRhbEVudGl0eSA9IGZ1bmN0aW9uKGd1aWQsbGF0RTYsbG5nRTYsdGVhbSkgewogIC8vIGludGVsIG5vIGxvbmdlciByZXR1cm5zIHBvcnRhbHMgYXQgYW55dGhpbmcgYnV0IHRoZSBjbG9zZXN0IHpvb20KICAvLyBzdG9jayBpbnRlbCBjcmVhdGVzICdwbGFjZWhvbGRlcicgcG9ydGFscyBmcm9tIHRoZSBkYXRhIGluIGxpbmtzL2ZpZWxkcyAtIElJVEMgbmVlZHMgdG8gZG8gdGhlIHNhbWUKICAvLyB3ZSBvbmx5IGhhdmUgdGhlIHBvcnRhbCBndWlkLCBsYXQvbG5nIGNvb3JkcywgYW5kIHRoZSBmYWN0aW9uIC0gbm8gb3RoZXIgZGF0YQogIC8vIGhhdmluZyB0aGUgZ3VpZCwgYXQgbGVhc3QsIGFsbG93cyB0aGUgcG9ydGFsIGRldGFpbHMgdG8gYmUgbG9hZGVkIG9uY2UgaXQncyBzZWxlY3RlZC4gaG93ZXZlciwKICAvLyBubyBoaWdobGlnaHRlcnMsIHBvcnRhbCBsZXZlbCBudW1iZXJzLCBwb3J0YWwgbmFtZXMsIHVzZWZ1bCBjb3VudHMgb2YgcG9ydGFscywgZXRjIGFyZSBwb3NzaWJsZQoKCiAgdmFyIGVudCA9IFsKICAgIGd1aWQsICAgICAgIC8vZW50WzBdID0gZ3VpZAogICAgMCwgICAgICAgICAgLy9lbnRbMV0gPSB0aW1lc3RhbXAgLSB6ZXJvIHdpbGwgbWVhbiBhbnkgb3RoZXIgc291cmNlIG9mIHBvcnRhbCBkYXRhIHdpbGwgaGF2ZSBhIGhpZ2hlciB0aW1lc3RhbXAKICAgICAgICAgICAgICAgIC8vZW50WzJdID0gYW4gYXJyYXkgd2l0aCB0aGUgZW50aXR5IGRhdGEKICAgIFsgJ3AnLCAgICAgIC8vMCAtIGEgcG9ydGFsCiAgICAgIHRlYW0sICAgICAvLzEgLSB0ZWFtCiAgICAgIGxhdEU2LCAgICAvLzIgLSBsYXQKICAgICAgbG5nRTYgICAgIC8vMyAtIGxuZwogICAgXQogIF07CgogIHRoaXMuY3JlYXRlUG9ydGFsRW50aXR5KGVudCk7Cgp9CgoKd2luZG93LlJlbmRlci5wcm90b3R5cGUuY3JlYXRlUG9ydGFsRW50aXR5ID0gZnVuY3Rpb24oZW50KSB7CiAgdGhpcy5zZWVuUG9ydGFsc0d1aWRbZW50WzBdXSA9IHRydWU7ICAvLyBmbGFnIHdlJ3ZlIHNlZW4gaXQKCiAgdmFyIHByZXZpb3VzRGF0YSA9IHVuZGVmaW5lZDsKCiAgLy8gY2hlY2sgaWYgZW50aXR5IGFscmVhZHkgZXhpc3RzCiAgaWYgKGVudFswXSBpbiB3aW5kb3cucG9ydGFscykgewogICAgLy8geWVzLiBub3cgY2hlY2sgdG8gc2VlIGlmIHRoZSBlbnRpdHkgZGF0YSB3ZSBoYXZlIGlzIG5ld2VyIHRoYW4gdGhhdCBpbiBwbGFjZQogICAgdmFyIHAgPSB3aW5kb3cucG9ydGFsc1tlbnRbMF1dOwoKICAgIGlmIChwLm9wdGlvbnMudGltZXN0YW1wID49IGVudFsxXSkgcmV0dXJuOyAvLyB0aGlzIGRhdGEgaXMgaWRlbnRpY2FsIG9yIG9sZGVyIC0gYWJvcnQgcHJvY2Vzc2luZwoKICAgIC8vIHRoZSBkYXRhIHdlIGhhdmUgaXMgbmV3ZXIuIG1hbnkgZGF0YSBjaGFuZ2VzIHJlcXVpcmUgcmUtcmVuZGVyaW5nIG9mIHRoZSBwb3J0YWwKICAgIC8vIChlLmcuIGxldmVsIGNoYW5nZWQsIHNvIHNpemUgaXMgZGlmZmVyZW50LCBvciBzdGF0cyBjaGFuZ2VkIHNvIGhpZ2hsaWdodGVyIGlzIGRpZmZlcmVudCkKICAgIC8vIHNvIHRvIGtlZXAgdGhpbmdzIHNpbXBsZSB3ZSdsbCBhbHdheXMgcmUtY3JlYXRlIHRoZSBlbnRpdHkgaW4gdGhpcyBjYXNlCgogICAgLy8gcmVtZW1iZXIgdGhlIG9sZCBkZXRhaWxzLCBmb3IgdGhlIGNhbGxiYWNrCgogICAgcHJldmlvdXNEYXRhID0gcC5vcHRpb25zLmRhdGE7CgogICAgdGhpcy5kZWxldGVQb3J0YWxFbnRpdHkoZW50WzBdKTsKICB9CgogIHZhciBwb3J0YWxMZXZlbCA9IHBhcnNlSW50KGVudFsyXVs0XSl8fDA7CiAgdmFyIHRlYW0gPSB0ZWFtU3RyaW5nVG9JZChlbnRbMl1bMV0pOwogIC8vIHRoZSBkYXRhIHJldHVybnMgdW5jbGFpbWVkIHBvcnRhbHMgYXMgbGV2ZWwgMSAtIGJ1dCBJSVRDIHdhbnRzIHRoZW0gdHJlYXRlZCBhcyBsZXZlbCAwCiAgaWYgKHRlYW0gPT0gVEVBTV9OT05FKSBwb3J0YWxMZXZlbCA9IDA7CgogIHZhciBsYXRsbmcgPSBMLmxhdExuZyhlbnRbMl1bMl0vMUU2LCBlbnRbMl1bM10vMUU2KTsKCiAgdmFyIGRhdGEgPSBkZWNvZGVBcnJheS5wb3J0YWxTdW1tYXJ5KGVudFsyXSk7CgogIHZhciBkYXRhT3B0aW9ucyA9IHsKICAgIGxldmVsOiBwb3J0YWxMZXZlbCwKICAgIHRlYW06IHRlYW0sCiAgICBlbnQ6IGVudCwgIC8vIExFR0FDWSAtIFRPIEJFIFJFTU9WRUQgQVQgU09NRSBQT0lOVCEgdXNlIC5ndWlkLCAudGltZXN0YW1wIGFuZCAuZGF0YSBpbnN0ZWFkCiAgICBndWlkOiBlbnRbMF0sCiAgICB0aW1lc3RhbXA6IGVudFsxXSwKICAgIGRhdGE6IGRhdGEKICB9OwoKICB3aW5kb3cucHVzaFBvcnRhbEd1aWRQb3NpdGlvbkNhY2hlKGVudFswXSwgZGF0YS5sYXRFNiwgZGF0YS5sbmdFNik7CgogIHZhciBtYXJrZXIgPSBjcmVhdGVNYXJrZXIobGF0bG5nLCBkYXRhT3B0aW9ucyk7CgogIG1hcmtlci5vbignY2xpY2snLCBmdW5jdGlvbigpIHsgd2luZG93LnJlbmRlclBvcnRhbERldGFpbHMoZW50WzBdKTsgfSk7CiAgbWFya2VyLm9uKCdkYmxjbGljaycsIGZ1bmN0aW9uKCkgeyB3aW5kb3cucmVuZGVyUG9ydGFsRGV0YWlscyhlbnRbMF0pOyB3aW5kb3cubWFwLnNldFZpZXcobGF0bG5nLCAxNyk7IH0pOwoKCiAgd2luZG93LnJ1bkhvb2tzKCdwb3J0YWxBZGRlZCcsIHtwb3J0YWw6IG1hcmtlciwgcHJldmlvdXNEYXRhOiBwcmV2aW91c0RhdGF9KTsKCiAgd2luZG93LnBvcnRhbHNbZW50WzBdXSA9IG1hcmtlcjsKCiAgLy8gY2hlY2sgZm9yIFVSTCBsaW5rcyB0byBwb3J0YWwsIGFuZCBzZWxlY3QgaXQgaWYgdGhpcyBpcyB0aGUgb25lCiAgaWYgKHVybFBvcnRhbExMICYmIHVybFBvcnRhbExMWzBdID09IG1hcmtlci5nZXRMYXRMbmcoKS5sYXQgJiYgdXJsUG9ydGFsTExbMV0gPT0gbWFya2VyLmdldExhdExuZygpLmxuZykgewogICAgLy8gVVJMLXBhc3NlZCBwb3J0YWwgZm91bmQgdmlhIHBsbCBwYXJhbWV0ZXIgLSBzZXQgdGhlIGd1aWQtYmFzZWQgcGFyYW1ldGVyCiAgICBjb25zb2xlLmxvZygndXJsUG9ydGFsTEwgJyt1cmxQb3J0YWxMTFswXSsnLCcrdXJsUG9ydGFsTExbMV0rJyBtYXRjaGVzIHBvcnRhbCBHVUlEICcrZW50WzBdKTsKCiAgICB1cmxQb3J0YWwgPSBlbnRbMF07CiAgICB1cmxQb3J0YWxMTCA9IHVuZGVmaW5lZDsgIC8vIGNsZWFyIHRoZSBVUkwgcGFyYW1ldGVyIHNvIGl0J3Mgbm90IG1hdGNoZWQgYWdhaW4KICB9CiAgaWYgKHVybFBvcnRhbCA9PSBlbnRbMF0pIHsKICAgIC8vIFVSTC1wYXNzZWQgcG9ydGFsIGZvdW5kIHZpYSBndWlkIHBhcmFtZXRlciAtIHNldCBpdCBhcyB0aGUgc2VsZWN0ZWQgcG9ydGFsCiAgICBjb25zb2xlLmxvZygndXJsUG9ydGFsIEdVSUQgJyt1cmxQb3J0YWwrJyBmb3VuZCAtIHNlbGVjdGluZy4uLicpOwogICAgc2VsZWN0ZWRQb3J0YWwgPSBlbnRbMF07CiAgICB1cmxQb3J0YWwgPSB1bmRlZmluZWQ7ICAvLyBjbGVhciB0aGUgVVJMIHBhcmFtZXRlciBzbyBpdCdzIG5vdCBtYXRjaGVkIGFnYWluCiAgfQoKICAvLyAocmUtKXNlbGVjdCB0aGUgcG9ydGFsLCB0byByZWZyZXNoIHRoZSBzaWRlYmFyIG9uIGFueSBjaGFuZ2VzCiAgaWYgKGVudFswXSA9PSBzZWxlY3RlZFBvcnRhbCkgewogICAgY29uc29sZS5sb2coJ3BvcnRhbCBndWlkICcrZW50WzBdKycgaXMgdGhlIHNlbGVjdGVkIHBvcnRhbCAtIHJlLXJlbmRlcmluZyBwb3J0YWwgZGV0YWlscycpOwogICAgcmVuZGVyUG9ydGFsRGV0YWlscyAoc2VsZWN0ZWRQb3J0YWwpOwogIH0KCiAgd2luZG93Lm9ybmFtZW50cy5hZGRQb3J0YWwobWFya2VyKTsKCiAgLy9UT0RPPyBwb3N0cG9uZSBhZGRpbmcgdG8gdGhlIG1hcCBsYXllcgogIHRoaXMuYWRkUG9ydGFsVG9NYXBMYXllcihtYXJrZXIpOwoKfQoKCndpbmRvdy5SZW5kZXIucHJvdG90eXBlLmNyZWF0ZUZpZWxkRW50aXR5ID0gZnVuY3Rpb24oZW50KSB7CiAgdGhpcy5zZWVuRmllbGRzR3VpZFtlbnRbMF1dID0gdHJ1ZTsgIC8vIGZsYWcgd2UndmUgc2VlbiBpdAoKICB2YXIgZGF0YSA9IHsKLy8gICAgdHlwZTogZW50WzJdWzBdLAogICAgdGVhbTogZW50WzJdWzFdLAogICAgcG9pbnRzOiBlbnRbMl1bMl0ubWFwKGZ1bmN0aW9uKGFycikgeyByZXR1cm4ge2d1aWQ6IGFyclswXSwgbGF0RTY6IGFyclsxXSwgbG5nRTY6IGFyclsyXSB9OyB9KQogIH07CgogIC8vY3JlYXRlIHBsYWNlaG9sZGVyIHBvcnRhbHMgZm9yIGZpZWxkIGNvcm5lcnMuIHdlIGFscmVhZHkgZG8gbGlua3MsIGJ1dCB0aGVyZSBhcmUgdGhlIG9kZCBjYXNlIHdoZXJlIHRoaXMgaXMgdXNlZnVsCiAgZm9yICh2YXIgaT0wOyBpPDM7IGkrKykgewogICAgdmFyIHA9ZGF0YS5wb2ludHNbaV07CiAgICB0aGlzLmNyZWF0ZVBsYWNlaG9sZGVyUG9ydGFsRW50aXR5KHAuZ3VpZCwgcC5sYXRFNiwgcC5sbmdFNiwgZGF0YS50ZWFtKTsKICB9CgogIC8vIGNoZWNrIGlmIGVudGl0eSBhbHJlYWR5IGV4aXN0cwogIGlmKGVudFswXSBpbiB3aW5kb3cuZmllbGRzKSB7CiAgICAvLyB5ZXMuIGluIHRoZW9yeSwgd2Ugc2hvdWxkIG5ldmVyIGdldCB1cGRhdGVkIGRhdGEgZm9yIGFuIGV4aXN0aW5nIGZpZWxkLiB0aGV5J3JlIGNyZWF0ZWQsIGFuZCB0aGV5J3JlIGRlc3Ryb3llZCAtIG5ldmVyIGNoYW5nZWQKICAgIC8vIGJ1dCB0aGVvcnkgYW5kIHByYWN0aWNlIG1heSBub3QgYmUgdGhlIHNhbWUgdGhpbmcuLi4KICAgIHZhciBmID0gd2luZG93LmZpZWxkc1tlbnRbMF1dOwoKICAgIGlmIChmLm9wdGlvbnMudGltZXN0YW1wID49IGVudFsxXSkgcmV0dXJuOyAvLyB0aGlzIGRhdGEgaXMgaWRlbnRpY2FsIChvciBvcmRlcikgdGhhbiB0aGF0IHJlbmRlcmVkIC0gYWJvcnQgcHJvY2Vzc2luZwoKICAgIC8vIHRoZSBkYXRhIHdlIGhhdmUgaXMgbmV3ZXIgLSB0d28gb3B0aW9ucwogICAgLy8gMS4ganVzdCB1cGRhdGUgdGhlIGRhdGEsIGFzc3VtZSB0aGUgZmllbGQgcmVuZGVyIGFwcGVhcmFuY2UgaXMgdW5tb2RpZmllZAogICAgLy8gMi4gZGVsZXRlIHRoZSBlbnRpdHksIHRoZW4gcmUtY3JlYXRlIHdpdGggdGhlIG5ldyBkYXRhCiAgICB0aGlzLmRlbGV0ZUZpZWxkRW50aXR5KGVudFswXSk7IC8vIG9wdGlvbiAyLCBmb3Igbm93CiAgfQoKICB2YXIgdGVhbSA9IHRlYW1TdHJpbmdUb0lkKGVudFsyXVsxXSk7CiAgdmFyIGxhdGxuZ3MgPSBbCiAgICBMLmxhdExuZyhkYXRhLnBvaW50c1swXS5sYXRFNi8xRTYsIGRhdGEucG9pbnRzWzBdLmxuZ0U2LzFFNiksCiAgICBMLmxhdExuZyhkYXRhLnBvaW50c1sxXS5sYXRFNi8xRTYsIGRhdGEucG9pbnRzWzFdLmxuZ0U2LzFFNiksCiAgICBMLmxhdExuZyhkYXRhLnBvaW50c1syXS5sYXRFNi8xRTYsIGRhdGEucG9pbnRzWzJdLmxuZ0U2LzFFNikKICBdOwoKICB2YXIgcG9seSA9IEwuZ2VvZGVzaWNQb2x5Z29uKGxhdGxuZ3MsIHsKICAgIGZpbGxDb2xvcjogQ09MT1JTW3RlYW1dLAogICAgZmlsbE9wYWNpdHk6IDAuMjUsCiAgICBzdHJva2U6IGZhbHNlLAogICAgY2xpY2thYmxlOiBmYWxzZSwKCiAgICB0ZWFtOiB0ZWFtLAogICAgZW50OiBlbnQsICAvLyBMRUdBQ1kgLSBUTyBCRSBSRU1PVkVEIEFUIFNPTUUgUE9JTlQhIHVzZSAuZ3VpZCwgLnRpbWVzdGFtcCBhbmQgLmRhdGEgaW5zdGVhZAogICAgZ3VpZDogZW50WzBdLAogICAgdGltZXN0YW1wOiBlbnRbMV0sCiAgICBkYXRhOiBkYXRhLAogIH0pOwoKICBydW5Ib29rcygnZmllbGRBZGRlZCcse2ZpZWxkOiBwb2x5fSk7CgogIHdpbmRvdy5maWVsZHNbZW50WzBdXSA9IHBvbHk7CgogIC8vIFRPRE8/IHBvc3Rwb25lIGFkZGluZyB0byB0aGUgbGF5ZXI/PwogIGZpZWxkc0ZhY3Rpb25MYXllcnNbcG9seS5vcHRpb25zLnRlYW1dLmFkZExheWVyKHBvbHkpOwp9Cgp3aW5kb3cuUmVuZGVyLnByb3RvdHlwZS5jcmVhdGVMaW5rRW50aXR5ID0gZnVuY3Rpb24oZW50LGZha2VkKSB7CiAgLy8gTmlhbnRpYyBoYXZlIGJlZW4gZmFraW5nIGxpbmsgZW50aXRpZXMsIGJhc2VkIG9uIGRhdGEgZnJvbSBmaWVsZHMKICAvLyB0aGVzZSBmYWtlZCBsaW5rcyBhcmUgc2VudCBhbG9uZyB3aXRoIHRoZSByZWFsIHBvcnRhbCBsaW5rcywgY2F1c2luZyBkdXBsaWNhdGVzCiAgLy8gdGhlIGZha2VkIG9uZXMgYWxsIGhhdmUgbG9uZ2VyIEdVSURzLCBiYXNlZCBvbiB0aGUgZmllbGQgR1VJRCAod2l0aCBfYWIsIF9hYywgX2JjIGFwcGVuZGVkKQogIHZhciBmYWtlZExpbmsgPSBuZXcgUmVnRXhwKCJeWzAtOWEtZl17MzJ9XC5iX1thYl1bYmNdJCIpOyAvL2ZpZWxkIEdVSURzIGFsd2F5cyBlbmQgd2l0aCAiLmIiIC0gZmFrZWQgbGlua3MgYXBwZW5kIHRoZSBlZGdlIGlkZW50aWZpZXIKICBpZiAoZmFrZWRMaW5rLnRlc3QoZW50WzBdKSkgcmV0dXJuOwoKCiAgdGhpcy5zZWVuTGlua3NHdWlkW2VudFswXV0gPSB0cnVlOyAgLy8gZmxhZyB3ZSd2ZSBzZWVuIGl0CgogIHZhciBkYXRhID0geyAvLyBUT0RPIGFkZCBvdGhlciBwcm9wZXJ0aWVzIGFuZCBjaGVjayBjb3JyZWN0aW9uIGRpcmVjdGlvbgovLyAgICB0eXBlOiAgIGVudFsyXVswXSwKICAgIHRlYW06ICAgZW50WzJdWzFdLAogICAgb0d1aWQ6ICBlbnRbMl1bMl0sCiAgICBvTGF0RTY6IGVudFsyXVszXSwKICAgIG9MbmdFNjogZW50WzJdWzRdLAogICAgZEd1aWQ6ICBlbnRbMl1bNV0sCiAgICBkTGF0RTY6IGVudFsyXVs2XSwKICAgIGRMbmdFNjogZW50WzJdWzddCiAgfTsKCiAgLy8gY3JlYXRlIHBsYWNlaG9sZGVyIGVudGl0aWVzIGZvciBsaW5rIHN0YXJ0IGFuZCBlbmQgcG9pbnRzIChiZWZvcmUgY2hlY2tpbmcgaWYgdGhlIGxpbmsgaXRzZWxmIGFscmVhZHkgZXhpc3RzCiAgdGhpcy5jcmVhdGVQbGFjZWhvbGRlclBvcnRhbEVudGl0eShkYXRhLm9HdWlkLCBkYXRhLm9MYXRFNiwgZGF0YS5vTG5nRTYsIGRhdGEudGVhbSk7CiAgdGhpcy5jcmVhdGVQbGFjZWhvbGRlclBvcnRhbEVudGl0eShkYXRhLmRHdWlkLCBkYXRhLmRMYXRFNiwgZGF0YS5kTG5nRTYsIGRhdGEudGVhbSk7CgoKICAvLyBjaGVjayBpZiBlbnRpdHkgYWxyZWFkeSBleGlzdHMKICBpZiAoZW50WzBdIGluIHdpbmRvdy5saW5rcykgewogICAgLy8geWVzLiBub3csIGFzIHNvbWV0aW1lcyBsaW5rcyBhcmUgJ2Zha2VkJywgdGhleSBoYXZlIGluY29tcGxldGUgZGF0YS4gaWYgdGhlIGRhdGEgd2UgaGF2ZSBpcyBiZXR0ZXIsIHJlcGxhY2UgdGhlIGRhdGEKICAgIHZhciBsID0gd2luZG93LmxpbmtzW2VudFswXV07CgogICAgLy8gdGhlIGZha2VkIGRhdGEgd2lsbCBoYXZlIG9sZGVyIHRpbWVzdGFtcHMgdGhhbiByZWFsIGRhdGEgKGN1cnJlbnRseSwgZmFrZWQgc2V0IHRvIHplcm8pCiAgICBpZiAobC5vcHRpb25zLnRpbWVzdGFtcCA+PSBlbnRbMV0pIHJldHVybjsgLy8gdGhpcyBkYXRhIGlzIG9sZGVyIG9yIGlkZW50aWNhbCB0byB0aGUgcmVuZGVyZWQgZGF0YSAtIGFib3J0IHByb2Nlc3NpbmcKCiAgICAvLyB0aGUgZGF0YSBpcyBuZXdlci9iZXR0ZXIgLSB0d28gb3B0aW9ucwogICAgLy8gMS4ganVzdCB1cGRhdGUgdGhlIGRhdGEuIGFzc3VtZSB0aGUgbGluayByZW5kZXIgYXBwZWFyYW5jZSBpcyB1bm1vZGlmaWVkCiAgICAvLyAyLiBkZWxldGUgdGhlIGVudGl0eSwgdGhlbiByZS1jcmVhdGUgaXQgd2l0aCB0aGUgbmV3IGRhdGEKICAgIHRoaXMuZGVsZXRlTGlua0VudGl0eShlbnRbMF0pOyAvLyBvcHRpb24gMiAtIGZvciBub3cKICB9CgogIHZhciB0ZWFtID0gdGVhbVN0cmluZ1RvSWQoZW50WzJdWzFdKTsKICB2YXIgbGF0bG5ncyA9IFsKICAgIEwubGF0TG5nKGRhdGEub0xhdEU2LzFFNiwgZGF0YS5vTG5nRTYvMUU2KSwKICAgIEwubGF0TG5nKGRhdGEuZExhdEU2LzFFNiwgZGF0YS5kTG5nRTYvMUU2KQogIF07CiAgdmFyIHBvbHkgPSBMLmdlb2Rlc2ljUG9seWxpbmUobGF0bG5ncywgewogICAgY29sb3I6IENPTE9SU1t0ZWFtXSwKICAgIG9wYWNpdHk6IDEsCiAgICB3ZWlnaHQ6IGZha2VkID8gMSA6IDIsCiAgICBjbGlja2FibGU6IGZhbHNlLAoKICAgIHRlYW06IHRlYW0sCiAgICBlbnQ6IGVudCwgIC8vIExFR0FDWSAtIFRPIEJFIFJFTU9WRUQgQVQgU09NRSBQT0lOVCEgdXNlIC5ndWlkLCAudGltZXN0YW1wIGFuZCAuZGF0YSBpbnN0ZWFkCiAgICBndWlkOiBlbnRbMF0sCiAgICB0aW1lc3RhbXA6IGVudFsxXSwKICAgIGRhdGE6IGRhdGEKICB9KTsKCiAgcnVuSG9va3MoJ2xpbmtBZGRlZCcsIHtsaW5rOiBwb2x5fSk7CgogIHdpbmRvdy5saW5rc1tlbnRbMF1dID0gcG9seTsKCiAgbGlua3NGYWN0aW9uTGF5ZXJzW3BvbHkub3B0aW9ucy50ZWFtXS5hZGRMYXllcihwb2x5KTsKfQoKCgp3aW5kb3cuUmVuZGVyLnByb3RvdHlwZS5yZXNjYWxlUG9ydGFsTWFya2VycyA9IGZ1bmN0aW9uKCkgewogIGlmICh0aGlzLnBvcnRhbE1hcmtlclNjYWxlID09PSB1bmRlZmluZWQgfHwgdGhpcy5wb3J0YWxNYXJrZXJTY2FsZSAhPSBwb3J0YWxNYXJrZXJTY2FsZSgpKSB7CiAgICB0aGlzLnBvcnRhbE1hcmtlclNjYWxlID0gcG9ydGFsTWFya2VyU2NhbGUoKTsKCiAgICBjb25zb2xlLmxvZygnUmVuZGVyOiBtYXAgem9vbSAnK21hcC5nZXRab29tKCkrJyBjaGFuZ2VzIHBvcnRhbCBzY2FsZSB0byAnK3BvcnRhbE1hcmtlclNjYWxlKCkrJyAtIHJlZHJhd2luZyBhbGwgcG9ydGFscycpOwoKICAgIC8vTk9URTogd2UncmUgbm90IGNhbGxpbmcgdGhpcyBiZWNhdXNlIGl0IHJlc2V0cyBoaWdobGlnaHRzIC0gd2UncmUgY2FsbGluZyBpdCBhcyBpdAogICAgLy8gcmVzZXRzIHRoZSBzdHlsZSAoaW5jIHNpemUpIG9mIGFsbCBwb3J0YWwgbWFya2VycywgYXBwbHlpbmcgdGhlIG5ldyBzY2FsZQogICAgcmVzZXRIaWdobGlnaHRlZFBvcnRhbHMoKTsKICB9Cn0KCgoKLy8gYWRkIHRoZSBwb3J0YWwgdG8gdGhlIHZpc2libGUgbWFwIGxheWVyCndpbmRvdy5SZW5kZXIucHJvdG90eXBlLmFkZFBvcnRhbFRvTWFwTGF5ZXIgPSBmdW5jdGlvbihwb3J0YWwpIHsKICBwb3J0YWxzRmFjdGlvbkxheWVyc1twYXJzZUludChwb3J0YWwub3B0aW9ucy5sZXZlbCl8fDBdW3BvcnRhbC5vcHRpb25zLnRlYW1dLmFkZExheWVyKHBvcnRhbCk7Cn0KCndpbmRvdy5SZW5kZXIucHJvdG90eXBlLnJlbW92ZVBvcnRhbEZyb21NYXBMYXllciA9IGZ1bmN0aW9uKHBvcnRhbCkgewogIC8vcmVtb3ZlIGl0IGZyb20gdGhlIHBvcnRhbHNMZXZlbHMgbGF5ZXIKICBwb3J0YWxzRmFjdGlvbkxheWVyc1twYXJzZUludChwb3J0YWwub3B0aW9ucy5sZXZlbCl8fDBdW3BvcnRhbC5vcHRpb25zLnRlYW1dLnJlbW92ZUxheWVyKHBvcnRhbCk7Cn0KCgoKCjsKCi8vIE1BUCBEQVRBIFJFUVVFU1QgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIGNsYXNzIHRvIHJlcXVlc3QgdGhlIG1hcCBkYXRhIHRpbGVzIGZyb20gdGhlIEluZ3Jlc3Mgc2VydmVycwovLyBhbmQgdGhlbiBwYXNzIGl0IG9uIHRvIHRoZSByZW5kZXIgY2xhc3MgZm9yIGRpc3BsYXkgcHVycG9zZXMKLy8gVXNlcyB0aGUgbWFwIGRhdGEgY2FjaGUgY2xhc3MgdG8gcmVkdWNlIG5ldHdvcmsgcmVxdWVzdHMKCgp3aW5kb3cuTWFwRGF0YVJlcXVlc3QgPSBmdW5jdGlvbigpIHsKICB0aGlzLmNhY2hlID0gbmV3IERhdGFDYWNoZSgpOwogIHRoaXMucmVuZGVyID0gbmV3IFJlbmRlcigpOwogIHRoaXMuZGVidWdUaWxlcyA9IG5ldyBSZW5kZXJEZWJ1Z1RpbGVzKCk7CgogIHRoaXMuYWN0aXZlUmVxdWVzdENvdW50ID0gMDsKICB0aGlzLnJlcXVlc3RlZFRpbGVzID0ge307CgogIHRoaXMucmVuZGVyUXVldWUgPSBbXTsKICB0aGlzLnJlbmRlclF1ZXVlVGltZXIgPSB1bmRlZmluZWQ7CiAgdGhpcy5yZW5kZXJRdWV1ZVBhdXNlZCA9IGZhbHNlOwoKICB0aGlzLmlkbGUgPSBmYWxzZTsKCgogIC8vIG5vIG1vcmUgdGhhbiB0aGlzIG1hbnkgcmVxdWVzdHMgaW4gcGFyYWxsZWwuIHN0b2NrIHNpdGUgc2VlbXMgdG8gcmVseSBvbiBicm93c2VyIGxpbWl0cyAoNiwgdXN1YWxseSksIHNlbmRpbmcKICAvLyBtYW55IHJlcXVlc3RzIGF0IG9uY2UuCiAgLy8gdXNpbmcgb3VyIG93biBxdWV1ZSBsaW1pdCBlbnN1cmVzIHRoYXQgb3RoZXIgcmVxdWVzdHMgKGUuZy4gY2hhdCwgcG9ydGFsIGRldGFpbHMpIGRvbid0IGdldCBkZWxheWVkCiAgdGhpcy5NQVhfUkVRVUVTVFMgPSA1OwoKICAvLyB0aGlzIG1hbnkgdGlsZXMgaW4gb25lIHJlcXVlc3QKICB0aGlzLk5VTV9USUxFU19QRVJfUkVRVUVTVCA9IDI1OwoKICAvLyBudW1iZXIgb2YgdGltZXMgdG8gcmV0cnkgYSB0aWxlIGFmdGVyIGFuIGVycm9yIChpbmNsdWRpbmcgImVycm9yOiBUSU1FT1VUIiBub3cgLSBhcyBzdG9jayBpbnRlbCBkb2VzKQogIC8vIFRPRE8/IGRpZmZlcmVudCByZXRyeSBjb3VudGVycyBmb3IgVElNRU9VVCB2cyBvdGhlciBlcnJvcnMuLj8KICB0aGlzLk1BWF9USUxFX1JFVFJJRVMgPSA1OwoKICAvLyByZWZyZXNoIHRpbWVycwogIHRoaXMuTU9WRV9SRUZSRVNIID0gMzsgLy90aW1lLCBhZnRlciBhIG1hcCBtb3ZlIChwYW4vem9vbSkgYmVmb3JlIHN0YXJ0aW5nIHRoZSByZWZyZXNoIHByb2Nlc3NpbmcKICB0aGlzLlNUQVJUVVBfUkVGUkVTSCA9IDM7IC8vcmVmcmVzaCB0aW1lIHVzZWQgb24gZmlyc3QgbG9hZCBvZiBJSVRDCiAgdGhpcy5JRExFX1JFU1VNRV9SRUZSRVNIID0gNTsgLy9yZWZyZXNoIHRpbWUgdXNlZCBhZnRlciByZXN1bWluZyBmcm9tIGlkbGUKCiAgLy8gYWZ0ZXIgb25lIG9mIHRoZSBhYm92ZSwgdGhlcmUncyBhbiBhZGRpdGlvbmFsIGRlbGF5IGJldHdlZW4gcHJlcGFyaW5nIHRoZSByZWZyZXNoIChjbGVhcmluZyBvdXQgb2YgYm91bmRzLAogIC8vIHByb2Nlc3NpbmcgY2FjaGUsIGV0YykgYW5kIGFjdHVhbGx5IHNlbmRpbmcgdGhlIGZpcnN0IG5ldHdvcmsgcmVxdWVzdHMKICB0aGlzLkRPV05MT0FEX0RFTEFZID0gMTsgIC8vZGVsYXkgYWZ0ZXIgcHJlcGFyaW5nIHRoZSBkYXRhIGRvd25sb2FkIGJlZm9yZSB0aWxlIHJlcXVlc3RzIGFyZSBzZW50CgoKICAvLyBhIHNob3J0IGRlbGF5IGJldHdlZW4gb25lIHJlcXVlc3QgZmluaXNoaW5nIGFuZCB0aGUgcXVldWUgYmVpbmcgcnVuIGZvciB0aGUgbmV4dCByZXF1ZXN0LgogIHRoaXMuUlVOX1FVRVVFX0RFTEFZID0gMDsKCiAgLy8gZGVsYXkgYmVmb3JlIHByb2Nlc3NpbmcgdGhlIHF1ZXVlIGFmdGVyIGZhaWxlZCByZXF1ZXN0cwogIHRoaXMuQkFEX1JFUVVFU1RfUlVOX1FVRVVFX0RFTEFZID0gNTsgLy8gbG9uZ2VyIGRlbGF5IGJlZm9yZSBkb2luZyBhbnl0aGluZyBhZnRlciBlcnJvcnMgKG90aGVyIHRoYW4gVElNRU9VVCkKCiAgLy8gZGVsYXkgYmVmb3JlIHByb2Nlc3NpbmcgdGhlIHF1ZXVlIGFmdGVyIGVtcHR5IHJlc3BvbnNlcwogIHRoaXMuRU1QVFlfUkVTUE9OU0VfUlVOX1FVRVVFX0RFTEFZID0gNTsgLy8gYWxzbyBsb25nIGRlbGF5IC0gZW1wdHkgcmVzcG9uc2VzIGFyZSBsaWtlbHkgZHVlIHRvIHNvbWUgc2VydmVyIGlzc3VlcwoKICAvLyBkZWxheSBiZWZvcmUgcHJvY2Vzc2luZyB0aGUgcXVldWUgYWZ0ZXIgZXJyb3I9PVRJTUVPVVQgcmVxdWVzdHMuIHRoaXMgaXMgJ2V4cGVjdGVkJywgc28gbWluaW1hbCBleHRyYSBkZWxheSBvdmVyIHRoZSByZWd1bGFyIFJVTl9RVUVVRV9ERUxBWQogIHRoaXMuVElNRU9VVF9SRVFVRVNUX1JVTl9RVUVVRV9ERUxBWSA9IDA7CgoKICAvLyByZW5kZXIgcXVldWUKICAvLyBudW1iZXIgb2YgaXRlbXMgdG8gcHJvY2VzcyBpbiBlYWNoIHJlbmRlciBwYXNzLiB0aGVyZSBhcmUgcHJvcyBhbmQgY29ucyB0byBzbWFsbGVyIGFuZCBsYXJnZXIgdmFsdWVzCiAgLy8gKGhvd2V2ZXIsIGlmIHVzaW5nIGxlYWZsZXQgY2FudmFzIHJlbmRlcmluZywgaXQgbWFrZXMgc2Vuc2UgdG8gcHVzaCBhcyBtdWNoIGFzIHBvc3NpYmxlIHRocm91Z2ggZXZlcnkgdGltZSkKICB0aGlzLlJFTkRFUl9CQVRDSF9TSVpFID0gTC5QYXRoLkNBTlZBUyA/IDFFOSA6IDE1MDA7CgogIC8vIGRlbGF5IGJlZm9yZSByZXBlYXRpbmcgdGhlIHJlbmRlciBsb29wLiB0aGlzIGdpdmVzIGEgYmV0dGVyIGNoYW5jZSBmb3IgdXNlciBpbnRlcmFjdGlvbgogIHRoaXMuUkVOREVSX1BBVVNFID0gKHR5cGVvZiBhbmRyb2lkID09PSAndW5kZWZpbmVkJykgPyAwLjEgOiAwLjI7IC8vMTAwbXMgZGVza3RvcCwgMjAwbXMgbW9iaWxlCgoKICB0aGlzLlJFRlJFU0hfQ0xPU0UgPSAzMDA7ICAvLyByZWZyZXNoIHRpbWUgdG8gdXNlIGZvciBjbG9zZSB2aWV3cyB6PjEyIHdoZW4gbm90IGlkbGUgYW5kIG5vdCBtb3ZpbmcKICB0aGlzLlJFRlJFU0hfRkFSID0gOTAwOyAgLy8gcmVmcmVzaCB0aW1lIGZvciBmYXIgdmlld3MgeiA8PSAxMgogIHRoaXMuRkVUQ0hfVE9fUkVGUkVTSF9GQUNUT1IgPSAyOyAgLy9taW51bXVtIHJlZnJlc2ggdGltZSBpcyBiYXNlZCBvbiB0aGUgdGltZSB0byBjb21wbGV0ZSBhIGRhdGEgZmV0Y2gsIHRpbWVzIHRoaXMgdmFsdWUKCiAgLy8gZW5zdXJlIHdlIGhhdmUgc29tZSBpbml0aWFsIG1hcCBzdGF0dXMKICB0aGlzLnNldFN0YXR1cyAoJ3N0YXJ0dXAnLCB1bmRlZmluZWQsIC0xKTsKCiAgLy8gYWRkIGEgcG9ydGFsRGV0YWlsTG9hZGVkIGhvb2ssIHNvIHdlIGNhbiB1c2UgdGhlIGV4dGVuZWVkIGRldGFpbHMgdG8gdXBkYXRlIHBvcnRhbHMgb24gdGhlIG1hcAogIHZhciBfdGhpcyA9IHRoaXM7CiAgYWRkSG9vaygncG9ydGFsRGV0YWlsTG9hZGVkJyxmdW5jdGlvbihkYXRhKXsKICAgIF90aGlzLnJlbmRlci5wcm9jZXNzR2FtZUVudGl0aWVzKFtkYXRhLmVudF0pOwogIH0pOwoKfQoKCndpbmRvdy5NYXBEYXRhUmVxdWVzdC5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbigpIHsKICB2YXIgc2F2ZWRDb250ZXh0ID0gdGhpczsKCiAgLy8gc2V0dXAgaWRsZSByZXN1bWUgZnVuY3Rpb24KICB3aW5kb3cuYWRkUmVzdW1lRnVuY3Rpb24gKCBmdW5jdGlvbigpIHsgc2F2ZWRDb250ZXh0LmlkbGVSZXN1bWUoKTsgfSApOwoKICAvLyBhbmQgbWFwIG1vdmUgc3RhcnQvZW5kIGNhbGxiYWNrcwogIHdpbmRvdy5tYXAub24oJ21vdmVzdGFydCcsIHRoaXMubWFwTW92ZVN0YXJ0LCB0aGlzKTsKICB3aW5kb3cubWFwLm9uKCdtb3ZlZW5kJywgdGhpcy5tYXBNb3ZlRW5kLCB0aGlzKTsKCgogIC8vIHRoZW4gc2V0IGEgdGltZW91dCB0byBzdGFydCB0aGUgZmlyc3QgcmVmcmVzaAogIHRoaXMucmVmcmVzaE9uVGltZW91dCAodGhpcy5TVEFSVFVQX1JFRlJFU0gpOwogIHRoaXMuc2V0U3RhdHVzICgncmVmcmVzaGluZycsIHVuZGVmaW5lZCwgLTEpOwoKICB0aGlzLmNhY2hlICYmIHRoaXMuY2FjaGUuc3RhcnRFeHBpcmVJbnRlcnZhbCAoMTUpOwp9CgoKd2luZG93Lk1hcERhdGFSZXF1ZXN0LnByb3RvdHlwZS5tYXBNb3ZlU3RhcnQgPSBmdW5jdGlvbigpIHsKICBjb25zb2xlLmxvZygncmVmcmVzaCBtYXAgbW92ZXN0YXJ0Jyk7CgogIHRoaXMuc2V0U3RhdHVzKCdwYXVzZWQnKTsKICB0aGlzLmNsZWFyVGltZW91dCgpOwogIHRoaXMucGF1c2VSZW5kZXJRdWV1ZSh0cnVlKTsKfQoKd2luZG93Lk1hcERhdGFSZXF1ZXN0LnByb3RvdHlwZS5tYXBNb3ZlRW5kID0gZnVuY3Rpb24oKSB7CiAgdmFyIGJvdW5kcyA9IGNsYW1wTGF0TG5nQm91bmRzKG1hcC5nZXRCb3VuZHMoKSk7CiAgdmFyIHpvb20gPSBtYXAuZ2V0Wm9vbSgpOwoKICBpZiAodGhpcy5mZXRjaGVkRGF0YVBhcmFtcykgewogICAgLy8gd2UgaGF2ZSBmZXRjaGVkIChvciBhcmUgZmV0Y2hpbmcpIGRhdGEuLi4KICAgIGlmICh0aGlzLmZldGNoZWREYXRhUGFyYW1zLm1hcFpvb20gPT0gbWFwLmdldFpvb20oKSAmJiB0aGlzLmZldGNoZWREYXRhUGFyYW1zLmJvdW5kcy5jb250YWlucyhib3VuZHMpKSB7CiAgICAgIC8vIC4uLiBhbmQgdGhlIHpvb20gbGV2ZWwgaXMgdGhlIHNhbWUgYW5kIHRoZSBjdXJyZW50IGJvdW5kcyBpcyBpbnNpZGUgdGhlIGZldGNoZWQgYm91bmRzCiAgICAgIC8vIHNvLCBubyBuZWVkIHRvIGZldGNoIGRhdGEuIGlmIHRoZXJlJ3MgdGltZSBsZWZ0LCByZXN0b3JlIHRoZSBvcmlnaW5hbCB0aW1lb3V0CgogICAgICB2YXIgcmVtYWluaW5nVGltZSA9ICh0aGlzLnRpbWVyRXhwZWN0ZWRUaW1lb3V0VGltZSAtIG5ldyBEYXRlKCkuZ2V0VGltZSgpKS8xMDAwOwoKICAgICAgaWYgKHJlbWFpbmluZ1RpbWUgPiB0aGlzLk1PVkVfUkVGUkVTSCkgewogICAgICAgIHRoaXMuc2V0U3RhdHVzKCdkb25lJywnTWFwIG1vdmVkLCBidXQgbm8gZGF0YSB1cGRhdGVzIG5lZWRlZCcpOwogICAgICAgIHRoaXMucmVmcmVzaE9uVGltZW91dChyZW1haW5pbmdUaW1lKTsKICAgICAgICB0aGlzLnBhdXNlUmVuZGVyUXVldWUoZmFsc2UpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogIH0KCiAgdGhpcy5zZXRTdGF0dXMoJ3JlZnJlc2hpbmcnLCB1bmRlZmluZWQsIC0xKTsKICB0aGlzLnJlZnJlc2hPblRpbWVvdXQodGhpcy5NT1ZFX1JFRlJFU0gpOwp9Cgp3aW5kb3cuTWFwRGF0YVJlcXVlc3QucHJvdG90eXBlLmlkbGVSZXN1bWUgPSBmdW5jdGlvbigpIHsKICAvLyBpZiB3ZSBoYXZlIG5vIHRpbWVyIHNldCBhbmQgdGhlcmUgYXJlIG5vIGFjdGl2ZSByZXF1ZXN0cywgcmVmcmVzaCBoYXMgZ29uZSBpZGxlIGFuZCB0aGUgdGltZXIgbmVlZHMgcmVzdGFydGluZwoKICBpZiAodGhpcy5pZGxlKSB7CiAgICBjb25zb2xlLmxvZygncmVmcmVzaCBtYXAgaWRsZSByZXN1bWUnKTsKICAgIHRoaXMuaWRsZSA9IGZhbHNlOwogICAgdGhpcy5zZXRTdGF0dXMoJ2lkbGUgcmVzdGFydCcsIHVuZGVmaW5lZCwgLTEpOwogICAgdGhpcy5yZWZyZXNoT25UaW1lb3V0KHRoaXMuSURMRV9SRVNVTUVfUkVGUkVTSCk7CiAgfQp9CgoKd2luZG93Lk1hcERhdGFSZXF1ZXN0LnByb3RvdHlwZS5jbGVhclRpbWVvdXQgPSBmdW5jdGlvbigpIHsKCiAgaWYgKHRoaXMudGltZXIpIHsKICAgIGNvbnNvbGUubG9nKCdjYW5jZWxsaW5nIGV4aXN0aW5nIG1hcCByZWZyZXNoIHRpbWVyJyk7CiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7CiAgICB0aGlzLnRpbWVyID0gdW5kZWZpbmVkOwogIH0KfQoKd2luZG93Lk1hcERhdGFSZXF1ZXN0LnByb3RvdHlwZS5yZWZyZXNoT25UaW1lb3V0ID0gZnVuY3Rpb24oc2Vjb25kcykgewogIHRoaXMuY2xlYXJUaW1lb3V0KCk7CgogIGNvbnNvbGUubG9nKCdzdGFydGluZyBtYXAgcmVmcmVzaCBpbiAnK3NlY29uZHMrJyBzZWNvbmRzJyk7CgogIC8vICd0aGlzJyB3b24ndCBiZSByaWdodCBpbnNpZGUgdGhlIGNhbGxiYWNrLCBzbyBzYXZlIGl0CiAgLy8gYWxzbywgZG91YmxlIHNldFRpbWVvdXQgdXNlZCB0byBlbnN1cmUgdGhlIGRlbGF5IG9jY3VycyBhZnRlciBhbnkgYnJvd3Nlci1yZWxhdGVkIHJlbmRlcmluZy91cGRhdGluZy9ldGMKICB2YXIgX3RoaXMgPSB0aGlzOwogIHRoaXMudGltZXIgPSBzZXRUaW1lb3V0ICggZnVuY3Rpb24oKSB7CiAgICBfdGhpcy50aW1lciA9IHNldFRpbWVvdXQgKCBmdW5jdGlvbigpIHsgX3RoaXMudGltZXIgPSB1bmRlZmluZWQ7IF90aGlzLnJlZnJlc2goKTsgfSwgc2Vjb25kcyoxMDAwKTsKICB9LCAwKTsKICB0aGlzLnRpbWVyRXhwZWN0ZWRUaW1lb3V0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgc2Vjb25kcyoxMDAwOwp9CgoKd2luZG93Lk1hcERhdGFSZXF1ZXN0LnByb3RvdHlwZS5zZXRTdGF0dXMgPSBmdW5jdGlvbihzaG9ydCxsb25nLHByb2dyZXNzKSB7CiAgdGhpcy5zdGF0dXMgPSB7IHNob3J0OiBzaG9ydCwgbG9uZzogbG9uZywgcHJvZ3Jlc3M6IHByb2dyZXNzIH07CiAgd2luZG93LnJlbmRlclVwZGF0ZVN0YXR1cygpOwp9CgoKd2luZG93Lk1hcERhdGFSZXF1ZXN0LnByb3RvdHlwZS5nZXRTdGF0dXMgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5zdGF0dXM7Cn07CgoKd2luZG93Lk1hcERhdGFSZXF1ZXN0LnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24oKSB7CgogIC8vIGlmIHdlJ3JlIGlkbGUsIGRvbid0IHJlZnJlc2gKICBpZiAod2luZG93LmlzSWRsZSgpKSB7CiAgICBjb25zb2xlLmxvZygnc3VzcGVuZGluZyBtYXAgcmVmcmVzaCAtIGlzIGlkbGUnKTsKICAgIHRoaXMuc2V0U3RhdHVzICgnaWRsZScpOwogICAgdGhpcy5pZGxlID0gdHJ1ZTsKICAgIHJldHVybjsKICB9CgogIC8vdGltZSB0aGUgcmVmcmVzaCBjeWNsZQogIHRoaXMucmVmcmVzaFN0YXJ0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwoKICB0aGlzLmRlYnVnVGlsZXMucmVzZXQoKTsKICB0aGlzLnJlc2V0UmVuZGVyUXVldWUoKTsKCiAgLy8gYSAnc2V0JyB0byBrZWVwIHRyYWNrIG9mIGhhcmQgZmFpbHVyZXMgZm9yIHRpbGVzCiAgdGhpcy50aWxlRXJyb3JDb3VudCA9IHt9OwoKICAvLyB0aGUgJ3NldCcgb2YgcmVxdWVzdGVkIHRpbGUgUUtzCiAgLy8gTk9URTogamF2YXNjcmlwdCBkb2VzIG5vdCBndWFyYW50ZWUgYW55IG9yZGVyIHRvIHByb3BlcnRpZXMgb2YgYW4gb2JqZWN0LiBob3dldmVyLCBpbiBhbGwgbWFqb3IgaW1wbGVtZW50YXRpb25zCiAgLy8gcHJvcGVydGllcyByZXRhaW4gdGhlIG9yZGVyIHRoZXkgYXJlIGFkZGVkIGluLiBJSVRDIHVzZXMgdGhpcyB0byBjb250cm9sIHRoZSB0aWxlIGZldGNoIG9yZGVyLiBpZiBicm93c2VycyBjaGFuZ2UKICAvLyB0aGVuIGZldGNoIG9yZGVyIGlzbid0IG9wdGltYWwsIGJ1dCBpdCB3b24ndCBicmVhayB0aGluZ3MuCiAgdGhpcy5xdWV1ZWRUaWxlcyA9IHt9OwoKCiAgdmFyIGJvdW5kcyA9IGNsYW1wTGF0TG5nQm91bmRzKG1hcC5nZXRCb3VuZHMoKSk7CiAgdmFyIG1hcFpvb20gPSBtYXAuZ2V0Wm9vbSgpOwoKICB2YXIgZGF0YVpvb20gPSBnZXREYXRhWm9vbUZvck1hcFpvb20obWFwWm9vbSk7CgogIHZhciB0aWxlUGFyYW1zID0gZ2V0TWFwWm9vbVRpbGVQYXJhbWV0ZXJzKGRhdGFab29tKTsKCgovL0RFQlVHOiByZXNpemUgdGhlIGJvdW5kcyBzbyB3ZSBvbmx5IHJldHJpZXZlIHNvbWUgZGF0YQovL2JvdW5kcyA9IGJvdW5kcy5wYWQoLTAuNCk7CgovL3ZhciBkZWJ1Z3JlY3QgPSBMLnJlY3RhbmdsZShib3VuZHMse2NvbG9yOiAncmVkJywgZmlsbDogZmFsc2UsIHdlaWdodDogNCwgb3BhY2l0eTogMC44fSkuYWRkVG8obWFwKTsKLy9zZXRUaW1lb3V0IChmdW5jdGlvbigpeyBtYXAucmVtb3ZlTGF5ZXIoZGVidWdyZWN0KTsgfSwgMTAqMTAwMCk7CgogIHZhciB4MSA9IGxuZ1RvVGlsZShib3VuZHMuZ2V0V2VzdCgpLCB0aWxlUGFyYW1zKTsKICB2YXIgeDIgPSBsbmdUb1RpbGUoYm91bmRzLmdldEVhc3QoKSwgdGlsZVBhcmFtcyk7CiAgdmFyIHkxID0gbGF0VG9UaWxlKGJvdW5kcy5nZXROb3J0aCgpLCB0aWxlUGFyYW1zKTsKICB2YXIgeTIgPSBsYXRUb1RpbGUoYm91bmRzLmdldFNvdXRoKCksIHRpbGVQYXJhbXMpOwoKICAvLyBjYWxjdWxhdGUgdGhlIGZ1bGwgYm91bmRzIGZvciB0aGUgZGF0YSAtIGluY2x1ZGluZyB0aGUgcGFydCBvZiB0aGUgdGlsZXMgb2ZmIHRoZSBzY3JlZW4gZWRnZQogIHZhciBkYXRhQm91bmRzID0gTC5sYXRMbmdCb3VuZHMoWwogICAgW3RpbGVUb0xhdCh5MisxLHRpbGVQYXJhbXMpLCB0aWxlVG9MbmcoeDEsdGlsZVBhcmFtcyldLAogICAgW3RpbGVUb0xhdCh5MSx0aWxlUGFyYW1zKSwgdGlsZVRvTG5nKHgyKzEsdGlsZVBhcmFtcyldCiAgXSk7Ci8vdmFyIGRlYnVncmVjdDIgPSBMLnJlY3RhbmdsZShkYXRhQm91bmRzLHtjb2xvcjogJ21hZ2VudGEnLCBmaWxsOiBmYWxzZSwgd2VpZ2h0OiA0LCBvcGFjaXR5OiAwLjh9KS5hZGRUbyhtYXApOwovL3NldFRpbWVvdXQgKGZ1bmN0aW9uKCl7IG1hcC5yZW1vdmVMYXllcihkZWJ1Z3JlY3QyKTsgfSwgMTAqMTAwMCk7CgogIC8vIHN0b3JlIHRoZSBwYXJhbWV0ZXJzIHVzZWQgZm9yIGZldGNoaW5nIHRoZSBkYXRhLiB1c2VkIHRvIHByZXZlbnQgdW5uZWVkZWQgcmVmcmVzaGVzIGFmdGVyIG1vdmUvem9vbQogIHRoaXMuZmV0Y2hlZERhdGFQYXJhbXMgPSB7IGJvdW5kczogZGF0YUJvdW5kcywgbWFwWm9vbTogbWFwWm9vbSwgZGF0YVpvb206IGRhdGFab29tIH07CgoKICB3aW5kb3cucnVuSG9va3MgKCdtYXBEYXRhUmVmcmVzaFN0YXJ0Jywge2JvdW5kczogYm91bmRzLCBtYXBab29tOiBtYXBab29tLCBkYXRhWm9vbTogZGF0YVpvb20sIG1pblBvcnRhbExldmVsOiB0aWxlUGFyYW1zLmxldmVsLCB0aWxlQm91bmRzOiBkYXRhQm91bmRzfSk7CgogIHRoaXMucmVuZGVyLnN0YXJ0UmVuZGVyUGFzcyh0aWxlUGFyYW1zLmxldmVsLCBkYXRhQm91bmRzKTsKCiAgdmFyIF9yZW5kZXIgPSB0aGlzLnJlbmRlcjsKICB3aW5kb3cucnVuSG9va3MgKCdtYXBEYXRhRW50aXR5SW5qZWN0Jywge2NhbGxiYWNrOiBmdW5jdGlvbihlbnRzKSB7IF9yZW5kZXIucHJvY2Vzc0dhbWVFbnRpdGllcyhlbnRzKTt9fSk7CgoKICB0aGlzLnJlbmRlci5wcm9jZXNzR2FtZUVudGl0aWVzKGFydGlmYWN0LmdldEFydGlmYWN0RW50aXRpZXMoKSk7CgogIHZhciBsb2dNZXNzYWdlID0gJ3JlcXVlc3RpbmcgZGF0YSB0aWxlcyBhdCB6b29tICcrZGF0YVpvb207CiAgaWYgKHRpbGVQYXJhbXMubGV2ZWwgIT0gdGlsZVBhcmFtcy5tYXhMZXZlbCkgewogICAgbG9nTWVzc2FnZSArPSAnIChMJyt0aWxlUGFyYW1zLmxldmVsKycrIHBvcnRhbHMgLSBjb3VsZCBoYXZlIGRvbmUgTCcrdGlsZVBhcmFtcy5tYXhMZXZlbCsnKyc7CiAgfSBlbHNlIHsKICAgIGxvZ01lc3NhZ2UgKz0gJyAoTCcrdGlsZVBhcmFtcy5sZXZlbCsnKyBwb3J0YWxzJzsKICB9CiAgbG9nTWVzc2FnZSArPSAnLCAnK3RpbGVQYXJhbXMudGlsZXNQZXJFZGdlKycgdGlsZXMgcGVyIGdsb2JhbCBlZGdlKSwgbWFwIHpvb20gaXMgJyttYXBab29tOwoKICBjb25zb2xlLmxvZyhsb2dNZXNzYWdlKTsKCgogIHRoaXMuY2FjaGVkVGlsZUNvdW50ID0gMDsKICB0aGlzLnJlcXVlc3RlZFRpbGVDb3VudCA9IDA7CiAgdGhpcy5zdWNjZXNzVGlsZUNvdW50ID0gMDsKICB0aGlzLmZhaWxlZFRpbGVDb3VudCA9IDA7CiAgdGhpcy5zdGFsZVRpbGVDb3VudCA9IDA7CgogIHZhciB0aWxlc1RvRmV0Y2hEaXN0YW5jZSA9IHt9OwoKICAvLyBtYXAgY2VudGVyIHBvaW50IC0gZm9yIGZldGNoaW5nIGNlbnRlciB0aWxlcyBmaXJzdAogIHZhciBtYXBDZW50ZXJQb2ludCA9IG1hcC5wcm9qZWN0KG1hcC5nZXRDZW50ZXIoKSwgbWFwWm9vbSk7CgogIC8vIHkgZ29lcyBmcm9tIGxlZnQgdG8gcmlnaHQKICBmb3IgKHZhciB5ID0geTE7IHkgPD0geTI7IHkrKykgewogICAgLy8geCBnb2VzIGZyb20gYm90dG9tIHRvIHRvcCg/KQogICAgZm9yICh2YXIgeCA9IHgxOyB4IDw9IHgyOyB4KyspIHsKICAgICAgdmFyIHRpbGVfaWQgPSBwb2ludFRvVGlsZUlkKHRpbGVQYXJhbXMsIHgsIHkpOwogICAgICB2YXIgbGF0Tm9ydGggPSB0aWxlVG9MYXQoeSx0aWxlUGFyYW1zKTsKICAgICAgdmFyIGxhdFNvdXRoID0gdGlsZVRvTGF0KHkrMSx0aWxlUGFyYW1zKTsKICAgICAgdmFyIGxuZ1dlc3QgPSB0aWxlVG9MbmcoeCx0aWxlUGFyYW1zKTsKICAgICAgdmFyIGxuZ0Vhc3QgPSB0aWxlVG9MbmcoeCsxLHRpbGVQYXJhbXMpOwoKICAgICAgdGhpcy5kZWJ1Z1RpbGVzLmNyZWF0ZSh0aWxlX2lkLFtbbGF0U291dGgsbG5nV2VzdF0sW2xhdE5vcnRoLGxuZ0Vhc3RdXSk7CgovL1RPRE86IHdpdGggcmVjZW50IGJhY2tlbmQgY2hhbmdlcyB0aGVyZSBhcmUgbm93IG11bHRpcGxlIHpvb20gbGV2ZWxzIG9mIGRhdGEgdGhhdCBpcyBpZGVudGljYWwgZXhjZXB0IHBlcmhhcHMgZm9yIHNvbWUKLy8gcmVkdWN0aW9uIG9mIGRldGFpbCB3aGVuIHpvb21lZCBvdXQuIHRvIHRha2UgZ29vZCBhZHZhbnRhZ2Ugb2YgdGhlIGNhY2hlLCBhIGNoZWNrIGZvciBjYWNoZWQgZGF0YSBhdCBhIGNsb3NlciB6b29tCi8vIGJ1dCBvdGhlcndpc2UgdGhlIHNhbWUgcGFyYW1ldGVycyAobWluIHBvcnRhbCBsZXZlbCwgdGlsZXMgcGVyIGVkZ2UpIHdpbGwgbWVhbiBsZXNzIGRvd25sb2FkcyB3aGVuIHpvb21pbmcgb3V0Ci8vIChob3dldmVyLCB0aGUgZGVmYXVsdCBjb2RlIGluIGdldERhdGFab29tRm9yTWFwWm9vbSBjdXJyZW50bHkgcmVkdWNlcyB0aGUgbmVlZCBmb3IgdGhpcywgYXMgaXQgZm9yY2VzIHRoZSBmdXJ0aGVzdCAKLy8gIG91dCB6b29tIHRpbGVzIGZvciBhIGRldGFpbCBsZXZlbCkKICAgICAgaWYgKHRoaXMuY2FjaGUgJiYgdGhpcy5jYWNoZS5pc0ZyZXNoKHRpbGVfaWQpICkgewogICAgICAgIC8vIGRhdGEgaXMgZnJlc2ggaW4gdGhlIGNhY2hlIC0ganVzdCByZW5kZXIgaXQKICAgICAgICB0aGlzLnB1c2hSZW5kZXJRdWV1ZSh0aWxlX2lkLHRoaXMuY2FjaGUuZ2V0KHRpbGVfaWQpLCdjYWNoZS1mcmVzaCcpOwogICAgICAgIHRoaXMuY2FjaGVkVGlsZUNvdW50ICs9IDE7CiAgICAgIH0gZWxzZSB7CgogICAgICAgIC8vIG5vIGZyZXNoIGRhdGEKCiAgICAgICAgLy8gdGlsZSBuZWVkZWQuIGNhbGN1bGF0ZSB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgY2VudHJlIG9mIHRoZSBzY3JlZW4sIHRvIG9wdGltaXNlIHRoZSBsb2FkIG9yZGVyCgogICAgICAgIHZhciBsYXRDZW50ZXIgPSAobGF0Tm9ydGgrbGF0U291dGgpLzI7CiAgICAgICAgdmFyIGxuZ0NlbnRlciA9IChsbmdFYXN0K2xuZ1dlc3QpLzI7CiAgICAgICAgdmFyIHRpbGVMYXRMbmcgPSBMLmxhdExuZyhsYXRDZW50ZXIsbG5nQ2VudGVyKTsKCiAgICAgICAgdmFyIHRpbGVQb2ludCA9IG1hcC5wcm9qZWN0KHRpbGVMYXRMbmcsIG1hcFpvb20pOwoKICAgICAgICB2YXIgZGVsdGEgPSBtYXBDZW50ZXJQb2ludC5zdWJ0cmFjdCh0aWxlUG9pbnQpOwogICAgICAgIHZhciBkaXN0YW5jZVNxdWFyZWQgPSBkZWx0YS54KmRlbHRhLnggKyBkZWx0YS55KmRlbHRhLnk7CgogICAgICAgIHRpbGVzVG9GZXRjaERpc3RhbmNlW3RpbGVfaWRdID0gZGlzdGFuY2VTcXVhcmVkOwogICAgICAgIHRoaXMucmVxdWVzdGVkVGlsZUNvdW50ICs9IDE7CiAgICAgIH0KICAgIH0KICB9CgogIC8vIHJlLW9yZGVyIHRoZSB0aWxlIGxpc3QgYnkgZGlzdGFuY2UgZnJvbSB0aGUgY2VudHJlIG9mIHRoZSBzY3JlZW4uIHRoaXMgc2hvdWxkIGxvYWQgbW9yZSByZWxldmFudCBkYXRhIGZpcnN0CiAgdmFyIHRpbGVzVG9GZXRjaCA9IE9iamVjdC5rZXlzKHRpbGVzVG9GZXRjaERpc3RhbmNlKTsKICB0aWxlc1RvRmV0Y2guc29ydChmdW5jdGlvbihhLGIpIHsKICAgIHJldHVybiB0aWxlc1RvRmV0Y2hEaXN0YW5jZVthXS10aWxlc1RvRmV0Y2hEaXN0YW5jZVtiXTsKICB9KTsKCiAgZm9yICh2YXIgaSBpbiB0aWxlc1RvRmV0Y2gpIHsKICAgIHZhciBxayA9IHRpbGVzVG9GZXRjaFtpXTsKCiAgICB0aGlzLnF1ZXVlZFRpbGVzW3FrXSA9IHFrOwogIH0KCgoKICB0aGlzLnNldFN0YXR1cyAoJ2xvYWRpbmcnLCB1bmRlZmluZWQsIC0xKTsKCiAgLy8gdGVjaG5pY2FsbHkgYSByZXF1ZXN0IGhhc24ndCBhY3R1YWxseSBmaW5pc2hlZCAtIGhvd2V2ZXIsIGRpc3BsYXllZCBwb3J0YWwgZGF0YSBoYXMgYmVlbiByZWZyZXNoZWQKICAvLyBzbyBhcyBmYXIgYXMgcGx1Z2lucyBhcmUgY29uY2VybmVkLCBpdCBzaG91bGQgYmUgdHJlYXRlZCBhcyBhIGZpbmlzaGVkIHJlcXVlc3QKICB3aW5kb3cucnVuSG9va3MoJ3JlcXVlc3RGaW5pc2hlZCcsIHtzdWNjZXNzOiB0cnVlfSk7CgogIGNvbnNvbGUubG9nICgnZG9uZSByZXF1ZXN0IHByZXBhcmF0aW9uIChjbGVhcmVkIG91dC1vZi1ib3VuZHMgYW5kIGludmFsaWQgZm9yIHpvb20sIGFuZCByZW5kZXJlZCBjYWNoZWQgZGF0YSknKTsKCiAgaWYgKE9iamVjdC5rZXlzKHRoaXMucXVldWVkVGlsZXMpLmxlbmd0aCA+IDApIHsKICAgIC8vIHF1ZXVlZCByZXF1ZXN0cyAtIGRvbid0IHN0YXJ0IHByb2Nlc3NpbmcgdGhlIGRvd25sb2FkIHF1ZXVlIGltbWVkaWF0ZWx5IC0gc3RhcnQgaXQgYWZ0ZXIgYSBzaG9ydCBkZWxheQogICAgdGhpcy5kZWxheVByb2Nlc3NSZXF1ZXN0UXVldWUgKHRoaXMuRE9XTkxPQURfREVMQVksdHJ1ZSk7CiAgfSBlbHNlIHsKICAgIC8vIGFsbCBkYXRhIHdhcyBmcm9tIHRoZSBjYWNoZSwgbm90aGluZyBxdWV1ZWQgLSBydW4gdGhlIHF1ZXVlICdpbW1lZGlhdGVseScgc28gaXQgaGFuZGxlcyB0aGUgZW5kIHJlcXVlc3QgcHJvY2Vzc2luZwogICAgdGhpcy5kZWxheVByb2Nlc3NSZXF1ZXN0UXVldWUgKDAsdHJ1ZSk7CiAgfQp9CgoKd2luZG93Lk1hcERhdGFSZXF1ZXN0LnByb3RvdHlwZS5kZWxheVByb2Nlc3NSZXF1ZXN0UXVldWUgPSBmdW5jdGlvbihzZWNvbmRzLGlzRmlyc3QpIHsKICBpZiAodGhpcy50aW1lciA9PT0gdW5kZWZpbmVkKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgdGhpcy50aW1lciA9IHNldFRpbWVvdXQgKCBmdW5jdGlvbigpIHsKICAgICAgX3RoaXMudGltZXIgPSBzZXRUaW1lb3V0ICggZnVuY3Rpb24oKSB7IF90aGlzLnRpbWVyID0gdW5kZWZpbmVkOyBfdGhpcy5wcm9jZXNzUmVxdWVzdFF1ZXVlKGlzRmlyc3QpOyB9LCBzZWNvbmRzKjEwMDAgKTsKICAgIH0sIDApOwogIH0KfQoKCndpbmRvdy5NYXBEYXRhUmVxdWVzdC5wcm90b3R5cGUucHJvY2Vzc1JlcXVlc3RRdWV1ZSA9IGZ1bmN0aW9uKGlzRmlyc3RQYXNzKSB7CgogIC8vIGlmIG5vdGhpbmcgbGVmdCBpbiB0aGUgcXVldWUsIGZpbmlzaAogIGlmIChPYmplY3Qua2V5cyh0aGlzLnF1ZXVlZFRpbGVzKS5sZW5ndGggPT0gMCkgewogICAgLy8gd2UgbGVhdmUgdGhlIHJlbmRlclF1ZXVlIGNvZGUgdG8gaGFuZGxlIGVuZGluZyB0aGUgcmVuZGVyIHBhc3Mgbm93CiAgICAvLyAoYnV0IHdlIG5lZWQgdG8gbWFrZSBzdXJlIGl0J3Mgbm90IGxlZnQgd2l0aG91dCBpdCdzIHRpbWVyIHJ1bm5pbmchKQogICAgaWYgKCF0aGlzLnJlbmRlclF1ZXVlUGF1c2VkKSB7CiAgICAgIHRoaXMuc3RhcnRRdWV1ZVRpbWVyKHRoaXMuUkVOREVSX1BBVVNFKTsKICAgIH0KCiAgICByZXR1cm47CiAgfQoKCiAgLy8gY3JlYXRlIGEgbGlzdCBvZiB0aWxlcyB0aGF0IGFyZW4ndCByZXF1ZXN0ZWQgb3ZlciB0aGUgbmV0d29yawogIHZhciBwZW5kaW5nVGlsZXMgPSBbXTsKICBmb3IgKHZhciBpZCBpbiB0aGlzLnF1ZXVlZFRpbGVzKSB7CiAgICBpZiAoIShpZCBpbiB0aGlzLnJlcXVlc3RlZFRpbGVzKSApIHsKICAgICAgcGVuZGluZ1RpbGVzLnB1c2goaWQpOwogICAgfQogIH0KCi8vICBjb25zb2xlLmxvZygnLSByZXF1ZXN0IHN0YXRlOiAnK09iamVjdC5rZXlzKHRoaXMucmVxdWVzdGVkVGlsZXMpLmxlbmd0aCsnIHRpbGVzIGluICcrdGhpcy5hY3RpdmVSZXF1ZXN0Q291bnQrJyBhY3RpdmUgcmVxdWVzdHMsICcrcGVuZGluZ1RpbGVzLmxlbmd0aCsnIHRpbGVzIHF1ZXVlZCcpOwoKICB2YXIgcmVxdWVzdEJ1Y2tldHMgPSB0aGlzLk1BWF9SRVFVRVNUUyAtIHRoaXMuYWN0aXZlUmVxdWVzdENvdW50OwogIGlmIChwZW5kaW5nVGlsZXMubGVuZ3RoID4gMCAmJiByZXF1ZXN0QnVja2V0cyA+IDApIHsKCiAgICBmb3IgKHZhciBidWNrZXQ9MDsgYnVja2V0IDwgcmVxdWVzdEJ1Y2tldHM7IGJ1Y2tldCsrKSB7CgogICAgICAvLyBpZiB0aGUgdGlsZXMgZm9yIHRoaXMgcmVxdWVzdCBoYXZlIGhhZCBzZXZlcmFsIHJldHJpZXMsIHVzZSBzbWFsbGVyIHJlcXVlc3RzCiAgICAgIC8vIG1heWJlIHNvbWUgb2YgdGhlIHRpbGVzIGNhdXNlZCBhbGwgdGhlIG90aGVycyB0byBlcnJvcj8gbm8gaGFybSBhbnl3YXksIGFuZCBpdCBtYXkgaGVscC4uLgogICAgICB2YXIgbnVtVGlsZXNUaGlzUmVxdWVzdCA9IE1hdGgubWluKHRoaXMuTlVNX1RJTEVTX1BFUl9SRVFVRVNULHBlbmRpbmdUaWxlcy5sZW5ndGgpOwoKICAgICAgdmFyIGlkID0gcGVuZGluZ1RpbGVzWzBdOwogICAgICB2YXIgcmV0cnlUb3RhbCA9ICh0aGlzLnRpbGVFcnJvckNvdW50W2lkXXx8MCk7CiAgICAgIGZvciAodmFyIGk9MTsgaTxudW1UaWxlc1RoaXNSZXF1ZXN0OyBpKyspIHsKICAgICAgICBpZCA9IHBlbmRpbmdUaWxlc1tpXTsKICAgICAgICByZXRyeVRvdGFsICs9ICh0aGlzLnRpbGVFcnJvckNvdW50W2lkXXx8MCk7CiAgICAgICAgaWYgKHJldHJ5VG90YWwgPiB0aGlzLk1BWF9USUxFX1JFVFJJRVMpIHsKICAgICAgICAgIG51bVRpbGVzVGhpc1JlcXVlc3QgPSBpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgdGlsZXMgPSBwZW5kaW5nVGlsZXMuc3BsaWNlKDAsIG51bVRpbGVzVGhpc1JlcXVlc3QpOwogICAgICBpZiAodGlsZXMubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMuc2VuZFRpbGVSZXF1ZXN0KHRpbGVzKTsKICAgICAgfQogICAgfQoKICB9CgoKICAvLyB1cGRhdGUgc3RhdHVzCiAgdmFyIHBlbmRpbmdUaWxlQ291bnQgPSB0aGlzLnJlcXVlc3RlZFRpbGVDb3VudCAtICh0aGlzLnN1Y2Nlc3NUaWxlQ291bnQrdGhpcy5mYWlsZWRUaWxlQ291bnQrdGhpcy5zdGFsZVRpbGVDb3VudCk7CiAgdmFyIGxvbmdUZXh0ID0gJ1RpbGVzOiAnICsgdGhpcy5jYWNoZWRUaWxlQ291bnQgKyAnIGNhY2hlZCwgJyArCiAgICAgICAgICAgICAgICAgdGhpcy5zdWNjZXNzVGlsZUNvdW50ICsgJyBsb2FkZWQsICcgKwogICAgICAgICAgICAgICAgICh0aGlzLnN0YWxlVGlsZUNvdW50ID8gdGhpcy5zdGFsZVRpbGVDb3VudCArICcgc3RhbGUsICcgOiAnJykgKwogICAgICAgICAgICAgICAgICh0aGlzLmZhaWxlZFRpbGVDb3VudCA/IHRoaXMuZmFpbGVkVGlsZUNvdW50ICsgJyBmYWlsZWQsICcgOiAnJykgKwogICAgICAgICAgICAgICAgIHBlbmRpbmdUaWxlQ291bnQgKyAnIHJlbWFpbmluZyc7CgogIHByb2dyZXNzID0gdGhpcy5yZXF1ZXN0ZWRUaWxlQ291bnQgPiAwID8gKHRoaXMucmVxdWVzdGVkVGlsZUNvdW50LXBlbmRpbmdUaWxlQ291bnQpIC8gdGhpcy5yZXF1ZXN0ZWRUaWxlQ291bnQgOiB1bmRlZmluZWQ7CiAgdGhpcy5zZXRTdGF0dXMgKCdsb2FkaW5nJywgbG9uZ1RleHQsIHByb2dyZXNzKTsKfQoKCndpbmRvdy5NYXBEYXRhUmVxdWVzdC5wcm90b3R5cGUuc2VuZFRpbGVSZXF1ZXN0ID0gZnVuY3Rpb24odGlsZXMpIHsKCiAgdmFyIHRpbGVzTGlzdCA9IFtdOwoKICBmb3IgKHZhciBpIGluIHRpbGVzKSB7CiAgICB2YXIgaWQgPSB0aWxlc1tpXTsKCiAgICB0aGlzLmRlYnVnVGlsZXMuc2V0U3RhdGUgKGlkLCAncmVxdWVzdGVkJyk7CgogICAgdGhpcy5yZXF1ZXN0ZWRUaWxlc1tpZF0gPSB0cnVlOwoKICAgIGlmIChpZCBpbiB0aGlzLnF1ZXVlZFRpbGVzKSB7CiAgICAgIHRpbGVzTGlzdC5wdXNoIChpZCk7CiAgICB9IGVsc2UgewogICAgICBjb25zb2xlLndhcm4oJ25vIHF1ZXVlIGVudHJ5IGZvciB0aWxlIGlkICcraWQpOwogICAgfQogIH0KCiAgdmFyIGRhdGEgPSB7IHRpbGVLZXlzOiB0aWxlc0xpc3QgfTsKCiAgdGhpcy5hY3RpdmVSZXF1ZXN0Q291bnQgKz0gMTsKCiAgdmFyIHNhdmVkVGhpcyA9IHRoaXM7CgogIC8vIE5PVEU6IGRvbid0IGFkZCB0aGUgcmVxdWVzdCB3aXRoIHdpbmRvdy5yZXF1ZXN0LmFkZCwgYXMgd2UgZG9uJ3Qgd2FudCB0aGUgYWJvcnQgaGFuZGxpbmcgdG8gYXBwbHkgdG8gbWFwIGRhdGEgYW55IG1vcmUKICB3aW5kb3cucG9zdEFqYXgoJ2dldEVudGl0aWVzJywgZGF0YSwgCiAgICBmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCBqcVhIUikgeyBzYXZlZFRoaXMuaGFuZGxlUmVzcG9uc2UgKGRhdGEsIHRpbGVzLCB0cnVlKTsgfSwgIC8vIHJlcXVlc3Qgc3VjY2Vzc2Z1bCBjYWxsYmFjawogICAgZnVuY3Rpb24oKSB7IHNhdmVkVGhpcy5oYW5kbGVSZXNwb25zZSAodW5kZWZpbmVkLCB0aWxlcywgZmFsc2UpOyB9ICAvLyByZXF1ZXN0IGZhaWxlZCBjYWxsYmFjawogICk7Cn0KCndpbmRvdy5NYXBEYXRhUmVxdWVzdC5wcm90b3R5cGUucmVxdWV1ZVRpbGUgPSBmdW5jdGlvbihpZCwgZXJyb3IpIHsKICBpZiAoaWQgaW4gdGhpcy5xdWV1ZWRUaWxlcykgewogICAgLy8gdGlsZSBpcyBjdXJyZW50bHkgd2FudGVkLi4uCgogICAgLy8gZmlyc3QsIHNlZSBpZiB0aGUgZXJyb3IgY2FuIGJlIGlnbm9yZWQgZHVlIHRvIHJldHJ5IGNvdW50cwogICAgaWYgKGVycm9yKSB7CiAgICAgIHRoaXMudGlsZUVycm9yQ291bnRbaWRdID0gKHRoaXMudGlsZUVycm9yQ291bnRbaWRdfHwwKSsxOwogICAgICBpZiAodGhpcy50aWxlRXJyb3JDb3VudFtpZF0gPD0gdGhpcy5NQVhfVElMRV9SRVRSSUVTKSB7CiAgICAgICAgLy8gcmV0cnkgbGltaXQgbG93IGVub3VnaCAtIGNsZWFyIHRoZSBlcnJvciBmbGFnCiAgICAgICAgZXJyb3IgPSBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIGlmIChlcnJvcikgewogICAgICAvLyBpZiBlcnJvciBpcyBzdGlsbCB0cnVlLCByZXRyeSBsaW1pdCBoaXQuIHVzZSBzdGFsZSBkYXRhIGZyb20gY2FjaGUgaWYgYXZhaWxhYmxlCiAgICAgIHZhciBkYXRhID0gdGhpcy5jYWNoZSA/IHRoaXMuY2FjaGUuZ2V0KGlkKSA6IHVuZGVmaW5lZDsKICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAvLyB3ZSBoYXZlIGNhY2hlZCBkYXRhIC0gdXNlIGl0LCBldmVuIHRob3VnaCBpdCdzIHN0YWxlCiAgICAgICAgdGhpcy5wdXNoUmVuZGVyUXVldWUoaWQsZGF0YSwnY2FjaGUtc3RhbGUnKTsKICAgICAgICB0aGlzLnN0YWxlVGlsZUNvdW50ICs9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gbm8gY2FjaGVkIGRhdGEKICAgICAgICB0aGlzLmRlYnVnVGlsZXMuc2V0U3RhdGUgKGlkLCAnZXJyb3InKTsKICAgICAgICB0aGlzLmZhaWxlZFRpbGVDb3VudCArPSAxOwogICAgICB9CiAgICAgIC8vIGFuZCBkZWxldGUgZnJvbSB0aGUgcGVuZGluZyByZXF1ZXN0cy4uLgogICAgICBkZWxldGUgdGhpcy5xdWV1ZWRUaWxlc1tpZF07CgogICAgfSBlbHNlIHsKICAgICAgLy8gaWYgZmFsc2UsIHdhcyBhICd0aW1lb3V0JyBvciB3ZSdyZSByZXRyeWluZywgc28gdW5saW1pdGVkIHJldHJpZXMgKGFzIHRoZSBzdG9jayBzaXRlIGRvZXMpCiAgICAgIHRoaXMuZGVidWdUaWxlcy5zZXRTdGF0ZSAoaWQsICdyZXRyeWluZycpOwoKICAgICAgLy8gRklYTUU/IGl0J3MgbmljZSB0byBtb3ZlIHJldHJpZWQgdGlsZXMgdG8gdGhlIGVuZCBvZiB0aGUgcmVxdWVzdCBxdWV1ZS4gaG93ZXZlciwgd2UgZG9uJ3QgYWN0dWFsbHkgaGF2ZSBhCiAgICAgIC8vIHByb3BlciBxdWV1ZSwganVzdCBhbiBvYmplY3Qgd2l0aCBndWlkIGFzIHByb3BlcnRpZXMuIEphdmFzY3JpcHQgc3RhbmRhcmRzIGRvbid0IGd1YXJhbnRlZSB0aGUgb3JkZXIgb2YgcHJvcGVydGllcwogICAgICAvLyB3aXRoaW4gYW4gb2JqZWN0LiBob3dldmVyLCBhbGwgY3VycmVudCBicm93c2VycyBkbyBrZWVwIHByb3BlcnR5IG9yZGVyLCBhbmQgbmV3IHByb3BlcnRpZXMgYXJlIGFkZGVkIGF0IHRoZSBlbmQuCiAgICAgIC8vIHRoZXJlZm9yZSwgZGVsZXRlIGFuZCByZS1hZGQgdGhlIHJlcXVldWVkIHRpbGUgYW5kIGl0IHdpbGwgYmUgYWRkZWQgdG8gdGhlIGVuZCBvZiB0aGUgcXVldWUKICAgICAgZGVsZXRlIHRoaXMucXVldWVkVGlsZXNbaWRdOwogICAgICB0aGlzLnF1ZXVlZFRpbGVzW2lkXSA9IGlkOwoKICAgIH0KICB9IC8vIGVsc2UgdGhlIHRpbGUgd2Fzbid0IGN1cnJlbnRseSB3YW50ZWQgKGFuIG9sZCBub24tY2FuY2VsbGVkIHJlcXVlc3QpIC0gaWdub3JlCn0KCgp3aW5kb3cuTWFwRGF0YVJlcXVlc3QucHJvdG90eXBlLmhhbmRsZVJlc3BvbnNlID0gZnVuY3Rpb24gKGRhdGEsIHRpbGVzLCBzdWNjZXNzKSB7CgogIHRoaXMuYWN0aXZlUmVxdWVzdENvdW50IC09IDE7CgogIHZhciBzdWNjZXNzVGlsZXMgPSBbXTsKICB2YXIgZXJyb3JUaWxlcyA9IFtdOwogIHZhciByZXRyeVRpbGVzID0gW107CiAgdmFyIHRpbWVvdXRUaWxlcyA9IFtdOwogIHZhciB1bmFjY291bnRlZFRpbGVzID0gdGlsZXMuc2xpY2UoMCk7IC8vIENsb25lCgogIGlmICghc3VjY2VzcyB8fCAhZGF0YSB8fCAhZGF0YS5yZXN1bHQpIHsKICAgIGNvbnNvbGUud2FybignUmVxdWVzdC5oYW5kbGVSZXNwb25zZTogcmVxdWVzdCBmYWlsZWQgLSByZXF1ZXVpbmcuLi4nKyhkYXRhICYmIGRhdGEuZXJyb3I/JyBlcnJvcjogJytkYXRhLmVycm9yOicnKSk7CgogICAgLy9yZXF1ZXN0IGZhaWxlZCAtIHJlcXVldWUgYWxsIHRoZSB0aWxlcyg/KQoKICAgIGlmIChkYXRhICYmIGRhdGEuZXJyb3IgJiYgZGF0YS5lcnJvciA9PSAnUkVUUlknKSB7CiAgICAgIC8vIHRoZSBzZXJ2ZXIgY2FuIHNvbWV0aW1lcyBhc2sgdXMgdG8gcmV0cnkgYSByZXF1ZXN0LiB0aGlzIGlzIGJvdGd1YXJkIHJlbGF0ZWQsIEkgYmVsaWV2ZQoKICAgICAgZm9yICh2YXIgaSBpbiB0aWxlcykgewogICAgICAgIHZhciBpZCA9IHRpbGVzW2ldOwogICAgICAgIHJldHJ5VGlsZXMucHVzaChpZCk7CiAgICAgICAgdGhpcy5kZWJ1Z1RpbGVzLnNldFN0YXRlIChpZCwgJ3JldHJ5aW5nJyk7CiAgICAgIH0KCiAgICAgIHdpbmRvdy5ydW5Ib29rcygncmVxdWVzdEZpbmlzaGVkJywge3N1Y2Nlc3M6IGZhbHNlfSk7CgogICAgfSBlbHNlIHsKICAgICAgZm9yICh2YXIgaSBpbiB0aWxlcykgewogICAgICAgIHZhciBpZCA9IHRpbGVzW2ldOwogICAgICAgIGVycm9yVGlsZXMucHVzaChpZCk7CiAgICAgICAgdGhpcy5kZWJ1Z1RpbGVzLnNldFN0YXRlIChpZCwgJ3JlcXVlc3QtZmFpbCcpOwogICAgICB9CgogICAgICB3aW5kb3cucnVuSG9va3MoJ3JlcXVlc3RGaW5pc2hlZCcsIHtzdWNjZXNzOiBmYWxzZX0pOwogICAgfQogICAgdW5hY2NvdW50ZWRUaWxlcyA9IFtdOwogIH0gZWxzZSB7CgogICAgLy8gVE9ETzogdXNlIHJlc3VsdC5taW5MZXZlbE9mRGV0YWlsID8/PyBzdG9jayBzaXRlIGRvZXNuJ3QgdXNlIGl0IHlldC4uLgoKICAgIHZhciBtID0gZGF0YS5yZXN1bHQubWFwOwoKICAgIGZvciAodmFyIGlkIGluIG0pIHsKICAgICAgdmFyIHZhbCA9IG1baWRdOwogICAgICB1bmFjY291bnRlZFRpbGVzLnNwbGljZSh1bmFjY291bnRlZFRpbGVzLmluZGV4T2YoaWQpLCAxKTsKICAgICAgaWYgKCdlcnJvcicgaW4gdmFsKSB7CiAgICAgICAgLy8gc2VydmVyIHJldHVybmVkIGFuIGVycm9yIGZvciB0aGlzIGluZGl2aWR1YWwgZGF0YSB0aWxlCgogICAgICAgIGlmICh2YWwuZXJyb3IgPT0gIlRJTUVPVVQiKSB7CiAgICAgICAgICAvLyBUSU1FT1VUIGVycm9ycyBmb3IgaW5kaXZpZHVhbCB0aWxlcyBhcmUgcXVpdGUgY29tbW9uLiB1c2VkIHRvIGJlIHVubGltaXRlZCByZXRyaWVzLCBidXQgbm90IGFueSBtb3JlCiAgICAgICAgICB0aW1lb3V0VGlsZXMucHVzaCAoaWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ21hcCBkYXRhIHRpbGUgJytpZCsnIGZhaWxlZDogZXJyb3I9PScrdmFsLmVycm9yKTsKICAgICAgICAgIGVycm9yVGlsZXMucHVzaCAoaWQpOwogICAgICAgICAgdGhpcy5kZWJ1Z1RpbGVzLnNldFN0YXRlIChpZCwgJ3RpbGUtZmFpbCcpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBubyBlcnJvciBmb3IgdGhpcyBkYXRhIHRpbGUgLSBwcm9jZXNzIGl0CiAgICAgICAgc3VjY2Vzc1RpbGVzLnB1c2ggKGlkKTsKCiAgICAgICAgLy8gc3RvcmUgdGhlIHJlc3VsdCBpbiB0aGUgY2FjaGUKICAgICAgICB0aGlzLmNhY2hlICYmIHRoaXMuY2FjaGUuc3RvcmUgKGlkLCB2YWwpOwoKICAgICAgICAvLyBpZiB0aGlzIHRpbGUgd2FzIGluIHRoZSByZW5kZXIgbGlzdCwgcmVuZGVyIGl0CiAgICAgICAgLy8gKHJlcXVlc3RzIGFyZW4ndCBhYm9ydGVkIHdoZW4gbmV3IHJlcXVlc3RzIGFyZSBzdGFydGVkLCBzbyBpdCdzIGVudGlyZWx5IHBvc3NpYmxlIHdlIGRvbid0IHdhbnQgdG8gcmVuZGVyIGl0ISkKICAgICAgICBpZiAoaWQgaW4gdGhpcy5xdWV1ZWRUaWxlcykgewoKICAgICAgICAgIHRoaXMucHVzaFJlbmRlclF1ZXVlKGlkLHZhbCwnb2snKTsKCiAgICAgICAgICBkZWxldGUgdGhpcy5xdWV1ZWRUaWxlc1tpZF07CiAgICAgICAgICB0aGlzLnN1Y2Nlc3NUaWxlQ291bnQgKz0gMTsKCiAgICAgICAgfSAvLyBlbHNlIHdlIGRvbid0IHdhbnQgdGhpcyB0aWxlIChmcm9tIGFuIG9sZCBub24tY2FuY2VsbGVkIHJlcXVlc3QpIC0gaWdub3JlCiAgICAgIH0KCiAgICB9CgogICAgLy8gVE9ETz8gY2hlY2sgZm9yIGFueSByZXF1ZXN0ZWQgdGlsZXMgaW4gJ3RpbGVzJyBub3QgYmVpbmcgbWVudGlvbmVkIGluIHRoZSByZXNwb25zZSAtIGFuZCBoYW5kbGUgYXMgaWYgaXQncyBhICd0aW1lb3V0Jz8KCgogICAgd2luZG93LnJ1bkhvb2tzKCdyZXF1ZXN0RmluaXNoZWQnLCB7c3VjY2VzczogdHJ1ZX0pOwogIH0KCiAgLy8gc2V0IHRoZSBxdWV1ZSBkZWxheSBiYXNlZCBvbiBhbnkgZXJyb3JzIG9yIHRpbWVvdXRzCiAgLy8gTk9URTogcmV0cnlUaW1lcyBhcmUgcmV0cmllZCBhdCB0aGUgcmVndWxhciBkZWxheSAtIG5vIGxvbmdlciB3YWl0IGFzIGZvciBlcnJvci90aW1lb3V0IGNhc2VzCiAgdmFyIG5leHRRdWV1ZURlbGF5ID0gZXJyb3JUaWxlcy5sZW5ndGggPiAwID8gdGhpcy5CQURfUkVRVUVTVF9SVU5fUVVFVUVfREVMQVkgOgogICAgICAgICAgICAgICAgICAgICAgIHVuYWNjb3VudGVkVGlsZXMubGVuZ3RoID4gMCA/IHRoaXMuRU1QVFlfUkVTUE9OU0VfUlVOX1FVRVVFX0RFTEFZIDoKICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0VGlsZXMubGVuZ3RoID4gMCA/IHRoaXMuVElNRU9VVF9SRVFVRVNUX1JVTl9RVUVVRV9ERUxBWSA6CiAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5SVU5fUVVFVUVfREVMQVk7CiAgdmFyIHN0YXR1c01zZyA9ICdnZXRFbnRpdGllcyBzdGF0dXM6ICcrdGlsZXMubGVuZ3RoKycgdGlsZXM6ICc7CiAgc3RhdHVzTXNnICs9IHN1Y2Nlc3NUaWxlcy5sZW5ndGgrJyBzdWNjZXNzZnVsJzsKICBpZiAocmV0cnlUaWxlcy5sZW5ndGgpIHN0YXR1c01zZyArPSAnLCAnK3JldHJ5VGlsZXMubGVuZ3RoKycgcmV0cmllZCc7CiAgaWYgKHRpbWVvdXRUaWxlcy5sZW5ndGgpIHN0YXR1c01zZyArPSAnLCAnK3RpbWVvdXRUaWxlcy5sZW5ndGgrJyB0aW1lZCBvdXQnOwogIGlmIChlcnJvclRpbGVzLmxlbmd0aCkgc3RhdHVzTXNnICs9ICcsICcrZXJyb3JUaWxlcy5sZW5ndGgrJyBmYWlsZWQnOwogIGlmICh1bmFjY291bnRlZFRpbGVzLmxlbmd0aCkgc3RhdHVzTXNnICs9ICcsICcrdW5hY2NvdW50ZWRUaWxlcy5sZW5ndGgrJyB1bmFjY291bnRlZCc7CiAgc3RhdHVzTXNnICs9ICcuIGRlbGF5ICcrbmV4dFF1ZXVlRGVsYXkrJyBzZWNvbmRzJzsKICBjb25zb2xlLmxvZyAoc3RhdHVzTXNnKTsKCgogIC8vIHJlcXVldWUgYW55ICd0aW1lb3V0JyB0aWxlcyBpbW1lZGlhdGVseQogIGlmICh0aW1lb3V0VGlsZXMubGVuZ3RoID4gMCkgewogICAgZm9yICh2YXIgaSBpbiB0aW1lb3V0VGlsZXMpIHsKICAgICAgdmFyIGlkID0gdGltZW91dFRpbGVzW2ldOwogICAgICBkZWxldGUgdGhpcy5yZXF1ZXN0ZWRUaWxlc1tpZF07CgogICAgICB0aGlzLnJlcXVldWVUaWxlKGlkLCB0cnVlKTsKICAgIH0KICB9CgogIGlmIChyZXRyeVRpbGVzLmxlbmd0aCA+IDApIHsKICAgIGZvciAodmFyIGkgaW4gcmV0cnlUaWxlcykgewogICAgICB2YXIgaWQgPSByZXRyeVRpbGVzW2ldOwogICAgICBkZWxldGUgdGhpcy5yZXF1ZXN0ZWRUaWxlc1tpZF07CgogICAgICB0aGlzLnJlcXVldWVUaWxlKGlkLCBmYWxzZSk7ICAvL3RpbGVzIGZyb20gYSBlcnJvcj09UkVUUlkgcmVxdWVzdCBhcmUgcmVxdWV1ZWQgd2l0aG91dCBjb3VudGluZyBpdCBhcyBhbiBlcnJvcgogICAgfQogIH0KCiAgaWYgKGVycm9yVGlsZXMubGVuZ3RoID4gMCkgewogICAgZm9yICh2YXIgaSBpbiBlcnJvclRpbGVzKSB7CiAgICAgIHZhciBpZCA9IGVycm9yVGlsZXNbaV07CiAgICAgIGRlbGV0ZSB0aGlzLnJlcXVlc3RlZFRpbGVzW2lkXTsKICAgICAgdGhpcy5yZXF1ZXVlVGlsZShpZCwgdHJ1ZSk7CiAgICB9CiAgfQoKICBpZiAodW5hY2NvdW50ZWRUaWxlcy5sZW5ndGggPiAwKSB7CiAgICBmb3IgKHZhciBpIGluIHVuYWNjb3VudGVkVGlsZXMpIHsKICAgICAgdmFyIGlkID0gdW5hY2NvdW50ZWRUaWxlc1tpXTsKICAgICAgZGVsZXRlIHRoaXMucmVxdWVzdGVkVGlsZXNbaWRdOwogICAgICB0aGlzLnJlcXVldWVUaWxlKGlkLCB0cnVlKTsKICAgIH0KICB9CgogIGZvciAodmFyIGkgaW4gc3VjY2Vzc1RpbGVzKSB7CiAgICB2YXIgaWQgPSBzdWNjZXNzVGlsZXNbaV07CiAgICBkZWxldGUgdGhpcy5yZXF1ZXN0ZWRUaWxlc1tpZF07CiAgfQoKCiAgdGhpcy5kZWxheVByb2Nlc3NSZXF1ZXN0UXVldWUobmV4dFF1ZXVlRGVsYXkpOwp9CgoKd2luZG93Lk1hcERhdGFSZXF1ZXN0LnByb3RvdHlwZS5yZXNldFJlbmRlclF1ZXVlID0gZnVuY3Rpb24oKSB7CiAgdGhpcy5yZW5kZXJRdWV1ZSA9IFtdOwoKICBpZiAodGhpcy5yZW5kZXJRdWV1ZVRpbWVyKSB7CiAgICBjbGVhclRpbWVvdXQodGhpcy5yZW5kZXJRdWV1ZVRpbWVyKTsKICAgIHRoaXMucmVuZGVyUXVldWVUaW1lciA9IHVuZGVmaW5lZDsKICB9CiAgdGhpcy5yZW5kZXJRdWV1ZVBhdXNlZCA9IGZhbHNlOyAgCn0KCgp3aW5kb3cuTWFwRGF0YVJlcXVlc3QucHJvdG90eXBlLnB1c2hSZW5kZXJRdWV1ZSA9IGZ1bmN0aW9uIChpZCwgZGF0YSwgc3RhdHVzKSB7CiAgdGhpcy5kZWJ1Z1RpbGVzLnNldFN0YXRlKGlkLCdyZW5kZXItcXVldWUnKTsKICB0aGlzLnJlbmRlclF1ZXVlLnB1c2goewogICAgaWQ6aWQsCiAgICAvLyB0aGUgZGF0YSBpbiB0aGUgcmVuZGVyIHF1ZXVlIGlzIG1vZGlmaWVkIGFzIHdlIGdvLCBzbyB3ZSBuZWVkIHRvIGNvcHkgdGhlIHZhbHVlcyBvZiB0aGUgYXJyYXlzLiBqdXN0IHN0b3JpbmcgdGhlIHJlZmVyZW5jZSB3b3VsZCBtb2RpZnkgdGhlIGRhdGEgaW4gdGhlIGNhY2hlIQogICAgZGVsZXRlZDogKGRhdGEuZGVsZXRlZEdhbWVFbnRpdHlHdWlkc3x8W10pLnNsaWNlKDApLAogICAgZW50aXRpZXM6IChkYXRhLmdhbWVFbnRpdGllc3x8W10pLnNsaWNlKDApLAogICAgc3RhdHVzOnN0YXR1c30pOwoKICBpZiAoIXRoaXMucmVuZGVyUXVldWVQYXVzZWQpIHsKICAgIHRoaXMuc3RhcnRRdWV1ZVRpbWVyKHRoaXMuUkVOREVSX1BBVVNFKTsKICB9Cn0KCndpbmRvdy5NYXBEYXRhUmVxdWVzdC5wcm90b3R5cGUuc3RhcnRRdWV1ZVRpbWVyID0gZnVuY3Rpb24oZGVsYXkpIHsKICBpZiAodGhpcy5yZW5kZXJRdWV1ZVRpbWVyID09PSB1bmRlZmluZWQpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICB0aGlzLnJlbmRlclF1ZXVlVGltZXIgPSBzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHsKICAgICAgX3RoaXMucmVuZGVyUXVldWVUaW1lciA9IHNldFRpbWVvdXQgKCBmdW5jdGlvbigpIHsgX3RoaXMucmVuZGVyUXVldWVUaW1lciA9IHVuZGVmaW5lZDsgX3RoaXMucHJvY2Vzc1JlbmRlclF1ZXVlKCk7IH0sIChkZWxheXx8MCkqMTAwMCApOwogICAgfSwgMCk7CiAgfQp9Cgp3aW5kb3cuTWFwRGF0YVJlcXVlc3QucHJvdG90eXBlLnBhdXNlUmVuZGVyUXVldWUgPSBmdW5jdGlvbihwYXVzZSkgewogIHRoaXMucmVuZGVyUXVldWVQYXVzZWQgPSBwYXVzZTsKICBpZiAocGF1c2UpIHsKICAgIGlmICh0aGlzLnJlbmRlclF1ZXVlVGltZXIpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVuZGVyUXVldWVUaW1lcik7CiAgICAgIHRoaXMucmVuZGVyUXVldWVUaW1lciA9IHVuZGVmaW5lZDsKICAgIH0KICB9IGVsc2UgewogICAgaWYgKHRoaXMucmVuZGVyUXVldWUubGVuZ3RoID4gMCkgewogICAgICB0aGlzLnN0YXJ0UXVldWVUaW1lcih0aGlzLlJFTkRFUl9QQVVTRSk7CiAgICB9CiAgfQp9Cgp3aW5kb3cuTWFwRGF0YVJlcXVlc3QucHJvdG90eXBlLnByb2Nlc3NSZW5kZXJRdWV1ZSA9IGZ1bmN0aW9uKCkgewogIHZhciBkcmF3RW50aXR5TGltaXQgPSB0aGlzLlJFTkRFUl9CQVRDSF9TSVpFOwoKCi8vVE9ETzogd2UgZG9uJ3QgdGFrZSBhY2NvdW50IG9mIGhvdyBtYW55IG9mIHRoZSBlbnRpdGllcyBhcmUgYWN0dWFsbHkgbmV3L3JlbW92ZWQgLSB0aGV5Ci8vIGNvdWxkIGFscmVhZHkgYmUgZHJhd24gYW5kIG5vdCBjaGFuZ2VkLiB3aWxsIHNlZSBob3cgaXQgd29ya3MgbGlrZSB0aGlzLi4uCiAgd2hpbGUgKGRyYXdFbnRpdHlMaW1pdCA+IDAgJiYgdGhpcy5yZW5kZXJRdWV1ZS5sZW5ndGggPiAwKSB7CiAgICB2YXIgY3VycmVudCA9IHRoaXMucmVuZGVyUXVldWVbMF07CgogICAgaWYgKGN1cnJlbnQuZGVsZXRlZC5sZW5ndGggPiAwKSB7CiAgICAgIHZhciBkZWxldGVUaGlzUGFzcyA9IGN1cnJlbnQuZGVsZXRlZC5zcGxpY2UoMCxkcmF3RW50aXR5TGltaXQpOwogICAgICBkcmF3RW50aXR5TGltaXQgLT0gZGVsZXRlVGhpc1Bhc3MubGVuZ3RoOwogICAgICB0aGlzLnJlbmRlci5wcm9jZXNzRGVsZXRlZEdhbWVFbnRpdHlHdWlkcyhkZWxldGVUaGlzUGFzcyk7CiAgICB9CgogICAgaWYgKGRyYXdFbnRpdHlMaW1pdCA+IDAgJiYgY3VycmVudC5lbnRpdGllcy5sZW5ndGggPiAwKSB7CiAgICAgIHZhciBkcmF3VGhpc1Bhc3MgPSBjdXJyZW50LmVudGl0aWVzLnNwbGljZSgwLGRyYXdFbnRpdHlMaW1pdCk7CiAgICAgIGRyYXdFbnRpdHlMaW1pdCAtPSBkcmF3VGhpc1Bhc3MubGVuZ3RoOwogICAgICB0aGlzLnJlbmRlci5wcm9jZXNzR2FtZUVudGl0aWVzKGRyYXdUaGlzUGFzcyk7CiAgICB9CgogICAgaWYgKGN1cnJlbnQuZGVsZXRlZC5sZW5ndGggPT0gMCAmJiBjdXJyZW50LmVudGl0aWVzLmxlbmd0aCA9PSAwKSB7CiAgICAgIHRoaXMucmVuZGVyUXVldWUuc3BsaWNlKDAsMSk7CiAgICAgIHRoaXMuZGVidWdUaWxlcy5zZXRTdGF0ZShjdXJyZW50LmlkLCBjdXJyZW50LnN0YXR1cyk7CiAgICB9CgoKICB9CgogIGlmICh0aGlzLnJlbmRlclF1ZXVlLmxlbmd0aCA+IDApIHsKICAgIHRoaXMuc3RhcnRRdWV1ZVRpbWVyKHRoaXMuUkVOREVSX1BBVVNFKTsKICB9IGVsc2UgaWYgKE9iamVjdC5rZXlzKHRoaXMucXVldWVkVGlsZXMpLmxlbmd0aCA9PSAwKSB7CgogICAgdGhpcy5yZW5kZXIuZW5kUmVuZGVyUGFzcygpOwoKICAgIHZhciBlbmRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICB2YXIgZHVyYXRpb24gPSAoZW5kVGltZSAtIHRoaXMucmVmcmVzaFN0YXJ0VGltZSkvMTAwMDsKCiAgICBjb25zb2xlLmxvZygnZmluaXNoZWQgcmVxdWVzdGluZyBkYXRhISAodG9vayAnK2R1cmF0aW9uKycgc2Vjb25kcyB0byBjb21wbGV0ZSknKTsKCiAgICB3aW5kb3cucnVuSG9va3MgKCdtYXBEYXRhUmVmcmVzaEVuZCcsIHt9KTsKCiAgICB2YXIgbG9uZ1N0YXR1cyA9ICdUaWxlczogJyArIHRoaXMuY2FjaGVkVGlsZUNvdW50ICsgJyBjYWNoZWQsICcgKwogICAgICAgICAgICAgICAgIHRoaXMuc3VjY2Vzc1RpbGVDb3VudCArICcgbG9hZGVkLCAnICsKICAgICAgICAgICAgICAgICAodGhpcy5zdGFsZVRpbGVDb3VudCA/IHRoaXMuc3RhbGVUaWxlQ291bnQgKyAnIHN0YWxlLCAnIDogJycpICsKICAgICAgICAgICAgICAgICAodGhpcy5mYWlsZWRUaWxlQ291bnQgPyB0aGlzLmZhaWxlZFRpbGVDb3VudCArICcgZmFpbGVkLCAnIDogJycpICsKICAgICAgICAgICAgICAgICAnaW4gJyArIGR1cmF0aW9uICsgJyBzZWNvbmRzJzsKCiAgICAvLyByZWZyZXNoIHRpbWVyIGJhc2VkIG9uIHRpbWUgdG8gcnVuIHRoaXMgcGFzcywgd2l0aCBhIG1pbmltdW0gb2YgUkVGUkVTSCBzZWNvbmRzCiAgICB2YXIgbWluUmVmcmVzaCA9IG1hcC5nZXRab29tKCk+MTIgPyB0aGlzLlJFRlJFU0hfQ0xPU0UgOiB0aGlzLlJFRlJFU0hfRkFSOwogICAgdmFyIHJlZnJlc2hUaW1lciA9IE1hdGgubWF4KG1pblJlZnJlc2gsIGR1cmF0aW9uKnRoaXMuRkVUQ0hfVE9fUkVGUkVTSF9GQUNUT1IpOwogICAgdGhpcy5yZWZyZXNoT25UaW1lb3V0KHJlZnJlc2hUaW1lcik7CiAgICB0aGlzLnNldFN0YXR1cyAodGhpcy5mYWlsZWRUaWxlQ291bnQgPyAnZXJyb3JzJyA6IHRoaXMuc3RhbGVUaWxlQ291bnQgPyAnb3V0IG9mIGRhdGUnIDogJ2RvbmUnLCBsb25nU3RhdHVzKTsKCiAgfQoKfQoKCjsKCi8qCk9NUyBkb2Vzbid0IGNhbmNlbCB0aGUgb3JpZ2luYWwgY2xpY2sgZXZlbnQsIHNvIHRoZSB0b3Btb3N0IG1hcmtlciB3aWxsIGdldCBhIGNsaWNrIGV2ZW50IHdoaWxlIHNwaWRlcmZ5aW5nLgpBbHNvLCBPTVMgb25seSBzdXBwb3J0cyBhIGdsb2JhbCBjYWxsYmFjayBmb3IgYWxsIG1hbmFnZWQgbWFya2Vycy4gVGhlcmVmb3JlLCB3ZSB3aWxsIHVzZSBhIGN1c3RvbSBldmVudCB0aGF0IGdldHMgZmlyZWQKZm9yIGVhY2ggbWFya2VyLgoqLwoKd2luZG93LnNldHVwT01TID0gZnVuY3Rpb24oKSB7CiAgd2luZG93Lm9tcyA9IG5ldyBPdmVybGFwcGluZ01hcmtlclNwaWRlcmZpZXIobWFwLCB7CiAgICBrZWVwU3BpZGVyZmllZDogdHJ1ZSwKICAgIGxlZ1dlaWdodDogMy41LAogICAgbGVnQ29sb3JzOiB7CiAgICAgIHVzdWFsOiAnI0ZGRkYwMCcsCiAgICAgIGhpZ2hsaWdodGVkOiAnI0ZGMDAwMCcKICAgIH0KICB9KTsKCiAgd2luZG93Lm9tcy5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihtYXJrZXIpIHsKICAgIG1hcC5jbG9zZVBvcHVwKCk7CiAgICBtYXJrZXIuZmlyZUV2ZW50KCdzcGlkZXJmaWVkY2xpY2snLCB7dGFyZ2V0OiBtYXJrZXJ9KTsKICB9KTsKICB3aW5kb3cub21zLmFkZExpc3RlbmVyKCdzcGlkZXJmeScsIGZ1bmN0aW9uKG1hcmtlcnMpIHsKICAgIG1hcC5jbG9zZVBvcHVwKCk7CiAgfSk7CiAgbWFwLl9jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigia2V5cHJlc3MiLCBmdW5jdGlvbihldikgewogICAgaWYoZXYua2V5Q29kZSA9PT0gMjcpIC8vIEVzYwogICAgICB3aW5kb3cub21zLnVuc3BpZGVyZnkoKTsKICB9LCBmYWxzZSk7Cn0KCndpbmRvdy5yZWdpc3Rlck1hcmtlckZvck9NUyA9IGZ1bmN0aW9uKG1hcmtlcikgewogIG1hcmtlci5vbignYWRkJywgZnVuY3Rpb24gKCkgewogICAgd2luZG93Lm9tcy5hZGRNYXJrZXIobWFya2VyKTsKICB9KTsKICBtYXJrZXIub24oJ3JlbW92ZScsIGZ1bmN0aW9uICgpIHsKICAgIHdpbmRvdy5vbXMucmVtb3ZlTWFya2VyKG1hcmtlcik7CiAgfSk7CiAgaWYobWFya2VyLl9tYXApIC8vIG1hcmtlciBoYXMgYWxyZWFkeSBiZWVuIGFkZGVkCiAgICB3aW5kb3cub21zLmFkZE1hcmtlcihtYXJrZXIpOwp9CgoKCgo7CgovLyBPUk5BTUVOVFMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLy8gYWRkZWQgYXMgcGFydCBvZiB0aGUgaW5ncmVzcyAjaGVsaW9zIGluIDIwMTQsIG9ybmFtZW50cwovLyBhcmUgYWRkaXRpb25hbCBpbWFnZSBvdmVybGF5cyBmb3IgcG9ydGFscwovLyBjdXJyZW50bHkgdGhlcmUgYXJlIDI4IGtub3duIG9ybmFtZW50czogYXAkeCRzdWZmaXgKLy8gLSBjbHVzdGVyIHBvcnRhbHMgKHdpdGhvdXQgc3VmZml4KQovLyAtIHZvbGF0aWxlIHBvcnRhbHMgKF92KQovLyAtIG1lZXRpbmcgcG9pbnRzIChfc3RhcnQpCi8vIC0gZmluaXNoIHBvaW50cyAoX2VuZCkKLy8gKHRoZXJlIGFyZSA3IGRpZmZlcmVudCBjb2xvcnMgZm9yIGVhY2ggb2YgdGhlbSkKCgp3aW5kb3cub3JuYW1lbnRzID0ge30Kd2luZG93Lm9ybmFtZW50cy5PVkVSTEFZX1NJWkUgPSA2MDsKd2luZG93Lm9ybmFtZW50cy5PVkVSTEFZX09QQUNJVFkgPSAwLjY7Cgp3aW5kb3cub3JuYW1lbnRzLnNldHVwID0gZnVuY3Rpb24oKSB7CiAgd2luZG93Lm9ybmFtZW50cy5fcG9ydGFscyA9IHt9OwogIHdpbmRvdy5vcm5hbWVudHMuX2xheWVyID0gTC5sYXllckdyb3VwKCk7CiAgd2luZG93LmFkZExheWVyR3JvdXAoJ09ybmFtZW50cycsIHdpbmRvdy5vcm5hbWVudHMuX2xheWVyLCB0cnVlKTsKfQoKLy8gcXVpY2sgdGVzdCBmb3IgcG9ydGFsIGhhdmluZyBvcm5hbWVudHMKd2luZG93Lm9ybmFtZW50cy5pc0ludGVyZXN0aW5nUG9ydGFsID0gZnVuY3Rpb24ocG9ydGFsKSB7CiAgcmV0dXJuIHBvcnRhbC5vcHRpb25zLmRhdGEub3JuYW1lbnRzLmxlbmd0aCAhPSAwOwp9Cgp3aW5kb3cub3JuYW1lbnRzLmFkZFBvcnRhbCA9IGZ1bmN0aW9uKHBvcnRhbCkgewogIHZhciBndWlkID0gcG9ydGFsLm9wdGlvbnMuZ3VpZDsKCiAgd2luZG93Lm9ybmFtZW50cy5yZW1vdmVQb3J0YWwocG9ydGFsKTsKCiAgdmFyIHNpemUgPSB3aW5kb3cub3JuYW1lbnRzLk9WRVJMQVlfU0laRTsKICB2YXIgbGF0bG5nID0gcG9ydGFsLmdldExhdExuZygpOwoKICBpZiAocG9ydGFsLm9wdGlvbnMuZGF0YS5vcm5hbWVudHMpIHsKICAgIHdpbmRvdy5vcm5hbWVudHMuX3BvcnRhbHNbZ3VpZF0gPSBwb3J0YWwub3B0aW9ucy5kYXRhLm9ybmFtZW50cy5tYXAoZnVuY3Rpb24ob3JuYW1lbnQpIHsKICAgICAgdmFyIGljb24gPSBMLmljb24oewogICAgICAgIGljb25Vcmw6ICIvL2NvbW1vbmRhdGFzdG9yYWdlLmdvb2dsZWFwaXMuY29tL2luZ3Jlc3MuY29tL2ltZy9tYXBfaWNvbnMvbWFya2VyX2ltYWdlcy8iK29ybmFtZW50KyIucG5nIiwKICAgICAgICBpY29uU2l6ZTogW3NpemUsIHNpemVdLAogICAgICAgIGljb25BbmNob3I6IFtzaXplLzIsc2l6ZS8yXSwKICAgICAgICBjbGFzc05hbWU6ICduby1wb2ludGVyLWV2ZW50cycgIC8vIHRoZSBjbGlja2FibGU6IGZhbHNlIGJlbG93IHN0aWxsIGJsb2NrcyBldmVudHMgZ29pbmcgdGhyb3VnaCB0byB0aGUgc3ZnIHVuZGVybmVhdGgKICAgICAgfSk7CgogICAgICByZXR1cm4gTC5tYXJrZXIobGF0bG5nLCB7aWNvbjogaWNvbiwgY2xpY2thYmxlOiBmYWxzZSwga2V5Ym9hcmQ6IGZhbHNlLCBvcGFjaXR5OiB3aW5kb3cub3JuYW1lbnRzLk9WRVJMQVlfT1BBQ0lUWSB9KS5hZGRUbyh3aW5kb3cub3JuYW1lbnRzLl9sYXllcik7CiAgICB9KTsKICB9Cn0KCndpbmRvdy5vcm5hbWVudHMucmVtb3ZlUG9ydGFsID0gZnVuY3Rpb24ocG9ydGFsKSB7CiAgdmFyIGd1aWQgPSBwb3J0YWwub3B0aW9ucy5ndWlkOwogIGlmKHdpbmRvdy5vcm5hbWVudHMuX3BvcnRhbHNbZ3VpZF0pIHsKICAgIHdpbmRvdy5vcm5hbWVudHMuX3BvcnRhbHNbZ3VpZF0uZm9yRWFjaChmdW5jdGlvbihtYXJrZXIpIHsKICAgICAgd2luZG93Lm9ybmFtZW50cy5fbGF5ZXIucmVtb3ZlTGF5ZXIobWFya2VyKTsKICAgIH0pOwogICAgZGVsZXRlIHdpbmRvdy5vcm5hbWVudHMuX3BvcnRhbHNbZ3VpZF07CiAgfQp9CgoKOwoKLy8gY3JlYXRlZCB0byBzdGFydCBjbGVhbmluZyB1cCAid2luZG93IiBpbnRlcmFjdGlvbgovLwoKd2luZG93LmN1cnJlbnRQYW5lID0gJyc7Cgp3aW5kb3cuc2hvdyA9IGZ1bmN0aW9uKGlkKSB7CiAgaWYod2luZG93LmN1cnJlbnRQYW5lID09IGlkKSByZXR1cm47CiAgd2luZG93LmN1cnJlbnRQYW5lID0gaWQ7CiAgd2luZG93LmhpZGVhbGwoKTsKCiAgcnVuSG9va3MoInBhbmVDaGFuZ2VkIiwgaWQpOwoKICBzd2l0Y2goaWQpIHsKICAgIGNhc2UgJ2FsbCc6CiAgICBjYXNlICdmYWN0aW9uJzoKICAgIGNhc2UgJ2FsZXJ0cyc6CiAgICAgIHdpbmRvdy5jaGF0LnNob3coaWQpOwogICAgICBicmVhazsKICAgIGNhc2UgJ2RlYnVnJzoKICAgICAgd2luZG93LmRlYnVnLmNvbnNvbGUuc2hvdygpOwogICAgICBicmVhazsKICAgIGNhc2UgJ21hcCc6CiAgICAgIHdpbmRvdy5zbWFydHBob25lLm1hcEJ1dHRvbi5jbGljaygpOwogICAgICAkKCcjcG9ydGFsX2hpZ2hsaWdodF9zZWxlY3QnKS5zaG93KCk7CiAgICAgICQoJyNmYXJtX2xldmVsX3NlbGVjdCcpLnNob3coKTsKICAgICAgYnJlYWs7CiAgICBjYXNlICdpbmZvJzoKICAgICAgd2luZG93LnNtYXJ0cGhvbmUuc2lkZUJ1dHRvbi5jbGljaygpOwogICAgICBicmVhazsKICB9CgogIGlmICh0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCAmJiBhbmRyb2lkLnN3aXRjaFRvUGFuZSkgewogICAgYW5kcm9pZC5zd2l0Y2hUb1BhbmUoaWQpOwogIH0KfQoKd2luZG93LmhpZGVhbGwgPSBmdW5jdGlvbigpIHsKICAkKCcjY2hhdGNvbnRyb2xzLCAjY2hhdCwgI2NoYXRpbnB1dCwgI3NpZGViYXJ0b2dnbGUsICNzY3JvbGx3cmFwcGVyLCAjdXBkYXRlc3RhdHVzLCAjcG9ydGFsX2hpZ2hsaWdodF9zZWxlY3QnKS5oaWRlKCk7CiAgJCgnI2Zhcm1fbGV2ZWxfc2VsZWN0JykuaGlkZSgpOwogICQoJyNtYXAnKS5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7CiAgJCgnLnVpLXRvb2x0aXAnKS5yZW1vdmUoKTsKfQoKCjsKCi8vIFBMQVlFUiBOQU1FUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgoKLy8gdGVzdCB0byBzZWUgaWYgYSBzcGVjaWZpYyBwbGF5ZXIgR1VJRCBpcyBhIHNwZWNpYWwgc3lzdGVtIGFjY291bnQgKGUuZy4gX19KQVJWSVNfXywgX19BREFfXykgdGhhdCBzaG91bGRuJ3QKLy8gYmUgbGlzdGVkIGFzIGEgcGxheWVyCndpbmRvdy5pc1N5c3RlbVBsYXllciA9IGZ1bmN0aW9uKG5hbWUpIHsKCiAgc3dpdGNoIChuYW1lKSB7CiAgICBjYXNlICdfX0FEQV9fJzoKICAgIGNhc2UgJ19fSkFSVklTX18nOgogICAgICByZXR1cm4gdHJ1ZTsKCiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gZmFsc2U7CiAgfQoKfQoKCjsKCi8vLyBQT1JUQUwgREFUQSBUT09MUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gbWlzYyBmdW5jdGlvbnMgdG8gZ2V0IHBvcnRhbCBpbmZvCgovLyBzZWFyY2ggdGhyb3VnaCB0aGUgbGlua3MgZGF0YSBmb3IgYWxsIHRoYXQgbGluayBmcm9tIG9yIHRvIGEgcG9ydGFsLiByZXR1cm5zIGFuIG9iamVjdCB3aXRoIHNlcGFyYXRlIGxpc3RzIG9mIGluCi8vIGFuZCBvdXQgbGlua3MuIG1heSBvciBtYXkgbm90IGJlIGFzIGFjY3VyYXRlIGFzIHRoZSBwb3J0YWwgZGV0YWlscywgZGVwZW5kaW5nIG9uIGhvdyBtdWNoIGRhdGEgdGhlIEFQSSByZXR1cm5zCndpbmRvdy5nZXRQb3J0YWxMaW5rcyA9IGZ1bmN0aW9uKGd1aWQpIHsKCiAgdmFyIGxpbmtzID0geyBpbjogW10sIG91dDogW10gfTsKCiAgJC5lYWNoKHdpbmRvdy5saW5rcywgZnVuY3Rpb24oZyxsKSB7CiAgICB2YXIgZCA9IGwub3B0aW9ucy5kYXRhOwoKICAgIGlmIChkLm9HdWlkID09IGd1aWQpIHsKICAgICAgbGlua3Mub3V0LnB1c2goZyk7CiAgICB9CiAgICBpZiAoZC5kR3VpZCA9PSBndWlkKSB7CiAgICAgIGxpbmtzLmluLnB1c2goZyk7CiAgICB9CiAgfSk7CgogIHJldHVybiBsaW5rczsKfQoKd2luZG93LmdldFBvcnRhbExpbmtzQ291bnQgPSBmdW5jdGlvbihndWlkKSB7CiAgdmFyIGxpbmtzID0gZ2V0UG9ydGFsTGlua3MoZ3VpZCk7CiAgcmV0dXJuIGxpbmtzLmluLmxlbmd0aCtsaW5rcy5vdXQubGVuZ3RoOwp9CgoKLy8gc2VhcmNoIHRocm91Z2ggdGhlIGZpZWxkcyBmb3IgYWxsIHRoYXQgcmVmZXJlbmNlIGEgcG9ydGFsCndpbmRvdy5nZXRQb3J0YWxGaWVsZHMgPSBmdW5jdGlvbihndWlkKSB7CiAgdmFyIGZpZWxkcyA9IFtdOwoKICAkLmVhY2god2luZG93LmZpZWxkcywgZnVuY3Rpb24oZyxmKSB7CiAgICB2YXIgZCA9IGYub3B0aW9ucy5kYXRhOwoKICAgIGlmICggZC5wb2ludHNbMF0uZ3VpZCA9PSBndWlkCiAgICAgIHx8IGQucG9pbnRzWzFdLmd1aWQgPT0gZ3VpZAogICAgICB8fCBkLnBvaW50c1syXS5ndWlkID09IGd1aWQgKSB7CgogICAgICBmaWVsZHMucHVzaChnKTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIGZpZWxkczsKfQoKd2luZG93LmdldFBvcnRhbEZpZWxkc0NvdW50ID0gZnVuY3Rpb24oZ3VpZCkgewogIHZhciBmaWVsZHMgPSBnZXRQb3J0YWxGaWVsZHMoZ3VpZCk7CiAgcmV0dXJuIGZpZWxkcy5sZW5ndGg7Cn0KCgovLyBmaW5kIHRoZSBsYXQvbG9uIGZvciBhIHBvcnRhbCwgdXNpbmcgYW55IGFuZCBhbGwgYXZhaWxhYmxlIGRhdGEKLy8gKHdlIGhhdmUgdGhlIGxpc3Qgb2YgcG9ydGFscywgdGhlIGNhY2hlZCBwb3J0YWwgZGV0YWlscywgcGx1cyBsaW5rcyBhbmQgZmllbGRzIGFzIHNvdXJjZXMgb2YgcG9ydGFsIGxvY2F0aW9ucykKd2luZG93LmZpbmRQb3J0YWxMYXRMbmcgPSBmdW5jdGlvbihndWlkKSB7CiAgaWYgKHdpbmRvdy5wb3J0YWxzW2d1aWRdKSB7CiAgICByZXR1cm4gd2luZG93LnBvcnRhbHNbZ3VpZF0uZ2V0TGF0TG5nKCk7CiAgfQoKICAvLyBub3QgZm91bmQgaW4gcG9ydGFscyAtIHRyeSB0aGUgY2FjaGVkIChhbmQgcG9zc2libHkgc3RhbGUpIGRldGFpbHMgLSBnb29kIGVub3VnaCBmb3IgbG9jYXRpb24KICB2YXIgZGV0YWlscyA9IHBvcnRhbERldGFpbC5nZXQoZ3VpZCk7CiAgaWYgKGRldGFpbHMpIHsKICAgIHJldHVybiBMLmxhdExuZyAoZGV0YWlscy5sYXRFNi8xRTYsIGRldGFpbHMubG5nRTYvMUU2KTsKICB9CgogIC8vIG5vdyB0cnkgc2VhcmNoaW5nIHRocm91Z2ggZmllbGRzCiAgZm9yICh2YXIgZmd1aWQgaW4gd2luZG93LmZpZWxkcykgewogICAgdmFyIGYgPSB3aW5kb3cuZmllbGRzW2ZndWlkXS5vcHRpb25zLmRhdGE7CgogICAgZm9yICh2YXIgaSBpbiBmLnBvaW50cykgewogICAgICBpZiAoZi5wb2ludHNbaV0uZ3VpZCA9PSBndWlkKSB7CiAgICAgICAgcmV0dXJuIEwubGF0TG5nIChmLnBvaW50c1tpXS5sYXRFNi8xRTYsIGYucG9pbnRzW2ldLmxuZ0U2LzFFNik7CiAgICAgIH0KICAgIH0KICB9CgogIC8vIGFuZCBmaW5hbGx5IHNlYXJjaCB0aHJvdWdoIGxpbmtzCiAgZm9yICh2YXIgbGd1aWQgaW4gd2luZG93LmxpbmtzKSB7CiAgICB2YXIgbCA9IHdpbmRvdy5saW5rc1tsZ3VpZF0ub3B0aW9ucy5kYXRhOwogICAgaWYgKGwub0d1aWQgPT0gZ3VpZCkgewogICAgICByZXR1cm4gTC5sYXRMbmcgKGwub0xhdEU2LzFFNiwgbC5vTG5nRTYvMUU2KTsKICAgIH0KICAgIGlmIChsLmRHdWlkID09IGd1aWQpIHsKICAgICAgcmV0dXJuIEwubGF0TG5nIChsLmRMYXRFNi8xRTYsIGwuZExuZ0U2LzFFNik7CiAgICB9CiAgfQoKICAvLyBubyBsdWNrIGZpbmRpbmcgcG9ydGFsIGxhdC9sbmcKICByZXR1cm4gdW5kZWZpbmVkOwp9OwoKCihmdW5jdGlvbigpIHsKICB2YXIgY2FjaGUgPSB7fTsKICB2YXIgY2FjaGVfbGV2ZWwgPSAwOwogIHZhciBHQ19MSU1JVCA9IDE1MDAwOyAvLyBydW4gZ2FyYmFnZSBjb2xsZWN0b3Igd2hlbiBjYWNoZSBoYXMgbW9yZSB0aGF0IDUwMDAgaXRlbXMKICB2YXIgR0NfS0VFUCAgPSAxMDAwMDsgLy8ga2VlcCB0aGUgNDAwMCBtb3N0IHJlY2VudCBpdGVtcwoKICB3aW5kb3cuZmluZFBvcnRhbEd1aWRCeVBvc2l0aW9uRTYgPSBmdW5jdGlvbihsYXRFNiwgbG5nRTYpIHsKICAgIHZhciBpdGVtID0gY2FjaGVbbGF0RTYrIiwiK2xuZ0U2XTsKICAgIGlmKGl0ZW0pIHJldHVybiBpdGVtWzBdOwoKICAgIC8vIG5vdyB0cnkgc2VhcmNoaW5nIHRocm91Z2ggY3VycmVudGx5IHJlbmRlcmVkIHBvcnRhbHMKICAgIGZvcih2YXIgZ3VpZCBpbiB3aW5kb3cucG9ydGFscykgewogICAgICB2YXIgZGF0YSA9IHdpbmRvdy5wb3J0YWxzW2d1aWRdLm9wdGlvbnMuZGF0YTsKICAgICAgaWYoZGF0YS5sYXRFNiA9PSBsYXRFNiAmJiBkYXRhLmxuZ0U2ID09IGxuZ0U2KSByZXR1cm4gZ3VpZDsKICAgIH0KCiAgICAvLyBub3cgdHJ5IHNlYXJjaGluZyB0aHJvdWdoIGZpZWxkcwogICAgZm9yKHZhciBmZ3VpZCBpbiB3aW5kb3cuZmllbGRzKSB7CiAgICAgIHZhciBwb2ludHMgPSB3aW5kb3cuZmllbGRzW2ZndWlkXS5vcHRpb25zLmRhdGEucG9pbnRzOwoKICAgICAgZm9yKHZhciBpIGluIHBvaW50cykgewogICAgICAgIHZhciBwb2ludCA9IHBvaW50c1tpXTsKICAgICAgICBpZihwb2ludC5sYXRFNiA9PSBsYXRFNiAmJiBwb2ludC5sbmdFNiA9PSBsbmdFNikgcmV0dXJuIHBvaW50Lmd1aWQ7CiAgICAgIH0KICAgIH0KCiAgICAvLyBhbmQgZmluYWxseSBzZWFyY2ggdGhyb3VnaCBsaW5rcwogICAgZm9yKHZhciBsZ3VpZCBpbiB3aW5kb3cubGlua3MpIHsKICAgICAgdmFyIGwgPSB3aW5kb3cubGlua3NbbGd1aWRdLm9wdGlvbnMuZGF0YTsKICAgICAgaWYobC5vTGF0RTYgPT0gbGF0RTYgJiYgbC5vTG5nRTYgPT0gbG5nRTYpIHJldHVybiBsLm9HdWlkOwogICAgICBpZihsLmRMYXRFNiA9PSBsYXRFNiAmJiBsLmRMbmdFNiA9PSBsbmdFNikgcmV0dXJuIGwuZEd1aWQ7CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfTsKCiAgd2luZG93LnB1c2hQb3J0YWxHdWlkUG9zaXRpb25DYWNoZSA9IGZ1bmN0aW9uKGd1aWQsIGxhdEU2LCBsbmdFNikgewogICAgY2FjaGVbbGF0RTYrIiwiK2xuZ0U2XSA9IFtndWlkLCBEYXRlLm5vdygpXTsKICAgIGNhY2hlX2xldmVsICs9IDE7CgogICAgaWYoY2FjaGVfbGV2ZWwgPiBHQ19MSU1JVCkgewogICAgICBPYmplY3Qua2V5cyhjYWNoZSkgLy8gZ2V0IGFsbCBsYXRsbmdzCiAgICAgICAgLm1hcChmdW5jdGlvbihsYXRsbmcpIHsgcmV0dXJuIFtsYXRsbmcsIGNhY2hlW2xhdGxuZ11bMV1dOyB9KSAgLy8gbWFwIHRoZW0gdG8gW2xhdGxuZywgdGltZXN0YW1wXQogICAgICAgIC5zb3J0KGZ1bmN0aW9uKGEsYikgeyByZXR1cm4gYlsxXSAtIGFbMV07IH0pIC8vIHNvcnQgdGhlbQogICAgICAgIC5zbGljZShHQ19LRUVQKSAvLyBkcm9wIHRoZSBNUlUKICAgICAgICAuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7IGRlbGV0ZSBjYWNoZVtpdGVtWzBdXSB9KTsgLy8gZGVsZXRlIHRoZSByZXN0CiAgICAgIGNhY2hlX2xldmVsID0gT2JqZWN0LmtleXMoY2FjaGUpLmxlbmd0aAogICAgfQogIH0KfSkoKTsKCgovLyBnZXQgdGhlIEFQIGdhaW5zIGZyb20gYSBwb3J0YWwsIGJhc2VkIG9ubHkgb24gdGhlIGJyaWVmIHN1bW1hcnkgZGF0YSBmcm9tIHBvcnRhbHMsIGxpbmtzIGFuZCBmaWVsZHMKLy8gbm90IGVudGlyZWx5IGFjY3VyYXRlIC0gYnV0IGF2YWlsYWJsZSBmb3IgYWxsIHBvcnRhbHMgb24gdGhlIHNjcmVlbgp3aW5kb3cuZ2V0UG9ydGFsQXBHYWluID0gZnVuY3Rpb24oZ3VpZCkgewoKICB2YXIgcCA9IHdpbmRvdy5wb3J0YWxzW2d1aWRdOwogIGlmIChwKSB7CiAgICB2YXIgZGF0YSA9IHAub3B0aW9ucy5kYXRhOwoKICAgIHZhciBsaW5rQ291bnQgPSBnZXRQb3J0YWxMaW5rc0NvdW50KGd1aWQpOwogICAgdmFyIGZpZWxkQ291bnQgPSBnZXRQb3J0YWxGaWVsZHNDb3VudChndWlkKTsKCiAgICB2YXIgcmVzdWx0ID0gcG9ydGFsQXBHYWluTWF0aHMoZGF0YS5yZXNDb3VudCwgbGlua0NvdW50LCBmaWVsZENvdW50KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICByZXR1cm4gdW5kZWZpbmVkOwp9CgovLyBnaXZlbiBjb3VudHMgb2YgcmVzb25hdG9ycywgbGlua3MgYW5kIGZpZWxkcywgY2FsY3VsYXRlIHRoZSBhdmFpbGFibGUgQVAKLy8gZG9lc24ndCB0YWtlIGFjY291bnQgQVAgZm9yIHJlc29uYXRvciB1cGdyYWRlcyBvciBBUCBmb3IgYWRkaW5nIG1vZHMKd2luZG93LnBvcnRhbEFwR2Fpbk1hdGhzID0gZnVuY3Rpb24ocmVzQ291bnQsIGxpbmtDb3VudCwgZmllbGRDb3VudCkgewoKICB2YXIgZGVwbG95QXAgPSAoOC1yZXNDb3VudCkqREVQTE9ZX1JFU09OQVRPUjsKICBpZiAocmVzQ291bnQgPT0gMCkgZGVwbG95QXAgKz0gQ0FQVFVSRV9QT1JUQUw7CiAgaWYgKHJlc0NvdW50ICE9IDgpIGRlcGxveUFwICs9IENPTVBMRVRJT05fQk9OVVM7CiAgLy8gdGhlcmUgY291bGQgYWxzbyBiZSBBUCBmb3IgdXBncmFkaW5nIGV4aXN0aW5nIHJlc29uYXRvcnMsIGFuZCBmb3IgZGVwbG95aW5nIG1vZHMgLSBidXQgd2UgZG9uJ3QgaGF2ZSBkYXRhIGZvciB0aGF0CiAgdmFyIGZyaWVuZGx5QXAgPSBkZXBsb3lBcDsKCiAgdmFyIGRlc3Ryb3lSZXNvQXAgPSByZXNDb3VudCpERVNUUk9ZX1JFU09OQVRPUjsKICB2YXIgZGVzdHJveUxpbmtBcCA9IGxpbmtDb3VudCpERVNUUk9ZX0xJTks7CiAgdmFyIGRlc3Ryb3lGaWVsZEFwID0gZmllbGRDb3VudCpERVNUUk9ZX0ZJRUxEOwogIHZhciBjYXB0dXJlQXAgPSBDQVBUVVJFX1BPUlRBTCArIDggKiBERVBMT1lfUkVTT05BVE9SICsgQ09NUExFVElPTl9CT05VUzsKICB2YXIgZGVzdHJveUFwID0gZGVzdHJveVJlc29BcCtkZXN0cm95TGlua0FwK2Rlc3Ryb3lGaWVsZEFwOwogIHZhciBlbmVteUFwID0gZGVzdHJveUFwK2NhcHR1cmVBcDsKCiAgcmV0dXJuIHsKICAgIGZyaWVuZGx5QXA6IGZyaWVuZGx5QXAsCiAgICBlbmVteUFwOiBlbmVteUFwLAogICAgZGVzdHJveUFwOiBkZXN0cm95QXAsCiAgICBkZXN0cm95UmVzb0FwOiBkZXN0cm95UmVzb0FwLAogICAgY2FwdHVyZUFwOiBjYXB0dXJlQXAKICB9Cn0KCgo7CgovLy8gUE9SVEFMIERFVEFJTCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBjb2RlIHRvIHJldHJpZXZlIHRoZSBuZXcgcG9ydGFsIGRldGFpbCBkYXRhIGZyb20gdGhlIHNlcnZlcnMKCi8vIE5PVEU6IHRoZSBBUEkgZm9yIHBvcnRhbCBkZXRhaWxlZCBpbmZvcm1hdGlvbiBpcyBOT1QgRklOQUwKLy8gdGhpcyBpcyBhIHRlbXBvcmFyeSBtZWFzdXJlIHRvIGdldCB0aGluZ3Mgd29ya2luZyBhZ2FpbiBhZnRlciBhIG1ham9yIGNoYW5nZSB0byB0aGUgaW50ZWwgbWFwCi8vIEFQSS4gZXhwZWN0IHRoaW5ncyB0byBjaGFuZ2UgaGVyZQoKCi8vIGFub255bW91cyBmdW5jdGlvbiB3cmFwcGVyIGZvciB0aGUgY29kZSAtIGFueSB2YXJpYWJsZXMvZnVuY3Rpb25zIG5vdCBwbGFjZWQgaW50byAnd2luZG93JyB3aWxsIGJlIHByaXZhdGUKKGZ1bmN0aW9uKCl7Cgp2YXIgY2FjaGU7CnZhciByZXF1ZXN0UXVldWUgPSB7fTsKCndpbmRvdy5wb3J0YWxEZXRhaWwgPSBmdW5jdGlvbigpIHt9OwoKd2luZG93LnBvcnRhbERldGFpbC5zZXR1cCA9IGZ1bmN0aW9uKCkgewogIGNhY2hlID0gbmV3IERhdGFDYWNoZSgpOwoKICBjYWNoZS5zdGFydEV4cGlyZUludGVydmFsKDIwKTsKfQoKd2luZG93LnBvcnRhbERldGFpbC5nZXQgPSBmdW5jdGlvbihndWlkKSB7CiAgcmV0dXJuIGNhY2hlLmdldChndWlkKTsKfQoKd2luZG93LnBvcnRhbERldGFpbC5pc0ZyZXNoID0gZnVuY3Rpb24oZ3VpZCkgewogIHJldHVybiBjYWNoZS5pc0ZyZXNoKGd1aWQpOwp9CgoKdmFyIGhhbmRsZVJlc3BvbnNlID0gZnVuY3Rpb24oZ3VpZCwgZGF0YSwgc3VjY2VzcykgewogIGRlbGV0ZSByZXF1ZXN0UXVldWVbZ3VpZF07CgogIGlmICghZGF0YSB8fCBkYXRhLmVycm9yIHx8ICFkYXRhLnJlc3VsdCkgewogICAgc3VjY2VzcyA9IGZhbHNlOwogIH0KCiAgaWYgKHN1Y2Nlc3MpIHsKCiAgICB2YXIgZGljdCA9IGRlY29kZUFycmF5LnBvcnRhbERldGFpbChkYXRhLnJlc3VsdCk7CgogICAgLy8gZW50aXR5IGZvcm1hdCwgYXMgdXNlZCBpbiBtYXAgZGF0YQogICAgdmFyIGVudCA9IFtndWlkLGRpY3QudGltZXN0YW1wLGRhdGEucmVzdWx0XTsKCiAgICBjYWNoZS5zdG9yZShndWlkLGRpY3QpOwoKICAgIC8vRklYTUUuLj8gYmV0dGVyIHdheSBvZiBoYW5kbGluZyBzaWRlYmFyIHJlZnJlc2hpbmcuLi4KCiAgICBpZiAoZ3VpZCA9PSBzZWxlY3RlZFBvcnRhbCkgewogICAgICByZW5kZXJQb3J0YWxEZXRhaWxzKGd1aWQpOwogICAgfQoKICAgIHdpbmRvdy5ydW5Ib29rcyAoJ3BvcnRhbERldGFpbExvYWRlZCcsIHtndWlkOmd1aWQsIHN1Y2Nlc3M6c3VjY2VzcywgZGV0YWlsczpkaWN0LCBlbnQ6ZW50fSk7CgogIH0gZWxzZSB7CiAgICBpZiAoZGF0YSAmJiBkYXRhLmVycm9yID09ICJSRVRSWSIpIHsKICAgICAgLy8gc2VydmVyIGFza2VkIHVzIHRvIHRyeSBhZ2FpbgogICAgICBwb3J0YWxEZXRhaWwucmVxdWVzdChndWlkKTsKICAgIH0gZWxzZSB7CiAgICAgIHdpbmRvdy5ydW5Ib29rcyAoJ3BvcnRhbERldGFpbExvYWRlZCcsIHtndWlkOmd1aWQsIHN1Y2Nlc3M6c3VjY2Vzc30pOwogICAgfQogIH0KCn0KCndpbmRvdy5wb3J0YWxEZXRhaWwucmVxdWVzdCA9IGZ1bmN0aW9uKGd1aWQpIHsKICBpZiAoIXJlcXVlc3RRdWV1ZVtndWlkXSkgewogICAgcmVxdWVzdFF1ZXVlW2d1aWRdID0gdHJ1ZTsKCiAgICB3aW5kb3cucG9zdEFqYXgoJ2dldFBvcnRhbERldGFpbHMnLCB7Z3VpZDpndWlkfSwKICAgICAgZnVuY3Rpb24oZGF0YSx0ZXh0U3RhdHVzLGpxWEhSKSB7IGhhbmRsZVJlc3BvbnNlKGd1aWQsIGRhdGEsIHRydWUpOyB9LAogICAgICBmdW5jdGlvbigpIHsgaGFuZGxlUmVzcG9uc2UoZ3VpZCwgdW5kZWZpbmVkLCBmYWxzZSk7IH0KICAgICk7CiAgfQoKfQoKCgp9KSgpOyAvLyBhbm9ueW1vdXMgd3JhcHBlciBmdW5jdGlvbiBlbmQKCgoKCjsKCi8vIFBPUlRBTCBERVRBSUxTIE1BSU4gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gbWFpbiBjb2RlIGJsb2NrIHRoYXQgcmVuZGVycyB0aGUgcG9ydGFsIGRldGFpbHMgaW4gdGhlIHNpZGViYXIgYW5kCi8vIG1ldGhvZHMgdGhhdCBoaWdobGlnaHQgdGhlIHBvcnRhbCBpbiB0aGUgbWFwIHZpZXcuCgp3aW5kb3cucmVuZGVyUG9ydGFsRGV0YWlscyA9IGZ1bmN0aW9uKGd1aWQpIHsKICBzZWxlY3RQb3J0YWwod2luZG93LnBvcnRhbHNbZ3VpZF0gPyBndWlkIDogbnVsbCk7CgogIGlmIChndWlkICYmICFwb3J0YWxEZXRhaWwuaXNGcmVzaChndWlkKSkgewogICAgcG9ydGFsRGV0YWlsLnJlcXVlc3QoZ3VpZCk7CiAgfQoKICAvLyBUT0RPPyBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgd2UgcmVxdWVzdCBkYXRhIGZvciBhIHBhcnRpY3VsYXIgcG9ydGFsIEdVSUQsIGJ1dCBpdCAqaXNuJ3QqIGluCiAgLy8gd2luZG93LnBvcnRhbHMuLi4uCgogIGlmKCF3aW5kb3cucG9ydGFsc1tndWlkXSkgewogICAgdXJsUG9ydGFsID0gZ3VpZDsKICAgICQoJyNwb3J0YWxkZXRhaWxzJykuaHRtbCgnJyk7CiAgICBpZihpc1NtYXJ0cGhvbmUoKSkgewogICAgICAkKCcuZnVsbGltZycpLnJlbW92ZSgpOwogICAgICAkKCcjbW9iaWxlaW5mbycpLmh0bWwoJzxkaXYgc3R5bGU9InRleHQtYWxpZ246IGNlbnRlciI+PGI+dGFwIGhlcmUgZm9yIGluZm8gc2NyZWVuPC9iPjwvZGl2PicpOwogICAgfQogICAgcmV0dXJuOwogIH0KCiAgdmFyIHBvcnRhbCA9IHdpbmRvdy5wb3J0YWxzW2d1aWRdOwogIHZhciBkYXRhID0gcG9ydGFsLm9wdGlvbnMuZGF0YTsKICB2YXIgZGV0YWlscyA9IHBvcnRhbERldGFpbC5nZXQoZ3VpZCk7CgogIC8vIGRldGFpbHMgYW5kIGRhdGEgY2FuIGdldCBvdXQgb2Ygc3luYy4gaWYgd2UgaGF2ZSBkZXRhaWxzLCBjb25zdHJ1Y3QgYSBtYXRjaGluZyAnZGF0YScKICBpZiAoZGV0YWlscykgewogICAgZGF0YSA9IGdldFBvcnRhbFN1bW1hcnlEYXRhKGRldGFpbHMpOwogIH0KCgogIHZhciBtb2REZXRhaWxzID0gZGV0YWlscyA/ICc8ZGl2IGNsYXNzPSJtb2RzIj4nK2dldE1vZERldGFpbHMoZGV0YWlscykrJzwvZGl2PicgOiAnJzsKICB2YXIgbWlzY0RldGFpbHMgPSBkZXRhaWxzID8gZ2V0UG9ydGFsTWlzY0RldGFpbHMoZ3VpZCxkZXRhaWxzKSA6ICcnOwogIHZhciByZXNvRGV0YWlscyA9IGRldGFpbHMgPyBnZXRSZXNvbmF0b3JEZXRhaWxzKGRldGFpbHMpIDogJyc7CgovL1RPRE8/IG90aGVyIHN0YXR1cyBkZXRhaWxzLi4uCiAgdmFyIHN0YXR1c0RldGFpbHMgPSBkZXRhaWxzID8gJycgOiAnPGRpdiBpZD0icG9ydGFsU3RhdHVzIj5Mb2FkaW5nIGRldGFpbHMuLi48L2Rpdj4nOwogCgogIHZhciBpbWcgPSBmaXhQb3J0YWxJbWFnZVVybChkZXRhaWxzID8gZGV0YWlscy5pbWFnZSA6IGRhdGEuaW1hZ2UpOwogIHZhciB0aXRsZSA9IChkZXRhaWxzICYmIGRldGFpbHMudGl0bGUpIHx8IChkYXRhICYmIGRhdGEudGl0bGUpIHx8ICcodW50aXRsZWQpJzsKCiAgdmFyIGxhdCA9IGRhdGEubGF0RTYvMUU2OwogIHZhciBsbmcgPSBkYXRhLmxuZ0U2LzFFNjsKCiAgdmFyIGltZ1RpdGxlID0gdGl0bGUrJ1xuXG5DbGljayB0byBzaG93IGZ1bGwgaW1hZ2UuJzsKCgogIC8vIHBvcnRhbCBsZXZlbC4gc3RhcnQgd2l0aCBiYXNpYyBkYXRhIC0gdGhlbiBleHRlbmQgd2l0aCBmcmFjdGlvbmFsIGluZm8gaW4gdG9vbHRpcCBpZiBhdmFpbGFibGUKICB2YXIgbGV2ZWxJbnQgPSAodGVhbVN0cmluZ1RvSWQoZGF0YS50ZWFtKSA9PSBURUFNX05PTkUpID8gMCA6IGRhdGEubGV2ZWw7CiAgdmFyIGxldmVsRGV0YWlscyA9IGxldmVsSW50OwogIGlmIChkZXRhaWxzKSB7CiAgICBsZXZlbERldGFpbHMgPSBnZXRQb3J0YWxMZXZlbChkZXRhaWxzKTsKICAgIGlmKGxldmVsRGV0YWlscyAhPSA4KSB7CiAgICAgIGlmKGxldmVsRGV0YWlscz09TWF0aC5jZWlsKGxldmVsRGV0YWlscykpCiAgICAgICAgbGV2ZWxEZXRhaWxzICs9ICJcbjgiOwogICAgICBlbHNlCiAgICAgICAgbGV2ZWxEZXRhaWxzICs9ICJcbiIgKyAoTWF0aC5jZWlsKGxldmVsRGV0YWlscykgLSBsZXZlbERldGFpbHMpKjg7CiAgICAgIGxldmVsRGV0YWlscyArPSAiIHJlc29uYXRvciBsZXZlbChzKSBuZWVkZWQgZm9yIG5leHQgcG9ydGFsIGxldmVsIjsKICAgIH0gZWxzZSB7CiAgICAgIGxldmVsRGV0YWlscyArPSAiXG5mdWxseSB1cGdyYWRlZCI7CiAgICB9CiAgfQogIGxldmVsRGV0YWlscyA9ICJMZXZlbCAiICsgbGV2ZWxEZXRhaWxzOwoKCiAgdmFyIGxpbmtEZXRhaWxzID0gW107CgogIHZhciBwb3NPbkNsaWNrID0gJ3dpbmRvdy5zaG93UG9ydGFsUG9zTGlua3MoJytsYXQrJywnK2xuZysnLFwnJytlc2NhcGVKYXZhc2NyaXB0U3RyaW5nKHRpdGxlKSsnXCcpJzsKICB2YXIgcGVybWFsaW5rVXJsID0gJy9pbnRlbD9sbD0nK2xhdCsnLCcrbG5nKycmej0xNyZwbGw9JytsYXQrJywnK2xuZzsKCiAgaWYgKHR5cGVvZiBhbmRyb2lkICE9PSAndW5kZWZpbmVkJyAmJiBhbmRyb2lkICYmIGFuZHJvaWQuaW50ZW50UG9zTGluaykgewogICAgLy8gYW5kcm9pZCBkZXZpY2VzLiBvbmUgc2hhcmUgbGluayBvcHRpb24gLSBhbmQgdGhlIGFuZHJvaWQgYXBwIHByb3ZpZGVzIGFuIGludGVyZmFjZSB0byBzaGFyZSB0aGUgVVJMLAogICAgLy8gc2hhcmUgYXMgYSBnZW86IGludGVudCAobmF2aWdhdGlvbiB2aWEgZ29vZ2xlIG1hcHMpLCBldGMKCiAgICB2YXIgc2hhcmVMaW5rID0gJCgnPGRpdj4nKS5odG1sKCAkKCc8YT4nKS5hdHRyKHtvbmNsaWNrOnBvc09uQ2xpY2t9KS50ZXh0KCdTaGFyZSBwb3J0YWwnKSApLmh0bWwoKTsKICAgIGxpbmtEZXRhaWxzLnB1c2goJzxhc2lkZT4nK3NoYXJlTGluaysnPC9hc2lkZT4nKTsKCiAgfSBlbHNlIHsKICAgIC8vIG5vbi1hbmRyb2lkIC0gYSBwZXJtYWxpbmsgZm9yIHRoZSBwb3J0YWwKICAgIHZhciBwZXJtYUh0bWwgPSAkKCc8ZGl2PicpLmh0bWwoICQoJzxhPicpLmF0dHIoe2hyZWY6cGVybWFsaW5rVXJsLCB0aXRsZTonQ3JlYXRlIGEgVVJMIGxpbmsgdG8gdGhpcyBwb3J0YWwnfSkudGV4dCgnUG9ydGFsIGxpbmsnKSApLmh0bWwoKTsKICAgIGxpbmtEZXRhaWxzLnB1c2ggKCAnPGFzaWRlPicrcGVybWFIdG1sKyc8L2FzaWRlPicgKTsKCiAgICAvLyBhbmQgYSBtYXAgbGluayBwb3B1cCBkaWFsb2cKICAgIHZhciBtYXBIdG1sID0gJCgnPGRpdj4nKS5odG1sKCAkKCc8YT4nKS5hdHRyKHtvbmNsaWNrOnBvc09uQ2xpY2ssIHRpdGxlOidMaW5rIHRvIGFsdGVybmF0aXZlIG1hcHMgKEdvb2dsZSwgZXRjKSd9KS50ZXh0KCdNYXAgbGlua3MnKSApLmh0bWwoKTsKICAgIGxpbmtEZXRhaWxzLnB1c2goJzxhc2lkZT4nK21hcEh0bWwrJzwvYXNpZGU+Jyk7CgogIH0KCiAgJCgnI3BvcnRhbGRldGFpbHMnKQogICAgLmh0bWwoJycpIC8vdG8gZW5zdXJlIGl0J3MgY2xlYXIKICAgIC5hdHRyKCdjbGFzcycsIFRFQU1fVE9fQ1NTW3RlYW1TdHJpbmdUb0lkKGRhdGEudGVhbSldKQogICAgLmFwcGVuZCgKICAgICAgJCgnPGgzPicpLmF0dHIoe2NsYXNzOid0aXRsZSd9KS50ZXh0KHRpdGxlKSwKCiAgICAgICQoJzxzcGFuPicpLmF0dHIoewogICAgICAgIGNsYXNzOiAnY2xvc2UnLAogICAgICAgIHRpdGxlOiAnQ2xvc2UgW3ddJywKICAgICAgICBvbmNsaWNrOidyZW5kZXJQb3J0YWxEZXRhaWxzKG51bGwpOyBpZihpc1NtYXJ0cGhvbmUoKSkgc2hvdygibWFwIik7JywKICAgICAgICBhY2Nlc3NrZXk6ICd3JwogICAgICB9KS50ZXh0KCdYJyksCgogICAgICAvLyBoZWxwIGN1cnNvciB2aWEgIi5pbWdwcmV2aWV3IGltZyIKICAgICAgJCgnPGRpdj4nKQogICAgICAuYXR0cih7Y2xhc3M6J2ltZ3ByZXZpZXcnLCB0aXRsZTppbWdUaXRsZSwgc3R5bGU6ImJhY2tncm91bmQtaW1hZ2U6IHVybCgnIitpbWcrIicpIn0pCiAgICAgIC5hcHBlbmQoCiAgICAgICAgJCgnPHNwYW4+JykuYXR0cih7aWQ6J2xldmVsJywgdGl0bGU6IGxldmVsRGV0YWlsc30pLnRleHQobGV2ZWxJbnQpLAogICAgICAgICQoJzxpbWc+JykuYXR0cih7Y2xhc3M6J2hpZGUnLCBzcmM6aW1nfSkKICAgICAgKSwKCiAgICAgIG1vZERldGFpbHMsCiAgICAgIG1pc2NEZXRhaWxzLAogICAgICByZXNvRGV0YWlscywKICAgICAgc3RhdHVzRGV0YWlscywKICAgICAgJzxkaXYgY2xhc3M9ImxpbmtkZXRhaWxzIj4nICsgbGlua0RldGFpbHMuam9pbignJykgKyAnPC9kaXY+JwogICAgKTsKCiAgLy8gb25seSBydW4gdGhlIGhvb2tzIHdoZW4gd2UgaGF2ZSBhIHBvcnRhbERldGFpbHMgb2JqZWN0IC0gbW9zdCBwbHVnaW5zIHJlbHkgb24gdGhlIGV4dGVuZGVkIGRhdGEKICAvLyBUT0RPPyBhbm90aGVyIGhvb2sgdG8gY2FsbCBhbHdheXMsIGZvciBhbnkgcGx1Z2lucyB0aGF0IGNhbiB3b3JrIHdpdGggbGVzcyBkYXRhPwogIGlmIChkZXRhaWxzKSB7CiAgICBydW5Ib29rcygncG9ydGFsRGV0YWlsc1VwZGF0ZWQnLCB7Z3VpZDogZ3VpZCwgcG9ydGFsOiBwb3J0YWwsIHBvcnRhbERldGFpbHM6IGRldGFpbHMsIHBvcnRhbERhdGE6IGRhdGF9KTsKICB9Cn0KCgoKd2luZG93LmdldFBvcnRhbE1pc2NEZXRhaWxzID0gZnVuY3Rpb24oZ3VpZCxkKSB7CgogIHZhciByYW5kRGV0YWlsczsKCiAgaWYgKGQpIHsKCiAgICAvLyBjb2xsZWN0IHNvbWUgcmFuZG9tIGRhdGEgdGhhdOKAmXMgbm90IHdvcnRoIHRvIHB1dCBpbiBhbiBvd24gbWV0aG9kCiAgICB2YXIgbGlua0luZm8gPSBnZXRQb3J0YWxMaW5rcyhndWlkKTsKICAgIHZhciBtYXhPdXRnb2luZyA9IGdldE1heE91dGdvaW5nTGlua3MoZCk7CiAgICB2YXIgbGlua0NvdW50ID0gbGlua0luZm8uaW4ubGVuZ3RoICsgbGlua0luZm8ub3V0Lmxlbmd0aDsKICAgIHZhciBsaW5rcyA9IHtpbmNvbWluZzogbGlua0luZm8uaW4ubGVuZ3RoLCBvdXRnb2luZzogbGlua0luZm8ub3V0Lmxlbmd0aH07CgogICAgdmFyIHRpdGxlID0gJ2F0IG1vc3QgJyArIG1heE91dGdvaW5nICsgJyBvdXRnb2luZyBsaW5rc1xuJyArCiAgICAgICAgICAgICAgICBsaW5rcy5vdXRnb2luZyArICcgbGlua3Mgb3V0XG4nICsKICAgICAgICAgICAgICAgIGxpbmtzLmluY29taW5nICsgJyBsaW5rcyBpblxuJyArCiAgICAgICAgICAgICAgICAnKCcgKyAobGlua3Mub3V0Z29pbmcrbGlua3MuaW5jb21pbmcpICsgJyB0b3RhbCknCiAgICB2YXIgbGlua3NUZXh0ID0gWydsaW5rcycsIGxpbmtzLm91dGdvaW5nKycgb3V0IC8gJytsaW5rcy5pbmNvbWluZysnIGluJywgdGl0bGVdOwoKICAgIHZhciBwbGF5ZXIgPSBkLm93bmVyCiAgICAgID8gJzxzcGFuIGNsYXNzPSJuaWNrbmFtZSI+JyArIGQub3duZXIgKyAnPC9zcGFuPicKICAgICAgOiAnLSc7CiAgICB2YXIgcGxheWVyVGV4dCA9IFsnb3duZXInLCBwbGF5ZXJdOwoKCiAgICB2YXIgZmllbGRDb3VudCA9IGdldFBvcnRhbEZpZWxkc0NvdW50KGd1aWQpOwoKICAgIHZhciBmaWVsZHNUZXh0ID0gWydmaWVsZHMnLCBmaWVsZENvdW50XTsKCiAgICB2YXIgYXBHYWluVGV4dCA9IGdldEF0dGFja0FwR2FpblRleHQoZCxmaWVsZENvdW50LGxpbmtDb3VudCk7CgogICAgdmFyIGF0dGFja1ZhbHVlcyA9IGdldFBvcnRhbEF0dGFja1ZhbHVlcyhkKTsKCgogICAgLy8gY29sbGVjdCBhbmQgaHRtbC1pZnkgcmFuZG9tIGRhdGEKCiAgICB2YXIgcmFuZERldGFpbHNEYXRhID0gWwogICAgICAvLyB0aGVzZSBwaWVjZXMgb2YgZGF0YSBhcmUgb25seSByZWxldmFudCB3aGVuIHRoZSBwb3J0YWwgaXMgY2FwdHVyZWQKICAgICAgLy8gbWF5YmUgY2hlY2sgaWYgcG9ydGFsIGlzIGNhcHR1cmVkIGFuZCByZW1vdmU/CiAgICAgIC8vIEJ1dCB0aGlzIG1ha2VzIHRoZSBpbmZvIHBhbmVsIGxvb2sgcmF0aGVyIGVtcHR5IGZvciB1bmNsYWltZWQgcG9ydGFscwogICAgICBwbGF5ZXJUZXh0LCBnZXRSYW5nZVRleHQoZCksCiAgICAgIGxpbmtzVGV4dCwgZmllbGRzVGV4dCwKICAgICAgZ2V0TWl0aWdhdGlvblRleHQoZCxsaW5rQ291bnQpLCBnZXRFbmVyZ3lUZXh0KGQpLAogICAgICAvLyBhbmQgdGhlc2UgaGF2ZSBzb21lIHVzZSwgZXZlbiBmb3IgdW5jYXB0dXJlZCBwb3J0YWxzCiAgICAgIGFwR2FpblRleHQsIGdldEhhY2tEZXRhaWxzVGV4dChkKSwKICAgIF07CgogICAgaWYoYXR0YWNrVmFsdWVzLmF0dGFja19mcmVxdWVuY3kgIT0gMCkKICAgICAgcmFuZERldGFpbHNEYXRhLnB1c2goWwogICAgICAgICc8c3BhbiB0aXRsZT0iYXR0YWNrIGZyZXF1ZW5jeSIgY2xhc3M9InRleHQtb3ZlcmZsb3ctZWxsaXBzaXMiPmF0dGFjayBmcmVxdWVuY3k8L3NwYW4+JywKICAgICAgICAnw5cnK2F0dGFja1ZhbHVlcy5hdHRhY2tfZnJlcXVlbmN5XSk7CiAgICBpZihhdHRhY2tWYWx1ZXMuaGl0X2JvbnVzICE9IDApCiAgICAgIHJhbmREZXRhaWxzRGF0YS5wdXNoKFsnaGl0IGJvbnVzJywgYXR0YWNrVmFsdWVzLmhpdF9ib251cysnJSddKTsKICAgIGlmKGF0dGFja1ZhbHVlcy5mb3JjZV9hbXBsaWZpZXIgIT0gMCkKICAgICAgcmFuZERldGFpbHNEYXRhLnB1c2goWwogICAgICAgICc8c3BhbiB0aXRsZT0iZm9yY2UgYW1wbGlmaWVyIiBjbGFzcz0idGV4dC1vdmVyZmxvdy1lbGxpcHNpcyI+Zm9yY2UgYW1wbGlmaWVyPC9zcGFuPicsCiAgICAgICAgJ8OXJythdHRhY2tWYWx1ZXMuZm9yY2VfYW1wbGlmaWVyXSk7CgogICAgcmFuZERldGFpbHMgPSAnPHRhYmxlIGlkPSJyYW5kZGV0YWlscyI+JyArIGdlbkZvdXJDb2x1bW5UYWJsZShyYW5kRGV0YWlsc0RhdGEpICsgJzwvdGFibGU+JzsKCgogICAgLy8gYXJ0aWZhY3RzIC0gdGFja2VkIG9uIGFmdGVyIChidXQgbm90IGFzIHBhcnQgb2YpIHRoZSAncmFuZGRldGFpbHMnIHRhYmxlCiAgICAvLyBpbnN0ZWFkIG9mIHVzaW5nIHRoZSBleGlzdGluZyBjb2x1bW5zLi4uLgoKICAgIGlmIChkLmFydGlmYWN0QnJpZWYgJiYgZC5hcnRpZmFjdEJyaWVmLnRhcmdldCAmJiBPYmplY3Qua2V5cyhkLmFydGlmYWN0QnJpZWYudGFyZ2V0KS5sZW5ndGggPiAwKSB7CiAgICAgIHZhciB0YXJnZXRzID0gT2JqZWN0LmtleXMoZC5hcnRpZmFjdEJyaWVmLnRhcmdldCk7Ci8vY3VycmVudGx5ICgyMDE1LTA3LTEwKSB3ZSBubyBsb25nZXIga25vdyB0aGUgdGVhbSBlYWNoIHRhcmdldCBwb3J0YWwgaXMgZm9yIC0gc28gd2UnbGwganVzdCBzaG93IHRoZSBhcnRpZmFjdCB0eXBlKHMpIAogICAgICAgcmFuZERldGFpbHMgKz0gJzxkaXYgaWQ9ImFydGlmYWN0X3RhcmdldCI+VGFyZ2V0IHBvcnRhbDogJyt0YXJnZXRzLm1hcChmdW5jdGlvbih4KSB7IHJldHVybiB4LmNhcGl0YWxpemUoKTsgfSkuam9pbignLCAnKSsnPC9kaXY+JzsKICAgIH0KCiAgICAvLyBzaGFyZHMgLSB0YWtlbiBkaXJlY3RseSBmcm9tIHRoZSBwb3J0YWwgZGV0YWlscwogICAgaWYgKGQuYXJ0aWZhY3REZXRhaWwpIHsKICAgICAgcmFuZERldGFpbHMgKz0gJzxkaXYgaWQ9ImFydGlmYWN0X2ZyYWdtZW50cyI+U2hhcmRzOiAnK2QuYXJ0aWZhY3REZXRhaWwuZGlzcGxheU5hbWUrJyAjJytkLmFydGlmYWN0RGV0YWlsLmZyYWdtZW50cy5qb2luKCcsICcpKyc8L2Rpdj4nOwogICAgfQoKICB9CgogIHJldHVybiByYW5kRGV0YWlsczsKfQoKCi8vIGRyYXdzIGxpbmstcmFuZ2UgYW5kIGhhY2stcmFuZ2UgY2lyY2xlcyBhcm91bmQgdGhlIHBvcnRhbCB3aXRoIHRoZQovLyBnaXZlbiBkZXRhaWxzLiBDbGVhciB0aGVtIGlmIHBhcmFtZXRlciAnZCcgaXMgbnVsbC4Kd2luZG93LnNldFBvcnRhbEluZGljYXRvcnMgPSBmdW5jdGlvbihwKSB7CgogIGlmKHBvcnRhbFJhbmdlSW5kaWNhdG9yKSBtYXAucmVtb3ZlTGF5ZXIocG9ydGFsUmFuZ2VJbmRpY2F0b3IpOwogIHBvcnRhbFJhbmdlSW5kaWNhdG9yID0gbnVsbDsKICBpZihwb3J0YWxBY2Nlc3NJbmRpY2F0b3IpIG1hcC5yZW1vdmVMYXllcihwb3J0YWxBY2Nlc3NJbmRpY2F0b3IpOwogIHBvcnRhbEFjY2Vzc0luZGljYXRvciA9IG51bGw7CgogIC8vIGlmIHdlIGhhdmUgYSBwb3J0YWwuLi4KCiAgaWYocCkgewogICAgdmFyIGNvb3JkID0gcC5nZXRMYXRMbmcoKTsKCiAgICAvLyByYW5nZSBpcyBvbmx5IGtub3duIGZvciBzdXJlIGlmIHdlIGhhdmUgcG9ydGFsIGRldGFpbHMKICAgIC8vIFRPRE8/IHJlbmRlciBhIG1pbiByYW5nZSBndWVzcyB1bnRpbCBkZXRhaWxzIGFyZSBsb2FkZWQuLj8KCiAgICB2YXIgZCA9IHBvcnRhbERldGFpbC5nZXQocC5vcHRpb25zLmd1aWQpOwogICAgaWYgKGQpIHsKICAgICAgdmFyIHJhbmdlID0gZ2V0UG9ydGFsUmFuZ2UoZCk7CiAgICAgIHBvcnRhbFJhbmdlSW5kaWNhdG9yID0gKHJhbmdlLnJhbmdlID4gMAogICAgICAgICAgPyBMLmdlb2Rlc2ljQ2lyY2xlKGNvb3JkLCByYW5nZS5yYW5nZSwgewogICAgICAgICAgICAgIGZpbGw6IGZhbHNlLAogICAgICAgICAgICAgIGNvbG9yOiBSQU5HRV9JTkRJQ0FUT1JfQ09MT1IsCiAgICAgICAgICAgICAgd2VpZ2h0OiAzLAogICAgICAgICAgICAgIGRhc2hBcnJheTogcmFuZ2UuaXNMaW5rYWJsZSA/IHVuZGVmaW5lZCA6ICIxMCwxMCIsCiAgICAgICAgICAgICAgY2xpY2thYmxlOiBmYWxzZSB9KQogICAgICAgICAgOiBMLmNpcmNsZShjb29yZCwgcmFuZ2UucmFuZ2UsIHsgZmlsbDogZmFsc2UsIHN0cm9rZTogZmFsc2UsIGNsaWNrYWJsZTogZmFsc2UgfSkKICAgICAgICApLmFkZFRvKG1hcCk7CiAgICB9CgogICAgcG9ydGFsQWNjZXNzSW5kaWNhdG9yID0gTC5jaXJjbGUoY29vcmQsIEhBQ0tfUkFOR0UsCiAgICAgIHsgZmlsbDogZmFsc2UsIGNvbG9yOiBBQ0NFU1NfSU5ESUNBVE9SX0NPTE9SLCB3ZWlnaHQ6IDIsIGNsaWNrYWJsZTogZmFsc2UgfQogICAgKS5hZGRUbyhtYXApOwogIH0KCn0KCi8vIGhpZ2hsaWdodHMgcG9ydGFsIHdpdGggZ2l2ZW4gR1VJRC4gQXV0b21hdGljYWxseSBjbGVhcnMgaGlnaGxpZ2h0cwovLyBvbiBvbGQgc2VsZWN0aW9uLiBSZXR1cm5zIGZhbHNlIGlmIHRoZSBzZWxlY3RlZCBwb3J0YWwgY2hhbmdlZC4KLy8gUmV0dXJucyB0cnVlIGlmIGl0J3Mgc3RpbGwgdGhlIHNhbWUgcG9ydGFsIHRoYXQganVzdCBuZWVkcyBhbgovLyB1cGRhdGUuCndpbmRvdy5zZWxlY3RQb3J0YWwgPSBmdW5jdGlvbihndWlkKSB7CiAgdmFyIHVwZGF0ZSA9IHNlbGVjdGVkUG9ydGFsID09PSBndWlkOwogIHZhciBvbGRQb3J0YWxHdWlkID0gc2VsZWN0ZWRQb3J0YWw7CiAgc2VsZWN0ZWRQb3J0YWwgPSBndWlkOwoKICB2YXIgb2xkUG9ydGFsID0gcG9ydGFsc1tvbGRQb3J0YWxHdWlkXTsKICB2YXIgbmV3UG9ydGFsID0gcG9ydGFsc1tndWlkXTsKCiAgLy8gUmVzdG9yZSBzdHlsZSBvZiB1bnNlbGVjdGVkIHBvcnRhbAogIGlmKCF1cGRhdGUgJiYgb2xkUG9ydGFsKSBzZXRNYXJrZXJTdHlsZShvbGRQb3J0YWwsZmFsc2UpOwoKICAvLyBDaGFuZ2Ugc3R5bGUgb2Ygc2VsZWN0ZWQgcG9ydGFsCiAgaWYobmV3UG9ydGFsKSB7CiAgICBzZXRNYXJrZXJTdHlsZShuZXdQb3J0YWwsIHRydWUpOwoKICAgIGlmIChtYXAuaGFzTGF5ZXIobmV3UG9ydGFsKSkgewogICAgICBuZXdQb3J0YWwuYnJpbmdUb0Zyb250KCk7CiAgICB9CiAgfQoKICBzZXRQb3J0YWxJbmRpY2F0b3JzKG5ld1BvcnRhbCk7CgogIHJ1bkhvb2tzKCdwb3J0YWxTZWxlY3RlZCcsIHtzZWxlY3RlZFBvcnRhbEd1aWQ6IGd1aWQsIHVuc2VsZWN0ZWRQb3J0YWxHdWlkOiBvbGRQb3J0YWxHdWlkfSk7CiAgcmV0dXJuIHVwZGF0ZTsKfQoKCjsKCi8vIFBPUlRBTCBERVRBSUxTIERJU1BMQVkgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gaGFuZCBhbnkgb2YgdGhlc2UgZnVuY3Rpb25zIHRoZSBkZXRhaWxzLWhhc2ggb2YgYSBwb3J0YWwsIGFuZCB0aGV5Ci8vIHdpbGwgcmV0dXJuIHByZXR0eSwgZGlzcGxheWFibGUgSFRNTCBvciBwYXJ0cyB0aGVyZW9mLgoKLy8gcmV0dXJucyBkaXNwbGF5YWJsZSB0ZXh0K2xpbmsgYWJvdXQgcG9ydGFsIHJhbmdlCndpbmRvdy5nZXRSYW5nZVRleHQgPSBmdW5jdGlvbihkKSB7CiAgdmFyIHJhbmdlID0gZ2V0UG9ydGFsUmFuZ2UoZCk7CiAgCiAgdmFyIHRpdGxlID0gJ0Jhc2UgcmFuZ2U6XHQnICsgZGlnaXRzKE1hdGguZmxvb3IocmFuZ2UuYmFzZSkpKydtJwogICAgKyAnXG5MaW5rIGFtcCBib29zdDpcdMOXJytyYW5nZS5ib29zdAogICAgKyAnXG5SYW5nZTpcdCcrZGlnaXRzKE1hdGguZmxvb3IocmFuZ2UucmFuZ2UpKSsnbSc7CiAgCiAgaWYoIXJhbmdlLmlzTGlua2FibGUpIHRpdGxlICs9ICdcblBvcnRhbCBpcyBtaXNzaW5nIHJlc29uYXRvcnMsXG5ubyBuZXcgbGlua3MgY2FuIGJlIG1hZGUnOwogIAogIHJldHVybiBbJ3JhbmdlJywKICAgICAgJzxhIG9uY2xpY2s9IndpbmRvdy5yYW5nZUxpbmtDbGljaygpIicKICAgICsgKHJhbmdlLmlzTGlua2FibGUgPyAnJyA6ICcgc3R5bGU9InRleHQtZGVjb3JhdGlvbjpsaW5lLXRocm91Z2g7IicpCiAgICArICc+JwogICAgKyAocmFuZ2UucmFuZ2UgPiAxMDAwCiAgICAgID8gTWF0aC5mbG9vcihyYW5nZS5yYW5nZS8xMDAwKSArICcga20nCiAgICAgIDogTWF0aC5mbG9vcihyYW5nZS5yYW5nZSkgICAgICArICcgbScpCiAgICArICc8L2E+JywKICAgIHRpdGxlXTsKfQoKCi8vIGdpdmVuIHBvcnRhbCBkZXRhaWxzLCByZXR1cm5zIGh0bWwgY29kZSB0byBkaXNwbGF5IG1vZCBkZXRhaWxzLgp3aW5kb3cuZ2V0TW9kRGV0YWlscyA9IGZ1bmN0aW9uKGQpIHsKICB2YXIgbW9kcyA9IFtdOwogIHZhciBtb2RzVGl0bGUgPSBbXTsKICB2YXIgbW9kc0NvbG9yID0gW107CiAgJC5lYWNoKGQubW9kcywgZnVuY3Rpb24oaW5kLCBtb2QpIHsKICAgIHZhciBtb2ROYW1lID0gJyc7CiAgICB2YXIgbW9kVG9vbHRpcCA9ICcnOwogICAgdmFyIG1vZENvbG9yID0gJyMwMDAnOwoKICAgIGlmIChtb2QpIHsKICAgICAgLy8gYWxsIG1vZHMgc2VlbSB0byBmb2xsb3cgdGhlIHNhbWUgcGF0dGVybiBmb3IgdGhlIGRhdGEgc3RydWN0dXJlCiAgICAgIC8vIGJ1dCBsZXQncyB0cnkgYW5kIG1ha2UgdGhpcyByb2J1c3QgZW5vdWdoIHRvIGhhbmRsZSBwb3NzaWJsZSBmdXR1cmUgZGlmZmVyZW5jZXMKCiAgICAgIG1vZE5hbWUgPSBtb2QubmFtZSB8fCAnKHVua25vd24gbW9kKSc7CgogICAgICBpZiAobW9kLnJhcml0eSkgewogICAgICAgIG1vZE5hbWUgPSBtb2QucmFyaXR5LmNhcGl0YWxpemUoKS5yZXBsYWNlKC9fL2csJyAnKSArICcgJyArIG1vZE5hbWU7CiAgICAgIH0KCiAgICAgIG1vZFRvb2x0aXAgPSBtb2ROYW1lICsgJ1xuJzsKICAgICAgaWYgKG1vZC5vd25lcikgewogICAgICAgIG1vZFRvb2x0aXAgKz0gJ0luc3RhbGxlZCBieTogJysgbW9kLm93bmVyICsgJ1xuJzsKICAgICAgfQoKICAgICAgaWYgKG1vZC5zdGF0cykgewogICAgICAgIG1vZFRvb2x0aXAgKz0gJ1N0YXRzOic7CiAgICAgICAgZm9yICh2YXIga2V5IGluIG1vZC5zdGF0cykgewogICAgICAgICAgaWYgKCFtb2Quc3RhdHMuaGFzT3duUHJvcGVydHkoa2V5KSkgY29udGludWU7CiAgICAgICAgICB2YXIgdmFsID0gbW9kLnN0YXRzW2tleV07CgogICAgICAgICAgLy8gaWYgKGtleSA9PT0gJ1JFTU9WQUxfU1RJQ0tJTkVTUycgJiYgdmFsID09IDApIGNvbnRpbnVlOyAgLy8gc3RhdCBvbiBhbGwgbW9kcyByZWNlbnRseSAtIHVua25vd24gbWVhbmluZywgbm90IGRpc3BsYXllZCBpbiBzdG9jayBjbGllbnQKCiAgICAgICAgICAvLyBzcGVjaWFsIGZvcm1hdHRpbmcgZm9yIGtub3duIG1vZCBzdGF0cywgd2hlcmUgdGhlIGRpc3BsYXkgb2YgdGhlIHJhdyB2YWx1ZSBpcyBsZXNzIHVzZWZ1bAogICAgICAgICAgaWYgICAgICAoa2V5ID09PSAnSEFDS19TUEVFRCcpICAgICAgICAgICAgdmFsID0gKHZhbC8xMDAwMCkrJyUnOyAvLyA1MDAwMDAgPSA1MCUKICAgICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ0hJVF9CT05VUycpICAgICAgICAgICAgIHZhbCA9ICh2YWwvMTAwMDApKyclJzsgLy8gMzAwMDAwID0gMzAlCiAgICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdBVFRBQ0tfRlJFUVVFTkNZJykgICAgICB2YWwgPSAodmFsLzEwMDApICsneCc7IC8vIDIwMDAgPSAyeAogICAgICAgICAgZWxzZSBpZiAoa2V5ID09PSAnRk9SQ0VfQU1QTElGSUVSJykgICAgICAgdmFsID0gKHZhbC8xMDAwKSArJ3gnOyAvLyAyMDAwID0gMngKICAgICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ0xJTktfUkFOR0VfTVVMVElQTElFUicpIHZhbCA9ICh2YWwvMTAwMCkgKyd4JzsgLy8gMjAwMCA9IDJ4CiAgICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdMSU5LX0RFRkVOU0VfQk9PU1QnKSAgICB2YWwgPSAodmFsLzEwMDApICsneCc7IC8vIDE1MDAgPSAxLjV4CiAgICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdSRU1PVkFMX1NUSUNLSU5FU1MnICYmIHZhbCA+IDEwMCkgdmFsID0gKHZhbC8xMDAwMCkrJyUnOyAvLyBhbiBlZHVjYXRlZCBndWVzcwogICAgICAgICAgLy8gZWxzZSBkaXNwbGF5IHVubW9kaWZpZWQuIGNvcnJlY3QgZm9yIHNoaWVsZCBtaXRpZ2F0aW9uIGFuZCBtdWx0aWhhY2sgLSB1bmtub3duIGZvciBmdXR1cmUvb3RoZXIgbW9kcwoKICAgICAgICAgIG1vZFRvb2x0aXAgKz0gJ1xuKycgKyAgdmFsICsgJyAnICsga2V5LmNhcGl0YWxpemUoKS5yZXBsYWNlKC9fL2csJyAnKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChtb2QucmFyaXR5KSB7CiAgICAgICAgbW9kQ29sb3IgPSBDT0xPUlNfTU9EW21vZC5yYXJpdHldOwogICAgICB9IGVsc2UgewogICAgICAgIG1vZENvbG9yID0gJyNmZmYnOwogICAgICB9CiAgICB9CgogICAgbW9kcy5wdXNoKG1vZE5hbWUpOwogICAgbW9kc1RpdGxlLnB1c2gobW9kVG9vbHRpcCk7CiAgICBtb2RzQ29sb3IucHVzaChtb2RDb2xvcik7CiAgfSk7CgoKICB2YXIgdCA9ICcnOwogIGZvciAodmFyIGk9MDsgaTxtb2RzLmxlbmd0aDsgaSsrKSB7CiAgICB0ICs9ICc8c3BhbicrKG1vZHNUaXRsZVtpXS5sZW5ndGggPyAnIHRpdGxlPSInK21vZHNUaXRsZVtpXSsnIicgOiAnJykrJyBzdHlsZT0iY29sb3I6Jyttb2RzQ29sb3JbaV0rJyI+Jyttb2RzW2ldKyc8L3NwYW4+JwogIH0KICAvLyBhbmQgYWRkIGJsYW5rIGVudHJpZXMgaWYgd2UgaGF2ZSBsZXNzIHRoYW4gNCBtb2RzIChhcyB0aGUgc2VydmVyIG5vIGxvbmdlciByZXR1cm5zIGFsbCBtb2Qgc2xvdHMsIGJ1dCBqdXN0IHRoZSBmaWxsZWQgb25lcykKICBmb3IgKHZhciBpPW1vZHMubGVuZ3RoOyBpPDQ7IGkrKykgewogICAgdCArPSAnPHNwYW4gc3R5bGU9ImNvbG9yOiMwMDAiPjwvc3Bhbj4nCiAgfQoKICByZXR1cm4gdDsKfQoKd2luZG93LmdldEVuZXJneVRleHQgPSBmdW5jdGlvbihkKSB7CiAgdmFyIGN1cnJlbnROcmcgPSBnZXRDdXJyZW50UG9ydGFsRW5lcmd5KGQpOwogIHZhciB0b3RhbE5yZyA9IGdldFRvdGFsUG9ydGFsRW5lcmd5KGQpOwogIHZhciB0aXRsZSA9IGN1cnJlbnROcmcgKyAnIC8gJyArIHRvdGFsTnJnOwogIHZhciBmaWxsID0gcHJldHR5RW5lcmd5KGN1cnJlbnROcmcpICsgJyAvICcgKyBwcmV0dHlFbmVyZ3kodG90YWxOcmcpCiAgcmV0dXJuIFsnZW5lcmd5JywgZmlsbCwgdGl0bGVdOwp9CgoKd2luZG93LmdldFJlc29uYXRvckRldGFpbHMgPSBmdW5jdGlvbihkKSB7CiAgdmFyIHJlc29EZXRhaWxzID0gW107CiAgLy8gb2N0YW50PXNsb3Q6IDA9RSwgMT1ORSwgMj1OLCAzPU5XLCA0PVcsIDU9U1csIDY9UywgU0U9NwogIC8vIHJlc29zIGluIHRoZSBkaXNwbGF5IHNob3VsZCBiZSBvcmRlcmVkIGxpa2UgdGhpczoKICAvLyAgIE4gICAgTkUgICAgICAgICBTaW5jZSB0aGUgdmlldyBpcyBkaXNwbGF5ZWQgaW4gcm93cywgdGhleQogIC8vICBOVyAgICBFICAgICAgICAgIG5lZWQgdG8gYmUgb3JkZXJlZCBsaWtlIHRoaXM6IE4gTkUgTlcgRSBXIFNFIFNXIFMKICAvLyAgIFcgICAgU0UgICAgICAgICBpLmUuIDIgMSAzIDAgNCA3IDUgNgogIC8vICBTVyAgICBTCiAgLy8gbm90ZTogYXMgb2YgMjAxNC0wNS0yMyB1cGRhdGUsIHRoaXMgaXMgbm90IHRydWUgZm9yIHBvcnRhbHMgd2l0aCBlbXB0eSBzbG90cyEKCiAgdmFyIHByb2Nlc3NSZXNvbmF0b3JTbG90ID0gZnVuY3Rpb24ocmVzbyxzbG90KSB7CiAgICB2YXIgbHZsPTAsIG5yZz0wLCBvd25lcj1udWxsOwoKICAgIGlmIChyZXNvKSB7CiAgICAgIGx2bCA9IHBhcnNlSW50KHJlc28ubGV2ZWwpOwogICAgICBucmcgPSBwYXJzZUludChyZXNvLmVuZXJneSk7CiAgICAgIG93bmVyID0gcmVzby5vd25lcjsKICAgIH0KCiAgICByZXNvRGV0YWlscy5wdXNoKHJlbmRlclJlc29uYXRvckRldGFpbHMoc2xvdCwgbHZsLCBucmcsIG93bmVyKSk7CiAgfTsKCgogIC8vIGlmIGFsbCA4IHJlc29uYXRvcnMgYXJlIGRlcGxveWVkLCB3ZSBrbm93IHdoaWNoIGlzIGluIHdoaWNoIHNsb3QKCiAgaWYgKGQucmVzb25hdG9ycy5sZW5ndGggPT0gOCkgewogICAgLy8gZnVsbHkgZGVwbG95ZWQgLSB3ZSBjYW4gbWFrZSBhc3N1bXB0aW9ucyBhYm91dCBkZXBsb3ltZW50IHNsb3RzCiAgICAkLmVhY2goWzIsIDEsIDMsIDAsIDQsIDcsIDUsIDZdLCBmdW5jdGlvbihpbmQsIHNsb3QpIHsKICAgICAgcHJvY2Vzc1Jlc29uYXRvclNsb3QoZC5yZXNvbmF0b3JzW3Nsb3RdLHNsb3QpOwogICAgfSk7CiAgfSBlbHNlIHsKICAgIC8vIHBhcnRpYWxseSBkZXBsb3llZCBwb3J0YWwgLSB3ZSBjYW4gbm8gbG9uZ2VyIGZpbmQgb3V0IHdoaWNoIHJlc29uYXRvciBpcyBpbiB3aGljaCBzbG90CiAgICBmb3IodmFyIGluZD0wOyBpbmQ8ODsgaW5kKyspIHsKICAgICAgcHJvY2Vzc1Jlc29uYXRvclNsb3QoaW5kIDwgZC5yZXNvbmF0b3JzLmxlbmd0aCA/IGQucmVzb25hdG9yc1tpbmRdIDogbnVsbCwgbnVsbCk7CiAgICB9CgogIH0KCiAgcmV0dXJuICc8dGFibGUgaWQ9InJlc29kZXRhaWxzIj4nICsgZ2VuRm91ckNvbHVtblRhYmxlKHJlc29EZXRhaWxzKSArICc8L3RhYmxlPic7Cgp9CgovLyBoZWxwZXIgZnVuY3Rpb24gdGhhdCByZW5kZXJzIHRoZSBIVE1MIGZvciBhIGdpdmVuIHJlc29uYXRvci4gRG9lcwovLyBub3Qgd29yayB3aXRoIHJhdyBkZXRhaWxzLWhhc2guIE5lZWRzIGRpZ2VzdGVkIGluZm9zIGluc3RlYWQ6Ci8vIHNsb3Q6IHdoaWNoIHNsb3QgdGhpcyByZXNvbmF0b3Igb2NjdXBpZXMuIFN0YXJ0cyB3aXRoIDAgKGVhc3QpIGFuZAovLyByb3RhdGVzIGNsb2Nrd2lzZS4gU28sIGxhc3Qgb25lIGlzIDcgKHNvdXRoZWFzdCkuCndpbmRvdy5yZW5kZXJSZXNvbmF0b3JEZXRhaWxzID0gZnVuY3Rpb24oc2xvdCwgbGV2ZWwsIG5yZywgbmljaykgewogIGlmKE9DVEFOVFNbc2xvdF0gPT09ICdOJykKICAgIHZhciBjbGFzc05hbWUgPSAnbWV0ZXIgbm9ydGgnOwogIGVsc2UKICAgIHZhciBjbGFzc05hbWUgPSAnbWV0ZXInOwoKICB2YXIgbWF4ID0gUkVTT19OUkdbbGV2ZWxdOwogIHZhciBmaWxsR3JhZGUgPSBsZXZlbCA+IDAgPyBucmcvbWF4KjEwMCA6IDA7CgogIHZhciBpbmYgPSAobGV2ZWwgPiAwID8gJ2VuZXJneTpcdCcgKyBucmcgICArICcgLyAnICsgbWF4ICsgJyAoJyArIE1hdGgucm91bmQoZmlsbEdyYWRlKSArICclKVxuJwogICAgICAgICAgICAgICAgICAgICAgICArJ2xldmVsOlx0JyAgKyBsZXZlbCArICdcbicKICAgICAgICAgICAgICAgICAgICAgICAgKydvd25lcjpcdCcgICsgbmljayAgKyAnXG4nCiAgICAgICAgICAgICAgICAgICAgICAgOiAnJykKICAgICAgICAgICsgKHNsb3QgIT09IG51bGwgPyAnb2N0YW50Olx0JyArIE9DVEFOVFNbc2xvdF0gKyAnICcgKyBPQ1RBTlRTX0FSUk9XW3Nsb3RdOicnKTsKCiAgdmFyIHN0eWxlID0gZmlsbEdyYWRlID8gJ3dpZHRoOicrZmlsbEdyYWRlKyclOyBiYWNrZ3JvdW5kOicrQ09MT1JTX0xWTFtsZXZlbF0rJzsnOicnOwoKICB2YXIgY29sb3IgPSAobGV2ZWwgPCAzID8gIiM5OTAwRkYiIDogIiNGRkZGRkYiKTsKCiAgdmFyIGxiYXIgPSBsZXZlbCA+IDAgPyAnPHNwYW4gY2xhc3M9Im1ldGVyLWxldmVsIiBzdHlsZT0iY29sb3I6ICcgKyBjb2xvciArICc7Ij4gTCAnICsgbGV2ZWwgKyAnIDwvc3Bhbj4nIDogJyc7CgogIHZhciBmaWxsICA9ICc8c3BhbiBzdHlsZT0iJytzdHlsZSsnIj48L3NwYW4+JzsKCiAgdmFyIG1ldGVyID0gJzxzcGFuIGNsYXNzPSInICsgY2xhc3NOYW1lICsgJyIgdGl0bGU9IicraW5mKyciPicgKyBmaWxsICsgbGJhciArICc8L3NwYW4+JzsKCiAgbmljayA9IG5pY2sgPyAnPHNwYW4gY2xhc3M9Im5pY2tuYW1lIj4nK25pY2srJzwvc3Bhbj4nIDogbnVsbDsKICByZXR1cm4gW21ldGVyLCBuaWNrIHx8ICcnXTsKfQoKLy8gY2FsY3VsYXRlIEFQIGdhaW4gZnJvbSBkZXN0cm95aW5nIHBvcnRhbCBhbmQgdGhlbiBjYXB0dXJpbmcgaXQgYnkgZGVwbG95aW5nIHJlc29uYXRvcnMKd2luZG93LmdldEF0dGFja0FwR2FpblRleHQgPSBmdW5jdGlvbihkLGZpZWxkQ291bnQsbGlua0NvdW50KSB7CiAgdmFyIGJyZWFrZG93biA9IGdldEF0dGFja0FwR2FpbihkLGZpZWxkQ291bnQsbGlua0NvdW50KTsKICB2YXIgdG90YWxHYWluID0gYnJlYWtkb3duLmVuZW15QXA7CgogIHZhciB0ID0gJyc7CiAgaWYgKHRlYW1TdHJpbmdUb0lkKFBMQVlFUi50ZWFtKSA9PSB0ZWFtU3RyaW5nVG9JZChkLnRlYW0pKSB7CiAgICB0b3RhbEdhaW4gPSBicmVha2Rvd24uZnJpZW5kbHlBcDsKICAgIHQgKz0gJ0ZyaWVuZGx5IEFQOlx0JyArIGJyZWFrZG93bi5mcmllbmRseUFwICsgJ1xuJzsKICAgIHQgKz0gJyAgRGVwbG95ICcgKyBicmVha2Rvd24uZGVwbG95Q291bnQgKyAnLCAnOwogICAgdCArPSAnVXBncmFkZSAnICsgYnJlYWtkb3duLnVwZ3JhZGVDb3VudCArICdcbic7CiAgICB0ICs9ICdcbic7CiAgfQogIHQgKz0gJ0VuZW15IEFQOlx0JyArIGJyZWFrZG93bi5lbmVteUFwICsgJ1xuJzsKICB0ICs9ICcgIERlc3Ryb3kgQVA6XHQnICsgYnJlYWtkb3duLmRlc3Ryb3lBcCArICdcbic7CiAgdCArPSAnICBDYXB0dXJlIEFQOlx0JyArIGJyZWFrZG93bi5jYXB0dXJlQXAgKyAnXG4nOwoKICByZXR1cm4gWydBUCBHYWluJywgZGlnaXRzKHRvdGFsR2FpbiksIHRdOwp9CgoKd2luZG93LmdldEhhY2tEZXRhaWxzVGV4dCA9IGZ1bmN0aW9uKGQpIHsKICB2YXIgaGFja0RldGFpbHMgPSBnZXRQb3J0YWxIYWNrRGV0YWlscyhkKTsKCiAgdmFyIHNob3J0SGFja0luZm8gPSBoYWNrRGV0YWlscy5oYWNrcysnIEAgJytmb3JtYXRJbnRlcnZhbChoYWNrRGV0YWlscy5jb29sZG93bik7CgogIHZhciB0aXRsZSA9ICdIYWNrcyBhdmFpbGFibGUgZXZlcnkgNCBob3Vyc1xuJwogICAgICAgICAgICArICdIYWNrIGNvdW50Olx0JytoYWNrRGV0YWlscy5oYWNrcysnXG4nCiAgICAgICAgICAgICsgJ0Nvb2xkb3duIHRpbWU6XHQnK2Zvcm1hdEludGVydmFsKGhhY2tEZXRhaWxzLmNvb2xkb3duKSsnXG4nCiAgICAgICAgICAgICsgJ0J1cm5vdXQgdGltZTpcdCcrZm9ybWF0SW50ZXJ2YWwoaGFja0RldGFpbHMuYnVybm91dCk7CgogIHJldHVybiBbJ2hhY2tzJywgc2hvcnRIYWNrSW5mbywgdGl0bGVdOwp9CgoKd2luZG93LmdldE1pdGlnYXRpb25UZXh0ID0gZnVuY3Rpb24oZCxsaW5rQ291bnQpIHsKICB2YXIgbWl0aWdhdGlvbkRldGFpbHMgPSBnZXRQb3J0YWxNaXRpZ2F0aW9uRGV0YWlscyhkLGxpbmtDb3VudCk7CgogIHZhciBtaXRpZ2F0aW9uU2hvcnQgPSBtaXRpZ2F0aW9uRGV0YWlscy50b3RhbDsKICBpZiAobWl0aWdhdGlvbkRldGFpbHMuZXhjZXNzKSBtaXRpZ2F0aW9uU2hvcnQgKz0gJyAoKycrbWl0aWdhdGlvbkRldGFpbHMuZXhjZXNzKycpJzsKCiAgdmFyIHRpdGxlID0gJ1RvdGFsIHNoaWVsZGluZzpcdCcrKG1pdGlnYXRpb25EZXRhaWxzLnNoaWVsZHMrbWl0aWdhdGlvbkRldGFpbHMubGlua3MpKydcbicKICAgICAgICAgICAgKyAnLSBhY3RpdmU6XHQnK21pdGlnYXRpb25EZXRhaWxzLnRvdGFsKydcbicKICAgICAgICAgICAgKyAnLSBleGNlc3M6XHQnK21pdGlnYXRpb25EZXRhaWxzLmV4Y2VzcysnXG4nCiAgICAgICAgICAgICsgJ0Zyb21cbicKICAgICAgICAgICAgKyAnLSBzaGllbGRzOlx0JyttaXRpZ2F0aW9uRGV0YWlscy5zaGllbGRzKydcbicKICAgICAgICAgICAgKyAnLSBsaW5rczpcdCcrbWl0aWdhdGlvbkRldGFpbHMubGlua3M7CgogIHJldHVybiBbJ3NoaWVsZGluZycsIG1pdGlnYXRpb25TaG9ydCwgdGl0bGVdOwp9CgoKOwoKLy8gUG9ydGFsIEhpZ2hsaWdodGVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gdGhlc2UgZnVuY3Rpb25zIGhhbmRsZSBwb3J0YWwgaGlnaGxpZ2h0ZXJzCgovLyBhbiBvYmplY3QgbWFwcGluZyBoaWdobGlnaHRlciBuYW1lcyB0byB0aGUgb2JqZWN0IGNvbnRhaW5pbmcgY2FsbGJhY2sgZnVuY3Rpb25zCndpbmRvdy5faGlnaGxpZ2h0ZXJzID0gbnVsbDsKCi8vIHRoZSBuYW1lIG9mIHRoZSBjdXJyZW50IGhpZ2hsaWdodGVyCndpbmRvdy5fY3VycmVudF9oaWdobGlnaHRlciA9IGxvY2FsU3RvcmFnZS5wb3J0YWxfaGlnaGxpZ2h0ZXI7Cgp3aW5kb3cuX25vX2hpZ2hsaWdodGVyID0gJ05vIEhpZ2hsaWdodHMnOwoKCndpbmRvdy5hZGRQb3J0YWxIaWdobGlnaHRlciA9IGZ1bmN0aW9uKG5hbWUsIGRhdGEpIHsKICBpZihfaGlnaGxpZ2h0ZXJzID09PSBudWxsKSB7CiAgICBfaGlnaGxpZ2h0ZXJzID0ge307CiAgfQoKICAvLyBvbGQtZm9ybWF0IGhpZ2hsaWdodGVycyBqdXN0IHBhc3NlZCBhIGNhbGxiYWNrIGZ1bmN0aW9uLiB0aGlzIGlzIHRoZSBzYW1lIGFzIGp1c3QgYSBoaWdobGlnaHQgbWV0aG9kCiAgaWYgKCFkYXRhLmhpZ2hsaWdodCkgewogICAgZGF0YSA9IHtoaWdobGlnaHQ6IGRhdGF9CiAgfQoKICBfaGlnaGxpZ2h0ZXJzW25hbWVdID0gZGF0YTsKCiAgaWYgKHR5cGVvZiBhbmRyb2lkICE9PSAndW5kZWZpbmVkJyAmJiBhbmRyb2lkICYmIGFuZHJvaWQuYWRkUG9ydGFsSGlnaGxpZ2h0ZXIpCiAgICBhbmRyb2lkLmFkZFBvcnRhbEhpZ2hsaWdodGVyKG5hbWUpOwoKICBpZih3aW5kb3cuX2N1cnJlbnRfaGlnaGxpZ2h0ZXIgPT09IHVuZGVmaW5lZCkgewogICAgX2N1cnJlbnRfaGlnaGxpZ2h0ZXIgPSBuYW1lOwogIH0KCiAgaWYgKF9jdXJyZW50X2hpZ2hsaWdodGVyID09IG5hbWUpIHsKICAgIGlmICh0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCAmJiBhbmRyb2lkLnNldEFjdGl2ZUhpZ2hsaWdodGVyKQogICAgICBhbmRyb2lkLnNldEFjdGl2ZUhpZ2hsaWdodGVyKG5hbWUpOwoKICAgIC8vIGNhbGwgdGhlIHNldFNlbGVjdGVkIGNhbGxiYWNrIAogICAgaWYgKF9oaWdobGlnaHRlcnNbX2N1cnJlbnRfaGlnaGxpZ2h0ZXJdLnNldFNlbGVjdGVkKSB7CiAgICAgIF9oaWdobGlnaHRlcnNbX2N1cnJlbnRfaGlnaGxpZ2h0ZXJdLnNldFNlbGVjdGVkKHRydWUpOwogICAgfQoKICB9CiAgdXBkYXRlUG9ydGFsSGlnaGxpZ2h0ZXJDb250cm9sKCk7Cn0KCi8vIChyZSljcmVhdGVzIHRoZSBoaWdobGlnaHRlciBkcm9wZG93biBsaXN0CndpbmRvdy51cGRhdGVQb3J0YWxIaWdobGlnaHRlckNvbnRyb2wgPSBmdW5jdGlvbigpIHsKICBpZiAodHlwZW9mIGFuZHJvaWQgIT09ICd1bmRlZmluZWQnICYmIGFuZHJvaWQgJiYgYW5kcm9pZC5hZGRQb3J0YWxIaWdobGlnaHRlcikgewogICAgJCgnI3BvcnRhbF9oaWdobGlnaHRfc2VsZWN0JykucmVtb3ZlKCk7CiAgICByZXR1cm47CiAgfQoKICBpZihfaGlnaGxpZ2h0ZXJzICE9PSBudWxsKSB7CiAgICBpZigkKCcjcG9ydGFsX2hpZ2hsaWdodF9zZWxlY3QnKS5sZW5ndGggPT09IDApIHsKICAgICAgJCgiYm9keSIpLmFwcGVuZCgiPHNlbGVjdCBpZD0ncG9ydGFsX2hpZ2hsaWdodF9zZWxlY3QnPjwvc2VsZWN0PiIpOwogICAgICAkKCIjcG9ydGFsX2hpZ2hsaWdodF9zZWxlY3QiKS5jaGFuZ2UoZnVuY3Rpb24oKXsgY2hhbmdlUG9ydGFsSGlnaGxpZ2h0cygkKHRoaXMpLnZhbCgpKTt9KTsKICAgICAgJCgiLmxlYWZsZXQtdG9wLmxlYWZsZXQtbGVmdCIpLmNzcygncGFkZGluZy10b3AnLCAnMjBweCcpOwogICAgICAkKCIubGVhZmxldC1jb250cm9sLXNjYWxlLWxpbmUiKS5jc3MoJ21hcmdpbi10b3AnLCcyNXB4Jyk7CiAgICB9CiAgICAkKCIjcG9ydGFsX2hpZ2hsaWdodF9zZWxlY3QiKS5odG1sKCcnKTsKICAgICQoIiNwb3J0YWxfaGlnaGxpZ2h0X3NlbGVjdCIpLmFwcGVuZCgkKCI8b3B0aW9uPiIpLmF0dHIoJ3ZhbHVlJyxfbm9faGlnaGxpZ2h0ZXIpLnRleHQoX25vX2hpZ2hsaWdodGVyKSk7CiAgICB2YXIgaF9uYW1lcyA9IE9iamVjdC5rZXlzKF9oaWdobGlnaHRlcnMpLnNvcnQoKTsKICAgIAogICAgJC5lYWNoKGhfbmFtZXMsIGZ1bmN0aW9uKGksIG5hbWUpIHsgIAogICAgICAkKCIjcG9ydGFsX2hpZ2hsaWdodF9zZWxlY3QiKS5hcHBlbmQoJCgiPG9wdGlvbj4iKS5hdHRyKCd2YWx1ZScsbmFtZSkudGV4dChuYW1lKSk7CiAgICB9KTsKCiAgICAkKCIjcG9ydGFsX2hpZ2hsaWdodF9zZWxlY3QiKS52YWwoX2N1cnJlbnRfaGlnaGxpZ2h0ZXIpOwogIH0KfQoKd2luZG93LmNoYW5nZVBvcnRhbEhpZ2hsaWdodHMgPSBmdW5jdGlvbihuYW1lKSB7CgogIC8vIGZpcnN0IGNhbGwgYW55IHByZXZpb3VzIGhpZ2hsaWdodGVyIHNlbGVjdCBjYWxsYmFjawogIGlmIChfY3VycmVudF9oaWdobGlnaHRlciAmJiBfaGlnaGxpZ2h0ZXJzW19jdXJyZW50X2hpZ2hsaWdodGVyXSAmJiBfaGlnaGxpZ2h0ZXJzW19jdXJyZW50X2hpZ2hsaWdodGVyXS5zZXRTZWxlY3RlZCkgewogICAgX2hpZ2hsaWdodGVyc1tfY3VycmVudF9oaWdobGlnaHRlcl0uc2V0U2VsZWN0ZWQoZmFsc2UpOwogIH0KCiAgX2N1cnJlbnRfaGlnaGxpZ2h0ZXIgPSBuYW1lOwogIGlmICh0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCAmJiBhbmRyb2lkLnNldEFjdGl2ZUhpZ2hsaWdodGVyKQogICAgYW5kcm9pZC5zZXRBY3RpdmVIaWdobGlnaHRlcihuYW1lKTsKCiAgLy8gbm93IGNhbGwgdGhlIHNldFNlbGVjdGVkIGNhbGxiYWNrIGZvciB0aGUgbmV3IGhpZ2hsaWdodGVyCiAgaWYgKF9jdXJyZW50X2hpZ2hsaWdodGVyICYmIF9oaWdobGlnaHRlcnNbX2N1cnJlbnRfaGlnaGxpZ2h0ZXJdICYmIF9oaWdobGlnaHRlcnNbX2N1cnJlbnRfaGlnaGxpZ2h0ZXJdLnNldFNlbGVjdGVkKSB7CiAgICBfaGlnaGxpZ2h0ZXJzW19jdXJyZW50X2hpZ2hsaWdodGVyXS5zZXRTZWxlY3RlZCh0cnVlKTsKICB9CgogIHJlc2V0SGlnaGxpZ2h0ZWRQb3J0YWxzKCk7CiAgbG9jYWxTdG9yYWdlLnBvcnRhbF9oaWdobGlnaHRlciA9IG5hbWU7Cn0KCndpbmRvdy5oaWdobGlnaHRQb3J0YWwgPSBmdW5jdGlvbihwKSB7CiAgCiAgaWYoX2hpZ2hsaWdodGVycyAhPT0gbnVsbCAmJiBfaGlnaGxpZ2h0ZXJzW19jdXJyZW50X2hpZ2hsaWdodGVyXSAhPT0gdW5kZWZpbmVkKSB7CiAgICBfaGlnaGxpZ2h0ZXJzW19jdXJyZW50X2hpZ2hsaWdodGVyXS5oaWdobGlnaHQoe3BvcnRhbDogcH0pOwogIH0KfQoKd2luZG93LnJlc2V0SGlnaGxpZ2h0ZWRQb3J0YWxzID0gZnVuY3Rpb24oKSB7CiAgJC5lYWNoKHBvcnRhbHMsIGZ1bmN0aW9uKGd1aWQsIHBvcnRhbCkgewogICAgc2V0TWFya2VyU3R5bGUocG9ydGFsLCBndWlkID09PSBzZWxlY3RlZFBvcnRhbCk7CiAgfSk7Cn0KCgo7CgovLyBQT1JUQUwgREVUQUlMUyBUT09MUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIGhhbmQgYW55IG9mIHRoZXNlIGZ1bmN0aW9ucyB0aGUgZGV0YWlscy1oYXNoIG9mIGEgcG9ydGFsLCBhbmQgdGhleQovLyB3aWxsIHJldHVybiB1c2VmdWwsIGJ1dCByYXcgZGF0YS4KCi8vIHJldHVybnMgYSBmbG9hdC4gRGlzcGxheWVkIHBvcnRhbCBsZXZlbCBpcyBhbHdheXMgcm91bmRlZCBkb3duIGZyb20KLy8gdGhhdCB2YWx1ZS4Kd2luZG93LmdldFBvcnRhbExldmVsID0gZnVuY3Rpb24oZCkgewogIHZhciBsdmwgPSAwOwogIHZhciBoYXNSZXNvID0gZmFsc2U7CiAgJC5lYWNoKGQucmVzb25hdG9ycywgZnVuY3Rpb24oaW5kLCByZXNvKSB7CiAgICBpZighcmVzbykgcmV0dXJuIHRydWU7CiAgICBsdmwgKz0gcGFyc2VJbnQocmVzby5sZXZlbCk7CiAgICBoYXNSZXNvID0gdHJ1ZTsKICB9KTsKICByZXR1cm4gaGFzUmVzbyA/IE1hdGgubWF4KDEsIGx2bC84KSA6IDA7Cn0KCndpbmRvdy5nZXRUb3RhbFBvcnRhbEVuZXJneSA9IGZ1bmN0aW9uKGQpIHsKICB2YXIgbnJnID0gMDsKICAkLmVhY2goZC5yZXNvbmF0b3JzLCBmdW5jdGlvbihpbmQsIHJlc28pIHsKICAgIGlmKCFyZXNvKSByZXR1cm4gdHJ1ZTsKICAgIHZhciBsZXZlbCA9IHBhcnNlSW50KHJlc28ubGV2ZWwpOwogICAgdmFyIG1heCA9IFJFU09fTlJHW2xldmVsXTsKICAgIG5yZyArPSBtYXg7CiAgfSk7CiAgcmV0dXJuIG5yZzsKfQoKLy8gRm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CndpbmRvdy5nZXRQb3J0YWxFbmVyZ3kgPSB3aW5kb3cuZ2V0VG90YWxQb3J0YWxFbmVyZ3k7Cgp3aW5kb3cuZ2V0Q3VycmVudFBvcnRhbEVuZXJneSA9IGZ1bmN0aW9uKGQpIHsKICB2YXIgbnJnID0gMDsKICAkLmVhY2goZC5yZXNvbmF0b3JzLCBmdW5jdGlvbihpbmQsIHJlc28pIHsKICAgIGlmKCFyZXNvKSByZXR1cm4gdHJ1ZTsKICAgIG5yZyArPSBwYXJzZUludChyZXNvLmVuZXJneSk7CiAgfSk7CiAgcmV0dXJuIG5yZzsKfQoKd2luZG93LmdldFBvcnRhbFJhbmdlID0gZnVuY3Rpb24oZCkgewogIC8vIGZvcm11bGEgYnkgdGhlIGdyZWF0IGdhbHMgYW5kIGd1eXMgYXQKICAvLyBodHRwOi8vZGVjb2RlaW5ncmVzcy5tZS8yMDEyLzExLzE4L2luZ3Jlc3MtcG9ydGFsLWxldmVscy1hbmQtbGluay1yYW5nZS8KCiAgdmFyIGx2bCA9IDA7CiAgdmFyIHJlc29NaXNzaW5nID0gZmFsc2U7CiAgLy8gY3VycmVudGx5IHdlIGdldCBhIHNob3J0IHJlc29uYXRvciBhcnJheSB3aGVuIHNvbWUgYXJlIG1pc3NpbmcKICBpZiAoZC5yZXNvbmF0b3JzLmxlbmd0aCA8IDgpIHsKICAgIHJlc29NaXNzaW5nID0gdHJ1ZTsKICB9CiAgLy8gYnV0IGluIHRoZSBwYXN0IHdlIHVzZWQgdG8gYWx3YXlzIGdldCBhbiBhcnJheSBvZiA4LCBidXQgd2lsbCAnbnVsbCcgb2JqZWN0cyBmb3Igc29tZSBlbnRyaWVzLiBtYXliZSB0aGF0IHdpbGwgcmV0dXJuPwogICQuZWFjaChkLnJlc29uYXRvcnMsIGZ1bmN0aW9uKGluZCwgcmVzbykgewogICAgaWYoIXJlc28pIHsKICAgICAgcmVzb01pc3NpbmcgPSB0cnVlOwogICAgICByZXR1cm47CiAgICB9CiAgfSk7CgogIHZhciByYW5nZSA9IHsKICAgIGJhc2U6IDE2MCpNYXRoLnBvdyhnZXRQb3J0YWxMZXZlbChkKSwgNCksCiAgICBib29zdDogZ2V0TGlua0FtcFJhbmdlQm9vc3QoZCkKICB9OwoKICByYW5nZS5yYW5nZSA9IHJhbmdlLmJvb3N0ICogcmFuZ2UuYmFzZTsKICByYW5nZS5pc0xpbmthYmxlID0gIXJlc29NaXNzaW5nOwoKICByZXR1cm4gcmFuZ2U7Cn0KCndpbmRvdy5nZXRMaW5rQW1wUmFuZ2VCb29zdCA9IGZ1bmN0aW9uKGQpIHsKICAvLyBhZGRpdGlvbmFsIHJhbmdlIGJvb3N0IGNhbGN1bGF0aW9uCgogIC8vIGxpbmsgYW1wcyBzY2FsZTogZmlyc3QgaXMgZnVsbCwgc2Vjb25kIGEgcXVhcnRlciwgdGhlIGxhc3QgdHdvIGFuIGVpZ2h0aAogIHZhciBzY2FsZSA9IFsxLjAsIDAuMjUsIDAuMTI1LCAwLjEyNV07CgogIHZhciBib29zdCA9IDAuMDsgIC8vIGluaXRpYWwgYm9vc3QgaXMgMC4wIChpLmUuIG5vIGJvb3N0IG92ZXIgc3RhbmRhcmQgcmFuZ2UpCgogIHZhciBsaW5rQW1wcyA9IGdldFBvcnRhbE1vZHNCeVR5cGUoZCwgJ0xJTktfQU1QTElGSUVSJyk7CgogIGxpbmtBbXBzLmZvckVhY2goZnVuY3Rpb24obW9kLCBpKSB7CiAgICAvLyBsaW5rIGFtcCBzdGF0IExJTktfUkFOR0VfTVVMVElQTElFUiBpcyAyMDAwIGZvciByYXJlLCBhbmQgZ2l2ZXMgMnggYm9vc3QgdG8gdGhlIHJhbmdlCiAgICAvLyBhbmQgdmVyeS1yYXJlIGlzIDcwMDAgYW5kIGdpdmVzIDd4IHRoZSByYW5nZQogICAgdmFyIGJhc2VNdWx0aXBsaWVyID0gbW9kLnN0YXRzLkxJTktfUkFOR0VfTVVMVElQTElFUi8xMDAwOwogICAgYm9vc3QgKz0gYmFzZU11bHRpcGxpZXIqc2NhbGVbaV07CiAgfSk7CgogIHJldHVybiAobGlua0FtcHMubGVuZ3RoID4gMCkgPyBib29zdCA6IDEuMDsKfQoKCndpbmRvdy5nZXRBdHRhY2tBcEdhaW4gPSBmdW5jdGlvbihkLGZpZWxkQ291bnQsbGlua0NvdW50KSB7CiAgaWYgKCFmaWVsZENvdW50KSBmaWVsZENvdW50ID0gMDsKCiAgdmFyIHJlc29Db3VudCA9IDA7CiAgdmFyIG1heFJlc29uYXRvcnMgPSBNQVhfUkVTT19QRVJfUExBWUVSLnNsaWNlKDApOwogIHZhciBjdXJSZXNvbmF0b3JzID0gWyAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgZm9yKHZhciBuID0gUExBWUVSLmxldmVsICsgMTsgbiA8IDk7IG4rKykgewogICAgbWF4UmVzb25hdG9yc1tuXSA9IDA7CiAgfQogICQuZWFjaChkLnJlc29uYXRvcnMsIGZ1bmN0aW9uKGluZCwgcmVzbykgewogICAgaWYoIXJlc28pCiAgICAgIHJldHVybiB0cnVlOwogICAgcmVzb0NvdW50ICs9IDE7CiAgICB2YXIgcmVzbGV2ZWw9cGFyc2VJbnQocmVzby5sZXZlbCk7CiAgICBpZihyZXNvLm93bmVyID09PSBQTEFZRVIubmlja25hbWUpIHsKICAgICAgaWYobWF4UmVzb25hdG9yc1tyZXNsZXZlbF0gPiAwKSB7CiAgICAgICAgbWF4UmVzb25hdG9yc1tyZXNsZXZlbF0gLT0gMTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY3VyUmVzb25hdG9yc1tyZXNsZXZlbF0gKz0gMTsKICAgIH0KICB9KTsKCgogIHZhciByZXNvQXAgPSByZXNvQ291bnQgKiBERVNUUk9ZX1JFU09OQVRPUjsKICB2YXIgbGlua0FwID0gbGlua0NvdW50ICogREVTVFJPWV9MSU5LOwogIHZhciBmaWVsZEFwID0gZmllbGRDb3VudCAqIERFU1RST1lfRklFTEQ7CiAgdmFyIGRlc3Ryb3lBcCA9IHJlc29BcCArIGxpbmtBcCArIGZpZWxkQXA7CiAgdmFyIGNhcHR1cmVBcCA9IENBUFRVUkVfUE9SVEFMICsgOCAqIERFUExPWV9SRVNPTkFUT1IgKyBDT01QTEVUSU9OX0JPTlVTOwogIHZhciBlbmVteUFwID0gZGVzdHJveUFwICsgY2FwdHVyZUFwOwogIHZhciBkZXBsb3lDb3VudCA9IDggLSByZXNvQ291bnQ7CiAgdmFyIGNvbXBsZXRpb25BcCA9IChkZXBsb3lDb3VudCA+IDApID8gQ09NUExFVElPTl9CT05VUyA6IDA7CiAgdmFyIHVwZ3JhZGVDb3VudCA9IDA7CiAgdmFyIHVwZ3JhZGVBdmFpbGFibGUgPSBtYXhSZXNvbmF0b3JzWzhdOwogIGZvcih2YXIgbiA9IDc7IG4gPj0gMDsgbi0tKSB7CiAgICB1cGdyYWRlQ291bnQgKz0gY3VyUmVzb25hdG9yc1tuXTsKICAgIGlmKHVwZ3JhZGVBdmFpbGFibGUgPCB1cGdyYWRlQ291bnQpIHsKICAgICAgICB1cGdyYWRlQ291bnQgLT0gKHVwZ3JhZGVDb3VudCAtIHVwZ3JhZGVBdmFpbGFibGUpOwogICAgfQogICAgdXBncmFkZUF2YWlsYWJsZSArPSBtYXhSZXNvbmF0b3JzW25dOwogIH0KICB2YXIgZnJpZW5kbHlBcCA9IGRlcGxveUNvdW50ICogREVQTE9ZX1JFU09OQVRPUiArIHVwZ3JhZGVDb3VudCAqIFVQR1JBREVfQU5PVEhFUlNfUkVTT05BVE9SICsgY29tcGxldGlvbkFwOwogIHJldHVybiB7CiAgICBmcmllbmRseUFwOiBmcmllbmRseUFwLAogICAgZGVwbG95Q291bnQ6IGRlcGxveUNvdW50LAogICAgdXBncmFkZUNvdW50OiB1cGdyYWRlQ291bnQsCiAgICBlbmVteUFwOiBlbmVteUFwLAogICAgZGVzdHJveUFwOiBkZXN0cm95QXAsCiAgICByZXNvQXA6IHJlc29BcCwKICAgIGNhcHR1cmVBcDogY2FwdHVyZUFwCiAgfTsKfQoKLy9UaGlzIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIHRoZSBwb3RlbnRpYWwgbGV2ZWwgYSBwbGF5ZXIgY2FuIHVwZ3JhZGUgaXQgdG8Kd2luZG93LnBvdGVudGlhbFBvcnRhbExldmVsID0gZnVuY3Rpb24oZCkgewogIHZhciBjdXJyZW50X2xldmVsID0gZ2V0UG9ydGFsTGV2ZWwoZCk7CiAgdmFyIHBvdGVudGlhbF9sZXZlbCA9IGN1cnJlbnRfbGV2ZWw7CiAgCiAgaWYoUExBWUVSLnRlYW0gPT09IGQudGVhbSkgewogICAgdmFyIHJlc29uYXRvcnNfb25fcG9ydGFsID0gZC5yZXNvbmF0b3JzOwogICAgdmFyIHJlc29uYXRvcl9sZXZlbHMgPSBuZXcgQXJyYXkoKTsKICAgIC8vIGZpZ3VyZSBvdXQgaG93IG1hbnkgb2YgZWFjaCBvZiB0aGVzZSByZXNvbmF0b3JzIGNhbiBiZSBwbGFjZWQgYnkgdGhlIHBsYXllcgogICAgdmFyIHBsYXllcl9yZXNvbnRhdG9ycyA9IG5ldyBBcnJheSgpOwogICAgZm9yKHZhciBpPTE7aTw9TUFYX1BPUlRBTF9MRVZFTDsgaSsrKSB7CiAgICAgIHBsYXllcl9yZXNvbnRhdG9yc1tpXSA9IGkgPiBQTEFZRVIubGV2ZWwgPyAwIDogTUFYX1JFU09fUEVSX1BMQVlFUltpXTsKICAgIH0KICAgICQuZWFjaChyZXNvbmF0b3JzX29uX3BvcnRhbCwgZnVuY3Rpb24oaW5kLCByZXNvKSB7CiAgICAgIGlmKHJlc28gIT09IG51bGwgJiYgcmVzby5vd25lciA9PT0gd2luZG93LlBMQVlFUi5uaWNrbmFtZSkgewogICAgICAgIHBsYXllcl9yZXNvbnRhdG9yc1tyZXNvLmxldmVsXS0tOwogICAgICB9CiAgICAgIHJlc29uYXRvcl9sZXZlbHMucHVzaChyZXNvID09PSBudWxsID8gMCA6IHJlc28ubGV2ZWwpOyAgCiAgICB9KTsKICAgIAogICAgcmVzb25hdG9yX2xldmVscy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgcmV0dXJuKGEgLSBiKTsKICAgIH0pOwogICAgCiAgICAvLyBNYXggb3V0IHBvcnRhbAogICAgdmFyIGluc3RhbGxfaW5kZXggPSAwOwogICAgZm9yKHZhciBpPU1BWF9QT1JUQUxfTEVWRUw7aT49MTsgaS0tKSB7CiAgICAgIGZvcih2YXIgaW5zdGFsbCA9IHBsYXllcl9yZXNvbnRhdG9yc1tpXTsgaW5zdGFsbD4wOyBpbnN0YWxsLS0pIHsKICAgICAgICBpZihyZXNvbmF0b3JfbGV2ZWxzW2luc3RhbGxfaW5kZXhdIDwgaSkgewogICAgICAgICAgcmVzb25hdG9yX2xldmVsc1tpbnN0YWxsX2luZGV4XSA9IGk7CiAgICAgICAgICBpbnN0YWxsX2luZGV4Kys7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvL2NvbnNvbGUubG9nKHJlc29uYXRvcl9sZXZlbHMpOwogICAgcG90ZW50aWFsX2xldmVsID0gcmVzb25hdG9yX2xldmVscy5yZWR1Y2UoZnVuY3Rpb24oYSwgYikge3JldHVybiBhICsgYjt9KSAvIDg7CiAgfQogIHJldHVybihwb3RlbnRpYWxfbGV2ZWwpOwp9CgoKd2luZG93LmZpeFBvcnRhbEltYWdlVXJsID0gZnVuY3Rpb24odXJsKSB7CiAgaWYgKHVybCkgewogICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHBzOicpIHsKICAgICAgdXJsID0gdXJsLmluZGV4T2YoJ3d3dy5wYW5vcmFtaW8uY29tJykgIT09IC0xCiAgICAgICAgICAgID8gdXJsLnJlcGxhY2UoL15odHRwOlwvXC93d3cvLCAnaHR0cHM6Ly9zc2wnKS5yZXBsYWNlKCdzbWFsbCcsICdtZWRpdW0nKQogICAgICAgICAgICA6IHVybC5yZXBsYWNlKC9eaHR0cDpcL1wvLywgJy8vJyk7CiAgICB9CiAgICByZXR1cm4gdXJsOwogIH0gZWxzZSB7CiAgICByZXR1cm4gREVGQVVMVF9QT1JUQUxfSU1HOwogIH0KCn0KCgp3aW5kb3cuZ2V0UG9ydGFsTW9kc0J5VHlwZSA9IGZ1bmN0aW9uKGQsIHR5cGUpIHsKICB2YXIgbW9kcyA9IFtdOwoKICB2YXIgdHlwZVRvU3RhdCA9IHsKICAgIFJFU19TSElFTEQ6ICdNSVRJR0FUSU9OJywKICAgIEZPUkNFX0FNUDogJ0ZPUkNFX0FNUExJRklFUicsCiAgICBUVVJSRVQ6ICdISVRfQk9OVVMnLCAgLy8gYW5kL29yIEFUVEFDS19GUkVRVUVOQ1k/PwogICAgSEVBVFNJTks6ICdIQUNLX1NQRUVEJywKICAgIE1VTFRJSEFDSzogJ0JVUk5PVVRfSU5TVUxBVElPTicsCiAgICBMSU5LX0FNUExJRklFUjogJ0xJTktfUkFOR0VfTVVMVElQTElFUicsCiAgICBVTFRSQV9MSU5LX0FNUDogJ09VVEdPSU5HX0xJTktTX0JPTlVTJywgLy8gYW5kL29yIExJTktfREVGRU5TRV9CT09TVD8/CiAgfTsKCiAgdmFyIHN0YXQgPSB0eXBlVG9TdGF0W3R5cGVdOwoKICAkLmVhY2goZC5tb2RzIHx8IFtdLCBmdW5jdGlvbihpLG1vZCkgewogICAgaWYgKG1vZCAmJiBtb2Quc3RhdHMuaGFzT3duUHJvcGVydHkoc3RhdCkpIG1vZHMucHVzaChtb2QpOwogIH0pOwoKCiAgLy8gc29ydGluZyBtb2RzIGJ5IHRoZSBzdGF0IGtlZXBzIGNvZGUgc2ltcGxlciwgd2hlbiBjYWxjdWxhdGluZyBjb21iaW5lZCBtb2QgZWZmZWN0cwogIG1vZHMuc29ydCAoZnVuY3Rpb24oYSxiKSB7CiAgICByZXR1cm4gYi5zdGF0c1tzdGF0XSAtIGEuc3RhdHNbc3RhdF07CiAgfSk7CgogIHJldHVybiBtb2RzOwp9CgoKCndpbmRvdy5nZXRQb3J0YWxTaGllbGRNaXRpZ2F0aW9uID0gZnVuY3Rpb24oZCkgewogIHZhciBzaGllbGRzID0gZ2V0UG9ydGFsTW9kc0J5VHlwZShkLCAnUkVTX1NISUVMRCcpOwoKICB2YXIgbWl0aWdhdGlvbiA9IDA7CiAgJC5lYWNoKHNoaWVsZHMsIGZ1bmN0aW9uKGkscykgewogICAgbWl0aWdhdGlvbiArPSBwYXJzZUludChzLnN0YXRzLk1JVElHQVRJT04pOwogIH0pOwoKICByZXR1cm4gbWl0aWdhdGlvbjsKfQoKd2luZG93LmdldFBvcnRhbExpbmtzTWl0aWdhdGlvbiA9IGZ1bmN0aW9uKGxpbmtDb3VudCkgewogIHZhciBtaXRpZ2F0aW9uID0gTWF0aC5yb3VuZCg0MDAvOSpNYXRoLmF0YW4obGlua0NvdW50L01hdGguRSkpOwogIHJldHVybiBtaXRpZ2F0aW9uOwp9Cgp3aW5kb3cuZ2V0UG9ydGFsTWl0aWdhdGlvbkRldGFpbHMgPSBmdW5jdGlvbihkLGxpbmtDb3VudCkgewogIHZhciBtaXRpZ2F0aW9uID0gewogICAgc2hpZWxkczogZ2V0UG9ydGFsU2hpZWxkTWl0aWdhdGlvbihkKSwKICAgIGxpbmtzOiBnZXRQb3J0YWxMaW5rc01pdGlnYXRpb24obGlua0NvdW50KQogIH07CgogIC8vIG1pdGlnYXRpb24gaXMgbGltaXRlZCB0byA5NSUgKGFzIGNvbmZpcm1lZCBieSBCcmFuZG9uIEJhZGdlciBvbiBHKykKICBtaXRpZ2F0aW9uLnRvdGFsID0gTWF0aC5taW4oOTUsIG1pdGlnYXRpb24uc2hpZWxkcyttaXRpZ2F0aW9uLmxpbmtzKTsKCiAgbWl0aWdhdGlvbi5leGNlc3MgPSAobWl0aWdhdGlvbi5zaGllbGRzK21pdGlnYXRpb24ubGlua3MpIC0gbWl0aWdhdGlvbi50b3RhbDsKCiAgcmV0dXJuIG1pdGlnYXRpb247Cn0KCndpbmRvdy5nZXRNYXhPdXRnb2luZ0xpbmtzID0gZnVuY3Rpb24oZCkgewogIHZhciBsaW5rQW1wcyA9IGdldFBvcnRhbE1vZHNCeVR5cGUoZCwgJ1VMVFJBX0xJTktfQU1QJyk7CgogIHZhciBsaW5rcyA9IDg7CgogIGxpbmtBbXBzLmZvckVhY2goZnVuY3Rpb24obW9kLCBpKSB7CiAgICBsaW5rcyArPSBwYXJzZUludChtb2Quc3RhdHMuT1VUR09JTkdfTElOS1NfQk9OVVMpOwogIH0pOwoKICByZXR1cm4gbGlua3M7Cn07Cgp3aW5kb3cuZ2V0UG9ydGFsSGFja0RldGFpbHMgPSBmdW5jdGlvbihkKSB7CgogIHZhciBoZWF0c2lua3MgPSBnZXRQb3J0YWxNb2RzQnlUeXBlKGQsICdIRUFUU0lOSycpOwogIHZhciBtdWx0aWhhY2tzID0gZ2V0UG9ydGFsTW9kc0J5VHlwZShkLCAnTVVMVElIQUNLJyk7CgogIC8vIGZpcnN0IG1vZCBvZiB0eXBlIGlzIGZ1bGx5IGVmZmVjdGl2ZSwgdGhlIG90aGVycyBhcmUgb25seSA1MCUgZWZmZWN0aXZlCiAgdmFyIGVmZmVjdGl2ZW5lc3NSZWR1Y3Rpb24gPSBbIDEsIDAuNSwgMC41LCAwLjUgXTsKCiAgdmFyIGNvb2xkb3duVGltZSA9IDMwMDsgLy8gNSBtaW5zIC0gMzAwIHNlY29uZHMgCgogICQuZWFjaChoZWF0c2lua3MsIGZ1bmN0aW9uKGluZGV4LG1vZCkgewogICAgdmFyIGhhY2tTcGVlZCA9IHBhcnNlSW50KG1vZC5zdGF0cy5IQUNLX1NQRUVEKS8xMDAwMDAwOwogICAgY29vbGRvd25UaW1lID0gTWF0aC5yb3VuZChjb29sZG93blRpbWUgKiAoMSAtIGhhY2tTcGVlZCAqIGVmZmVjdGl2ZW5lc3NSZWR1Y3Rpb25baW5kZXhdKSk7CiAgfSk7CgogIHZhciBudW1IYWNrcyA9IDQ7IC8vIGRlZmF1bHQgaGFja3MKCiAgJC5lYWNoKG11bHRpaGFja3MsIGZ1bmN0aW9uKGluZGV4LG1vZCkgewogICAgdmFyIGV4dHJhSGFja3MgPSBwYXJzZUludChtb2Quc3RhdHMuQlVSTk9VVF9JTlNVTEFUSU9OKTsKICAgIG51bUhhY2tzID0gbnVtSGFja3MgKyAoZXh0cmFIYWNrcyAqIGVmZmVjdGl2ZW5lc3NSZWR1Y3Rpb25baW5kZXhdKTsKICB9KTsKCiAgcmV0dXJuIHtjb29sZG93bjogY29vbGRvd25UaW1lLCBoYWNrczogbnVtSGFja3MsIGJ1cm5vdXQ6IGNvb2xkb3duVGltZSoobnVtSGFja3MtMSl9Owp9CgovLyBnaXZlbiBhIGRldGFpbGVkIHBvcnRhbCBzdHJ1Y3R1cmUsIHJldHVybiBzdW1tYXJ5IHBvcnRhbCBkYXRhLCBhcyBzZWVuIGluIHRoZSBtYXAgdGlsZSBkYXRhCndpbmRvdy5nZXRQb3J0YWxTdW1tYXJ5RGF0YSA9IGZ1bmN0aW9uKGQpIHsKCiAgLy8gTk9URTogdGhlIHN1bW1hcnkgZGF0YSByZXBvcnRzIHVuY2xhaW1lZCBwb3J0YWxzIGFzIGxldmVsIDEgLSBub3QgemVybyBhcyBlbHNld2hlcmUgaW4gSUlUQwogIHZhciBsZXZlbCA9IHBhcnNlSW50KGdldFBvcnRhbExldmVsKGQpKTsKICBpZiAobGV2ZWwgPT0gMCkgbGV2ZWwgPSAxOyAvL25pYW50aWMgcmV0dXJucyBuZXV0cmFsIHBvcnRhbHMgYXMgbGV2ZWwgMSwgbm90IDAgYXMgdXNlZCB0aHJvdWdob3V0IElJVEMgZWxzZXdoZXJlCgogIHZhciByZXNDb3VudCA9IDA7CiAgaWYgKGQucmVzb25hdG9ycykgewogICAgZm9yICh2YXIgeCBpbiBkLnJlc29uYXRvcnMpIHsKICAgICAgaWYgKGQucmVzb25hdG9yc1t4XSkgcmVzQ291bnQrKzsKICAgIH0KICB9CiAgdmFyIG1heEVuZXJneSA9IGdldFRvdGFsUG9ydGFsRW5lcmd5KGQpOwogIHZhciBjdXJFbmVyZ3kgPSBnZXRDdXJyZW50UG9ydGFsRW5lcmd5KGQpOwogIHZhciBoZWFsdGggPSBtYXhFbmVyZ3k+MCA/IHBhcnNlSW50KGN1ckVuZXJneS9tYXhFbmVyZ3kqMTAwKSA6IDA7CgogIHJldHVybiB7CiAgICBsZXZlbDogbGV2ZWwsCiAgICB0aXRsZTogZC50aXRsZSwKICAgIGltYWdlOiBkLmltYWdlLAogICAgcmVzQ291bnQ6IHJlc0NvdW50LAogICAgbGF0RTY6IGQubGF0RTYsCiAgICBoZWFsdGg6IGhlYWx0aCwKICAgIHRlYW06IGQudGVhbSwKICAgIGxuZ0U2OiBkLmxuZ0U2LAogICAgdHlwZTogJ3BvcnRhbCcKICB9Owp9Cgp3aW5kb3cuZ2V0UG9ydGFsQXR0YWNrVmFsdWVzID0gZnVuY3Rpb24oZCkgewogIHZhciBmb3JjZWFtcHMgPSBnZXRQb3J0YWxNb2RzQnlUeXBlKGQsICdGT1JDRV9BTVAnKTsKICB2YXIgdHVycmV0cyA9IGdldFBvcnRhbE1vZHNCeVR5cGUoZCwgJ1RVUlJFVCcpOwoKICAvLyBhdCB0aGUgdGltZSBvZiB3cml0aW5nLCBvbmx5IHJhcmUgZm9yY2UgYW1wcyBhbmQgdHVycmV0cyBoYXZlIGJlZW4gc2VlbiBpbiB0aGUgd2lsZCwgc28gdGhlcmUncyBhIGxpdHRsZSBndWVzc3dvcmsKICAvLyBhdCBob3cgdGhlIHN0YXRzIHdvcmsgYW5kIGNvbWJpbmUKICAvLyBhbGdvcml0aG0gaGFzIGJlZW4gY29tcGllZCBmcm9tIGdldExpbmtBbXBSYW5nZUJvb3N0CiAgLy8gRklYTUU6IG9ubHkgZXh0cmFjdCBzdGF0cyBhbmQgcHV0IHRoZSBjYWxjdWxhdGlvbiBpbiBhIG1ldGhvZCB0byBiZSB1c2VkIGZvciBsaW5rIHJhbmdlLCBmb3JjZSBhbXBsaWZpZXIgYW5kIGF0dGFjawogIC8vIGZyZXF1ZW5jeQogIC8vIG5vdGU6IHNjYW5uZXIgc2hvd3Mgcm91bmRlZCB2YWx1ZXMgKGFkZGluZyBhIHNlY29uZCBGQSBzaG93czogMi41eCswLjJ4PTIuOHgsIHdoaWNoIHNob3VsZCBiZSAyLjV4KzAuMjV4PTIuNzV4KQoKICAvLyBhbXBsaWZpZXIgc2NhbGU6IGZpcnN0IGlzIGZ1bGwsIHNlY29uZCBhIHF1YXJ0ZXIsIHRoZSBsYXN0IHR3byBhbiBlaWdodGgKICB2YXIgc2NhbGUgPSBbMS4wLCAwLjI1LCAwLjEyNSwgMC4xMjVdOwoKICB2YXIgYXR0YWNrVmFsdWVzID0gewogICAgaGl0X2JvbnVzOiAwLAogICAgZm9yY2VfYW1wbGlmaWVyOiAwLAogICAgYXR0YWNrX2ZyZXF1ZW5jeTogMCwKICB9OwoKICBmb3JjZWFtcHMuZm9yRWFjaChmdW5jdGlvbihtb2QsIGkpIHsKICAgIC8vIGZvcmNlIGFtcCBzdGF0IEZPUkNFX0FNUExJRklFUiBpcyAyMDAwIGZvciByYXJlLCBhbmQgZ2l2ZXMgMnggYm9vc3QgdG8gdGhlIHJhbmdlCiAgICB2YXIgYmFzZU11bHRpcGxpZXIgPSBtb2Quc3RhdHMuRk9SQ0VfQU1QTElGSUVSIC8gMTAwMDsKICAgIGF0dGFja1ZhbHVlcy5mb3JjZV9hbXBsaWZpZXIgKz0gYmFzZU11bHRpcGxpZXIgKiBzY2FsZVtpXTsKICB9KTsKCiAgdHVycmV0cy5mb3JFYWNoKGZ1bmN0aW9uKG1vZCwgaSkgewogICAgLy8gdHVycmV0IHN0YXQgQVRUQUNLX0ZSRVFVRU5DWSBpcyAyMDAwIGZvciByYXJlLCBhbmQgZ2l2ZXMgMnggYm9vc3QgdG8gdGhlIHJhbmdlCiAgICB2YXIgYmFzZU11bHRpcGxpZXIgPSBtb2Quc3RhdHMuQVRUQUNLX0ZSRVFVRU5DWSAvIDEwMDA7CiAgICBhdHRhY2tWYWx1ZXMuYXR0YWNrX2ZyZXF1ZW5jeSArPSBiYXNlTXVsdGlwbGllciAqIHNjYWxlW2ldOwoKICAgIGF0dGFja1ZhbHVlcy5oaXRfYm9udXMgKz0gbW9kLnN0YXRzLkhJVF9CT05VUyAvIDEwMDAwOwogIH0pOwoKICByZXR1cm4gYXR0YWNrVmFsdWVzOwp9CgoKCgo7CgovLyBQT1JUQUwgTUFSS0VSIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gY29kZSB0byBjcmVhdGUgYW5kIHVwZGF0ZSBhIHBvcnRhbCBtYXJrZXIKCgp3aW5kb3cucG9ydGFsTWFya2VyU2NhbGUgPSBmdW5jdGlvbigpIHsKICB2YXIgem9vbSA9IG1hcC5nZXRab29tKCk7CiAgaWYgKEwuQnJvd3Nlci5tb2JpbGUpCiAgICByZXR1cm4gem9vbSA+PSAxNiA/IDEuNSA6IHpvb20gPj0gMTQgPyAxLjIgOiB6b29tID49IDExID8gMS4wIDogem9vbSA+PSA4ID8gMC42NSA6IDAuNTsKICBlbHNlCiAgICByZXR1cm4gem9vbSA+PSAxNCA/IDEgOiB6b29tID49IDExID8gMC44IDogem9vbSA+PSA4ID8gMC42NSA6IDAuNTsKfQoKLy8gY3JlYXRlIGEgbmV3IG1hcmtlci4gJ2RhdGEnIGNvbnRhaW4gdGhlIElJVEMtc3BlY2lmaWMgZW50aXR5IGRhdGEgdG8gYmUgc3RvcmVkIGluIHRoZSBvYmplY3Qgb3B0aW9ucwp3aW5kb3cuY3JlYXRlTWFya2VyID0gZnVuY3Rpb24obGF0bG5nLCBkYXRhKSB7CiAgdmFyIHN0eWxlT3B0aW9ucyA9IHdpbmRvdy5nZXRNYXJrZXJTdHlsZU9wdGlvbnMoZGF0YSk7CgogIHZhciBvcHRpb25zID0gTC5leHRlbmQoe30sIGRhdGEsIHN0eWxlT3B0aW9ucywgeyBjbGlja2FibGU6IHRydWUgfSk7CgogIHZhciBtYXJrZXIgPSBMLmNpcmNsZU1hcmtlcihsYXRsbmcsIG9wdGlvbnMpOwoKICBoaWdobGlnaHRQb3J0YWwobWFya2VyKTsKCiAgcmV0dXJuIG1hcmtlcjsKfQoKCndpbmRvdy5zZXRNYXJrZXJTdHlsZSA9IGZ1bmN0aW9uKG1hcmtlciwgc2VsZWN0ZWQpIHsKCiAgdmFyIHN0eWxlT3B0aW9ucyA9IHdpbmRvdy5nZXRNYXJrZXJTdHlsZU9wdGlvbnMobWFya2VyLm9wdGlvbnMpOwoKICBtYXJrZXIuc2V0U3R5bGUoc3R5bGVPcHRpb25zKTsKCiAgLy8gRklYTUU/IGl0J3MgaW5lZmZpY2llbnQgdG8gc2V0IHRoZSBtYXJrZXIgc3R5bGUgKGFib3ZlKSwgdGhlbiBkbyBpdCBhZ2FpbiBpbnNpZGUgdGhlIGhpZ2hsaWdodGVyCiAgLy8gdGhlIGhpZ2hsaWdodGVyIEFQSSB3b3VsZCBuZWVkIHRvIGJlIGNoYW5nZWQgZm9yIHRoaXMgdG8gYmUgaW1wcm92ZWQgdGhvdWdoLiB3aWxsIGl0IGJlIHRvbyBzbG93PwogIGhpZ2hsaWdodFBvcnRhbChtYXJrZXIpOwoKICBpZiAoc2VsZWN0ZWQpIHsKICAgIG1hcmtlci5zZXRTdHlsZSAoe2NvbG9yOiBDT0xPUl9TRUxFQ1RFRF9QT1JUQUx9KTsKICB9Cn0KCgp3aW5kb3cuZ2V0TWFya2VyU3R5bGVPcHRpb25zID0gZnVuY3Rpb24oZGV0YWlscykgewogIHZhciBzY2FsZSA9IHdpbmRvdy5wb3J0YWxNYXJrZXJTY2FsZSgpOwoKICAvLyAgIHBvcnRhbCBsZXZlbCAgICAgIDAgIDEgIDIgIDMgIDQgIDUgIDYgIDcgIDgKICB2YXIgTEVWRUxfVE9fV0VJR0hUID0gWzIsIDIsIDIsIDIsIDIsIDMsIDMsIDQsIDRdOwogIHZhciBMRVZFTF9UT19SQURJVVMgPSBbNywgNywgNywgNywgOCwgOCwgOSwxMCwxMV07CgogIHZhciBsZXZlbCA9IE1hdGguZmxvb3IoZGV0YWlscy5sZXZlbHx8MCk7CgogIHZhciBsdmxXZWlnaHQgPSBMRVZFTF9UT19XRUlHSFRbbGV2ZWxdICogTWF0aC5zcXJ0KHNjYWxlKTsKICB2YXIgbHZsUmFkaXVzID0gTEVWRUxfVE9fUkFESVVTW2xldmVsXSAqIHNjYWxlOwoKICB2YXIgZGFzaEFycmF5ID0gbnVsbDsKICAvLyB0aGlubmVyIGFuZCBkYXNoZWQgb3V0bGluZSBmb3IgcGxhY2Vob2xkZXIgcG9ydGFscwogIGlmIChkZXRhaWxzLnRlYW0gIT0gVEVBTV9OT05FICYmIGxldmVsPT0wKSB7CiAgICBsdmxXZWlnaHQgPSAxOwogICAgZGFzaEFycmF5ID0gWzEsMl07CiAgfQoKICB2YXIgb3B0aW9ucyA9IHsKICAgIHJhZGl1czogbHZsUmFkaXVzLAogICAgc3Ryb2tlOiB0cnVlLAogICAgY29sb3I6IENPTE9SU1tkZXRhaWxzLnRlYW1dLAogICAgd2VpZ2h0OiBsdmxXZWlnaHQsCiAgICBvcGFjaXR5OiAxLAogICAgZmlsbDogdHJ1ZSwKICAgIGZpbGxDb2xvcjogQ09MT1JTW2RldGFpbHMudGVhbV0sCiAgICBmaWxsT3BhY2l0eTogMC41LAogICAgZGFzaEFycmF5OiBkYXNoQXJyYXkKICB9OwoKICByZXR1cm4gb3B0aW9uczsKfQoKCgo7CgovLyBSRURFRU1JTkcgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKd2luZG93LlJFREVFTV9TSE9SVF9OQU1FUyA9IHsKICAncG9ydGFsIHNoaWVsZCc6J1MnLAogICdmb3JjZSBhbXAnOidGQScsCiAgJ2xpbmsgYW1wJzonTEEnLAogICdoZWF0c2luayc6J0gnLAogICdtdWx0aWhhY2snOidNJywKICAndHVycmV0JzonVCcsCiAgJ3VudXN1YWwgb2JqZWN0JzonVScsCiAgJ3Jlc29uYXRvcic6J1InLAogICd4bXAgYnVyc3Rlcic6J1gnLAogICdwb3dlciBjdWJlJzonQycsCiAgJ21lZGlhJzonTScsCiAgJ3VsdHJhIHN0cmlrZSc6J1VTJywKfQoKLyogVGhlc2UgYXJlIEhUVFAgc3RhdHVzIGNvZGVzIHJldHVybmVkIGJ5IHRoZSByZWRlbXB0aW9uIEFQSS4KICogVE9ETzogTW92ZSB0byBhbm90aGVyIGZpbGU/IFVzZSBtb3JlIGdlbmVyYWxseSBhY3Jvc3MgSUlUQz8KICovCndpbmRvdy5SRURFRU1fU1RBVFVTRVMgPSB7CiAgNDI5OiAnWW91IGhhdmUgYmVlbiByYXRlLWxpbWl0ZWQgYnkgdGhlIHNlcnZlci4gV2FpdCBhIGJpdCBhbmQgdHJ5IGFnYWluLicsCiAgNTAwOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJwp9OwoKd2luZG93LmhhbmRsZVJlZGVlbVJlc3BvbnNlID0gZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHsKICB2YXIgcGFzc2NvZGUgPSBqcVhIUi5wYXNzY29kZTsKCiAgaWYoZGF0YS5lcnJvcikgewogICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVkZWVtaW5nIHBhc3Njb2RlICInK3Bhc3Njb2RlKyciOiAnICsgZGF0YS5lcnJvcikKICAgIGRpYWxvZyh7CiAgICAgIHRpdGxlOiAnRXJyb3I6ICcgKyBwYXNzY29kZSwKICAgICAgaHRtbDogJzxzdHJvbmc+JyArIGRhdGEuZXJyb3IgKyAnPC9zdHJvbmc+JwogICAgfSk7CiAgICByZXR1cm47CiAgfQogIGlmKCFkYXRhLnJld2FyZHMpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlZGVlbWluZyBwYXNzY29kZSAiJytwYXNzY29kZSsnIjogJywgZGF0YSkKICAgIGRpYWxvZyh7CiAgICAgIHRpdGxlOiAnRXJyb3I6ICcgKyBwYXNzY29kZSwKICAgICAgaHRtbDogJzxzdHJvbmc+QW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cmVkPC9zdHJvbmc+JwogICAgfSk7CiAgICByZXR1cm47CiAgfQoKICBpZihkYXRhLnBsYXllckRhdGEpIHsKICAgIHdpbmRvdy5QTEFZRVIgPSBkYXRhLnBsYXllckRhdGE7CiAgICB3aW5kb3cuc2V0dXBQbGF5ZXJTdGF0KCk7CiAgfQoKICB2YXIgZm9ybWF0ID0gImxvbmciOwogIHRyeSB7CiAgICBmb3JtYXQgPSBsb2NhbFN0b3JhZ2VbImlpdGMtcGFzc2NvZGUtZm9ybWF0Il07CiAgfSBjYXRjaChlKSB7fQoKICB2YXIgZm9ybWF0SGFuZGxlcnMgPSB7CiAgICAic2hvcnQiOiBmb3JtYXRQYXNzY29kZVNob3J0LAogICAgImxvbmciOiBmb3JtYXRQYXNzY29kZUxvbmcKICB9CiAgaWYoIWZvcm1hdEhhbmRsZXJzW2Zvcm1hdF0pCiAgICBmb3JtYXQgPSAibG9uZyI7CgogIHZhciBodG1sID0gZm9ybWF0SGFuZGxlcnNbZm9ybWF0XShkYXRhLnJld2FyZHMpOwoKICB2YXIgYnV0dG9ucyA9IHt9OwogIE9iamVjdC5rZXlzKGZvcm1hdEhhbmRsZXJzKS5mb3JFYWNoKGZ1bmN0aW9uKGxhYmVsKSB7CiAgICBpZihsYWJlbCA9PSBmb3JtYXQpIHJldHVybjsKCiAgICBidXR0b25zW2xhYmVsLnRvVXBwZXJDYXNlKCldID0gZnVuY3Rpb24oKSB7CiAgICAgICQodGhpcykuZGlhbG9nKCJjbG9zZSIpOwogICAgICBsb2NhbFN0b3JhZ2VbImlpdGMtcGFzc2NvZGUtZm9ybWF0Il0gPSBsYWJlbDsKICAgICAgaGFuZGxlUmVkZWVtUmVzcG9uc2UoZGF0YSwgdGV4dFN0YXR1cywganFYSFIpOwogICAgfQogIH0pOwoKICAvLyBEaXNwbGF5IGl0CiAgZGlhbG9nKHsKICAgIHRpdGxlOiAnUGFzc2NvZGU6ICcgKyBwYXNzY29kZSwKICAgIGh0bWw6IGh0bWwsCiAgICBidXR0b25zOiBidXR0b25zCiAgfSk7Cn07Cgp3aW5kb3cuZm9ybWF0UGFzc2NvZGVMb25nID0gZnVuY3Rpb24oZGF0YSkgewogIHZhciBodG1sID0gJzxwPjxzdHJvbmc+UGFzc2NvZGUgY29uZmlybWVkLiBBY3F1aXJlZCBpdGVtczo8L3N0cm9uZz48L3A+PHVsIGNsYXNzPSJyZWRlZW1SZXdhcmQiPic7CgogIGlmKGRhdGEub3RoZXIpIHsKICAgIGRhdGEub3RoZXIuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgIGh0bWwgKz0gJzxsaT4nICsgd2luZG93LmVzY2FwZUh0bWxTcGVjaWFsQ2hhcnMoaXRlbSkgKyAnPC9saT4nOwogICAgfSk7CiAgfQoKICBpZigwIDwgZGF0YS54bSkKICAgIGh0bWwgKz0gJzxsaT4nICsgd2luZG93LmVzY2FwZUh0bWxTcGVjaWFsQ2hhcnMoZGF0YS54bSkgKyAnIFhNPC9saT4nOwogIGlmKDAgPCBkYXRhLmFwKQogICAgaHRtbCArPSAnPGxpPicgKyB3aW5kb3cuZXNjYXBlSHRtbFNwZWNpYWxDaGFycyhkYXRhLmFwKSArICcgQVA8L2xpPic7CgogIGlmKGRhdGEuaW52ZW50b3J5KSB7CiAgICBkYXRhLmludmVudG9yeS5mb3JFYWNoKGZ1bmN0aW9uKHR5cGUpIHsKICAgICAgdHlwZS5hd2FyZHMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgaHRtbCArPSAnPGxpPicgKyBpdGVtLmNvdW50ICsgJ3ggJzsKCiAgICAgICAgdmFyIGwgPSBpdGVtLmxldmVsOwogICAgICAgIGlmKDAgPCBsKSB7CiAgICAgICAgICBsID0gcGFyc2VJbnQobCk7CiAgICAgICAgICBodG1sICs9ICc8c3BhbiBjbGFzcz0iaXRlbWxldmVsIiBzdHlsZT0iY29sb3I6JyArIENPTE9SU19MVkxbbF0gKyAnIj5MJyArIGwgKyAnPC9zcGFuPiAnOwogICAgICAgIH0KCiAgICAgICAgaHRtbCArPSB3aW5kb3cuZXNjYXBlSHRtbFNwZWNpYWxDaGFycyh0eXBlLm5hbWUpICsgJzwvbGk+JzsKICAgICAgfSk7CiAgICB9KTsKICB9CgogIGh0bWwgKz0gJzwvdWw+JwogIHJldHVybiBodG1sOwp9Cgp3aW5kb3cuZm9ybWF0UGFzc2NvZGVTaG9ydCA9IGZ1bmN0aW9uKGRhdGEpIHsKCiAgaWYoZGF0YS5vdGhlcikgewogICAgdmFyIGF3YXJkcyA9IGRhdGEub3RoZXIubWFwKHdpbmRvdy5lc2NhcGVIdG1sU3BlY2lhbENoYXJzKTsKICB9IGVsc2UgewogICAgdmFyIGF3YXJkcyA9IFtdOwogIH0KCiAgaWYoMCA8IGRhdGEueG0pCiAgICBhd2FyZHMucHVzaCh3aW5kb3cuZXNjYXBlSHRtbFNwZWNpYWxDaGFycyhkYXRhLnhtKSArICcgWE0nKTsKICBpZigwIDwgZGF0YS5hcCkKICAgIGF3YXJkcy5wdXNoKHdpbmRvdy5lc2NhcGVIdG1sU3BlY2lhbENoYXJzKGRhdGEuYXApICsgJyBBUCcpOwoKICBpZihkYXRhLmludmVudG9yeSkgewogICAgZGF0YS5pbnZlbnRvcnkuZm9yRWFjaChmdW5jdGlvbih0eXBlKSB7CiAgICAgIHR5cGUuYXdhcmRzLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgIHZhciBzdHIgPSAiIjsKICAgICAgICBpZihpdGVtLmNvdW50ID4gMSkKICAgICAgICAgIHN0ciArPSBpdGVtLmNvdW50ICsgIiZuYnNwOyI7CgogICAgICAgIGlmKHdpbmRvdy5SRURFRU1fU0hPUlRfTkFNRVNbdHlwZS5uYW1lLnRvTG93ZXJDYXNlKCldKSB7CiAgICAgICAgICB2YXIgc2hvcnROYW1lID0gd2luZG93LlJFREVFTV9TSE9SVF9OQU1FU1t0eXBlLm5hbWUudG9Mb3dlckNhc2UoKV07CgogICAgICAgICAgdmFyIGwgPSBpdGVtLmxldmVsOwogICAgICAgICAgaWYoMCA8IGwpIHsKICAgICAgICAgICAgbCA9IHBhcnNlSW50KGwpOwogICAgICAgICAgICBzdHIgKz0gJzxzcGFuIGNsYXNzPSJpdGVtbGV2ZWwiIHN0eWxlPSJjb2xvcjonICsgQ09MT1JTX0xWTFtsXSArICciPicgKyBzaG9ydE5hbWUgKyBsICsgJzwvc3Bhbj4nOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RyICs9IHNob3J0TmFtZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgeyAvLyBubyBzaG9ydCBuYW1lIGtub3duCiAgICAgICAgICB2YXIgbCA9IGl0ZW0ubGV2ZWw7CiAgICAgICAgICBpZigwIDwgbCkgewogICAgICAgICAgICBsID0gcGFyc2VJbnQobCk7CiAgICAgICAgICAgIHN0ciArPSAnPHNwYW4gY2xhc3M9Iml0ZW1sZXZlbCIgc3R5bGU9ImNvbG9yOicgKyBDT0xPUlNfTFZMW2xdICsgJyI+TCcgKyBsICsgJzwvc3Bhbj4gJzsKICAgICAgICAgIH0KICAgICAgICAgIHN0ciArPSB0eXBlLm5hbWU7CiAgICAgICAgfQoKICAgICAgICBhd2FyZHMucHVzaChzdHIpOwogICAgICB9KTsKICAgIH0pOwogIH0KCiAgcmV0dXJuICc8cCBjbGFzcz0icmVkZWVtUmV3YXJkIj4nICsgYXdhcmRzLmpvaW4oJywgJykgKyAnPC9wPicKfQoKd2luZG93LnNldHVwUmVkZWVtID0gZnVuY3Rpb24oKSB7CiAgJCgiI3JlZGVlbSIpLmtleXByZXNzKGZ1bmN0aW9uKGUpIHsKICAgIGlmKChlLmtleUNvZGUgPyBlLmtleUNvZGUgOiBlLndoaWNoKSAhPT0gMTMpIHJldHVybjsKCiAgICB2YXIgcGFzc2NvZGUgPSAkKHRoaXMpLnZhbCgpOwogICAgaWYoIXBhc3Njb2RlKSByZXR1cm47CgogICAgdmFyIGpxWEhSID0gd2luZG93LnBvc3RBamF4KCdyZWRlZW1SZXdhcmQnLCB7cGFzc2NvZGU6cGFzc2NvZGV9LCB3aW5kb3cuaGFuZGxlUmVkZWVtUmVzcG9uc2UsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgIHZhciBleHRyYSA9ICcnOwogICAgICBpZihyZXNwb25zZS5zdGF0dXMpIHsKICAgICAgICBleHRyYSA9ICh3aW5kb3cuUkVERUVNX1NUQVRVU0VTW3Jlc3BvbnNlLnN0YXR1c10gfHwgJ1RoZSBzZXJ2ZXIgaW5kaWNhdGVkIGFuIGVycm9yLicpICsgJyAoSFRUUCAnICsgcmVzcG9uc2Uuc3RhdHVzICsgJyknOwogICAgICB9IGVsc2UgewogICAgICAgIGV4dHJhID0gJ05vIHN0YXR1cyBjb2RlIHdhcyByZXR1cm5lZC4nOwogICAgICB9CiAgICAgIGRpYWxvZyh7CiAgICAgICAgdGl0bGU6ICdSZXF1ZXN0IGZhaWxlZDogJyArIGRhdGEucGFzc2NvZGUsCiAgICAgICAgaHRtbDogJzxzdHJvbmc+VGhlIEhUVFAgcmVxdWVzdCBmYWlsZWQuPC9zdHJvbmc+ICcgKyBleHRyYQogICAgICB9KTsKICAgIH0pOwogICAganFYSFIucGFzc2NvZGUgPSBwYXNzY29kZTsKICB9KTsKfTsKCgo7CgoKCndpbmRvdy5yZWdpb25TY29yZWJvYXJkID0gZnVuY3Rpb24oKSB7CiAgLy8gVE9ETzogcmF0aGVyIHRoYW4ganVzdCBsb2FkIHRoZSByZWdpb24gc2NvcmVzIGZvciB0aGUgY2VudGVyIG9mIHRoZSBtYXAsIGRpc3BsYXkgYSBsaXN0IG9mIHJlZ2lvbnMgaW4gdGhlIGN1cnJlbnQgdmlldwogIC8vIGFuZCBsZXQgdGhlIHVzZXIgc2VsZWN0IG9uZSAod2l0aCBhdXRvbWF0aWMgc2VsZWN0aW9uIHdoZW4ganVzdCBvbmUgcmVnaW9uLCBhbmQgbGltaXRlZCB0byBjbG9zZSBlbm91Z2ggem9vbXMgc28gbGlzdCBzaXplIGlzIHJlYXNvbmFibGUpCiAgdmFyIGxhdExuZyA9IG1hcC5nZXRDZW50ZXIoKTsKCiAgdmFyIGxhdEU2ID0gTWF0aC5yb3VuZChsYXRMbmcubGF0KjFFNik7CiAgdmFyIGxuZ0U2ID0gTWF0aC5yb3VuZChsYXRMbmcubG5nKjFFNik7CgogIHZhciBkbGcgPSBkaWFsb2coe3RpdGxlOidSZWdpb24gc2NvcmVzJyxodG1sOidMb2FkaW5nIHJlZ2lvbmFsIHNjb3Jlcy4uLicsd2lkdGg6NDUwLG1pbkhlaWdodDozMjB9KTsKCiAgd2luZG93LnBvc3RBamF4KCdnZXRSZWdpb25TY29yZURldGFpbHMnLCB7bGF0RTY6bGF0RTYsbG5nRTY6bG5nRTZ9LCBmdW5jdGlvbihyZXMpe3JlZ2lvblNjb3JlYm9hcmRTdWNjZXNzKHJlcyxkbGcpO30sIGZ1bmN0aW9uKCl7cmVnaW9uU2NvcmVib2FyZEZhaWx1cmUoZGxnKTt9KTsKfQoKZnVuY3Rpb24gcmVnaW9uU2NvcmVib2FyZEZhaWx1cmUoZGxnKSB7CiAgZGxnLmh0bWwoJ0ZhaWxlZCB0byBsb2FkIHJlZ2lvbiBzY29yZXMgLSB0cnkgYWdhaW4nKTsKfQoKCmZ1bmN0aW9uIHJlZ2lvblNjb3JlYm9hcmRTY29yZUhpc3RvcnlDaGFydChyZXN1bHQsIGxvZ3NjYWxlKSB7CiAgLy8gc3ZnIGFyZWEgNDAweDEzMC4gZ3JhcGggYXJlYSAzNTB4MTAwLCBvZmZzZXQgdG8gNDAsMTAKCiAgaWYoIU1hdGgubG9nMTApCiAgICBNYXRoLmxvZzEwID0gZnVuY3Rpb24oeCkgeyByZXR1cm4gTWF0aC5sb2coeCkgLyBNYXRoLkxOMTA7IH07CgogIHZhciBtYXggPSBNYXRoLm1heChyZXN1bHQuZ2FtZVNjb3JlWzBdLHJlc3VsdC5nYW1lU2NvcmVbMV0sMTApOyAvL05PVEU6IGVuc3VyZSBhIG1pbiBvZiAxMCBmb3IgdGhlIGdyYXBoCiAgdmFyIGl0ZW1zID0gW107IC8vd2UnbGwgY29weSB0aGUgaXRlbXMgdG8gYW4gYXJyYXkgaW5kZXhlZCBieSBjaGVja3BvaW50IG51bWJlciAtIGVhc2llciB0byBhY2Nlc3MhCiAgZm9yICh2YXIgaT0wOyBpPHJlc3VsdC5zY29yZUhpc3RvcnkubGVuZ3RoOyBpKyspIHsKICAgIG1heCA9IE1hdGgubWF4KG1heCwgcmVzdWx0LnNjb3JlSGlzdG9yeVtpXVsxXSwgcmVzdWx0LnNjb3JlSGlzdG9yeVtpXVsyXSk7IC8vbm90ZTogaW5kZXggMCBpcyB0aGUgY2hlY2twb2ludCBudW1iZXIgaGVyZQogICAgaXRlbXNbcmVzdWx0LnNjb3JlSGlzdG9yeVtpXVswXV0gPSBbcmVzdWx0LnNjb3JlSGlzdG9yeVtpXVsxXSwgcmVzdWx0LnNjb3JlSGlzdG9yeVtpXVsyXV07CiAgfQoKICAvLyBzY2FsZSB1cCBtYXhpbXVtIGEgbGl0dGxlLCBzbyBncmFwaCBpc24ndCBzcXVhc2hlZCByaWdodCBhZ2FpbnN0IHVwcGVyIGVkZ2UKICBtYXggKj0gMS4wOTsKCiAgLy8gMCBjYW5ub3QgYmUgZGlzcGxheWVkIG9uIGEgbG9nIHNjYWxlLCBzbyB3ZSBzZXQgdGhlIG1pbmltdW0gdG8gMC4wMDEgYW5kIGRpdmlkZSBieSBsZygwLjAwMSk9LTMKICB2YXIgc2NhbGUgPSBsb2dzY2FsZQogICAgPyBmdW5jdGlvbih5KSB7IHJldHVybiAgMTAgLSBNYXRoLmxvZzEwKE1hdGgubWF4KDAuMDAxLHkvbWF4KSkgLyAzICogMTAwOyB9CiAgICA6IGZ1bmN0aW9uKHkpIHsgcmV0dXJuIDExMC15L21heCoxMDA7IH07CgogIHZhciB0ZWFtUGF0aHMgPSBbW10sW11dOwogIHZhciBvdGhlclN2ZyA9IFtdOwoKICBmb3IgKHZhciBpPTA7IGk8aXRlbXMubGVuZ3RoOyBpKyspIHsKICAgIHZhciB4PWkqMTArNDA7CiAgICBpZiAoaXRlbXNbaV0gIT09IHVuZGVmaW5lZCkgewogICAgICAvLyBwYXRocwogICAgICBpZiAoaT4wICYmIGl0ZW1zW2ktMV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAodmFyIHQ9MDsgdDwyOyB0KyspIHsKICAgICAgICAgIHRlYW1QYXRoc1t0XS5wdXNoKCdNJysoeC0xMCkrJywnK3NjYWxlKGl0ZW1zW2ktMV1bdF0pKycgTCcreCsnLCcrc2NhbGUoaXRlbXNbaV1bdF0pKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gbWFya2VycwogICAgICBvdGhlclN2Zy5wdXNoKCc8ZyB0aXRsZT0idGVzdCIgY2xhc3M9ImNoZWNrcG9pbnQiIGRhdGEtY3A9IicraSsnIiBkYXRhLWVubD0iJytpdGVtc1tpXVswXSsnIiBkYXRhLXJlcz0iJytpdGVtc1tpXVsxXSsnIj4nKTsKICAgICAgb3RoZXJTdmcucHVzaCgnPHJlY3QgeD0iJysoaSoxMCszNSkrJyIgeT0iMTAiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMDAiIGZpbGw9ImJsYWNrIiBmaWxsLW9wYWNpdHk9IjAiIC8+Jyk7CiAgICAgIGZvciAodmFyIHQ9MDsgdDwyOyB0KyspIHsKICAgICAgICB2YXIgY29sID0gdD09MCA/IENPTE9SU1tURUFNX0VOTF0gOiBDT0xPUlNbVEVBTV9SRVNdOwogICAgICAgIG90aGVyU3ZnLnB1c2goJzxjaXJjbGUgY3g9IicreCsnIiBjeT0iJytzY2FsZShpdGVtc1tpXVt0XSkrJyIgcj0iMyIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2U9IicrY29sKyciIGZpbGw9IicrY29sKyciIGZpbGwtb3BhY2l0eT0iMC41IiAvPicpOwogICAgICB9CiAgICAgIG90aGVyU3ZnLnB1c2goJzwvZz4nKTsKICAgIH0KICB9CgoKICB2YXIgcGF0aHMgPSAnPHBhdGggZD0iTTQwLDExMCBMNDAsMTAgTTQwLDExMCBMMzkwLDExMCIgc3Ryb2tlPSIjZmZmIiAvPic7CgogIC8vIGdyYXBoIHRpY2ttYXJrcyAtIGhvcml6b250YWwKICB2YXIgdGlja3MgPSBbXTsKICBmb3IgKHZhciBpPTU7IGk8PTM1OyBpKz01KSB7CiAgICB2YXIgeD1pKjEwKzQwOwogICAgdGlja3MucHVzaCgnTScreCsnLDEwIEwnK3grJywxMTAnKTsKICAgIG90aGVyU3ZnLnB1c2goJzx0ZXh0IHg9IicreCsnIiB5PSIxMjUiIGZvbnQtc2l6ZT0iMTIiIGZvbnQtZmFtaWx5PSJSb2JvdG8sIEhlbHZldGljYSwgc2Fucy1zZXJpZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iI2ZmZiI+JytpKyc8L3RleHQ+Jyk7CiAgfQoKICAvLyB2ZXJ0aWNhbAogIC8vIGZpcnN0IHdlIGNhbGN1bGF0ZSB0aGUgcG93ZXIgb2YgMTAgdGhhdCBpcyBzbWFsbGVyIHRoYW4gdGhlIG1heCBsaW1pdAogIHZhciB2dGlja1N0ZXAgPSBNYXRoLnBvdygxMCxNYXRoLmZsb29yKE1hdGgubG9nMTAobWF4KSkpOwogIHZhciB2dGlja3MgPSBbXTsKICBpZihsb2dzY2FsZSkgewogICAgZm9yKHZhciBpPTA7aTw0O2krKykgewogICAgICB2dGlja3MucHVzaCh2dGlja1N0ZXApOwogICAgICB2dGlja1N0ZXAgLz0gMTA7CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIHRoaXMgY291bGQgYmUgYmV0d2VlbiAxIGFuZCAxMCBncmlkIGxpbmVzIC0gc28gd2UgYWRqdXN0IHRvIGdpdmUgbmljZXIgc3BhY2luZ3MKICAgIGlmICh2dGlja1N0ZXAgPCAobWF4LzUpKSB7CiAgICAgIHZ0aWNrU3RlcCAqPSAyOwogICAgfSBlbHNlIGlmICh2dGlja1N0ZXAgPiAobWF4LzIpKSB7CiAgICAgIHZ0aWNrU3RlcCAvPSAyOwogICAgfQogICAgZm9yICh2YXIgaT12dGlja1N0ZXA7IGk8PW1heDsgaSs9dnRpY2tTdGVwKSB7CiAgICAgIHZ0aWNrcy5wdXNoKGkpOwogICAgfQogIH0KICB2dGlja3MuZm9yRWFjaChmdW5jdGlvbihpKSB7CiAgICB2YXIgeSA9IHNjYWxlKGkpOwoKICAgIHRpY2tzLnB1c2goJ000MCwnK3krJyBMMzkwLCcreSk7CgogICAgdmFyIGlzdHIgPSBpPj0xMDAwMDAwMDAwID8gaS8xMDAwMDAwMDAwKydCJyA6IGk+PTEwMDAwMDAgPyBpLzEwMDAwMDArJ00nIDogaT49MTAwMCA/IGkvMTAwMCsnaycgOiBpOwogICAgb3RoZXJTdmcucHVzaCgnPHRleHQgeD0iMzUiIHk9IicreSsnIiBmb250LXNpemU9IjEyIiBmb250LWZhbWlseT0iUm9ib3RvLCBIZWx2ZXRpY2EsIHNhbnMtc2VyaWYiIHRleHQtYW5jaG9yPSJlbmQiIGZpbGw9IiNmZmYiPicraXN0cisnPC90ZXh0PicpOwogIH0pOwoKICBwYXRocyArPSAnPHBhdGggZD0iJyt0aWNrcy5qb2luKCcgJykrJyIgc3Ryb2tlPSIjZmZmIiBvcGFjaXR5PSIwLjMiIC8+OycKCiAgZm9yICh2YXIgdD0wOyB0PDI7IHQrKykgewogICAgdmFyIGNvbCA9IHQ9PTAgPyBDT0xPUlNbVEVBTV9FTkxdIDogQ09MT1JTW1RFQU1fUkVTXTsKICAgIGlmICh0ZWFtUGF0aHNbdF0ubGVuZ3RoID4gMCkgewogICAgICBwYXRocyArPSAnPHBhdGggZD0iJyt0ZWFtUGF0aHNbdF0uam9pbignICcpKyciIHN0cm9rZT0iJytjb2wrJyIgLz4nOwogICAgfQoKICAgIHZhciB5ID0gc2NhbGUocmVzdWx0LmdhbWVTY29yZVt0XSk7CiAgICBwYXRocyArPSAnPHBhdGggZD0iTTQwLCcreSsnIEwzOTAsJyt5KyciIHN0cm9rZT0iJytjb2wrJyIgc3Ryb2tlLWRhc2hhcnJheT0iMywyIiBvcGFjaXR5PSIwLjgiIC8+JzsKICB9CgogIHZhciBzdmcgPSAnPGRpdj48c3ZnIHdpZHRoPSI0MDAiIGhlaWdodD0iMTMwIj4nCiAgICAgICAgICAgKyc8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iNDAwIiBoZWlnaHQ9IjEzMCIgc3Ryb2tlPSIjRkZDRTAwIiBmaWxsPSIjMDgzMDRFIiAvPicKICAgICAgICAgICArcGF0aHMKICAgICAgICAgICArb3RoZXJTdmcuam9pbignJykKICAgICAgICAgICArJzxmb3JlaWduT2JqZWN0IGhlaWdodD0iMTgiIHdpZHRoPSI0NSIgeT0iMTExIiB4PSIwIiBjbGFzcz0ibm9kZSI+PGxhYmVsIHRpdGxlPSJMb2dhcml0aG1pYyBzY2FsZSI+JwogICAgICAgICAgICsnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjbGFzcz0ibG9nc2NhbGUiIHN0eWxlPSJoZWlnaHQ6YXV0bztwYWRkaW5nOjA7dmVydGljYWwtYWxpZ246bWlkZGxlIicrKGxvZ3NjYWxlPycgY2hlY2tlZCc6JycpKycvPicKICAgICAgICAgICArJ2xvZzwvbGFiZWw+PC9mb3JlaWduT2JqZWN0PicKICAgICAgICAgICArJzwvc3ZnPjwvZGl2Pic7CgogIHJldHVybiBzdmc7Cn0KCmZ1bmN0aW9uIHJlZ2lvblNjb3JlYm9hcmRTY29yZUhpc3RvcnlUYWJsZShyZXN1bHQpIHsKICB2YXIgaGlzdG9yeSA9IHJlc3VsdC5zY29yZUhpc3Rvcnk7CiAgdmFyIHRhYmxlID0gJzx0YWJsZSBjbGFzcz0iY2hlY2twb2ludF90YWJsZSI+PHRoZWFkPjx0cj48dGg+Q2hlY2twb2ludDwvdGg+PHRoPkVubGlnaHRlbmVkPC90aD48dGg+UmVzaXN0YW5jZTwvdGg+PC90cj48L3RoZWFkPic7CgogIGZvcih2YXIgaT0wOyBpPGhpc3RvcnkubGVuZ3RoOyBpKyspIHsKICAgIHRhYmxlICs9ICc8dHI+PHRkPicgKyBoaXN0b3J5W2ldWzBdICsgJzwvdGQ+PHRkPicgKyBkaWdpdHMoaGlzdG9yeVtpXVsxXSkgKyAnPC90ZD48dGQ+JyArIGRpZ2l0cyhoaXN0b3J5W2ldWzJdKSArICc8L3RkPjwvdHI+JzsKICB9CgogIHRhYmxlICs9ICc8L3RhYmxlPic7CiAgcmV0dXJuIHRhYmxlOwp9CgpmdW5jdGlvbiByZWdpb25TY29yZWJvYXJkU3VjY2VzcyhkYXRhLGRsZyxsb2dzY2FsZSkgewogIGlmIChkYXRhLnJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7CiAgICByZXR1cm4gcmVnaW9uU2NvcmVib2FyZEZhaWx1cmUoZGxnKTsKICB9CgogIHZhciBhZ2VudFRhYmxlID0gJzx0YWJsZT48dHI+PHRoPiM8L3RoPjx0aD5BZ2VudDwvdGg+PC90cj4nOwogIGZvciAodmFyIGk9MDsgaTxkYXRhLnJlc3VsdC50b3BBZ2VudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBhZ2VudCA9IGRhdGEucmVzdWx0LnRvcEFnZW50c1tpXTsKICAgIGFnZW50VGFibGUgKz0gJzx0cj48dGQ+JysoaSsxKSsnPC90ZD48dGQgY2xhc3M9Im5pY2tuYW1lICcrKGFnZW50LnRlYW09PSdSRVNJU1RBTkNFJz8ncmVzJzonZW5sJykrJyI+JythZ2VudC5uaWNrKyc8L3RkPjwvdHI+JzsKICB9CiAgaWYgKGRhdGEucmVzdWx0LnRvcEFnZW50cy5sZW5ndGg9PTApIHsKICAgIGFnZW50VGFibGUgKz0gJzx0cj48dGQgY29sc3Bhbj0iMiI+PGk+bm8gdG9wIGFnZW50czwvaT48L3RkPjwvdHI+JzsKICB9CiAgYWdlbnRUYWJsZSArPSAnPC90YWJsZT4nOwoKCiAgdmFyIG1heEF2ZXJhZ2UgPSBNYXRoLm1heChkYXRhLnJlc3VsdC5nYW1lU2NvcmVbMF0sIGRhdGEucmVzdWx0LmdhbWVTY29yZVsxXSwgMSk7CiAgdmFyIHRlYW1Sb3cgPSBbXTsKICBmb3IgKHZhciB0PTA7IHQ8MjsgdCsrKSB7CiAgICB2YXIgdGVhbSA9IHQ9PTAgPyAnRW5saWdodGVuZWQnIDogJ1Jlc2lzdGFuY2UnOwogICAgdmFyIHRlYW1DbGFzcyA9IHQ9PTAgPyAnZW5sJyA6ICdyZXMnOwogICAgdmFyIHRlYW1Db2wgPSB0PT0wID8gQ09MT1JTW1RFQU1fRU5MXSA6IENPTE9SU1tURUFNX1JFU107CiAgICB2YXIgYmFyU2l6ZSA9IE1hdGgucm91bmQoZGF0YS5yZXN1bHQuZ2FtZVNjb3JlW3RdL21heEF2ZXJhZ2UqMjAwKTsKICAgIHRlYW1Sb3dbdF0gPSAnPHRyPjx0aCBjbGFzcz0iJyt0ZWFtQ2xhc3MrJyI+Jyt0ZWFtKyc8L3RoPjx0ZCBjbGFzcz0iJyt0ZWFtQ2xhc3MrJyI+JytkaWdpdHMoZGF0YS5yZXN1bHQuZ2FtZVNjb3JlW3RdKSsnPC90ZD48dGQ+PGRpdiBzdHlsZT0iYmFja2dyb3VuZDonK3RlYW1Db2wrJzsgd2lkdGg6ICcrYmFyU2l6ZSsncHg7IGhlaWdodDogMS4zZXg7IGJvcmRlcjogMnB4IG91dHNldCAnK3RlYW1Db2wrJyI+IDwvdGQ+PC90cj4nOwoKICB9CgogIHZhciBmaXJzdCA9IFBMQVlFUi50ZWFtID09ICdSRVNJU1RBTkNFJyA/IDEgOiAwOwoKICAvLyB3ZSBuZWVkIHNvbWUgZGl2cyB0byBtYWtlIHRoZSBhY2NvcmRpb24gd29yayBwcm9wZXJseQogIGRsZy5odG1sKCc8ZGl2IGNsYXNzPSJjZWxsc2NvcmUiPicKICAgICAgICAgKyc8Yj5SZWdpb24gc2NvcmVzIGZvciAnK2RhdGEucmVzdWx0LnJlZ2lvbk5hbWUrJzwvYj4nCiAgICAgICAgICsnPGRpdj48dGFibGU+Jyt0ZWFtUm93W2ZpcnN0XSt0ZWFtUm93WzEtZmlyc3RdKyc8L3RhYmxlPicKICAgICAgICAgK3JlZ2lvblNjb3JlYm9hcmRTY29yZUhpc3RvcnlDaGFydChkYXRhLnJlc3VsdCwgbG9nc2NhbGUpKyc8L2Rpdj4nCiAgICAgICAgICsnPGI+Q2hlY2twb2ludCBvdmVydmlldzwvYj4nCiAgICAgICAgICsnPGRpdj4nK3JlZ2lvblNjb3JlYm9hcmRTY29yZUhpc3RvcnlUYWJsZShkYXRhLnJlc3VsdCkrJzwvZGl2PicKICAgICAgICAgKyc8Yj5Ub3AgYWdlbnRzPC9iPicKICAgICAgICAgKyc8ZGl2PicrYWdlbnRUYWJsZSsnPC9kaXY+JwogICAgICAgICArJzwvZGl2PicpOwoKICAkKCdnLmNoZWNrcG9pbnQnLCBkbGcpLmVhY2goZnVuY3Rpb24oaSwgZWxlbSkgewogICAgZWxlbSA9ICQoZWxlbSk7CgogICAgdmFyIHRvb2x0aXAgPSAnQ1A6XHQnK2VsZW0uYXR0cignZGF0YS1jcCcpCiAgICAgICsgJ1xuRW5sOlx0JyArIGRpZ2l0cyhlbGVtLmF0dHIoJ2RhdGEtZW5sJykpCiAgICAgICsgJ1xuUmVzOlx0JyArIGRpZ2l0cyhlbGVtLmF0dHIoJ2RhdGEtcmVzJykpOwogICAgZWxlbS50b29sdGlwKHsKICAgICAgY29udGVudDogY29udmVydFRleHRUb1RhYmxlTWFnaWModG9vbHRpcCksCiAgICAgIHBvc2l0aW9uOiB7bXk6ICJjZW50ZXIgYm90dG9tIiwgYXQ6ICJjZW50ZXIgdG9wLTEwIn0KICAgIH0pOwogIH0pOwoKICAkKCcuY2VsbHNjb3JlJywgZGxnKS5hY2NvcmRpb24oewogICAgaGVhZGVyOiAnYicsCiAgICBoZWlnaHRTdHlsZTogImZpbGwiLAogIH0pOwoKICAkKCdpbnB1dC5sb2dzY2FsZScsIGRsZykuY2hhbmdlKGZ1bmN0aW9uKCl7CiAgICB2YXIgaW5wdXQgPSAkKHRoaXMpOwogICAgcmVnaW9uU2NvcmVib2FyZFN1Y2Nlc3MoZGF0YSwgZGxnLCBpbnB1dC5wcm9wKCdjaGVja2VkJykpOwogIH0pOwp9CgoKOwoKCi8vIFJFUVVFU1QgSEFORExJTkcgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gbm90ZTogb25seSBtZWFudCBmb3IgcG9ydGFsL2xpbmtzL2ZpZWxkcyByZXF1ZXN0LCBldmVyeXRoaW5nIGVsc2UKLy8gZG9lcyBub3QgY291bnQgdG93YXJkcyDigJxsb2FkaW5n4oCdCgp3aW5kb3cuYWN0aXZlUmVxdWVzdHMgPSBbXTsKd2luZG93LmZhaWxlZFJlcXVlc3RDb3VudCA9IDA7CndpbmRvdy5zdGF0dXNUb3RhbE1hcFRpbGVzID0gMDsKd2luZG93LnN0YXR1c0NhY2hlZE1hcFRpbGVzID0gMDsKd2luZG93LnN0YXR1c1N1Y2Nlc3NNYXBUaWxlcyA9IDA7CndpbmRvdy5zdGF0dXNTdGFsZU1hcFRpbGVzID0gMDsKd2luZG93LnN0YXR1c0Vycm9yTWFwVGlsZXMgPSAwOwoKCndpbmRvdy5yZXF1ZXN0cyA9IGZ1bmN0aW9uKCkge30KCi8vdGltZSBvZiBsYXN0IHJlZnJlc2gKd2luZG93LnJlcXVlc3RzLl9sYXN0UmVmcmVzaFRpbWUgPSAwOwp3aW5kb3cucmVxdWVzdHMuX3F1aWNrUmVmcmVzaFBlbmRpbmcgPSBmYWxzZTsKCndpbmRvdy5yZXF1ZXN0cy5hZGQgPSBmdW5jdGlvbihhamF4KSB7CiAgd2luZG93LmFjdGl2ZVJlcXVlc3RzLnB1c2goYWpheCk7CiAgcmVuZGVyVXBkYXRlU3RhdHVzKCk7Cn0KCndpbmRvdy5yZXF1ZXN0cy5yZW1vdmUgPSBmdW5jdGlvbihhamF4KSB7CiAgd2luZG93LmFjdGl2ZVJlcXVlc3RzLnNwbGljZSh3aW5kb3cuYWN0aXZlUmVxdWVzdHMuaW5kZXhPZihhamF4KSwgMSk7CiAgcmVuZGVyVXBkYXRlU3RhdHVzKCk7Cn0KCndpbmRvdy5yZXF1ZXN0cy5hYm9ydCA9IGZ1bmN0aW9uKCkgewogICQuZWFjaCh3aW5kb3cuYWN0aXZlUmVxdWVzdHMsIGZ1bmN0aW9uKGluZCwgYWN0UmVxKSB7CiAgICBpZihhY3RSZXEpIGFjdFJlcS5hYm9ydCgpOwogIH0pOwoKICB3aW5kb3cuYWN0aXZlUmVxdWVzdHMgPSBbXTsKICB3aW5kb3cuZmFpbGVkUmVxdWVzdENvdW50ID0gMDsKICB3aW5kb3cuY2hhdC5fcmVxdWVzdFB1YmxpY1J1bm5pbmcgID0gZmFsc2U7CiAgd2luZG93LmNoYXQuX3JlcXVlc3RGYWN0aW9uUnVubmluZyAgPSBmYWxzZTsKCiAgcmVuZGVyVXBkYXRlU3RhdHVzKCk7Cn0KCgoKLy8gc2V0cyB0aGUgdGltZXIgZm9yIHRoZSBuZXh0IGF1dG8gcmVmcmVzaC4gRW5zdXJlcyBvbmx5IG9uZSB0aW1lb3V0Ci8vIGlzIHF1ZXVlZC4gTWF5IGJlIGdpdmVuICdvdmVycmlkZScgaW4gbWlsbGlzZWNvbmRzIGlmIHRpbWUgc2hvdWxkCi8vIG5vdCBiZSBndWVzc2VkIGF1dG9tYXRpY2FsbHkuIEVzcGVjaWFsbHkgdXNlZnVsIGlmIGEgbGl0dGxlIGRlbGF5Ci8vIGlzIHJlcXVpcmVkLCBmb3IgZXhhbXBsZSB3aGVuIHpvb21pbmcuCndpbmRvdy5zdGFydFJlZnJlc2hUaW1lb3V0ID0gZnVuY3Rpb24ob3ZlcnJpZGUpIHsKICAvLyBtYXkgYmUgcmVxdWlyZWQgdG8gcmVtb3ZlICdwYXVzZWQgZHVyaW5nIGludGVyYWN0aW9uJyBtZXNzYWdlIGluCiAgLy8gc3RhdHVzIGJhcgogIHdpbmRvdy5yZW5kZXJVcGRhdGVTdGF0dXMoKTsKICBpZihyZWZyZXNoVGltZW91dCkgY2xlYXJUaW1lb3V0KHJlZnJlc2hUaW1lb3V0KTsKICBpZihvdmVycmlkZSA9PSAtMSkgcmV0dXJuOyAgLy9kb24ndCBzZXQgYSBuZXcgdGltZW91dAoKICB2YXIgdCA9IDA7CiAgaWYob3ZlcnJpZGUpIHsKICAgIHdpbmRvdy5yZXF1ZXN0cy5fcXVpY2tSZWZyZXNoUGVuZGluZyA9IHRydWU7CiAgICB0ID0gb3ZlcnJpZGU7CiAgICAvL2Vuc3VyZSBvdmVycmlkZSBjYW4ndCBjYXVzZSB0b28gZmFzdCBhIHJlZnJlc2ggaWYgcmVwZWF0ZWRseSB1c2VkIChlLmcuIGxvdHMgb2Ygc2Nyb2xsaW5nL3pvb21pbmcpCiAgICB0aW1lU2luY2VMYXN0UmVmcmVzaCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLXdpbmRvdy5yZXF1ZXN0cy5fbGFzdFJlZnJlc2hUaW1lOwogICAgaWYodGltZVNpbmNlTGFzdFJlZnJlc2ggPCAwKSB0aW1lU2luY2VMYXN0UmVmcmVzaCA9IDA7ICAvL2luIGNhc2Ugb2YgY2xvY2sgYWRqdXN0bWVudHMKICAgIGlmKHRpbWVTaW5jZUxhc3RSZWZyZXNoIDwgTUlOSU1VTV9PVkVSUklERV9SRUZSRVNIKjEwMDApCiAgICAgIHQgPSAoTUlOSU1VTV9PVkVSUklERV9SRUZSRVNIKjEwMDAtdGltZVNpbmNlTGFzdFJlZnJlc2gpOwogIH0gZWxzZSB7CiAgICB3aW5kb3cucmVxdWVzdHMuX3F1aWNrUmVmcmVzaFBlbmRpbmcgPSBmYWxzZTsKICAgIHQgPSBSRUZSRVNIKjEwMDA7CgogICAgdmFyIGFkaiA9IFpPT01fTEVWRUxfQURKICogKDE4IC0gbWFwLmdldFpvb20oKSk7CiAgICBpZihhZGogPiAwKSB0ICs9IGFkaioxMDAwOwogIH0KICB2YXIgbmV4dCA9IG5ldyBEYXRlKG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgdCkudG9Mb2NhbGVUaW1lU3RyaW5nKCk7Ci8vICBjb25zb2xlLmxvZygncGxhbm5lZCByZWZyZXNoIGluICcgKyAodC8xMDAwKSArICcgc2Vjb25kcywgYXQgJyArIG5leHQpOwogIHJlZnJlc2hUaW1lb3V0ID0gc2V0VGltZW91dCh3aW5kb3cucmVxdWVzdHMuX2NhbGxPblJlZnJlc2hGdW5jdGlvbnMsIHQpOwogIHJlbmRlclVwZGF0ZVN0YXR1cygpOwp9Cgp3aW5kb3cucmVxdWVzdHMuX29uUmVmcmVzaEZ1bmN0aW9ucyA9IFtdOwp3aW5kb3cucmVxdWVzdHMuX2NhbGxPblJlZnJlc2hGdW5jdGlvbnMgPSBmdW5jdGlvbigpIHsKLy8gIGNvbnNvbGUubG9nKCdydW5uaW5nIHJlZnJlc2ggYXQgJyArIG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCkpOwogIHN0YXJ0UmVmcmVzaFRpbWVvdXQoKTsKCiAgaWYoaXNJZGxlKCkpIHsKLy8gICAgY29uc29sZS5sb2coJ3VzZXIgaGFzIGJlZW4gaWRsZSBmb3IgJyArIGlkbGVUaW1lICsgJyBzZWNvbmRzLCBvciB3aW5kb3cgaGlkZGVuLiBTa2lwcGluZyByZWZyZXNoLicpOwogICAgcmVuZGVyVXBkYXRlU3RhdHVzKCk7CiAgICByZXR1cm47CiAgfQoKLy8gIGNvbnNvbGUubG9nKCdyZWZyZXNoaW5nJyk7CgogIC8vc3RvcmUgdGhlIHRpbWVzdGFtcCBvZiB0aGlzIHJlZnJlc2gKICB3aW5kb3cucmVxdWVzdHMuX2xhc3RSZWZyZXNoVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwoKICAkLmVhY2god2luZG93LnJlcXVlc3RzLl9vblJlZnJlc2hGdW5jdGlvbnMsIGZ1bmN0aW9uKGluZCwgZikgewogICAgZigpOwogIH0pOwp9CgoKLy8gYWRkIG1ldGhvZCBoZXJlIHRvIGJlIG5vdGlmaWVkIG9mIGF1dG8tcmVmcmVzaGVzCndpbmRvdy5yZXF1ZXN0cy5hZGRSZWZyZXNoRnVuY3Rpb24gPSBmdW5jdGlvbihmKSB7CiAgd2luZG93LnJlcXVlc3RzLl9vblJlZnJlc2hGdW5jdGlvbnMucHVzaChmKTsKfQoKd2luZG93LnJlcXVlc3RzLmlzTGFzdFJlcXVlc3QgPSBmdW5jdGlvbihhY3Rpb24pIHsKICB2YXIgcmVzdWx0ID0gdHJ1ZTsKICAkLmVhY2god2luZG93LmFjdGl2ZVJlcXVlc3RzLCBmdW5jdGlvbihpbmQsIHJlcSkgewogICAgaWYocmVxLmFjdGlvbiA9PT0gYWN0aW9uKSB7CiAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSk7CiAgcmV0dXJuIHJlc3VsdDsKfQoKCjsKCgovLyBTRUFSQ0ggLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgovKgp5b3UgY2FuIGltcGxlbWVudCB5b3VyIG93biByZXN1bHQgcHJvdmlkZXIgYnkgbGlzdGluZyB0byB0aGUgc2VhcmNoIGhvb2s6CmFkZEhvb2soJ3NlYXJjaCcsIGZ1bmN0aW9uKHF1ZXJ5KSB7fSk7CgpgcXVlcnlgIGlzIGFuIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgbWVtYmVyczoKLSBgdGVybWAgaXMgdGhlIHRlcm0gZm9yIHdoaWNoIHRoZSB1c2VyIGhhcyBzZWFyY2hlZAotIGBjb25maXJtZWRgIGlzIGEgYm9vbGVhbiBpbmRpY2F0aW5nIGlmIHRoZSB1c2VyIGhhcyBwcmVzc2VkIGVudGVyIGFmdGVyIHNlYXJjaGluZy4gWW91IHNob3VsZCBub3Qgc2VhcmNoIG9ubGluZSBvciAKICBoZWF2eSBwcm9jZXNzaW5nIHVubGVzcyB0aGUgdXNlciBoYXMgY29uZmlybWVkIHRoZSBzZWFyY2ggdGVybQotIGBhZGRSZXN1bHQocmVzdWx0KWAgY2FuIGJlIGNhbGxlZCB0byBhZGQgYSByZXN1bHQgdG8gdGhlIHF1ZXJ5LgoKYHJlc3VsdGAgbWF5IGhhdmUgdGhlIGZvbGxvd2luZyBtZW1iZXJzIChgdGl0bGVgIGlzIHJlcXVpcmVkLCBhcyB3ZWxsIGFzIG9uZSBvZiBgcG9zaXRpb25gIGFuZCBgYm91bmRzYCk6Ci0gYHRpdGxlYDogdGhlIGxhYmVsIGZvciB0aGlzIHJlc3VsdC4gV2lsbCBiZSBpbnRlcnByZXRlZCBhcyBIVE1MLCBzbyBtYWtlIHN1cmUgdG8gZXNjYXBlIHByb3Blcmx5LgotIGBkZXNjcmlwdGlvbmA6IHNlY29uZGFyeSBpbmZvcm1hdGlvbiBmb3IgdGhpcyByZXN1bHQuIFdpbGwgYmUgaW50ZXJwcmV0ZWQgYXMgSFRNTCwgc28gbWFrZSBzdXJlIHRvIGVzY2FwZSBwcm9wZXJseS4KLSBgcG9zaXRpb25gOiBhIEwuTGF0TG5nIG9iamVjdCBkZXNjcmliaW5nIHRoZSBwb3NpdGlvbiBvZiB0aGlzIHJlc3VsdAotIGBib3VuZHNgOiBhIEwuTGF0TG5nQm91bmRzIG9iamVjdCBkZXNjcmliaW5nIHRoZSBib3VuZHMgb2YgdGhpcyByZXN1bHQKLSBgbGF5ZXJgOiBhIElMYXllciB0byBiZSBhZGRlZCB0byB0aGUgbWFwIHdoZW4gdGhlIHVzZXIgc2VsZWN0cyB0aGlzIHNlYXJjaCByZXN1bHQuIFdpbGwgYmUgZ2VuZXJhdGVkIGlmIG5vdCBzZXQuCiAgU2V0IHRvIGBudWxsYCB0byBwcmV2ZW50IHRoZSByZXN1bHQgZnJvbSBiZWluZyBhZGRlZCB0byB0aGUgbWFwLgotIGBpY29uYDogYSBVUkwgdG8gYSBpY29uIHRvIGRpc3BsYXkgaW4gdGhlIHJlc3VsdCBsaXN0LiBTaG91bGQgYmUgMTJ4MTIuCi0gYG9uU2VsZWN0ZWQocmVzdWx0LCBldmVudClgOiBhIGhhbmRsZXIgdG8gYmUgY2FsbGVkIHdoZW4gdGhlIHJlc3VsdCBpcyBzZWxlY3RlZC4gTWF5IHJldHVybiBgdHJ1ZWAgdG8gcHJldmVudCB0aGUgbWFwCiAgZnJvbSBiZWluZyByZXBvc2l0aW9uZWQuIFlvdSBtYXkgcmVwb3NpdGlvbiB0aGUgbWFwIHlvdXJzZWxmIG9yIGRvIG90aGVyIHdvcmsuCi0gYG9uUmVtb3ZlKHJlc3VsdClgOiBhIGhhbmRsZXIgdG8gYmUgY2FsbGVkIHdoZW4gdGhlIHJlc3VsdCBpcyByZW1vdmVkIGZyb20gdGhlIG1hcCAoYmVjYXVzZSBhbm90aGVyIHJlc3VsdCBoYXMgYmVlbgogIHNlbGVjdGVkIG9yIHRoZSBzZWFyY2ggd2FzIGNhbmNlbGxlZCBieSB0aGUgdXNlcikuCiovCgp3aW5kb3cuc2VhcmNoID0gewogIGxhc3RTZWFyY2g6IG51bGwsCn07Cgp3aW5kb3cuc2VhcmNoLlF1ZXJ5ID0gZnVuY3Rpb24odGVybSwgY29uZmlybWVkKSB7CiAgdGhpcy50ZXJtID0gdGVybTsKICB0aGlzLmNvbmZpcm1lZCA9IGNvbmZpcm1lZDsKICB0aGlzLmluaXQoKTsKfTsKd2luZG93LnNlYXJjaC5RdWVyeS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkgewogIHRoaXMucmVzdWx0cyA9IFtdOwoKICB0aGlzLmNvbnRhaW5lciA9ICQoJzxkaXY+JykuYWRkQ2xhc3MoJ3NlYXJjaHF1ZXJ5Jyk7CgogIHRoaXMuaGVhZGVyID0gJCgnPGgzPicpCiAgICAudGV4dCh0aGlzLmNvbmZpcm1lZAogICAgICA/IHRoaXMudGVybQogICAgICA6ICgodGhpcy50ZXJtLmxlbmd0aCA+IDE2CiAgICAgICAgPyB0aGlzLnRlcm0uc3Vic3RyKDAsOCkgKyAn4oCmJyArIHRoaXMudGVybS5zdWJzdHIodGhpcy50ZXJtLmxlbmd0aC04LDgpCiAgICAgICAgOiB0aGlzLnRlcm0pCiAgICAgICAgKyAnIChSZXR1cm4gdG8gbG9hZCBtb3JlKScpKQogICAgLmFwcGVuZFRvKHRoaXMuY29udGFpbmVyKTsKCiAgdGhpcy5saXN0ID0gJCgnPHVsPicpCiAgICAuYXBwZW5kVG8odGhpcy5jb250YWluZXIpCiAgICAuYXBwZW5kKCQoJzxsaT4nKS50ZXh0KHRoaXMuY29uZmlybWVkID8gJ05vIGxvY2FsIHJlc3VsdHMsIHNlYXJjaGluZyBvbmxpbmUuLi4nIDogJ05vIGxvY2FsIHJlc3VsdHMuJykpOwoKICB0aGlzLmNvbnRhaW5lci5hY2NvcmRpb24oewogICAgY29sbGFwc2libGU6IHRydWUsCiAgICBoZWlnaHRTdHlsZTogJ2NvbnRlbnQnLAogIH0pOwoKICBydW5Ib29rcygnc2VhcmNoJywgdGhpcyk7Cn07CndpbmRvdy5zZWFyY2guUXVlcnkucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpIHsKICB0aGlzLmNvbnRhaW5lci5hcHBlbmRUbygnI3NlYXJjaHdyYXBwZXInKTsKfTsKd2luZG93LnNlYXJjaC5RdWVyeS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkgewogIHRoaXMuY29udGFpbmVyLnJlbW92ZSgpOwogIHRoaXMucmVtb3ZlU2VsZWN0ZWRSZXN1bHQoKTsKfTsKd2luZG93LnNlYXJjaC5RdWVyeS5wcm90b3R5cGUuYWRkUmVzdWx0ID0gZnVuY3Rpb24ocmVzdWx0KSB7CiAgaWYodGhpcy5yZXN1bHRzLmxlbmd0aCA9PSAwKSB7CiAgICAvLyByZW1vdmUgJ05vIHJlc3VsdHMnCiAgICB0aGlzLmxpc3QuZW1wdHkoKTsKICB9CgogIHRoaXMucmVzdWx0cy5wdXNoKHJlc3VsdCk7CiAgdmFyIGl0ZW0gPSAkKCc8bGk+JykKICAgIC5hcHBlbmRUbyh0aGlzLmxpc3QpCiAgICAuYXR0cigndGFiaW5kZXgnLCAnMCcpCiAgICAub24oJ2NsaWNrIGRibGNsaWNrJywgZnVuY3Rpb24oZXYpIHsKICAgICAgdGhpcy5vblJlc3VsdFNlbGVjdGVkKHJlc3VsdCwgZXYpOwogICAgfS5iaW5kKHRoaXMpKQogICAgLmtleXByZXNzKGZ1bmN0aW9uKGV2KSB7CiAgICAgIGlmKChldi5rZXlDb2RlIHx8IGV2LmNoYXJDb2RlIHx8IGV2LndoaWNoKSA9PSAzMikgewogICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZXYudHlwZSA9ICdjbGljayc7CiAgICAgICAgJCh0aGlzKS50cmlnZ2VyKGV2KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYoKGV2LmtleUNvZGUgfHwgZXYuY2hhckNvZGUgfHwgZXYud2hpY2gpID09IDEzKSB7CiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICBldi50eXBlID0gJ2RibGNsaWNrJzsKICAgICAgICAkKHRoaXMpLnRyaWdnZXIoZXYpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfSk7CgogIHZhciBsaW5rID0gJCgnPGE+JykKICAgIC5hcHBlbmQocmVzdWx0LnRpdGxlKQogICAgLmFwcGVuZFRvKGl0ZW0pOwoKICBpZihyZXN1bHQuaWNvbikgewogICAgbGluay5jc3MoJ2JhY2tncm91bmQtaW1hZ2UnLCAndXJsKCInK3Jlc3VsdC5pY29uKyciKScpOwogICAgaXRlbS5jc3MoJ2xpc3Qtc3R5bGUnLCAnbm9uZScpOwogIH0KCiAgaWYocmVzdWx0LmRlc2NyaXB0aW9uKSB7CiAgICBpdGVtCiAgICAgIC5hcHBlbmQoJCgnPGJyPicpKQogICAgICAuYXBwZW5kKCQoJzxlbT4nKQogICAgICAgIC5hcHBlbmQocmVzdWx0LmRlc2NyaXB0aW9uKSk7CiAgfQoKfTsKd2luZG93LnNlYXJjaC5RdWVyeS5wcm90b3R5cGUub25SZXN1bHRTZWxlY3RlZCA9IGZ1bmN0aW9uKHJlc3VsdCwgZXYpIHsKICB0aGlzLnJlbW92ZVNlbGVjdGVkUmVzdWx0KCk7CiAgdGhpcy5zZWxlY3RlZFJlc3VsdCA9IHJlc3VsdDsKCiAgaWYocmVzdWx0Lm9uU2VsZWN0ZWQpIHsKICAgIGlmKHJlc3VsdC5vblNlbGVjdGVkKHJlc3VsdCwgZXYpKSByZXR1cm47CiAgfQoKICBpZihldi50eXBlID09ICdkYmxjbGljaycpIHsKICAgIGlmKHJlc3VsdC5wb3NpdGlvbikgewogICAgICBtYXAuc2V0VmlldyhyZXN1bHQucG9zaXRpb24sIDE3KTsKICAgIH0gZWxzZSBpZihyZXN1bHQuYm91bmRzKSB7CiAgICAgIG1hcC5maXRCb3VuZHMocmVzdWx0LmJvdW5kcywge21heFpvb206IDE3fSk7CiAgICB9CiAgfSBlbHNlIHsgLy8gZXYudHlwZSAhPSAnZGJsY2xpY2snCiAgICBpZihyZXN1bHQuYm91bmRzKSB7CiAgICAgIG1hcC5maXRCb3VuZHMocmVzdWx0LmJvdW5kcywge21heFpvb206IDE3fSk7CiAgICB9IGVsc2UgaWYocmVzdWx0LnBvc2l0aW9uKSB7CiAgICAgIG1hcC5zZXRWaWV3KHJlc3VsdC5wb3NpdGlvbik7CiAgICB9CiAgfQoKICBpZihyZXN1bHQubGF5ZXIgIT09IG51bGwgJiYgIXJlc3VsdC5sYXllcikgewogICAgcmVzdWx0LmxheWVyID0gTC5sYXllckdyb3VwKCk7CgogICAgaWYocmVzdWx0LnBvc2l0aW9uKSB7CiAgICAgIGNyZWF0ZUdlbmVyaWNNYXJrZXIocmVzdWx0LnBvc2l0aW9uLCAncmVkJywgewogICAgICAgIHRpdGxlOiByZXN1bHQudGl0bGUKICAgICAgfSkuYWRkVG8ocmVzdWx0LmxheWVyKTsKICAgIH0KCiAgICBpZihyZXN1bHQuYm91bmRzKSB7CiAgICAgIEwucmVjdGFuZ2xlKHJlc3VsdC5ib3VuZHMsIHsKICAgICAgICB0aXRsZTogcmVzdWx0LnRpdGxlLAogICAgICAgIGNsaWNrYWJsZTogZmFsc2UsCiAgICAgICAgY29sb3I6ICdyZWQnLAogICAgICAgIGZpbGw6IGZhbHNlLAogICAgICB9KS5hZGRUbyhyZXN1bHQubGF5ZXIpOwogICAgfQogIH0KCiAgaWYocmVzdWx0LmxheWVyKQogICAgbWFwLmFkZExheWVyKHJlc3VsdC5sYXllcik7CgogIGlmKHdpbmRvdy5pc1NtYXJ0cGhvbmUoKSkgd2luZG93LnNob3coJ21hcCcpOwp9CndpbmRvdy5zZWFyY2guUXVlcnkucHJvdG90eXBlLnJlbW92ZVNlbGVjdGVkUmVzdWx0ID0gZnVuY3Rpb24oKSB7CiAgaWYodGhpcy5zZWxlY3RlZFJlc3VsdCkgewogICAgaWYodGhpcy5zZWxlY3RlZFJlc3VsdC5sYXllcikgbWFwLnJlbW92ZUxheWVyKHRoaXMuc2VsZWN0ZWRSZXN1bHQubGF5ZXIpOwogICAgaWYodGhpcy5zZWxlY3RlZFJlc3VsdC5vblJlbW92ZSkgdGhpcy5zZWxlY3RlZFJlc3VsdC5vblJlbW92ZSh0aGlzLnNlbGVjdGVkUmVzdWx0KTsKICB9Cn0KCndpbmRvdy5zZWFyY2guZG9TZWFyY2ggPSBmdW5jdGlvbih0ZXJtLCBjb25maXJtZWQpIHsKICB0ZXJtID0gdGVybS50cmltKCk7CgogIC8vIG1pbmltdW0gMyBjaGFyYWN0ZXJzIGZvciBhdXRvbWF0aWMgc2VhcmNoCiAgaWYodGVybS5sZW5ndGggPCAzICYmICFjb25maXJtZWQpIHJldHVybjsKCiAgLy8gZG9uJ3QgY2xlYXIgbGFzdCBjb25maXJtZWQgc2VhcmNoCiAgaWYod2luZG93LnNlYXJjaC5sYXN0U2VhcmNoCiAgJiYgd2luZG93LnNlYXJjaC5sYXN0U2VhcmNoLmNvbmZpcm1lZAogICYmICFjb25maXJtZWQpCiAgICByZXR1cm47CgogIC8vIGRvbid0IG1ha2UgdGhlIHNhbWUgcXVlcnkgYWdhaW4KICBpZih3aW5kb3cuc2VhcmNoLmxhc3RTZWFyY2gKICAmJiB3aW5kb3cuc2VhcmNoLmxhc3RTZWFyY2guY29uZmlybWVkID09IGNvbmZpcm1lZAogICYmIHdpbmRvdy5zZWFyY2gubGFzdFNlYXJjaC50ZXJtID09IHRlcm0pCiAgICByZXR1cm47CgogIGlmKHdpbmRvdy5zZWFyY2gubGFzdFNlYXJjaCkgd2luZG93LnNlYXJjaC5sYXN0U2VhcmNoLmhpZGUoKTsKICB3aW5kb3cuc2VhcmNoLmxhc3RTZWFyY2ggPSBudWxsOwoKICAvLyBjbGVhciByZXN1bHRzCiAgaWYodGVybSA9PSAnJykgcmV0dXJuOwoKICBpZih1c2VBbmRyb2lkUGFuZXMoKSkgc2hvdygnaW5mbycpOwoKICAkKCcudWktdG9vbHRpcCcpLnJlbW92ZSgpOwoKICB3aW5kb3cuc2VhcmNoLmxhc3RTZWFyY2ggPSBuZXcgd2luZG93LnNlYXJjaC5RdWVyeSh0ZXJtLCBjb25maXJtZWQpOwogIHdpbmRvdy5zZWFyY2gubGFzdFNlYXJjaC5zaG93KCk7Cn07Cgp3aW5kb3cuc2VhcmNoLnNldHVwID0gZnVuY3Rpb24oKSB7CiAgJCgnI3NlYXJjaCcpCiAgICAua2V5cHJlc3MoZnVuY3Rpb24oZSkgewogICAgICBpZigoZS5rZXlDb2RlID8gZS5rZXlDb2RlIDogZS53aGljaCkgIT0gMTMpIHJldHVybjsKICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgdmFyIHRlcm0gPSAkKHRoaXMpLnZhbCgpOwoKICAgICAgY2xlYXJUaW1lb3V0KHdpbmRvdy5zZWFyY2gudGltZXIpOwogICAgICB3aW5kb3cuc2VhcmNoLmRvU2VhcmNoKHRlcm0sIHRydWUpOwogICAgfSkKICAgIC5vbigna2V5dXAga2V5cHJlc3MgY2hhbmdlIHBhc3RlJywgZnVuY3Rpb24oZSkgewogICAgICBjbGVhclRpbWVvdXQod2luZG93LnNlYXJjaC50aW1lcik7CiAgICAgIHdpbmRvdy5zZWFyY2gudGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0ZXJtID0gJCh0aGlzKS52YWwoKTsKICAgICAgICB3aW5kb3cuc2VhcmNoLmRvU2VhcmNoKHRlcm0sIGZhbHNlKTsKICAgICAgfS5iaW5kKHRoaXMpLCA1MDApOwogICAgfSk7CiAgJCgnI2J1dHRvbmdlb2xvY2F0aW9uJykuY2xpY2soZnVuY3Rpb24oKXsKICAgIG1hcC5sb2NhdGUoe3NldFZpZXcgOiB0cnVlLCBtYXhab29tOiAxM30pOwogIH0pOwp9OwoKYWRkSG9vaygnc2VhcmNoJywgZnVuY3Rpb24ocXVlcnkpIHsKICB2YXIgdGVybSA9IHF1ZXJ5LnRlcm0udG9Mb3dlckNhc2UoKTsKICB2YXIgdGVhbXMgPSBbJ05FVScsJ1JFUycsJ0VOTCddOwoKICAkLmVhY2gocG9ydGFscywgZnVuY3Rpb24oZ3VpZCwgcG9ydGFsKSB7CiAgICB2YXIgZGF0YSA9IHBvcnRhbC5vcHRpb25zLmRhdGE7CiAgICBpZighZGF0YS50aXRsZSkgcmV0dXJuOwoKICAgIGlmKGRhdGEudGl0bGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRlcm0pICE9PSAtMSkgewogICAgICB2YXIgdGVhbSA9IHBvcnRhbC5vcHRpb25zLnRlYW07CiAgICAgIHZhciBjb2xvciA9IHRlYW09PVRFQU1fTk9ORSA/ICcjQ0NDJyA6IENPTE9SU1t0ZWFtXTsKICAgICAgcXVlcnkuYWRkUmVzdWx0KHsKICAgICAgICB0aXRsZTogZGF0YS50aXRsZSwKICAgICAgICBkZXNjcmlwdGlvbjogdGVhbXNbdGVhbV0gKyAnLCBMJyArIGRhdGEubGV2ZWwgKyAnLCAnICsgZGF0YS5oZWFsdGggKyAnJSwgJyArIGRhdGEucmVzQ291bnQgKyAnIFJlc29uYXRvcnMnLAogICAgICAgIHBvc2l0aW9uOiBwb3J0YWwuZ2V0TGF0TG5nKCksCiAgICAgICAgaWNvbjogJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJytidG9hKCc8c3ZnIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgdmVyc2lvbj0iMS4xIj5cbgk8ZyBzdHlsZT0iZmlsbDolQ09MT1IlO3N0cm9rZTpub25lIj5cbgkJPHBhdGggZD0ibSA2LDEyIC0yLC0xMiAgNCwwIHoiIC8+XG4JCTxwYXRoIGQ9Im0gNiwxMiAtNCwgLTggIDgsMCB6IiAvPlxuCQk8cGF0aCBkPSJtIDYsMTIgLTYsIC00IDEyLDAgeiIgLz5cbgk8L2c+XG48L3N2Zz5cbicucmVwbGFjZSgvJUNPTE9SJS9nLCBjb2xvcikpLAogICAgICAgIG9uU2VsZWN0ZWQ6IGZ1bmN0aW9uKHJlc3VsdCwgZXZlbnQpIHsKICAgICAgICAgIGlmKGV2ZW50LnR5cGUgPT0gJ2RibGNsaWNrJykgewogICAgICAgICAgICB6b29tVG9BbmRTaG93UG9ydGFsKGd1aWQsIHBvcnRhbC5nZXRMYXRMbmcoKSk7CiAgICAgICAgICB9IGVsc2UgaWYod2luZG93LnBvcnRhbHNbZ3VpZF0pIHsKICAgICAgICAgICAgaWYoIW1hcC5nZXRCb3VuZHMoKS5jb250YWlucyhyZXN1bHQucG9zaXRpb24pKSBtYXAuc2V0VmlldyhyZXN1bHQucG9zaXRpb24pOwogICAgICAgICAgICByZW5kZXJQb3J0YWxEZXRhaWxzKGd1aWQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2luZG93LnNlbGVjdFBvcnRhbEJ5TGF0TG5nKHBvcnRhbC5nZXRMYXRMbmcoKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gcHJldmVudCBkZWZhdWx0IGJlaGF2aW9yCiAgICAgICAgfSwKICAgICAgfSk7CiAgICB9CiAgfSk7Cn0pOwoKLy8gVE9ETzogcmVjb2duaXplIDUwwrAzMScwMy44Ik4gN8KwNTknMDUuMyJFIGFuZCBzaW1pbGFyIGZvcm1hdHMKLy8gVE9ETzogaWYgYSBwb3J0YWwgd2l0aCB0aGVzZSBleGFjdCBjb29yZGluYXRlcyBpcyBmb3VuZCwgc2VsZWN0IGl0CmFkZEhvb2soJ3NlYXJjaCcsIGZ1bmN0aW9uKHF1ZXJ5KSB7CiAgaWYocXVlcnkudGVybS5zcGxpdCgnLCcpLmxlbmd0aCA9PSAyKSB7CiAgICB2YXIgbGwgPSBxdWVyeS50ZXJtLnNwbGl0KCcsJyk7CiAgICBpZighaXNOYU4obGxbMF0pICYmICFpc05hTihsbFsxXSkpIHsKICAgICAgcXVlcnkuYWRkUmVzdWx0KHsKICAgICAgICB0aXRsZTogcXVlcnkudGVybSwKICAgICAgICBkZXNjcmlwdGlvbjogJ2dlbyBjb29yZGluYXRlcycsCiAgICAgICAgcG9zaXRpb246IEwubGF0TG5nKHBhcnNlRmxvYXQobGxbMF0pLCBwYXJzZUZsb2F0KGxsWzFdKSksCiAgICAgIH0pOwogICAgfQogIH0KfSk7CgphZGRIb29rKCdzZWFyY2gnLCBmdW5jdGlvbihxdWVyeSkgewogIGlmKCFxdWVyeS5jb25maXJtZWQpIHJldHVybjsKCiAgJC5nZXRKU09OKE5PTUlOQVRJTSArIGVuY29kZVVSSUNvbXBvbmVudChxdWVyeS50ZXJtKSwgZnVuY3Rpb24oZGF0YSkgewogICAgaWYoZGF0YS5sZW5ndGggPT0gMCkgewogICAgICBxdWVyeS5hZGRSZXN1bHQoewogICAgICAgIHRpdGxlOiAnTm8gcmVzdWx0cyBvbiBPcGVuU3RyZWV0TWFwJywKICAgICAgICBpY29uOiAnLy93d3cub3BlbnN0cmVldG1hcC5vcmcvZmF2aWNvbi5pY28nLAogICAgICAgIG9uU2VsZWN0ZWQ6IGZ1bmN0aW9uKCkge3JldHVybiB0cnVlO30sCiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CgogICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIHJlc3VsdCA9IHsKICAgICAgICB0aXRsZTogaXRlbS5kaXNwbGF5X25hbWUsCiAgICAgICAgZGVzY3JpcHRpb246ICdUeXBlOiAnICsgaXRlbS50eXBlLAogICAgICAgIHBvc2l0aW9uOiBMLmxhdExuZyhwYXJzZUZsb2F0KGl0ZW0ubGF0KSwgcGFyc2VGbG9hdChpdGVtLmxvbikpLAogICAgICAgIGljb246IGl0ZW0uaWNvbiwKICAgICAgfTsKCiAgICAgIGlmKGl0ZW0uZ2VvanNvbikgewogICAgICAgIHJlc3VsdC5sYXllciA9IEwuZ2VvSnNvbihpdGVtLmdlb2pzb24sIHsKICAgICAgICAgIGNsaWNrYWJsZTogZmFsc2UsCiAgICAgICAgICBjb2xvcjogJ3JlZCcsCiAgICAgICAgICBvcGFjaXR5OiAwLjcsCiAgICAgICAgICB3ZWlnaHQ6IDIsCiAgICAgICAgICBmaWxsOiBmYWxzZSwKICAgICAgICAgIHBvaW50VG9MYXllcjogZnVuY3Rpb24oZmVhdHVyZURhdGEsbGF0TG5nKSB7CiAgICAgICAgICAgIHJldHVybiBjcmVhdGVHZW5lcmljTWFya2VyKGxhdExuZywncmVkJyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciBiID0gaXRlbS5ib3VuZGluZ2JveDsKICAgICAgaWYoYikgewogICAgICAgIHZhciBzb3V0aFdlc3QgPSBuZXcgTC5MYXRMbmcoYlswXSwgYlsyXSksCiAgICAgICAgICAgIG5vcnRoRWFzdCA9IG5ldyBMLkxhdExuZyhiWzFdLCBiWzNdKTsKICAgICAgICByZXN1bHQuYm91bmRzID0gbmV3IEwuTGF0TG5nQm91bmRzKHNvdXRoV2VzdCwgbm9ydGhFYXN0KTsKICAgICAgfQoKICAgICAgcXVlcnkuYWRkUmVzdWx0KHJlc3VsdCk7CiAgICB9KTsKICB9KTsKfSk7CgoKCjsKCgovLyBwb3N0cyBBSkFYIHJlcXVlc3QgdG8gSW5ncmVzcyBBUEkuCi8vIGFjdGlvbjogbGFzdCBwYXJ0IG9mIHRoZSBhY3R1YWwgVVJMLCB0aGUgcnBjL2Rhc2hib2FyZC4gaXMKLy8gICAgICAgICBhZGRlZCBhdXRvbWF0aWNhbGx5Ci8vIGRhdGE6IEpTT04gZGF0YSB0byBwb3N0LiBtZXRob2Qgd2lsbCBiZSBkZXJpdmVkIGF1dG9tYXRpY2FsbHkgZnJvbQovLyAgICAgICBhY3Rpb24sIGJ1dCBtYXkgYmUgb3ZlcnJpZGRlbi4gRXhwZWN0cyB0byBiZSBnaXZlbiBIYXNoLgovLyAgICAgICBTdHJpbmdzIGFyZSBub3Qgc3VwcG9ydGVkLgovLyBzdWNjZXNzOiBtZXRob2QgdG8gY2FsbCBvbiBzdWNjZXNzLiBTZWUgalF1ZXJ5IEFQSSBkb2NzIGZvciBhdmFpbC0KLy8gICAgICAgICAgYWJsZSBhcmd1bWVudHM6IGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9qUXVlcnkuYWpheC8KLy8gZXJyb3I6IHNlZSBhYm92ZS4gQWRkaXRpb25hbGx5IGl0IGlzIGxvZ2dlZCBpZiB0aGUgcmVxdWVzdCBmYWlsZWQuCndpbmRvdy5wb3N0QWpheCA9IGZ1bmN0aW9uKGFjdGlvbiwgZGF0YSwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgLy8gc3RhdGUgbWFuYWdlbWVudCBmdW5jdGlvbnMuLi4gcGVyaGFwcyBzaG91bGQgYmUgb3V0c2lkZSBvZiB0aGlzIGZ1bmM/CgovLyAgdmFyIHJlbW92ZSA9IGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKSB7IHdpbmRvdy5yZXF1ZXN0cy5yZW1vdmUoanFYSFIpOyB9OwovLyAgdmFyIGVyckNudCA9IGZ1bmN0aW9uKGpxWEhSKSB7IHdpbmRvdy5mYWlsZWRSZXF1ZXN0Q291bnQrKzsgd2luZG93LnJlcXVlc3RzLnJlbW92ZShqcVhIUik7IH07CgogIGlmICh3aW5kb3cubGF0ZXN0RmFpbGVkUmVxdWVzdFRpbWUgJiYgd2luZG93LmxhdGVzdEZhaWxlZFJlcXVlc3RUaW1lIDwgRGF0ZS5ub3coKS0xMjAqMTAwMCkgewogICAgLy8gbm8gZXJyb3JzIGluIHRoZSBsYXN0IHR3byBtaW51dGVzIC0gY2xlYXIgdGhlIGVycm9yIGNvdW50CiAgICB3aW5kb3cuZmFpbGVkUmVxdWVzdENvdW50ID0gMDsKICAgIHdpbmRvdy5sYXRlc3RGYWlsZWRSZXF1ZXN0VGltZSA9IHVuZGVmaW5lZDsKICB9CgogIHZhciBvbkVycm9yID0gZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7CiAgICB3aW5kb3cucmVxdWVzdHMucmVtb3ZlKGpxWEhSKTsKICAgIHdpbmRvdy5mYWlsZWRSZXF1ZXN0Q291bnQrKzsKCiAgICB3aW5kb3cubGF0ZXN0RmFpbGVkUmVxdWVzdFRpbWUgPSBEYXRlLm5vdygpOwoKICAgIC8vIHBhc3MgdGhyb3VnaCB0byB0aGUgdXNlciBlcnJvciBmdW5jLCBpZiBvbmUgZXhpc3RzCiAgICBpZiAoZXJyb3JDYWxsYmFjaykgewogICAgICBlcnJvckNhbGxiYWNrKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bik7CiAgICB9CiAgfTsKCiAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKSB7CiAgICB3aW5kb3cucmVxdWVzdHMucmVtb3ZlKGpxWEhSKTsKCiAgICAvLyB0aGUgTmlhbnRpYyBzZXJ2ZXIgY2FuIHJldHVybiBhIEhUVFAgc3VjY2VzcywgYnV0IHRoZSBKU09OIHJlc3BvbnNlIGNvbnRhaW5zIGFuIGVycm9yLiBoYW5kbGUgdGhhdCBzZW5zaWJseQogICAgaWYgKGRhdGEgJiYgZGF0YS5lcnJvciAmJiBkYXRhLmVycm9yID09ICdvdXQgb2YgZGF0ZScpIHsKICAgICAgd2luZG93LmZhaWxlZFJlcXVlc3RDb3VudCsrOwogICAgICAvLyBsZXQncyBjYWxsIHRoZSBlcnJvciBjYWxsYmFjayBpbiB0aG9zIGNhc2UuLi4KICAgICAgaWYgKGVycm9yQ2FsbGJhY2spIHsKICAgICAgICBlcnJvckNhbGxiYWNrKGpxWEhSLCB0ZXh0U3RhdHVzLCAiZGF0YS5lcnJvciA9PSAnb3V0IG9mIGRhdGUnIik7CiAgICAgIH0KCiAgICAgIHdpbmRvdy5vdXRPZkRhdGVVc2VyUHJvbXB0KCk7CiAgICB9IGVsc2UgewogICAgICBzdWNjZXNzQ2FsbGJhY2soZGF0YSwgdGV4dFN0YXR1cywganFYSFIpOwogICAgfQogIH07CgogIC8vIHdlIHNldCB0aGlzIGZsYWcgd2hlbiB3ZSB3YW50IHRvIGJsb2NrIGFsbCByZXF1ZXN0cyBkdWUgdG8gaGF2aW5nIGFuIG91dCBvZiBkYXRlIENVUlJFTlRfVkVSU0lPTgogIGlmICh3aW5kb3cuYmxvY2tPdXRPZkRhdGVSZXF1ZXN0cykgewogICAgd2luZG93LmZhaWxlZFJlcXVlc3RDb3VudCsrOwogICAgd2luZG93LmxhdGVzdEZhaWxlZFJlcXVlc3RUaW1lID0gRGF0ZS5ub3coKTsKCiAgICAvLyBjYWxsIHRoZSBlcnJvciBjYWxsYmFjaywgaWYgb25lIGV4aXN0cwogICAgaWYgKGVycm9yQ2FsbGJhY2spIHsKICAgICAgLy8gTk9URTogZXJyb3IgY2FsbGVkIG9uIGEgc2V0VGltZW91dCAtIGFzIGl0IHdvbid0IGJlIGV4cGVjdGVkIHRvIGJlIHN5bmNocm9ub3VzCiAgICAgIC8vIGVuc3VyZXMgbm8gcmVjdXJzaW9uIGlzc3VlcyBpZiB0aGUgZXJyb3IgaGFuZGxlciBpbW1lZGlhdGVseSByZXNlbmRzIHRoZSByZXF1ZXN0CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtlcnJvckNhbGxiYWNrKG51bGwsIHVuZGVmaW5lZCwgIndpbmRvdy5ibG9ja091dE9mRGF0ZVJlcXVlc3RzIGlzIHNldCIpO30sIDEwKTsKICAgIH0KICAgIHJldHVybjsKICB9CgogIHZhciB2ZXJzaW9uU3RyID0gbmlhbnRpY19wYXJhbXMuQ1VSUkVOVF9WRVJTSU9OOwogIHZhciBwb3N0X2RhdGEgPSBKU09OLnN0cmluZ2lmeSgkLmV4dGVuZCh7fSwgZGF0YSwge3Y6IHZlcnNpb25TdHJ9KSk7CgogIHZhciByZXN1bHQgPSAkLmFqYXgoewogICAgdXJsOiAnL3IvJythY3Rpb24sCiAgICB0eXBlOiAnUE9TVCcsCiAgICBkYXRhOiBwb3N0X2RhdGEsCiAgICBjb250ZXh0OiBkYXRhLAogICAgZGF0YVR5cGU6ICdqc29uJywKICAgIHN1Y2Nlc3M6IFtvblN1Y2Nlc3NdLAogICAgZXJyb3I6IFtvbkVycm9yXSwKICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcsCiAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbihyZXEpIHsKICAgICAgcmVxLnNldFJlcXVlc3RIZWFkZXIoJ1gtQ1NSRlRva2VuJywgcmVhZENvb2tpZSgnY3NyZnRva2VuJykpOwogICAgfQogIH0pOwogIHJlc3VsdC5hY3Rpb24gPSBhY3Rpb247CgogIHJlcXVlc3RzLmFkZChyZXN1bHQpOwoKICByZXR1cm4gcmVzdWx0Owp9CgoKd2luZG93Lm91dE9mRGF0ZVVzZXJQcm9tcHQgPSBmdW5jdGlvbigpCnsKICAvLyB3ZSBibG9jayBhbGwgcmVxdWVzdHMgd2hpbGUgdGhlIGRpYWxvZyBpcyBvcGVuLiAKICBpZiAoIXdpbmRvdy5ibG9ja091dE9mRGF0ZVJlcXVlc3RzKSB7CiAgICB3aW5kb3cuYmxvY2tPdXRPZkRhdGVSZXF1ZXN0cyA9IHRydWU7CgogICAgZGlhbG9nKHsKICAgICAgdGl0bGU6ICdSZWxvYWQgSUlUQycsCiAgICAgIGh0bWw6ICc8cD5JSVRDIGlzIHVzaW5nIGFuIG91dGRhdGVkIHZlcnNpb24gY29kZS4gVGhpcyB3aWxsIGhhcHBlbiB3aGVuIE5pYW50aWMgdXBkYXRlIHRoZSBzdGFuZGFyZCBpbnRlbCBzaXRlLjwvcD4nCiAgICAgICAgICAgKyc8cD5Zb3UgbmVlZCB0byByZWxvYWQgdGhlIHBhZ2UgdG8gZ2V0IHRoZSB1cGRhdGVkIGNoYW5nZXMuPC9wPicKICAgICAgICAgICArJzxwPklmIHlvdSBoYXZlIGp1c3QgcmVsb2FkZWQgdGhlIHBhZ2UsIHRoZW4gYW4gb2xkIHZlcnNpb24gb2YgdGhlIHN0YW5kYXJkIHNpdGUgc2NyaXB0IGlzIGNhY2hlZCBzb21ld2hlcmUuJwogICAgICAgICAgICsnSW4gdGhpcyBjYXNlLCB0cnkgY2xlYXJpbmcgeW91ciBjYWNoZSwgb3Igd2FpdGluZyAxNS0zMCBtaW51dGVzIGZvciB0aGUgc3RhbGUgZGF0YSB0byBleHBpcmUuPC9wPicsCiAgICAgIGJ1dHRvbnM6IHsKICAgICAgICAnUkVMT0FEJzogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGFuZHJvaWQgIT09ICd1bmRlZmluZWQnICYmIGFuZHJvaWQgJiYgYW5kcm9pZC5yZWxvYWRJSVRDKSB7CiAgICAgICAgICAgIGFuZHJvaWQucmVsb2FkSUlUQygpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgY2xvc2U6IGZ1bmN0aW9uKGV2ZW50LCB1aSkgewogICAgICAgIGRlbGV0ZSB3aW5kb3cuYmxvY2tPdXRPZkRhdGVSZXF1ZXN0czsKICAgICAgfQoKICAgIH0pOwoKCiAgfQoKfQoKCjsKCndpbmRvdy5pc1NtYXJ0cGhvbmUgPSBmdW5jdGlvbigpIHsKICAvLyB0aGlzIGNoZWNrIGlzIGFsc28gdXNlZCBpbiBtYWluLmpzLiBOb3RlIGl0IHNob3VsZCBub3QgZGV0ZWN0CiAgLy8gdGFibGV0cyBiZWNhdXNlIHRoZWlyIGRpc3BsYXkgaXMgbGFyZ2UgZW5vdWdoIHRvIHVzZSB0aGUgZGVza3RvcAogIC8vIHZlcnNpb24uCgogIC8vIFRoZSBzdG9jayBpbnRlbCBzaXRlIGFsbG93cyBmb3JjaW5nIG1vYmlsZS9mdWxsIHNpdGVzIHdpdGggYSB2cD1tIG9yIHZwPWYKICAvLyBwYXJhbWV0ZXIgLSBsZXQncyBzdXBwb3J0IHRoZSBzYW1lLiAoc3RvY2sgb25seSBhbGxvd3MgdGhpcyBmb3Igc29tZQogIC8vIGJyb3dzZXJzIC0gZS5nLiBhbmRyb2lkIHBob25lL3RhYmxldC4gbGV0J3MgYWxsb3cgaXQgZm9yIGFsbCwgYnV0CiAgLy8gbm8gcHJvbWlzZXMgaXQnbGwgd29yayByaWdodCkKICB2YXIgdmlld1BhcmFtID0gZ2V0VVJMUGFyYW0oJ3ZwJyk7CiAgaWYgKHZpZXdQYXJhbSA9PSAnbScpIHJldHVybiB0cnVlOwogIGlmICh2aWV3UGFyYW0gPT0gJ2YnKSByZXR1cm4gZmFsc2U7CgogIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9BbmRyb2lkLipNb2JpbGUvKTsKfQoKd2luZG93LnNtYXJ0cGhvbmUgPSBmdW5jdGlvbigpIHt9OwoKd2luZG93LnJ1bk9uU21hcnRwaG9uZXNCZWZvcmVCb290ID0gZnVuY3Rpb24oKSB7CiAgaWYoIWlzU21hcnRwaG9uZSgpKSByZXR1cm47CiAgY29uc29sZS53YXJuKCdydW5uaW5nIHNtYXJ0cGhvbmUgcHJlIGJvb3Qgc3R1ZmYnKTsKCiAgLy8gYWRkIHNtYXJ0cGhvbmUgc3R5bGVzaGVldAogIGhlYWRIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5pbm5lckhUTUw7CiAgaGVhZEhUTUwgKz0gJzxzdHlsZT5ib2R5IHtcbiAgY29sb3I6ICNmZmY7XG59XG5cbiN1cGRhdGVzdGF0dXMge1xuICBiYWNrZ3JvdW5kOiAjMjYyYzMyO1xuICB3aWR0aDogMTAwJTtcbiAgY29sb3I6ICNkNGQ1ZDY7XG4gIGJvcmRlcjogMDtcbiAgcGFkZGluZzogMDtcbn1cblxuI3VwZGF0ZXN0YXR1cyAubWFwIHtcbiAgbWFyZ2luLWxlZnQ6IDRweDtcbn1cblxuI2lubmVyc3RhdHVzIHtcbiAgcGFkZGluZzogNHB4O1xuICBmbG9hdDogcmlnaHQ7XG4gIHdpZHRoOiA1MCU7XG4gIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO1xuICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbn1cblxuI2xvYWRsZXZlbCB7XG4gIGJvcmRlci13aWR0aDogMDtcbiAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7XG4gIGNvbG9yOiAjRkZGO1xufVxuXG4jbW9iaWxlaW5mbyB7XG4gIGZsb2F0OiBsZWZ0O1xuICB3aWR0aDogNTAlO1xuICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpcztcbiAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgcG9zaXRpb246cmVsYXRpdmU7XG4gIHBhZGRpbmc6IDRweCAwO1xuICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbn1cblxuI21vYmlsZWluZm8gLnBvcnRhbGxldmVsIHtcbiAgcGFkZGluZzogMCAwLjI1ZW07XG4gIGNvbG9yOiAjRkZGO1xufVxuXG4jbW9iaWxlaW5mbyAucmVzb25hdG9yIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB3aWR0aDogMTIlOyAvKiBhIGxpdHRsZSBsZXNzIHRoYXQgMS84IHRvIGhhdmUgYSBzbWFsbCBkaXN0YW5jZSAqL1xuICBoZWlnaHQ6IDEwMCU7XG4gIHRvcDogMDtcbiAgYm9yZGVyLXRvcDogM3B4IHNvbGlkIHJlZDtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7XG59XG5cbiNtb2JpbGVpbmZvIC5yZXNvbmF0b3Iubm9ydGg6YmVmb3JlIHtcbiAgY29udGVudDogIiI7XG4gIGJhY2tncm91bmQtY29sb3I6IHJlZDtcbiAgYm9yZGVyLXJhZGl1czogMTAwJTtcbiAgZGlzcGxheTogYmxvY2s7XG4gIGhlaWdodDogNnB4O1xuICB3aWR0aDogNnB4O1xuICBsZWZ0OiA1MCU7XG4gIHRvcDogLTNweDsgXG4gIG1hcmdpbi1sZWZ0OiAtM3B4O1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHotaW5kZXg6IC0xO1xufVxuXG4jbW9iaWxlaW5mbyAuZmlsbGxldmVsIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBib3R0b206IDA7XG4gIGhlaWdodDogM3B4O1xufVxuXG4jbW9iaWxlaW5mbyAuZW5sIC5maWxsbGV2ZWwge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDNmZTAzICFpbXBvcnRhbnQ7XG59XG5cbiNtb2JpbGVpbmZvIC5yZXMgLmZpbGxsZXZlbCB7XG4gIGJhY2tncm91bmQtY29sb3I6ICMwMGM1ZmYgIWltcG9ydGFudDtcbn1cblxuI25hbWUgI3NpZ25vdXQgeyAvKiBubyBob3ZlciwgYWx3YXlzIHNob3cgc2lnbm91dCBidXR0b24gKi9cbiAgZGlzcGxheTogYmxvY2s7XG59XG5cbiNzaWRlYmFyLCAjY2hhdGNvbnRyb2xzLCAjY2hhdCwgI2NoYXRpbnB1dCB7XG4gIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50ICFpbXBvcnRhbnQ7XG59XG5cbi5sZWFmbGV0LXRvcCAubGVhZmxldC1jb250cm9sIHtcbiAgbWFyZ2luLXRvcDogNXB4ICFpbXBvcnRhbnQ7XG4gIG1hcmdpbi1sZWZ0OiA1cHggIWltcG9ydGFudDtcbn1cblxuI3NlYXJjaHdyYXBwZXIge1xuICBmb250LXNpemU6IDEuMmVtO1xufVxuI3NlYXJjaHdyYXBwZXIgLnVpLWFjY29yZGlvbi1oZWFkZXIge1xuICBwYWRkaW5nOiAwLjNlbSAwO1xufVxuI3NlYXJjaHdyYXBwZXIgbGkge1xuICBsaW5lLWhlaWdodDogMS4zZW07XG59XG5cbiNjaGF0Y29udHJvbHMge1xuICBoZWlnaHQ6IDM4cHg7XG4gIHdpZHRoOiAxMDAlO1xuICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7XG59XG5cbi8qIGhpZGUgc2hyaW5rIGJ1dHRvbiAqL1xuI2NoYXRjb250cm9scyBhOmZpcnN0LWNoaWxkIHtcbiAgZGlzcGxheTogbm9uZTtcbn1cblxuI2NoYXRjb250cm9scyBhIHtcbiAgd2lkdGg6IDUwcHg7XG4gIGhlaWdodDozNnB4O1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO1xuICBsaW5lLWhlaWdodDogMzZweDtcbiAgdGV4dC1kZWNvcmF0aW9uOiBub25lO1xuICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbn1cblxuI2NoYXQge1xuICBsZWZ0OjA7XG4gIHJpZ2h0OjA7XG4gIHRvcDogMXB4ICFpbXBvcnRhbnQ7XG4gIGJvdHRvbTozMHB4O1xuICB3aWR0aDogYXV0bztcbn1cblxuI2NoYXRpbnB1dCB7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDMwcHg7XG59XG5cbiNjaGF0IHRkOm50aC1jaGlsZCgyKSwgI2NoYXRpbnB1dCB0ZDpudGgtY2hpbGQoMikge1xuICB3aWR0aDogNzdweDtcbn1cblxuI2NoYXRjb250cm9scyBhLmFjdGl2ZSB7XG4gIGJvcmRlci1jb2xvcjogI0ZGQ0UwMDtcbiAgYm9yZGVyLWJvdHRvbS13aWR0aDowcHg7XG4gIGZvbnQtd2VpZ2h0OmJvbGRcbn1cblxuI2NoYXRjb250cm9scyBhLmFjdGl2ZSArIGEge1xuICBib3JkZXItbGVmdC1jb2xvcjogI0ZGQ0UwMFxufVxuXG4jc2lkZWJhcnRvZ2dsZSB7XG4gIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDtcbn1cblxuI3Njcm9sbHdyYXBwZXIge1xuICBib3R0b206IDA7XG4gIG1heC1oZWlnaHQ6IG5vbmUgIWltcG9ydGFudDtcbiAgd2lkdGg6IDEwMCUgIWltcG9ydGFudDtcbiAgcmlnaHQ6IDA7XG4gIGxlZnQ6MDtcbn1cblxuI3NpZGViYXIge1xuICB3aWR0aDogMTAwJSAhaW1wb3J0YW50O1xuICBtaW4taGVpZ2h0OiAxMDAlO1xuICBib3JkZXI6MDtcbn1cblxuI3NpZGViYXIgPiAqIHtcbiAgd2lkdGg6IDEwMCU7XG59XG5cbiNwbGF5ZXJzdGF0IHtcbiAgbWFyZ2luLXRvcDogNXB4O1xufVxuXG4jcG9ydGFsZGV0YWlscyB7XG4gIG1pbi1oZWlnaHQ6IDA7XG59XG5cbi5mdWxsaW1nIHtcbiAgd2lkdGg6IDEwMCU7XG59XG5cbi8qXG4gKiBmb3Igc29tZSByZWFzb24gbGVhZmxldCBwb3B1cHMgb24gbW9iaWxlIGFyZSBjb2xvcmVkIHdoaXRlIG9uIHdoaXRlXG4gKiBzbyBmb3JjZSB0aGUgcG9wdXAgbXNnIGNvbG9yIHRvIGJsYWNrXG4gKi9cbi5sZWFmbGV0LXBvcHVwLWNvbnRlbnR7XG4gICAgY29sb3I6YmxhY2s7XG59XG5cblxuLyogYWRkIGV4dHJhIHBhZGRpbmcsIGFuZCBhIGJ1dHRvbiBlZmZlY3QsIHRvIHNpZGViYXIgbGluayBhcmVhcyAqL1xuLmxpbmtkZXRhaWxzIGFzaWRlICB7XG4gIHBhZGRpbmc6IDVweDtcbiAgbWFyZ2luLXRvcDogM3B4O1xuICBtYXJnaW4tYm90dG9tOiAzcHg7XG4gIGJvcmRlcjogMnB4IG91dHNldCAjMjBBOEIxO1xufVxuXG4jdG9vbGJveCA+IGEge1xuICBwYWRkaW5nOiA1cHg7XG4gIG1hcmdpbi10b3A6IDNweDtcbiAgbWFyZ2luLWJvdHRvbTogM3B4O1xuICBib3JkZXI6IDJweCBvdXRzZXQgIzIwQThCMTtcbn1cblxuI3BvcnRhbGRldGFpbHMgLmNsb3NlIHtcbiAgcGFkZGluZzogNHB4O1xuICBib3JkZXI6IDFweCBvdXRzZXQgIzIwQThCMTtcbiAgbWFyZ2luLXRvcDogMnB4O1xufVxuPC9zdHlsZT4nOwogIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF0uaW5uZXJIVE1MID0gaGVhZEhUTUw7CgogIC8vIGRvbuKAmXQgbmVlZCBtYW55IG9mIHRob3NlCiAgd2luZG93LnNldHVwU3R5bGVzID0gZnVuY3Rpb24oKSB7CiAgICAkKCdoZWFkJykuYXBwZW5kKCc8c3R5bGU+JyArCiAgICAgIFsgJyNsYXJnZXByZXZpZXcuZW5sIGltZyB7IGJvcmRlcjoycHggc29saWQgJytDT0xPUlNbVEVBTV9FTkxdKyc7IH0gJywKICAgICAgICAnI2xhcmdlcHJldmlldy5yZXMgaW1nIHsgYm9yZGVyOjJweCBzb2xpZCAnK0NPTE9SU1tURUFNX1JFU10rJzsgfSAnLAogICAgICAgICcjbGFyZ2VwcmV2aWV3Lm5vbmUgaW1nIHsgYm9yZGVyOjJweCBzb2xpZCAnK0NPTE9SU1tURUFNX05PTkVdKyc7IH0gJ10uam9pbigiXG4iKQogICAgICArICc8L3N0eWxlPicpOwogIH0KCiAgd2luZG93LnNtYXJ0cGhvbmUubWFwQnV0dG9uID0gJCgnPGE+bWFwPC9hPicpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgJCgnI21hcCcpLmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7CiAgICAkKCcjdXBkYXRlc3RhdHVzJykuc2hvdygpOwogICAgJCgnI2NoYXRjb250cm9scyBhIC5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7CiAgICAkKCIjY2hhdGNvbnRyb2xzIGE6Y29udGFpbnMoJ21hcCcpIikuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogIH0pOwoKICB3aW5kb3cuc21hcnRwaG9uZS5zaWRlQnV0dG9uID0gJCgnPGE+aW5mbzwvYT4nKS5jbGljayhmdW5jdGlvbigpIHsKICAgICQoJyNzY3JvbGx3cmFwcGVyJykuc2hvdygpOwogICAgJCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICQoIiNjaGF0Y29udHJvbHMgYTpjb250YWlucygnaW5mbycpIikuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogIH0pOwoKICAkKCcjY2hhdGNvbnRyb2xzJykuYXBwZW5kKHNtYXJ0cGhvbmUubWFwQnV0dG9uKS5hcHBlbmQoc21hcnRwaG9uZS5zaWRlQnV0dG9uKTsKCiAgd2luZG93LmFkZEhvb2soJ3BvcnRhbERldGFpbHNVcGRhdGVkJywgZnVuY3Rpb24oZGF0YSkgewogICAgdmFyIHggPSAkKCcuaW1ncHJldmlldyBpbWcnKS5yZW1vdmVDbGFzcygnaGlkZScpOwoKICAgIGlmKCF4Lmxlbmd0aCkgewogICAgICAkKCcuZnVsbGltZycpLnJlbW92ZSgpOwogICAgICByZXR1cm47CiAgICB9CgogICAgaWYoJCgnLmZ1bGxpbWcnKS5sZW5ndGgpIHsKICAgICAgJCgnLmZ1bGxpbWcnKS5yZXBsYWNlV2l0aCh4LmFkZENsYXNzKCdmdWxsaW1nJykpOwogICAgfSBlbHNlIHsKICAgICAgeC5hZGRDbGFzcygnZnVsbGltZycpLmFwcGVuZFRvKCcjc2lkZWJhcicpOwogICAgfQogIH0pOwp9Cgp3aW5kb3cuc21hcnRwaG9uZUluZm8gPSBmdW5jdGlvbihkYXRhKSB7CiAgdmFyIGd1aWQgPSBkYXRhLnNlbGVjdGVkUG9ydGFsR3VpZDsKICBpZighd2luZG93LnBvcnRhbHNbZ3VpZF0pIHJldHVybjsKCiAgdmFyIGRhdGEgPSB3aW5kb3cucG9ydGFsc1tzZWxlY3RlZFBvcnRhbF0ub3B0aW9ucy5kYXRhOwogIHZhciBkZXRhaWxzID0gd2luZG93LnBvcnRhbERldGFpbC5nZXQoZ3VpZCk7CgogIHZhciBsdmwgPSBkYXRhLmxldmVsOwogIGlmKGRhdGEudGVhbSA9PT0gIk5FVVRSQUwiKQogICAgdmFyIHQgPSAnPHNwYW4gY2xhc3M9InBvcnRhbGxldmVsIj5MMDwvc3Bhbj4nOwogIGVsc2UKICAgIHZhciB0ID0gJzxzcGFuIGNsYXNzPSJwb3J0YWxsZXZlbCIgc3R5bGU9ImJhY2tncm91bmQ6ICcrQ09MT1JTX0xWTFtsdmxdKyc7Ij5MJyArIGx2bCArICc8L3NwYW4+JzsKCiAgdmFyIHBlcmNlbnRhZ2UgPSBkYXRhLmhlYWx0aDsKICBpZihkZXRhaWxzKSB7CiAgICB2YXIgdG90YWxFbmVyZ3kgPSBnZXRUb3RhbFBvcnRhbEVuZXJneShkZXRhaWxzKTsKICAgIGlmKGdldFRvdGFsUG9ydGFsRW5lcmd5KGRldGFpbHMpID4gMCkgewogICAgICBwZXJjZW50YWdlID0gTWF0aC5mbG9vcihnZXRDdXJyZW50UG9ydGFsRW5lcmd5KGRldGFpbHMpIC8gdG90YWxFbmVyZ3kgKiAxMDApOwogICAgfQogIH0KICB0ICs9ICcgJyArIHBlcmNlbnRhZ2UgKyAnJSAnOwogIHQgKz0gZGF0YS50aXRsZTsKCiAgaWYoZGV0YWlscykgewogICAgdmFyIGwsdixtYXgscGVyYzsKICAgIHZhciBlYXN0QW50aWNsb2Nrd2lzZVRvTm9ydGhDbG9ja3dpc2UgPSBbMiwxLDAsNyw2LDUsNCwzXTsKCiAgICBmb3IodmFyIGluZD0wO2luZDw4O2luZCsrKQogICAgewogICAgICBpZiAoZGV0YWlscy5yZXNvbmF0b3JzLmxlbmd0aCA9PSA4KSB7CiAgICAgICAgdmFyIHNsb3QgPSBlYXN0QW50aWNsb2Nrd2lzZVRvTm9ydGhDbG9ja3dpc2VbaW5kXTsKICAgICAgICB2YXIgcmVzbyA9IGRldGFpbHMucmVzb25hdG9yc1tzbG90XTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgc2xvdCA9IG51bGw7CiAgICAgICAgdmFyIHJlc28gPSBpbmQgPCBkZXRhaWxzLnJlc29uYXRvcnMubGVuZ3RoID8gZGV0YWlscy5yZXNvbmF0b3JzW2luZF0gOiBudWxsOwogICAgICB9CgogICAgICB2YXIgY2xhc3NOYW1lID0gVEVBTV9UT19DU1NbZ2V0VGVhbShkZXRhaWxzKV07CiAgICAgIGlmKHNsb3QgIT09IG51bGwgJiYgT0NUQU5UU1tzbG90XSA9PT0gJ04nKQogICAgICAgIGNsYXNzTmFtZSArPSAnIG5vcnRoJwogICAgICBpZihyZXNvKSB7CiAgICAgICAgbCA9IHBhcnNlSW50KHJlc28ubGV2ZWwpOwogICAgICAgIHYgPSBwYXJzZUludChyZXNvLmVuZXJneSk7CiAgICAgICAgbWF4ID0gUkVTT19OUkdbbF07CiAgICAgICAgcGVyYyA9IHYvbWF4KjEwMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBsID0gMDsKICAgICAgICB2ID0gMDsKICAgICAgICBtYXggPSAwOwogICAgICAgIHBlcmMgPSAwOwogICAgICB9CgogICAgICB0ICs9ICc8ZGl2IGNsYXNzPSJyZXNvbmF0b3IgJytjbGFzc05hbWUrJyIgc3R5bGU9ImJvcmRlci10b3AtY29sb3I6ICcrQ09MT1JTX0xWTFtsXSsnO2xlZnQ6ICcrKDEwMCppbmQvOC4wKSsnJTsiPic7CiAgICAgIHQgKz0gJzxkaXYgY2xhc3M9ImZpbGxsZXZlbCIgc3R5bGU9IndpZHRoOicrcGVyYysnJTsiPjwvZGl2Pic7CiAgICAgIHQgKz0gJzwvZGl2PicKICAgIH0KICB9CgogICQoJyNtb2JpbGVpbmZvJykuaHRtbCh0KTsKfQoKd2luZG93LnJ1bk9uU21hcnRwaG9uZXNBZnRlckJvb3QgPSBmdW5jdGlvbigpIHsKICBpZighaXNTbWFydHBob25lKCkpIHJldHVybjsKICBjb25zb2xlLndhcm4oJ3J1bm5pbmcgc21hcnRwaG9uZSBwb3N0IGJvb3Qgc3R1ZmYnKTsKCiAgd2luZG93LnNob3coJ21hcCcpOwoKICAvLyBhZGQgYSBkaXYvaG9vayBmb3IgdXBkYXRpbmcgbW9iaWxlIGluZm8KICAkKCcjdXBkYXRlc3RhdHVzJykucHJlcGVuZCgnPGRpdiBpZD0ibW9iaWxlaW5mbyIgb25jbGljaz0ic2hvdyhcJ2luZm9cJykiPjwvZGl2PicpOwogIHdpbmRvdy5hZGRIb29rKCdwb3J0YWxTZWxlY3RlZCcsIHdpbmRvdy5zbWFydHBob25lSW5mbyk7CiAgLy8gaW5pdCBtc2cgb2Ygc3RhdHVzIGJhci4gaGludCBmb3IgdGhlIHVzZXIgdGhhdCBhIHRhcCBsZWFkcyB0byB0aGUgaW5mbyBzY3JlZW4KICAkKCcjbW9iaWxlaW5mbycpLmh0bWwoJzxkaXYgc3R5bGU9InRleHQtYWxpZ246IGNlbnRlciI+PGI+dGFwIGhlcmUgZm9yIGluZm8gc2NyZWVuPC9iPjwvZGl2PicpOwoKICAvLyBkaXNhYmxlIGltZyBmdWxsIHZpZXcKICAkKCcjcG9ydGFsZGV0YWlscycpLm9mZignY2xpY2snLCAnKionKTsKCiAgLy8gbWFrZSBidXR0b25zIGluIGFjdGlvbiBiYXIgZmxleGlibGUKICB2YXIgbCA9ICQoJyNjaGF0Y29udHJvbHMgYTp2aXNpYmxlJyk7CiAgbC5jc3MoJ3dpZHRoJywgMTAwL2wubGVuZ3RoICsgJyUnKTsKCiAgLy8gbm90aWZ5IGFuZHJvaWQgdGhhdCBhIHNlbGVjdCBzcGlubmVyIGlzIGVuYWJsZWQuCiAgLy8gdGhpcyBkaXNhYmxlcyBqYXZhc2NyaXB0IGluamVjdGlvbiBvbiBhbmRyb2lkIHNpZGUuCiAgLy8gaWYgYW5kcm9pZCBpcyBub3Qgbm90aWZpZWQsIHRoZSBzcGlubmVyIGNsb3NlcyBvbiB0aGUgbmV4dCBKUyBjYWxsCiAgaWYgKHR5cGVvZiBhbmRyb2lkICE9PSAndW5kZWZpbmVkJyAmJiBhbmRyb2lkICYmIGFuZHJvaWQuc3Bpbm5lckVuYWJsZWQpIHsKICAgICQoImJvZHkiKS5vbigiY2xpY2siLCAic2VsZWN0IiwgZnVuY3Rpb24oKSB7CiAgICAgIGFuZHJvaWQuc3Bpbm5lckVuYWJsZWQodHJ1ZSk7CiAgICB9KTsKICB9CgogIC8vIGFkZCBldmVudCB0byBwb3J0YWxzIHRoYXQgYWxsb3dzIGxvbmcgcHJlc3MgdG8gc3dpdGNoIHRvIHNpZGViYXIKICB3aW5kb3cuYWRkSG9vaygncG9ydGFsQWRkZWQnLCBmdW5jdGlvbihkYXRhKSB7CiAgICBkYXRhLnBvcnRhbC5vbignYWRkJywgZnVuY3Rpb24oKSB7CiAgICAgIGlmKCF0aGlzLl9jb250YWluZXIgfHwgdGhpcy5vcHRpb25zLmFkZGVkVGFwSG9sZEhhbmRsZXIpIHJldHVybjsKICAgICAgdGhpcy5vcHRpb25zLmFkZGVkVGFwSG9sZEhhbmRsZXIgPSB0cnVlOwogICAgICB2YXIgZ3VpZCA9IHRoaXMub3B0aW9ucy5ndWlkOwoKICAgICAgLy8gdGhpcyBpcyBhIGhhY2ssIGFjY2Vzc2luZyBMZWFmbGV04oCZcyBwcml2YXRlIF9jb250YWluZXIgaXMgZXZpbAogICAgICAkKHRoaXMuX2NvbnRhaW5lcikub24oJ3RhcGhvbGQnLCBmdW5jdGlvbigpIHsKICAgICAgICB3aW5kb3cucmVuZGVyUG9ydGFsRGV0YWlscyhndWlkKTsKICAgICAgICB3aW5kb3cuc2hvdygnaW5mbycpOwogICAgICB9KTsKICAgIH0pOwogIH0pOwoKICBpZih0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCAmJiBhbmRyb2lkLnNldFBlcm1hbGluaykgewogICAgd2luZG93Lm1hcC5vbignbW92ZWVuZCcsIHdpbmRvdy5zZXRBbmRyb2lkUGVybWFsaW5rKTsKICAgIGFkZEhvb2soJ3BvcnRhbFNlbGVjdGVkJywgd2luZG93LnNldEFuZHJvaWRQZXJtYWxpbmspOwogIH0KCgogIC8vIGZvciBzb21lIHJlYXNvbiwgbGVhZmxldCBtaXNzZXMgdGhlIFdlYlZpZXcgc2l6ZSBiZWluZyBzZXQgYXQgc3RhcnR1cCBvbiBJSVRDIE1vYmlsZQogIC8vIGNyZWF0ZSBhIHNob3J0IHRpbWVyIHRoYXQgY2hlY2tzIGZvciB0aGlzIGlzc3VlCiAgc2V0VGltZW91dCAoZnVuY3Rpb24oKSB7IG1hcC5pbnZhbGlkYXRlU2l6ZSgpOyB9LCAwLjIqMTAwMCk7Cgp9CgoKCndpbmRvdy5zZXRBbmRyb2lkUGVybWFsaW5rID0gZnVuY3Rpb24oKSB7CiAgdmFyIGMgPSB3aW5kb3cubWFwLmdldENlbnRlcigpOwogIHZhciBsYXQgPSBNYXRoLnJvdW5kKGMubGF0KjFFNikvMUU2OwogIHZhciBsbmcgPSBNYXRoLnJvdW5kKGMubG5nKjFFNikvMUU2OwoKICB2YXIgaHJlZiA9ICcvaW50ZWw/bGw9JytsYXQrJywnK2xuZysnJno9JyArIG1hcC5nZXRab29tKCk7CgogIGlmKHdpbmRvdy5zZWxlY3RlZFBvcnRhbCAmJiB3aW5kb3cucG9ydGFsc1t3aW5kb3cuc2VsZWN0ZWRQb3J0YWxdKSB7CiAgICB2YXIgcCA9IHdpbmRvdy5wb3J0YWxzW3dpbmRvdy5zZWxlY3RlZFBvcnRhbF0uZ2V0TGF0TG5nKCk7CiAgICBsYXQgPSBNYXRoLnJvdW5kKHAubGF0KjFFNikvMUU2OwogICAgbG5nID0gTWF0aC5yb3VuZChwLmxuZyoxRTYpLzFFNjsKICAgIGhyZWYgKz0gJyZwbGw9JytsYXQrJywnK2xuZzsKICB9CgogIGhyZWYgPSAkKCc8YT4nKS5wcm9wKCdocmVmJywgIGhyZWYpLnByb3AoJ2hyZWYnKTsgLy8gdG8gZ2V0IGFic29sdXRlIFVSSQogIGFuZHJvaWQuc2V0UGVybWFsaW5rKGhyZWYpOwp9Cgp3aW5kb3cudXNlQW5kcm9pZFBhbmVzID0gZnVuY3Rpb24oKSB7CiAgLy8gaXNTbWFydHBob25lIGlzIGltcG9ydGFudCB0byBkaXNhYmxlIHBhbmVzIGluIGRlc2t0b3AgbW9kZQogIHJldHVybiAodHlwZW9mIGFuZHJvaWQgIT09ICd1bmRlZmluZWQnICYmIGFuZHJvaWQgJiYgYW5kcm9pZC5hZGRQYW5lICYmIHdpbmRvdy5pc1NtYXJ0cGhvbmUoKSk7Cn0KCmlmKHR5cGVvZiBhbmRyb2lkICE9PSAndW5kZWZpbmVkJyAmJiBhbmRyb2lkICYmIGFuZHJvaWQuZ2V0RmlsZVJlcXVlc3RVcmxQcmVmaXgpIHsKICB3aW5kb3cucmVxdWVzdEZpbGUgPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgZG8gewogICAgICB2YXIgZnVuY05hbWUgPSAib25GaWxlU2VsZWN0ZWQiICsgcGFyc2VJbnQoTWF0aC5yYW5kb20oKSoweEZGRkYpLnRvU3RyaW5nKDE2KTsKICAgIH0gd2hpbGUod2luZG93W2Z1bmNOYW1lXSAhPT0gdW5kZWZpbmVkKQoKICAgIHdpbmRvd1tmdW5jTmFtZV0gPSBmdW5jdGlvbihmaWxlbmFtZSwgY29udGVudCkgewogICAgICBjYWxsYmFjayhkZWNvZGVVUklDb21wb25lbnQoZmlsZW5hbWUpLCBhdG9iKGNvbnRlbnQpKTsKICAgIH07CiAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICBzY3JpcHQuc3JjID0gYW5kcm9pZC5nZXRGaWxlUmVxdWVzdFVybFByZWZpeCgpICsgZnVuY05hbWU7CiAgICAoZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICB9Owp9CgoKCjsKCi8vIFNUQVRVUyBCQVIgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgovLyBnaXZlcyB1c2VyIGZlZWRiYWNrIGFib3V0IHBlbmRpbmcgb3BlcmF0aW9ucy4gRHJhd3MgY3VycmVudCBzdGF0dXMKLy8gdG8gd2Vic2l0ZS4gVXBkYXRlcyBpbmZvIGluIGxheWVyIGNob29zZXIuCndpbmRvdy5yZW5kZXJVcGRhdGVTdGF0dXNUaW1lcl8gPSB1bmRlZmluZWQ7Cgp3aW5kb3cucmVuZGVyVXBkYXRlU3RhdHVzID0gZnVuY3Rpb24oKSB7CiAgdmFyIHByb2dyZXNzID0gMTsKCiAgLy8gcG9ydGFsL2xpbWsgbGV2ZWwgZGlzcGxheQoKICB2YXIgem9vbSA9IG1hcC5nZXRab29tKCk7CiAgem9vbSA9IGdldERhdGFab29tRm9yTWFwWm9vbSh6b29tKTsKICB2YXIgdGlsZVBhcmFtcyA9IGdldE1hcFpvb21UaWxlUGFyYW1ldGVycyh6b29tKTsKCiAgdmFyIHQgPSAnPHNwYW4gY2xhc3M9ImhlbHAgcG9ydGFsbGV2ZWwiIHRpdGxlPSJJbmRpY2F0ZXMgcG9ydGFsIGxldmVscy9saW5rIGxlbmd0aHMgZGlzcGxheWVkLiAgWm9vbSBpbiB0byBkaXNwbGF5IG1vcmUuIj4nOwoKICBpZiAodGlsZVBhcmFtcy5oYXNQb3J0YWxzKSB7CiAgICAvLyB6b29tIGxldmVsIGluY2x1ZGVzIHBvcnRhbHMgKGFuZCBhbHNvIGFsbCBsaW5rcy9maWVsZHMpCiAgICBpZighd2luZG93LmlzU21hcnRwaG9uZSgpKSAvLyBzcGFjZSBpcyB2YWx1YWJsZQogICAgICB0ICs9ICc8Yj5wb3J0YWxzPC9iPjogJzsKICAgIGlmKHRpbGVQYXJhbXMubGV2ZWwgPT09IDApCiAgICAgIHQgKz0gJzxzcGFuIGlkPSJsb2FkbGV2ZWwiPmFsbDwvc3Bhbj4nOwogICAgZWxzZQogICAgICB0ICs9ICc8c3BhbiBpZD0ibG9hZGxldmVsIiBzdHlsZT0iYmFja2dyb3VuZDonK0NPTE9SU19MVkxbdGlsZVBhcmFtcy5sZXZlbF0rJyI+TCcrdGlsZVBhcmFtcy5sZXZlbCsodGlsZVBhcmFtcy5sZXZlbDw4PycrJzonJykgKyAnPC9zcGFuPic7CiAgfSBlbHNlIHsKICAgIGlmKCF3aW5kb3cuaXNTbWFydHBob25lKCkpIC8vIHNwYWNlIGlzIHZhbHVhYmxlCiAgICAgIHQgKz0gJzxiPmxpbmtzPC9iPjogJzsKCiAgICBpZiAodGlsZVBhcmFtcy5taW5MaW5rTGVuZ3RoID4gMCkKICAgICAgdCArPSAnPHNwYW4gaWQ9ImxvYWRsZXZlbCI+Jmd0OycrKHRpbGVQYXJhbXMubWluTGlua0xlbmd0aD4xMDAwP3RpbGVQYXJhbXMubWluTGlua0xlbmd0aC8xMDAwKydrbSc6dGlsZVBhcmFtcy5taW5MaW5rTGVuZ3RoKydtJykrJzwvc3Bhbj4nOwogICAgZWxzZQogICAgICB0ICs9ICc8c3BhbiBpZD0ibG9hZGxldmVsIj5hbGwgbGlua3M8L3NwYW4+JzsKICB9CgogIHQgKz0nPC9zcGFuPic7CgoKICAvLyBtYXAgc3RhdHVzIGRpc3BsYXkKICB0ICs9ICcgPHNwYW4gY2xhc3M9Im1hcCI+PGI+bWFwPC9iPjogJzsKCiAgaWYgKHdpbmRvdy5tYXBEYXRhUmVxdWVzdCkgewogICAgdmFyIHN0YXR1cyA9IHdpbmRvdy5tYXBEYXRhUmVxdWVzdC5nZXRTdGF0dXMoKTsKCiAgICAvLyBzdGF0dXMuc2hvcnQgLSBzaG9ydCBkZXNjcmlwdGlvbiBvZiBzdGF0dXMKICAgIC8vIHN0YXR1cy5sb25nIC0gbG9uZ2VyIGRlc2NyaXB0aW9uLCBmb3IgdG9vbHRpcCAob3B0aW9uYWwpCiAgICAvLyBzdGF0dXMucHJvZ3Jlc3MgLSBmcmFjdGlvbmFsIHByb2dyZXNzIChmcm9tIDAgdG8gMTsgLTEgZm9yIGluZGV0ZXJtaW5hdGUpIG9mIGN1cnJlbnQgc3RhdGUgKG9wdGlvbmFsKQogICAgaWYgKHN0YXR1cy5sb25nKQogICAgICB0ICs9ICc8c3BhbiBjbGFzcz0iaGVscCIgdGl0bGU9Iicrc3RhdHVzLmxvbmcrJyI+JytzdGF0dXMuc2hvcnQrJzwvc3Bhbj4nOwogICAgZWxzZQogICAgICB0ICs9ICc8c3Bhbj4nK3N0YXR1cy5zaG9ydCsnPC9zcGFuPic7CgogICAgaWYgKHN0YXR1cy5wcm9ncmVzcyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmKHN0YXR1cy5wcm9ncmVzcyAhPT0gLTEpCiAgICAgICAgdCArPSAnICcrTWF0aC5mbG9vcihzdGF0dXMucHJvZ3Jlc3MqMTAwKSsnJSc7CiAgICAgIHByb2dyZXNzID0gc3RhdHVzLnByb2dyZXNzOwogICAgfQogIH0gZWxzZSB7CiAgICAvLyBubyBtYXBEYXRhUmVxdWVzdCBvYmplY3QgLSBubyBzdGF0dXMga25vd24KICAgIHQgKz0gJy4uLnVua25vd24uLi4nOwogIH0KCiAgdCArPSAnPC9zcGFuPic7CgogIC8vcmVxdWVzdCBzdGF0dXMKICBpZiAod2luZG93LmFjdGl2ZVJlcXVlc3RzLmxlbmd0aCA+IDApCiAgICB0ICs9ICcgJyArIHdpbmRvdy5hY3RpdmVSZXF1ZXN0cy5sZW5ndGggKyAnIHJlcXVlc3RzJzsKICBpZiAod2luZG93LmZhaWxlZFJlcXVlc3RDb3VudCA+IDApCiAgICB0ICs9ICcgPHNwYW4gc3R5bGU9ImNvbG9yOiNmNjYiPicgKyB3aW5kb3cuZmFpbGVkUmVxdWVzdENvdW50ICsgJyBmYWlsZWQ8L3NwYW4+JwoKCiAgLy9pdCdzIHBvc3NpYmxlIHRoYXQgdXBkYXRpbmcgdGhlIHN0YXR1cyBiYXIgZXhjZXNzaXZlbHkgY2F1c2VzIHNvbWUgcGVyZm9ybWFuY2UgaXNzdWVzLiBzbyByYXRoZXIgdGhhbiBkb2luZyBpdAogIC8vaW1tZWRpYXRlbHksIGRlbGF5IGl0IHRvIHRoZSBuZXh0IGphdmFzY3JpcHQgZXZlbnQgbG9vcCwgY2FuY2VsbGluZyBhbnkgcGVuZGluZyB1cGRhdGUKICAvLyB3aWxsIGFsc28gY2F1c2UgYW55IGJyb3dzZXItcmVsYXRlZCByZW5kZXJpbmcgdG8gb2NjdXIgZmlyc3QsIGJlZm9yZSB0aGUgc3RhdHVzIGFjdHVhbGx5IHVwZGF0ZXMKCiAgaWYgKHdpbmRvdy5yZW5kZXJVcGRhdGVTdGF0dXNUaW1lcl8pIGNsZWFyVGltZW91dCh3aW5kb3cucmVuZGVyVXBkYXRlU3RhdHVzVGltZXJfKTsKCiAgd2luZG93LnJlbmRlclVwZGF0ZVN0YXR1c1RpbWVyXyA9IHNldFRpbWVvdXQgKCBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5yZW5kZXJVcGRhdGVTdGF0dXNUaW1lcl8gPSB1bmRlZmluZWQ7CgogICAgJCgnI2lubmVyc3RhdHVzJykuaHRtbCh0KTsKICAgIC8vJCgnI3VwZGF0ZXN0YXR1cycpLmNsaWNrKGZ1bmN0aW9uKCkgeyBzdGFydFJlZnJlc2hUaW1lb3V0KDEwKTsgfSk7CiAgICAvLy4gPGEgc3R5bGU9ImN1cnNvcjogcG9pbnRlciIgb25jbGljaz0ic3RhcnRSZWZyZXNoVGltZW91dCgxMCkiIHRpdGxlPSJSZWZyZXNoIj7in7M8L2E+JzsKCiAgICBpZihwcm9ncmVzcyA9PSAxICYmIHdpbmRvdy5hY3RpdmVSZXF1ZXN0cy5sZW5ndGggPiAwKSB7CiAgICAgIC8vIHdlIGRvbid0IGtub3cgdGhlIGV4YWN0IHByb2dyZXNzLCBidXQgd2UgaGF2ZSByZXF1ZXN0cyAoZS5nLiBjaGF0KSBydW5uaW5nLCBzbyBzaG93IGl0IGFzIGluZGV0ZXJtaW5hdGUuCiAgICAgIHByb2dyZXNzID0gLTE7CiAgICB9CgogICAgaWYgKHR5cGVvZiBhbmRyb2lkICE9PSAndW5kZWZpbmVkJyAmJiBhbmRyb2lkICYmIGFuZHJvaWQuc2V0UHJvZ3Jlc3MpCiAgICAgIGFuZHJvaWQuc2V0UHJvZ3Jlc3MocHJvZ3Jlc3MpOwogIH0sIDApOwoKfQoKCjsKCi8vIFVUSUxTICsgTUlTQyAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKd2luZG93LmFib3V0SUlUQyA9IGZ1bmN0aW9uKCkgewogIHZhciB2ID0gKHNjcmlwdF9pbmZvLnNjcmlwdCAmJiBzY3JpcHRfaW5mby5zY3JpcHQudmVyc2lvbiB8fCBzY3JpcHRfaW5mby5kYXRlVGltZVZlcnNpb24pICsgJyBbJytzY3JpcHRfaW5mby5idWlsZE5hbWUrJ10nOwogIGlmICh0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCAmJiBhbmRyb2lkLmdldFZlcnNpb25OYW1lKSB7CiAgICB2ICs9ICdbSUlUQyBNb2JpbGUgJythbmRyb2lkLmdldFZlcnNpb25OYW1lKCkrJ10nOwogIH0KCiAgdmFyIHBsdWdpbnMgPSAnPHVsPic7CiAgZm9yICh2YXIgaSBpbiBib290UGx1Z2lucykgewogICAgdmFyIGluZm8gPSBib290UGx1Z2luc1tpXS5pbmZvOwogICAgaWYgKGluZm8pIHsKICAgICAgdmFyIHBuYW1lID0gaW5mby5zY3JpcHQgJiYgaW5mby5zY3JpcHQubmFtZSB8fCBpbmZvLnBsdWdpbklkOwogICAgICBpZiAocG5hbWUuc3Vic3RyKDAsMTMpID09ICdJSVRDIHBsdWdpbjogJyB8fCBwbmFtZS5zdWJzdHIoMCwxMykgPT0gJ0lJVEMgUGx1Z2luOiAnKSB7CiAgICAgICAgcG5hbWUgPSBwbmFtZS5zdWJzdHIoMTMpOwogICAgICB9CiAgICAgIHZhciBwdmVycyA9IGluZm8uc2NyaXB0ICYmIGluZm8uc2NyaXB0LnZlcnNpb24gfHwgaW5mby5kYXRlVGltZVZlcnNpb247CgogICAgICB2YXIgcHRleHQgPSBwbmFtZSArICcgLSAnICsgcHZlcnM7CiAgICAgIGlmIChpbmZvLmJ1aWxkTmFtZSAhPSBzY3JpcHRfaW5mby5idWlsZE5hbWUpIHsKICAgICAgICBwdGV4dCArPSAnIFsnKyhpbmZvLmJ1aWxkTmFtZXx8JzxpPm5vbi1zdGFuZGFyZCBwbHVnaW48L2k+JykrJ10nOwogICAgICB9CgogICAgICBwbHVnaW5zICs9ICc8bGk+JytwdGV4dCsnPC9saT4nOwogICAgfSBlbHNlIHsKICAgICAgLy8gbm8gJ2luZm8nIHByb3BlcnR5IG9mIHRoZSBwbHVnaW4gc2V0dXAgZnVuY3Rpb24gLSBvbGQgcGx1Z2luIHdyYXBwZXIgY29kZQogICAgICAvLyBjb3VsZCBhdHRlbXB0IHRvIGZpbmQgdGhlICJ3aW5kb3cucGx1Z2luLk5BTUUgPSBmdW5jdGlvbigpIHt9OyIgbGluZSBpdCdzIGxpa2VseSB0byBoYXZlLi4/CiAgICAgIHBsdWdpbnMgKz0gJzxsaT4odW5rbm93biBwbHVnaW46IGluZGV4ICcraSsnKTwvbGk+JzsKICAgIH0KICB9CiAgcGx1Z2lucyArPSAnPC91bD4nOwoKICB2YXIgYXR0cmliID0gJzxwPlRoaXMgcHJvamVjdCBpcyBsaWNlbnNlZCB1bmRlciB0aGUgcGVybWlzc2l2ZSA8YSBocmVmPSJodHRwOi8vd3d3LmlzYy5vcmcvZG93bmxvYWRzL3NvZnR3YXJlLXN1cHBvcnQtcG9saWN5L2lzYy1saWNlbnNlLyI+SVNDIGxpY2Vuc2U8L2E+LiBQYXJ0cyBpbXBvcnRlZCBmcm9tIG90aGVyIHByb2plY3RzIHJlbWFpbiB1bmRlciB0aGVpciByZXNwZWN0aXZlIGxpY2Vuc2VzOjwvcD5cblxuPHVsPlxuPGxpPjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9icnlhbndvb2RzL2F1dG9saW5rLWpzIj5hdXRvbGluay1qcyBieSBCcnlhbiBXb29kczsgTUlUPC9hPjwvbGk+XG48bGk+PGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2Nocmlzby9sb2FkLmpzIj5sb2FkLmpzIGJ5IENocmlzIE9cJ0hhcmE7IE1JVDwvYT48L2xpPlxuPGxpPjxhIGhyZWY9Imh0dHA6Ly9sZWFmbGV0anMuY29tLyI+bGVhZmxldC5qczsgY3VzdG9tIGxpY2Vuc2UgKGJ1dCBhcHBlYXJzIGZyZWUpPC9hPjwvbGk+XG48bGk+PGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL0xlYWZsZXQvTGVhZmxldC5kcmF3Ij5sZWFmbGV0LmRyYXcuanMgYnkgamFjb2J0b3llOyBNSVQ8L2E+PC9saT5cbjxsaT5cbjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9zaHJhbW92L2xlYWZsZXQtcGx1Z2lucyI+bGVhZmxldF9nb29nbGUuanMgYnkgUGF2ZWwgU2hyYW1vdjsgc2FtZSBhcyBMZWFmbGV0PC9hPiAobW9kaWZpZWQsIHRob3VnaCk8L2xpPlxuPGxpPjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9qZXJvbWVldGllbm5lL2pxdWVyeS1xcmNvZGUiPmpxdWVyeS5xcmNvZGUuanMgYnkgSmVyb21lIEV0aWVubmU7IE1JVDwvYT48L2xpPlxuPGxpPjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9qYXdqL092ZXJsYXBwaW5nTWFya2VyU3BpZGVyZmllci1MZWFmbGV0Ij5vbXMubWluLmpzIGJ5IEdlb3JnZSBNYWNLZXJyb247IE1JVDwvYT48L2xpPlxuPGxpPjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9yaWNoYWRhbXMvanF1ZXJ5LXRhcGhvbGQiPnRhcGhvbGQuanMgYnkgUmljaCBBZGFtczsgdW5rbm93bjwvYT48L2xpPlxuPGxpPjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9rYXJ0ZW5hL0xlYWZsZXQuUGFuY29udHJvbCI+TC5Db250cm9sLlBhbi5qcyBieSBLYXJ0ZW5hIEFCOyBzYW1lIGFzIExlYWZsZXQ8L2E+PC9saT5cbjxsaT48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20va2FydGVuYS9MZWFmbGV0Lnpvb21zbGlkZXIiPkwuQ29udHJvbC5ab29tc2xpZGVyLmpzIGJ5IEthcnRlbmEgQUI7IHNhbWUgYXMgTGVhZmxldDwvYT48L2xpPlxuPGxpPjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9zaHJhbW92L2xlYWZsZXQtcGx1Z2lucyI+S01MLmpzIGJ5IHNocmFtb3Y7IHNhbWUgYXMgTGVhZmxldDwvYT48L2xpPlxuPGxpPjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9zaHJhbW92L2xlYWZsZXQtcGx1Z2lucyI+bGVhZmxldC5maWxlbGF5ZXIuanMgYnkgc2hyYW1vdjsgc2FtZSBhcyBMZWFmbGV0PC9hPjwvbGk+XG48bGk+PGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NocmFtb3YvbGVhZmxldC1wbHVnaW5zIj50b2dlb2pzb24uanMgYnkgc2hyYW1vdjsgc2FtZSBhcyBMZWFmbGV0PC9hPjwvbGk+XG48bGk+U3RhY2tPdmVyZmxvdy1Db3B5UGFzdGEgaXMgYXR0cmlidXRlZCBpbiB0aGUgc291cmNlOyA8YSBocmVmPSJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMy4wLyI+Q0MtV2lraTwvYT5cbjwvbGk+XG48bGk+YWxsIEluZ3Jlc3MvTmlhbnRpYyByZWxhdGVkIHN0dWZmIG9idmlvdXNseSByZW1haW5zIG5vbi1mcmVlIGFuZCBpcyBzdGlsbCBjb3B5cmlnaHRlZCBieSBOaWFudGljL0dvb2dsZTwvbGk+XG48L3VsPlxuJzsKICB2YXIgY29udHJpYiA9ICc8cD5TbyBmYXIsIHRoZXNlIHBlb3BsZSBoYXZlIGNvbnRyaWJ1dGVkOjwvcD5cblxuPHA+PGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL0JhbmFuZXdlaXplbiI+QmFuYW5ld2VpemVuPC9hPixcbjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9ibGFramFrYXUiPmJsYWtqYWthdTwvYT4sXG48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vYm9vbWJ1bGVyIj5ib29tYnVsZXI8L2E+LFxuPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2JyZXVuaWdzIj5icmV1bmlnczwvYT4sXG48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vY2F0aGVzYXVydXMiPmNhdGhlc2F1cnVzPC9hPixcbjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9jY2pvbiI+Y2Nqb248L2E+LFxuPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2Ntcm4iPmNtcm48L2E+LFxuPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2VwZiI+ZXBmPC9hPixcbjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9ma2xvZnQiPmZrbG9mdDwvYT4sXG48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vRnJhZ2dlciI+RnJhZ2dlcjwvYT4sXG48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vaGFzdGFyaW4iPmhhc3RhcmluPC9hPixcbjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9pbnRlZzNyIj5pbnRlZzNyPC9hPixcbjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9qMTZzZGl6Ij5qMTZzZGl6PC9hPixcbjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9KYXNvbk1pbGx3YXJkIj5KYXNvbk1pbGx3YXJkPC9hPixcbjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9qb25hdGtpbnMiPmpvbmF0a2luczwvYT4sXG48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vbGVDcmFkbGUiPmxlQ3JhZGxlPC9hPixcbjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9NZXJvdml1cyI+TWVyb3ZpdXM8L2E+LFxuPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL21sZWRvemUiPm1sZWRvemU8L2E+LFxuPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL09zaGlIaWRyYSI+T3NoaUhpZHJhPC9hPixcbjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9waG9lbml4c29uZzYiPnBob2VuaXhzb25nNjwvYT4sXG48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vUGlyb3playI+UGlyb3plazwvYT4sXG48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vc2FpdGhpcyI+c2FpdGhpczwvYT4sXG48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vU2Nyb29sIj5TY3Jvb2w8L2E+LFxuPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NvcmdvIj5zb3JnbzwvYT4sXG48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vdHBlbm5lciI+dHBlbm5lcjwvYT4sXG48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vdml0YTEwZ3kiPnZpdGExMGd5PC9hPixcbjxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9YZWxpbyI+WGVsaW88L2E+LFxuPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL1phdWJlck5lcmQiPlphdWJlck5lcmQ8L2E+LFxuPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3dheW5uIj53YXlubjwvYT48L3A+XG4nCgogIHZhciBhID0gJycKICArICcgIDxkaXY+PGI+QWJvdXQgSUlUQzwvYj48L2Rpdj4gJwogICsgJyAgPGRpdj5JbmdyZXNzIEludGVsIFRvdGFsIENvbnZlcnNpb248L2Rpdj4gJwogICsgJyAgPGhyPicKICArICcgIDxkaXY+JwogICsgJyAgICA8YSBocmVmPSJodHRwOi8vaWl0Yy5qb25hdGtpbnMuY29tLyIgdGFyZ2V0PSJfYmxhbmsiPklJVEMgSG9tZXBhZ2U8L2E+PGJyIC8+JwogICsgJyAgICAgT24gdGhlIHNjcmlwdOKAmXMgaG9tZXBhZ2UgeW91IGNhbjonCiAgKyAnICAgICA8dWw+JwogICsgJyAgICAgICA8bGk+RmluZCBVcGRhdGVzPC9saT4nCiAgKyAnICAgICAgIDxsaT5HZXQgUGx1Z2luczwvbGk+JwogICsgJyAgICAgICA8bGk+UmVwb3J0IEJ1Z3M8L2xpPicKICArICcgICAgICAgPGxpPkNvbnRyaWJ1dGUhPC9saT4nCiAgKyAnICAgICA8L3VsPicKICArICcgIDwvZGl2PicKICArICcgIDxkaXY+JwogICsgJyAgICBNYXBRdWVzdCBPU00gdGlsZXMgQ291cnRlc3kgb2YgPGEgaHJlZj0iaHR0cDovL3d3dy5tYXBxdWVzdC5jb20vIiB0YXJnZXQ9Il9ibGFuayI+TWFwUXVlc3Q8L2E+IDxpbWcgc3JjPSJodHRwczovL2RldmVsb3Blci5tYXBxdWVzdC5jb20vY29udGVudC9vc20vbXFfbG9nby5wbmciPicKICArICcgIDwvZGl2PicKICArICcgIDxocj4nCiAgKyAnICA8ZGl2PlZlcnNpb246ICcgKyB2ICsgJzwvZGl2PicKICArICcgIDxkaXY+UGx1Z2luczogJyArIHBsdWdpbnMgKyAnPC9kaXY+JwogICsgJyAgPGhyPicKICArICcgIDxkaXY+JyArIGF0dHJpYiArICc8L2Rpdj4nCiAgKyAnICA8aHI+JwogICsgJyAgPGRpdj4nICsgY29udHJpYiArICc8L2Rpdj4nOwoKICBkaWFsb2coewogICAgdGl0bGU6ICdJSVRDICcgKyB2LAogICAgaHRtbDogYSwKICAgIGRpYWxvZ0NsYXNzOiAndWktZGlhbG9nLWFib3V0SUlUQycKICB9KTsKfQoKCndpbmRvdy5sYXllckdyb3VwTGVuZ3RoID0gZnVuY3Rpb24obGF5ZXJHcm91cCkgewogIHZhciBsYXllcnNDb3VudCA9IDA7CiAgdmFyIGxheWVycyA9IGxheWVyR3JvdXAuX2xheWVyczsKICBpZiAobGF5ZXJzKQogICAgbGF5ZXJzQ291bnQgPSBPYmplY3Qua2V5cyhsYXllcnMpLmxlbmd0aDsKICByZXR1cm4gbGF5ZXJzQ291bnQ7Cn0KCi8vIHJldHJpZXZlcyBwYXJhbWV0ZXIgZnJvbSB0aGUgVVJMP3F1ZXJ5PXN0cmluZy4Kd2luZG93LmdldFVSTFBhcmFtID0gZnVuY3Rpb24ocGFyYW0pIHsKICB2YXIgaXRlbXMgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cigxKS5zcGxpdCgnJicpOwogIGlmIChpdGVtcyA9PSAiIikgcmV0dXJuICIiOwoKICBmb3IgKHZhciBpPTA7IGk8aXRlbXMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBpdGVtID0gaXRlbXNbaV0uc3BsaXQoJz0nKTsKCiAgICBpZiAoaXRlbVswXSA9PSBwYXJhbSkgewogICAgICB2YXIgdmFsID0gaXRlbS5sZW5ndGg9PTEgPyAnJyA6IGRlY29kZVVSSUNvbXBvbmVudCAoaXRlbVsxXS5yZXBsYWNlKC9cKy9nLCcgJykpOwogICAgICByZXR1cm4gdmFsOwogICAgfQogIH0KCiAgcmV0dXJuICcnOwp9CgovLyByZWFkIGNvb2tpZSBieSBuYW1lLgovLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS81NjM5NDU1LzE2ODQ1MzAgYnkgY3dvbHZlcwp3aW5kb3cucmVhZENvb2tpZSA9IGZ1bmN0aW9uKG5hbWUpewogIHZhciBDLCBpLCBjID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7ICcpOwogIHZhciBjb29raWVzID0ge307CiAgZm9yKGk9Yy5sZW5ndGgtMTsgaT49MDsgaS0tKXsKICAgIEMgPSBjW2ldLnNwbGl0KCc9Jyk7CiAgICBjb29raWVzW0NbMF1dID0gdW5lc2NhcGUoQ1sxXSk7CiAgfQogIHJldHVybiBjb29raWVzW25hbWVdOwp9Cgp3aW5kb3cud3JpdGVDb29raWUgPSBmdW5jdGlvbihuYW1lLCB2YWwpIHsKICB2YXIgZCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyAxMCAqIDM2NSAqIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvVVRDU3RyaW5nKCk7CiAgZG9jdW1lbnQuY29va2llID0gbmFtZSArICI9IiArIHZhbCArICc7IGV4cGlyZXM9JytkKyc7IHBhdGg9Lyc7Cn0KCndpbmRvdy5lcmFzZUNvb2tpZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICBkb2N1bWVudC5jb29raWUgPSBuYW1lICsgJz07IGV4cGlyZXM9VGh1LCAxIEphbiAxOTcwIDAwOjAwOjAwIEdNVDsgcGF0aD0vJzsKfQoKLy9jZXJ0YWluIHZhbHVlcyB3ZXJlIHN0b3JlZCBpbiBjb29raWVzLCBidXQgd2UncmUgYmV0dGVyIG9mZiB1c2luZyBsb2NhbFN0b3JhZ2UgaW5zdGVhZCAtIG1ha2UgaXQgZWFzeSB0byBjb252ZXJ0CndpbmRvdy5jb252ZXJ0Q29va2llVG9Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbihuYW1lKSB7CiAgdmFyIGNvb2tpZT1yZWFkQ29va2llKG5hbWUpOwogIGlmKGNvb2tpZSAhPT0gdW5kZWZpbmVkKSB7CiAgICBjb25zb2xlLmxvZygnY29udmVydGluZyBjb29raWUgJytuYW1lKycgdG8gbG9jYWxTdG9yYWdlJyk7CiAgICBpZihsb2NhbFN0b3JhZ2VbbmFtZV0gPT09IHVuZGVmaW5lZCkgewogICAgICBsb2NhbFN0b3JhZ2VbbmFtZV0gPSBjb29raWU7CiAgICB9CiAgICBlcmFzZUNvb2tpZShuYW1lKTsKICB9Cn0KCi8vIGFkZCB0aG91c2FuZCBzZXBhcmF0b3JzIHRvIGdpdmVuIG51bWJlci4KLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMTk5MDU5MC8xNjg0NTMwIGJ5IERvdWcgTmVpbmVyLgp3aW5kb3cuZGlnaXRzID0gZnVuY3Rpb24oZCkgewogIC8vIFUrMjAwOSAtIFRoaW4gU3BhY2UuIFJlY29tbWVuZGVkIGZvciB1c2UgYXMgYSB0aG91c2FuZHMgc2VwYXJhdG9yLi4uCiAgLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU3BhY2VfKHB1bmN0dWF0aW9uKSNUYWJsZV9vZl9zcGFjZXMKICByZXR1cm4gKGQrIiIpLnJlcGxhY2UoLyhcZCkoPz0oXGRcZFxkKSsoPyFcZCkpL2csICIkMSYjODIwMTsiKTsKfQoKCndpbmRvdy56ZXJvUGFkID0gZnVuY3Rpb24obnVtYmVyLHBhZCkgewogIG51bWJlciA9IG51bWJlci50b1N0cmluZygpOwogIHZhciB6ZXJvcyA9IHBhZCAtIG51bWJlci5sZW5ndGg7CiAgcmV0dXJuIEFycmF5KHplcm9zPjA/emVyb3MrMTowKS5qb2luKCIwIikgKyBudW1iZXI7Cn0KCgovLyBjb252ZXJ0cyBqYXZhc2NyaXB0IHRpbWVzdGFtcHMgdG8gSEg6bW06c3MgZm9ybWF0IGlmIGl0IHdhcyB0b2RheTsKLy8gb3RoZXJ3aXNlIGl0IHJldHVybnMgWVlZWS1NTS1ERAp3aW5kb3cudW5peFRpbWVUb1N0cmluZyA9IGZ1bmN0aW9uKHRpbWUsIGZ1bGwpIHsKICBpZighdGltZSkgcmV0dXJuIG51bGw7CiAgdmFyIGQgPSBuZXcgRGF0ZSh0eXBlb2YgdGltZSA9PT0gJ3N0cmluZycgPyBwYXJzZUludCh0aW1lKSA6IHRpbWUpOwogIHZhciB0aW1lID0gZC50b0xvY2FsZVRpbWVTdHJpbmcoKTsKLy8gIHZhciB0aW1lID0gemVyb1BhZChkLmdldEhvdXJzKCksMikrJzonK3plcm9QYWQoZC5nZXRNaW51dGVzKCksMikrJzonK3plcm9QYWQoZC5nZXRTZWNvbmRzKCksMik7CiAgdmFyIGRhdGUgPSBkLmdldEZ1bGxZZWFyKCkrJy0nK3plcm9QYWQoZC5nZXRNb250aCgpKzEsMikrJy0nK3plcm9QYWQoZC5nZXREYXRlKCksMik7CiAgaWYodHlwZW9mIGZ1bGwgIT09ICd1bmRlZmluZWQnICYmIGZ1bGwpIHJldHVybiBkYXRlICsgJyAnICsgdGltZTsKICBpZihkLnRvRGF0ZVN0cmluZygpID09IG5ldyBEYXRlKCkudG9EYXRlU3RyaW5nKCkpCiAgICByZXR1cm4gdGltZTsKICBlbHNlCiAgICByZXR1cm4gZGF0ZTsKfQoKLy8gY29udmVydHMgYSBqYXZhc2NyaXB0IHRpbWUgdG8gYSBwcmVjaXNlIGRhdGUgYW5kIHRpbWUgKG9wdGlvbmFsbHkgd2l0aCBtaWxsaXNlY29uZCBwcmVjaXNpb24pCi8vIGZvcm1hdHRlZCBpbiBJU08tc3R5bGUgWVlZWS1NTS1ERCBoaDptbTpzcy5tbW0gLSBidXQgdXNpbmcgbG9jYWwgdGltZXpvbmUKd2luZG93LnVuaXhUaW1lVG9EYXRlVGltZVN0cmluZyA9IGZ1bmN0aW9uKHRpbWUsIG1pbGxpc2Vjb25kKSB7CiAgaWYoIXRpbWUpIHJldHVybiBudWxsOwogIHZhciBkID0gbmV3IERhdGUodHlwZW9mIHRpbWUgPT09ICdzdHJpbmcnID8gcGFyc2VJbnQodGltZSkgOiB0aW1lKTsKICByZXR1cm4gZC5nZXRGdWxsWWVhcigpKyctJyt6ZXJvUGFkKGQuZ2V0TW9udGgoKSsxLDIpKyctJyt6ZXJvUGFkKGQuZ2V0RGF0ZSgpLDIpCiAgICArJyAnK3plcm9QYWQoZC5nZXRIb3VycygpLDIpKyc6Jyt6ZXJvUGFkKGQuZ2V0TWludXRlcygpLDIpKyc6Jyt6ZXJvUGFkKGQuZ2V0U2Vjb25kcygpLDIpKyhtaWxsaXNlY29uZD8nLicremVyb1BhZChkLmdldE1pbGxpc2Vjb25kcygpLDMpOicnKTsKfQoKd2luZG93LnVuaXhUaW1lVG9ISG1tID0gZnVuY3Rpb24odGltZSkgewogIGlmKCF0aW1lKSByZXR1cm4gbnVsbDsKICB2YXIgZCA9IG5ldyBEYXRlKHR5cGVvZiB0aW1lID09PSAnc3RyaW5nJyA/IHBhcnNlSW50KHRpbWUpIDogdGltZSk7CiAgdmFyIGggPSAnJyArIGQuZ2V0SG91cnMoKTsgaCA9IGgubGVuZ3RoID09PSAxID8gJzAnICsgaCA6IGg7CiAgdmFyIHMgPSAnJyArIGQuZ2V0TWludXRlcygpOyBzID0gcy5sZW5ndGggPT09IDEgPyAnMCcgKyBzIDogczsKICByZXR1cm4gIGggKyAnOicgKyBzOwp9Cgp3aW5kb3cuZm9ybWF0SW50ZXJ2YWwgPSBmdW5jdGlvbihzZWNvbmRzLG1heFRlcm1zKSB7CgogIHZhciBkID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gODY0MDApOwogIHZhciBoID0gTWF0aC5mbG9vcigoc2Vjb25kcyAlIDg2NDAwKSAvIDM2MDApOwogIHZhciBtID0gTWF0aC5mbG9vcigoc2Vjb25kcyAlIDM2MDApIC8gNjApOwogIHZhciBzID0gc2Vjb25kcyAlIDYwOwoKICB2YXIgdGVybXMgPSBbXTsKICBpZiAoZCA+IDApIHRlcm1zLnB1c2goZCsnZCcpOwogIGlmIChoID4gMCkgdGVybXMucHVzaChoKydoJyk7CiAgaWYgKG0gPiAwKSB0ZXJtcy5wdXNoKG0rJ20nKTsKICBpZiAocyA+IDAgfHwgdGVybXMubGVuZ3RoPT0wKSB0ZXJtcy5wdXNoKHMrJ3MnKTsKCiAgaWYgKG1heFRlcm1zKSB0ZXJtcyA9IHRlcm1zLnNsaWNlKDAsbWF4VGVybXMpOwoKICByZXR1cm4gdGVybXMuam9pbignICcpOwp9CgoKd2luZG93LnJhbmdlTGlua0NsaWNrID0gZnVuY3Rpb24oKSB7CiAgaWYod2luZG93LnBvcnRhbFJhbmdlSW5kaWNhdG9yKQogICAgd2luZG93Lm1hcC5maXRCb3VuZHMod2luZG93LnBvcnRhbFJhbmdlSW5kaWNhdG9yLmdldEJvdW5kcygpKTsKICBpZih3aW5kb3cuaXNTbWFydHBob25lKCkpCiAgICB3aW5kb3cuc2hvdygnbWFwJyk7Cn0KCndpbmRvdy5zaG93UG9ydGFsUG9zTGlua3MgPSBmdW5jdGlvbihsYXQsIGxuZywgbmFtZSkgewogIHZhciBlbmNvZGVkX25hbWUgPSAndW5kZWZpbmVkJzsKICBpZihuYW1lICE9PSB1bmRlZmluZWQpIHsKICAgIGVuY29kZWRfbmFtZSA9IGVuY29kZVVSSUNvbXBvbmVudChuYW1lKTsKICB9CgogIGlmICh0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCAmJiBhbmRyb2lkLmludGVudFBvc0xpbmspIHsKICAgIGFuZHJvaWQuaW50ZW50UG9zTGluayhsYXQsIGxuZywgbWFwLmdldFpvb20oKSwgbmFtZSwgdHJ1ZSk7CiAgfSBlbHNlIHsKICAgIHZhciBxcmNvZGUgPSAnPGRpdiBpZD0icXJjb2RlIj48L2Rpdj4nOwogICAgdmFyIHNjcmlwdCA9ICc8c2NyaXB0PiQoXCcjcXJjb2RlXCcpLnFyY29kZSh7dGV4dDpcJ0dFTzonK2xhdCsnLCcrbG5nKydcJ30pOzwvc2NyaXB0Pic7CiAgICB2YXIgZ21hcHMgPSAnPGEgaHJlZj0iaHR0cHM6Ly9tYXBzLmdvb2dsZS5jb20vbWFwcz9sbD0nK2xhdCsnLCcrbG5nKycmcT0nK2xhdCsnLCcrbG5nKyclMjAoJytlbmNvZGVkX25hbWUrJykiPkdvb2dsZSBNYXBzPC9hPic7CiAgICB2YXIgYmluZ21hcHMgPSAnPGEgaHJlZj0iaHR0cDovL3d3dy5iaW5nLmNvbS9tYXBzLz92PTImY3A9JytsYXQrJ34nK2xuZysnJmx2bD0xNiZzcD1Qb2ludC4nK2xhdCsnXycrbG5nKydfJytlbmNvZGVkX25hbWUrJ19fXyI+QmluZyBNYXBzPC9hPic7CiAgICB2YXIgb3NtID0gJzxhIGhyZWY9Imh0dHA6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvP21sYXQ9JytsYXQrJyZtbG9uPScrbG5nKycmem9vbT0xNiI+T3BlblN0cmVldE1hcDwvYT4nOwogICAgdmFyIGxhdExuZyA9ICc8c3Bhbj4mbHQ7JyArIGxhdCArICcsJyArIGxuZyArJyZndDs8L3NwYW4+JzsKICAgIGRpYWxvZyh7CiAgICAgIGh0bWw6ICc8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOiBjZW50ZXI7Ij4nICsgcXJjb2RlICsgc2NyaXB0ICsgZ21hcHMgKyAnOyAnICsgYmluZ21hcHMgKyAnOyAnICsgb3NtICsgJzxiciAvPicgKyBsYXRMbmcgKyAnPC9kaXY+JywKICAgICAgdGl0bGU6IG5hbWUsCiAgICAgIGlkOiAncG9zbGlua3MnCiAgICB9KTsKICB9Cn0KCndpbmRvdy5pc1RvdWNoRGV2aWNlID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuICdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdyAvLyB3b3JrcyBvbiBtb3N0IGJyb3dzZXJzCiAgICAgIHx8ICdvbm1zZ2VzdHVyZWNoYW5nZScgaW4gd2luZG93OyAvLyB3b3JrcyBvbiBpZTEwCn07Cgp3aW5kb3cuYW5kcm9pZENvcHkgPSBmdW5jdGlvbih0ZXh0KSB7CiAgaWYodHlwZW9mIGFuZHJvaWQgPT09ICd1bmRlZmluZWQnIHx8ICFhbmRyb2lkIHx8ICFhbmRyb2lkLmNvcHkpCiAgICByZXR1cm4gdHJ1ZTsgLy8gaS5lLiBleGVjdXRlIG90aGVyIGFjdGlvbnMKICBlbHNlCiAgICBhbmRyb2lkLmNvcHkodGV4dCk7CiAgcmV0dXJuIGZhbHNlOwp9Cgp3aW5kb3cuYW5kcm9pZFBlcm1hbGluayA9IGZ1bmN0aW9uKCkgewogIGlmKHR5cGVvZiBhbmRyb2lkID09PSAndW5kZWZpbmVkJyB8fCAhYW5kcm9pZCB8fCAhYW5kcm9pZC5pbnRlbnRQb3NMaW5rKQogICAgcmV0dXJuIHRydWU7IC8vIGkuZS4gZXhlY3V0ZSBvdGhlciBhY3Rpb25zCgogIHZhciBjZW50ZXIgPSBtYXAuZ2V0Q2VudGVyKCk7CiAgYW5kcm9pZC5pbnRlbnRQb3NMaW5rKGNlbnRlci5sYXQsIGNlbnRlci5sbmcsIG1hcC5nZXRab29tKCksICJTZWxlY3RlZCBtYXAgdmlldyIsIGZhbHNlKTsKICByZXR1cm4gZmFsc2U7Cn0KCgoKd2luZG93LmdldE1pblBvcnRhbExldmVsID0gZnVuY3Rpb24oKSB7CiAgdmFyIHogPSBtYXAuZ2V0Wm9vbSgpOwogIHogPSBnZXREYXRhWm9vbUZvck1hcFpvb20oeik7CiAgcmV0dXJuIGdldE1hcFpvb21UaWxlUGFyYW1ldGVycyh6KS5sZXZlbDsKfQoKLy8gcmV0dXJucyBudW1iZXIgb2YgcGl4ZWxzIGxlZnQgdG8gc2Nyb2xsIGRvd24gYmVmb3JlIHJlYWNoaW5nIHRoZQovLyBib3R0b20uIFdvcmtzIHNpbWlsYXIgdG8gdGhlIG5hdGl2ZSBzY3JvbGxUb3AgZnVuY3Rpb24uCndpbmRvdy5zY3JvbGxCb3R0b20gPSBmdW5jdGlvbihlbG0pIHsKICBpZih0eXBlb2YgZWxtID09PSAnc3RyaW5nJykgZWxtID0gJChlbG0pOwogIHJldHVybiBlbG0uZ2V0KDApLnNjcm9sbEhlaWdodCAtIGVsbS5pbm5lckhlaWdodCgpIC0gZWxtLnNjcm9sbFRvcCgpOwp9Cgp3aW5kb3cuem9vbVRvQW5kU2hvd1BvcnRhbCA9IGZ1bmN0aW9uKGd1aWQsIGxhdGxuZykgewogIG1hcC5zZXRWaWV3KGxhdGxuZywgMTcpOwogIC8vIGlmIHRoZSBkYXRhIGlzIGF2YWlsYWJsZSwgcmVuZGVyIGl0IGltbWVkaWF0ZWx5LiBPdGhlcndpc2UgZGVmZXIKICAvLyB1bnRpbCBpdCBiZWNvbWVzIGF2YWlsYWJsZS4KICBpZih3aW5kb3cucG9ydGFsc1tndWlkXSkKICAgIHJlbmRlclBvcnRhbERldGFpbHMoZ3VpZCk7CiAgZWxzZQogICAgdXJsUG9ydGFsID0gZ3VpZDsKfQoKd2luZG93LnNlbGVjdFBvcnRhbEJ5TGF0TG5nID0gZnVuY3Rpb24obGF0LCBsbmcpIHsKICBpZihsbmcgPT09IHVuZGVmaW5lZCAmJiBsYXQgaW5zdGFuY2VvZiBBcnJheSkgewogICAgbG5nID0gbGF0WzFdOwogICAgbGF0ID0gbGF0WzBdOwogIH0gZWxzZSBpZihsbmcgPT09IHVuZGVmaW5lZCAmJiBsYXQgaW5zdGFuY2VvZiBMLkxhdExuZykgewogICAgbG5nID0gbGF0LmxuZzsKICAgIGxhdCA9IGxhdC5sYXQ7CiAgfQogIGZvcih2YXIgZ3VpZCBpbiB3aW5kb3cucG9ydGFscykgewogICAgdmFyIGxhdGxuZyA9IHdpbmRvdy5wb3J0YWxzW2d1aWRdLmdldExhdExuZygpOwogICAgaWYobGF0bG5nLmxhdCA9PSBsYXQgJiYgbGF0bG5nLmxuZyA9PSBsbmcpIHsKICAgICAgcmVuZGVyUG9ydGFsRGV0YWlscyhndWlkKTsKICAgICAgcmV0dXJuOwogICAgfQogIH0KCiAgLy8gbm90IGN1cnJlbnRseSB2aXNpYmxlCiAgdXJsUG9ydGFsTEwgPSBbbGF0LCBsbmddOwogIG1hcC5zZXRWaWV3KHVybFBvcnRhbExMLCAxNyk7Cn07CgpTdHJpbmcucHJvdG90eXBlLmNhcGl0YWxpemUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5zbGljZSgxKS50b0xvd2VyQ2FzZSgpOwp9CgovLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS82NDY2NDMvMTY4NDUzMCBieSBCZXJnaSBhbmQgQ01TCmlmICh0eXBlb2YgU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoICE9PSAnZnVuY3Rpb24nKSB7CiAgU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoID0gZnVuY3Rpb24gKHN0cil7CiAgICByZXR1cm4gdGhpcy5zbGljZSgwLCBzdHIubGVuZ3RoKSA9PT0gc3RyOwogIH07Cn0KCi8vIGVzY2FwZSBhIGphdmFzY3JpcHQgc3RyaW5nLCBzbyBxdW90ZXMgYW5kIGJhY2tzbGFzaGVzIGFyZSBlc2NhcGVkIHdpdGggYSBiYWNrc2xhc2gKLy8gKGZvciBzdHJpbmdzIHBhc3NlZCBhcyBwYXJhbWV0ZXJzIHRvIGh0bWwgb25jbGljaz0iLi4uIiBmb3IgZXhhbXBsZSkKd2luZG93LmVzY2FwZUphdmFzY3JpcHRTdHJpbmcgPSBmdW5jdGlvbihzdHIpIHsKICByZXR1cm4gKHN0cisnJykucmVwbGFjZSgvW1xcIiddL2csJ1xcJCYnKTsKfQoKLy9lc2NhcGUgc3BlY2lhbCBjaGFyYWN0ZXJzLCBzdWNoIGFzIHRhZ3MKd2luZG93LmVzY2FwZUh0bWxTcGVjaWFsQ2hhcnMgPSBmdW5jdGlvbihzdHIpIHsKICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChkaXYpOwogIHZhciB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoc3RyKTsKICBkaXYuYXBwZW5kQ2hpbGQodGV4dCk7CiAgcmV0dXJuIGRpdi5pbm5lckhUTUw7Cn0KCndpbmRvdy5wcmV0dHlFbmVyZ3kgPSBmdW5jdGlvbihucmcpIHsKICByZXR1cm4gbnJnPiAxMDAwID8gTWF0aC5yb3VuZChucmcvMTAwMCkgKyAnIGsnOiBucmc7Cn0KCndpbmRvdy5zZXRQZXJtYUxpbmsgPSBmdW5jdGlvbihlbG0pIHsKICB2YXIgYyA9IG1hcC5nZXRDZW50ZXIoKTsKICB2YXIgbGF0ID0gTWF0aC5yb3VuZChjLmxhdCoxRTYpLzFFNjsKICB2YXIgbG5nID0gTWF0aC5yb3VuZChjLmxuZyoxRTYpLzFFNjsKICB2YXIgcXJ5ID0gJ2xsPScrbGF0KycsJytsbmcrJyZ6PScgKyBtYXAuZ2V0Wm9vbSgpOwogICQoZWxtKS5hdHRyKCdocmVmJywgICcvaW50ZWw/JyArIHFyeSk7Cn0KCndpbmRvdy51bmlxdWVBcnJheSA9IGZ1bmN0aW9uKGFycikgewogIHJldHVybiAkLmdyZXAoYXJyLCBmdW5jdGlvbih2LCBpKSB7CiAgICByZXR1cm4gJC5pbkFycmF5KHYsIGFycikgPT09IGk7CiAgfSk7Cn0KCndpbmRvdy5nZW5Gb3VyQ29sdW1uVGFibGUgPSBmdW5jdGlvbihibG9ja3MpIHsKICB2YXIgdCA9ICQubWFwKGJsb2NrcywgZnVuY3Rpb24oZGV0YWlsLCBpbmRleCkgewogICAgaWYoIWRldGFpbCkgcmV0dXJuICcnOwogICAgdmFyIHRpdGxlID0gZGV0YWlsWzJdID8gJyB0aXRsZT0iJytlc2NhcGVIdG1sU3BlY2lhbENoYXJzKGRldGFpbFsyXSkgKyAnIicgOiAnJzsKICAgIGlmKGluZGV4ICUgMiA9PT0gMCkKICAgICAgcmV0dXJuICc8dHI+PHRkJyt0aXRsZSsnPicrZGV0YWlsWzFdKyc8L3RkPjx0aCcrdGl0bGUrJz4nK2RldGFpbFswXSsnPC90aD4nOwogICAgZWxzZQogICAgICByZXR1cm4gJyAgICA8dGgnK3RpdGxlKyc+JytkZXRhaWxbMF0rJzwvdGg+PHRkJyt0aXRsZSsnPicrZGV0YWlsWzFdKyc8L3RkPjwvdHI+JzsKICB9KS5qb2luKCcnKTsKICBpZih0Lmxlbmd0aCAlIDIgPT09IDEpIHQgKyAnPHRkPjwvdGQ+PHRkPjwvdGQ+PC90cj4nOwogIHJldHVybiB0Owp9CgoKLy8gY29udmVydHMgZ2l2ZW4gdGV4dCB3aXRoIG5ld2xpbmVzIChcbikgYW5kIHRhYnMgKFx0KSB0byBhIEhUTUwKLy8gdGFibGUgYXV0b21hdGljYWxseS4Kd2luZG93LmNvbnZlcnRUZXh0VG9UYWJsZU1hZ2ljID0gZnVuY3Rpb24odGV4dCkgewogIC8vIGNoZWNrIGlmIGl0IHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gYSB0YWJsZQogIGlmKCF0ZXh0Lm1hdGNoKC9cdC8pKSByZXR1cm4gdGV4dC5yZXBsYWNlKC9cbi9nLCAnPGJyPicpOwoKICB2YXIgZGF0YSA9IFtdOwogIHZhciBjb2x1bW5Db3VudCA9IDA7CgogIC8vIHBhcnNlIGRhdGEKICB2YXIgcm93cyA9IHRleHQuc3BsaXQoJ1xuJyk7CiAgJC5lYWNoKHJvd3MsIGZ1bmN0aW9uKGksIHJvdykgewogICAgZGF0YVtpXSA9IHJvdy5zcGxpdCgnXHQnKTsKICAgIGlmKGRhdGFbaV0ubGVuZ3RoID4gY29sdW1uQ291bnQpIGNvbHVtbkNvdW50ID0gZGF0YVtpXS5sZW5ndGg7CiAgfSk7CgogIC8vIGJ1aWxkIHRoZSB0YWJsZQogIHZhciB0YWJsZSA9ICc8dGFibGU+JzsKICAkLmVhY2goZGF0YSwgZnVuY3Rpb24oaSwgcm93KSB7CiAgICB0YWJsZSArPSAnPHRyPic7CiAgICAkLmVhY2goZGF0YVtpXSwgZnVuY3Rpb24oaywgY2VsbCkgewogICAgICB2YXIgYXR0cmlidXRlcyA9ICcnOwogICAgICBpZihrID09PSAwICYmIGRhdGFbaV0ubGVuZ3RoIDwgY29sdW1uQ291bnQpIHsKICAgICAgICBhdHRyaWJ1dGVzID0gJyBjb2xzcGFuPSInKyhjb2x1bW5Db3VudCAtIGRhdGFbaV0ubGVuZ3RoICsgMSkrJyInOwogICAgICB9CiAgICAgIHRhYmxlICs9ICc8dGQnK2F0dHJpYnV0ZXMrJz4nK2NlbGwrJzwvdGQ+JzsKICAgIH0pOwogICAgdGFibGUgKz0gJzwvdHI+JzsKICB9KTsKICB0YWJsZSArPSAnPC90YWJsZT4nOwogIHJldHVybiB0YWJsZTsKfQoKLy8gR2l2ZW4gMyBzZXRzIG9mIHBvaW50cyBpbiBhbiBhcnJheVszXXtsYXQsIGxuZ30gcmV0dXJucyB0aGUgYXJlYSBvZiB0aGUgdHJpYW5nbGUKd2luZG93LmNhbGNUcmlBcmVhID0gZnVuY3Rpb24ocCkgewogIHJldHVybiBNYXRoLmFicygocFswXS5sYXQqKHBbMV0ubG5nLXBbMl0ubG5nKStwWzFdLmxhdCoocFsyXS5sbmctcFswXS5sbmcpK3BbMl0ubGF0KihwWzBdLmxuZy1wWzFdLmxuZykpLzIpOwp9CgovLyBVcGRhdGUgbGF5ZXJHcm91cHMgZGlzcGxheSBzdGF0dXMgdG8gd2luZG93Lm92ZXJsYXlTdGF0dXMgYW5kIGxvY2FsU3RvcmFnZSAnaW5ncmVzcy5pbnRlbG1hcC5sYXllcmdyb3VwZGlzcGxheWVkJwp3aW5kb3cudXBkYXRlRGlzcGxheWVkTGF5ZXJHcm91cCA9IGZ1bmN0aW9uKG5hbWUsIGRpc3BsYXkpIHsKICBvdmVybGF5U3RhdHVzW25hbWVdID0gZGlzcGxheTsKICBsb2NhbFN0b3JhZ2VbJ2luZ3Jlc3MuaW50ZWxtYXAubGF5ZXJncm91cGRpc3BsYXllZCddID0gSlNPTi5zdHJpbmdpZnkob3ZlcmxheVN0YXR1cyk7Cn0KCi8vIFJlYWQgbGF5ZXJHcm91cCBzdGF0dXMgZnJvbSB3aW5kb3cub3ZlcmxheVN0YXR1cyBpZiBpdCB3YXMgYWRkZWQgdG8gbWFwLAovLyByZWFkIGZyb20gY29va2llIGlmIGl0IGhhcyBub3QgYWRkZWQgdG8gbWFwIHlldC4KLy8gcmV0dXJuICdkZWZhdWx0RGlzcGxheScgaWYgYm90aCBvdmVybGF5U3RhdHVzIGFuZCBjb29raWUgZGlkbid0IGhhdmUgdGhlIHJlY29yZAp3aW5kb3cuaXNMYXllckdyb3VwRGlzcGxheWVkID0gZnVuY3Rpb24obmFtZSwgZGVmYXVsdERpc3BsYXkpIHsKICBpZih0eXBlb2Yob3ZlcmxheVN0YXR1c1tuYW1lXSkgIT09ICd1bmRlZmluZWQnKSByZXR1cm4gb3ZlcmxheVN0YXR1c1tuYW1lXTsKCiAgY29udmVydENvb2tpZVRvTG9jYWxTdG9yYWdlKCdpbmdyZXNzLmludGVsbWFwLmxheWVyZ3JvdXBkaXNwbGF5ZWQnKTsKICB2YXIgbGF5ZXJzSlNPTiA9IGxvY2FsU3RvcmFnZVsnaW5ncmVzcy5pbnRlbG1hcC5sYXllcmdyb3VwZGlzcGxheWVkJ107CiAgaWYoIWxheWVyc0pTT04pIHJldHVybiBkZWZhdWx0RGlzcGxheTsKCiAgdmFyIGxheWVycyA9IEpTT04ucGFyc2UobGF5ZXJzSlNPTik7CiAgLy8ga2VlcCBsYXRlc3Qgb3ZlcmxheVN0YXR1cwogIG92ZXJsYXlTdGF0dXMgPSAkLmV4dGVuZChsYXllcnMsIG92ZXJsYXlTdGF0dXMpOwogIGlmKHR5cGVvZihvdmVybGF5U3RhdHVzW25hbWVdKSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiBkZWZhdWx0RGlzcGxheTsKICByZXR1cm4gb3ZlcmxheVN0YXR1c1tuYW1lXTsKfQoKd2luZG93LmFkZExheWVyR3JvdXAgPSBmdW5jdGlvbihuYW1lLCBsYXllckdyb3VwLCBkZWZhdWx0RGlzcGxheSkgewogIGlmIChkZWZhdWx0RGlzcGxheSA9PT0gdW5kZWZpbmVkKSBkZWZhdWx0RGlzcGxheSA9IHRydWU7CgogIGlmKGlzTGF5ZXJHcm91cERpc3BsYXllZChuYW1lLCBkZWZhdWx0RGlzcGxheSkpIG1hcC5hZGRMYXllcihsYXllckdyb3VwKTsKICBsYXllckNob29zZXIuYWRkT3ZlcmxheShsYXllckdyb3VwLCBuYW1lKTsKfQoKd2luZG93LmNsYW1wTGF0ID0gZnVuY3Rpb24obGF0KSB7CiAgLy8gdGhlIG1hcCBwcm9qZWN0aW9uIHVzZWQgZG9lcyBub3QgaGFuZGxlIGFib3ZlIGFwcHJveCArLSA4NSBkZWdyZWVzIG5vcnRoL3NvdXRoIG9mIHRoZSBlcXVhdG9yCiAgaWYgKGxhdCA+IDg1LjA1MTEyOCkKICAgIGxhdCA9IDg1LjA1MTEyODsKICBlbHNlIGlmIChsYXQgPCAtODUuMDUxMTI4KQogICAgbGF0ID0gLTg1LjA1MTEyODsKICByZXR1cm4gbGF0Owp9Cgp3aW5kb3cuY2xhbXBMbmcgPSBmdW5jdGlvbihsbmcpIHsKICBpZiAobG5nID4gMTc5Ljk5OTk5OSkKICAgIGxuZyA9IDE3OS45OTk5OTk7CiAgZWxzZSBpZiAobG5nIDwgLTE4MC4wKQogICAgbG5nID0gLTE4MC4wOwogIHJldHVybiBsbmc7Cn0KCgp3aW5kb3cuY2xhbXBMYXRMbmcgPSBmdW5jdGlvbihsYXRsbmcpIHsKICByZXR1cm4gbmV3IEwuTGF0TG5nICggY2xhbXBMYXQobGF0bG5nLmxhdCksIGNsYW1wTG5nKGxhdGxuZy5sbmcpICk7Cn0KCndpbmRvdy5jbGFtcExhdExuZ0JvdW5kcyA9IGZ1bmN0aW9uKGJvdW5kcykgewogIHJldHVybiBuZXcgTC5MYXRMbmdCb3VuZHMgKCBjbGFtcExhdExuZyhib3VuZHMuZ2V0U291dGhXZXN0KCkpLCBjbGFtcExhdExuZyhib3VuZHMuZ2V0Tm9ydGhFYXN0KCkpICk7Cn0KCndpbmRvdy5nZXRHZW5lcmljTWFya2VyU3ZnID0gZnVuY3Rpb24oY29sb3IpIHsKICB2YXIgbWFya2VyVGVtcGxhdGUgPSAnPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz5cbjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIlxuCXZlcnNpb249IjEuMSIgYmFzZVByb2ZpbGU9ImZ1bGwiXG4Jd2lkdGg9IjI1cHgiIGhlaWdodD0iNDFweCIgdmlld0JveD0iMCAwIDI1IDQxIj5cblxuCTxwYXRoIGQ9Ik0xLjM2MjQxODQ0NzY1LDE4LjY3NDg4MTI0Njc1IEExMi41LDEyLjUgMCAxLDEgMjMuNjM3NTgxNTUyMzUsMTguNjc0ODgxMjQ2NzUgTDEyLjUsNDAuNTMzNjE1ODA3MyBaIiBzdHlsZT0ic3Ryb2tlOm5vbmU7IGZpbGw6ICVDT0xPUiU7IiAvPlxuCTxwYXRoIGQ9Ik0xLjgwNzkyMTcwOTc1LDE4LjQ0Nzg4NTk5Njg1IEExMiwxMiAwIDEsMSAyMy4xOTIwNzgyOTAyNSwxOC40NDc4ODU5OTY4NSBMMTIuNSwzOS40MzIyNzExNzUgWiIgc3R5bGU9InN0cm9rZTojMDAwMDAwOyBzdHJva2Utd2lkdGg6MXB4OyBzdHJva2Utb3BhY2l0eTogMC4xNTsgZmlsbDogbm9uZTsiIC8+XG4JPHBhdGggZD0iTTIuOTIxNjc5ODY1LDE3Ljg4MDM5Nzg3MjIgQTEwLjc1LDEwLjc1IDAgMSwxIDIyLjA3ODMyMDEzNSwxNy44ODAzOTc4NzIyIEwxMi41LDM2LjY3ODkwOTU5NDMgWiIgc3R5bGU9InN0cm9rZTojZmZmZmZmOyBzdHJva2Utd2lkdGg6MS41cHg7IHN0cm9rZS1vcGFjaXR5OiAwLjM1OyBmaWxsOiBub25lOyIgLz5cblxuCTxwYXRoIGQ9Ik0xOS44NjEyMTU5MzIxNSwxNy4yNSBMMTIuNSwyMS41IEw1LjEzODc4NDA2Nzg1LDE3LjI1IEw1LjEzODc4NDA2Nzg1LDguNzUgTDEyLjUsNC41IEwxOS44NjEyMTU5MzIxNSw4Ljc1IFogTTcuNzM2ODYwMjc5MiwxMC4yNSBMMTcuMjYzMTM5NzIwOCwxMC4yNSBMMTIuNSwxOC41IFogTTEyLjUsMTMgTDcuNzM2ODYwMjc5MiwxMC4yNSBNMTIuNSwxMyBMMTcuMjYzMTM5NzIwOCwxMC4yNSBNMTIuNSwxMyBMMTIuNSwxOC41IE0xOS44NjEyMTU5MzIxNSwxNy4yNSBMMTYuMzk3MTE0MzE3MDUsMTUuMjUgTTUuMTM4Nzg0MDY3ODUsMTcuMjUgTDguNjAyODg1NjgyOTUsMTUuMjUgTTEyLjUsNC41IEwxMi41LDguNSIgc3R5bGU9InN0cm9rZTojZmZmZmZmOyBzdHJva2Utd2lkdGg6MS4yNXB4OyBzdHJva2Utb3BhY2l0eTogMTsgZmlsbDogbm9uZTsiIC8+XG5cbjwvc3ZnPic7CgogIHJldHVybiBtYXJrZXJUZW1wbGF0ZS5yZXBsYWNlKC8lQ09MT1IlL2csIGNvbG9yKTsKfQoKd2luZG93LmdldEdlbmVyaWNNYXJrZXJJY29uID0gZnVuY3Rpb24oY29sb3IsY2xhc3NOYW1lKSB7CiAgcmV0dXJuIEwuZGl2SWNvbih7CiAgICBpY29uU2l6ZTogbmV3IEwuUG9pbnQoMjUsIDQxKSwKICAgIGljb25BbmNob3I6IG5ldyBMLlBvaW50KDEyLCA0MSksCiAgICBodG1sOiBnZXRHZW5lcmljTWFya2VyU3ZnKGNvbG9yKSwKICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lIHx8ICdsZWFmbGV0LWlpdGMtZGl2aWNvbi1nZW5lcmljLW1hcmtlcicKICB9KTsKfQoKd2luZG93LmNyZWF0ZUdlbmVyaWNNYXJrZXIgPSBmdW5jdGlvbihsbCxjb2xvcixvcHRpb25zKSB7CiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogIHZhciBtYXJrZXJPcHQgPSAkLmV4dGVuZCh7CiAgICBpY29uOiBnZXRHZW5lcmljTWFya2VySWNvbihjb2xvciB8fCAnI2EyNGFjMycpCiAgfSwgb3B0aW9ucyk7CgogIHJldHVybiBMLm1hcmtlcihsbCwgbWFya2VyT3B0KTsKfQoKCgovLyBGaXggTGVhZmxldDogaGFuZGxlIHRvdWNoY2FuY2VsIGV2ZW50cyBpbiBEcmFnZ2FibGUKTC5EcmFnZ2FibGUucHJvdG90eXBlLl9vbkRvd25PcmlnID0gTC5EcmFnZ2FibGUucHJvdG90eXBlLl9vbkRvd247CkwuRHJhZ2dhYmxlLnByb3RvdHlwZS5fb25Eb3duID0gZnVuY3Rpb24oZSkgewogIEwuRHJhZ2dhYmxlLnByb3RvdHlwZS5fb25Eb3duT3JpZy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKICBpZihlLnR5cGUgPT09ICJ0b3VjaHN0YXJ0IikgewogICAgTC5Eb21FdmVudC5vbihkb2N1bWVudCwgInRvdWNoY2FuY2VsIiwgdGhpcy5fb25VcCwgdGhpcyk7CiAgfQp9CgoKCgp9IC8vIGVuZCBvZiB3cmFwcGVyCgovLyBpbmplY3QgY29kZSBpbnRvIHNpdGUgY29udGV4dAp2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CnZhciBpbmZvID0geyBidWlsZE5hbWU6ICdpaXRjJywgZGF0ZVRpbWVWZXJzaW9uOiAnMjAxNjEwMDMuNDc0MCcgfTsKaWYgKHRoaXMuR01faW5mbyAmJiB0aGlzLkdNX2luZm8uc2NyaXB0KSBpbmZvLnNjcmlwdCA9IHsgdmVyc2lvbjogR01faW5mby5zY3JpcHQudmVyc2lvbiwgbmFtZTogR01faW5mby5zY3JpcHQubmFtZSwgZGVzY3JpcHRpb246IEdNX2luZm8uc2NyaXB0LmRlc2NyaXB0aW9uIH07CnNjcmlwdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnKCcrIHdyYXBwZXIgKycpKCcrSlNPTi5zdHJpbmdpZnkoaW5mbykrJyk7JykpOwooZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsK"},{"name":"IITC plugin: reso energy pct in portal detail","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null}},"storage":{"data":{},"ts":1480917632169},"enabled":true,"position":2,"file_url":"https://static.iitc.me/build/release/plugins/reso-energy-pct-in-portal-detail.user.js","uuid":"684c3daa-f9e7-46f3-9b94-b3108a6ab5b2","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLXJlc28tZW5lcmd5LXBjdC1pbi1wb3J0YWwtZGV0YWlsQHhlbGlvCi8vIEBuYW1lICAgICAgICAgICBJSVRDIHBsdWdpbjogcmVzbyBlbmVyZ3kgcGN0IGluIHBvcnRhbCBkZXRhaWwKLy8gQGNhdGVnb3J5ICAgICAgIFBvcnRhbCBJbmZvCi8vIEB2ZXJzaW9uICAgICAgICAwLjEuMi4yMDE2MTAwMy40NzQwCi8vIEBuYW1lc3BhY2UgICAgICBodHRwczovL2dpdGh1Yi5jb20vam9uYXRraW5zL2luZ3Jlc3MtaW50ZWwtdG90YWwtY29udmVyc2lvbgovLyBAdXBkYXRlVVJMICAgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3BsdWdpbnMvcmVzby1lbmVyZ3ktcGN0LWluLXBvcnRhbC1kZXRhaWwubWV0YS5qcwovLyBAZG93bmxvYWRVUkwgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3BsdWdpbnMvcmVzby1lbmVyZ3ktcGN0LWluLXBvcnRhbC1kZXRhaWwudXNlci5qcwovLyBAZGVzY3JpcHRpb24gICAgW2lpdGMtMjAxNi0xMC0wMy0wMDQ3NDBdIFNob3cgcmVzb25hdG9yIGVuZXJneSBwZXJjZW50YWdlIG9uIHJlc29uYXRvciBlbmVyZ3kgYmFyIGluIHBvcnRhbCBkZXRhaWwgcGFuZWwuCi8vIEBpbmNsdWRlICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQG1hdGNoICAgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQG1hdGNoICAgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBtYXRjaCAgICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBtYXRjaCAgICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQGdyYW50ICAgICAgICAgIG5vbmUKLy8gPT0vVXNlclNjcmlwdD09CgoKZnVuY3Rpb24gd3JhcHBlcihwbHVnaW5faW5mbykgewovLyBlbnN1cmUgcGx1Z2luIGZyYW1ld29yayBpcyB0aGVyZSwgZXZlbiBpZiBpaXRjIGlzIG5vdCB5ZXQgbG9hZGVkCmlmKHR5cGVvZiB3aW5kb3cucGx1Z2luICE9PSAnZnVuY3Rpb24nKSB3aW5kb3cucGx1Z2luID0gZnVuY3Rpb24oKSB7fTsKCi8vUExVR0lOIEFVVEhPUlM6IHdyaXRpbmcgYSBwbHVnaW4gb3V0c2lkZSBvZiB0aGUgSUlUQyBidWlsZCBlbnZpcm9ubWVudD8gaWYgc28sIGRlbGV0ZSB0aGVzZSBsaW5lcyEhCi8vKGxlYXZpbmcgdGhlbSBpbiBwbGFjZSBtaWdodCBicmVhayB0aGUgJ0Fib3V0IElJVEMnIHBhZ2Ugb3IgYnJlYWsgdXBkYXRlIGNoZWNrcykKcGx1Z2luX2luZm8uYnVpbGROYW1lID0gJ2lpdGMnOwpwbHVnaW5faW5mby5kYXRlVGltZVZlcnNpb24gPSAnMjAxNjEwMDMuNDc0MCc7CnBsdWdpbl9pbmZvLnBsdWdpbklkID0gJ3Jlc28tZW5lcmd5LXBjdC1pbi1wb3J0YWwtZGV0YWlsJzsKLy9FTkQgUExVR0lOIEFVVEhPUlMgTk9URQoKCgovLyBQTFVHSU4gU1RBUlQgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCi8vIHVzZSBvd24gbmFtZXNwYWNlIGZvciBwbHVnaW4Kd2luZG93LnBsdWdpbi5yZXNvRW5lcmd5UGN0SW5Qb3J0YWxEZXRhaWwgPSBmdW5jdGlvbigpIHt9OwoKd2luZG93LnBsdWdpbi5yZXNvRW5lcmd5UGN0SW5Qb3J0YWxEZXRhaWwudXBkYXRlTWV0ZXIgPSBmdW5jdGlvbihkYXRhKSB7CiAgJCgic3Bhbi5tZXRlci1sZXZlbCIpCiAgICAuY3NzKHsKICAgICAgIndvcmQtc3BhY2luZyI6ICItMXB4IiwKICAgICAgInRleHQtYWxpZ24iOiAibGVmdCIsCiAgICAgICJmb250LXNpemUiOiAiOTAlIiwKICAgICAgInBhZGRpbmctbGVmdCI6ICIycHgiLAogICAgfSkKICAgIC5lYWNoKGZ1bmN0aW9uKCkgewogICAgICB2YXIgbWF0Y2hSZXN1bHQgPSAkKHRoaXMpLnBhcmVudCgpLmF0dHIoJ3RpdGxlJykubWF0Y2goL1woKFxkKlwlKVwpLyk7CiAgICAgIGlmKG1hdGNoUmVzdWx0KSB7CiAgICAgICAgdmFyIGh0bWwgPSAkKHRoaXMpLmh0bWwoKSArICc8ZGl2IHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTtyaWdodDowO3RvcDowIj4nICsgbWF0Y2hSZXN1bHRbMV0gKyAnPC9kaXY+JzsKICAgICAgICAkKHRoaXMpLmh0bWwoaHRtbCk7CiAgICAgIH0KICAgIH0pOwp9Cgp2YXIgc2V0dXAgPSAgZnVuY3Rpb24oKSB7CiAgd2luZG93LmFkZEhvb2soJ3BvcnRhbERldGFpbHNVcGRhdGVkJywgd2luZG93LnBsdWdpbi5yZXNvRW5lcmd5UGN0SW5Qb3J0YWxEZXRhaWwudXBkYXRlTWV0ZXIpOwp9CgovLyBQTFVHSU4gRU5EIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgpzZXR1cC5pbmZvID0gcGx1Z2luX2luZm87IC8vYWRkIHRoZSBzY3JpcHQgaW5mbyBkYXRhIHRvIHRoZSBmdW5jdGlvbiBhcyBhIHByb3BlcnR5CmlmKCF3aW5kb3cuYm9vdFBsdWdpbnMpIHdpbmRvdy5ib290UGx1Z2lucyA9IFtdOwp3aW5kb3cuYm9vdFBsdWdpbnMucHVzaChzZXR1cCk7Ci8vIGlmIElJVEMgaGFzIGFscmVhZHkgYm9vdGVkLCBpbW1lZGlhdGVseSBydW4gdGhlICdzZXR1cCcgZnVuY3Rpb24KaWYod2luZG93LmlpdGNMb2FkZWQgJiYgdHlwZW9mIHNldHVwID09PSAnZnVuY3Rpb24nKSBzZXR1cCgpOwp9IC8vIHdyYXBwZXIgZW5kCi8vIGluamVjdCBjb2RlIGludG8gc2l0ZSBjb250ZXh0CnZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKdmFyIGluZm8gPSB7fTsKaWYgKHR5cGVvZiBHTV9pbmZvICE9PSAndW5kZWZpbmVkJyAmJiBHTV9pbmZvICYmIEdNX2luZm8uc2NyaXB0KSBpbmZvLnNjcmlwdCA9IHsgdmVyc2lvbjogR01faW5mby5zY3JpcHQudmVyc2lvbiwgbmFtZTogR01faW5mby5zY3JpcHQubmFtZSwgZGVzY3JpcHRpb246IEdNX2luZm8uc2NyaXB0LmRlc2NyaXB0aW9uIH07CnNjcmlwdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnKCcrIHdyYXBwZXIgKycpKCcrSlNPTi5zdHJpbmdpZnkoaW5mbykrJyk7JykpOwooZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCgo="},{"name":"IITC Plugin: Player tracker","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null}},"storage":{"data":{},"ts":1480917632187},"enabled":true,"position":3,"file_url":"https://static.iitc.me/build/release/plugins/player-tracker.user.js","uuid":"815b76ab-fa54-47f2-9bbc-444f90b8ae61","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLXBsYXllci10cmFja2VyQGJyZXVuaWdzCi8vIEBuYW1lICAgICAgICAgICBJSVRDIFBsdWdpbjogUGxheWVyIHRyYWNrZXIKLy8gQGNhdGVnb3J5ICAgICAgIExheWVyCi8vIEB2ZXJzaW9uICAgICAgICAwLjExLjEuMjAxNjEwMDMuNDc0MAovLyBAbmFtZXNwYWNlICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2pvbmF0a2lucy9pbmdyZXNzLWludGVsLXRvdGFsLWNvbnZlcnNpb24KLy8gQHVwZGF0ZVVSTCAgICAgIGh0dHBzOi8vc3RhdGljLmlpdGMubWUvYnVpbGQvcmVsZWFzZS9wbHVnaW5zL3BsYXllci10cmFja2VyLm1ldGEuanMKLy8gQGRvd25sb2FkVVJMICAgIGh0dHBzOi8vc3RhdGljLmlpdGMubWUvYnVpbGQvcmVsZWFzZS9wbHVnaW5zL3BsYXllci10cmFja2VyLnVzZXIuanMKLy8gQGRlc2NyaXB0aW9uICAgIFtpaXRjLTIwMTYtMTAtMDMtMDA0NzQwXSBEcmF3IHRyYWlscyBmb3IgdGhlIHBhdGggYSB1c2VyIHRvb2sgb250byB0aGUgbWFwIGJhc2VkIG9uIHN0YXR1cyBtZXNzYWdlcyBpbiBDT01Ncy4gVXNlcyB1cCB0byB0aHJlZSBob3VycyBvZiBkYXRhLiBEb2VzIG5vdCByZXF1ZXN0IGNoYXQgZGF0YSBvbiBpdHMgb3duLCBldmVuIGlmIHRoYXQgd291bGQgYmUgdXNlZnVsLgovLyBAaW5jbHVkZSAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBtYXRjaCAgICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBtYXRjaCAgICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBncmFudCAgICAgICAgICBub25lCi8vID09L1VzZXJTY3JpcHQ9PQoKCmZ1bmN0aW9uIHdyYXBwZXIocGx1Z2luX2luZm8pIHsKLy8gZW5zdXJlIHBsdWdpbiBmcmFtZXdvcmsgaXMgdGhlcmUsIGV2ZW4gaWYgaWl0YyBpcyBub3QgeWV0IGxvYWRlZAppZih0eXBlb2Ygd2luZG93LnBsdWdpbiAhPT0gJ2Z1bmN0aW9uJykgd2luZG93LnBsdWdpbiA9IGZ1bmN0aW9uKCkge307CgovL1BMVUdJTiBBVVRIT1JTOiB3cml0aW5nIGEgcGx1Z2luIG91dHNpZGUgb2YgdGhlIElJVEMgYnVpbGQgZW52aXJvbm1lbnQ/IGlmIHNvLCBkZWxldGUgdGhlc2UgbGluZXMhIQovLyhsZWF2aW5nIHRoZW0gaW4gcGxhY2UgbWlnaHQgYnJlYWsgdGhlICdBYm91dCBJSVRDJyBwYWdlIG9yIGJyZWFrIHVwZGF0ZSBjaGVja3MpCnBsdWdpbl9pbmZvLmJ1aWxkTmFtZSA9ICdpaXRjJzsKcGx1Z2luX2luZm8uZGF0ZVRpbWVWZXJzaW9uID0gJzIwMTYxMDAzLjQ3NDAnOwpwbHVnaW5faW5mby5wbHVnaW5JZCA9ICdwbGF5ZXItdHJhY2tlcic7Ci8vRU5EIFBMVUdJTiBBVVRIT1JTIE5PVEUKCgoKLy8gUExVR0lOIFNUQVJUIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCndpbmRvdy5QTEFZRVJfVFJBQ0tFUl9NQVhfVElNRSA9IDMqNjAqNjAqMTAwMDsgLy8gaW4gbWlsbGlzZWNvbmRzCndpbmRvdy5QTEFZRVJfVFJBQ0tFUl9NSU5fWk9PTSA9IDk7CndpbmRvdy5QTEFZRVJfVFJBQ0tFUl9NSU5fT1BBQ0lUWSA9IDAuMzsKd2luZG93LlBMQVlFUl9UUkFDS0VSX0xJTkVfQ09MT1VSID0gJyNGRjAwRkQnOwoKCi8vIHVzZSBvd24gbmFtZXNwYWNlIGZvciBwbHVnaW4Kd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyID0gZnVuY3Rpb24oKSB7fTsKCndpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci5zZXR1cCA9IGZ1bmN0aW9uKCkgewogICQoJzxzdHlsZT4nKS5wcm9wKCd0eXBlJywgJ3RleHQvY3NzJykuaHRtbCgnLnBsdWdpbi1wbGF5ZXItdHJhY2tlci1wb3B1cCBhIHtcbgljb2xvcjogaW5oZXJpdDtcbgl0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTtcbgl0ZXh0LWRlY29yYXRpb24tc3R5bGU6IGRhc2hlZDtcbgktbW96LXRleHQtZGVjb3JhdGlvbi1zdHlsZTogZGFzaGVkO1xuCS13ZWJraXQtdGV4dC1kZWNvcmF0aW9uLXN0eWxlOiBkYXNoZWQ7XG59XG4nKS5hcHBlbmRUbygnaGVhZCcpOwoKICB2YXIgaWNvbkVubEltYWdlID0gJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQmtBQUFBcENBWUFBQURBazRMT0FBQUFDWEJJV1hNQUFBc1RBQUFMRXdFQW1wd1lBQUFBSUdOSVVrMEFBSG9sQUFDQWd3QUErZjhBQUlEcEFBQjFNQUFBNm1BQUFEcVlBQUFYYjVKZnhVWUFBQW8xU1VSQlZIamFuSlI1VUpObkhzY2ZwN3VkN214bnQ3dTJNKzNPOXBydXpQWjlrNUNUSENRQnlSdEN3cFdEa0lRcjVCRFUxYTdGaXEwVjNvZ1hpQ0JhdVZHUVEwQU9rVU1Jb1ZMdldsMXQzZTFxVyt0VnRkdDJ0VktzTXFYVzcvNFIxT3FJMm4xblB2UE12TC9uOS92TTg3enpmY2tMOHVua1Q4SS9FUG1jVjRpMVhrTE1WU0ppcWhRUlk2V0F1Sm9ZNG5zM2k4UlY4bWh6dGNoaXJoRmxtNnFFQmFZcTRjS2srbEJyZXB1YWI2NFNFVXV0bUNSVUNJaDdXeVN4TjhwSndnWUJNWllKaWFWV1RDdzFZa0tta3BncWhjUlJGeWJKYkkwcFNLam1mMmpkRlBxOXZWRjJJNlZWQVVlVC9LZWtPdWsxeTBieGNWT2xzTVJjSXc3N2Z5UXZHU3VFTlphTm9oL1MyNVdZTzJ6QXduMFdMTnB2eGFJRGlWaTAzNHFGK3l5WTkyNE1QTjB6WUsyVDNJamJFTExaMVRuakw0OGtNVldLd2hNcWhLZlQyOVY0ZlhjQ2NnNWFNSDlmTE9iczBpSnJKQktaSXpPUU5SS0oyYnNZek44Ymc1eURGbVR2TWNMWm9ZYXBTblRlVkNXS05wWUw3NVk4TDV0T251TS9SZVJ6WGlHSm15Um1VNlZ3TEhNSGc1eURGc3picllkM09CeWVnQnBsSHkxQjJVZEw0QTJFd3hzSXZ2TUUxUEFPaDJQdXJtamtITFFnYTBBTFk2WHdla0taTU9VdXljdnFaOGp6c3VsRS9yZFhwT1phMGVpc3dTZ3NPSkNBek9FSXVBZFY4UGpWOFBqVjJIbXVDK00vWGtQcGtZWHdEcW5oR1ZMZnJya0hsWmc1SElFRit4TXdaeWdheG5MQjk4WnlvY3BTSXlhV1dqRWgra0llMFJmeWZoZTdOdVM0dXljQzJRZmk0UmxTM3hFTUJoazgzUUlBdUltYmFEbStEcDVCMWUxYVVLU0NaMGlON0FOeDhQVE1RUHc3Z3MvaTF3dCtIMXZNSnlTdVZFQmkxL0tYSk5WTGtiMC9Iak1ERVhEdFVNRTlvQTZ5STdqZWtwd2VQWTRiTjM5RTQ4ZkZjQS9jMmVjYVVNRzFRd1h2VURoZTN4OFBlNE1NMFFWYzlpWFZNNFRFbHZDZmlTMEorWHFXWDRzNUkxbzRlOEtRMGF1RXExOTFGLzVUYlFDQTdHRXo2bzRWNHNPdjlzSFZyMFJHdnhJWmZVcGs5QVp4OW9SaDlnaUQyUUV0REVVaC93MzF2dndzaVNrS1NiTlVTekJ2cng2dVBoV2MyNVZ3OWlpUjBUUFoyS2RDUnA4S1E2ZTNBZ0FXN2JRamEwQ0wxL3h4eU56QllOZTVIdVRzdE1QWkV3Wm5UN0RYMWFmQ2EzdjFzTlJLRUZmS2R4SjlBYmNwclYySjJlOXBrZHFsUU5xMk1LUjNod1ZsazBKbmp4SmRKMm9CQUwyZk5jRGJHd25uZGlYS0Q3TUFnQXRqWjVEdFQwUjZkeGpTdG9VaHRVdUIyU05hcExXcm9DL2tOUk45SWZlZ3B5OGNYbjhFVXRybFNPMVVJSzByRE9uYkp1a09nN2RYZyt3aEMzS0c3V0RmODJEZVFCelN1MVc0TUhZRy9zKzNvdm1mNjNCdTlDUktEdVFndFZPQmxBNDV2UDRJdVB2Q29TL2tIU0w2MWJ5ejNzRUl1UHJWU09sUUlMVXpTRnFuQWl0M3pjWGhDN3R3WmZ3U3JrMWN4Y1d4TXhnKzFZVzhFUS9TdXNMUWU2SVJSNzdjZy9xamF3QUFSeTd1bVpRbzRPNVh3enNZQWYxcTNqbWlYODI3NlBWSElLTlhDVWVMRE1sdGNzemFyc2Vlc3dPNDlWeTY5aFhPWFBrRVgxMDlqNXMzZndJQTdEclRCMWZYREt6YnZ4aW52ajJCelVlTGtkVWRqZVEyT1J5dE1tVDBLdUgxUjBDL21uZVJSSy9rSHNyb0NYN2N4UU5POUovWWd0SHh5d0NBL2hOYjhFYS9EZWx0S3FTMEtaQzZOUXgvN3pPajlWZzVyazk4ajIrdmY0T2FRNnVRMnFwQWNxc2N5YTB5T0Zwa3NEZExrZEduZ25PN0N0RXJ1WWVKYmhtbnpkRWloOXV2Um1aSE5EWWRLb0wvMDNiayt0MUlicEVqdXk4SnM3b01jTGFwNGU3UTRDMi9FMi83WFppMzNZaTZ3MnV3ZnQ4U09GcmtjRFFIaHp1MnlHQnZrc0x0VjhQUklvTnVHYWVUR0ZiejVobkxoUEFFd3VGb2xzTGVGTVRSTElPaldZYmkzWXZ3MGNYM2NlN0tTWnk2ZkJ6dm51ekd3cjRVT0xiSXNjVHZ3ZW5MbjZEaldBM1NXbFEvNjVYQ0d3aUhzVXlJbURVaDgwblVNaTRWdllvMzRlcFhJYlZkQVZ2akhaRzlTUVpIa3d6dU5nM2U2RTJHdTAwTFI1TWNqaVk1RnZUWWNQbmFONmgrZnlVT25CM0dnYk1CZUxZeXNEVktrZHFoZ0t0ZmhlaFZ2QW5kQ2k2SFJPVnpwakVzSGJBMVNKSFJyNEoxY3lpU0pyRTFTR0Z2a01IZUlFTmFzeHFOaDlkai81a0FHZzZYSW11ckhoZS9PNGVXSStYNHgvbTlxUHVnR0VtYlEyR3RENFZyaHdwSm02VmdXTnF2Vzg2ZFJuVEx1SVR4MGNtR0lsNncyQ0NGdFM3MER2V2hzTlhKTUxmZGlJa2JQMkRucHozd3RFVEJWaThETzVBVkRPaS9tbUd0QzBWaW5RUzJSaW5jZzJvWWlualFzSFFpczVRbVJKTkhFVTBlOWFRbWp6cVYzQ1pIYW9jQzVob3hMTFYzU0t5VllIWnJQTWJHcitEdFhqZXN0YUZJckpVZ1piTWEvdU1kY0RVeHNOU0tZYTRSSTYxTGdlUldHVFI1MUFtR3BaNWdXSW9RaHFVSnc5SWtNcGZLajFzdlFFYWZNamk4NW02eVdtSXhOajZLSmIxZVdHckU4RFRya0ZnYml0UjZkWEJQdFJpSm15VEk2Rk1pYmkwZm1qenFUVzAraDJqek9ZUkU1WE51OFNMRDBwZVQyK1J3dE1oZ3FoTEJYQzIrVGVhV29PVHRIaS9NMVdKMEh0MkVXUzN4dCt1bUtoRlNKbnNabHZvUDQ2T2ZaWHcwWVh3MElicmwzTnRFNWxFRnNXdjVTTzhPZzdsYUJGT0ZDS2JLSUpsTk1SZ2JIOFhpYmc5TWxTSUVqbS9EK2hFMldLOFF3VklqaG5ON0dHSktRcUJoNmR4YnA5RG1jd2k1Wlp2a09RMUxmMjF2bHNMZUxFVkN1UkRHaWlBekd3MFlHeC9GbTl0Y01GWUljZktiZjJQRndId1lLNFJJS0JmQ1Bwa3hocVhQYS9NNVR6OUlRaUx6S0RhbU9BUnBYUXFZS29Vd2xnV1oyV0RBZCtOWHNHQnJNdFlHbHVETDBTK1FVaHNNbktsU2hMUk9CUXhyUXFESm94ZitYSEJmQ2VPam4yWlk2b0t0VVFwYll5aGlTL2lJS3hYQXZWR1BTMWUvUnRzSE5SZ2JIOFc2Z0E5eHBRTEVsdkJoYXd6bVNzTlNweGtmL2RTOU04bTlWbTAraDJoWU9zZXdKZ1FwN1hMRXJ4Y2dwcGdQWjNVVXJvNS9Cd0E0K1BsN2lDM2hJNmFZai9qMUFxUnNsVU8vbWdmR1I3K21XOFlsOTNLL2t4REdSeitsWWFuVDFrMFNXT3NrTUt3T1FYcWxGdGNucm1IaXhnK1l1emtKTVd0Q1lDZ0tDWVp3b3dTYVBPcFRUUzcxcENhWEl2Y3lsWVJvV0hxdXZwQUh4eFlwNGtyNVNLK013bzJmYnFEdmFCc01SVUZCM0RvQjdGdWtpQzdnSVRLWHlyeWZRSk5MRWFKYndaMkszeklzOVltNU9waDZWMlVNdnJoMENxNHFBL1NGUEVRWDhKQllLNGE1U2d3TlMzM00rS2pmTUQ2SzNBOHlWWUh4VVVURFV0N29WVnpZR2tLUlVoR0o1ZHV5Ynd0aVN2aXdOWVJDdDRJTGJUN0hxU3ZnRWQycSswTzBTemxUazg5NVFwTkhIVE5PaGsyM2lvdm9BaDUwcTdpdzFJaGhMQmNpTW84NnFzbWxIcC84Qjk0WE10VTkvb3dVM1FvdXJQVVNHSXBDb0Z2T1FjeWFFRmpySkloYXdRWGpvMjNhcFRSNUVPUmhHN1JMNlY4ekxIMDRZWU1RcGdvUmRNczVNRldJRVArT0FJeVBQaGkvUWZDcmhESUJlUkFrWVlQZ2dSakxCVVJmeUROSDVYTmdyaFlqdG9RUGM3VVlVY3M1aUhqclZXUEVtMzhsRDRORXIrUTluQlhjeHpRc3ZUZDJMUi9XVFJMRWxmSXhZL0dydTE5U1B2M1luMFAvU0o2WFBwaEh1UzZpWFVvVGhxVU1VY3M0TUpXTEVMV2NnOGhjU2k5TWU1SHdVMTRnZ29kQUdKWjZOSHpVTk1aSEQwY3Q0NER4MFFIR1IwK0xtanBqZHpGbDRxZEF5N0QwQk9PanRiK2s3NWRLSG1kODlNeko5Wkg3L2pjQWhFbHFQRDMxKzVZQUFBQUFTVVZPUks1Q1lJST0nOwogIHZhciBpY29uRW5sUmV0SW1hZ2UgPSAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFESUFBQUJTQ0FZQUFBQVd5NGZyQUFBQUNYQklXWE1BQUFzVEFBQUxFd0VBbXB3WUFBQUFJR05JVWswQUFIb2xBQUNBZ3dBQStmOEFBSURwQUFCMU1BQUE2bUFBQURxWUFBQVhiNUpmeFVZQUFCSG9TVVJCVkhqYTNKdDVjRk5IbnNlVm5kVE9WbXBtYTdleXRWV3pVNU9kcXExTkRjK1NiVW1XZGZnZzVnbExJRHl5NUVQQzl3RmpybkhBT0NTWmdOOGF4NUVEY1JJekxoc0xmSUFkK1VCZ0cyTnNiRXdzSDVCd0pBRVNDQVJDSUJCQ2dBRG1OTmQzLzVDNi9XUWRPQWtrTUYzMUxZN1gzYi9mcDMvdlBYWC91cDhBZ09BZlFRKzl4RldIL001b2xjcmlhMldHdU9xUVhLTlZ1c0pvbGI1anRFb1hHNjNTeFBoYW1TcXVPdVFQK2NQR1h3a2VwN0xscS9WUHhWV0hLSXhXNlZ0eDFTRW5qRllwSnFnTGNkVWhhNHhXYWJUUktuMzZGd013V3FYL1piUkszelphcGFmR094bFhIWUtFT2huTU5qbFNXMVZJYXc5RFVyTUNwdnBReEZXSGVJTzZhTFJLMThaVmgvelB6d2FncnhBL1k3UktPYU5WZXAzdmpOa21SM1pQSkJZUEdmRHFMck5mNVE4YmtkTWZoV1M3Y2p6WXFLRks4cGErUXZ4dmp4VENVQ1ZKTjFSSnpoaXFKREJVU1pCUUowTjJyOVA1bDNjbWVHakp6bmczK2FxVDB4OEZVMzBvU0wrR0tzbDVvMVU2LzZFL1IvcHk4VC9IVmtwcVlpc2xpSzJVd0dpVklxczdBdm5EUmplbjhvYjBXRENneFR5SEdqbjlVWmpWTjlsTk9mMVJ5T21Qd254SE5QS0c5QjV3MlQyUmlLc09BYkVUV3lucE5OV0gvdlpodllXZWphMlVPRWpucWEwcTZzU1NuZkhJSHpaaXdZRFdxK01QRW9GYVBHU2cvUzBlTWlCOWN4Z2Y1b0MrUXZ6Y1QzMGUvaFJiS1RtbXJ4QkRYeUZHZGsra0IwQjJiK1JEMFhpZ25QNG94RlpLNExKOU5yWlNFdnFqSUdJckpYK01yWlI4cDY4UXcyaVZZcDVEVFkza0R1b3dxMjh5c25zaVBaVDcvZ3dNbk42Q2l2MEZYcS83MDZ5K3lWZ3dvS1YyNWp1aUVWY2RBbjJGR0xHVmttdjZDckhvaDc1YWY2T3ZFTzhuRUxtRE91UVBHNUUvYk1ROGh4cFozUkUrdGNTUkFGS0d6M1JoUVo4VzJkc2lxTEtJL1BTUjB4K0Z4VU1HNUE4YnNYQndCdUpyWlNReVgrcEtnNTZkRU1SemltZWYwcGVMVy9YbHp0dHBua09OeFVNRzVBM3BNYXR2c2w4SHNyb2o4SklqQWFOM2IxR1lreU5Ic1hRbzdZSHR4bXRXMzJUa0RlbXhlTWlBQlFOYTUyMVdMb2ErWEx4alFqK2crbkp4b2FzQi9WM0lHOUlqdXpmeXdRNTBSZUNsZm5jUUFMZzZlaG1sZS9LUTFSM3Uwc1Jnc25zaktVeE9meFFCZ2I1Qy9MWmZDRjFwMFBNeFpjRjNZc3FDa2RZZWhyd2hQZktHOU1qcGowSm1WNFJYWlkxVHZoY1FBTGh6N3piVzdDOUNabGM0VDJQdGZQVlBJcE0zcEVkYWV4aGl5b0lSVXhaOE42WXNlSksvYUd5S0tRdUcwU3FsamVjNTFENk5aRzcxVlA3NzNrRUE0RDd1dy9ySmNtUnVEUjhuM3lDWlhjNW5odmdUWHl0RFRGa3c5T1hpTGI2aUVhWXJEWUt1TkFqWlBjNlE1Zzdxa05FWjdpbmllS2VuOG5mRXU0SDBuckNqODFnREx0MDhEd0FZdlhzTHl3YlN2ZmZyUndzR3RQUTVKWDdxU29PbWVBUFpwU3NOUWtLZERBc0haMkRoNEF4azkwUWlmWE9ZbXpLMmhIdXFjK3p2aS92Y1FaWU5wQ05qU3pnV2JUZmcwL083QVFCZHgyMWUrMG5mRXU1aGp5aXJPNEw2WmFvUEpTQWZQYWQ0OWlrK1JBaWh6T21Qd3NMQkdaam5VSHZ2dENNTTZSM2hTTzhJUndiUkZ0OGdydy9OUVVhSHMxM04vamNCQUZVZkwzZjFNMDZiL1l2NGx0TWZ4WStLaWcveWhxNDBpUDVtNUE3cWtOa1ZnYlQyTUE5NWdvVzdLVys3TzBqUjBCeGF0L1NEZkZpRzU3dTFiLzI4R2hWN0M1QzJPY3lyUGI0eXV5S29mMGFyRkxyU0lFeGZHYmlTZ2t4ZkdYaGsrc3BBSk51VnlCM1VZWjVEN2RsUm14Y29EN0J3NVBXNmd4UTRNcEh1dzhuMHpSSDQ1dXBKQU1DcTNhODViYlNweHVTbHpUeUhHcm1ET3FTMWgySDZ5a0JNWHhuNEJZbUdjTnFLUUV4YkVZaWMvaWprRHVxUTNST0oxRmFWVnptTmVRZExhdzlEWG04ODd0eTdUVUUySGw3alBoZzgvWDMzVWxydjlyMVJsSDM0cWsrN1JOazlrY2dkMUNHblB3ckViMTFwa0ZDZ0xSRXRucllpRUxHVkVpd1kwR0xCZ0JhcHJTb2syNVZVS1p0VVNObWtRdW9tUDFBdUxkeG13TWpvWmR5NWQ1c0NmWGk2RDNNN05VaHRHMnM3dDNNYUx0NDQ1L0dLWHJ2dkRhUzY3S1ZzY3ZjajJhNUVhcXVLK21tb2toQ1lKUUp0aVdpVnRrUUVVMzBvNWp1aU1jK2g5bWljc2xHSmxJMHFwd2lRRnpDaTNDNDlGbTJMdytLZWVMeXlQUW1OQjh2UmVMQjhyTTRtRmRvTzExRG5teit0Uk9kUkcvMTM3Y2Nya2JKUmllU05TZzlma3UxS092MDMxWWRDV3lLQ3RrUzBXcUF0RVczU2xvaGd0c2t4M3hGTmw2QWVNT09CTnFxUXV0RWRLcXY5QmN6cDBDQ2pMZElkZHBNS2N6bzBZeU85VVlVekkxOEJBQTZlMiszcVQ0bVN3UmR4ZGZTeTg4MjI1M1d2ZnZCQnpEWTV0Q1VpYUN5aXpRS05SYlJiV3lKQ2Fxc0s4eDNSeU82SjlObUJHNVJkaFJTN0NzdjZzckRsU0FPT1hOaVA4OWZQNHNxdDczSHh4am1jdnZJbGhrNTJvK2FqRlhoeGE2emJBS1JzVktIbm1CMEE4UFdWNDhqdk5pSFpyc1RjRHZmYnpaZjk3QjduK2lXMVZVVWlzaytnTFJGOW83R0lrTDQ1akU3UlBScHY4TlQvN1ppTjNhZmZ4LzM3OS9DZ2NuWDBDdnFPdCtMbG5pU2t1UHBNczRkajQyZHJBUUEzYmw5RCsrRjFPSFBsQkcxei9QdERTTnJnSFNTeks0TCt6bWtzSW1nc29yTUNqVVUwb3JHSWtORVpUdWRWU2MwSzcycFJJS2Q5R3JaOTBUSWhnUEhsMXAwYmFEdFVpNXgyRFpKYmxFaHVVY0xpZUJHWGIxNmdkVzdjdmdiN3AydVFiby8wNlFjQnllZ01KeUFqQW8xRjlKbkc0cnkxU0VUTU5ybWJaallwTUxOSmdhSWQ4M0QyNmltdms4RnZyMzZOejg3dHhRZW50bVBYcVY3c1BlM0FsOThmeHMwNzF6M3Fmek55RWx6ZmJDUTFLNUhVck1UOHpUSG9QdHFNcnFOTldMdzFrZHFiMmFUdzhNVnNreU9yMndtUzJxb2lJSWNFR291b1UyTnhQdXpqUWJJMnNNaTJxN0dvSXdFZGh4dHc5LzVkTjRlT25EK0FkZnZleGl2ZHFVaHZpVVJTazlLcDVqSGxkaGhRK1dFUjlwLzlBUGQ0VVJ5OWV3c3RCMWJqeFE0amtwb1VTT0k1UDdOUmdabU5jcGdiNVg1QnpEWTVBZWtXYUlxRkZacGlJZUpyWmNqcGowSjJUeVJ0OFBmaEFsd2JIZkVZMFVzM3pxTmlWNkhMb0FKSmpRb2tOU3JIMU9SZHIyM0x4TDdUQXg3OWZYUm1DQ2xOWVdNQU52L0s3b2xFVG44VWpGWXBOTVZDYUlxRlZvR21XUGl5cGxpSW1MSmdtbmVpdDVSTmdlbzliK0xDOVc5eDkvNWRYTHA1QVR1T3RlT3ZiWHJNdENuOHExRkpsVVQvN2dSLzA1R0hqODRNNGVTbEw3RDM5QUNXYjUrTG1UYmViZlNlU3o1QWlKOHhaY0VFWktrZ3VrZ1k2Zm9Ic251ZG1ZeGt1eEttK2xDcWpLWVhzS2c5QVZrdDZqRWo3OG1SMGZ3QzNoMzhHMTdabW9yTWxpbElzcWt3ODcweG1OU21DUHkxVFkrM0hDK2g3MWdiMXU5N0J5bE40UjdRWnB2Q3JWOVRnOXpOUGwvSmRxVXpnOU1iU1NDZ0tSWk9FK2dyeEU5cmlvV1hOY1ZDV2lteks4Sm5SNmI2VUpnYjVEQTN5REhUcHNRN2czL0R1YXVuY2ZQT0Rad2RPWVV2em4rS28rY1A0dGlGejNEeCtqblgyK29tV3ZaWElhMHh3Z25xMGl5N0JoK2ZHY2JCczd2eGV0OENtQnZrTURXRStyVk5sci9KZGlXQnVHNm9rdnlMUUNBUUNLS0xoSFpOc1JDR0tnbE5Na3dFaEdqdVJoM3NCOWJnd3ZWdjNlNzlNMWUrZ3YzQVdpeG8xY1Bjb0hCVGV0TUxPSFR1STdmNi9jYzdrTlhNK3JXZDNlTk02Qm1xSkFTa2cwN2pvNHVFMmRGRlFtZ3NJcHI1STlzQVhrSHE1VEM1Wk9ZcDFSYU9SZTBKZUxVekhibXRjWmhacjRTNVh1R3VCZ1V5bXFLdzUydUg4MVY4NVNSV0RTN0QzcThIQVFBbkxuNk9oZTN4WHUwbU5TdW9meHFMQ05GRlFreGRIakNIZ2t4ZEh2RDdxY3NEN2s5ZEhrQ25BR250WVg1SHhyUmUvZ0FwWUZxdmdKbW5tUTBxbU9zVnNPNnkwTXpLa2kycE1OYzdCKzM0aFVNQWdJSGpXNzNhek9nTXAxT29xY3NETUhWNXdEMU5zZkFQYm12MjZDTGhWblZoQUdMS2dwSGRNM1o3SmRUSnZDcHhYU2hNNitSZVpWNm5RSVp0Q25KYWRKaHZqMFZSendKcys5eU9OYnRLWUY2dndMS3VXYmlQKzdoMy94NHFob3VRdUU2TzF6cXpjSDMwS2tadVhVSmVtOG5ESHIydGVpS2hLdzJDdWpBQTZzS0Fkby9rZzdvd1FPZTY2RWJ1Q3lTaFRvYkV1bEFrMXNrOWxOT3N3N2NqcDNIcnpnM2N2WGVIVGs4V3RTYkN0RTRCMHpvRk5ueXlsa2FsWWU4cW5MOTJGZ0JRc24yUlYxdGtVWlcrT1l4QVFGMFlvUFlBaVM0Uy9oUExNU2RZanFIN0h4bWQ0WWl2bGZsVlFtMG9FbXBEa1ZnclI2THJ6L2tiOUJSZzlPNHQ3RG5wUUY2ckdZbTFjcGpxRkxUdXpoUGIzUjcyNmc5VytyUkRzbzlHcXhRc3gwQmRHSERJWjRLTzVaaVhXWTZCcGxoSUc1SjlQMytLcjVFaHZrYUdoSnBRSk5TRVlsNnpIcmZ1M0FRQVdJY3RTS3lSVTVFNjhUVXl6R3JVNHNyTjc1M1B4YkV1bi8yVGFVbFdkd1NpaTRSZ09RWXN4OHozQ1RKbDZhVC9ZRG5tRnNzeE1OV0hJcXM3QXFtdHFnZUN4RldISUc1dENPTFh5aEMvVm9ZNXpURVVwS3gvR2VLclpVNjVyc2V0SFd1Mzg4UjJqTnk4aExTR0tUNzdUbXNQbzRQcWdyakNGa3o2amQvOEw4c3g2MW1Pd2ZTVmdjanFkcVlzNDJ0bEU5MXlSdHlhRU9RMHpxQWdxL281eEswSm9ScGZ2KzlJT3hwMmwvdnNMNkZ1N0xiU1dFUUVwT3lCMlhpV1l4U3V5a2kySzVIVjdWeWYvSUQ5Yy96RnBoc0RlYi9BYjkxRmRqTk0xVXFmMS9rK3VQeTZyeTRNK044SjdaR3dITE9QNVJqRWxBWFQzT3ZEQW5tekp4L0p0UkVUNmllK1ZrYnRUMThaU0VDNkpyeGp4WEpNRWo4cUdaM2hQeWdxL2tCYTlxMUIzK2Z0RStxSDJEYmI1QVFDTE1kTW1UQ0k2MVY4a09VWTZFcURhQ2JSYUpYeTk4Sjlhdlo3MDhjZTl2Y0wzSzRWZE9RQUFCWnVNUG50STc1V1J1MU9XMEdqc2VNSGI0YXlIR01nbzVEVXJFQmFleGpNTmpsLzI5aW5adGZ6UVBvSzNLNjkySndJQUdqY3M5cHZIOGwySmJWSi9GQVhCb1Q5cUoxZGxtUDJrS2lRdEtmUkt2MUpJRnpIWE9kTTkwaW56L2J4dFRKcVQxdEMzMVJiZi9RK084c3hHaklhWnB1Y2poRFpkL2VsV2V1blVaQjMrNWE1WFd2WjY1eWF0SDFTNzdNOXNjWDczWUM2TUVENmt3NE5zQnd6eUhJTXBxMElwQ2xQbzFYNm8wQU1sVktjdUhBVUFQRE85cVZlMnhxdFVtcUg5N3V4NlNjZjRXQTVKcEtNaXFrK0ZLbXRLbWRVeUE2ckY4MWF4d1BwWFViLzM3STFqNjRZcyt1MFh0dVNvMUVKZFRJQ2NVOWRHQ0I4S09kUldJN1p4bklNU0dvMXRWVUZRNVZrUWlCbDJ3dWdMeGRqOWpvZHZodHh6bkI3UDJ2MTJzNUhOR3dQN1hRUXl6RXliMUZ4YlJWN0tLdEdTMEVzbll1UllvM0NxWXRmQWdCR2JsNUdkczAwcisxSU5PS3FRd2pFWFpaam5uK29SNTFZam1sak9RWWFpNGptWUExVkV2NWVIbFdHVllQUk84NWRxOXFCZC9INU53Zm9WSDFGNXl0ZTJ4aXFKTFJmVFRHZDRkWTg5RU5uNnNJQUVjc3g5MW1PUVh5dGpLYU1mSUdRaU55K08wb2hQanplNzdXK3JqUUlacHNjeVhZbFhXK3dISE03dWtqNHgwZHlnbzdsR0J0WnIvaUxDaDlrTElGOUV6azErZ2RHZzdmZXFIaGtSd0Zaam5uZWRkL0NhSlhTVEl0clU1SXF2VXFEVzdmZFFXdzdWM3ZVSXlJWmt0aEtDWUc0T1dYcHBOOC8wbk9OTE1kVWs2aVFOTCsrUXV3WDVMc3IzeUJobGNvcmhLRktncVJtWjdxVUY0MjNIL2twVTVaai9wdmxtRkdXWTJDb2tzQnNrM3RFWlR4SVpaL0ZielRJSE00RmNXM0swa24vK2JNY21XVTVwcHpsR0VRWENXbGlXVjhocHR2RmFhdkhRRTU4ZHhSL0xnMmgxL2dpQTJHMnlURjFlUUFCZWVObk8vdXJLUmIranVXWUd5ekhJTFpTUWhOb3J2MDhwRlZFMDlmdjY2Mkw2UC96TlcxRklHMm5MeGNUaU10c3dhUi8vMWxQWXJNY3M0TGxHRXhkSHVEbWtMWkVoUFJLRFFCZzM0bWRtRllTNkJWRVh5Nm03ZFNGTkJvRlAvdVJjclpnMHJNc3g0eXdIRU9kU3FpVFFWc2lnbWxWSk40YlhnM1Rxa2l2RUdSZm4vd091U0F1YUN5aTN3cCtpY0p5VEtHdnFQZ1RINXdYalNXLzJFRi9kV0hBdjdJY2M1RXN2dmhSY2UzdGVVaGJJcUs1WEY1QzRleVVwWk9lK1VVL3V5RFpTWFZoQUhWUVh5NzJDZUlqR3JtLytQY2pVNVpPZW9ibG1HL0o0b3NrblRVV0VYOXJ6Q21MaUY3bkpSUk9zUVdUZnYxWWZBekRja3d1aVVwOHJkTlIza1lsbGI1Y2pJUTZHZUtxUS9qUitNdGo4MVVQV3pEcDF5ekhuT0pISmE0NnhBT0VmQ0REU3lnYzExZUlueFk4VG9YbG1Oa2tLaVJueTQ5S1RGa3dFdXBrL0drNldJNUpFenh1UlY4aGZwcmxtQy9Ja3BoOHFVTkF5Q2RMdkdnY2Z1SFZQLzFLOERnV2xtT1N5V2dicWlUMEFDVTUrR21va3ZDamtTaDRYSXNyMWZvcFdSS1B6K1h5RWdxZnVKM1hmVXlqWWlTalRqNWpJdGxKWGpUK0xIZ1NDc3N4ZThkSGhSZU5Ed1ZQU21FTEptbko2Sk9jRlM4YVV3VlBVbUU1Wm9nc2lYbnBIWWZnU1Nzc3gwem1SWUVvVXZBa0ZwWmplbmdRMndSUGFtRTVKcFFIRWlwNGtndkxNZTBzeDdRTG52VENja3dReXpGQmo5ck8vdzhBc1dmVFpjVkZ2YkVBQUFBQVNVVk9SSzVDWUlJPSc7CiAgdmFyIGljb25SZXNJbWFnZSA9ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJrQUFBQXBDQVlBQUFEQWs0TE9BQUFBQ1hCSVdYTUFBQXNUQUFBTEV3RUFtcHdZQUFBQUlHTklVazBBQUhvbEFBQ0Fnd0FBK2Y4QUFJRHBBQUIxTUFBQTZtQUFBRHFZQUFBWGI1SmZ4VVlBQUFySFNVUkJWSGphbk5WNVVKTm5Bc2Z4eDZXMTNkbk9idi9vdXJiVFZsdmJyaHk1Q1VlNFBRQ1BlclM2b3kzdFRyZmRFVWtBRlFHUkt3bFhDR2NTY25Db0lNU0RlaFVSclVmUmFoWGVKTytiaEpBZ1ZSU1VDaWhhUWNDaTNkLytrZFoxdWw2N3o4eG4zcGxuM25tK3p6UHp2dk1RUWtBSUFaa1oza21DbEY4U1hzNWVJcFEyRWIvc1pzSlhmMHZlUE5GRlJCbE5Ya0o1eXdmKzhwYjFRbGxMZ1ZEV3NqRWd2MlZGZUhrVFJ5UTdSa1E1aHdrLzZ5Q1pWN0dmQkNtL0lzTE1BeVE0czRWRVNFK1NjR2tySVkrTENLWE5SRmg0ek5lejVreEJZSFl6SThvN2NpZFVjZXorbktKdkVLbzQvbk5RL3BHeGdOeERUbjlwUzBtZ3ZFWDAvMFJtK21ZM1ZZbmtMVDh0S0Q2SkZUVVd4TlE3OEVsREoyS01Uc1EwZENLbTNvR1ZOVFFXcUU1RGxIdjRQaitqcVhhdVp2ODd6eFFSeVBlRkNyTys2b2tzYmNYcVdodGlqRTZzckhWZ1NZMGRpNnR0V0Z4dHg1SWFPNVp0N2NES1dnZGlHcHo0cU02T3FOSlQ4SmQ5ZFVVb2I0b1NaajB1RXVZa1FZcmR5LzJrVFNOTGRPY1FZM1JoMlRZSG9neFd6TmRiRVdXd1lrR2xGUXVyYkZoVWJjZWlhanVpRGU3NXBWczZFR04wWWFtdURYN1pUZVBDekgwZkJXVWUvay9FNDRWSjR2SENKSGx6Ym9lZktILzNqOHNORkZiWHV4QmRhY004blJYemRlNUk1QytoNkVvYkZsVGFFRzJ3SVZKdnhUd2RnN2xhQnRHVk5xeXVkMkc1d1FSaDV2NDdvc3lXNEFocEt3bVhueUJFc09FZ0VXdzQrRWQrNm43blF2VnByTnJ1aExWL0ZKZUdKM0IrY0F6bkI4ZlFQVFFPNThBWWtwc3VJRXB2Uld4akY2eFhSL0g5OWZFSDcvUU1UOEE1TUlaVjI1MVlxRDREMy9TOTNRRVorLzhrVEc0bVJKaStod2pTZDZlSEZiUmdWWjBUVVFZYkx0K2NRUHplYm54Uzc4Um5PN3J3angxZGlLbDNRdnhsTjlvdTMwWnkwd1dzM3U3QTV6dTY4TmtPRno0MU92SDVUaGRjQTJPSTFGdXhxcTRUNFlvV3NKTU9aSGxNdlVlSWNQT2VQL3R1Ymh4Y3BqZGhTYlVENFJvR3JvRXgvTjNvZ3JsdkJEMDNKbkR4eGpoNmhpZlEvK05kRkozb3hhVWJFN2c4L012OGpRblkrKy9nazNvbnFONFJoS2tadkYvdHdES0RDZnpVdmRkZkMrMllUdmhwTzJPQzVVMVlzZFdCQ0EyRFVEVUQ1N1V4eE80K2o1R0orNmcrOXdQeWovWkNlYndYWDd1R2NkUTFqTmJ1VzFDZTZFUCswVjZvVDE3RnhPVFBpRzA4RDZwM0JLRnFCaEVhQml1Mk9oQ1NjeEJDYWQybmhKOWlySThzYnNXU2FnZUN5Mm1FcUJnNEI4Ynd4YzR1akV6Y1I0TnBBR0ZxQm1FcUJwRmFLM2FhQi9GQlRRZENWVFJDeTJrWXp2VGo3cjJmOFZtREMrMlhieU5VUlNPa25NYVNhZ2VpU2xyQlR6VTJFSDZLc1cyUitpeWk5QjBRbGRJSUtXZHdmbWdjeTJzYzJOUjBFVGZINzRHNU1vcVZXeHdJS2FNUlVrWWpxSXpHMHFvT25PMjVqZEc3OTVGMTZCTEMxQXdzZmFNSUxxTVJWRW9qU3RlQlJacHo0S2NZS1NKSU1WNWVyS1V3dDhLRzRESjNwSHRvSEN1M09CQmF6dURqdWs0NEI4WXdPUElUR3VraE1GZEhjY2h4QTFkdTNVWDMwRGhpdGpzUlVHeEJoTW9LeTVWUmlFcHBpRXBvekttd1liR1dnaURGMkVzRXlRMzlDeXNvUk9yc2lGQmJFYTYyb250b0hDdCsyWGxRS1kxd0ZZTmRsa0U4UEE3WXJ5T3NuSUZRYVlGZmtRWGhLZ2FXdmhFRWxsZ1FVR3hCdU5xS1JSVVVCTWtOL1lTWFZFdEZsWDJIUlpXZGlLeXdJMExsam54WTQwQlFLUTFSTVkzQVlndjhpeXc0YUw4QkFEam11Z2wvcFFWOGhSa0NoUmxDcFFXaDVlNklYNUU3T2tkalEzVFpkK0J0cURVUjdycXFYUkVGeDdHMHVndlJ1ZzVFcUJoMEQ0NWplVlVIQW9vc0NDaXl3RTlwUVhnWmc3Wkx0d0VBekpWUnpGTlp3Y3MzZzEvZ0RvV1VNakQzalVCWVpJR3Ywb0w1V2dmbUtJNkRtMWl6aHdpVFN5VUI2ZnZ4dnNHQmFKMEQ0U29ydWdmSHNNeGdoNy9TREtIU0JGK0ZHZndDRTliditSNEFrTlY4Q1p3OEU3aDVKbmRJWVVad0tRMXozd2g4bFJZSWxSWXMxSFVnTUdNZi9KSnJFZ2x2bmNHVHY2RjJNbHB0UWJTdUUyRXFLODRQanVGOW5RMitDaE1FQlNidzhpaHc4eWhJZG5jREFEWWY2QUVyaHdJNzF3Uk92aG5jQWpORUpUVE12U1BnS2N3UWxUQllvREdEdDJIYkpIdmRGbS9pczE0M3hTZGVlelFzN3lpaXRKMFFGVFBvR2hqRFFxME4vSHdUVnRWMFFuYm9FdFkxZm8vRVJ2ZEowZzcwd0VkT2daVnJBanZYQkhhZUdZSEZORXk5SStEbW16RlgwNEd3dksvQmx1aVBzQk5ycHBDcFdUTHlhbExSYXY4a0l5STFOZ2dVRnJnR3hqQmZiUU1uejRUYWM5Y0FBQ2U2Ym1HdDBYMlN0UDA5OEpaUjdsQ09PK2FucEVGZEhvRkFZVUdVeGdiQnhucXc0dlFmY2lTVmhIQmk5WVFicTMrSkxkWmRqQ2c4QlZHSkRSZXVqeU80aElGUGpnbDFiUU80Tlg0UFNYc3VRSCtxSHdDUXV1OGl2R1FVdkdVVXZPVVVmT1R1MDFpdmpDSzQxSVlJeFVtd3hGcVhkNXoyUmU4NExTRjhzWUh3eFFiQ1dhdVYrYWMxWXE3YWpyTTl0OUZBRGNJN3g0U2NsbDc4ZGlUdnZRaFBHZVVPeVNsNHlTbG9XcS9DM244SGM5VjJDRGZ0QWx0Y2tjcE5NQkJ1Z29HUWFhbEZaRnBxRWZsTGN0RU1WcngrT0VKNUZndTBEdEI5bzlodEdZS1gzSVNHZHZlUGVIUHNIZ0FnWmQ5REVSbUZxak0vNE1MUU9GYlV1QkJlZUJwc3NmNGFXNktmenBib0NWdWlKNFJJcFlSSXBjUWpXMGE4eE9vQ3YwMk5pQ2l6dzcrUXhxbnVIOUhjTVF3ZnVRbjVoM3NoYTc3ODRPdnlsRkx3bEZMWVlScUU5ZW9kekNtM1lVNlpEYjZwdThDT3E4amdTdlRrVjhRblh2Y0FSNng3bFMzV0RZWXF2b1d3a0FFcng0d1d4ekNPZDkyQ2w0ekNpcXBPVE43L0Y5WVl1ekZiU21FZmN4MXRQYmZoWDBqRHI5Q0trUHhUWUVsMFYxZ0p1bGRZQ1RyeUs4SVdHeDVnaVEzRVoyMUZsbS9LTG9TVzJ1QXBOZUc5YkFwNzZPdG92elFDLzBJYVMvVU9jUFBNT05KNUV5ZTZib0dkWTRhbnpJVFFVaXNFeVR2QUVsZHNaQ2ZveWNNSU4wNzdXNit3eGJxcndYbW5JQ2l3WWxaR085N05vckQxN0FBc2ZhT0kxblRnbU9zVzlqSFg0U2t6WVZabU8zd1ZWZ1RsbmdSYnJPdmhTQ3BmNWtpcXlNTUlTMUw1MytLMHlZTGtIUWd1c3VLOWJBcXpNdG94SzZNZHFtL2N0K0MyczljZXpQMDFtMEpJa1JYOGpVYXdKZHA0YnFLZS9CYmhpS3Nlb2ZKbGxsamJFeWh2QlMvUGlwbWIyL0YyZWp1OHBDWW9qdlNCbjJmQjIrbnRtTG01SGJ4OEt3TGwzNEFkcHozUFdhdC9pYk5XVDM2TDhNVGFSK0xHYWNTOEpDTkVoVmE4azBGaFpwcDcwUWZTMnZGdXBna2lKUU5lVWozWWF5dit5WTdWazBjaC9FVEQ0L3lCSmRaMStVdFBnSlBENEkxTmJaaVIxb1kzMDl6UE56YTFnWlBMd0QvN09GaGlyWU1WcC91OVQ1eWVQQXJ4a2xROGxuZWM1blBlaHUzd0s2RHgxbVlLcjZlNkYzODl0UTF2cFZQd0w2REJXMThINzBUOXA3T1R0NURaRzJzZWlmaEpOSThsbEdoZTVNUlYyUHl5am9FbFovQmFTaHRlVDJuRGF5bHRZTWtaQ0xPT2doV25wWGxyS3FmeTFsU1N4eUg4TllZbjRzVHFQdUtzcjRNd3o0SVpteWhNMzNnT005SW9DSFBONEs2dmhWZDgrZC9lUzFDUkp5R3pFMVJQOHp4SHJESDVabndOTHltTmFVbG40U1dsd1U4L0FsNjh1aTBpTS9lNWlDdzVlUklpeXBZOVVaQTBtd2lTbGN0WkNYWGd5azJZbFc0R1YyNkN6L3F0Q1BtNGZ1a0h5L2VTcFIvdWVTSXlSWjcxVkI1U21ZZTNSSE9hdCtrdytIa084TktiNGYxRjFhbm5ucC8wOENBZ3Yzc0tNaTI1K0ttbWJ5d2hMTEYyQVNkeEc3aFozNEd6Ymd1OFl5dWpwL2xUNUJWZnkxTVJYbHpsVTNIakRJUXQxazloUy9USDJJbmJ3QmJyai9xSURWTTRHMVRrV1JCMnZPNlpjZUoxODloaTdTUmJvcC8zNjRYMExBZ3IzdkMvbU1xS04zekJpdGRQWmNYcnliUDY5d0NQdkw0RHQyamx6QUFBQUFCSlJVNUVya0pnZ2c9PSc7CiAgdmFyIGljb25SZXNSZXRJbWFnZSA9ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQURJQUFBQlNDQVlBQUFBV3k0ZnJBQUFBQ1hCSVdYTUFBQXNUQUFBTEV3RUFtcHdZQUFBQUlHTklVazBBQUhvbEFBQ0Fnd0FBK2Y4QUFJRHBBQUIxTUFBQTZtQUFBRHFZQUFBWGI1SmZ4VVlBQUJjQ1NVUkJWSGphM0p0M1VCeFhuc2ZaUGRmZDFkYnUxVjN0MWRYdWV1M2R2ZlVxUWsrQ21TRUhFWVd5TGRrS2xxOXFiNzNlWlVBSmdaQUlRODVwZ09tWmdRRUVDQ3VCTWtpeUxWdkJFa3pxN2duSWttVkpscFd0aUJLU2dPLzkwWUVaUUxMc2xkTk4xYmNhWmw3NGZkN3Y5L3E5ZnYyZUZ3Q3Yvdzk2N2dYSzh2ZitPaUNuMjg4L3IzdXVNcTg3U1pIYlhhTEkyVnVweU4yN1NwbXpkNEYvM3I0QXY3eDlMODNmdlBtZmZsQWdYc0JQRkhsZFNtVnVWNWt5ci91TU1yY2J6NmhyeXJ6dWVrVnVWM1NZK3NNWHZqZVFRUFgrM3lpejkxUW9jN3JPS1hPNjRDNy8zRzRFRmV4SGVPa0JSRmNkUWt6VklVU1Vmb2lRb3ZjUWtOdU4wZW1WT1YzWGxibDdHZ0p5dS83NG5ZSEkxTHQrSnMvZGs2WEkyWE5Qa2JNSHZNSkxEMkEyMll2RnJRNzh6N3ZIbjZvMzI1eVlhekFqc3VJaitPZDJ3YTJjaDRyczNXVmk5YlovLzFaQjVObTczMUprNzc2Z3lONE5SZlp1QkJYc3hXeGRMNWEwT3ZGVysvRXhXdHJlaHlVYldDMXQ3eHMzelpzYlhKaXJOeU9rY0QvNGNoWFp1NzlVWk85SitEcjk2SmtTVFZWdi9tZUZlbGVqUXIwTEN2VXUrR2Z2d2N6YW8xamE1c0piRy9vRUxXeHhZbDZqSGJNYUdNUWJHTVRwYVEvRkd4ak1yR2N3MTJqSEcrdWRXT3FXOTYwTmZaaE45aUFndHd0OFBRcjFyajJCeFR0KzhWeEE1QVdkdjFTb2R4NVVxSGRDb2Q2SjZNcURXTnppd05JTmZWaTZvUStMMjF5WTIyakhkQU9EV0QwdGFFWTl3OG1PR2ZWMnpHeXdZMWFESGJPTkRzdzJPaENycHhGbm9ESEhhTWVpVnBkUTNwSldKK0txRDRPdlQ2SGVaWmVwZDczOEQ0SEkxTHNteWRXN1RzbXpka0tldFJNenRUMTRjME1mM3R6UWh5VnRMc3h0ZENCV1J5UEdUVHhJbko1R25JSEJkQVByblhnT2lGYzg5ejJmYjQ3UmpzV3RMcUg4ZVhvTGxPcGQ0T3ErNUt2ZUpmOUdJRXIxdHQvTDFUdXV5ck4yd0Q5bk4xNXRzQXJ4L2xxekU3RjZCdEU2MmxNa3F4Z2RqVmdkalZnOWd6ZzlDK01oUFlOWS9RZ0VuejlHVDJOZWswT29aNzZSUWtEdUhzaXpka0N1M25IWFAyTzd6OWNDQ1ZOdi9yazhjenNqejl5T2dKdzllS09Kd1pLMlBpeHA2OFBzQnJ0Z3NMdWlPSTJHaWVOaE9NVzVRUWo1dEo1bHphcTNZMGtyVzk4YnpYWUU1blZCbnJrZDhzenRwK1ZwbmI5OEpoQXZML3hFbnJGdG16eGpHNVJaMnpHL2djS1MxajRzYW5FaFhzOGdTa3MvV1c0d01TVG5GUjJOV0IyRE9FNnhPb1lOUnk1dHBKYkNOQzJGU0MzbFVkWjBQWU9GTFM0c2FlM0RBaU1OLzZ5ZGtHZHNnenlqODhCNEErZ1lFTCtNem15L2pFNzRaWFJpRnRtTHhhMHVMR3B4NGVpWlcvanMybjJjdWY3Z2lUckw2WXViQTNCZHVvdkVqcE9JNGFBV3Q3cHc1UFF0bkw4MUlLUTcrNVN5UHJ0Mkg0NkxkN0dveFlYRnJTN00wWnZBMnlYUDdLeDRLb2c4clhPQ1gzckhZNy8wRHNSVUhzS2lGaFlpM3NEZ1V2OURBTURROERBZUR6MVpnMFBEdUhqN0lWSjNua0wwcUpCWjJ0WUg2dndkREE0OXZZekhROE1BZ0lISFE1aXVad1E3WXFzT3d5KzlBMzdwSFlQSzlNN0pUd1R4eStqbzlFdnZRRkR1Yml4c2NXSmhpd3V6R3V5SXFLTnc0ZFlBQmg0UDRjL3R4ekcveVluNVRVNHNhT2Jsd3V1YzNtaDJJVjV2RjBKRWMrZzhPcGlyaUhZTG00WHIrZlR1WlRneDMrM0tYTGlEUjRQRGlLaWpNS1Blam9VdExpeHNjU0U0cnd0KzZSM3d6ZWpZUFM2SWIxcEhvTys2cmZCZHR4V3pTUk1Xcm5kaGZxTVRFYlZzN0Y2NDlSQVBIZzBoM21CSFJDM2xvV204NmtZVVM5TFlaTHNDL3RONzlqWmViM1lpc3M0ejNiUlJaZkV5Zlg0Ymo0ZUdoZjlmYlhSZzRYb1g1dWpNNE8yVXBuZEdqQUh4Vzd2NW1PL2FMUWpKNjhZYlhNdkdhQm1FMTFDWVZqc0NNc05neHd5REhVZE8zNExsWFArNE1wL3J4Nmt2N3dNQURweThnVGJ6WlFEQTFUdVBZSDVDSGw1TDIvb1FYa1BCL0hrL0hnOE5JN3lHUW5nTjI1aThYYUg1KytDN2RndDgxMjJ4ZVhuaEp3S0lmTjFXWDkrMW0rRzdkalBtR1d4NHZkbUZPUTBPaE5WUWlLaWxFVjVENDhLdEFkWWplZ1p6R3h3WUhzWlhmbnJPM2taRURZV0lHZ290cGt0NGxzL2ZOcDlBbUJ0SVdBMGxhSGE5QTY4M3V6RFBRSUczMTIvZGxnQUJSTFoyVTRGdjJpWUU1ZXpDZ2lZWEZqUzVFRkZMSTFUREZoQ3FvY2FBM0hzNEJBQmdMdHpCQnlkdmpOR3BMKy9qMGVBdzBuZWZ4cHV0ZmJqUy94QTM3ei9HZ1pNMzhjR0pHeDdxT1hNYmZMdjhkZE1KaEdvb21EaVFVQTBsS0tLV0Z1d0x6dDBOMzdSTmtLVnRLaDBCU2R0NFFwYTJFZEVWSDJGQmt4TnpHdXdJMWRnUVZrTWhSTU9LQjVrK0NpUng2MG1FYWFneG1sM3Z3UEhMOXdBQXR4ODhSdi9BSVA2eThST0VhbXdJcmZiVUxJTWRRNXlMMzk1NEFpSFZOamNRbTRmbU5OaXhvTW1KMk1wRGtLVnRoQ3h0NDZjQXZMeDgxMjcwbHEzWkNObWFqWmhyb0RDLzBZbFlra1pJdFEwaDFSU0NxeW1FVkx1QjZCak1xWGRnNERFTFVuLzBJc0xjV2kyMG12SXc4TXkxQnhnY0drYkM1aE5jbWFOVVpVUCt2clBnN3JqNDY2WVRDSFlER1owK2xxUXh2OUdKZVFZS3ZOMithemQ2ZThuV3RLK1NwYjZMZ0t6dG1HOTBZcjdSaWRCcUNzRlZOa0dlSUhiTTFOdHgrOEZqSWE1MzJMOUVqSlpCNkNnRFE2cHNtRzkwSW1IekNZL3llSVZwS0xTWUxndmxEQTBQNDgzV1BnUlZqWUFFVjN2bUNhMm1CRHNEMWRzaFMzMFh2cW50S1Y2eTFIYU5MTFVkb1FWNzhaclJpVG4xRGdSVjJUd1U3QVl5eStCQXFJYUNhc3RKbkwzK1FERENlZkV1M21ydFE4aG9neXR0Q0JwSHJ4bWQ2RGw3VzhoL3VmOGhWbTA3aGNCS0d3SXJiZWpsUUViYkVsUmx3K3g2QjE0ek9oRld1QSt5MUhaSVU5dDFYdExVOWs1cHlnWkVscnlQMTR4T3pOVGJQU3V0c2lHa2FnUmtwdDdCaFErRldRWUgzajl4UXpEbTF2M0h5TzArTzhib3dBcFByZXc0aGN2Y1RBRUFUR2Y3TWEvQmlZQUttNkRlc3l3SUQrWmUza3k5SGE4Wm5ZZ3MrUURTbEEyUXJ0NncwMHU2dXMwa1RXbERkTVVodkdwMElvNWtFRmpKdG1aUUZZWGdLbXBja0JEdSsrQXFHMm9QblJlbUZRQ3cyWFlWOGFRZDcydzhnUTc2S3ZZZHY0NkNmV2Z4ZXFNVHVpTVhQTkkyOTF4Q1NKVU4vdVZXVGpiNHU0UHdEVkE1b2ppU3dhdEdKNklyRGtHYTBnWnBTcHZWUzVyU2VsRzZ1aFZ4MVVjeHI4R0o2RG9HQVJVMndkQ1FLcy9PUGxQbkdJR29IQW1kcEswbmNmN21nSWQzUm44ZURZNEFYTHY3Q0d0MmZBWkZtUlhLTXF0d1ZYSkF2V2Zaa2QzZFM3eWlhaG5NYTNBaXJ2b29wS3RiSVYzZGVzbExtdHphTDAxdXhYUk5EK2JXT3hCWlEyTmFMWU13RFkyd2FocWgxVFJDM1VCbWNDQkM3THVGVEx6T2p2Yy91ZkdWZzU3cGJEOWViWEJDWG1yMWtLSjBCS2puREFzeTRxa1JUYXVoTWJmZWdlbWFIa2lUV3lGTmJ1MzNraVMzdUNUSkxZaXFPSVE1OVE1RTF6R0lyck5qV2cyRGlCb0c0UnlRTzhnWWlISWJBdmlLeXF3d0hMbjRSSWl0MUZVb3kyendLN0d5S21hdjhoSTNJRGNRcFp1bmVFWFYwWmhUNzBCVXhTRklrbHNnU1c3cDg1SWtyOThqV2JVZUVVWHZZNDdCZ2RnNkJyR2tnNE9oRWFHaEVlNEdFay9hV1JBT0lvQ0g0Q3NzWmY5dU0xM0dxYXYzQllDTHR4NmlnN3FLU0EwTjMySUxaRVdzZkl0WjhXQThEQStpY0E4N1RyRjFET1lZSElnb2VoK1NWZXNoV2JWK3I1ZGtaYk5Xc3JJWndYbGRtRzF3SUo2MFk3ck9pVml0QTVFMURLWnBhSVM3aFZhODFzNUN1QUg0Y3dBS1R2NWxWcnh1ZEdLWDQ1cEhPTDF1ZENHZ3pBWlprUVZTVHJJaUMyUWNqQy92cFpJUkVIY3Y4WnBPMmpIYjRFQndUaGNrSzVzaFhibmU0Q1ZaMlpRcVdka0VaWG9IWnVrZG1LVjNZSWJlaFRqU2lhaGFPeUtxcVRFZ2dlWFdFUytVamtESVN5eVFsMWdRVThzOE1iVGViRDRPYWFFRjBrSUxKSVZ1TUlKM3JQQjFBL0VyOWZTVW90UXEyS2xNNzRCa1pSTWtLeHJUdlNUTEdrTEVLeG9oV2RtRUdWb2FzM1FPek5DNU1KMTBJWm9EQ1hPNy9VNnZZeERnNFFVTEZCeUFYekdya0FvS2JhYkwrSVNiYXdIQStac0QyR3k3aXRoYU95UUZsaEZ4VUo3ZXNlSVlEMUppOWZCVVVBV0ZXVG9IWnBJTUpDdWJJRjdSQ01seVk1eFhtRnI5Z25oRjR5M3hpa1pFbGgzR0xKMEQ4YVNUQmFseklFSkRJN1RTaHZNM1daQzRPZ2IrcFJZb3h3SHdMYkpBVm1TR3JOQU1hYUVaOVc2ZGZtL2ZkWWdMeklKRStlejFTVEE4aUR1RVg0a1ZrVFVNWnVrY2lDdzdEUEdLUm9oWE5ONExVemY5cXhjQUw5RUs0MWJ4Y2lPQzFMc3hrN1JqdXRhT09OTEpnVEFlSUxHMU5KUWxIRVN4Qlg3Rlp2Z1dtVDBBcEFWbVNBck1hRDQyOGd6eS9pYzNJTW8zajVHNHdBSXhCOE9IbXJSb0JFVG9QNXltYSsyWVNkb1JwTjRGOFhJanhDdU11NFJwdkdTWjhjL2laUTJRSnJkaUJtbkhETktPT0swVDBYVk9SR2dZaEZSU09IOXpBUGNmRFNHNmhvSzgyQXg1c1JsK1JSd0VCeURoQU1RRlpvanp6V2h5QnpsK0EwU2VHVVNlR1Q3YzlXa3d4MDZQZ1BEeUw3Y0o5a21UV3lCZTFnQkprdkVkQVVTMGdueFJ0S3grV0xTc0hwSGxSeEd2dFNPMnpvR29XZ2ZDcWhrRVZZeUFSR2tvVDRBQ015UUZKa2p5VFJEbm15REtOMEdVWndLUlowTGowWkhRZXUvNERmamttdUdUYTJJMUNrYkV3WWc1R0I1RTZuYUhtNmFoRWErMVkxcjV4eEF0cTRkb1dmMlE5OHJHbHp5ZTJjWExERjJpSkFPVTZaMXNhTlhaTVUxalIwZ2xnNEN5RVpCcDFSUjhDOTBoekJEekVCd0FrY2NhT3hyRU84ZkVhaFFNTVE3TVVRNkU5NUtzeUlycFdqYnNGZXM2SUVveVFKeG8yREZtOFVHY3FJOFhKZWtoU2pJZ1ZzTm1DcXFnRUZoT1FWRml3eGNjU0hnVkpRQklDc3dJS2JkaHIrczZEcDY4aVlNbmIrS2premV4d1hRWjNqa21OQnp4QkptYWJjTFVwOEFRYmpDalFVSXFLVXpYMmhGVGJZRW95UUJSa2g2U1JFUGtHQkF2dGZxblJLTHVESkdvUTFCT04rTHE3SWpTTUJBWFdPQmJaQlZBUWlzcGlQUFpQaURLTjJOYUZZM0JJYytWaUF1M0htSnF0Z21HdzI0Z2ZSekllREM1WEwvSk40UEl0MERrQmlMbWJ0TXhOV3lVQktqM2dFalVnVkRwKzU2NFFPZVRvRXNsVkRwSVZqU3pVNVU2TytRbE5vZ0tMRGgzZ3dVSnFhRFlDcm1XREt1azBmOWdFQUJ3WjJBUUo2L2N4M3Q5TnpBbDJ3VDlLSkFwUE1nb0dHODNHQlpvQkVSVVlJR3kxSWJZT2p0aWFoaUlseGxCcUhUd1NkQW5QQkZFOXJiK1B3a1ZPVUNvU0lRVmZZU1lXZ2FobGF6aFBFaHdPU1ZVNkpOblJtakZDTWh1eDNWTVZwc0VhUTllR0FQQ2k0Y1pBVExEMnczbTQ4OVlFQ0xmaklncUdqRzFERUlLUGdDaEl1R2pJbTlQL1h2ZHo1KzZpRTBra2kyRWlvUmY2cnVJcVdFUW8yRWd6cmNJbmQyMzJBcnZQTE5RY1lnYnlPZlhCOURXZXdVYlRGZlFicnFDNDVkR1J2YjlmVGN3V1czeWhNa1pwZHlSY285K2RodURROE9RRlZwWU8yb1l5SkpiUWFoSUVBbGs5VmV1eGhPSldpV2hJa0dvU0V3cjcwRk1EWVBBTWh0T1gyT2Z6eXMrK0VLb2JHb3U2NUdIZzErOVdzZURUTTUrT3N5VUhCUGVhVCtCZXcrSE1QQ1lEZVdZR2diaHBSK0RzMnRZbktUNzB6Tzk2Q0ZVcEpWUWtWQ21iMGUwaGtHVWhzRTc3U2R4bTJ2NTVtT1hNWlVEa1JaWThmNG5ONThkWkpSWDNHR201SmlRdnVPMHNEUlV0Tzhjb2pVTW9qVU1mTmRzWVVFU3RkM1AvTWJLUjZWZFJLaElpQkoxQ0M4M0lVckRqaVdMbW83anhqMzJFWGF6OVNxOGM4eVltbU9HSk4rSy9YMDNuaGxrUEs5TXlUWWhyK3Vza0g3Tjl0TUlycUFRcFdFUVZuS005d1lJRlJueHpDQmVhdlZQQ1JYcElGUWtGT3M2RVZYTklMS2FBWkZud2Z4NmwvQnMza2w5Q1o5Y0M2WmtteUVydE9Ed3A3Y0FBSU5Ed3poKytSNnUzWDMwVENCVHNrMG8zUHU1OEU1a1ZjZG5rT1JiRUZYTklLcWFnVy9LSnE1djZBNTg3WmVob2dSeUx0OEs0YVc5aUt4aUVGQkNZVXEyR1RFYU96N2xudjQrUEhFVGZrVldUTTQyUVZKZ3djRlBiK0hCNHlGTVZwdEFIcm93UG9pN3NrM1FjZW42QndieHYyMG5NQ1hiak9BeUdwRlZERUtLaEw0QnNZb00vRWF2cHdrVmFTWlVKUHpTdG1KYUZZMXBWVFI4Y3MyWW5HMUNXQVVOK29zN0FBRHI1M2NRV0VwaGtwb2REeHFPWElSM2pua015Q1MxU2RCa3RRbmUyV1pzc1Y1bFh6bjBQOEpDWXg4bVo1c2d6cmNJOWNsUzJubVFybS84bmwya0ltUDQxZ2dwUG9xSVNocitKVGJCR0dXeERkWnpMQXoxeFIwRWxiRXdrN0pNbUpobHd2cGpJOHVoSDU2NGlZbFo3Rzg4Y0NmMUpRRGdTdjhqek5PN01EbWIvUzJ3bEVKRUpZMmdnc09DTjN5U3RMSi9hT2NEa2FnOVRLaEl5RkkzSWJ5U1JuZ2xEZTljTXlhcVRaaW9abHVQNytoOWwrNGhvcExCUkE3azdiWVR3dlNsK3NCNTRYdFJuZ1Y3WFd5ZWsxZnVJMHBqeDRRc3Rqd2l6eUxVSTBuZXdBK0FuZi93Rmc2ZkJGMEkzeXJCaFI4anZKSkdRQWtsR0RVeHk0U3BPV1pzbzc4VVZrdmk2eHlZa0dYQ2hDd1RWbXc1QmZMUVJVeFVzLy9MQ3Ewd25la0hBRGd1M0VWZ3FXZFpnYVVVd2l0cEJPWWY1TDB4UkNTUjNzOWxVNDJQU3JlUFVKR1FyWDRYWVJVMHdpcG9lT2VZTVNIVEpHaEt0aGxiclN6TTVkc1BNVmZuOHZoOVFxWUovc1VVTEorem9XZysyNCtBRXNyamR5TFhJcFF2V2RYS2c3US90OTFCNHIvWCtmRmVDY2cvakxBS0d2NGxGUDZVYVJxamhpUHNVK0dOZTQreHlIaGMrRDZzZ29IandsMEF3RWNuYjBHY2J4MlRONkNVUWxnRmpZRGNqM2lJUVZHQ1ljSnozYTlGSkpMYkNSVUphZklHaEpiVENDMm5NVFhiakZjeWVzZW9vSnNkRSs0L0hNTFM1dU1JTGFlRlZ4QmJyRmN4TWNzMEpvOVBqbGtvVjd5eUJZU0toRWlsYTN6dUc4OThWSG9mUWtVT0V5b1NBWGtmSWJTY2huK3hiVnlRVnpKNmhRSHV3YU1oWExyTnZrTFlhQmtmNHBXTVhnU1VVQWd0cDZITU9jQjc0NUY0T2ZuN2IyVUhIYUVpMndrVkNjbktWb1NVMFFncFk3M3l4L1RlY1pXMjdiUncrMjA0Y3VtSjZieHp6Rng1RkVUTG03azVGYW45MXJZQ2loSU1Fd2dWT1Vpb1NDaXpQMFJ3S1ExbGtRMy92YTczaVVyYytDbks5bi94MURUK1JSU0NTMmtvc3Q3anZmRkE5QTc1NHJlNk9kTW5nVFFTS2hMaUZlc1JWRW9qcUpUR0ZMVVpmMWpYKzQwME5kdUNvRklhZ2FVMmlKWTNjWDJEclBqV2Q1bEtFbXAvUnlUcUhoSXFFZ3IxQndncW9hRXNvdkNIdGIxZlc3dzNna3BvK0dYdTQ3eWh1MHU4US83WGQ3THZWNVNvcXlWVUpFVExteEZZUWlHd2hQWEs3OWYyZmkxTnpiWWdzSVJHUUlrTm9tVkdEa1JiOEoxdFlKWXQxLythVUpIM0NSVUp2OHo5Q0NpbW9DaTA0WGRwUGMrczM2L3RnYkxJaG9CaUNyN3AzWHpmdU9Yek4rMS9mS2M3c1lrRVhRbWhJaUZhMWdqL0lpdjhpeWhNempUajVUVTl6NlRKV1diNEYxSHdMN1JDbE5UQTlvMEVYZVozdnFWOFVrTHRMNGtFc3A5UWtaQmxkRU5aUk1HdndJYVgwM3J3MHBxbjYrVzBIc2dMYlZBV1VaQ3Q2K0s5Y1cxaWl2RVgrRDQyK2Zza2FyTlpyelJBV1dpRmt2UEtTNms5VDlYa1RET1VSUlNVQlJhSWt1cjVHVzdLOTNaYVFaR28rVGRDUlY0blZDUms2N29Fcjd5MHBnZS9UUjFmTDYvcGdieUE5WVkwYlRmdmpVdXl0L1UvKzE2UFhmZ2thRk1KRlFsUlVqM2srUllvQ2lsTXlqVGp4WlNlY1RVcDB3eEZJUVY1dmhtaUpBTS9paWQ5NytkSFpHL3JmMGFveU11RWlvUmt6VzdJQ3lqNDV0dncyNVFlL0dhMXAzNmIwZ1BmZkJ2a0JSUWthM2J5M2pqM1NxTG1YMzRRSjNxSVJES0pYVDR5UUo1bmdyekFob2taSnZ4bTlURVBUY28wUTE1Z2cxK3VDVVNpbnVzYjJyZC9NRWVUWGtuVS9BdWhJcyt4WHRrSnYzd2JaSGxXdkxqNkdINmR6T3JGMWNjZ3k3UENMOThHY2NwMjNodWZoYW5WTCtDSGRNYktKNUg4Q3h2dmVzaHlldUdiYjhPRURETitsWHdNdjBvK2hva1padmptMnlETjZlRmVDNUFnRW5WTGYzQ0h4Y0xVNmhkRUt2SlRRa1ZDbExJTnNqd2JwTGsyb1g5SWMyMlE1ZGtnU3Vua3ZYRjgvdnpuZDJEc3VaNTQ4MGtrRjNNdERZbWFOWDVDdWhrVDBzMlE1dG9nVWZlQVVPbTRVWnhjOElNOXZzY3V0ZXFjaElxRWFIVUhhenduYWE0TlJISUhQMDJuK2YyNlA5aHppS0pFM1R4dU9nNXgxbEZJY215UTVOZ2d6anJxdGhDdG5mV0RQMURKUFJKYkNCVUpJbmtMSkRsV1NIS3NJSkkzOHlDOVA0cVRvUUM4aUwvcll2bldGMlVjZ1NoalpPblRPMEVYOWFNQjRieHloRkNSSUZadVpNV0NIUHpSbk5WMW14bUh1cjJjWVVmeEJGM0lqdzZFVzgzZkwwQ29kUHQrVktlblBlOWdwRnpvSzRtay9FY0x3dldWSFlTSzNQR2pPODgrNW5oc29rNDBOVkVuK3JicitiOEJBTklESnFjK1ZLRGZBQUFBQUVsRlRrU3VRbUNDJzsKCiAgcGx1Z2luLnBsYXllclRyYWNrZXIuaWNvbkVubCA9IEwuSWNvbi5EZWZhdWx0LmV4dGVuZCh7b3B0aW9uczogewogICAgaWNvblVybDogaWNvbkVubEltYWdlLAogICAgaWNvblJldGluYVVybDogaWNvbkVubFJldEltYWdlCiAgfX0pOwogIHBsdWdpbi5wbGF5ZXJUcmFja2VyLmljb25SZXMgPSBMLkljb24uRGVmYXVsdC5leHRlbmQoe29wdGlvbnM6IHsKICAgIGljb25Vcmw6IGljb25SZXNJbWFnZSwKICAgIGljb25SZXRpbmFVcmw6IGljb25SZXNSZXRJbWFnZQogIH19KTsKCiAgcGx1Z2luLnBsYXllclRyYWNrZXIuZHJhd25UcmFjZXNFbmwgPSBuZXcgTC5MYXllckdyb3VwKCk7CiAgcGx1Z2luLnBsYXllclRyYWNrZXIuZHJhd25UcmFjZXNSZXMgPSBuZXcgTC5MYXllckdyb3VwKCk7CiAgLy8gdG8gYXZvaWQgYW55IGZhdm91cml0aXNtLCB3ZSdsbCBwdXQgdGhlIHBsYXllcidzIG93biBmYWN0aW9uIGxheWVyIGZpcnN0CiAgaWYgKFBMQVlFUi50ZWFtID09ICdSRVNJU1RBTkNFJykgewogICAgd2luZG93LmFkZExheWVyR3JvdXAoJ1BsYXllciBUcmFja2VyIFJlc2lzdGFuY2UnLCBwbHVnaW4ucGxheWVyVHJhY2tlci5kcmF3blRyYWNlc1JlcywgdHJ1ZSk7CiAgICB3aW5kb3cuYWRkTGF5ZXJHcm91cCgnUGxheWVyIFRyYWNrZXIgRW5saWdodGVuZWQnLCBwbHVnaW4ucGxheWVyVHJhY2tlci5kcmF3blRyYWNlc0VubCwgdHJ1ZSk7CiAgfSBlbHNlIHsKICAgIHdpbmRvdy5hZGRMYXllckdyb3VwKCdQbGF5ZXIgVHJhY2tlciBFbmxpZ2h0ZW5lZCcsIHBsdWdpbi5wbGF5ZXJUcmFja2VyLmRyYXduVHJhY2VzRW5sLCB0cnVlKTsKICAgIHdpbmRvdy5hZGRMYXllckdyb3VwKCdQbGF5ZXIgVHJhY2tlciBSZXNpc3RhbmNlJywgcGx1Z2luLnBsYXllclRyYWNrZXIuZHJhd25UcmFjZXNSZXMsIHRydWUpOwogIH0KICBtYXAub24oJ2xheWVyYWRkJyxmdW5jdGlvbihvYmopIHsKICAgIGlmKG9iai5sYXllciA9PT0gcGx1Z2luLnBsYXllclRyYWNrZXIuZHJhd25UcmFjZXNFbmwgfHwgb2JqLmxheWVyID09PSBwbHVnaW4ucGxheWVyVHJhY2tlci5kcmF3blRyYWNlc1JlcykgewogICAgICBvYmoubGF5ZXIuZWFjaExheWVyKGZ1bmN0aW9uKG1hcmtlcikgewogICAgICAgIGlmKG1hcmtlci5faWNvbikgd2luZG93LnNldHVwVG9vbHRpcHMoJChtYXJrZXIuX2ljb24pKTsKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIHBsdWdpbi5wbGF5ZXJUcmFja2VyLnBsYXllclBvcHVwID0gbmV3IEwuUG9wdXAoe29mZnNldDogTC5wb2ludChbMSwtMzRdKX0pOwoKICBhZGRIb29rKCdwdWJsaWNDaGF0RGF0YUF2YWlsYWJsZScsIHdpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci5oYW5kbGVEYXRhKTsKCiAgd2luZG93Lm1hcC5vbignem9vbWVuZCcsIGZ1bmN0aW9uKCkgewogICAgd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyLnpvb21MaXN0ZW5lcigpOwogIH0pOwogIHdpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci56b29tTGlzdGVuZXIoKTsKICAKICBwbHVnaW4ucGxheWVyVHJhY2tlci5zZXR1cFVzZXJTZWFyY2goKTsKfQoKd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyLnN0b3JlZCA9IHt9OwoKcGx1Z2luLnBsYXllclRyYWNrZXIub25DbGlja0xpc3RlbmVyID0gZnVuY3Rpb24oZXZlbnQpIHsKICB2YXIgbWFya2VyID0gZXZlbnQudGFyZ2V0OwoKICBpZiAobWFya2VyLm9wdGlvbnMuZGVzYykgewogICAgcGx1Z2luLnBsYXllclRyYWNrZXIucGxheWVyUG9wdXAuc2V0Q29udGVudChtYXJrZXIub3B0aW9ucy5kZXNjKTsKICAgIHBsdWdpbi5wbGF5ZXJUcmFja2VyLnBsYXllclBvcHVwLnNldExhdExuZyhtYXJrZXIuZ2V0TGF0TG5nKCkpOwogICAgbWFwLm9wZW5Qb3B1cChwbHVnaW4ucGxheWVyVHJhY2tlci5wbGF5ZXJQb3B1cCk7CiAgfQp9OwoKLy8gZm9yY2UgY2xvc2UgYWxsIG9wZW4gdG9vbHRpcHMgYmVmb3JlIG1hcmtlcnMgYXJlIGNsZWFyZWQKd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyLmNsb3NlSWNvblRvb2x0aXBzID0gZnVuY3Rpb24oKSB7CiAgcGx1Z2luLnBsYXllclRyYWNrZXIuZHJhd25UcmFjZXNSZXMuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKSB7CiAgICBpZiAoJChsYXllci5faWNvbikpIHsgJChsYXllci5faWNvbikudG9vbHRpcCgnY2xvc2UnKTt9CiAgfSk7CiAgcGx1Z2luLnBsYXllclRyYWNrZXIuZHJhd25UcmFjZXNFbmwuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKSB7CiAgICBpZiAoJChsYXllci5faWNvbikpIHsgJChsYXllci5faWNvbikudG9vbHRpcCgnY2xvc2UnKTt9CiAgfSk7Cn0KCndpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci56b29tTGlzdGVuZXIgPSBmdW5jdGlvbigpIHsKICB2YXIgY3RybCA9ICQoJy5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLXNlbGVjdG9yICsgc3Bhbjpjb250YWlucygiUGxheWVyIFRyYWNrZXIiKScpLnBhcmVudCgpOwogIGlmKHdpbmRvdy5tYXAuZ2V0Wm9vbSgpIDwgd2luZG93LlBMQVlFUl9UUkFDS0VSX01JTl9aT09NKSB7CiAgICBpZiAoIXdpbmRvdy5pc1RvdWNoRGV2aWNlKCkpIHBsdWdpbi5wbGF5ZXJUcmFja2VyLmNsb3NlSWNvblRvb2x0aXBzKCk7CiAgICBwbHVnaW4ucGxheWVyVHJhY2tlci5kcmF3blRyYWNlc0VubC5jbGVhckxheWVycygpOwogICAgcGx1Z2luLnBsYXllclRyYWNrZXIuZHJhd25UcmFjZXNSZXMuY2xlYXJMYXllcnMoKTsKICAgIGN0cmwuYWRkQ2xhc3MoJ2Rpc2FibGVkJykuYXR0cigndGl0bGUnLCAnWm9vbSBpbiB0byBzaG93IHRob3NlLicpOwogICAgLy9ub3RlOiB6b29tTGlzdGVuZXIgaXMgYWxzbyBjYWxsZWQgYXQgaW5pdCB0aW1lIHRvIHNldCB1cCB0aGluZ3MsIHNvIHdlIG9ubHkgbmVlZCB0byBkbyB0aGlzIGluIGhlcmUKICAgIHdpbmRvdy5jaGF0LmJhY2tncm91bmRDaGFubmVsRGF0YSgncGx1Z2luLnBsYXllclRyYWNrZXInLCAnYWxsJywgZmFsc2UpOyAgIC8vZGlzYWJsZSB0aGlzIHBsdWdpbidzIGludGVyZXN0IGluICdhbGwnIENPTU0KICB9IGVsc2UgewogICAgY3RybC5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKS5hdHRyKCd0aXRsZScsICcnKTsKICAgIC8vbm90ZTogem9vbUxpc3RlbmVyIGlzIGFsc28gY2FsbGVkIGF0IGluaXQgdGltZSB0byBzZXQgdXAgdGhpbmdzLCBzbyB3ZSBvbmx5IG5lZWQgdG8gZG8gdGhpcyBpbiBoZXJlCiAgICB3aW5kb3cuY2hhdC5iYWNrZ3JvdW5kQ2hhbm5lbERhdGEoJ3BsdWdpbi5wbGF5ZXJUcmFja2VyJywgJ2FsbCcsIHRydWUpOyAgICAvL2VuYWJsZSB0aGlzIHBsdWdpbidzIGludGVyZXN0IGluICdhbGwnIENPTU0KICB9Cn0KCndpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci5nZXRMaW1pdCA9IGZ1bmN0aW9uKCkgewogcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gd2luZG93LlBMQVlFUl9UUkFDS0VSX01BWF9USU1FOwp9Cgp3aW5kb3cucGx1Z2luLnBsYXllclRyYWNrZXIuZGlzY2FyZE9sZERhdGEgPSBmdW5jdGlvbigpIHsKICB2YXIgbGltaXQgPSBwbHVnaW4ucGxheWVyVHJhY2tlci5nZXRMaW1pdCgpOwogICQuZWFjaChwbHVnaW4ucGxheWVyVHJhY2tlci5zdG9yZWQsIGZ1bmN0aW9uKHBscm5hbWUsIHBsYXllcikgewogICAgdmFyIGk7CiAgICB2YXIgZXYgPSBwbGF5ZXIuZXZlbnRzOwogICAgZm9yKGkgPSAwOyBpIDwgZXYubGVuZ3RoOyBpKyspIHsKICAgICAgaWYoZXZbaV0udGltZSA+PSBsaW1pdCkgYnJlYWs7CiAgICB9CiAgICBpZihpID09PSAwKSByZXR1cm4gdHJ1ZTsKICAgIGlmKGkgPT09IGV2Lmxlbmd0aCkgcmV0dXJuIGRlbGV0ZSBwbHVnaW4ucGxheWVyVHJhY2tlci5zdG9yZWRbcGxybmFtZV07CiAgICBwbHVnaW4ucGxheWVyVHJhY2tlci5zdG9yZWRbcGxybmFtZV0uZXZlbnRzLnNwbGljZSgwLCBpKTsKICB9KTsKfQoKd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyLmV2ZW50SGFzTGF0TG5nID0gZnVuY3Rpb24oZXYsIGxhdCwgbG5nKSB7CiAgdmFyIGhhc0xhdExuZyA9IGZhbHNlOwogICQuZWFjaChldi5sYXRsbmdzLCBmdW5jdGlvbihpbmQsIGxsKSB7CiAgICBpZihsbFswXSA9PT0gbGF0ICYmIGxsWzFdID09PSBsbmcpIHsKICAgICAgaGFzTGF0TG5nID0gdHJ1ZTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0pOwogIHJldHVybiBoYXNMYXRMbmc7Cn0KCndpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci5wcm9jZXNzTmV3RGF0YSA9IGZ1bmN0aW9uKGRhdGEpIHsKICB2YXIgbGltaXQgPSBwbHVnaW4ucGxheWVyVHJhY2tlci5nZXRMaW1pdCgpOwogICQuZWFjaChkYXRhLnJlc3VsdCwgZnVuY3Rpb24oaW5kLCBqc29uKSB7CiAgICAvLyBza2lwIG9sZCBkYXRhCiAgICBpZihqc29uWzFdIDwgbGltaXQpIHJldHVybiB0cnVlOwoKICAgIC8vIGZpbmQgcGxheWVyIGFuZCBwb3J0YWwgaW5mb3JtYXRpb24KICAgIHZhciBwbHJuYW1lLCBsYXQsIGxuZywgaWQ9bnVsbCwgbmFtZSwgYWRkcmVzczsKICAgIHZhciBza2lwVGhpc01lc3NhZ2UgPSBmYWxzZTsKICAgICQuZWFjaChqc29uWzJdLnBsZXh0Lm1hcmt1cCwgZnVuY3Rpb24oaW5kLCBtYXJrdXApIHsKICAgICAgc3dpdGNoKG1hcmt1cFswXSkgewogICAgICBjYXNlICdURVhUJzoKICAgICAgICAvLyBEZXN0cm95IGxpbmsgYW5kIGZpZWxkIG1lc3NhZ2VzIGRlcGVuZCBvbiB3aGVyZSB0aGUgbGluayBvcgogICAgICAgIC8vIGZpZWxkIHdhcyBvcmlnaW5hbGx5IGNyZWF0ZWQuIFRoZXJlZm9yZSBpdOKAmXMgbm90IGNsZWFyIHdoaWNoCiAgICAgICAgLy8gcG9ydGFsIHRoZSBwbGF5ZXIgaXMgYXQsIHNvIGlnbm9yZSBpdC4KICAgICAgICBpZihtYXJrdXBbMV0ucGxhaW4uaW5kZXhPZignZGVzdHJveWVkIHRoZSBMaW5rJykgIT09IC0xCiAgICAgICAgICB8fCBtYXJrdXBbMV0ucGxhaW4uaW5kZXhPZignZGVzdHJveWVkIGEgQ29udHJvbCBGaWVsZCcpICE9PSAtMQogICAgICAgICAgfHwgbWFya3VwWzFdLnBsYWluLmluZGV4T2YoJ1lvdXIgTGluaycpICE9PSAtMSkgewogICAgICAgICAgc2tpcFRoaXNNZXNzYWdlID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ1BMQVlFUic6CiAgICAgICAgcGxybmFtZSA9IG1hcmt1cFsxXS5wbGFpbjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnUE9SVEFMJzoKICAgICAgICAvLyBsaW5rIG1lc3NhZ2VzIGFyZSDigJxwbGF5ZXIgbGlua2VkIFggdG8gWeKAnSBhbmQgdGhlIHBsYXllciBpcyBhdAogICAgICAgIC8vIFguCiAgICAgICAgbGF0ID0gbGF0ID8gbGF0IDogbWFya3VwWzFdLmxhdEU2LzFFNjsKICAgICAgICBsbmcgPSBsbmcgPyBsbmcgOiBtYXJrdXBbMV0ubG5nRTYvMUU2OwoKICAgICAgICAvLyBubyBHVUlEIGluIHRoZSBkYXRhIGFueSBtb3JlIC0gYnV0IHdlIG5lZWQgc29tZSB1bmlxdWUgc3RyaW5nLiB1c2UgdGhlIGxhdEU2LGxuZ0U2CiAgICAgICAgaWQgPSBtYXJrdXBbMV0ubGF0RTYrIiwiK21hcmt1cFsxXS5sbmdFNjsKCiAgICAgICAgbmFtZSA9IG5hbWUgPyBuYW1lIDogbWFya3VwWzFdLm5hbWU7CiAgICAgICAgYWRkcmVzcyA9IGFkZHJlc3MgPyBhZGRyZXNzIDogbWFya3VwWzFdLmFkZHJlc3M7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIHNraXAgdW51c2FibGUgZXZlbnRzCiAgICBpZighcGxybmFtZSB8fCAhbGF0IHx8ICFsbmcgfHwgIWlkIHx8IHNraXBUaGlzTWVzc2FnZSkgcmV0dXJuIHRydWU7CgogICAgdmFyIG5ld0V2ZW50ID0gewogICAgICBsYXRsbmdzOiBbW2xhdCwgbG5nXV0sCiAgICAgIGlkczogW2lkXSwKICAgICAgdGltZToganNvblsxXSwKICAgICAgbmFtZTogbmFtZSwKICAgICAgYWRkcmVzczogYWRkcmVzcwogICAgfTsKCiAgICB2YXIgcGxheWVyRGF0YSA9IHdpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci5zdG9yZWRbcGxybmFtZV07CgogICAgLy8gc2hvcnQtcGF0aCBpZiB0aGlzIGlzIGEgbmV3IHBsYXllcgogICAgaWYoIXBsYXllckRhdGEgfHwgcGxheWVyRGF0YS5ldmVudHMubGVuZ3RoID09PSAwKSB7CiAgICAgIHBsdWdpbi5wbGF5ZXJUcmFja2VyLnN0b3JlZFtwbHJuYW1lXSA9IHsKICAgICAgICBuaWNrOiBwbHJuYW1lLAogICAgICAgIHRlYW06IGpzb25bMl0ucGxleHQudGVhbSwKICAgICAgICBldmVudHM6IFtuZXdFdmVudF0KICAgICAgfTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgdmFyIGV2dHMgPSBwbGF5ZXJEYXRhLmV2ZW50czsKICAgIC8vIHRoZXJl4oCZcyBzb21lIGRhdGEgYWxyZWFkeS4gTmVlZCB0byBmaW5kIGNvcnJlY3QgcGxhY2UgdG8gaW5zZXJ0LgogICAgdmFyIGk7CiAgICBmb3IoaSA9IDA7IGkgPCBldnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmKGV2dHNbaV0udGltZSA+IGpzb25bMV0pIGJyZWFrOwogICAgfQoKICAgIHZhciBjbXAgPSBNYXRoLm1heChpLTEsIDApOwoKICAgIC8vIHNvIHdlIGhhdmUgYW4gZXZlbnQgdGhhdCBoYXBwZW5lZCBhdCB0aGUgc2FtZSB0aW1lLiBNb3N0IGxpa2VseQogICAgLy8gdGhpcyBpcyBtdWx0aXBsZSByZXNvcyBkZXN0cm95ZWQgYXQgdGhlIHNhbWUgdGltZS4KICAgIGlmKGV2dHNbY21wXS50aW1lID09PSBqc29uWzFdKSB7CiAgICAgIGV2dHNbY21wXS5sYXRsbmdzLnB1c2goW2xhdCwgbG5nXSk7CiAgICAgIGV2dHNbY21wXS5pZHMucHVzaChpZCk7CiAgICAgIHBsdWdpbi5wbGF5ZXJUcmFja2VyLnN0b3JlZFtwbHJuYW1lXS5ldmVudHMgPSBldnRzOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyB0aGUgdGltZSBjaGFuZ2VkLiBJcyB0aGUgcGxheWVyIHN0aWxsIGF0IHRoZSBzYW1lIGxvY2F0aW9uPwoKICAgIC8vIGFzc3VtZSB0aGlzIGlzIGFuIG9sZGVyIGV2ZW50IGF0IHRoZSBzYW1lIGxvY2F0aW9uLiBUaGVuIHdlIG5lZWQKICAgIC8vIHRvIGxvb2sgYXQgdGhlIG5leHQgaXRlbSBpbiB0aGUgZXZlbnQgbGlzdC4gSWYgdGhpcyBldmVudCBpcyB0aGUKICAgIC8vIG5ld2VzdCBvbmUsIHRoZXJlIG1heSBub3QgYmUgYSBuZXdlciBldmVudCBzbyBjaGVjayBmb3IgdGhhdC4gSWYKICAgIC8vIGl0IHJlYWxseSBpcyBhbiBvbGRlciBldmVudCBhdCB0aGUgc2FtZSBsb2NhdGlvbiwgdGhlbiBza2lwIGl0LgogICAgaWYoZXZ0c1tjbXArMV0gJiYgcGx1Z2luLnBsYXllclRyYWNrZXIuZXZlbnRIYXNMYXRMbmcoZXZ0c1tjbXArMV0sIGxhdCwgbG5nKSkKICAgICAgcmV0dXJuIHRydWU7CgogICAgLy8gaWYgdGhpcyBldmVudCBpcyBuZXdlciwgbmVlZCB0byBsb29rIGF0IHRoZSBwcmV2aW91cyBvbmUKICAgIHZhciBzYW1lTG9jYXRpb24gPSBwbHVnaW4ucGxheWVyVHJhY2tlci5ldmVudEhhc0xhdExuZyhldnRzW2NtcF0sIGxhdCwgbG5nKTsKCiAgICAvLyBpZiBpdOKAmXMgdGhlIHNhbWUgbG9jYXRpb24sIGp1c3QgdXBkYXRlIHRoZSB0aW1lc3RhbXAuIE90aGVyd2lzZQogICAgLy8gcHVzaCBhcyBuZXcgZXZlbnQuCiAgICBpZihzYW1lTG9jYXRpb24pIHsKICAgICAgZXZ0c1tjbXBdLnRpbWUgPSBqc29uWzFdOwogICAgfSBlbHNlIHsKICAgICAgZXZ0cy5zcGxpY2UoaSwgMCwgIG5ld0V2ZW50KTsKICAgIH0KCiAgICAvLyB1cGRhdGUgcGxheWVyIGRhdGEKICAgIHBsdWdpbi5wbGF5ZXJUcmFja2VyLnN0b3JlZFtwbHJuYW1lXS5ldmVudHMgPSBldnRzOwogIH0pOwp9Cgp3aW5kb3cucGx1Z2luLnBsYXllclRyYWNrZXIuZ2V0TGF0TG5nRnJvbUV2ZW50ID0gZnVuY3Rpb24oZXYpIHsKLy9UT0RPPyBhZGQgd2VpZ2h0IHRvIGNlcnRhaW4gZXZlbnRzLCBvciBvdGhlcndpc2UgcHJlZmVyIHRoZW0sIHRvIGdpdmUgYmV0dGVyIGxvY2F0aW9ucz8KICB2YXIgbGF0cyA9IDA7CiAgdmFyIGxuZ3MgPSAwOwogICQuZWFjaChldi5sYXRsbmdzLCBmdW5jdGlvbihpLCBsYXRsbmcpIHsKICAgIGxhdHMgKz0gbGF0bG5nWzBdOwogICAgbG5ncyArPSBsYXRsbmdbMV07CiAgfSk7CgogIHJldHVybiBMLmxhdExuZyhsYXRzIC8gZXYubGF0bG5ncy5sZW5ndGgsIGxuZ3MgLyBldi5sYXRsbmdzLmxlbmd0aCk7Cn0KCndpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci5hZ28gPSBmdW5jdGlvbih0aW1lLCBub3cpIHsKICB2YXIgcyA9IChub3ctdGltZSkgLyAxMDAwOwogIHZhciBoID0gTWF0aC5mbG9vcihzIC8gMzYwMCk7CiAgdmFyIG0gPSBNYXRoLmZsb29yKChzICUgMzYwMCkgLyA2MCk7CiAgdmFyIHJldHVyblZhbCA9IG0gKyAnbSc7CiAgaWYoaCA+IDApIHsKICAgIHJldHVyblZhbCA9IGggKyAnaCcgKyByZXR1cm5WYWw7CiAgfQogIHJldHVybiByZXR1cm5WYWw7Cn0KCndpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci5kcmF3RGF0YSA9IGZ1bmN0aW9uKCkgewogIHZhciBpc1RvdWNoRGV2ID0gd2luZG93LmlzVG91Y2hEZXZpY2UoKTsKCiAgdmFyIGdsbGZlID0gcGx1Z2luLnBsYXllclRyYWNrZXIuZ2V0TGF0TG5nRnJvbUV2ZW50OwoKICB2YXIgcG9seUxpbmVCeUFnZUVubCA9IFtbXSwgW10sIFtdLCBbXV07CiAgdmFyIHBvbHlMaW5lQnlBZ2VSZXMgPSBbW10sIFtdLCBbXSwgW11dOwoKICB2YXIgc3BsaXQgPSBQTEFZRVJfVFJBQ0tFUl9NQVhfVElNRSAvIDQ7CiAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICQuZWFjaChwbHVnaW4ucGxheWVyVHJhY2tlci5zdG9yZWQsIGZ1bmN0aW9uKHBscm5hbWUsIHBsYXllckRhdGEpIHsKICAgIGlmKCFwbGF5ZXJEYXRhIHx8IHBsYXllckRhdGEuZXZlbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICBjb25zb2xlLndhcm4oJ2Jyb2tlbiBwbGF5ZXIgZGF0YSBmb3IgcGxybmFtZT0nICsgcGxybmFtZSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIGdhdGhlciBsaW5lIGRhdGEgYW5kIHB1dCB0aGVtIGluIGJ1Y2tldHMgc28gd2UgY2FuIGNvbG9yIHRoZW0gYnkKICAgIC8vIHRoZWlyIGFnZQogICAgdmFyIHBsYXllckxpbmUgPSBbXTsKICAgIGZvcih2YXIgaSA9IDE7IGkgPCBwbGF5ZXJEYXRhLmV2ZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgcCA9IHBsYXllckRhdGEuZXZlbnRzW2ldOwogICAgICB2YXIgYWdlQnVja2V0ID0gTWF0aC5taW4ocGFyc2VJbnQoKG5vdyAtIHAudGltZSkgLyBzcGxpdCksIDQtMSk7CiAgICAgIHZhciBsaW5lID0gW2dsbGZlKHApLCBnbGxmZShwbGF5ZXJEYXRhLmV2ZW50c1tpLTFdKV07CgogICAgICBpZihwbGF5ZXJEYXRhLnRlYW0gPT09ICdSRVNJU1RBTkNFJykKICAgICAgICBwb2x5TGluZUJ5QWdlUmVzW2FnZUJ1Y2tldF0ucHVzaChsaW5lKTsKICAgICAgZWxzZQogICAgICAgIHBvbHlMaW5lQnlBZ2VFbmxbYWdlQnVja2V0XS5wdXNoKGxpbmUpOwogICAgfQoKICAgIHZhciBldnRzTGVuZ3RoID0gcGxheWVyRGF0YS5ldmVudHMubGVuZ3RoOwogICAgdmFyIGxhc3QgPSBwbGF5ZXJEYXRhLmV2ZW50c1tldnRzTGVuZ3RoLTFdOwogICAgdmFyIGFnbyA9IHBsdWdpbi5wbGF5ZXJUcmFja2VyLmFnbzsKCiAgICAvLyB0b29sdGlwIGZvciBtYXJrZXIgLSBubyBIVE1MIC0gYW5kIG5vdCBzaG93biBvbiB0b3VjaHNjcmVlbiBkZXZpY2VzCiAgICB2YXIgdG9vbHRpcCA9IGlzVG91Y2hEZXYgPyAnJyA6IChwbGF5ZXJEYXRhLm5pY2srJywgJythZ28obGFzdC50aW1lLCBub3cpKycgYWdvJyk7CgogICAgLy8gcG9wdXAgZm9yIG1hcmtlcgogICAgdmFyIHBvcHVwID0gJCgnPGRpdj4nKQogICAgICAuYWRkQ2xhc3MoJ3BsdWdpbi1wbGF5ZXItdHJhY2tlci1wb3B1cCcpOwogICAgJCgnPHNwYW4+JykKICAgICAgLmFkZENsYXNzKCduaWNrbmFtZSAnICsgKHBsYXllckRhdGEudGVhbSA9PT0gJ1JFU0lTVEFOQ0UnID8gJ3JlcycgOiAnZW5sJykpCiAgICAgIC5jc3MoJ2ZvbnQtd2VpZ2h0JywgJ2JvbGQnKQogICAgICAudGV4dChwbGF5ZXJEYXRhLm5pY2spCiAgICAgIC5hcHBlbmRUbyhwb3B1cCk7CgogICAgaWYod2luZG93LnBsdWdpbi5ndWVzc1BsYXllckxldmVscyAhPT0gdW5kZWZpbmVkICYmCiAgICAgICB3aW5kb3cucGx1Z2luLmd1ZXNzUGxheWVyTGV2ZWxzLmZldGNoTGV2ZWxEZXRhaWxzQnlQbGF5ZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBmdW5jdGlvbiBnZXRMZXZlbChsdmwpIHsKICAgICAgICByZXR1cm4gJCgnPHNwYW4+JykKICAgICAgICAgIC5jc3MoewogICAgICAgICAgICBwYWRkaW5nOiAnNHB4JywKICAgICAgICAgICAgY29sb3I6ICd3aGl0ZScsCiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogQ09MT1JTX0xWTFtsdmxdLAogICAgICAgICAgfSkKICAgICAgICAgIC50ZXh0KGx2bCk7CiAgICAgIH0KCiAgICAgIHZhciBsZXZlbCA9ICQoJzxzcGFuPicpCiAgICAgICAgLmNzcyh7J2ZvbnQtd2VpZ2h0JzogJ2JvbGQnLCAnbWFyZ2luLWxlZnQnOiAnMTBweCd9KQogICAgICAgIC5hcHBlbmRUbyhwb3B1cCk7CgogICAgICB2YXIgcGxheWVyTGV2ZWxEZXRhaWxzID0gd2luZG93LnBsdWdpbi5ndWVzc1BsYXllckxldmVscy5mZXRjaExldmVsRGV0YWlsc0J5UGxheWVyKHBscm5hbWUpOwogICAgICBsZXZlbAogICAgICAgIC50ZXh0KCdNaW4gbGV2ZWwgJykKICAgICAgICAuYXBwZW5kKGdldExldmVsKHBsYXllckxldmVsRGV0YWlscy5taW4pKTsKICAgICAgaWYocGxheWVyTGV2ZWxEZXRhaWxzLm1pbiAhPSBwbGF5ZXJMZXZlbERldGFpbHMuZ3Vlc3NlZCkKICAgICAgICBsZXZlbAogICAgICAgICAgLmFwcGVuZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnLCBndWVzc2VkIGxldmVsOiAnKSkKICAgICAgICAgIC5hcHBlbmQoZ2V0TGV2ZWwocGxheWVyTGV2ZWxEZXRhaWxzLmd1ZXNzZWQpKTsKICAgIH0KCiAgICBwb3B1cAogICAgICAuYXBwZW5kKCc8YnI+JykKICAgICAgLmFwcGVuZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShhZ28obGFzdC50aW1lLCBub3cpKSkKICAgICAgLmFwcGVuZCgnPGJyPicpCiAgICAgIC5hcHBlbmQocGx1Z2luLnBsYXllclRyYWNrZXIuZ2V0UG9ydGFsTGluayhsYXN0KSk7CgogICAgLy8gc2hvdyBwcmV2aW91cyBkYXRhIGluIHBvcHVwCiAgICBpZihldnRzTGVuZ3RoID49IDIpIHsKICAgICAgcG9wdXAKICAgICAgICAuYXBwZW5kKCc8YnI+JykKICAgICAgICAuYXBwZW5kKCc8YnI+JykKICAgICAgICAuYXBwZW5kKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdwcmV2aW91cyBsb2NhdGlvbnM6JykpCiAgICAgICAgLmFwcGVuZCgnPGJyPicpOwoKICAgICAgdmFyIHRhYmxlID0gJCgnPHRhYmxlPicpCiAgICAgICAgLmFwcGVuZFRvKHBvcHVwKQogICAgICAgIC5jc3MoJ2JvcmRlci1zcGFjaW5nJywgJzAnKTsKICAgICAgZm9yKHZhciBpID0gZXZ0c0xlbmd0aCAtIDI7IGkgPj0gMCAmJiBpID49IGV2dHNMZW5ndGggLSAxMDsgaS0tKSB7CiAgICAgICAgdmFyIGV2ID0gcGxheWVyRGF0YS5ldmVudHNbaV07CiAgICAgICAgJCgnPHRyPicpCiAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nKQogICAgICAgICAgICAudGV4dChhZ28oZXYudGltZSwgbm93KSArICcgYWdvJykpCiAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nKQogICAgICAgICAgICAuYXBwZW5kKHBsdWdpbi5wbGF5ZXJUcmFja2VyLmdldFBvcnRhbExpbmsoZXYpKSkKICAgICAgICAgIC5hcHBlbmRUbyh0YWJsZSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBjYWxjdWxhdGUgdGhlIGNsb3Nlc3QgcG9ydGFsIHRvIHRoZSBwbGF5ZXIKICAgIHZhciBldmVudFBvcnRhbCA9IFtdCiAgICB2YXIgY2xvc2VzdFBvcnRhbDsKICAgIHZhciBtb3N0UG9ydGFscyA9IDA7CiAgICAkLmVhY2gobGFzdC5pZHMsIGZ1bmN0aW9uKGksIGlkKSB7CiAgICAgIGlmKGV2ZW50UG9ydGFsW2lkXSkgewogICAgICAgIGV2ZW50UG9ydGFsW2lkXSsrOwogICAgICB9IGVsc2UgewogICAgICAgIGV2ZW50UG9ydGFsW2lkXSA9IDE7CiAgICAgIH0KICAgICAgaWYoZXZlbnRQb3J0YWxbaWRdID4gbW9zdFBvcnRhbHMpIHsKICAgICAgICBtb3N0UG9ydGFscyA9IGV2ZW50UG9ydGFsW2lkXTsKICAgICAgICBjbG9zZXN0UG9ydGFsID0gaWQ7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIG1hcmtlciBvcGFjaXR5CiAgICB2YXIgcmVsT3BhY2l0eSA9IDEgLSAobm93IC0gbGFzdC50aW1lKSAvIHdpbmRvdy5QTEFZRVJfVFJBQ0tFUl9NQVhfVElNRQogICAgdmFyIGFic09wYWNpdHkgPSB3aW5kb3cuUExBWUVSX1RSQUNLRVJfTUlOX09QQUNJVFkgKyAoMSAtIHdpbmRvdy5QTEFZRVJfVFJBQ0tFUl9NSU5fT1BBQ0lUWSkgKiByZWxPcGFjaXR5OwoKICAgIC8vIG1hcmtlciBpdHNlbGYKICAgIHZhciBpY29uID0gcGxheWVyRGF0YS50ZWFtID09PSAnUkVTSVNUQU5DRScgPyAgbmV3IHBsdWdpbi5wbGF5ZXJUcmFja2VyLmljb25SZXMoKSA6ICBuZXcgcGx1Z2luLnBsYXllclRyYWNrZXIuaWNvbkVubCgpOwogICAgLy8gYXMgcGVyIE92ZXJsYXBwaW5nTWFya2VyU3BpZGVyZmllciBkb2NzLCBjbGljayBldmVudHMgKHBvcHVwcywgZXRjKSBtdXN0IGJlIGhhbmRsZWQgdmlhIGl0IHJhdGhlciB0aGFuIHRoZSBzdGFuZGFyZAogICAgLy8gbWFya2VyIGNsaWNrIGV2ZW50cy4gc28gc3RvcmUgdGhlIHBvcHVwIHRleHQgaW4gdGhlIG9wdGlvbnMsIHRoZW4gZGlzcGxheSBpdCBpbiB0aGUgb21zIGNsaWNrIGhhbmRsZXIKICAgIHZhciBtID0gTC5tYXJrZXIoZ2xsZmUobGFzdCksIHtpY29uOiBpY29uLCByZWZlcmVuY2VUb1BvcnRhbDogY2xvc2VzdFBvcnRhbCwgb3BhY2l0eTogYWJzT3BhY2l0eSwgZGVzYzogcG9wdXBbMF0sIHRpdGxlOiB0b29sdGlwfSk7CiAgICBtLmFkZEV2ZW50TGlzdGVuZXIoJ3NwaWRlcmZpZWRjbGljaycsIHBsdWdpbi5wbGF5ZXJUcmFja2VyLm9uQ2xpY2tMaXN0ZW5lcik7CgogICAgLy8gbS5iaW5kUG9wdXAodGl0bGUpOwoKICAgIGlmICh0b29sdGlwKSB7CiAgICAgIC8vIGVuc3VyZSB0b29sdGlwcyBhcmUgY2xvc2VkLCBzb21ldGltZXMgdGhleSBsaW5nZXIKICAgICAgbS5vbignbW91c2VvdXQnLCBmdW5jdGlvbigpIHsgJCh0aGlzLl9pY29uKS50b29sdGlwKCdjbG9zZScpOyB9KTsKICAgIH0KCiAgICBwbGF5ZXJEYXRhLm1hcmtlciA9IG07CgogICAgbS5hZGRUbyhwbGF5ZXJEYXRhLnRlYW0gPT09ICdSRVNJU1RBTkNFJyA/IHBsdWdpbi5wbGF5ZXJUcmFja2VyLmRyYXduVHJhY2VzUmVzIDogcGx1Z2luLnBsYXllclRyYWNrZXIuZHJhd25UcmFjZXNFbmwpOwogICAgd2luZG93LnJlZ2lzdGVyTWFya2VyRm9yT01TKG0pOwoKICAgIC8vIGpRdWVyeVVJIGRvZXNu4oCZdCBhdXRvbWF0aWNhbGx5IG5vdGljZSB0aGUgbmV3IG1hcmtlcnMKICAgIGlmICghaXNUb3VjaERldikgewogICAgICB3aW5kb3cuc2V0dXBUb29sdGlwcygkKG0uX2ljb24pKTsKICAgIH0KICB9KTsKCiAgLy8gZHJhdyB0aGUgcG9seSBsaW5lcyB0byB0aGUgbWFwCiAgJC5lYWNoKHBvbHlMaW5lQnlBZ2VFbmwsIGZ1bmN0aW9uKGksIHBvbHlMaW5lKSB7CiAgICBpZihwb2x5TGluZS5sZW5ndGggPT09IDApIHJldHVybiB0cnVlOwoKICAgIHZhciBvcHRzID0gewogICAgICB3ZWlnaHQ6IDItMC4yNSppLAogICAgICBjb2xvcjogUExBWUVSX1RSQUNLRVJfTElORV9DT0xPVVIsCiAgICAgIGNsaWNrYWJsZTogZmFsc2UsCiAgICAgIG9wYWNpdHk6IDEtMC4yKmksCiAgICAgIGRhc2hBcnJheTogIjUsOCIKICAgIH07CgogICAgJC5lYWNoKHBvbHlMaW5lLGZ1bmN0aW9uKGluZCxwb2x5KSB7CiAgICAgIEwucG9seWxpbmUocG9seSwgb3B0cykuYWRkVG8ocGx1Z2luLnBsYXllclRyYWNrZXIuZHJhd25UcmFjZXNFbmwpOwogICAgfSk7CiAgfSk7CiAgJC5lYWNoKHBvbHlMaW5lQnlBZ2VSZXMsIGZ1bmN0aW9uKGksIHBvbHlMaW5lKSB7CiAgICBpZihwb2x5TGluZS5sZW5ndGggPT09IDApIHJldHVybiB0cnVlOwoKICAgIHZhciBvcHRzID0gewogICAgICB3ZWlnaHQ6IDItMC4yNSppLAogICAgICBjb2xvcjogUExBWUVSX1RSQUNLRVJfTElORV9DT0xPVVIsCiAgICAgIGNsaWNrYWJsZTogZmFsc2UsCiAgICAgIG9wYWNpdHk6IDEtMC4yKmksCiAgICAgIGRhc2hBcnJheTogIjUsOCIKICAgIH07CgogICAgJC5lYWNoKHBvbHlMaW5lLCBmdW5jdGlvbihpbmQscG9seSkgewogICAgICBMLnBvbHlsaW5lKHBvbHksIG9wdHMpLmFkZFRvKHBsdWdpbi5wbGF5ZXJUcmFja2VyLmRyYXduVHJhY2VzUmVzKTsKICAgIH0pOwogIH0pOwp9Cgp3aW5kb3cucGx1Z2luLnBsYXllclRyYWNrZXIuZ2V0UG9ydGFsTGluayA9IGZ1bmN0aW9uKGRhdGEpIHsKICB2YXIgcG9zaXRpb24gPSBkYXRhLmxhdGxuZ3NbMF07CiAgdmFyIGxsID0gcG9zaXRpb24uam9pbignLCcpOwogIHJldHVybiAkKCc8YT4nKQogICAgLmFkZENsYXNzKCd0ZXh0LW92ZXJmbG93LWVsbGlwc2lzJykKICAgIC5jc3MoJ21heC13aWR0aCcsICcxNWVtJykKICAgIC50ZXh0KHdpbmRvdy5jaGF0LmdldENoYXRQb3J0YWxOYW1lKGRhdGEpKQogICAgLnByb3AoewogICAgICB0aXRsZTogd2luZG93LmNoYXQuZ2V0Q2hhdFBvcnRhbE5hbWUoZGF0YSksCiAgICAgIGhyZWY6ICcvaW50ZWw/bGw9JyArIGxsICsgJyZwbGw9JyArIGxsLAogICAgfSkKICAgIC5jbGljayhmdW5jdGlvbihldmVudCkgewogICAgICB3aW5kb3cuc2VsZWN0UG9ydGFsQnlMYXRMbmcocG9zaXRpb24pOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KQogICAgLmRibGNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIG1hcC5zZXRWaWV3KHBvc2l0aW9uLCAxNykKICAgICAgd2luZG93LnNlbGVjdFBvcnRhbEJ5TGF0TG5nKHBvc2l0aW9uKTsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7Cn0KCndpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci5oYW5kbGVEYXRhID0gZnVuY3Rpb24oZGF0YSkgewogIGlmKHdpbmRvdy5tYXAuZ2V0Wm9vbSgpIDwgd2luZG93LlBMQVlFUl9UUkFDS0VSX01JTl9aT09NKSByZXR1cm47CgogIHBsdWdpbi5wbGF5ZXJUcmFja2VyLmRpc2NhcmRPbGREYXRhKCk7CiAgcGx1Z2luLnBsYXllclRyYWNrZXIucHJvY2Vzc05ld0RhdGEoZGF0YSk7CiAgaWYgKCF3aW5kb3cuaXNUb3VjaERldmljZSgpKSBwbHVnaW4ucGxheWVyVHJhY2tlci5jbG9zZUljb25Ub29sdGlwcygpOwoKICBwbHVnaW4ucGxheWVyVHJhY2tlci5kcmF3blRyYWNlc0VubC5jbGVhckxheWVycygpOwogIHBsdWdpbi5wbGF5ZXJUcmFja2VyLmRyYXduVHJhY2VzUmVzLmNsZWFyTGF5ZXJzKCk7CiAgcGx1Z2luLnBsYXllclRyYWNrZXIuZHJhd0RhdGEoKTsKfQoKd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyLmZpbmRVc2VyID0gZnVuY3Rpb24obmljaykgewogIG5pY2sgPSBuaWNrLnRvTG93ZXJDYXNlKCk7CiAgdmFyIGZvdW5kUGxheWVyRGF0YSA9IGZhbHNlOwogICQuZWFjaChwbHVnaW4ucGxheWVyVHJhY2tlci5zdG9yZWQsIGZ1bmN0aW9uKHBscm5hbWUsIHBsYXllckRhdGEpIHsKICAgIGlmIChwbGF5ZXJEYXRhLm5pY2sudG9Mb3dlckNhc2UoKSA9PT0gbmljaykgewogICAgICBmb3VuZFBsYXllckRhdGEgPSBwbGF5ZXJEYXRhOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSk7CiAgcmV0dXJuIGZvdW5kUGxheWVyRGF0YTsKfQoKd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyLmZpbmRVc2VyUG9zaXRpb24gPSBmdW5jdGlvbihuaWNrKSB7CiAgdmFyIGRhdGEgPSB3aW5kb3cucGx1Z2luLnBsYXllclRyYWNrZXIuZmluZFVzZXIobmljayk7CiAgaWYgKCFkYXRhKSByZXR1cm4gZmFsc2U7CgogIHZhciBsYXN0ID0gZGF0YS5ldmVudHNbZGF0YS5ldmVudHMubGVuZ3RoIC0gMV07CiAgcmV0dXJuIHBsdWdpbi5wbGF5ZXJUcmFja2VyLmdldExhdExuZ0Zyb21FdmVudChsYXN0KTsKfQoKd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyLmNlbnRlck1hcE9uVXNlciA9IGZ1bmN0aW9uKG5pY2spIHsKICB2YXIgZGF0YSA9IHBsdWdpbi5wbGF5ZXJUcmFja2VyLmZpbmRVc2VyKG5pY2spOwogIGlmKCFkYXRhKSByZXR1cm4gZmFsc2U7CgogIHZhciBsYXN0ID0gZGF0YS5ldmVudHNbZGF0YS5ldmVudHMubGVuZ3RoIC0gMV07CiAgdmFyIHBvc2l0aW9uID0gcGx1Z2luLnBsYXllclRyYWNrZXIuZ2V0TGF0TG5nRnJvbUV2ZW50KGxhc3QpOwoKICBpZih3aW5kb3cuaXNTbWFydHBob25lKCkpIHdpbmRvdy5zaG93KCdtYXAnKTsKICB3aW5kb3cubWFwLnNldFZpZXcocG9zaXRpb24sIG1hcC5nZXRab29tKCkpOwoKICBpZihkYXRhLm1hcmtlcikgewogICAgd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyLm9uQ2xpY2tMaXN0ZW5lcih7dGFyZ2V0OiBkYXRhLm1hcmtlcn0pOwogIH0KICByZXR1cm4gdHJ1ZTsKfQoKd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyLm9uTmlja25hbWVDbGlja2VkID0gZnVuY3Rpb24oaW5mbykgewogIGlmIChpbmZvLmV2ZW50LmN0cmxLZXkgfHwgaW5mby5ldmVudC5tZXRhS2V5KSB7CiAgICByZXR1cm4gIXBsdWdpbi5wbGF5ZXJUcmFja2VyLmNlbnRlck1hcE9uVXNlcihpbmZvLm5pY2tuYW1lKTsKICB9CiAgcmV0dXJuIHRydWU7IC8vIGRvbid0IGludGVycnVwdCBob29rCn0KCndpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci5vblNlYXJjaFJlc3VsdFNlbGVjdGVkID0gZnVuY3Rpb24ocmVzdWx0LCBldmVudCkgewogIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyAvLyBwcmV2ZW50IGNoYXQgZnJvbSBoYW5kbGluZyB0aGUgY2xpY2sKCiAgaWYod2luZG93LmlzU21hcnRwaG9uZSgpKSB3aW5kb3cuc2hvdygnbWFwJyk7CgogIC8vIGlmIHRoZSB1c2VyIG1vdmVkIHNpbmNlIHRoZSBzZWFyY2ggd2FzIHN0YXJ0ZWQsIGNoZWNrIGlmIHdlIGhhdmUgYSBuZXcgc2V0IG9mIGRhdGEKICBpZihmYWxzZSA9PT0gd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyLmNlbnRlck1hcE9uVXNlcihyZXN1bHQubmlja25hbWUpKQogICAgbWFwLnNldFZpZXcocmVzdWx0LnBvc2l0aW9uKTsKCiAgaWYoZXZlbnQudHlwZSA9PSAnZGJsY2xpY2snKQogICAgbWFwLnNldFpvb20oMTcpOwoKICByZXR1cm4gdHJ1ZTsKfTsKCndpbmRvdy5wbHVnaW4ucGxheWVyVHJhY2tlci5vblNlYXJjaCA9IGZ1bmN0aW9uKHF1ZXJ5KSB7CiAgdmFyIHRlcm0gPSBxdWVyeS50ZXJtLnRvTG93ZXJDYXNlKCk7CgogIGlmICh0ZXJtLmxlbmd0aCAmJiB0ZXJtWzBdID09ICdAJykgdGVybSA9IHRlcm0uc3Vic3RyKDEpOwoKICAkLmVhY2gocGx1Z2luLnBsYXllclRyYWNrZXIuc3RvcmVkLCBmdW5jdGlvbihuaWNrLCBkYXRhKSB7CiAgICBpZihuaWNrLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0ZXJtKSA9PT0gLTEpIHJldHVybjsKCiAgICB2YXIgZXZlbnQgPSBkYXRhLmV2ZW50c1tkYXRhLmV2ZW50cy5sZW5ndGggLSAxXTsKCiAgICBxdWVyeS5hZGRSZXN1bHQoewogICAgICB0aXRsZTogJzxtYXJrIGNsYXNzPSJuaWNrbmFtZSBoZWxwICcrVEVBTV9UT19DU1NbZ2V0VGVhbShkYXRhKV0rJyI+JyArIG5pY2sgKyAnPC9tYXJrPicsCiAgICAgIG5pY2tuYW1lOiBuaWNrLAogICAgICBkZXNjcmlwdGlvbjogZGF0YS50ZWFtLnN1YnN0cigwLDMpICsgJywgbGFzdCBzZWVuICcgKyB1bml4VGltZVRvRGF0ZVRpbWVTdHJpbmcoZXZlbnQudGltZSksCiAgICAgIHBvc2l0aW9uOiBwbHVnaW4ucGxheWVyVHJhY2tlci5nZXRMYXRMbmdGcm9tRXZlbnQoZXZlbnQpLAogICAgICBvblNlbGVjdGVkOiB3aW5kb3cucGx1Z2luLnBsYXllclRyYWNrZXIub25TZWFyY2hSZXN1bHRTZWxlY3RlZCwKICAgIH0pOwogIH0pOwp9Cgp3aW5kb3cucGx1Z2luLnBsYXllclRyYWNrZXIuc2V0dXBVc2VyU2VhcmNoID0gZnVuY3Rpb24oKSB7CiAgYWRkSG9vaygnbmlja25hbWVDbGlja2VkJywgd2luZG93LnBsdWdpbi5wbGF5ZXJUcmFja2VyLm9uTmlja25hbWVDbGlja2VkKTsKICBhZGRIb29rKCdzZWFyY2gnLCB3aW5kb3cucGx1Z2luLnBsYXllclRyYWNrZXIub25TZWFyY2gpOwp9CgoKdmFyIHNldHVwID0gcGx1Z2luLnBsYXllclRyYWNrZXIuc2V0dXA7CgovLyBQTFVHSU4gRU5EIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgpzZXR1cC5pbmZvID0gcGx1Z2luX2luZm87IC8vYWRkIHRoZSBzY3JpcHQgaW5mbyBkYXRhIHRvIHRoZSBmdW5jdGlvbiBhcyBhIHByb3BlcnR5CmlmKCF3aW5kb3cuYm9vdFBsdWdpbnMpIHdpbmRvdy5ib290UGx1Z2lucyA9IFtdOwp3aW5kb3cuYm9vdFBsdWdpbnMucHVzaChzZXR1cCk7Ci8vIGlmIElJVEMgaGFzIGFscmVhZHkgYm9vdGVkLCBpbW1lZGlhdGVseSBydW4gdGhlICdzZXR1cCcgZnVuY3Rpb24KaWYod2luZG93LmlpdGNMb2FkZWQgJiYgdHlwZW9mIHNldHVwID09PSAnZnVuY3Rpb24nKSBzZXR1cCgpOwp9IC8vIHdyYXBwZXIgZW5kCi8vIGluamVjdCBjb2RlIGludG8gc2l0ZSBjb250ZXh0CnZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKdmFyIGluZm8gPSB7fTsKaWYgKHR5cGVvZiBHTV9pbmZvICE9PSAndW5kZWZpbmVkJyAmJiBHTV9pbmZvICYmIEdNX2luZm8uc2NyaXB0KSBpbmZvLnNjcmlwdCA9IHsgdmVyc2lvbjogR01faW5mby5zY3JpcHQudmVyc2lvbiwgbmFtZTogR01faW5mby5zY3JpcHQubmFtZSwgZGVzY3JpcHRpb246IEdNX2luZm8uc2NyaXB0LmRlc2NyaXB0aW9uIH07CnNjcmlwdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnKCcrIHdyYXBwZXIgKycpKCcrSlNPTi5zdHJpbmdpZnkoaW5mbykrJyk7JykpOwooZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCgo="},{"name":"IITC plugin: Bookmarks for maps and portals","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null}},"storage":{"data":{},"ts":1480917632195},"enabled":true,"position":4,"file_url":"https://static.iitc.me/build/release/plugins/bookmarks-by-zaso.user.js","uuid":"79ded8a4-e688-4204-ad60-12bcf8cdcb2a","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLWJvb2ttYXJrc0BaYXNvR0QKLy8gQG5hbWUgICAgICAgICAgIElJVEMgcGx1Z2luOiBCb29rbWFya3MgZm9yIG1hcHMgYW5kIHBvcnRhbHMKLy8gQGNhdGVnb3J5ICAgICAgIENvbnRyb2xzCi8vIEB2ZXJzaW9uICAgICAgICAwLjIuMTIuMjAxNjEwMDMuNDc0MAovLyBAbmFtZXNwYWNlICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2pvbmF0a2lucy9pbmdyZXNzLWludGVsLXRvdGFsLWNvbnZlcnNpb24KLy8gQHVwZGF0ZVVSTCAgICAgIGh0dHBzOi8vc3RhdGljLmlpdGMubWUvYnVpbGQvcmVsZWFzZS9wbHVnaW5zL2Jvb2ttYXJrcy1ieS16YXNvLm1ldGEuanMKLy8gQGRvd25sb2FkVVJMICAgIGh0dHBzOi8vc3RhdGljLmlpdGMubWUvYnVpbGQvcmVsZWFzZS9wbHVnaW5zL2Jvb2ttYXJrcy1ieS16YXNvLnVzZXIuanMKLy8gQGRlc2NyaXB0aW9uICAgIFtpaXRjLTIwMTYtMTAtMDMtMDA0NzQwXSBTYXZlIHlvdXIgZmF2b3JpdGUgTWFwcyBhbmQgUG9ydGFscyBhbmQgbW92ZSB0aGUgaW50ZWwgbWFwIHdpdGggYSBjbGljay4gV29ya3Mgd2l0aCBzeW5jLgovLyBAaW5jbHVkZSAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBtYXRjaCAgICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBtYXRjaCAgICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBncmFudCAgICAgICAgICBub25lCi8vID09L1VzZXJTY3JpcHQ9PQoKCmZ1bmN0aW9uIHdyYXBwZXIocGx1Z2luX2luZm8pIHsKLy8gZW5zdXJlIHBsdWdpbiBmcmFtZXdvcmsgaXMgdGhlcmUsIGV2ZW4gaWYgaWl0YyBpcyBub3QgeWV0IGxvYWRlZAppZih0eXBlb2Ygd2luZG93LnBsdWdpbiAhPT0gJ2Z1bmN0aW9uJykgd2luZG93LnBsdWdpbiA9IGZ1bmN0aW9uKCkge307CgovL1BMVUdJTiBBVVRIT1JTOiB3cml0aW5nIGEgcGx1Z2luIG91dHNpZGUgb2YgdGhlIElJVEMgYnVpbGQgZW52aXJvbm1lbnQ/IGlmIHNvLCBkZWxldGUgdGhlc2UgbGluZXMhIQovLyhsZWF2aW5nIHRoZW0gaW4gcGxhY2UgbWlnaHQgYnJlYWsgdGhlICdBYm91dCBJSVRDJyBwYWdlIG9yIGJyZWFrIHVwZGF0ZSBjaGVja3MpCnBsdWdpbl9pbmZvLmJ1aWxkTmFtZSA9ICdpaXRjJzsKcGx1Z2luX2luZm8uZGF0ZVRpbWVWZXJzaW9uID0gJzIwMTYxMDAzLjQ3NDAnOwpwbHVnaW5faW5mby5wbHVnaW5JZCA9ICdib29rbWFya3MtYnktemFzbyc7Ci8vRU5EIFBMVUdJTiBBVVRIT1JTIE5PVEUKCgoKLy8gUExVR0lOIFNUQVJUIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICBIT09LUzoKICAtIHBsdWdpbkJrbXJrc0VkaXQ6IGZpcmVkIHdoZW4gYSBib29rbWFya3MvZm9sZGVyIGlzIHJlbW92ZWQsIGFkZGVkIG9yIHNvcnRlZCwgYWxzbyB3aGVuIGEgZm9sZGVyIGlzIG9wZW5lZC9jbG9zZWQ7CiAgLSBwbHVnaW5Ca21ya3NPcGVuT3B0OiBmaXJlZCB3aGVuIHRoZSAiQm9va21hcmtzIE9wdGlvbnMiIHBhbmVsIGlzIG9wZW5lZCAoeW91IGNhbiBhZGQgbmV3IG9wdGlvbnMpOwogIC0gcGx1Z2luQmttcmtzU3luY0VuZDogZmlyZWQgd2hlbiB0aGUgc3luYyBpcyBmaW5pc2hlZDsKCioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgLy8gdXNlIG93biBuYW1lc3BhY2UgZm9yIHBsdWdpbgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzID0gZnVuY3Rpb24oKSB7fTsKCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuU1lOQ19ERUxBWSA9IDUwMDA7CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLktFWV9PVEhFUl9CS01SSyA9ICdpZE90aGVycyc7CiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuS0VZX1NUT1JBR0UgPSAncGx1Z2luLWJvb2ttYXJrcyc7CiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuS0VZX1NUQVRVU19CT1ggPSAncGx1Z2luLWJvb2ttYXJrcy1ib3gnOwoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5LRVkgPSB7a2V5OiB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5LRVlfU1RPUkFHRSwgZmllbGQ6ICdia21ya3NPYmonfTsKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5VUERBVEVfUVVFVUUgPSB7a2V5OiAncGx1Z2luLWJvb2ttYXJrcy1xdWV1ZScsIGZpZWxkOiAndXBkYXRlUXVldWUnfTsKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5VUERBVElOR19RVUVVRSA9IHtrZXk6ICdwbHVnaW4tYm9va21hcmtzLXVwZGF0aW5nLXF1ZXVlJywgZmllbGQ6ICd1cGRhdGluZ1F1ZXVlJ307CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmJrbXJrc09iaiA9IHt9OwogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXR1c0JveCA9IHt9OwogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnVwZGF0ZVF1ZXVlID0ge307CiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MudXBkYXRpbmdRdWV1ZSA9IHt9OwoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5lbmFibGVTeW5jID0gZmFsc2U7CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXJMYXllcnMgPSB7fTsKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdGFyTGF5ZXJHcm91cCA9IG51bGw7CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmlzU21hcnQgPSB1bmRlZmluZWQ7CiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuaXNBbmRyb2lkID0gZnVuY3Rpb24oKSB7CiAgICBpZih0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAvLyBHZW5lcmF0ZSBhbiBJRCBmb3IgdGhlIGJvb2ttYXJrIChkYXRlIHRpbWUgKyByYW5kb20gbnVtYmVyKQogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmdlbmVyYXRlSUQgPSBmdW5jdGlvbigpIHsKICAgIHZhciBkID0gbmV3IERhdGUoKTsKICAgIHZhciBJRCA9IGQuZ2V0VGltZSgpKyhNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqOTkpKzEpOwogICAgdmFyIElEID0gJ2lkJytJRC50b1N0cmluZygpOwogICAgcmV0dXJuIElEOwogIH0KCiAgLy8gRm9ybWF0IHRoZSBzdHJpbmcKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5lc2NhcGVIdG1sID0gZnVuY3Rpb24odGV4dCkgewogICAgcmV0dXJuIHRleHQKICAgICAgICAucmVwbGFjZSgvJi9nLCAiJmFtcDsiKQogICAgICAgIC5yZXBsYWNlKC88L2csICImbHQ7IikKICAgICAgICAucmVwbGFjZSgvPi9nLCAiJmd0OyIpCiAgICAgICAgLnJlcGxhY2UoLyIvZywgIiZxdW90OyIpCiAgICAgICAgLnJlcGxhY2UoLycvZywgIiYjMDM5OyIpCiAgICAgICAgLnJlcGxhY2UoL1wvL2csICcmIzQ3OycpCiAgICAgICAgLnJlcGxhY2UoL1xcL2csICcmIzkyOycpOwogIH0KCiAgLy8gVXBkYXRlIHRoZSBsb2NhbFN0b3JhZ2UKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zYXZlU3RvcmFnZSA9IGZ1bmN0aW9uKCkgewogICAgbG9jYWxTdG9yYWdlW3BsdWdpbi5ib29rbWFya3MuS0VZX1NUT1JBR0VdID0gSlNPTi5zdHJpbmdpZnkod2luZG93LnBsdWdpbi5ib29rbWFya3MuYmttcmtzT2JqKTsKICB9CiAgLy8gTG9hZCB0aGUgbG9jYWxTdG9yYWdlCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MubG9hZFN0b3JhZ2UgPSBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmJrbXJrc09iaiA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlW3BsdWdpbi5ib29rbWFya3MuS0VZX1NUT1JBR0VdKTsKICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnNhdmVTdG9yYWdlQm94ID0gZnVuY3Rpb24oKSB7CiAgICBsb2NhbFN0b3JhZ2VbcGx1Z2luLmJvb2ttYXJrcy5LRVlfU1RBVFVTX0JPWF0gPSBKU09OLnN0cmluZ2lmeSh3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdGF0dXNCb3gpOwogIH0KICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5sb2FkU3RvcmFnZUJveCA9IGZ1bmN0aW9uKCkgewogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc3RhdHVzQm94ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbcGx1Z2luLmJvb2ttYXJrcy5LRVlfU1RBVFVTX0JPWF0pOwogIH0KCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MudXBncmFkZVRvTmV3U3RvcmFnZSA9IGZ1bmN0aW9uKCkgewogICAgaWYobG9jYWxTdG9yYWdlWydwbHVnaW4tYm9va21hcmtzLXBvcnRhbHMtZGF0YSddICYmIGxvY2FsU3RvcmFnZVsncGx1Z2luLWJvb2ttYXJrcy1tYXBzLWRhdGEnXSkgewogICAgICB2YXIgb2xkU3Rvcl8xID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbJ3BsdWdpbi1ib29rbWFya3MtbWFwcy1kYXRhJ10pOwogICAgICB2YXIgb2xkU3Rvcl8yID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbJ3BsdWdpbi1ib29rbWFya3MtcG9ydGFscy1kYXRhJ10pOwoKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuYmttcmtzT2JqLm1hcHMgPSBvbGRTdG9yXzEuYmttcmtfbWFwczsKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuYmttcmtzT2JqLnBvcnRhbHMgPSBvbGRTdG9yXzIuYmttcmtfcG9ydGFsczsKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2F2ZVN0b3JhZ2UoKTsKCiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdwbHVnaW4tYm9va21hcmtzLW1hcHMtZGF0YScpOwogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncGx1Z2luLWJvb2ttYXJrcy1wb3J0YWxzLWRhdGEnKTsKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3BsdWdpbi1ib29rbWFya3Mtc3RhdHVzLWJveCcpOwogICAgfQogIH0KCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuY3JlYXRlU3RvcmFnZSA9IGZ1bmN0aW9uKCkgewogICAgaWYoIWxvY2FsU3RvcmFnZVt3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5LRVlfU1RPUkFHRV0pIHsKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuYmttcmtzT2JqLm1hcHMgPSB7aWRPdGhlcnM6e2xhYmVsOiJPdGhlcnMiLHN0YXRlOjEsYmttcms6e319fTsKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuYmttcmtzT2JqLnBvcnRhbHMgPSB7aWRPdGhlcnM6e2xhYmVsOiJPdGhlcnMiLHN0YXRlOjEsYmttcms6e319fTsKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2F2ZVN0b3JhZ2UoKTsKICAgIH0KICAgIGlmKCFsb2NhbFN0b3JhZ2Vbd2luZG93LnBsdWdpbi5ib29rbWFya3MuS0VZX1NUQVRVU19CT1hdKSB7CiAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXR1c0JveC5zaG93ID0gMTsKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc3RhdHVzQm94LnBhZ2UgPSAwOwogICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdGF0dXNCb3gucG9zID0ge3g6MTAwLHk6MTAwfTsKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2F2ZVN0b3JhZ2VCb3goKTsKICAgIH0KICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnJlZnJlc2hCa21ya3MgPSBmdW5jdGlvbigpIHsKICAgICQoJyNia21ya19tYXBzID4gdWwsICNia21ya19wb3J0YWxzID4gdWwnKS5yZW1vdmUoKTsKCiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5sb2FkU3RvcmFnZSgpOwogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MubG9hZExpc3QoJ21hcHMnKTsKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmxvYWRMaXN0KCdwb3J0YWxzJyk7CgogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MudXBkYXRlU3RhclBvcnRhbCgpOwogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuanF1ZXJ5U29ydGFibGVTY3JpcHQoKTsKICB9CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAvLyBTaG93L2hpZGUgdGhlIGJvb2ttYXJrcyBib3gKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zd2l0Y2hTdGF0dXNCa21ya3NCb3ggPSBmdW5jdGlvbihzdGF0dXMpIHsKICAgIHZhciBuZXdTdGF0dXMgPSBzdGF0dXM7CgogICAgaWYobmV3U3RhdHVzID09PSAnc3dpdGNoJykgewogICAgICBpZih3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdGF0dXNCb3guc2hvdyA9PT0gMSkgewogICAgICAgIG5ld1N0YXR1cyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV3U3RhdHVzID0gMTsKICAgICAgfQogICAgfQoKICAgIGlmKG5ld1N0YXR1cyA9PT0gMSkgewogICAgICAkKCcjYm9va21hcmtzQm94JykuY3NzKCdoZWlnaHQnLCAnYXV0bycpOwogICAgICAkKCcjYmttcmtzVHJpZ2dlcicpLmNzcygnaGVpZ2h0JywgJzAnKTsKICAgIH0gZWxzZSB7CiAgICAgICQoJyNia21ya3NUcmlnZ2VyJykuY3NzKCdoZWlnaHQnLCAnNjRweCcpOwogICAgICAkKCcjYm9va21hcmtzQm94JykuY3NzKCdoZWlnaHQnLCAnMCcpOwogICAgfQoKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXR1c0JveFsnc2hvdyddID0gbmV3U3RhdHVzOwogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2F2ZVN0b3JhZ2VCb3goKTsKICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9uUGFuZUNoYW5nZWQgPSBmdW5jdGlvbihwYW5lKSB7CiAgICBpZihwYW5lID09ICJwbHVnaW4tYm9va21hcmtzIikKICAgICAgJCgnI2Jvb2ttYXJrc0JveCcpLmNzcygiZGlzcGxheSIsICIiKTsKICAgIGVsc2UKICAgICAgJCgnI2Jvb2ttYXJrc0JveCcpLmNzcygiZGlzcGxheSIsICJub25lIik7CiAgfQoKICAvLyBTd2l0Y2ggbGlzdCAobWFwcy9wb3J0YWxzKQogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN3aXRjaFBhZ2VCa21ya3NCb3ggPSBmdW5jdGlvbihlbGVtLCBwYWdlKSB7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdGF0dXNCb3gucGFnZSA9IHBhZ2U7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zYXZlU3RvcmFnZUJveCgpOwoKICAgICQoJ2g1JykucmVtb3ZlQ2xhc3MoJ2N1cnJlbnQnKTsKICAgICQoZWxlbSkuYWRkQ2xhc3MoJ2N1cnJlbnQnKTsKCiAgICB2YXIgc2VjdExpc3QgPSAnIycrJChlbGVtKS5hdHRyKCdjbGFzcycpLnJlcGxhY2UoJyBjdXJyZW50JywgJycpOwogICAgJCgnI2Jvb2ttYXJrc0JveCAuYm9va21hcmtMaXN0JykucmVtb3ZlQ2xhc3MoJ2N1cnJlbnQnKTsKICAgICQoc2VjdExpc3QpLmFkZENsYXNzKCdjdXJyZW50Jyk7CiAgfQoKICAvLyBTd2l0Y2ggdGhlIHN0YXR1cyBmb2xkZXIgdG8gb3Blbi9jbG9zZSAoaW4gdGhlIGxvY2FsU3RvcmFnZSkKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5vcGVuRm9sZGVyID0gZnVuY3Rpb24oZWxlbSkgewogICAgJChlbGVtKS5wYXJlbnQoKS5wYXJlbnQoJ2xpJykudG9nZ2xlQ2xhc3MoJ29wZW4nKTsKCiAgICB2YXIgdHlwZUxpc3QgPSAkKGVsZW0pLnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgnZGl2JykuYXR0cignaWQnKS5yZXBsYWNlKCdia21ya18nLCAnJyk7CiAgICB2YXIgSUQgPSAkKGVsZW0pLnBhcmVudCgpLnBhcmVudCgnbGknKS5hdHRyKCdpZCcpOwoKICAgIHZhciBuZXdGbGFnOwogICAgdmFyIGZsYWcgPSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmpbdHlwZUxpc3RdW0lEXVsnc3RhdGUnXTsKICAgIGlmKGZsYWcpIHsgbmV3RmxhZyA9IDA7IH0KICAgIGVsc2UgaWYoIWZsYWcpIHsgbmV3RmxhZyA9IDE7IH0KCiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmpbdHlwZUxpc3RdW0lEXVsnc3RhdGUnXSA9IG5ld0ZsYWc7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zYXZlU3RvcmFnZSgpOwogICAgd2luZG93LnJ1bkhvb2tzKCdwbHVnaW5Ca21ya3NFZGl0JywgeyJ0YXJnZXQiOiAiZm9sZGVyIiwgImFjdGlvbiI6IG5ld0ZsYWc/Im9wZW4iOiJjbG9zZSIsICJpZCI6IElEfSk7CiAgfQoKICAvLyBMb2FkIHRoZSBIVE1MIGJvb2ttYXJrcwogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmxvYWRMaXN0ID0gZnVuY3Rpb24odHlwZUxpc3QpIHsKICAgIHZhciBlbGVtZW50ID0gJyc7CiAgICB2YXIgZWxlbWVudFRlbXAgPSAnJzsKICAgIHZhciBlbGVtZW50RXhjID0gJyc7CiAgICB2YXIgcmV0dXJuVG9NYXAgPSAnJzsKCiAgICBpZih3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5pc1NtYXJ0KSB7CiAgICAgIHJldHVyblRvTWFwID0gJ3dpbmRvdy5zaG93KFwnbWFwXCcpOyc7CiAgICB9CgogICAgLy8gRm9yIGVhY2ggZm9sZGVyCiAgICB2YXIgbGlzdCA9IHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmJrbXJrc09ialt0eXBlTGlzdF07CgogICAgZm9yKHZhciBpZEZvbGRlcnMgaW4gbGlzdCkgewogICAgICB2YXIgZm9sZGVycyA9IGxpc3RbaWRGb2xkZXJzXTsKICAgICAgdmFyIGFjdGl2ZSA9ICcnOwoKICAgICAgLy8gQ3JlYXRlIGEgbGFiZWwgYW5kIGEgYW5jaG9yIGZvciB0aGUgc29ydGFibGUKICAgICAgdmFyIGZvbGRlckRlbGV0ZSA9ICc8c3BhbiBjbGFzcz0iZm9sZGVyTGFiZWwiPjxhIGNsYXNzPSJib29rbWFya3NSZW1vdmVGcm9tIiBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5yZW1vdmVFbGVtZW50KHRoaXMsIFwnZm9sZGVyXCcpO3JldHVybiBmYWxzZTsiIHRpdGxlPSJSZW1vdmUgdGhpcyBmb2xkZXIiPlg8L2E+JzsKICAgICAgdmFyIGZvbGRlck5hbWUgPSAnPGEgY2xhc3M9ImJvb2ttYXJrc0FuY2hvciIgb25jbGljaz0id2luZG93LnBsdWdpbi5ib29rbWFya3Mub3BlbkZvbGRlcih0aGlzKTtyZXR1cm4gZmFsc2UiPjxzcGFuPjwvc3Bhbj4nK2ZvbGRlcnNbJ2xhYmVsJ10rJzwvYT48L3NwYW4+JzsvLzxzcGFuPjxzcGFuPjwvc3Bhbj48L3NwYW4+JzsKICAgICAgdmFyIGZvbGRlckxhYmVsID0gZm9sZGVyRGVsZXRlK2ZvbGRlck5hbWU7CgogICAgICBpZihmb2xkZXJzWydzdGF0ZSddKSB7IGFjdGl2ZSA9ICcgb3Blbic7IH0KICAgICAgaWYoaWRGb2xkZXJzID09PSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5LRVlfT1RIRVJfQktNUkspIHsKICAgICAgICBmb2xkZXJMYWJlbCA9ICcnOwogICAgICAgIGFjdGl2ZT0gJyBvdGhlcnNCb29rbWFya3Mgb3Blbic7CiAgICAgIH0KICAgICAgLy8gQ3JlYXRlIGEgZm9sZGVyCiAgICAgIGVsZW1lbnRUZW1wID0gJzxsaSBjbGFzcz0iYm9va21hcmtGb2xkZXInK2FjdGl2ZSsnIiBpZD0iJytpZEZvbGRlcnMrJyI+Jytmb2xkZXJMYWJlbCsnPHVsPic7CgogICAgICAvLyBGb3IgZWFjaCBib29rbWFyawogICAgICB2YXIgZm9sZCA9IGZvbGRlcnNbJ2JrbXJrJ107CiAgICAgIGZvcih2YXIgaWRCa21yayBpbiBmb2xkKSB7CiAgICAgICAgdmFyIGJ0bl9saW5rOwogICAgICAgIHZhciBidG5fcmVtb3ZlID0gJzxhIGNsYXNzPSJib29rbWFya3NSZW1vdmVGcm9tIiBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5yZW1vdmVFbGVtZW50KHRoaXMsIFwnJyt0eXBlTGlzdCsnXCcpO3JldHVybiBmYWxzZTsiIHRpdGxlPSJSZW1vdmUgZnJvbSBib29rbWFya3MiPlg8L2E+JzsKCiAgICAgICAgdmFyIGJ0bl9tb3ZlID0gJyc7CiAgICAgICAgaWYod2luZG93LnBsdWdpbi5ib29rbWFya3MuaXNTbWFydCkgewogICAgICAgICAgYnRuX21vdmUgPSAnPGEgY2xhc3M9ImJvb2ttYXJrc01vdmVJbiIgb25jbGljaz0id2luZG93LnBsdWdpbi5ib29rbWFya3MuZGlhbG9nTW9iaWxlU29ydChcJycrdHlwZUxpc3QrJ1wnLCB0aGlzKTtyZXR1cm4gZmFsc2U7Ij49PC9hPic7CiAgICAgICAgfQoKICAgICAgICB2YXIgYmttcmsgPSBmb2xkW2lkQmttcmtdOwogICAgICAgIHZhciBsYWJlbCA9IGJrbXJrWydsYWJlbCddOwogICAgICAgIHZhciBsYXRsbmcgPSBia21ya1snbGF0bG5nJ107CgogICAgICAgIC8vIElmIGl0J3MgYSBtYXAKICAgICAgICBpZih0eXBlTGlzdCA9PT0gJ21hcHMnKSB7CiAgICAgICAgICBpZihia21ya1snbGFiZWwnXT09JycpIHsgbGFiZWwgPSBia21ya1snbGF0bG5nJ10rJyBbJytia21ya1sneiddKyddJzsgfQogICAgICAgICAgYnRuX2xpbmsgPSAnPGEgY2xhc3M9ImJvb2ttYXJrc0xpbmsiIG9uY2xpY2s9IicrcmV0dXJuVG9NYXArJ3dpbmRvdy5tYXAuc2V0VmlldyhbJytsYXRsbmcrJ10sICcrYmttcmtbJ3onXSsnKTtyZXR1cm4gZmFsc2U7Ij4nK2xhYmVsKyc8L2E+JzsKICAgICAgICB9CiAgICAgICAgLy8gSWYgaXQncyBhIHBvcnRhbAogICAgICAgIGVsc2UgaWYodHlwZUxpc3QgPT09ICdwb3J0YWxzJykgewogICAgICAgICAgdmFyIGd1aWQgPSBia21ya1snZ3VpZCddOwogICAgICAgICAgdmFyIGJ0bl9saW5rID0gJzxhIGNsYXNzPSJib29rbWFya3NMaW5rIiBvbmNsaWNrPSIkKFwnYS5ib29rbWFya3NMaW5rLnNlbGVjdGVkXCcpLnJlbW92ZUNsYXNzKFwnc2VsZWN0ZWRcJyk7JytyZXR1cm5Ub01hcCsnd2luZG93Lnpvb21Ub0FuZFNob3dQb3J0YWwoXCcnK2d1aWQrJ1wnLCBbJytsYXRsbmcrJ10pO3JldHVybiBmYWxzZTsiPicrbGFiZWwrJzwvYT4nOwogICAgICAgIH0KICAgICAgICAvLyBDcmVhdGUgdGhlIGJvb2ttYXJrCiAgICAgICAgZWxlbWVudFRlbXAgKz0gJzxsaSBjbGFzcz0iYmttcmsiIGlkPSInK2lkQmttcmsrJyI+JytidG5fcmVtb3ZlK2J0bl9tb3ZlK2J0bl9saW5rKyc8L2xpPic7CiAgICAgIH0KICAgICAgZWxlbWVudFRlbXAgKz0gJzwvbGk+PC91bD4nOwoKICAgICAgLy8gQWRkIGZvbGRlciAnT3RoZXJzJyBpbiBsYXN0IHBvc2l0aW9uCiAgICAgIGlmKGlkRm9sZGVycyAhPSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5LRVlfT1RIRVJfQktNUkspIHsgZWxlbWVudCArPSBlbGVtZW50VGVtcDsgfQogICAgICBlbHNleyBlbGVtZW50RXhjID0gZWxlbWVudFRlbXA7IH0KICAgIH0KICAgIGVsZW1lbnQgKz0gZWxlbWVudEV4YzsKICAgIGVsZW1lbnQgPSAnPHVsPicrZWxlbWVudCsnPC91bD4nOwoKICAgIC8vIEFwcGVuZCBhbGwgZm9sZGVycyBhbmQgYm9va21hcmtzCiAgICAkKCcjYmttcmtfJyt0eXBlTGlzdCkuYXBwZW5kKGVsZW1lbnQpOwogIH0KCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmZpbmRCeUd1aWQgPSBmdW5jdGlvbihndWlkKSB7CiAgICB2YXIgbGlzdCA9IHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmJrbXJrc09ialsncG9ydGFscyddOwoKICAgIGZvcih2YXIgaWRGb2xkZXJzIGluIGxpc3QpIHsKICAgICAgZm9yKHZhciBpZEJrbXJrIGluIGxpc3RbaWRGb2xkZXJzXVsnYmttcmsnXSkgewogICAgICAgIHZhciBwb3J0YWxHdWlkID0gbGlzdFtpZEZvbGRlcnNdWydia21yayddW2lkQmttcmtdWydndWlkJ107CiAgICAgICAgaWYoZ3VpZCA9PT0gcG9ydGFsR3VpZCkgewogICAgICAgICAgcmV0dXJuIHsiaWRfZm9sZGVyIjppZEZvbGRlcnMsImlkX2Jvb2ttYXJrIjppZEJrbXJrfTsKICAgICAgICB9CiAgICAgICB9CiAgICB9CiAgICByZXR1cm47CiAgfQoKICAvLyBBcHBlbmQgYSAnc3RhcicgZmxhZyBpbiBzaWRlYmFyLgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9uUG9ydGFsU2VsZWN0ZWRQZW5kaW5nID0gZmFsc2U7CiAgd2luZG93LnBsdWdpbi5ib29rbWFya3Mub25Qb3J0YWxTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewogICAgJCgnLmJrbXJrc1N0YXInKS5yZW1vdmUoKTsKCiAgICBpZih3aW5kb3cuc2VsZWN0ZWRQb3J0YWwgPT0gbnVsbCkgcmV0dXJuOwoKICAgIGlmICghd2luZG93LnBsdWdpbi5ib29rbWFya3Mub25Qb3J0YWxTZWxlY3RlZFBlbmRpbmcpIHsKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Mub25Qb3J0YWxTZWxlY3RlZFBlbmRpbmcgPSB0cnVlOwoKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgLy8gdGhlIHNpZGViYXIgaXMgY29uc3RydWN0ZWQgYWZ0ZXIgZmlyaW5nIHRoZSBob29rCiAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Mub25Qb3J0YWxTZWxlY3RlZFBlbmRpbmcgPSBmYWxzZTsKCiAgICAgICAgJCgnLmJrbXJrc1N0YXInKS5yZW1vdmUoKTsKCiAgICAgICAgaWYodHlwZW9mKFN0b3JhZ2UpID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgJCgnI3BvcnRhbGRldGFpbHMgPiAuaW1ncHJldmlldycpLmFmdGVyKHBsdWdpbi5ib29rbWFya3MuaHRtbERpc2FibGVkTWVzc2FnZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBQcmVwZW5kIGEgc3RhciB0byBtb2JpbGUgc3RhdHVzLWJhcgogICAgICAgIGlmKHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmlzU21hcnQpIHsKICAgICAgICAgICQoJyN1cGRhdGVzdGF0dXMnKS5wcmVwZW5kKHBsdWdpbi5ib29rbWFya3MuaHRtbFN0YXIpOwogICAgICAgICAgJCgnI3VwZGF0ZXN0YXR1cyAuYmttcmtzU3RhcicpLmF0dHIoJ3RpdGxlJywgJycpOwogICAgICAgIH0KCiAgICAgICAgJCgnI3BvcnRhbGRldGFpbHMgPiBoMy50aXRsZScpLmJlZm9yZShwbHVnaW4uYm9va21hcmtzLmh0bWxTdGFyKTsKICAgICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy51cGRhdGVTdGFyUG9ydGFsKCk7CiAgICAgIH0sIDApOwogICAgfQoKICB9CgogIC8vIFVwZGF0ZSB0aGUgc3RhdHVzIG9mIHRoZSBzdGFyICh3aGVuIGEgcG9ydGFsIGlzIHNlbGVjdGVkIGZyb20gdGhlIG1hcC9ib29rbWFya3MtbGlzdCkKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy51cGRhdGVTdGFyUG9ydGFsID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZ3VpZCA9IHdpbmRvdy5zZWxlY3RlZFBvcnRhbDsKICAgICQoJy5ia21ya3NTdGFyJykucmVtb3ZlQ2xhc3MoJ2Zhdm9yaXRlJyk7CiAgICAkKCcuYmttcmsgYS5ib29rbWFya3NMaW5rLnNlbGVjdGVkJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7CgogICAgLy8gSWYgY3VycmVudCBwb3J0YWwgaXMgaW50byBib29rbWFya3M6IHNlbGVjdCBib29rbWFyayBwb3J0YWwgZnJvbSBwb3J0YWxzIGxpc3QgYW5kIHNlbGVjdCB0aGUgc3RhcgogICAgaWYobG9jYWxTdG9yYWdlW3dpbmRvdy5wbHVnaW4uYm9va21hcmtzLktFWV9TVE9SQUdFXS5zZWFyY2goZ3VpZCkgIT0gLTEpIHsKICAgICAgdmFyIGJrbXJrRGF0YSA9IHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmZpbmRCeUd1aWQoZ3VpZCk7CiAgICAgIGlmKGJrbXJrRGF0YSkgewogICAgICAgICQoJy5ia21yayMnK2JrbXJrRGF0YVsnaWRfYm9va21hcmsnXSsnIGEuYm9va21hcmtzTGluaycpLmFkZENsYXNzKCdzZWxlY3RlZCcpOwogICAgICAgICQoJy5ia21ya3NTdGFyJykuYWRkQ2xhc3MoJ2Zhdm9yaXRlJyk7CiAgICAgIH0KICAgIH0KICB9CgogIC8vIFN3aXRjaCB0aGUgc3RhdHVzIG9mIHRoZSBzdGFyCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc3dpdGNoU3RhclBvcnRhbCA9IGZ1bmN0aW9uKGd1aWQpIHsKICAgIGlmKGd1aWQgPT0gdW5kZWZpbmVkKSBndWlkID0gd2luZG93LnNlbGVjdGVkUG9ydGFsOwoKICAgIC8vIElmIHBvcnRhbCBpcyBzYXZlZCBpbiBib29rbWFya3M6IFJlbW92ZSB0aGlzIGJvb2ttYXJrCiAgICB2YXIgYmttcmtEYXRhID0gd2luZG93LnBsdWdpbi5ib29rbWFya3MuZmluZEJ5R3VpZChndWlkKTsKICAgIGlmKGJrbXJrRGF0YSkgewogICAgICB2YXIgbGlzdCA9IHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmJrbXJrc09ialsncG9ydGFscyddOwogICAgICBkZWxldGUgbGlzdFtia21ya0RhdGFbJ2lkX2ZvbGRlciddXVsnYmttcmsnXVtia21ya0RhdGFbJ2lkX2Jvb2ttYXJrJ11dOwogICAgICAkKCcuYmttcmsjJytia21ya0RhdGFbJ2lkX2Jvb2ttYXJrJ10rJycpLnJlbW92ZSgpOwoKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2F2ZVN0b3JhZ2UoKTsKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MudXBkYXRlU3RhclBvcnRhbCgpOwoKICAgICAgd2luZG93LnJ1bkhvb2tzKCdwbHVnaW5Ca21ya3NFZGl0JywgeyJ0YXJnZXQiOiAicG9ydGFsIiwgImFjdGlvbiI6ICJyZW1vdmUiLCAiZm9sZGVyIjogYmttcmtEYXRhWydpZF9mb2xkZXInXSwgImlkIjogYmttcmtEYXRhWydpZF9ib29rbWFyayddLCAiZ3VpZCI6Z3VpZH0pOwogICAgICBjb25zb2xlLmxvZygnQk9PS01BUktTOiByZW1vdmVkIHBvcnRhbCAoJytia21ya0RhdGFbJ2lkX2Jvb2ttYXJrJ10rJyBzaXR1YXRlZCBpbiAnK2JrbXJrRGF0YVsnaWRfZm9sZGVyJ10rJyBmb2xkZXIpJyk7CiAgICB9CiAgICAvLyBJZiBwb3J0YWwgaXNuJ3Qgc2F2ZWQgaW4gYm9va21hcmtzOiBBZGQgdGhpcyBib29rbWFyawogICAgZWxzZXsKICAgICAgLy8gR2V0IHBvcnRhbCBuYW1lIGFuZCBjb29yZGluYXRlcwogICAgICB2YXIgcCA9IHdpbmRvdy5wb3J0YWxzW2d1aWRdOwogICAgICB2YXIgbGwgPSBwLmdldExhdExuZygpOwogICAgICBwbHVnaW4uYm9va21hcmtzLmFkZFBvcnRhbEJvb2ttYXJrKGd1aWQsIGxsLmxhdCsnLCcrbGwubG5nLCBwLm9wdGlvbnMuZGF0YS50aXRsZSk7CiAgICB9CiAgfQoKICBwbHVnaW4uYm9va21hcmtzLmFkZFBvcnRhbEJvb2ttYXJrID0gZnVuY3Rpb24oZ3VpZCwgbGF0bG5nLCBsYWJlbCkgewogICAgdmFyIElEID0gd2luZG93LnBsdWdpbi5ib29rbWFya3MuZ2VuZXJhdGVJRCgpOwoKICAgIC8vIEFkZCBib29rbWFyayBpbiB0aGUgbG9jYWxTdG9yYWdlCiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmpbJ3BvcnRhbHMnXVt3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5LRVlfT1RIRVJfQktNUktdWydia21yayddW0lEXSA9IHsiZ3VpZCI6Z3VpZCwibGF0bG5nIjpsYXRsbmcsImxhYmVsIjpsYWJlbH07CgogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2F2ZVN0b3JhZ2UoKTsKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnJlZnJlc2hCa21ya3MoKTsKICAgIHdpbmRvdy5ydW5Ib29rcygncGx1Z2luQmttcmtzRWRpdCcsIHsidGFyZ2V0IjogInBvcnRhbCIsICJhY3Rpb24iOiAiYWRkIiwgImlkIjogSUQsICJndWlkIjogZ3VpZH0pOwogICAgY29uc29sZS5sb2coJ0JPT0tNQVJLUzogYWRkZWQgcG9ydGFsICcrSUQpOwogIH0KCiAgLy8gQWRkIEJPT0tNQVJLL0ZPTERFUgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmFkZEVsZW1lbnQgPSBmdW5jdGlvbihlbGVtLCB0eXBlKSB7CiAgICB2YXIgSUQgPSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5nZW5lcmF0ZUlEKCk7CiAgICB2YXIgdHlwZUxpc3QgPSAkKGVsZW0pLnBhcmVudCgpLnBhcmVudCgnZGl2JykuYXR0cignaWQnKTsKCiAgICAvLyBHZXQgdGhlIGxhYmVsIHwgQ29udmVydCBzb21lIGNoYXJhY3RlcnMgfCBTZXQgdGhlIGlucHV0IChlbXB0eSkKICAgIHZhciBpbnB1dCA9ICcjJyt0eXBlTGlzdCsnIC5hZGRGb3JtIGlucHV0JzsKICAgIHZhciBsYWJlbCA9ICQoaW5wdXQpLnZhbCgpOwogICAgbGFiZWwgPSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5lc2NhcGVIdG1sKGxhYmVsKTsKICAgICQoaW5wdXQpLnZhbCgnJyk7CgogICAgLy8gQWRkIGEgbWFwCiAgICBpZih0eXBlID09PSAnbWFwJykgewogICAgICAvLyBHZXQgdGhlIGNvb3JkaW5hdGVzIGFuZCB6b29tCiAgICAgIHZhciBjID0gbWFwLmdldENlbnRlcigpOwogICAgICB2YXIgbGF0ID0gTWF0aC5yb3VuZChjLmxhdCoxRTYpLzFFNjsKICAgICAgdmFyIGxuZyA9IE1hdGgucm91bmQoYy5sbmcqMUU2KS8xRTY7CiAgICAgIHZhciBsYXRsbmcgPSBsYXQrJywnK2xuZzsKICAgICAgdmFyIHpvb20gPSBwYXJzZUludChtYXAuZ2V0Wm9vbSgpKTsKICAgICAgLy8gQWRkIGJvb2ttYXJrIGluIHRoZSBsb2NhbFN0b3JhZ2UKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuYmttcmtzT2JqWydtYXBzJ11bcGx1Z2luLmJvb2ttYXJrcy5LRVlfT1RIRVJfQktNUktdWydia21yayddW0lEXSA9IHsibGFiZWwiOmxhYmVsLCJsYXRsbmciOmxhdGxuZywieiI6em9vbX07CiAgICB9CiAgICBlbHNlewogICAgICBpZihsYWJlbCA9PT0gJycpIHsgbGFiZWwgPSAnRm9sZGVyJzsgfQogICAgICB2YXIgc2hvcnRfdHlwZSA9IHR5cGVMaXN0LnJlcGxhY2UoJ2JrbXJrXycsICcnKTsKICAgICAgLy8gQWRkIG5ldyBmb2xkZXIgaW4gdGhlIGxvY2FsU3RvcmFnZQogICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmpbc2hvcnRfdHlwZV1bSURdID0geyJsYWJlbCI6bGFiZWwsInN0YXRlIjoxLCJia21yayI6e319OwogICAgfQogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2F2ZVN0b3JhZ2UoKTsKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnJlZnJlc2hCa21ya3MoKTsKICAgIHdpbmRvdy5ydW5Ib29rcygncGx1Z2luQmttcmtzRWRpdCcsIHsidGFyZ2V0IjogdHlwZSwgImFjdGlvbiI6ICJhZGQiLCAiaWQiOiBJRH0pOwogICAgY29uc29sZS5sb2coJ0JPT0tNQVJLUzogYWRkZWQgJyt0eXBlKycgJytJRCk7CiAgfQoKICAvLyBSZW1vdmUgQk9PS01BUksvRk9MREVSCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MucmVtb3ZlRWxlbWVudCA9IGZ1bmN0aW9uKGVsZW0sIHR5cGUpIHsKICAgIGlmKHR5cGUgPT09ICdtYXBzJyB8fCB0eXBlID09PSAncG9ydGFscycpIHsKICAgICAgdmFyIHR5cGVMaXN0ID0gJChlbGVtKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoJ2RpdicpLmF0dHIoJ2lkJyk7CiAgICAgIHZhciBJRCA9ICQoZWxlbSkucGFyZW50KCdsaScpLmF0dHIoJ2lkJyk7CiAgICAgIHZhciBJRGZvbGQgPSAkKGVsZW0pLnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgnbGknKS5hdHRyKCdpZCcpOwogICAgICB2YXIgZ3VpZCA9IHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmJrbXJrc09ialt0eXBlTGlzdC5yZXBsYWNlKCdia21ya18nLCAnJyldW0lEZm9sZF1bJ2JrbXJrJ11bSURdLmd1aWQ7CgogICAgICBkZWxldGUgd2luZG93LnBsdWdpbi5ib29rbWFya3MuYmttcmtzT2JqW3R5cGVMaXN0LnJlcGxhY2UoJ2JrbXJrXycsICcnKV1bSURmb2xkXVsnYmttcmsnXVtJRF07CiAgICAgICQoZWxlbSkucGFyZW50KCdsaScpLnJlbW92ZSgpOwoKICAgICAgaWYodHlwZSA9PT0gJ3BvcnRhbHMnKSB7CiAgICAgICAgdmFyIGxpc3QgPSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmpbJ3BvcnRhbHMnXTsKCiAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MudXBkYXRlU3RhclBvcnRhbCgpOwogICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnNhdmVTdG9yYWdlKCk7CgogICAgICAgIHdpbmRvdy5ydW5Ib29rcygncGx1Z2luQmttcmtzRWRpdCcsIHsidGFyZ2V0IjogInBvcnRhbCIsICJhY3Rpb24iOiAicmVtb3ZlIiwgImZvbGRlciI6IElEZm9sZCwgImlkIjogSUQsICJndWlkIjogZ3VpZH0pOwogICAgICAgIGNvbnNvbGUubG9nKCdCT09LTUFSS1M6IHJlbW92ZWQgcG9ydGFsICgnK0lEKycgc2l0dWF0ZWQgaW4gJytJRGZvbGQrJyBmb2xkZXIpJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2F2ZVN0b3JhZ2UoKTsKICAgICAgICB3aW5kb3cucnVuSG9va3MoJ3BsdWdpbkJrbXJrc0VkaXQnLCB7InRhcmdldCI6ICJtYXAiLCAiYWN0aW9uIjogInJlbW92ZSIsICJpZCI6IElEfSk7CiAgICAgICAgY29uc29sZS5sb2coJ0JPT0tNQVJLUzogcmVtb3ZlZCBtYXAgJytJRCk7CiAgICAgIH0KICAgIH0KICAgIGVsc2UgaWYodHlwZSA9PT0gJ2ZvbGRlcicpIHsKICAgICAgdmFyIHR5cGVMaXN0ID0gJChlbGVtKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoJ2RpdicpLmF0dHIoJ2lkJyk7CiAgICAgIHZhciBJRCA9ICQoZWxlbSkucGFyZW50KCkucGFyZW50KCdsaScpLmF0dHIoJ2lkJyk7CgogICAgICBkZWxldGUgcGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmpbdHlwZUxpc3QucmVwbGFjZSgnYmttcmtfJywgJycpXVtJRF07CiAgICAgICQoZWxlbSkucGFyZW50KCkucGFyZW50KCdsaScpLnJlbW92ZSgpOwogICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zYXZlU3RvcmFnZSgpOwogICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy51cGRhdGVTdGFyUG9ydGFsKCk7CiAgICAgIHdpbmRvdy5ydW5Ib29rcygncGx1Z2luQmttcmtzRWRpdCcsIHsidGFyZ2V0IjogImZvbGRlciIsICJhY3Rpb24iOiAicmVtb3ZlIiwgImlkIjogSUR9KTsKICAgICAgY29uc29sZS5sb2coJ0JPT0tNQVJLUzogcmVtb3ZlZCBmb2xkZXIgJytJRCk7CiAgICB9CiAgfQoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5kZWxldGVNb2RlID0gZnVuY3Rpb24oKSB7CiAgICAkKCcjYm9va21hcmtzQm94JykucmVtb3ZlQ2xhc3MoJ21vdmVNb2RlJykudG9nZ2xlQ2xhc3MoJ2RlbGV0ZU1vZGUnKTsKICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm1vdmVNb2RlID0gZnVuY3Rpb24oKSB7CiAgICAkKCcjYm9va21hcmtzQm94JykucmVtb3ZlQ2xhc3MoJ2RlbGV0ZU1vZGUnKS50b2dnbGVDbGFzcygnbW92ZU1vZGUnKTsKICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm1vYmlsZVNvcnRJRGIgPSAnJzsKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5tb2JpbGVTb3J0SURmID0gJyc7CiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuZGlhbG9nTW9iaWxlU29ydCA9IGZ1bmN0aW9uKHR5cGUsIGVsZW0pewogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MubW9iaWxlU29ydElEYiA9ICQoZWxlbSkucGFyZW50KCdsaS5ia21yaycpLmF0dHIoJ2lkJyk7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5tb2JpbGVTb3J0SURmID0gJChlbGVtKS5wYXJlbnQoJ2xpLmJrbXJrJykucGFyZW50KCd1bCcpLnBhcmVudCgnbGkuYm9va21hcmtGb2xkZXInKS5hdHRyKCdpZCcpOwoKICAgIGlmKHR5cGUgPT09ICdtYXBzJyl7IHR5cGUgPSAxOyB9CiAgICBlbHNlIGlmKHR5cGUgPT09ICdwb3J0YWxzJyl7IHR5cGUgPSAyOyB9CgogICAgZGlhbG9nKHsKICAgICAgaHRtbDogd2luZG93LnBsdWdpbi5ib29rbWFya3MuZGlhbG9nTG9hZExpc3RGb2xkZXJzKCdib29rbWFya3NEaWFsb2dNb2JpbGVTb3J0JywgJ3dpbmRvdy5wbHVnaW4uYm9va21hcmtzLm1vYmlsZVNvcnQnLCB0cnVlLCB0eXBlKSwKICAgICAgZGlhbG9nQ2xhc3M6ICd1aS1kaWFsb2ctYmttcmtzU2V0LWNvcHknLAogICAgICB0aXRsZTogJ0Jvb2ttYXJrcyAtIE1vdmUgQm9va21hcmsnCiAgICB9KTsKICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm1vYmlsZVNvcnQgPSBmdW5jdGlvbihlbGVtKXsKICAgIHZhciB0eXBlID0gJChlbGVtKS5kYXRhKCd0eXBlJyk7CiAgICB2YXIgaWRCa21yayA9IHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm1vYmlsZVNvcnRJRGI7CiAgICB2YXIgbmV3Rm9sZCA9ICQoZWxlbSkuZGF0YSgnaWQnKTsKICAgIHZhciBvbGRGb2xkID0gd2luZG93LnBsdWdpbi5ib29rbWFya3MubW9iaWxlU29ydElEZjsKCiAgICB2YXIgQmttcmsgPSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmpbdHlwZV1bb2xkRm9sZF0uYmttcmtbaWRCa21ya107CgogICAgZGVsZXRlIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmJrbXJrc09ialt0eXBlXVtvbGRGb2xkXS5ia21ya1tpZEJrbXJrXTsKCiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmpbdHlwZV1bbmV3Rm9sZF0uYmttcmtbaWRCa21ya10gPSBCa21yazsKCiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zYXZlU3RvcmFnZSgpOwogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MucmVmcmVzaEJrbXJrcygpOwogICAgd2luZG93LnJ1bkhvb2tzKCdwbHVnaW5Ca21ya3NFZGl0JywgeyJ0YXJnZXQiOiAiYm9va21hcmtzIiwgImFjdGlvbiI6ICJzb3J0In0pOwogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MubW9iaWxlU29ydElEZiA9IG5ld0ZvbGQ7CiAgICBjb25zb2xlLmxvZygnTW92ZSBCb29rbWFya3MgJyt0eXBlKycgSUQ6JytpZEJrbXJrKycgZnJvbSBmb2xkZXIgSUQ6JytvbGRGb2xkKycgdG8gZm9sZGVyIElEOicrbmV3Rm9sZCk7CiAgfQoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5vblNlYXJjaCA9IGZ1bmN0aW9uKHF1ZXJ5KSB7CiAgICB2YXIgdGVybSA9IHF1ZXJ5LnRlcm0udG9Mb3dlckNhc2UoKTsKCiAgICAkLmVhY2gocGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmoubWFwcywgZnVuY3Rpb24oaWQsIGZvbGRlcikgewogICAgICAkLmVhY2goZm9sZGVyLmJrbXJrLCBmdW5jdGlvbihpZCwgYm9va21hcmspIHsKICAgICAgICBpZihib29rbWFyay5sYWJlbC50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGVybSkgPT09IC0xKSByZXR1cm47CgogICAgICAgIHF1ZXJ5LmFkZFJlc3VsdCh7CiAgICAgICAgICB0aXRsZTogZXNjYXBlSHRtbFNwZWNpYWxDaGFycyhib29rbWFyay5sYWJlbCksCiAgICAgICAgICBkZXNjcmlwdGlvbjogJ01hcCBpbiBmb2xkZXIgIicgKyBlc2NhcGVIdG1sU3BlY2lhbENoYXJzKGZvbGRlci5sYWJlbCkgKyAnIicsCiAgICAgICAgICBpY29uOiAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFBd0FBQUFNQ0FZQUFBQldkVnpuQUFBQUJITkNTVlFJQ0FnSWZBaGtpQUFBQUFsd1NGbHpBQUFOMXdBQURkY0JRaWliZUFBQUFCbDBSVmgwVTI5bWRIZGhjbVVBZDNkM0xtbHVhM05qWVhCbExtOXlaNXZ1UEJvQUFBRFlTVVJCVkNpUmxkRXhMb1J4RUFYdzMzeFo0UUlLQjlCUVdQbDB5RktKQTRoQ28xQ3FYTUFCVkE2Z2Nna0ZuYzcvczdWUWFCeUFnb1lkaFUzc1pyOU5tR1NhZWUvTnZKZUpVa3I2UjNXZ3J1c1ltL2FqSjd6cjV0M291R21hckZyWHBGUHB1QTJhRkRTeElXeGpYei9tV3kyNWp4M2hFQXNxUzBOc0ZpLzY4WXhIbFhQSzhNS2JHd1I2R04wNmcwWGh3WXJyWDB0YitlbkpBUzViOHB6cDVnazVHTSt3bDEvQzFZUWdmRXdQUGJBK0pOM2lBZ01zVHhlRU9XbFhOemV0NXBIS0dsN0hPS1dVekV4LzZWSktkdmo1NElUM0tmVU52ck5aL2pZbSt1b0FBQUFBU1VWT1JLNUNZSUk9JywKICAgICAgICAgIHBvc2l0aW9uOiBMLmxhdExuZyhib29rbWFyay5sYXRsbmcuc3BsaXQoIiwiKSksCiAgICAgICAgICB6b29tOiBib29rbWFyay56LAogICAgICAgICAgb25TZWxlY3RlZDogd2luZG93LnBsdWdpbi5ib29rbWFya3Mub25TZWFyY2hSZXN1bHRTZWxlY3RlZCwKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKCiAgICAkLmVhY2gocGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmoucG9ydGFscywgZnVuY3Rpb24oaWQsIGZvbGRlcikgewogICAgICAkLmVhY2goZm9sZGVyLmJrbXJrLCBmdW5jdGlvbihpZCwgYm9va21hcmspIHsKICAgICAgICBpZihib29rbWFyay5sYWJlbC50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGVybSkgPT09IC0xKSByZXR1cm47CgogICAgICAgIHF1ZXJ5LmFkZFJlc3VsdCh7CiAgICAgICAgICB0aXRsZTogZXNjYXBlSHRtbFNwZWNpYWxDaGFycyhib29rbWFyay5sYWJlbCksCiAgICAgICAgICBkZXNjcmlwdGlvbjogJ0Jvb2ttYXJrIGluIGZvbGRlciAiJyArIGVzY2FwZUh0bWxTcGVjaWFsQ2hhcnMoZm9sZGVyLmxhYmVsKSArICciJywKICAgICAgICAgIGljb246ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUF3QUFBQU1DQVlBQUFCV2RWem5BQUFBQkhOQ1NWUUlDQWdJZkFoa2lBQUFBQWx3U0ZsekFBQU4xd0FBRGRjQlFpaWJlQUFBQUJsMFJWaDBVMjltZEhkaGNtVUFkM2QzTG1sdWEzTmpZWEJsTG05eVo1dnVQQm9BQUFERlNVUkJWQ2lScmRFdFRrTUJFQVRnYjE5QzBnc2dFRWdNRlcyVG9vQVVSemdBQ29OQW9yZ0FCNmpxQVZCY2doQlFZUG14QkFRZUJZWVE0QzJDSnZUbFBVaWJNRzUzWnBLWjNjaE1zNkJvM043RXdHMnNURzlJaDlKK0V4VzFTRmV4cG5DQk55enE1VlBkY0IyYndpNFdzSXo1TWYrT1I5d3JqSFR5OUR2U2kzTUVCaE5pbU1PU2NLZmo3S2ZEUm41NHNJUGpoajVEM1R3Z3kycnA3ZndVVHVvdHZVNk8xU3VWVnNlaVN4eWhSUHQzUTJoSlc3cTVycGQ3Q24wOFZ5VC84K2svOEFWWTdEZDFwQTQzUkFBQUFBQkpSVTVFcmtKZ2dnPT0nLAogICAgICAgICAgcG9zaXRpb246IEwubGF0TG5nKGJvb2ttYXJrLmxhdGxuZy5zcGxpdCgiLCIpKSwKICAgICAgICAgIGd1aWQ6IGJvb2ttYXJrLmd1aWQsCiAgICAgICAgICBvblNlbGVjdGVkOiB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5vblNlYXJjaFJlc3VsdFNlbGVjdGVkLAogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwogIH07CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9uU2VhcmNoUmVzdWx0U2VsZWN0ZWQgPSBmdW5jdGlvbihyZXN1bHQsIGV2ZW50KSB7CiAgICBpZihyZXN1bHQuZ3VpZCkgeyAvLyBwb3J0YWwKICAgICAgdmFyIGd1aWQgPSByZXN1bHQuZ3VpZDsKICAgICAgaWYoZXZlbnQudHlwZSA9PSAnZGJsY2xpY2snKQogICAgICAgIHpvb21Ub0FuZFNob3dQb3J0YWwoZ3VpZCwgcmVzdWx0LnBvc2l0aW9uKTsKICAgICAgZWxzZSBpZih3aW5kb3cucG9ydGFsc1tndWlkXSkKICAgICAgICByZW5kZXJQb3J0YWxEZXRhaWxzKGd1aWQpOwogICAgICBlbHNlCiAgICAgICAgd2luZG93LnNlbGVjdFBvcnRhbEJ5TGF0TG5nKHJlc3VsdC5wb3NpdGlvbik7CiAgICB9IGVsc2UgaWYocmVzdWx0Lnpvb20pIHsgLy8gbWFwCiAgICAgIG1hcC5zZXRWaWV3KHJlc3VsdC5wb3NpdGlvbiwgcmVzdWx0Lnpvb20pOwogICAgfQogICAgcmV0dXJuIHRydWU7IC8vIHByZXZlbnQgZGVmYXVsdCBiZWhhdmlvcgogIH07CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAvLyBTYXZlZCB0aGUgbmV3IHNvcnQgb2YgdGhlIGZvbGRlcnMgKGluIHRoZSBsb2NhbFN0b3JhZ2UpCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc29ydEZvbGRlciA9IGZ1bmN0aW9uKHR5cGVMaXN0KSB7CiAgICB2YXIga2V5VHlwZSA9IHR5cGVMaXN0LnJlcGxhY2UoJ2JrbXJrXycsICcnKTsKCiAgICB2YXIgbmV3QXJyID0ge307CiAgICAkKCcjJyt0eXBlTGlzdCsnIGxpLmJvb2ttYXJrRm9sZGVyJykuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgaWRGb2xkID0gJCh0aGlzKS5hdHRyKCdpZCcpOwogICAgICBuZXdBcnJbaWRGb2xkXSA9IHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmJrbXJrc09ialtrZXlUeXBlXVtpZEZvbGRdOwogICAgfSk7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmpba2V5VHlwZV0gPSBuZXdBcnI7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zYXZlU3RvcmFnZSgpOwoKICAgIHdpbmRvdy5ydW5Ib29rcygncGx1Z2luQmttcmtzRWRpdCcsIHsidGFyZ2V0IjogImZvbGRlciIsICJhY3Rpb24iOiAic29ydCJ9KTsKICAgIGNvbnNvbGUubG9nKCdCT09LTUFSS1M6IHNvcnRlZCBmb2xkZXInKTsKICB9CgogIC8vIFNhdmVkIHRoZSBuZXcgc29ydCBvZiB0aGUgYm9va21hcmtzIChpbiB0aGUgbG9jYWxTdG9yYWdlKQogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnNvcnRCb29rbWFyayA9IGZ1bmN0aW9uKHR5cGVMaXN0KSB7CiAgICB2YXIga2V5VHlwZSA9IHR5cGVMaXN0LnJlcGxhY2UoJ2JrbXJrXycsICcnKTsKICAgIHZhciBsaXN0ID0gd2luZG93LnBsdWdpbi5ib29rbWFya3MuYmttcmtzT2JqW2tleVR5cGVdOwogICAgdmFyIG5ld0FyciA9IHt9OwoKICAgICQoJyMnK3R5cGVMaXN0KycgbGkuYm9va21hcmtGb2xkZXInKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICB2YXIgaWRGb2xkID0gJCh0aGlzKS5hdHRyKCdpZCcpOwogICAgICBuZXdBcnJbaWRGb2xkXSA9IHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmJrbXJrc09ialtrZXlUeXBlXVtpZEZvbGRdOwogICAgICBuZXdBcnJbaWRGb2xkXS5ia21yayA9IHt9OwogICAgfSk7CgogICAgJCgnIycrdHlwZUxpc3QrJyBsaS5ia21yaycpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmxvYWRTdG9yYWdlKCk7CgogICAgICB2YXIgaWRGb2xkID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoJ2xpJykuYXR0cignaWQnKTsKICAgICAgdmFyIGlkID0gJCh0aGlzKS5hdHRyKCdpZCcpOwoKICAgICAgdmFyIGxpc3QgPSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmpba2V5VHlwZV07CiAgICAgIGZvcih2YXIgaWRGb2xkZXJzT3JpZ2luIGluIGxpc3QpIHsKICAgICAgICBmb3IodmFyIGlkQmttcmsgaW4gbGlzdFtpZEZvbGRlcnNPcmlnaW5dWydia21yayddKSB7CiAgICAgICAgICBpZihpZEJrbXJrID09IGlkKSB7CiAgICAgICAgICAgIG5ld0FycltpZEZvbGRdLmJrbXJrW2lkXSA9IHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmJrbXJrc09ialtrZXlUeXBlXVtpZEZvbGRlcnNPcmlnaW5dLmJrbXJrW2lkXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuYmttcmtzT2JqW2tleVR5cGVdID0gbmV3QXJyOwogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2F2ZVN0b3JhZ2UoKTsKICAgIHdpbmRvdy5ydW5Ib29rcygncGx1Z2luQmttcmtzRWRpdCcsIHsidGFyZ2V0IjogImJvb2ttYXJrcyIsICJhY3Rpb24iOiAic29ydCJ9KTsKICAgIGNvbnNvbGUubG9nKCdCT09LTUFSS1M6IHNvcnRlZCBib29rbWFyayAocG9ydGFsL21hcCknKTsKICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmpxdWVyeVNvcnRhYmxlU2NyaXB0ID0gZnVuY3Rpb24oKSB7CiAgICAkKCIuYm9va21hcmtMaXN0ID4gdWwiKS5zb3J0YWJsZSh7CiAgICAgIGl0ZW1zOiJsaS5ib29rbWFya0ZvbGRlcjpub3QoLm90aGVyc0Jvb2ttYXJrcykiLAogICAgICBoYW5kbGU6Ii5ib29rbWFya3NBbmNob3IiLAogICAgICBwbGFjZWhvbGRlcjoic29ydGFibGUtcGxhY2Vob2xkZXIiLAogICAgICBoZWxwZXI6J2Nsb25lJywgLy8gZml4IGFjY2lkZW50YWwgY2xpY2sgaW4gZmlyZWZveAogICAgICBmb3JjZVBsYWNlaG9sZGVyU2l6ZTp0cnVlLAogICAgICB1cGRhdGU6ZnVuY3Rpb24oZXZlbnQsIHVpKSB7CiAgICAgICAgdmFyIHR5cGVMaXN0ID0gJCgnIycrdWkuaXRlbS5jb250ZXh0LmlkKS5wYXJlbnQoKS5wYXJlbnQoJy5ib29rbWFya0xpc3QnKS5hdHRyKCdpZCcpOwogICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnNvcnRGb2xkZXIodHlwZUxpc3QpOwogICAgICB9CiAgICB9KTsKCiAgICAkKCIuYm9va21hcmtMaXN0IHVsIGxpIHVsIikuc29ydGFibGUoewogICAgICBpdGVtczoibGkuYmttcmsiLAogICAgICBjb25uZWN0V2l0aDoiLmJvb2ttYXJrTGlzdCB1bCB1bCIsCiAgICAgIGhhbmRsZToiLmJvb2ttYXJrc0xpbmsiLAogICAgICBwbGFjZWhvbGRlcjoic29ydGFibGUtcGxhY2Vob2xkZXIiLAogICAgICBoZWxwZXI6J2Nsb25lJywgLy8gZml4IGFjY2lkZW50YWwgY2xpY2sgaW4gZmlyZWZveAogICAgICBmb3JjZVBsYWNlaG9sZGVyU2l6ZTp0cnVlLAogICAgICB1cGRhdGU6ZnVuY3Rpb24oZXZlbnQsIHVpKSB7CiAgICAgICAgdmFyIHR5cGVMaXN0ID0gJCgnIycrdWkuaXRlbS5jb250ZXh0LmlkKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoJy5ib29rbWFya0xpc3QnKS5hdHRyKCdpZCcpOwogICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnNvcnRCb29rbWFyayh0eXBlTGlzdCk7CiAgICAgIH0KICAgIH0pOwogIH0KCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qKiBPUFRJT05TICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgLy8gTWFudWFsIGltcG9ydCwgZXhwb3J0IGFuZCByZXNldCBkYXRhCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MubWFudWFsT3B0ID0gZnVuY3Rpb24oKSB7CiAgICBkaWFsb2coewogICAgICBodG1sOiBwbHVnaW4uYm9va21hcmtzLmh0bWxTZXRib3gsCiAgICAgIGRpYWxvZ0NsYXNzOiAndWktZGlhbG9nLWJrbXJrc1NldCcsCiAgICAgIHRpdGxlOiAnQm9va21hcmtzIE9wdGlvbnMnCiAgICB9KTsKCiAgICB3aW5kb3cucnVuSG9va3MoJ3BsdWdpbkJrbXJrc09wZW5PcHQnKTsKICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9wdEFsZXJ0ID0gZnVuY3Rpb24obWVzc2FnZSkgewogICAgICAkKCcudWktZGlhbG9nLWJrbXJrc1NldCAudWktZGlhbG9nLWJ1dHRvbnNldCcpLnByZXBlbmQoJzxwIGNsYXNzPSJia3Jta3MtYWxlcnQiIHN0eWxlPSJmbG9hdDpsZWZ0O21hcmdpbi10b3A6NHB4OyI+JyttZXNzYWdlKyc8L3A+Jyk7CiAgICAgICQoJy5ia3Jta3MtYWxlcnQnKS5kZWxheSgyNTAwKS5mYWRlT3V0KCk7CiAgfQoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5vcHRDb3B5ID0gZnVuY3Rpb24oKSB7CiAgICBpZih0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCAmJiBhbmRyb2lkLnNoYXJlU3RyaW5nKSB7CiAgICAgIHJldHVybiBhbmRyb2lkLnNoYXJlU3RyaW5nKGxvY2FsU3RvcmFnZVt3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5LRVlfU1RPUkFHRV0pOwogICAgfSBlbHNlIHsKICAgICAgZGlhbG9nKHsKICAgICAgICBodG1sOiAnPHA+PGEgb25jbGljaz0iJChcJy51aS1kaWFsb2ctYmttcmtzU2V0LWNvcHkgdGV4dGFyZWFcJykuc2VsZWN0KCk7Ij5TZWxlY3QgYWxsPC9hPiBhbmQgcHJlc3MgQ1RSTCtDIHRvIGNvcHkgaXQuPC9wPjx0ZXh0YXJlYSByZWFkb25seT4nK2xvY2FsU3RvcmFnZVt3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5LRVlfU1RPUkFHRV0rJzwvdGV4dGFyZWE+JywKICAgICAgICBkaWFsb2dDbGFzczogJ3VpLWRpYWxvZy1ia21ya3NTZXQtY29weScsCiAgICAgICAgdGl0bGU6ICdCb29rbWFya3MgRXhwb3J0JwogICAgICB9KTsKICAgIH0KICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9wdEV4cG9ydCA9IGZ1bmN0aW9uKCkgewogICAgaWYodHlwZW9mIGFuZHJvaWQgIT09ICd1bmRlZmluZWQnICYmIGFuZHJvaWQgJiYgYW5kcm9pZC5zYXZlRmlsZSkgewogICAgICBhbmRyb2lkLnNhdmVGaWxlKCJJSVRDLWJvb2ttYXJrcy5qc29uIiwgImFwcGxpY2F0aW9uL2pzb24iLCBsb2NhbFN0b3JhZ2Vbd2luZG93LnBsdWdpbi5ib29rbWFya3MuS0VZX1NUT1JBR0VdKTsKICAgIH0KICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9wdFBhc3RlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgcHJvbXB0QWN0aW9uID0gcHJvbXB0KCdQcmVzcyBDVFJMK1YgdG8gcGFzdGUgaXQuJywgJycpOwogICAgaWYocHJvbXB0QWN0aW9uICE9PSBudWxsICYmIHByb21wdEFjdGlvbiAhPT0gJycpIHsKICAgICAgdHJ5IHsKICAgICAgICBKU09OLnBhcnNlKHByb21wdEFjdGlvbik7IC8vIHRyeSB0byBwYXJzZSBKU09OIGZpcnN0CiAgICAgICAgbG9jYWxTdG9yYWdlW3dpbmRvdy5wbHVnaW4uYm9va21hcmtzLktFWV9TVE9SQUdFXSA9IHByb21wdEFjdGlvbjsKICAgICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5yZWZyZXNoQmttcmtzKCk7CiAgICAgICAgd2luZG93LnJ1bkhvb2tzKCdwbHVnaW5Ca21ya3NFZGl0JywgeyJ0YXJnZXQiOiAiYWxsIiwgImFjdGlvbiI6ICJpbXBvcnQifSk7CiAgICAgICAgY29uc29sZS5sb2coJ0JPT0tNQVJLUzogcmVzZXQgYW5kIGltcG9ydGVkIGJvb2ttYXJrcycpOwogICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9wdEFsZXJ0KCdTdWNjZXNzZnVsLiAnKTsKICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdCT09LTUFSS1M6IGZhaWxlZCB0byBpbXBvcnQgZGF0YTogJytlKTsKICAgICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5vcHRBbGVydCgnPHNwYW4gc3R5bGU9ImNvbG9yOiAjZjg4Ij5JbXBvcnQgZmFpbGVkIDwvc3Bhbj4nKTsKICAgICAgfQogICAgfQogIH0KCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3Mub3B0SW1wb3J0ID0gZnVuY3Rpb24oKSB7CiAgICBpZiAod2luZG93LnJlcXVlc3RGaWxlID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgIHdpbmRvdy5yZXF1ZXN0RmlsZShmdW5jdGlvbihmaWxlbmFtZSwgY29udGVudCkgewogICAgICB0cnkgewogICAgICAgIEpTT04ucGFyc2UoY29udGVudCk7IC8vIHRyeSB0byBwYXJzZSBKU09OIGZpcnN0CiAgICAgICAgbG9jYWxTdG9yYWdlW3dpbmRvdy5wbHVnaW4uYm9va21hcmtzLktFWV9TVE9SQUdFXSA9IGNvbnRlbnQ7CiAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MucmVmcmVzaEJrbXJrcygpOwogICAgICAgIHdpbmRvdy5ydW5Ib29rcygncGx1Z2luQmttcmtzRWRpdCcsIHsidGFyZ2V0IjogImFsbCIsICJhY3Rpb24iOiAiaW1wb3J0In0pOwogICAgICAgIGNvbnNvbGUubG9nKCdCT09LTUFSS1M6IHJlc2V0IGFuZCBpbXBvcnRlZCBib29rbWFya3MnKTsKICAgICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5vcHRBbGVydCgnU3VjY2Vzc2Z1bC4gJyk7CiAgICAgIH0gY2F0Y2goZSkgewogICAgICAgIGNvbnNvbGUud2FybignQk9PS01BUktTOiBmYWlsZWQgdG8gaW1wb3J0IGRhdGE6ICcrZSk7CiAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Mub3B0QWxlcnQoJzxzcGFuIHN0eWxlPSJjb2xvcjogI2Y4OCI+SW1wb3J0IGZhaWxlZCA8L3NwYW4+Jyk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3Mub3B0UmVzZXQgPSBmdW5jdGlvbigpIHsKICAgIHZhciBwcm9tcHRBY3Rpb24gPSBjb25maXJtKCdBbGwgYm9va21hcmtzIHdpbGwgYmUgZGVsZXRlZC4gQXJlIHlvdSBzdXJlPycsICcnKTsKICAgIGlmKHByb21wdEFjdGlvbikgewogICAgICBkZWxldGUgbG9jYWxTdG9yYWdlW3dpbmRvdy5wbHVnaW4uYm9va21hcmtzLktFWV9TVE9SQUdFXTsKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuY3JlYXRlU3RvcmFnZSgpOwogICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5sb2FkU3RvcmFnZSgpOwogICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5yZWZyZXNoQmttcmtzKCk7CiAgICAgIHdpbmRvdy5ydW5Ib29rcygncGx1Z2luQmttcmtzRWRpdCcsIHsidGFyZ2V0IjogImFsbCIsICJhY3Rpb24iOiAicmVzZXQifSk7CiAgICAgIGNvbnNvbGUubG9nKCdCT09LTUFSS1M6IHJlc2V0IGFsbCBib29rbWFya3MnKTsKICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Mub3B0QWxlcnQoJ1N1Y2Nlc3NmdWwuICcpOwogICAgfQogIH0KCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3Mub3B0Qm94ID0gZnVuY3Rpb24oY29tbWFuZCkgewogICAgaWYoIXdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmlzQW5kcm9pZCgpKSB7CiAgICAgIHN3aXRjaChjb21tYW5kKSB7CiAgICAgICAgY2FzZSAnc2F2ZSc6CiAgICAgICAgICB2YXIgYm94WCA9IHBhcnNlSW50KCQoJyNib29rbWFya3NCb3gnKS5jc3MoJ3RvcCcpKTsKICAgICAgICAgIHZhciBib3hZID0gcGFyc2VJbnQoJCgnI2Jvb2ttYXJrc0JveCcpLmNzcygnbGVmdCcpKTsKICAgICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXR1c0JveC5wb3MgPSB7eDpib3hYLCB5OmJveFl9OwogICAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2F2ZVN0b3JhZ2VCb3goKTsKICAgICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9wdEFsZXJ0KCdQb3NpdGlvbiBhY3F1aXJlZC4gJyk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdyZXNldCc6CiAgICAgICAgICAkKCcjYm9va21hcmtzQm94JykuY3NzKHsndG9wJzoxMDAsICdsZWZ0JzoxMDB9KTsKICAgICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9wdEJveCgnc2F2ZScpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9wdEFsZXJ0KCdPbmx5IElJVEMgZGVza3RvcC4gJyk7CiAgICB9CiAgfQoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5kaWFsb2dMb2FkTGlzdEZvbGRlcnMgPSBmdW5jdGlvbihpZEJveCwgY2xpY2tBY3Rpb24sIHNob3dPdGhlcnNGLCBzY2FuVHlwZS8qMCA9IG1hcHMmcG9ydGFsczsgMSA9IG1hcHM7IDIgPSBwb3J0YWxzKi8pIHsKICAgIHZhciBsaXN0ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbJ3BsdWdpbi1ib29rbWFya3MnXSk7CiAgICB2YXIgbGlzdEhUTUwgPSAnJzsKICAgIHZhciBmb2xkSFRNTCA9ICcnOwogICAgdmFyIGVsZW1HZW5lcmljRm9sZGVyID0gJyc7CgogICAgLy8gRm9yIGVhY2ggdHlwZSBhbmQgZm9sZGVyCiAgICBmb3IodmFyIHR5cGUgaW4gbGlzdCl7CiAgICAgIGlmKHNjYW5UeXBlID09PSAwIHx8IChzY2FuVHlwZSA9PT0gMSAmJiB0eXBlID09PSAnbWFwcycpIHx8IChzY2FuVHlwZSA9PT0gMiAmJiB0eXBlID09PSAncG9ydGFscycpKXsKICAgICAgICBsaXN0SFRNTCArPSAnPGgzPicrdHlwZSsnOjwvaDM+JzsKCiAgICAgICAgZm9yKHZhciBpZEZvbGRlcnMgaW4gbGlzdFt0eXBlXSkgewogICAgICAgICAgdmFyIGxhYmVsID0gbGlzdFt0eXBlXVtpZEZvbGRlcnNdWydsYWJlbCddOwoKICAgICAgICAgIC8vIENyZWF0ZSBhIGZvbGRlcgogICAgICAgICAgZm9sZEhUTUwgPSAnPGRpdiBjbGFzcz0iYm9va21hcmtGb2xkZXIiIGlkPSInK2lkRm9sZGVycysnIiBkYXRhLXR5cGU9IicrdHlwZSsnIiBkYXRhLWlkPSInK2lkRm9sZGVycysnIiBvbmNsaWNrPSInK2NsaWNrQWN0aW9uKycodGhpcykiO3JldHVybiBmYWxzZTsiPicrbGFiZWwrJzwvZGl2Pic7CgogICAgICAgICAgaWYoaWRGb2xkZXJzICE9PSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5LRVlfT1RIRVJfQktNUkspIHsKICAgICAgICAgICAgbGlzdEhUTUwgKz0gZm9sZEhUTUw7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZihzaG93T3RoZXJzRiA9PT0gdHJ1ZSl7CiAgICAgICAgICAgICAgZWxlbUdlbmVyaWNGb2xkZXIgPSBmb2xkSFRNTDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBsaXN0SFRNTCArPSBlbGVtR2VuZXJpY0ZvbGRlcjsKICAgICAgZWxlbUdlbmVyaWNGb2xkZXIgPSAnJzsKICAgIH0KCiAgICAvLyBBcHBlbmQgYWxsIGZvbGRlcnMKICAgIHZhciByID0gJzxkaXYgY2xhc3M9ImJvb2ttYXJrc0RpYWxvZyIgaWQ9IicraWRCb3grJyI+JwogICAgICArIGxpc3RIVE1MCiAgICAgICsgJzwvZGl2Pic7CgogICAgcmV0dXJuIHI7CiAgfQoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5yZW5hbWVGb2xkZXIgPSBmdW5jdGlvbihlbGVtKXsKICAgIHZhciB0eXBlID0gJChlbGVtKS5kYXRhKCd0eXBlJyk7CiAgICB2YXIgaWRGb2xkID0gJChlbGVtKS5kYXRhKCdpZCcpOwoKICAgIHZhciBwcm9tcHRBY3Rpb24gPSBwcm9tcHQoJ0luc2VydCBhIG5ldyBuYW1lLicsICcnKTsKICAgIGlmKHByb21wdEFjdGlvbiAhPT0gbnVsbCAmJiBwcm9tcHRBY3Rpb24gIT09ICcnKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIG5ld05hbWUgPSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5lc2NhcGVIdG1sKHByb21wdEFjdGlvbik7CgogICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmJrbXJrc09ialt0eXBlXVtpZEZvbGRdLmxhYmVsID0gbmV3TmFtZTsKICAgICAgICAkKCcjYm9va21hcmtzRGlhbG9nUmVuYW1lRiAjJytpZEZvbGQpLnRleHQobmV3TmFtZSk7CiAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2F2ZVN0b3JhZ2UoKTsKICAgICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5yZWZyZXNoQmttcmtzKCk7CiAgICAgICAgd2luZG93LnJ1bkhvb2tzKCdwbHVnaW5Ca21ya3NFZGl0JywgeyJ0YXJnZXQiOiAiYWxsIiwgImFjdGlvbiI6ICJpbXBvcnQifSk7CgogICAgICAgIGNvbnNvbGUubG9nKCdCT09LTUFSS1M6IHJlbmFtZWQgYm9va21hcmtzIGZvbGRlcicpOwogICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9wdEFsZXJ0KCdTdWNjZXNzZnVsLiAnKTsKICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdCT09LTUFSS1M6IGZhaWxlZCB0byByZW5hbWUgZm9sZGVyOiAnK2UpOwogICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9wdEFsZXJ0KCc8c3BhbiBzdHlsZT0iY29sb3I6ICNmODgiPlJlbmFtZSBmYWlsZWQgPC9zcGFuPicpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogIH0KCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3Mub3B0UmVuYW1lRiA9IGZ1bmN0aW9uKCkgewogICAgZGlhbG9nKHsKICAgICAgaHRtbDogd2luZG93LnBsdWdpbi5ib29rbWFya3MuZGlhbG9nTG9hZExpc3RGb2xkZXJzKCdib29rbWFya3NEaWFsb2dSZW5hbWVGJywgJ3dpbmRvdy5wbHVnaW4uYm9va21hcmtzLnJlbmFtZUZvbGRlcicsIGZhbHNlLCAwKSwKICAgICAgZGlhbG9nQ2xhc3M6ICd1aS1kaWFsb2ctYmttcmtzU2V0LWNvcHknLAogICAgICB0aXRsZTogJ0Jvb2ttYXJrcyBSZW5hbWUgRm9sZGVyJwogICAgfSk7CiAgfQoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqIEFVVE8gRFJBVyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5kaWFsb2dEcmF3ZXIgPSBmdW5jdGlvbigpIHsKICAgIGRpYWxvZyh7CiAgICAgIGh0bWw6d2luZG93LnBsdWdpbi5ib29rbWFya3MuZGlhbG9nTG9hZExpc3QsCiAgICAgIGRpYWxvZ0NsYXNzOid1aS1kaWFsb2ctYXV0b2RyYXdlcicsCiAgICAgIHRpdGxlOidCb29rbWFya3MgLSBBdXRvIERyYXcnLAogICAgICBidXR0b25zOnsKICAgICAgICAnRFJBVyc6IGZ1bmN0aW9uKCkgewogICAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuZHJhdygwKTsKICAgICAgICB9LAogICAgICAgICdEUkFXJlZJRVcnOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmRyYXcoMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmF1dG9EcmF3T25TZWxlY3QoKTsKICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmRyYXcgPSBmdW5jdGlvbih2aWV3KSB7CiAgICB2YXIgbGF0bG5ncyA9IFtdOwogICAgdmFyIHV1dSA9ICQoJyNia21ya3NBdXRvRHJhd2VyIGEuYmttcmsuc2VsZWN0ZWQnKS5lYWNoKGZ1bmN0aW9uKGkpIHsKICAgICAgdmFyIHR0ID0gJCh0aGlzKS5kYXRhKCdsYXRsbmcnKTsKICAgICAgbGF0bG5nc1tpXSA9IHR0OwogICAgfSk7CgogICAgaWYobGF0bG5ncy5sZW5ndGggPj0gMiAmJiBsYXRsbmdzLmxlbmd0aCA8PSAzKSB7CiAgICAgIC8vIFRPRE86IGFkZCBhbiBBUEkgdG8gZHJhdy10b29scyByYXRoZXIgdGhhbiBhc3N1bWluZyB0aGluZ3MgYWJvdXQgaXRzIGludGVybmFscwoKICAgICAgdmFyIGxheWVyLCBsYXllclR5cGU7CiAgICAgIGlmKGxhdGxuZ3MubGVuZ3RoID09IDIpIHsKICAgICAgICBsYXllciA9IEwuZ2VvZGVzaWNQb2x5bGluZShsYXRsbmdzLCB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5saW5lT3B0aW9ucyk7CiAgICAgICAgbGF5ZXJUeXBlID0gJ3BvbHlsaW5lJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBsYXllciA9IEwuZ2VvZGVzaWNQb2x5Z29uKGxhdGxuZ3MsIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLnBvbHlnb25PcHRpb25zKTsKICAgICAgICBsYXllclR5cGUgPSAncG9seWdvbic7CiAgICAgIH0KCiAgICAgIG1hcC5maXJlKCdkcmF3OmNyZWF0ZWQnLCB7CiAgICAgICAgbGF5ZXI6IGxheWVyLAogICAgICAgIGxheWVyVHlwZTogbGF5ZXJUeXBlCiAgICAgIH0pOwoKICAgICAgaWYoJCgnI2JrbXJrQ2xlYXJTZWxlY3Rpb24nKS5wcm9wKCdjaGVja2VkJykpCiAgICAgICAgJCgnI2JrbXJrc0F1dG9EcmF3ZXIgYS5ia21yay5zZWxlY3RlZCcpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpOwoKICAgICAgaWYod2luZG93LnBsdWdpbi5ib29rbWFya3MuaXNTbWFydCkgewogICAgICAgIHdpbmRvdy5zaG93KCdtYXAnKTsKICAgICAgfQoKICAgICAgLy8gU2hvd24gdGhlIGxheWVyIGlmIGl0IGlzIGhpZGRlbgogICAgICBpZighbWFwLmhhc0xheWVyKHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmRyYXduSXRlbXMpKSB7CiAgICAgICAgbWFwLmFkZExheWVyKHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmRyYXduSXRlbXMpOwogICAgICB9CgogICAgICBpZih2aWV3KSB7CiAgICAgICAgbWFwLmZpdEJvdW5kcyhsYXllci5nZXRCb3VuZHMoKSk7CiAgICAgIH0KICAgIH0KICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmF1dG9EcmF3T25TZWxlY3QgPSBmdW5jdGlvbigpIHsKICAgIHZhciBsYXRsbmdzID0gW107CiAgICB2YXIgdXV1ID0gJCgnI2JrbXJrc0F1dG9EcmF3ZXIgYS5ia21yay5zZWxlY3RlZCcpLmVhY2goZnVuY3Rpb24oaSkgewogICAgICB2YXIgdHQgPSAkKHRoaXMpLmRhdGEoJ2xhdGxuZycpOwogICAgICBsYXRsbmdzW2ldID0gdHQ7CiAgICB9KTsKCiAgICB2YXIgdGV4dCA9ICJZb3UgbXVzdCBzZWxlY3QgMiBvciAzIHBvcnRhbHMhIjsKICAgIHZhciBjb2xvciA9ICJyZWQiOwoKICAgIGZ1bmN0aW9uIGZvcm1hdERpc3RhbmNlKGRpc3RhbmNlKSB7CiAgICAgIHZhciB0ZXh0ID0gZGlnaXRzKGRpc3RhbmNlID4gMTAwMDAgPyAoZGlzdGFuY2UvMTAwMCkudG9GaXhlZCgyKSArICJrbSIgOiAoTWF0aC5yb3VuZChkaXN0YW5jZSkgKyAibSIpKTsKICAgICAgcmV0dXJuIGRpc3RhbmNlID49IDIwMDAwMAogICAgICAgID8gJzxlbSB0aXRsZT0iTG9uZyBkaXN0YW5jZSBsaW5rIiBjbGFzcz0iaGVscCBsb25nZGlzdGFuY2UiPicrdGV4dCsnPC9lbT4nCiAgICAgICAgOiB0ZXh0OwogICAgfQoKICAgIGlmKGxhdGxuZ3MubGVuZ3RoID09IDIpIHsKICAgICAgdmFyIGRpc3RhbmNlID0gTC5sYXRMbmcobGF0bG5nc1swXSkuZGlzdGFuY2VUbyhsYXRsbmdzWzFdKTsKICAgICAgdGV4dCA9ICdEaXN0YW5jZSBiZXR3ZWVuIHBvcnRhbHM6ICcgKyBmb3JtYXREaXN0YW5jZShkaXN0YW5jZSk7CiAgICAgIGNvbG9yID0gIiI7CiAgICB9IGVsc2UgaWYobGF0bG5ncy5sZW5ndGggPT0gMykgewogICAgICB2YXIgbG9uZ2Rpc3RhbmNlID0gZmFsc2U7CiAgICAgIHZhciBkaXN0YW5jZXMgPSBsYXRsbmdzLm1hcChmdW5jdGlvbihsbDEsIGksIGxhdGxuZ3MpIHsKICAgICAgICB2YXIgbGwyID0gbGF0bG5nc1soaSsxKSUzXTsKICAgICAgICByZXR1cm4gZm9ybWF0RGlzdGFuY2UoTC5sYXRMbmcobGwxKS5kaXN0YW5jZVRvKGxsMikpOwogICAgICB9KTsKICAgICAgdGV4dCA9ICdEaXN0YW5jZXM6ICcgKyBkaXN0YW5jZXMuam9pbigiLCAiKTsKICAgICAgY29sb3IgPSAiIjsKICAgIH0KCiAgICAkKCcjYmttcmtzQXV0b0RyYXdlciBwJykKICAgICAgLmh0bWwodGV4dCkKICAgICAgLmNzcygiY29sb3IiLCBjb2xvcik7CiAgfQoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5kaWFsb2dMb2FkTGlzdCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHIgPSAnVGhlICI8YSBocmVmPSJodHRwOi8vaWl0Yy5qb25hdGtpbnMuY29tLz9wYWdlPWRlc2t0b3AjcGx1Z2luLWRyYXctdG9vbHMiIHRhcmdldD0iX0JMQU5LIj48c3Ryb25nPkRyYXcgVG9vbHM8L3N0cm9uZz48L2E+IiBwbHVnaW4gaXMgcmVxdWlyZWQuPC9zcGFuPic7CgogICAgaWYoIXdpbmRvdy5wbHVnaW4uYm9va21hcmtzIHx8ICF3aW5kb3cucGx1Z2luLmRyYXdUb29scykgewogICAgICAkKCcudWktZGlhbG9nLWF1dG9kcmF3ZXIgLnVpLWRpYWxvZy1idXR0b25zZXQgLnVpLWJ1dHRvbjpub3QoOmZpcnN0KScpLmhpZGUoKTsKICAgIH0KICAgIGVsc2V7CiAgICAgIHZhciBwb3J0YWxzTGlzdCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlWydwbHVnaW4tYm9va21hcmtzJ10pOwogICAgICB2YXIgZWxlbWVudCA9ICcnOwogICAgICB2YXIgZWxlbWVudFRlbXAgPSAnJzsKICAgICAgdmFyIGVsZW1HZW5lcmljRm9sZGVyID0gJyc7CgogICAgICAvLyBGb3IgZWFjaCBmb2xkZXIKICAgICAgdmFyIGxpc3QgPSBwb3J0YWxzTGlzdC5wb3J0YWxzOwogICAgICBmb3IodmFyIGlkRm9sZGVycyBpbiBsaXN0KSB7CiAgICAgICAgdmFyIGZvbGRlcnMgPSBsaXN0W2lkRm9sZGVyc107CgogICAgICAgIC8vIENyZWF0ZSBhIGxhYmVsIGFuZCBhIGFuY2hvciBmb3IgdGhlIHNvcnRhYmxlCiAgICAgICAgdmFyIGZvbGRlckxhYmVsID0gJzxhIGNsYXNzPSJmb2xkZXJMYWJlbCIgb25jbGljaz0iJCh0aGlzKS5zaWJsaW5ncyhcJ2RpdlwnKS50b2dnbGUoKTtyZXR1cm4gZmFsc2U7Ij4nK2ZvbGRlcnNbJ2xhYmVsJ10rJzwvYT4nOwoKICAgICAgICAvLyBDcmVhdGUgYSBmb2xkZXIKICAgICAgICBlbGVtZW50VGVtcCA9ICc8ZGl2IGNsYXNzPSJib29rbWFya0ZvbGRlciIgaWQ9IicraWRGb2xkZXJzKyciPicrZm9sZGVyTGFiZWwrJzxkaXY+JzsKCiAgICAgICAgLy8gRm9yIGVhY2ggYm9va21hcmsKICAgICAgICB2YXIgZm9sZCA9IGZvbGRlcnNbJ2JrbXJrJ107CiAgICAgICAgZm9yKHZhciBpZEJrbXJrIGluIGZvbGQpIHsKICAgICAgICAgIHZhciBia21yayA9IGZvbGRbaWRCa21ya107CiAgICAgICAgICB2YXIgbGFiZWwgPSBia21ya1snbGFiZWwnXTsKICAgICAgICAgIHZhciBsYXRsbmcgPSBia21ya1snbGF0bG5nJ107CgogICAgICAgICAgLy8gQ3JlYXRlIHRoZSBib29rbWFyawogICAgICAgICAgZWxlbWVudFRlbXAgKz0gJzxhIGNsYXNzPSJia21yayIgaWQ9IicraWRCa21yaysnIiBvbmNsaWNrPSIkKHRoaXMpLnRvZ2dsZUNsYXNzKFwnc2VsZWN0ZWRcJyk7cmV0dXJuIGZhbHNlIiBkYXRhLWxhdGxuZz0iWycrbGF0bG5nKyddIj4nK2xhYmVsKyc8L2E+JzsKICAgICAgICB9CiAgICAgICAgZWxlbWVudFRlbXAgKz0gJzwvZGl2PjwvZGl2Pic7CgogICAgICAgIGlmKGlkRm9sZGVycyAhPT0gd2luZG93LnBsdWdpbi5ib29rbWFya3MuS0VZX09USEVSX0JLTVJLKSB7CiAgICAgICAgICBlbGVtZW50ICs9IGVsZW1lbnRUZW1wOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbGVtR2VuZXJpY0ZvbGRlciArPSBlbGVtZW50VGVtcDsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxlbWVudCArPSBlbGVtR2VuZXJpY0ZvbGRlcjsKCiAgICAgIC8vIEFwcGVuZCBhbGwgZm9sZGVycyBhbmQgYm9va21hcmtzCiAgICAgIHIgPSAnPGRpdiBpZD0iYmttcmtzQXV0b0RyYXdlciI+JwogICAgICAgICsgJzxsYWJlbCBzdHlsZT0ibWFyZ2luLWJvdHRvbTogOXB4OyBkaXNwbGF5OiBibG9jazsiPicKICAgICAgICArICc8aW5wdXQgc3R5bGU9InZlcnRpY2FsLWFsaWduOiBtaWRkbGU7IiB0eXBlPSJjaGVja2JveCIgaWQ9ImJrbXJrQ2xlYXJTZWxlY3Rpb24iIGNoZWNrZWQ+JwogICAgICAgICsgJyBDbGVhciBzZWxlY3Rpb24gYWZ0ZXIgZHJhd2luZzwvbGFiZWw+JwogICAgICAgICsgJzxwIHN0eWxlPSJtYXJnaW4tYm90dG9tOjlweDtjb2xvcjpyZWQiPllvdSBtdXN0IHNlbGVjdCAyIG9yIDMgcG9ydGFscyE8L3A+JwogICAgICAgICsgJzxkaXYgb25jbGljaz0id2luZG93LnBsdWdpbi5ib29rbWFya3MuYXV0b0RyYXdPblNlbGVjdCgpO3JldHVybiBmYWxzZTsiPicKICAgICAgICArIGVsZW1lbnQKICAgICAgICArICc8L2Rpdj4nCiAgICAgICAgKyAnPC9kaXY+JzsKICAgIH0KICAgIHJldHVybiByOwogIH0KCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qKiBTWU5DICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgLy8gRGVsYXkgdGhlIHN5bmNpbmcgdG8gZ3JvdXAgYSBmZXcgdXBkYXRlcyBpbiBhIHNpbmdsZSByZXF1ZXN0CiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuZGVsYXlTeW5jID0gZnVuY3Rpb24oKSB7CiAgICBpZighd2luZG93LnBsdWdpbi5ib29rbWFya3MuZW5hYmxlU3luYykgcmV0dXJuOwogICAgY2xlYXJUaW1lb3V0KHBsdWdpbi5ib29rbWFya3MuZGVsYXlTeW5jLnRpbWVyKTsKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmRlbGF5U3luYy50aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuZGVsYXlTeW5jLnRpbWVyID0gbnVsbDsKICAgICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zeW5jTm93KCk7CiAgICAgIH0sIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLlNZTkNfREVMQVkpOwogIH0KCiAgLy8gU3RvcmUgdGhlIHVwZGF0ZVF1ZXVlIGluIHVwZGF0aW5nUXVldWUgYW5kIHVwbG9hZAogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN5bmNOb3cgPSBmdW5jdGlvbigpIHsKICAgIGlmKCF3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5lbmFibGVTeW5jKSByZXR1cm47CiAgICAkLmV4dGVuZCh3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy51cGRhdGluZ1F1ZXVlLCB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy51cGRhdGVRdWV1ZSk7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy51cGRhdGVRdWV1ZSA9IHt9OwogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc3RvcmVMb2NhbCh3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5VUERBVElOR19RVUVVRSk7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdG9yZUxvY2FsKHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLlVQREFURV9RVUVVRSk7CgogICAgd2luZG93LnBsdWdpbi5zeW5jLnVwZGF0ZU1hcCgnYm9va21hcmtzJywgd2luZG93LnBsdWdpbi5ib29rbWFya3MuS0VZLmZpZWxkLCBPYmplY3Qua2V5cyh3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy51cGRhdGluZ1F1ZXVlKSk7CiAgfQoKICAvLyBDYWxsIGFmdGVyIElJVEMgYW5kIGFsbCBwbHVnaW4gbG9hZGVkCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MucmVnaXN0ZXJGaWVsZEZvclN5bmNpbmcgPSBmdW5jdGlvbigpIHsKICAgIGlmKCF3aW5kb3cucGx1Z2luLnN5bmMpIHJldHVybjsKICAgIHdpbmRvdy5wbHVnaW4uc3luYy5yZWdpc3Rlck1hcEZvclN5bmMoJ2Jvb2ttYXJrcycsIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLktFWS5maWVsZCwgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc3luY0NhbGxiYWNrLCB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zeW5jSW5pdGlhbGVkKTsKICB9CgogIC8vIENhbGwgYWZ0ZXIgbG9jYWwgb3IgcmVtb3RlIGNoYW5nZSB1cGxvYWRlZAogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN5bmNDYWxsYmFjayA9IGZ1bmN0aW9uKHBsdWdpbk5hbWUsIGZpZWxkTmFtZSwgZSwgZnVsbFVwZGF0ZWQpIHsKICAgIGlmKGZpZWxkTmFtZSA9PT0gd2luZG93LnBsdWdpbi5ib29rbWFya3MuS0VZLmZpZWxkKSB7CiAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0b3JlTG9jYWwod2luZG93LnBsdWdpbi5ib29rbWFya3MuS0VZKTsKICAgICAgLy8gQWxsIGRhdGEgaXMgcmVwbGFjZWQgaWYgb3RoZXIgY2xpZW50IHVwZGF0ZSB0aGUgZGF0YSBkdXJpbmcgdGhpcyBjbGllbnQgb2ZmbGluZSwKICAgICAgaWYoZnVsbFVwZGF0ZWQpIHsKICAgICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5yZWZyZXNoQmttcmtzKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZighZSkgcmV0dXJuOwogICAgICBpZihlLmlzTG9jYWwpIHsKICAgICAgICAvLyBVcGRhdGUgcHVzaGVkIHN1Y2Nlc3NmdWxseSwgcmVtb3ZlIGl0IGZyb20gdXBkYXRpbmdRdWV1ZQogICAgICAgIGRlbGV0ZSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy51cGRhdGluZ1F1ZXVlW2UucHJvcGVydHldOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFJlbW90ZSB1cGRhdGUKICAgICAgICBkZWxldGUgd2luZG93LnBsdWdpbi5ib29rbWFya3MudXBkYXRlUXVldWVbZS5wcm9wZXJ0eV07CiAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc3RvcmVMb2NhbCh3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5VUERBVEVfUVVFVUUpOwogICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnJlZnJlc2hCa21ya3MoKTsKICAgICAgICB3aW5kb3cucnVuSG9va3MoJ3BsdWdpbkJrbXJrc1N5bmNFbmQnLCB7InRhcmdldCI6ICJhbGwiLCAiYWN0aW9uIjogInN5bmMifSk7CiAgICAgICAgY29uc29sZS5sb2coJ0JPT0tNQVJLUzogc3luY2hyb25pemVkIGFsbCcpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBzeW5jaW5nIG9mIHRoZSBmaWVsZCBpcyBpbml0aWFsZWQsIHVwbG9hZCBhbGwgcXVldWVkIHVwZGF0ZQogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN5bmNJbml0aWFsZWQgPSBmdW5jdGlvbihwbHVnaW5OYW1lLCBmaWVsZE5hbWUpIHsKICAgIGlmKGZpZWxkTmFtZSA9PT0gd2luZG93LnBsdWdpbi5ib29rbWFya3MuS0VZLmZpZWxkKSB7CiAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmVuYWJsZVN5bmMgPSB0cnVlOwogICAgICBpZihPYmplY3Qua2V5cyh3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy51cGRhdGVRdWV1ZSkubGVuZ3RoID4gMCkgewogICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmRlbGF5U3luYygpOwogICAgICB9CiAgICB9CiAgfQoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdG9yZUxvY2FsID0gZnVuY3Rpb24obWFwcGluZykgewogICAgaWYodHlwZW9mKHdpbmRvdy5wbHVnaW4uYm9va21hcmtzW21hcHBpbmcuZmllbGRdKSAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LnBsdWdpbi5ib29rbWFya3NbbWFwcGluZy5maWVsZF0gIT09IG51bGwpIHsKICAgICAgbG9jYWxTdG9yYWdlW21hcHBpbmcua2V5XSA9IEpTT04uc3RyaW5naWZ5KHdpbmRvdy5wbHVnaW4uYm9va21hcmtzW21hcHBpbmcuZmllbGRdKTsKICAgIH0gZWxzZSB7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKG1hcHBpbmcua2V5KTsKICAgIH0KICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmxvYWRMb2NhbCA9IGZ1bmN0aW9uKG1hcHBpbmcpIHsKICAgIHZhciBvYmplY3RKU09OID0gbG9jYWxTdG9yYWdlW21hcHBpbmcua2V5XTsKICAgIGlmKCFvYmplY3RKU09OKSByZXR1cm47CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrc1ttYXBwaW5nLmZpZWxkXSA9IG1hcHBpbmcuY29udmVydEZ1bmMKICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gbWFwcGluZy5jb252ZXJ0RnVuYyhKU09OLnBhcnNlKG9iamVjdEpTT04pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBKU09OLnBhcnNlKG9iamVjdEpTT04pOwogIH0KCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc3luY0JrbXJrcyA9IGZ1bmN0aW9uKCkgewogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MubG9hZExvY2FsKHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLktFWSk7CgogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MudXBkYXRlUXVldWUgPSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5ia21ya3NPYmo7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdG9yZUxvY2FsKHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLlVQREFURV9RVUVVRSk7CgogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuZGVsYXlTeW5jKCk7CiAgfQoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqIEhJR0hMSUdIVEVSICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5oaWdobGlnaHQgPSBmdW5jdGlvbihkYXRhKSB7CiAgICB2YXIgZ3VpZCA9IGRhdGEucG9ydGFsLm9wdGlvbnMuZW50WzBdOwogICAgaWYod2luZG93LnBsdWdpbi5ib29rbWFya3MuZmluZEJ5R3VpZChndWlkKSkgewogICAgICBkYXRhLnBvcnRhbC5zZXRTdHlsZSh7ZmlsbENvbG9yOidyZWQnfSk7CiAgICB9CiAgfQoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5oaWdobGlnaHRSZWZyZXNoID0gZnVuY3Rpb24oZGF0YSkgewogICAgaWYoX2N1cnJlbnRfaGlnaGxpZ2h0ZXIgPT09ICdCb29rbWFya2VkIFBvcnRhbHMnKSB7CiAgICAgIGlmKGRhdGEuYWN0aW9uID09PSAnc3luYycgfHwgZGF0YS50YXJnZXQgPT09ICdwb3J0YWwnIHx8IChkYXRhLnRhcmdldCA9PT0gJ2ZvbGRlcicgJiYgZGF0YS5hY3Rpb24gPT09ICdyZW1vdmUnKSB8fCAoZGF0YS50YXJnZXQgPT09ICdhbGwnICYmIGRhdGEuYWN0aW9uID09PSAnaW1wb3J0JykgfHwgKGRhdGEudGFyZ2V0ID09PSAnYWxsJyAmJiBkYXRhLmFjdGlvbiA9PT0gJ3Jlc2V0JykpIHsKICAgICAgICB3aW5kb3cucmVzZXRIaWdobGlnaHRlZFBvcnRhbHMoKTsKICAgICAgfQogICAgfQogIH0KCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qKiBCT09LTUFSS0VEIFBPUlRBTFMgTEFZRVIgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuYWRkQWxsU3RhcnMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBsaXN0ID0gd2luZG93LnBsdWdpbi5ib29rbWFya3MuYmttcmtzT2JqLnBvcnRhbHM7CgogICAgZm9yKHZhciBpZEZvbGRlcnMgaW4gbGlzdCkgewogICAgICBmb3IodmFyIGlkQmttcmtzIGluIGxpc3RbaWRGb2xkZXJzXVsnYmttcmsnXSkgewogICAgICAgIHZhciBsYXRsbmcgPSBsaXN0W2lkRm9sZGVyc11bJ2JrbXJrJ11baWRCa21ya3NdLmxhdGxuZy5zcGxpdCgiLCIpOwogICAgICAgIHZhciBndWlkID0gbGlzdFtpZEZvbGRlcnNdWydia21yayddW2lkQmttcmtzXS5ndWlkOwogICAgICAgIHZhciBsYmwgPSBsaXN0W2lkRm9sZGVyc11bJ2JrbXJrJ11baWRCa21ya3NdLmxhYmVsOwogICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmFkZFN0YXIoZ3VpZCwgbGF0bG5nLCBsYmwpOwogICAgICB9CiAgICB9CiAgfQoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5yZXNldEFsbFN0YXJzID0gZnVuY3Rpb24oKSB7CiAgICBmb3IoZ3VpZCBpbiB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdGFyTGF5ZXJzKSB7CiAgICAgIHZhciBzdGFySW5MYXllciA9IHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXJMYXllcnNbZ3VpZF07CiAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXJMYXllckdyb3VwLnJlbW92ZUxheWVyKHN0YXJJbkxheWVyKTsKICAgICAgZGVsZXRlIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXJMYXllcnNbZ3VpZF07CiAgICB9CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5hZGRBbGxTdGFycygpOwogIH0KCiAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuYWRkU3RhciA9IGZ1bmN0aW9uKGd1aWQsIGxhdGxuZywgbGJsKSB7CiAgICB2YXIgc3RhciA9IEwubWFya2VyKGxhdGxuZywgewogICAgICB0aXRsZTogbGJsLAogICAgICBpY29uOiBMLmljb24oewogICAgICAgIGljb25Vcmw6ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUNBQUFBQW9DQU1BQUFDbzl3aXJBQUFBekZCTVZFWGJ1VFI5WXdEZDBUK3VseXJ5MlZEdDUzL3M1SnYzNGErdG1VYkp0R1J0VndBdEpBRGcxNGozMDR2aXlJWmVTd0RYeUg1SU9RRDA3SkxQdm5ocVZRQnVXQUNta2pwZ1RRQnhXd0M0cDFXY2hpa1JEUUNQZHhlQmFBUVREd0FEQWdBT0N3QUFBQUFBQUFBQUFBQUxDUUFBQUFBQUFBQUFBQUQ5K0piOTdJVCszVlQ5K1dIKzBpMzk5M0QrODA3OTNZci95WEwrNVRyKzZYTCt6RVAvejJYK3ZTWCt6Qi8rNTJML3F3MzkzU1g4OXhyOSt5di9zaVAvdlVmOStEdisyMFArcmdIK3hRdit2Z0grdHdOQWUvYjhBQUFBS0hSU1RsUHl3dkxqK3ZuNC9PTHJxRmIwL1BTUzhIYjc3bWVCNEZHWDV0MUEyZFVrRXk4SERRb2FBd0VBb2NsYVBRQUFBbzFKUkVGVWVGNVZrZWV5b3pBTVJyUHBoZHdrZEl4cEJ1N1NTZS9sbHZkL3A1VnhsTXgrUHhpTXpoeEp1UFgzbWMvUHp6Z0lRd1lKd3lDR295Z2d3TXVSYXY2Qm1LckxHZ1FCckJ2VWt1UWtrU1dMR2g1RG9vWDFVTldsWHBsRHlwNmtxNUVYQ3FMMXFsdTlzcnBmSVBlcTdGbWFJQkNJQTlXU2N5anpuQy8zWE9aRUVBc0FCSUZCb0g2R1VydDl2NXpQUUVBWEZvQ2lBV0xQa1Vxb24rOGxJYmw0a1J3Zm1nZ0FCRlpTWFhoOVBoYm9wVW9zMWZXQ0JvQUpuVDRNQ01NbFpMSFFFL0hlZC93SUZBM2draVN2cWpMdEs0NXRPL04rV2xaVm5oQTdZZ0tBRlpLODNkR0pNNXY0cm1GU29uZmFlV290b0VjRGhKcVNWbDA2VzBBNWd2aVRHZWxXcVRKenZaQURjV2pPMTFYVkl6UGJqenpHUEZmVDRieFdURDhTQUFOZ3RUcklROGVGM1FQbURPWERhcldlai9tVUwrQzBTZ2ZVOTFnY1IzVEFqNDJCTlFETUFNRHB3QmZ6d2pDaS9jTUpnTkZNR0dCSVk1ZytBQUNucldsK05KYXkwK21SRGhjQWlEVmRLc09uekpxWlJGR29abzc0U2FZVFhEUHd6UG5oVVR3NmRDU25hVDJpblVkUkhEN0dOZ0l4TS9RVXZyVzZXZlo0WkZtM1ZSU2lBNHNGRUVhT2xCWDdvaWoyRVA0c3NxbGo0MTN3SHFxMTN1eS9YOWx2WUFjYmI1UDNjR21kN2I5L252bmVaeldkTkIwRUFBcE4yUlp2b05qQ3ZmS2I0SUJRK0xUZTdINStSWGFibWp3RkNJU3c2WGIzaThEMm94RWd3TWRrQmdIRjd4ZUVDL1NGMzR5SUFOOTAvTEhkSGI5NFFDQjJSRUJzYXVqMTdjcUI2NjBlb2dBQjhiT0U0dmdVc0JpQnQySjZ1eDZQMTl2ME9RRUNiOFY4eTRHMzREK0FLd2dvUUVCUWdNQkxZU3JMMjIycGpIRUZCTjRLT2wwdXAvd1dVSUFBL2s1dE5CZzAxNGdDQlBCMytzNWcwRXdZWUIyQmw4S3lORDlDQVFKdmdubXE2a1llWHhIekR5QVR1ZU5udlpjWUFBQUFBRWxGVGtTdVFtQ0MnLAogICAgICAgIGljb25BbmNob3I6IFsxNSw0MF0sCiAgICAgICAgaWNvblNpemU6IFszMCw0MF0KICAgICAgfSkKICAgIH0pOwogICAgd2luZG93LnJlZ2lzdGVyTWFya2VyRm9yT01TKHN0YXIpOwogICAgc3Rhci5vbignc3BpZGVyZmllZGNsaWNrJywgZnVuY3Rpb24oKSB7IHJlbmRlclBvcnRhbERldGFpbHMoZ3VpZCk7IH0pOwoKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXJMYXllcnNbZ3VpZF0gPSBzdGFyOwogICAgc3Rhci5hZGRUbyh3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdGFyTGF5ZXJHcm91cCk7CiAgfQoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5lZGl0U3RhciA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgIGlmKGRhdGEudGFyZ2V0ID09PSAncG9ydGFsJykgewogICAgICBpZihkYXRhLmFjdGlvbiA9PT0gJ2FkZCcpIHsKICAgICAgICB2YXIgZ3VpZCA9IGRhdGEuZ3VpZDsKICAgICAgICB2YXIgbGF0bG5nID0gd2luZG93LnBvcnRhbHNbZ3VpZF0uZ2V0TGF0TG5nKCk7CiAgICAgICAgdmFyIGxibCA9IHdpbmRvdy5wb3J0YWxzW2d1aWRdLm9wdGlvbnMuZGF0YS50aXRsZTsKICAgICAgICB2YXIgc3RhckluTGF5ZXIgPSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdGFyTGF5ZXJzW2RhdGEuZ3VpZF07CiAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuYWRkU3RhcihndWlkLCBsYXRsbmcsIGxibCk7CiAgICAgIH0KICAgICAgZWxzZSBpZihkYXRhLmFjdGlvbiA9PT0gJ3JlbW92ZScpIHsKICAgICAgICB2YXIgc3RhckluTGF5ZXIgPSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdGFyTGF5ZXJzW2RhdGEuZ3VpZF07CiAgICAgICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc3RhckxheWVyR3JvdXAucmVtb3ZlTGF5ZXIoc3RhckluTGF5ZXIpOwogICAgICAgIGRlbGV0ZSB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdGFyTGF5ZXJzW2RhdGEuZ3VpZF07CiAgICAgIH0KICAgIH0KICAgIGVsc2UgaWYoKGRhdGEudGFyZ2V0ID09PSAnYWxsJyAmJiAoZGF0YS5hY3Rpb24gPT09ICdpbXBvcnQnIHx8IGRhdGEuYWN0aW9uID09PSAncmVzZXQnKSkgfHwgKGRhdGEudGFyZ2V0ID09PSAnZm9sZGVyJyAmJiBkYXRhLmFjdGlvbiA9PT0gJ3JlbW92ZScpKSB7CiAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnJlc2V0QWxsU3RhcnMoKTsKICAgIH0KICB9CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zZXR1cENTUyA9IGZ1bmN0aW9uKCkgewogICAgJCgnPHN0eWxlPicpLnByb3AoJ3R5cGUnLCAndGV4dC9jc3MnKS5odG1sKCcvKiBoaWRlIHdoZW4gcHJpbnRpbmcgKi9cbkBtZWRpYSBwcmludCB7XG4JI2JrbXJrc1RyaWdnZXIgeyBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7IH1cbn1cblxuXG4jYm9va21hcmtzQm94ICp7XG4JZGlzcGxheTpibG9jaztcbglwYWRkaW5nOjA7XG4JbWFyZ2luOjA7XG4Jd2lkdGg6YXV0bztcbgloZWlnaHQ6YXV0bztcbglmb250LWZhbWlseTpWZXJkYW5hLEdlbmV2YSxzYW5zLXNlcmlmO1xuCWZvbnQtc2l6ZToxM3B4O1xuCWxpbmUtaGVpZ2h0OjIycHg7XG4JdGV4dC1pbmRlbnQ6MDtcbgl0ZXh0LWRlY29yYXRpb246bm9uZTtcbgktd2Via2l0LWJveC1zaXppbmc6Ym9yZGVyLWJveDtcbgktbW96LWJveC1zaXppbmc6Ym9yZGVyLWJveDtcbglib3gtc2l6aW5nOmJvcmRlci1ib3g7XG59XG5cbiNib29rbWFya3NCb3h7XG4JZGlzcGxheTpibG9jaztcbglwb3NpdGlvbjphYnNvbHV0ZSAhaW1wb3J0YW50O1xuCXotaW5kZXg6NDAwMTtcbgl0b3A6MTAwcHg7XG4JbGVmdDoxMDBweDtcbgl3aWR0aDoyMzFweDtcbgloZWlnaHQ6YXV0bztcbglvdmVyZmxvdzpoaWRkZW47XG59XG4jYm9va21hcmtzQm94IC5hZGRGb3JtLFxuI2Jvb2ttYXJrc0JveCAjYm9va21hcmtzVHlwZUJhcixcbiNib29rbWFya3NCb3ggaDV7XG4JaGVpZ2h0OjI4cHg7XG4Jb3ZlcmZsb3c6aGlkZGVuO1xuCWNvbG9yOiNmZmY7XG4JZm9udC1zaXplOjE0cHg7XG59XG4jYm9va21hcmtzQm94ICN0b3BCYXJ7XG4JaGVpZ2h0OjE1cHggIWltcG9ydGFudDtcbn1cbiNib29rbWFya3NCb3ggI3RvcEJhciAqe1xuCWhlaWdodDogMTRweCAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveCAjdG9wQmFyICp7XG4JZmxvYXQ6bGVmdCAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveCAuaGFuZGxle1xuCXdpZHRoOjgwJTtcbgl0ZXh0LWFsaWduOmNlbnRlcjtcbgljb2xvcjojZmZmO1xuCWxpbmUtaGVpZ2h0OjZweDtcbgljdXJzb3I6bW92ZTtcbn1cbiNib29rbWFya3NCb3ggI3RvcEJhciAuYnRue1xuCWRpc3BsYXk6YmxvY2s7XG4Jd2lkdGg6MTAlO1xuCWN1cnNvcjpwb2ludGVyO1xuCWNvbG9yOiMyMGE4YjE7XG5cbglmb250LXdlaWdodDpib2xkO1xuCXRleHQtYWxpZ246Y2VudGVyO1xuCWxpbmUtaGVpZ2h0OjEzcHg7XG4JZm9udC1zaXplOjE4cHg7XG59XG5cbiNib29rbWFya3NCb3ggI3RvcEJhciAjYm9va21hcmtzRGVse1xuCW92ZXJmbG93OmhpZGRlbjtcbgl0ZXh0LWluZGVudDotOTk5cHg7XG4JYmFja2dyb3VuZDojQjQyRTJFO1xufVxuXG4jYm9va21hcmtzQm94ICN0b3BCYXIgI2Jvb2ttYXJrc01pbjpob3Zlcntcbgljb2xvcjojZmZjZTAwO1xufVxuI2Jvb2ttYXJrc0JveCAjYm9va21hcmtzVHlwZUJhcntcbgljbGVhcjpib3RoO1xufVxuI2Jvb2ttYXJrc0JveCBoNXtcbglwYWRkaW5nOjRweCAwIDIzcHg7XG4Jd2lkdGg6NTAlO1xuCWhlaWdodDo5M3B4ICFpbXBvcnRhbnQ7XG4JdGV4dC1hbGlnbjpjZW50ZXI7XG4JY29sb3I6Izc4ODtcbn1cbiNib29rbWFya3NCb3ggaDUuY3VycmVudHtcbgljdXJzb3I6ZGVmYXVsdDtcbgliYWNrZ3JvdW5kOjA7XG4JY29sb3I6I2ZmZiAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveCBoNTpob3Zlcntcbgljb2xvcjojZmZjZTAwO1xuCWJhY2tncm91bmQ6cmdiYSgwLDAsMCwwKTtcbn1cbiNib29rbWFya3NCb3ggI3RvcEJhcixcbiNib29rbWFya3NCb3ggLmFkZEZvcm0sXG4jYm9va21hcmtzQm94ICNib29rbWFya3NUeXBlQmFyLFxuI2Jvb2ttYXJrc0JveCAuYm9va21hcmtMaXN0IGxpLmJvb2ttYXJrc0VtcHR5LFxuI2Jvb2ttYXJrc0JveCAuYm9va21hcmtMaXN0IGxpLmJrbXJrIGEsXG4jYm9va21hcmtzQm94IC5ib29rbWFya0xpc3QgbGkuYmttcms6aG92ZXJ7XG4JYmFja2dyb3VuZC1jb2xvcjpyZ2JhKDgsNDgsNzgsLjg1KTtcbn1cbiNib29rbWFya3NCb3ggaDUsXG4jYm9va21hcmtzQm94IC5ib29rbWFya0xpc3QgbGkuYmttcms6aG92ZXIgLmJvb2ttYXJrc0xpbmssXG4jYm9va21hcmtzQm94IC5hZGRGb3JtICp7XG4JYmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4zKTtcbn1cbiNib29rbWFya3NCb3ggLmFkZEZvcm0gKntcbglkaXNwbGF5OmJsb2NrO1xuCWZsb2F0OmxlZnQ7XG4JaGVpZ2h0OjI4cHggIWltcG9ydGFudDtcbn1cbiNib29rbWFya3NCb3ggLmFkZEZvcm0gYXtcbgljdXJzb3I6cG9pbnRlcjtcbgljb2xvcjojMjBhOGIxO1xuCWZvbnQtc2l6ZToxMnB4O1xuCXdpZHRoOjM1JTtcbgl0ZXh0LWFsaWduOmNlbnRlcjtcbglsaW5lLWhlaWdodDoyMHB4O1xuCXBhZGRpbmc6NHB4IDAgMjNweDtcbn1cbiNib29rbWFya3NCb3ggLmFkZEZvcm0gYTpob3ZlcntcbgliYWNrZ3JvdW5kOiNmZmNlMDA7XG4JY29sb3I6IzAwMDtcbgl0ZXh0LWRlY29yYXRpb246bm9uZTtcbn1cbiNib29rbWFya3NCb3ggLmFkZEZvcm0gaW5wdXR7XG4JZm9udC1zaXplOjExcHggIWltcG9ydGFudDtcbgljb2xvcjojZmZjZTAwO1xuCWhlaWdodDoyOHB4O1xuCXBhZGRpbmc6NHB4IDhweCAxcHg7XG4JbGluZS1oZWlnaHQ6MTJweDtcbglmb250LXNpemU6MTJweDtcbn1cbiNib29rbWFya3NCb3ggI2JrbXJrX3BvcnRhbHMgLmFkZEZvcm0gaW5wdXR7XG4Jd2lkdGg6NjUlO1xufVxuI2Jvb2ttYXJrc0JveCAjYmttcmtfbWFwcyAuYWRkRm9ybSBpbnB1dHtcbgl3aWR0aDo0MiU7XG59XG4jYm9va21hcmtzQm94ICNia21ya19tYXBzIC5hZGRGb3JtIGF7XG4Jd2lkdGg6MjklO1xufVxuI2Jvb2ttYXJrc0JveCAuYWRkRm9ybSBpbnB1dDpob3ZlcixcbiNib29rbWFya3NCb3ggLmFkZEZvcm0gaW5wdXQ6Zm9jdXN7XG4Jb3V0bGluZTowO1xuCWJhY2tncm91bmQ6cmdiYSgwLDAsMCwuNik7XG59XG4jYm9va21hcmtzQm94IC5ib29rbWFya0xpc3QgPiB1bHtcbgljbGVhcjpib3RoO1xuCWxpc3Qtc3R5bGUtdHlwZTpub25lO1xuCWNvbG9yOiNmZmY7XG4Jb3ZlcmZsb3c6aGlkZGVuO1xuCW92ZXJmbG93LXk6YXV0bztcbgltYXgtaGVpZ2h0OjU4MHB4O1xufVxuI2Jvb2ttYXJrc0JveCAuc29ydGFibGUtcGxhY2Vob2xkZXJ7XG4JYmFja2dyb3VuZDpyZ2JhKDgsNDgsNzgsLjU1KTtcbglib3gtc2hhZG93Omluc2V0IDFweCAwIDAgIzIwYThiMTtcbn1cbiNib29rbWFya3NCb3ggLnVpLXNvcnRhYmxlLWhlbHBlcntcbglib3JkZXItdG9wLXdpZHRoOjFweDtcbn1cbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdHtcbglkaXNwbGF5Om5vbmU7XG59XG4jYm9va21hcmtzQm94IC5ib29rbWFya0xpc3QuY3VycmVudHtcbglkaXNwbGF5OmJsb2NrO1xufVxuI2Jvb2ttYXJrc0JveCBoNSxcbiNib29rbWFya3NCb3ggLmFkZEZvcm0gKixcbiNib29rbWFya3NCb3ggdWwgbGkuYmttcmssXG4jYm9va21hcmtzQm94IHVsIGxpLmJrbXJrIGF7XG4JaGVpZ2h0OjIycHg7XG59XG4jYm9va21hcmtzQm94IGg1LFxuI2Jvb2ttYXJrc0JveCB1bCBsaS5ia21yayBhe1xuCW92ZXJmbG93OmhpZGRlbjtcbgljdXJzb3I6cG9pbnRlcjtcbglmbG9hdDpsZWZ0O1xufVxuI2Jvb2ttYXJrc0JveCB1bCAuYm9va21hcmtzRW1wdHl7XG4JdGV4dC1pbmRlbnQ6MjdweDtcbgljb2xvcjojZWVlO1xufVxuI2Jvb2ttYXJrc0JveCB1bCAuYm9va21hcmtzUmVtb3ZlRnJvbXtcbgl3aWR0aDoxMCU7XG4JdGV4dC1hbGlnbjpjZW50ZXI7XG4JY29sb3I6I2ZmZjtcbn1cbiNib29rbWFya3NCb3ggdWwgLmJvb2ttYXJrc0xpbmt7XG4Jd2lkdGg6OTAlO1xuCXBhZGRpbmc6MCAxMHB4IDAgOHB4O1xuCWNvbG9yOiNmZmNlMDA7XG59XG4jYm9va21hcmtzQm94IHVsIC5ib29rbWFya3NMaW5rLnNlbGVjdGVke1xuCWNvbG9yOiMwM2ZlMDM7XG59XG4jYm9va21hcmtzQm94IHVsIC5vdGhlcnNCb29rbWFya3MgLmJvb2ttYXJrc0xpbmt7XG4Jd2lkdGg6OTAlO1xufVxuI2Jvb2ttYXJrc0JveCB1bCAuYm9va21hcmtzTGluazpob3Zlcntcbgljb2xvcjojMDNmZTAzO1xufVxuI2Jvb2ttYXJrc0JveCB1bCAuYm9va21hcmtzUmVtb3ZlRnJvbTpob3Zlcntcbgljb2xvcjojZmZmO1xuCWJhY2tncm91bmQ6I2UyMiAhaW1wb3J0YW50O1xufVxuXG4vKi0tLS0gVUkgYm9yZGVyIC0tLS0tKi9cbiNib29rbWFya3NCb3gsXG4jYm9va21hcmtzQm94ICp7XG4JYm9yZGVyLWNvbG9yOiMyMGE4YjE7XG4JYm9yZGVyLXN0eWxlOnNvbGlkO1xuCWJvcmRlci13aWR0aDowO1xufVxuI2Jvb2ttYXJrc0JveCAjdG9wQmFyLFxuI2Jvb2ttYXJrc0JveCB1bCAuYm9va21hcmtGb2xkZXJ7XG4JYm9yZGVyLXRvcC13aWR0aDoxcHg7XG59XG5cbiNib29rbWFya3NCb3ggI3RvcEJhcixcbiNib29rbWFya3NCb3ggI2Jvb2ttYXJrc1R5cGVCYXIsXG4jYm9va21hcmtzQm94IC5hZGRGb3JtLFxuI2Jvb2ttYXJrc0JveCB1bCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsLFxuI2Jvb2ttYXJrc0JveCB1bCBsaS5ia21yayBhIHtcbglib3JkZXItYm90dG9tLXdpZHRoOjFweDtcbn1cbiNib29rbWFya3NCb3ggdWwgLmJvb2ttYXJrRm9sZGVye1xuCWJvcmRlci1yaWdodC13aWR0aDoxcHg7XG4JYm9yZGVyLWxlZnQtd2lkdGg6MXB4O1xufVxuI2Jvb2ttYXJrc0JveCAjdG9wQmFyICosXG4jYm9va21hcmtzQm94ICNib29rbWFya3NUeXBlQmFyICosXG4jYm9va21hcmtzQm94IC5hZGRGb3JtICosXG4jYm9va21hcmtzQm94IHVsIGxpLmJrbXJre1xuCWJvcmRlci1sZWZ0LXdpZHRoOjFweDtcbn1cbiNib29rbWFya3NCb3ggI3RvcEJhcixcbiNib29rbWFya3NCb3ggI2Jvb2ttYXJrc1R5cGVCYXIsXG4jYm9va21hcmtzQm94IC5hZGRGb3JtLFxuI2Jvb2ttYXJrc0JveCB1bCAuYm9va21hcmtzUmVtb3ZlRnJvbXtcbglib3JkZXItcmlnaHQtd2lkdGg6MXB4O1xufVxuI2Jvb2ttYXJrc0JveCB1bCAuYm9va21hcmtGb2xkZXIub3RoZXJzQm9va21hcmtzIGxpLmJrbXJrLFxuI2Jvb2ttYXJrc0JveCB1bCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsIC5ib29rbWFya3NSZW1vdmVGcm9te1xuCWJvcmRlci1sZWZ0LXdpZHRoOjA7XG59XG4jYmttcmtzVHJpZ2dlcntcbglkaXNwbGF5OmJsb2NrO1xuCXBvc2l0aW9uOmFic29sdXRlO1xuCW92ZXJmbG93OmhpZGRlbjtcbgl0b3A6MDtcbglsZWZ0OjI3N3B4O1xuCXdpZHRoOjQ3cHg7XG4JbWFyZ2luLXRvcDotMzZweDtcbgloZWlnaHQ6NjRweDtcbgloZWlnaHQ6MDtcbgljdXJzb3I6cG9pbnRlcjtcbgl6LWluZGV4OjI5OTk7XG4JYmFja2dyb3VuZC1wb3NpdGlvbjpjZW50ZXIgYm90dG9tO1xuCWJhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtcbgl0cmFuc2l0aW9uOm1hcmdpbi10b3AgMTAwbXMgZWFzZS1pbi1vdXQ7XG4JdGV4dC1pbmRlbnQ6LTEwMCU7XG4JdGV4dC1kZWNvcmF0aW9uOm5vbmU7XG4JdGV4dC1hbGlnbjpjZW50ZXI7XG59XG4jYmttcmtzVHJpZ2dlcjpob3ZlcntcbgltYXJnaW4tdG9wOjA7XG59XG4jc2lkZWJhciAjcG9ydGFsZGV0YWlscyBoMy50aXRsZXtcbgl3aWR0aDphdXRvO1xufVxuLnBvcnRhbC1saXN0LWJvb2ttYXJrIHNwYW4ge1xuCWRpc3BsYXk6aW5saW5lLWJsb2NrO1xuCW1hcmdpbjogLTNweDtcbgl3aWR0aDoxNnB4O1xuCWhlaWdodDoxNXB4O1xuCW92ZXJmbG93OmhpZGRlbjtcbgliYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXQ7XG4JY3Vyc29yOnBvaW50ZXI7XG59XG4jYmttcmtzVHJpZ2dlciwgLmJrbXJrc1N0YXIgc3BhbiwgLnBvcnRhbC1saXN0LWJvb2ttYXJrIHNwYW4ge1xuCWJhY2tncm91bmQtaW1hZ2U6dXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQzhBQUFCUENBTUFBQUJNRFd6RUFBQUFObEJNVkVYLy8vLy96Z0QvemdELy8vLy8vLzhBcnU3L3pnQUFydTRUdFBBQUFBREE3UHRBd3ZMazkvNmIzL24vLy84QXJ1NTEwL2IvemdEWktwNllBQUFBQ25SU1RsT0F4bzVGdER3OW1Qb0E5R0ppZWdBQUFrbEpSRUZVZUY2ZGxlMjZvekFJaEZPMU5rSyt2UCtiM1diQkpSd003ZG41bGFkOUJ3ZW9hVGhJNjNaNDJoZm1MbjRyTHY4NGQ4V3ZwV3hlK2ZOY0ZMK1ZVdHp5NTdrTHY2N2xyYkRPcXUvblc4dGZRMWkzTW1qYmZyS1BjOUJqQ1lmaXkycWpqTm9EWlJmY2FCbnhubDhNbThLTjRiRnp2NnE2bFZUL1AzNjkrREJaRm1zWitMQW1XYkhsbHo3WEIvT0J3RERoRjFyVkl2d0ZoSHQrdnc0ZHFiVmlLZEMwd0h5U1NzRTNlL0Z4cEhQcEFvK3ZVZWhVU0NrN1BCdVlUcENVdy9Kc0FJb2lwemxmVVRIaW1QR05NdWpRN0xBODZzU3FtMng0QkZYYk9qVFBTV0pGeHRncGJSVEZkK1ZJVGRQR1FHM2I4aEFyQ2JtN245dlZlZnFaeFQ4STBHMlkrWWk0WEZOeStKcXBuNjk1V2xQNmtzZFdTSkI5UG1KcmtNcW9sQUR5aklkeXJ6U3JEMVBjOGxORDh2ck5GdmZua3czdThOWUFuK2V2K00vN2lvclBIM244SmQ5K21UK2I4Zmc4RUJaYitvNG4rbjBneDR5UE1wNU1aM0xrVzc3WEpBYVpaa2RtUHR2N0pHRzlFZkxMcm5rUzNEamlSV3NlZWo2T3JuWGQwdWIvaFFiZnRJUEhDbmZ6akR6NnNYankzc2VLb0JxWEc5N3lxaUNnbUZ2MTk4dU5ZeTdYcHRIbHI4YUhjYms4Tlc1dmVNdHJnK0ExT2p5M29DZUxEczl6Z2ZFSEVpMnZ1MDNJTnU0WS9mazNPVk9vNk4yZjh1NUlxRHMrTnZNYVlPSlFhSGo1cnV0MXZHSWRhL3prNWRtZGZoN0g4WHlwVUpwUDBsdU5uZTU2eG5FZGlsZFJSUHlJZk1NRFNuR1doRUpRdkVRWml0dFF3b09OWWtQOTQ2T09NbnNFUnVaTkZLTVhPWWlYa1hzTzRVMFVMMVF3ZmZxUENINFVzNHhnb3ZpaC9nQnMxTHFORTBhZndBQUFBQUJKUlU1RXJrSmdnZz09KTtcbn1cbi5ia21ya3NTdGFyIHNwYW57XG4JZGlzcGxheTppbmxpbmUtYmxvY2s7XG4JZmxvYXQ6bGVmdDtcbgltYXJnaW46M3B4IDFweCAwIDRweDtcbgl3aWR0aDoxNnB4O1xuCWhlaWdodDoxNXB4O1xuCW92ZXJmbG93OmhpZGRlbjtcbgliYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXQ7XG59XG4uYmttcmtzU3RhciBzcGFuLCAuYmttcmtzU3Rhci5mYXZvcml0ZTpmb2N1cyBzcGFue1xuCWJhY2tncm91bmQtcG9zaXRpb246bGVmdCB0b3A7XG59XG4uYmttcmtzU3Rhcjpmb2N1cyBzcGFuLCAuYmttcmtzU3Rhci5mYXZvcml0ZSBzcGFuLCAucG9ydGFsLWxpc3QtYm9va21hcmsuZmF2b3JpdGUgc3BhbntcbgliYWNrZ3JvdW5kLXBvc2l0aW9uOnJpZ2h0IHRvcDtcbn1cbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXJ7XG4Jb3ZlcmZsb3c6aGlkZGVuO1xuCW1hcmdpbi10b3A6LTFweDtcbgloZWlnaHQ6YXV0bztcbgliYWNrZ3JvdW5kOnJnYmEoOCw1OCw3OCwuNyk7XG59XG4jYm9va21hcmtzQm94IC5ib29rbWFya0xpc3QgdWwgbGkuc29ydGFibGUtcGxhY2Vob2xkZXJ7XG4JYm94LXNoYWRvdzppbnNldCAtMXB4IDAgMCAjMjBhOGIxLGluc2V0IDFweCAwIDAgIzIwYThiMSwwIC0xcHggMCAjMjBhOGIxO1xuCWJhY2tncm91bmQ6cmdiYSg4LDU4LDc4LC45KTtcbn1cbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYmttcmsudWktc29ydGFibGUtaGVscGVye1xuCWJvcmRlci1yaWdodC13aWR0aDoxcHg7XG4JYm9yZGVyLWxlZnQtd2lkdGg6MXB4ICFpbXBvcnRhbnQ7XG59XG4jYm9va21hcmtzQm94IC5ib29rbWFya0xpc3QgdWwgbGkgdWwgbGkuc29ydGFibGUtcGxhY2Vob2xkZXJ7XG4JaGVpZ2h0OjIzcHg7XG4JYm94LXNoYWRvdzppbnNldCAwIC0xcHggMCAjMjBhOGIxLGluc2V0IDFweCAwIDAgIzIwYThiMTtcbn1cblxuI2Jvb2ttYXJrc0JveCAuYm9va21hcmtMaXN0IHVsIGxpLmJvb2ttYXJrRm9sZGVyLnVpLXNvcnRhYmxlLWhlbHBlcixcbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCB1bCBsaS5vdGhlcnNCb29rbWFya3MgdWwgbGkuc29ydGFibGUtcGxhY2Vob2xkZXJ7XG4JYm94LXNoYWRvdzppbnNldCAwIC0xcHggMCAjMjBhOGIxO1xufVxuXG4jYm9va21hcmtzQm94ICN0b3BCYXIgI2Jvb2ttYXJrc0RlbCxcbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsOmhvdmVyIC5ib29rbWFya3NSZW1vdmVGcm9tLFxuI2Jvb2ttYXJrc0JveCAuYm9va21hcmtMaXN0IC5ib29rbWFya0ZvbGRlciAuZm9sZGVyTGFiZWw6aG92ZXIgLmJvb2ttYXJrc0FuY2hvcntcbglib3JkZXItYm90dG9tLXdpZHRoOjFweDtcbn1cblxuLyotLS0tLS0tLS0qL1xuI2Jvb2ttYXJrc0JveCAuYm9va21hcmtMaXN0IC5ib29rbWFya0ZvbGRlciAuZm9sZGVyTGFiZWwgLmJvb2ttYXJrc0FuY2hvciBzcGFuLFxuI2Jvb2ttYXJrc0JveCAuYm9va21hcmtMaXN0IC5ib29rbWFya0ZvbGRlciAuZm9sZGVyTGFiZWwgPiBzcGFuLFxuI2Jvb2ttYXJrc0JveCAuYm9va21hcmtMaXN0IC5ib29rbWFya0ZvbGRlciAuZm9sZGVyTGFiZWwgPiBzcGFuID4gc3BhbixcbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAudHJpYW5nbGV7XG4Jd2lkdGg6MDtcbgloZWlnaHQ6MDtcbn1cbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVse1xuCW92ZXJmbG93OnZpc2libGU7XG4JaGVpZ2h0OjI1cHg7XG4JY3Vyc29yOnBvaW50ZXI7XG4JYmFja2dyb3VuZDojMDY5O1xuCXRleHQtaW5kZW50OjA7XG59XG4jYm9va21hcmtzQm94IC5ib29rbWFya0xpc3QgLmJvb2ttYXJrRm9sZGVyIC5mb2xkZXJMYWJlbCA+ICp7XG4JaGVpZ2h0OjI1cHg7XG4JZmxvYXQ6bGVmdDtcbn1cbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsIC5ib29rbWFya3NBbmNob3J7XG4JbGluZS1oZWlnaHQ6MjVweDtcbgljb2xvcjojZmZmO1xuCXdpZHRoOjkwJTtcbn1cbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsIC5ib29rbWFya3NBbmNob3Igc3BhbntcbglmbG9hdDpsZWZ0O1xuCWJvcmRlci13aWR0aDo1cHggMCA1cHggN3B4O1xuCWJvcmRlci1jb2xvcjp0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB3aGl0ZTtcbgltYXJnaW46N3B4IDdweCAwIDZweDtcbn1cbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIub3BlbiAuZm9sZGVyTGFiZWwgLmJvb2ttYXJrc0FuY2hvciBzcGFue1xuCW1hcmdpbjo5cHggNXB4IDAgNXB4O1xuCWJvcmRlci13aWR0aDo3cHggNXB4IDAgNXB4O1xuCWJvcmRlci1jb2xvcjp3aGl0ZSB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB0cmFuc3BhcmVudDtcbn1cbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsID4gc3BhbixcbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsID4gc3BhbiA+IHNwYW57XG4JZGlzcGxheTpub25lO1xuCWJvcmRlci13aWR0aDowIDEycHggMTBweCAwO1xuCWJvcmRlci1jb2xvcjp0cmFuc3BhcmVudCAjMjBhOGIxIHRyYW5zcGFyZW50IHRyYW5zcGFyZW50O1xuCW1hcmdpbjotMjBweCAwIDA7XG4JcG9zaXRpb246cmVsYXRpdmU7XG4JdG9wOjIxcHg7XG4JbGVmdDoyMTlweDtcbn1cbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsID4gc3BhbiA+IHNwYW57XG4JdG9wOjE4cHg7XG4JbGVmdDowO1xuCWJvcmRlci13aWR0aDowIDEwcHggOXB4IDA7XG4JYm9yZGVyLWNvbG9yOnRyYW5zcGFyZW50ICMwNjkgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQ7XG59XG4jYm9va21hcmtzQm94IC5ib29rbWFya0xpc3QgLmJvb2ttYXJrRm9sZGVyLm9wZW4gLmZvbGRlckxhYmVsID4gc3BhbixcbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIub3BlbiAuZm9sZGVyTGFiZWwgPiBzcGFuID4gc3BhbntcbglkaXNwbGF5OmJsb2NrO1xuCWRpc3BsYXk6bm9uZTtcbn1cbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIub3BlbiAuZm9sZGVyTGFiZWw6aG92ZXIgPiBzcGFuID4gc3Bhbntcbglib3JkZXItY29sb3I6dHJhbnNwYXJlbnQgIzAzNiB0cmFuc3BhcmVudCB0cmFuc3BhcmVudDtcbn1cbiNib29rbWFya3NCb3ggLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsOmhvdmVyIC5ib29rbWFya3NBbmNob3J7XG4JYmFja2dyb3VuZDojMDM2O1xufVxuI2Jvb2ttYXJrc0JveCAuYm9va21hcmtMaXN0IC5ib29rbWFya0ZvbGRlciB1bHtcbglkaXNwbGF5Om5vbmU7XG4JbWFyZ2luLWxlZnQ6MTAlO1xufVxuI2Jvb2ttYXJrc0JveCAuYm9va21hcmtMaXN0IC5ib29rbWFya0ZvbGRlci5vcGVuIHVse1xuCWRpc3BsYXk6YmxvY2s7XG4JbWluLWhlaWdodDoyMnB4O1xufVxuI2Jvb2ttYXJrc0JveCAuYm9va21hcmtGb2xkZXIub3RoZXJzQm9va21hcmtzIHVse1xuCW1hcmdpbi1sZWZ0OjA7XG59XG5cbi8qLS0tLSBXaWR0aCBmb3IgZGVsZXRlTW9kZSAtLS0tLSovXG4jYm9va21hcmtzQm94IC5ib29rbWFya3NSZW1vdmVGcm9te1xuCWRpc3BsYXk6bm9uZSAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveC5kZWxldGVNb2RlIC5ib29rbWFya3NSZW1vdmVGcm9te1xuCWRpc3BsYXk6YmxvY2sgIWltcG9ydGFudDtcbn1cblxuI2Jvb2ttYXJrc0JveCAuYm9va21hcmtMaXN0IC5ib29rbWFya0ZvbGRlciAuZm9sZGVyTGFiZWwgLmJvb2ttYXJrc0FuY2hvcixcbiNib29rbWFya3NCb3ggdWwgLmJvb2ttYXJrc0xpbmssXG4jYm9va21hcmtzQm94IHVsIC5vdGhlcnNCb29rbWFya3MgLmJvb2ttYXJrc0xpbmt7XG4Jd2lkdGg6MTAwJSAhaW1wb3J0YW50O1xufVxuXG4jYm9va21hcmtzQm94LmRlbGV0ZU1vZGUgLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsIC5ib29rbWFya3NBbmNob3IsXG4jYm9va21hcmtzQm94LmRlbGV0ZU1vZGUgdWwgLmJvb2ttYXJrc0xpbmssXG4jYm9va21hcmtzQm94LmRlbGV0ZU1vZGUgdWwgLm90aGVyc0Jvb2ttYXJrcyAuYm9va21hcmtzTGlua3tcbgl3aWR0aDo5MCUgIWltcG9ydGFudDtcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbglNT0JJTEVcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4jYm9va21hcmtzQm94Lm1vYmlsZXtcbglwb3NpdGlvbjphYnNvbHV0ZSAhaW1wb3J0YW50O1xuCXdpZHRoOiAxMDAlICFpbXBvcnRhbnQ7XG4JaGVpZ2h0OiAxMDAlICFpbXBvcnRhbnQ7XG4JdG9wOiAwICFpbXBvcnRhbnQ7XG4JbGVmdDogMCAhaW1wb3J0YW50O1xuCW1hcmdpbjogMCAhaW1wb3J0YW50O1xuCXBhZGRpbmc6IDAgIWltcG9ydGFudDtcbglib3JkZXI6IDAgIWltcG9ydGFudDtcbgliYWNrZ3JvdW5kOiB0cmFuc3BhcmVudCAhaW1wb3J0YW50O1xuCW92ZXJmbG93OmF1dG8gIWltcG9ydGFudDtcbn1cbiNib29rbWFya3NCb3gubW9iaWxlIC5ib29rbWFya0xpc3QgdWwsXG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYm9va21hcmtMaXN0IHVsIGxpLFxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdC5jdXJyZW50LFxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCBsaS5ib29rbWFya0ZvbGRlci5vcGVuIHVse1xuCXdpZHRoOjEwMCUgIWltcG9ydGFudDtcbglkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnQ7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAqe1xuCWJveC1zaGFkb3c6bm9uZSAhaW1wb3J0YW50O1xuCWJvcmRlci13aWR0aDowICFpbXBvcnRhbnQ7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAjdG9wQmFyICNib29rbWFya3NNaW4sXG4jYm9va21hcmtzQm94Lm1vYmlsZSAjdG9wQmFyIC5oYW5kbGV7XG4JZGlzcGxheTpub25lICFpbXBvcnRhbnQ7XG59XG5cbiNib29rbWFya3NCb3gubW9iaWxlICNib29rbWFya3NUeXBlQmFyIGg1e1xuCWN1cnNvcjpwb2ludGVyO1xuCXRleHQtYWxpZ246Y2VudGVyO1xuCWZsb2F0OmxlZnQ7XG4Jd2lkdGg6NTAlO1xuCWhlaWdodDphdXRvICFpbXBvcnRhbnQ7XG4JcGFkZGluZzo3cHggMDtcbn1cbiNib29rbWFya3NCb3gubW9iaWxlICNib29rbWFya3NUeXBlQmFyIGg1LmN1cnJlbnR7XG4JY3Vyc29yOmRlZmF1bHQ7XG4JY29sb3I6I2ZmZjtcbn1cbiNib29rbWFya3NCb3gubW9iaWxlICNib29rbWFya3NUeXBlQmFyLFxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCAuYWRkRm9ybXtcbglib3JkZXItYm90dG9tOjFweCBzb2xpZCAjMjBhOGIxICFpbXBvcnRhbnQ7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYm9va21hcmtMaXN0IHVsIGxpIHVsIGxpLmJrbXJrLFxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCBsaS5ib29rbWFya0ZvbGRlciAuZm9sZGVyTGFiZWx7XG4JaGVpZ2h0OjM2cHggIWltcG9ydGFudDtcbgljbGVhcjpib3RoO1xufVxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCBsaS5ib29rbWFya0ZvbGRlciAuZm9sZGVyTGFiZWwgYSxcbiNib29rbWFya3NCb3gubW9iaWxlIC5ib29rbWFya0xpc3QgdWwgbGkgdWwgbGkuYmttcmsgYXtcbgliYWNrZ3JvdW5kOm5vbmU7XG4JcGFkZGluZzo3cHggMDtcbgloZWlnaHQ6YXV0bztcbglib3gtc2hhZG93Omluc2V0IDAgMXB4IDAgIzIwYThiMSAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCBsaS5ib29rbWFya0ZvbGRlciBhLmJvb2ttYXJrc1JlbW92ZUZyb20sXG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYm9va21hcmtMaXN0IGxpLmJrbXJrIGEuYm9va21hcmtzUmVtb3ZlRnJvbXtcbglib3gtc2hhZG93Omluc2V0IDAgMXB4IDAgIzIwYThiMSxpbnNldCAtMXB4IDAgMCAjMjBhOGIxICFpbXBvcnRhbnQ7XG4Jd2lkdGg6MTAlO1xuCWJhY2tncm91bmQ6bm9uZSAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCBsaS5ib29rbWFya0ZvbGRlciBhLmJvb2ttYXJrc0FuY2hvcixcbiNib29rbWFya3NCb3gubW9iaWxlIC5ib29rbWFya0xpc3QgbGkuYmttcmsgYS5ib29rbWFya3NMaW5re1xuCXRleHQtaW5kZW50OjEwcHg7XG4JaGVpZ2h0OjM2cHg7XG4JbGluZS1oZWlnaHQ6MjRweDtcbglvdmVyZmxvdzpoaWRkZW47XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYm9va21hcmtMaXN0IHVsIGxpLmJvb2ttYXJrRm9sZGVyIHVse1xuCW1hcmdpbi1sZWZ0OjAgIWltcG9ydGFudDtcbn1cbiNib29rbWFya3NCb3gubW9iaWxlIC5ib29rbWFya0xpc3QgPiB1bHtcbglib3JkZXItYm90dG9tOjFweCBzb2xpZCAjMjBhOGIxICFpbXBvcnRhbnQ7XG59XG5cbiNib29rbWFya3NCb3gubW9iaWxlIC5ib29rbWFya0xpc3QgLmJvb2ttYXJrRm9sZGVyLm90aGVyc0Jvb2ttYXJrcyAgdWx7XG4JYm9yZGVyLXRvcDo1cHggc29saWQgIzIwYThiMSAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCBsaS5ib29rbWFya0ZvbGRlcixcbiNib29rbWFya3NCb3gubW9iaWxlIC5ib29rbWFya0xpc3QgbGkuYmttcmt7XG4JYm94LXNoYWRvdzppbnNldCAwIDFweCAwICMyMGE4YjEsIDFweCAwIDAgIzIwYThiMSwgLTFweCAxcHggMCAjMjBhOGIxICFpbXBvcnRhbnQ7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYm9va21hcmtMaXN0ID4gdWx7XG4JbWF4LWhlaWdodDpub25lO1xuLyoJd2lkdGg6ODUlICFpbXBvcnRhbnQ7Ki9cbn1cbiNib29rbWFya3NCb3gubW9iaWxlIC5ib29rbWFya0xpc3QgbGkuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVse1xuCWJveC1zaGFkb3c6MCAxcHggMCAjMjBhOGIxICFpbXBvcnRhbnQ7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYm9va21hcmtMaXN0IHVsIGxpLmJvb2ttYXJrRm9sZGVyIHVse1xuCXdpZHRoOjkwJSAhaW1wb3J0YW50O1xuCW1hcmdpbi1sZWZ0OjEwJSAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCB1bCBsaS5ib29rbWFya0ZvbGRlci5vdGhlcnNCb29rbWFya3MgdWx7XG4Jd2lkdGg6MTAwJSAhaW1wb3J0YW50O1xuCW1hcmdpbi1sZWZ0OjAlICFpbXBvcnRhbnQ7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZXtcbgltYXJnaW4tYm90dG9tOjVweCAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgI2Jvb2ttYXJrc1R5cGVCYXJ7XG4JaGVpZ2h0OmF1dG87XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYWRkRm9ybSxcbiNib29rbWFya3NCb3gubW9iaWxlIC5hZGRGb3JtICp7XG4JaGVpZ2h0OjM1cHggIWltcG9ydGFudDtcbglwYWRkaW5nOjA7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYWRkRm9ybSBhe1xuCWxpbmUtaGVpZ2h0OjM3cHg7XG59XG5cbiNib29rbWFya3NCb3gubW9iaWxlIC5hZGRGb3JtIGF7XG4vKgl3aWR0aDoyNSUgIWltcG9ydGFudDsqL1xufVxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmFkZEZvcm0gaW5wdXR7XG4vKgl3aWR0aDo1MCUgIWltcG9ydGFudDsqL1xuCXRleHQtaW5kZW50OjEwcHg7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAjYmttcmtfcG9ydGFscyAuYWRkRm9ybSBpbnB1dHtcbi8qCXdpZHRoOjc1JSAhaW1wb3J0YW50OyovXG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAjYm9va21hcmtzVHlwZUJhciBoNSxcbiNib29rbWFya3NCb3gubW9iaWxlIC5ib29rbWFya0xpc3QgLmFkZEZvcm0gYXtcbglib3gtc2hhZG93Oi0xcHggMCAwICMyMGE4YjEgIWltcG9ydGFudDtcbn1cbiNib29rbWFya3NCb3gubW9iaWxlIC5ib29rbWFya0xpc3QgbGkuYm9va21hcmtGb2xkZXIgdWx7XG4JZGlzcGxheTpub25lICFpbXBvcnRhbnQ7XG4JbWluLWhlaWdodDozN3B4ICFpbXBvcnRhbnQ7XG59XG4jdXBkYXRlc3RhdHVzIC5ia21ya3NTdGFye1xuCWZsb2F0OmxlZnQ7XG4JbWFyZ2luOi0xOXB4IDAgMCAtNXB4O1xuCXBhZGRpbmc6MCAzcHggMXB4IDRweDtcbgliYWNrZ3JvdW5kOiMyNjJjMzI7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYm9va21hcmtMaXN0IC5ib29rbWFya0ZvbGRlciAuZm9sZGVyTGFiZWwgLmJvb2ttYXJrc0FuY2hvciBzcGFuLFxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsID4gc3BhbixcbiNib29rbWFya3NCb3gubW9iaWxlIC5ib29rbWFya0xpc3QgLmJvb2ttYXJrRm9sZGVyIC5mb2xkZXJMYWJlbCA+IHNwYW4gPiBzcGFuLFxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCAudHJpYW5nbGV7XG4Jd2lkdGg6MCAhaW1wb3J0YW50O1xuCWhlaWdodDowICFpbXBvcnRhbnQ7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYm9va21hcmtMaXN0IC5ib29rbWFya0ZvbGRlciAuZm9sZGVyTGFiZWwgLmJvb2ttYXJrc0FuY2hvciBzcGFue1xuCWZsb2F0OmxlZnQgIWltcG9ydGFudDtcbglib3JkZXItd2lkdGg6NXB4IDAgNXB4IDdweCAhaW1wb3J0YW50O1xuCWJvcmRlci1jb2xvcjp0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB3aGl0ZSAhaW1wb3J0YW50O1xuCW1hcmdpbjo3cHggM3B4IDAgMTNweCAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIub3BlbiAuZm9sZGVyTGFiZWwgLmJvb2ttYXJrc0FuY2hvciBzcGFue1xuCW1hcmdpbjo5cHggMXB4IDAgMTJweCAhaW1wb3J0YW50O1xuCWJvcmRlci13aWR0aDo3cHggNXB4IDAgNXB4ICFpbXBvcnRhbnQ7XG4JYm9yZGVyLWNvbG9yOndoaXRlIHRyYW5zcGFyZW50IHRyYW5zcGFyZW50IHRyYW5zcGFyZW50ICFpbXBvcnRhbnQ7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYm9va21hcmtMaXN0IC5ib29rbWFya0ZvbGRlciAuZm9sZGVyTGFiZWwgPiBzcGFuLFxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIgLmZvbGRlckxhYmVsID4gc3BhbiA+IHNwYW57XG4JZGlzcGxheTpub25lICFpbXBvcnRhbnQ7XG4JYm9yZGVyLXdpZHRoOjAgMTJweCAxMHB4IDAgIWltcG9ydGFudDtcbglib3JkZXItY29sb3I6dHJhbnNwYXJlbnQgIzIwYThiMSB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCAhaW1wb3J0YW50O1xuCW1hcmdpbjotMjBweCAwIDAgMTAwJSAhaW1wb3J0YW50O1xuCXBvc2l0aW9uOnJlbGF0aXZlICFpbXBvcnRhbnQ7XG4JdG9wOjIxcHggIWltcG9ydGFudDtcbglsZWZ0Oi0xMHB4ICFpbXBvcnRhbnQ7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYm9va21hcmtMaXN0IC5ib29rbWFya0ZvbGRlciAuZm9sZGVyTGFiZWwgPiBzcGFuID4gc3Bhbntcbgl0b3A6MThweCAhaW1wb3J0YW50O1xuCWxlZnQ6MCAhaW1wb3J0YW50O1xuCWJvcmRlci13aWR0aDowIDEwcHggOXB4IDAgIWltcG9ydGFudDtcbglib3JkZXItY29sb3I6dHJhbnNwYXJlbnQgIzA2OSB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIub3BlbiAuZm9sZGVyTGFiZWwgPiBzcGFuLFxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCAuYm9va21hcmtGb2xkZXIub3BlbiAuZm9sZGVyTGFiZWwgPiBzcGFuID4gc3BhbntcbglkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnQ7XG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4JRElBTE9HIEJPWFxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qLS0tLSBBdXRvIERyYXdlciAtLS0tLSovXG4jYmttcmtzQXV0b0RyYXdlcixcbiNia21ya3NBdXRvRHJhd2VyIHAsXG4jYmttcmtzQXV0b0RyYXdlciBhe1xuCWRpc3BsYXk6YmxvY2s7XG4JcGFkZGluZzowO1xuCW1hcmdpbjowO1xufVxuI2JrbXJrc0F1dG9EcmF3ZXIgLmJvb2ttYXJrRm9sZGVye1xuCW1hcmdpbi1ib3R0b206NHB4O1xuCWJvcmRlcjoxcHggc29saWQgIzIwYThiMTtcbn1cbiNia21ya3NBdXRvRHJhd2VyIC5mb2xkZXJMYWJlbHtcbgliYWNrZ3JvdW5kOiMwNjk7XG4JcGFkZGluZzo0cHggMDtcbgljb2xvcjojZmZmO1xufVxuI2JrbXJrc0F1dG9EcmF3ZXIgLmJvb2ttYXJrRm9sZGVyIGRpdntcbglib3JkZXItdG9wOjFweCBzb2xpZCAjMjBhOGIxO1xuCXBhZGRpbmc6NnB4IDA7XG4JYmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuMyk7XG59XG4jYmttcmtzQXV0b0RyYXdlciAuYm9va21hcmtGb2xkZXIjaWRPdGhlcnMgLmZvbGRlckxhYmVse1xuCWRpc3BsYXk6bm9uZTtcbn1cbiNia21ya3NBdXRvRHJhd2VyIC5ib29rbWFya0ZvbGRlciNpZE90aGVycyBkaXZ7XG4JZGlzcGxheTpibG9jaztcbglib3JkZXItdG9wOm5vbmU7XG59XG4jYmttcmtzQXV0b0RyYXdlciBhe1xuCXRleHQtaW5kZW50OjEwcHg7XG4JcGFkZGluZzoycHggMDtcbn1cbiNia21ya3NBdXRvRHJhd2VyIC5sb25nZGlzdGFuY2Uge1xuCWNvbG9yOiAjRkZDQzAwO1xuCWZvbnQtd2VpZ2h0OiBib2xkO1xuCWJvcmRlci1ib3R0b206IDFweCBkYXNoZWQgY3VycmVudENvbG9yO1xufVxuI2JrbXJrc0F1dG9EcmF3ZXIgLmJvb2ttYXJrRm9sZGVyIGRpdiB7XG4JZGlzcGxheTpub25lO1xufVxuI2JrbXJrc0F1dG9EcmF3ZXIgYS5ia21yay5zZWxlY3RlZHtcbgljb2xvcjojMDNkYzAzO1xufVxuXG4vKi0tLS0gT3B0aW9ucyBwYW5lbCAtLS0tLSovXG4jYmttcmtzU2V0Ym94IGF7XG4JZGlzcGxheTpibG9jaztcbgljb2xvcjojZmZjZTAwO1xuCWJvcmRlcjoxcHggc29saWQgI2ZmY2UwMDtcbglwYWRkaW5nOjNweCAwO1xuCW1hcmdpbjoxMHB4IGF1dG87XG4Jd2lkdGg6ODAlO1xuCXRleHQtYWxpZ246Y2VudGVyO1xuCWJhY2tncm91bmQ6cmdiYSg4LDQ4LDc4LC45KTtcbn1cbiNia21ya3NTZXRib3ggYS5kaXNhYmxlZCxcbiNia21ya3NTZXRib3ggYS5kaXNhYmxlZDpob3Zlcntcbgljb2xvcjojNjY2O1xuCWJvcmRlci1jb2xvcjojNjY2O1xuCXRleHQtZGVjb3JhdGlvbjpub25lO1xufVxuLyotLS0tIE9wdCBwYW5lbCAtIGNvcHkgLS0tLS0qL1xuLnVpLWRpYWxvZy1ia21ya3NTZXQtY29weSB0ZXh0YXJlYXtcbgl3aWR0aDo5NiU7XG4JaGVpZ2h0OjEyMHB4O1xuCXJlc2l6ZTp2ZXJ0aWNhbDtcbn1cblxuXG4vKi0tLSBPdGhlciBPcHQgY3NzIC0tLSovXG4jYm9va21hcmtzQm94Lm1vYmlsZSBhLmJvb2ttYXJrc01vdmVJbntcbglkaXNwbGF5Om5vbmUgIWltcG9ydGFudDtcbn1cblxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJvb2ttYXJrTGlzdCB1bCBsaSB1bCBsaS5ia21yayBhLmJvb2ttYXJrc01vdmVJbntcbgliYWNrZ3JvdW5kOm5vbmUgIWltcG9ydGFudDtcbgl0ZXh0LWFsaWduOmNlbnRlcjtcbgljb2xvcjojZmZmO1xuCWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDAgIzIwQThCMSxpbnNldCAtMXB4IDAgMCAjMjBBOEIxICFpbXBvcnRhbnQ7XG4Jd2lkdGg6MTAlO1xufVxuXG4jYm9va21hcmtzQm94Lm1vYmlsZS5tb3ZlTW9kZSBhLmJvb2ttYXJrc01vdmVJbntcbglkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnQ7XG59XG5cbiNib29rbWFya3NCb3gubW92ZU1vZGUgdWwgLmJvb2ttYXJrc0xpbmssXG4jYm9va21hcmtzQm94Lm1vdmVNb2RlIHVsIC5vdGhlcnNCb29rbWFya3MgLmJvb2ttYXJrc0xpbmt7XG4Jd2lkdGg6OTAlICFpbXBvcnRhbnQ7XG59XG4uYm9va21hcmtzRGlhbG9nIGgze1xuCXRleHQtdHJhbnNmb3JtOmNhcGl0YWxpemU7bWFyZ2luLXRvcDoxMHB4O1xufVxuLmJvb2ttYXJrc0RpYWxvZyAuYm9va21hcmtGb2xkZXJ7XG4JbWFyZ2luLWJvdHRvbTo0cHg7XG4JYm9yZGVyOjFweCBzb2xpZCAjMjBhOGIxO1xuCWJhY2tncm91bmQ6IzA2OTtcbglwYWRkaW5nOjRweCAxMHB4O1xuCWNvbG9yOiNmZmY7XG4JY3Vyc29yOnBvaW50ZXI7XG59XG4uYm9va21hcmtzRGlhbG9nIC5ib29rbWFya0ZvbGRlcjpob3Zlcntcbgl0ZXh0LWRlY29yYXRpb246dW5kZXJsaW5lO1xufVxuXG4jYm9va21hcmtzQm94Lm1vYmlsZSAjdG9wQmFyIC5idG57XG4Jd2lkdGg6MTAwJTtoZWlnaHQ6NDVweCAhaW1wb3J0YW50O1xuCWZvbnQtc2l6ZToxM3B4O1xuCWNvbG9yOiNmZmY7XG4JZm9udC13ZWlnaHQ6bm9ybWFsO1xuCXBhZGRpbmctdG9wOjE3cHg7XG4JdGV4dC1pbmRlbnQ6MCAhaW1wb3J0YW50O1xufVxuI2Jvb2ttYXJrc0JveC5tb2JpbGUgLmJ0bntcbgl3aWR0aDo1MCUgIWltcG9ydGFudDtcbgliYWNrZ3JvdW5kOiMyMjI7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYnRuLmxlZnR7XG4JYm9yZGVyLXJpZ2h0OjFweCBzb2xpZCAjMjBhOGIxICFpbXBvcnRhbnQ7XG59XG4jYm9va21hcmtzQm94Lm1vYmlsZSAuYnRuI2Jvb2ttYXJrc01vdmV7XG4JYmFja2dyb3VuZDojQjQyRTJFO1xufVxuI2JrbXJrc1NldGJveHtcbgl0ZXh0LWFsaWduOmNlbnRlcjtcbn1cbicpLmFwcGVuZFRvKCdoZWFkJyk7CiAgfQoKICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zZXR1cFBvcnRhbHNMaXN0ID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBvbkJvb2ttYXJrQ2hhbmdlZChkYXRhKSB7CiAgICAgIGNvbnNvbGUubG9nKGRhdGEsIGRhdGEudGFyZ2V0LCBkYXRhLmd1aWQpOwoKICAgICAgaWYoZGF0YS50YXJnZXQgPT0gInBvcnRhbCIgJiYgZGF0YS5ndWlkKSB7CiAgICAgICAgaWYocGx1Z2luLmJvb2ttYXJrcy5maW5kQnlHdWlkKGRhdGEuZ3VpZCkpCiAgICAgICAgICAkKCdbZGF0YS1saXN0LWJvb2ttYXJrPSInK2RhdGEuZ3VpZCsnIl0nKS5hZGRDbGFzcygiZmF2b3JpdGUiKTsKICAgICAgICBlbHNlCiAgICAgICAgICAkKCdbZGF0YS1saXN0LWJvb2ttYXJrPSInK2RhdGEuZ3VpZCsnIl0nKS5yZW1vdmVDbGFzcygiZmF2b3JpdGUiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAkKCdbZGF0YS1saXN0LWJvb2ttYXJrXScpLmVhY2goZnVuY3Rpb24oaSwgZWxlbWVudCkgewogICAgICAgICAgdmFyIGd1aWQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS1saXN0LWJvb2ttYXJrIik7CiAgICAgICAgICBpZihwbHVnaW4uYm9va21hcmtzLmZpbmRCeUd1aWQoZ3VpZCkpCiAgICAgICAgICAgICQoZWxlbWVudCkuYWRkQ2xhc3MoImZhdm9yaXRlIik7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgICQoZWxlbWVudCkucmVtb3ZlQ2xhc3MoImZhdm9yaXRlIik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICB3aW5kb3cuYWRkSG9vaygncGx1Z2luQmttcmtzRWRpdCcsIG9uQm9va21hcmtDaGFuZ2VkKTsKICAgIHdpbmRvdy5hZGRIb29rKCdwbHVnaW5Ca21ya3NTeW5jRW5kJywgb25Cb29rbWFya0NoYW5nZWQpOwoKICAgIHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QuZmllbGRzLnVuc2hpZnQoeyAvLyBpbnNlcnQgYXQgZmlyc3QgY29sdW1uCiAgICAgIHRpdGxlOiAiIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uKHBvcnRhbCkgeyByZXR1cm4gcG9ydGFsLm9wdGlvbnMuZ3VpZDsgfSwgLy8gd2Ugc3RvcmUgdGhlIGd1aWQsIGJ1dCBpbXBsZW1lbnQgYSBjdXN0b20gY29tcGFyYXRvciBzbyB0aGUgbGlzdCBkb2VzIHNvcnQgcHJvcGVybHkgd2l0aG91dCBjbG9zaW5nIGFuZCByZW9wZW5pbmcgdGhlIGRpYWxvZwogICAgICBzb3J0OiBmdW5jdGlvbihndWlkQSwgZ3VpZEIpIHsKICAgICAgICB2YXIgaW5mb0EgPSBwbHVnaW4uYm9va21hcmtzLmZpbmRCeUd1aWQoZ3VpZEEpOwogICAgICAgIHZhciBpbmZvQiA9IHBsdWdpbi5ib29rbWFya3MuZmluZEJ5R3VpZChndWlkQik7CiAgICAgICAgaWYoaW5mb0EgJiYgIWluZm9CKSByZXR1cm4gMTsKICAgICAgICBpZihpbmZvQiAmJiAhaW5mb0EpIHJldHVybiAtMTsKICAgICAgICByZXR1cm4gMDsKICAgICAgfSwKICAgICAgZm9ybWF0OiBmdW5jdGlvbihjZWxsLCBwb3J0YWwsIGd1aWQpIHsKICAgICAgICAkKGNlbGwpCiAgICAgICAgICAuYWRkQ2xhc3MoInBvcnRhbC1saXN0LWJvb2ttYXJrIikKICAgICAgICAgIC5hdHRyKCJkYXRhLWxpc3QtYm9va21hcmsiLCBndWlkKTsKCiAgICAgICAgLy8gZm9yIHNvbWUgcmVhc29uLCBqUXVlcnkgcmVtb3ZlcyBldmVudCBsaXN0ZW5lcnMgd2hlbiB0aGUgbGlzdCBpcyBzb3J0ZWQuIFRoZXJlZm9yZSB3ZSB1c2UgRE9NJ3MgYWRkRXZlbnRMaXN0ZW5lcgogICAgICAgICQoJzxzcGFuPicpLmFwcGVuZFRvKGNlbGwpWzBdLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZih3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5maW5kQnlHdWlkKGd1aWQpKSB7CiAgICAgICAgICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN3aXRjaFN0YXJQb3J0YWwoZ3VpZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbGwgPSBwb3J0YWwuZ2V0TGF0TG5nKCk7CiAgICAgICAgICAgIHBsdWdpbi5ib29rbWFya3MuYWRkUG9ydGFsQm9va21hcmsoZ3VpZCwgbGwubGF0KycsJytsbC5sbmcsIHBvcnRhbC5vcHRpb25zLmRhdGEudGl0bGUpOwogICAgICAgICAgfQogICAgICAgIH0sIGZhbHNlKTsKCiAgICAgICAgaWYocGx1Z2luLmJvb2ttYXJrcy5maW5kQnlHdWlkKGd1aWQpKQogICAgICAgICAgY2VsbC5jbGFzc05hbWUgKz0gIiBmYXZvcml0ZSI7CiAgICAgIH0sCiAgICB9KTsKICB9CgogIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnNldHVwQ29udGVudCA9IGZ1bmN0aW9uKCkgewogICAgcGx1Z2luLmJvb2ttYXJrcy5odG1sQm94VHJpZ2dlciA9ICc8YSBpZD0iYmttcmtzVHJpZ2dlciIgY2xhc3M9Im9wZW4iIG9uY2xpY2s9IndpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN3aXRjaFN0YXR1c0JrbXJrc0JveChcJ3N3aXRjaFwnKTtyZXR1cm4gZmFsc2U7IiBhY2Nlc3NrZXk9InYiIHRpdGxlPSJbdl0iPlstXSBCb29rbWFya3M8L2E+JzsKICAgIHBsdWdpbi5ib29rbWFya3MuaHRtbEJrbXJrc0JveCA9ICc8ZGl2IGlkPSJib29rbWFya3NCb3giPicKICAgICAgICAgICAgICAgICAgICAgICAgICArJzxkaXYgaWQ9InRvcEJhciI+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8YSBpZD0iYm9va21hcmtzTWluIiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zd2l0Y2hTdGF0dXNCa21ya3NCb3goMCk7cmV0dXJuIGZhbHNlOyIgdGl0bGU9Ik1pbmltaXplIj4tPC9hPicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsnPGRpdiBjbGFzcz0iaGFuZGxlIj4uLi48L2Rpdj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArJzxhIGlkPSJib29rbWFya3NEZWwiIGNsYXNzPSJidG4iIG9uY2xpY2s9IndpbmRvdy5wbHVnaW4uYm9va21hcmtzLmRlbGV0ZU1vZGUoKTtyZXR1cm4gZmFsc2U7IiB0aXRsZT0iU2hvdy9IaWRlIFwnWFwnIGJ1dHRvbiI+U2hvdy9IaWRlICJYIiBidXR0b248L2E+JwogICAgICAgICAgICAgICAgICAgICAgICAgICsnPC9kaXY+JwogICAgICAgICAgICAgICAgICAgICAgICAgICsnPGRpdiBpZD0iYm9va21hcmtzVHlwZUJhciI+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8aDUgY2xhc3M9ImJrbXJrX21hcHMgY3VycmVudCIgb25jbGljaz0id2luZG93LnBsdWdpbi5ib29rbWFya3Muc3dpdGNoUGFnZUJrbXJrc0JveCh0aGlzLCAwKTtyZXR1cm4gZmFsc2UiPk1hcHM8L2g1PicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsnPGg1IGNsYXNzPSJia21ya19wb3J0YWxzIiBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zd2l0Y2hQYWdlQmttcmtzQm94KHRoaXMsIDEpO3JldHVybiBmYWxzZSI+UG9ydGFsczwvaDU+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8ZGl2IHN0eWxlPSJjbGVhcjpib3RoICFpbXBvcnRhbnQ7Ij48L2Rpdj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8L2Rpdj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8ZGl2IGlkPSJia21ya19tYXBzIiBjbGFzcz0iYm9va21hcmtMaXN0IGN1cnJlbnQiPicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsnPGRpdiBjbGFzcz0iYWRkRm9ybSI+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICArJzxpbnB1dCBwbGFjZWhvbGRlcj0iSW5zZXJ0IGxhYmVsIiAvPicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8YSBjbGFzcz0ibmV3TWFwIiBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5hZGRFbGVtZW50KHRoaXMsIFwnbWFwXCcpO3JldHVybiBmYWxzZTsiPisgTWFwPC9hPicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8YSBjbGFzcz0ibmV3Rm9sZGVyIiBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5hZGRFbGVtZW50KHRoaXMsIFwnZm9sZGVyXCcpO3JldHVybiBmYWxzZTsiPisgRm9sZGVyPC9hPicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsnPC9kaXY+JwogICAgICAgICAgICAgICAgICAgICAgICAgICsnPC9kaXY+JwogICAgICAgICAgICAgICAgICAgICAgICAgICsnPGRpdiBpZD0iYmttcmtfcG9ydGFscyIgY2xhc3M9ImJvb2ttYXJrTGlzdCI+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8ZGl2IGNsYXNzPSJhZGRGb3JtIj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsnPGlucHV0IHBsYWNlaG9sZGVyPSJJbnNlcnQgbGFiZWwiIC8+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICArJzxhIGNsYXNzPSJuZXdGb2xkZXIiIG9uY2xpY2s9IndpbmRvdy5wbHVnaW4uYm9va21hcmtzLmFkZEVsZW1lbnQodGhpcywgXCdmb2xkZXJcJyk7cmV0dXJuIGZhbHNlOyI+KyBGb2xkZXI8L2E+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8L2Rpdj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8L2Rpdj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8ZGl2IHN0eWxlPSJib3JkZXItYm90dG9tLXdpZHRoOjFweDsiPjwvZGl2PicKICAgICAgICAgICAgICAgICAgICAgICAgKyc8L2Rpdj4nOwoKICAgIHBsdWdpbi5ib29rbWFya3MuaHRtbERpc2FibGVkTWVzc2FnZSA9ICc8ZGl2IHRpdGxlPSJZb3VyIGJyb3dzZXIgZG8gbm90IHN1cHBvcnQgbG9jYWxTdG9yYWdlIj5QbHVnaW4gQm9va21hcmtzIGRpc2FibGVkKi48L2Rpdj4nOwogICAgcGx1Z2luLmJvb2ttYXJrcy5odG1sU3RhciA9ICc8YSBjbGFzcz0iYmttcmtzU3RhciIgYWNjZXNza2V5PSJiIiBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zd2l0Y2hTdGFyUG9ydGFsKCk7cmV0dXJuIGZhbHNlOyIgdGl0bGU9IlNhdmUgdGhpcyBwb3J0YWwgaW4geW91ciBib29rbWFya3MgW2JdIj48c3Bhbj48L3NwYW4+PC9hPic7CiAgICBwbHVnaW4uYm9va21hcmtzLmh0bWxDYWxsZHJhd0JveCA9ICc8YSBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5kaWFsb2dEcmF3ZXIoKTtyZXR1cm4gZmFsc2U7IiBhY2Nlc3NrZXk9InEiIHRpdGxlPSJEcmF3IGxpbmVzL3RyaWFuZ2xlcyBiZXR3ZWVuIGJvb2ttYXJrZWQgcG9ydGFscyBbcV0iPkF1dG8gZHJhdzwvYT4nOwogICAgcGx1Z2luLmJvb2ttYXJrcy5odG1sQ2FsbFNldEJveCA9ICc8YSBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5tYW51YWxPcHQoKTtyZXR1cm4gZmFsc2U7Ij5Cb29rbWFya3MgT3B0PC9hPic7CiAgICBwbHVnaW4uYm9va21hcmtzLmh0bWxNb3ZlQnRuID0gJzxhIGlkPSJib29rbWFya3NNb3ZlIiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5tb3ZlTW9kZSgpO3JldHVybiBmYWxzZTsiPlNob3cvSGlkZSAiTW92ZSIgYnV0dG9uPC9hPicKCiAgICB2YXIgYWN0aW9ucyA9ICcnOwogICAgYWN0aW9ucyArPSAnPGEgb25jbGljaz0id2luZG93LnBsdWdpbi5ib29rbWFya3Mub3B0UmVzZXQoKTtyZXR1cm4gZmFsc2U7Ij5SZXNldCBib29rbWFya3M8L2E+JzsKICAgIGFjdGlvbnMgKz0gJzxhIG9uY2xpY2s9IndpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9wdENvcHkoKTtyZXR1cm4gZmFsc2U7Ij5Db3B5IGJvb2ttYXJrczwvYT4nOwogICAgYWN0aW9ucyArPSAnPGEgb25jbGljaz0id2luZG93LnBsdWdpbi5ib29rbWFya3Mub3B0UGFzdGUoKTtyZXR1cm4gZmFsc2U7Ij5QYXN0ZSBib29rbWFya3M8L2E+JzsKCiAgICBpZihwbHVnaW4uYm9va21hcmtzLmlzQW5kcm9pZCgpKSB7CiAgICAgIGFjdGlvbnMgKz0gJzxhIG9uY2xpY2s9IndpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9wdEltcG9ydCgpO3JldHVybiBmYWxzZTsiPkltcG9ydCBib29rbWFya3M8L2E+JzsKICAgICAgYWN0aW9ucyArPSAnPGEgb25jbGljaz0id2luZG93LnBsdWdpbi5ib29rbWFya3Mub3B0RXhwb3J0KCk7cmV0dXJuIGZhbHNlOyI+RXhwb3J0IGJvb2ttYXJrczwvYT4nOwogICAgfQogICAgYWN0aW9ucyArPSAnPGEgb25jbGljaz0id2luZG93LnBsdWdpbi5ib29rbWFya3Mub3B0UmVuYW1lRigpO3JldHVybiBmYWxzZTsiPlJlbmFtZSBGb2xkZXI8L2E+JwogICAgaWYoIXBsdWdpbi5ib29rbWFya3MuaXNBbmRyb2lkKCkpIHsKICAgICAgYWN0aW9ucyArPSAnPGEgb25jbGljaz0id2luZG93LnBsdWdpbi5ib29rbWFya3Mub3B0Qm94KFwnc2F2ZVwnKTtyZXR1cm4gZmFsc2U7Ij5TYXZlIGJveCBwb3NpdGlvbjwvYT4nOwogICAgICBhY3Rpb25zICs9ICc8YSBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5vcHRCb3goXCdyZXNldFwnKTtyZXR1cm4gZmFsc2U7Ij5SZXNldCBib3ggcG9zaXRpb248L2E+JzsKICAgIH0KICAgIHBsdWdpbi5ib29rbWFya3MuaHRtbFNldGJveCA9ICc8ZGl2IGlkPSJia21ya3NTZXRib3giPicgKyBhY3Rpb25zICsgJzwvZGl2Pic7CiAgfQoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgdmFyIHNldHVwID0gZnVuY3Rpb24oKSB7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5pc1NtYXJ0ID0gd2luZG93LmlzU21hcnRwaG9uZSgpOwoKICAgIC8vIEZpcmVkIHdoZW4gYSBib29rbWFya3MvZm9sZGVyIGlzIHJlbW92ZWQsIGFkZGVkIG9yIHNvcnRlZCwgYWxzbyB3aGVuIGEgZm9sZGVyIGlzIG9wZW5lZC9jbG9zZWQuCiAgICBpZigkLmluQXJyYXkoJ3BsdWdpbkJrbXJrc0VkaXQnLCB3aW5kb3cuVkFMSURfSE9PS1MpIDwgMCkgeyB3aW5kb3cuVkFMSURfSE9PS1MucHVzaCgncGx1Z2luQmttcmtzRWRpdCcpOyB9CiAgICAvLyBGaXJlZCB3aGVuIHRoZSAiQm9va21hcmtzIE9wdGlvbnMiIHBhbmVsIGlzIG9wZW5lZCAoeW91IGNhbiBhZGQgbmV3IG9wdGlvbnMpOwogICAgaWYoJC5pbkFycmF5KCdwbHVnaW5Ca21ya3NPcGVuT3B0Jywgd2luZG93LlZBTElEX0hPT0tTKSA8IDApIHsgd2luZG93LlZBTElEX0hPT0tTLnB1c2goJ3BsdWdpbkJrbXJrc09wZW5PcHQnKTsgfQogICAgLy8gRmlyZWQgd2hlbiB0aGUgc3luYyBpcyBmaW5pc2hlZDsKICAgIGlmKCQuaW5BcnJheSgncGx1Z2luQmttcmtzU3luY0VuZCcsIHdpbmRvdy5WQUxJRF9IT09LUykgPCAwKSB7IHdpbmRvdy5WQUxJRF9IT09LUy5wdXNoKCdwbHVnaW5Ca21ya3NTeW5jRW5kJyk7IH0KCiAgICAvLyBJZiB0aGUgc3RvcmFnZSBub3QgZXhpc3RzIG9yIGlzIGEgb2xkIHZlcnNpb24KICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmNyZWF0ZVN0b3JhZ2UoKTsKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnVwZ3JhZGVUb05ld1N0b3JhZ2UoKTsKCiAgICAvLyBMb2FkIGRhdGEgZnJvbSBsb2NhbFN0b3JhZ2UKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmxvYWRTdG9yYWdlKCk7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5sb2FkU3RvcmFnZUJveCgpOwogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc2V0dXBDb250ZW50KCk7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zZXR1cENTUygpOwoKICAgIGlmKCF3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5pc1NtYXJ0KSB7CiAgICAgICQoJ2JvZHknKS5hcHBlbmQod2luZG93LnBsdWdpbi5ib29rbWFya3MuaHRtbEJveFRyaWdnZXIgKyB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5odG1sQmttcmtzQm94KTsKICAgICAgJCgnI2Jvb2ttYXJrc0JveCcpLmRyYWdnYWJsZSh7IGhhbmRsZTonLmhhbmRsZScsIGNvbnRhaW5tZW50Oid3aW5kb3cnIH0pOwogICAgICAkKCIjYm9va21hcmtzQm94ICNib29rbWFya3NNaW4gLCAjYm9va21hcmtzQm94IHVsIGxpLCAjYm9va21hcmtzQm94IHVsIGxpIGEsICNib29rbWFya3NCb3ggdWwgbGkgYSBzcGFuLCAjYm9va21hcmtzQm94IGg1LCAjYm9va21hcmtzQm94IC5hZGRGb3JtIGEiKS5kaXNhYmxlU2VsZWN0aW9uKCk7CiAgICAgICQoJyNib29rbWFya3NCb3gnKS5jc3Moeyd0b3AnOndpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXR1c0JveC5wb3MueCwgJ2xlZnQnOndpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXR1c0JveC5wb3MueX0pOwogICAgfWVsc2V7CiAgICAgICQoJ2JvZHknKS5hcHBlbmQod2luZG93LnBsdWdpbi5ib29rbWFya3MuaHRtbEJrbXJrc0JveCk7CiAgICAgICQoJyNib29rbWFya3NCb3gnKS5jc3MoImRpc3BsYXkiLCAibm9uZSIpLmFkZENsYXNzKCJtb2JpbGUiKTsKCiAgICAgIGlmKHdpbmRvdy51c2VBbmRyb2lkUGFuZXMoKSkKICAgICAgICBhbmRyb2lkLmFkZFBhbmUoInBsdWdpbi1ib29rbWFya3MiLCAiQm9va21hcmtzIiwgImljX2FjdGlvbl9zdGFyIik7CiAgICAgIHdpbmRvdy5hZGRIb29rKCdwYW5lQ2hhbmdlZCcsIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLm9uUGFuZUNoYW5nZWQpOwogICAgfQogICAgJCgnI3Rvb2xib3gnKS5hcHBlbmQod2luZG93LnBsdWdpbi5ib29rbWFya3MuaHRtbENhbGxTZXRCb3grd2luZG93LnBsdWdpbi5ib29rbWFya3MuaHRtbENhbGxkcmF3Qm94KTsKCiAgICBpZih3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5pc1NtYXJ0KSB7Ci8vICAgICAgJCgnI2Jvb2ttYXJrc0JveC5tb2JpbGUgI3RvcEJhcicpLnByZXBlbmQod2luZG93LnBsdWdpbi5ib29rbWFya3MuaHRtbENhbGxTZXRCb3grd2luZG93LnBsdWdpbi5ib29rbWFya3MuaHRtbENhbGxkcmF3Qm94KTsgLy8gd29uayBpbiBwcm9ncmVzcwogICAgICAkKCcjYm9va21hcmtzQm94Lm1vYmlsZSAjdG9wQmFyJykuYXBwZW5kKHBsdWdpbi5ib29rbWFya3MuaHRtbE1vdmVCdG4pOwogICAgfQoKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmxvYWRMaXN0KCdtYXBzJyk7CiAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5sb2FkTGlzdCgncG9ydGFscycpOwogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3MuanF1ZXJ5U29ydGFibGVTY3JpcHQoKTsKCiAgICBpZih3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zdGF0dXNCb3hbJ3Nob3cnXSA9PT0gMCkgeyB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zd2l0Y2hTdGF0dXNCa21ya3NCb3goMCk7IH0KICAgIGlmKHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLnN0YXR1c0JveFsncGFnZSddID09PSAxKSB7ICQoJyNib29rbWFya3NCb3ggaDUuYmttcmtfcG9ydGFscycpLnRyaWdnZXIoJ2NsaWNrJyk7IH0KCiAgICB3aW5kb3cuYWRkSG9vaygncG9ydGFsU2VsZWN0ZWQnLCB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5vblBvcnRhbFNlbGVjdGVkKTsKICAgIHdpbmRvdy5hZGRIb29rKCdzZWFyY2gnLCB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5vblNlYXJjaCk7CgogICAgLy8gU3luYwogICAgd2luZG93LmFkZEhvb2soJ3BsdWdpbkJrbXJrc0VkaXQnLCB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zeW5jQmttcmtzKTsKICAgIHdpbmRvdy5hZGRIb29rKCdpaXRjTG9hZGVkJywgd2luZG93LnBsdWdpbi5ib29rbWFya3MucmVnaXN0ZXJGaWVsZEZvclN5bmNpbmcpOwoKICAgIC8vIEhpZ2hsaWdodGVyIC0gYm9va21hcmtlZCBwb3J0YWxzCiAgICB3aW5kb3cuYWRkSG9vaygncGx1Z2luQmttcmtzRWRpdCcsIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmhpZ2hsaWdodFJlZnJlc2gpOwogICAgd2luZG93LmFkZEhvb2soJ3BsdWdpbkJrbXJrc1N5bmNFbmQnLCB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5oaWdobGlnaHRSZWZyZXNoKTsKICAgIHdpbmRvdy5hZGRQb3J0YWxIaWdobGlnaHRlcignQm9va21hcmtlZCBQb3J0YWxzJywgd2luZG93LnBsdWdpbi5ib29rbWFya3MuaGlnaGxpZ2h0KTsKCiAgICAvLyBMYXllciAtIEJvb2ttYXJrZWQgcG9ydGFscwogICAgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc3RhckxheWVyR3JvdXAgPSBuZXcgTC5MYXllckdyb3VwKCk7CiAgICB3aW5kb3cuYWRkTGF5ZXJHcm91cCgnQm9va21hcmtlZCBQb3J0YWxzJywgd2luZG93LnBsdWdpbi5ib29rbWFya3Muc3RhckxheWVyR3JvdXAsIGZhbHNlKTsKICAgIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmFkZEFsbFN0YXJzKCk7CiAgICB3aW5kb3cuYWRkSG9vaygncGx1Z2luQmttcmtzRWRpdCcsIHdpbmRvdy5wbHVnaW4uYm9va21hcmtzLmVkaXRTdGFyKTsKICAgIHdpbmRvdy5hZGRIb29rKCdwbHVnaW5Ca21ya3NTeW5jRW5kJywgd2luZG93LnBsdWdpbi5ib29rbWFya3MucmVzZXRBbGxTdGFycyk7CgogICAgaWYod2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdCkgewogICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zZXR1cFBvcnRhbHNMaXN0KCk7CiAgICB9IGVsc2UgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGlmKHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QpCiAgICAgICAgICB3aW5kb3cucGx1Z2luLmJvb2ttYXJrcy5zZXR1cFBvcnRhbHNMaXN0KCk7CiAgICAgIH0sIDUwMCk7CiAgICB9CiAgfQoKLy8gUExVR0lOIEVORCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKc2V0dXAuaW5mbyA9IHBsdWdpbl9pbmZvOyAvL2FkZCB0aGUgc2NyaXB0IGluZm8gZGF0YSB0byB0aGUgZnVuY3Rpb24gYXMgYSBwcm9wZXJ0eQppZighd2luZG93LmJvb3RQbHVnaW5zKSB3aW5kb3cuYm9vdFBsdWdpbnMgPSBbXTsKd2luZG93LmJvb3RQbHVnaW5zLnB1c2goc2V0dXApOwovLyBpZiBJSVRDIGhhcyBhbHJlYWR5IGJvb3RlZCwgaW1tZWRpYXRlbHkgcnVuIHRoZSAnc2V0dXAnIGZ1bmN0aW9uCmlmKHdpbmRvdy5paXRjTG9hZGVkICYmIHR5cGVvZiBzZXR1cCA9PT0gJ2Z1bmN0aW9uJykgc2V0dXAoKTsKfSAvLyB3cmFwcGVyIGVuZAovLyBpbmplY3QgY29kZSBpbnRvIHNpdGUgY29udGV4dAp2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CnZhciBpbmZvID0ge307CmlmICh0eXBlb2YgR01faW5mbyAhPT0gJ3VuZGVmaW5lZCcgJiYgR01faW5mbyAmJiBHTV9pbmZvLnNjcmlwdCkgaW5mby5zY3JpcHQgPSB7IHZlcnNpb246IEdNX2luZm8uc2NyaXB0LnZlcnNpb24sIG5hbWU6IEdNX2luZm8uc2NyaXB0Lm5hbWUsIGRlc2NyaXB0aW9uOiBHTV9pbmZvLnNjcmlwdC5kZXNjcmlwdGlvbiB9OwpzY3JpcHQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJygnKyB3cmFwcGVyICsnKSgnK0pTT04uc3RyaW5naWZ5KGluZm8pKycpOycpKTsKKGRvY3VtZW50LmJvZHkgfHwgZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmFwcGVuZENoaWxkKHNjcmlwdCk7CgoK"},{"name":"IITC plugin: draw tools","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null}},"storage":{"data":{},"ts":1480917632213},"enabled":true,"position":5,"file_url":"https://static.iitc.me/build/release/plugins/draw-tools.user.js","uuid":"b514a450-156f-44d5-b2b4-f769d509973b","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLWRyYXctdG9vbHNAYnJldW5pZ3MKLy8gQG5hbWUgICAgICAgICAgIElJVEMgcGx1Z2luOiBkcmF3IHRvb2xzCi8vIEBjYXRlZ29yeSAgICAgICBMYXllcgovLyBAdmVyc2lvbiAgICAgICAgMC43LjAuMjAxNjEwMDMuNDc0MAovLyBAbmFtZXNwYWNlICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2pvbmF0a2lucy9pbmdyZXNzLWludGVsLXRvdGFsLWNvbnZlcnNpb24KLy8gQHVwZGF0ZVVSTCAgICAgIGh0dHBzOi8vc3RhdGljLmlpdGMubWUvYnVpbGQvcmVsZWFzZS9wbHVnaW5zL2RyYXctdG9vbHMubWV0YS5qcwovLyBAZG93bmxvYWRVUkwgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3BsdWdpbnMvZHJhdy10b29scy51c2VyLmpzCi8vIEBkZXNjcmlwdGlvbiAgICBbaWl0Yy0yMDE2LTEwLTAzLTAwNDc0MF0gQWxsb3cgZHJhd2luZyB0aGluZ3Mgb250byB0aGUgY3VycmVudCBtYXAgc28geW91IG1heSBwbGFuIHlvdXIgbmV4dCBtb3ZlLgovLyBAaW5jbHVkZSAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBtYXRjaCAgICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBtYXRjaCAgICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBncmFudCAgICAgICAgICBub25lCi8vID09L1VzZXJTY3JpcHQ9PQoKCmZ1bmN0aW9uIHdyYXBwZXIocGx1Z2luX2luZm8pIHsKLy8gZW5zdXJlIHBsdWdpbiBmcmFtZXdvcmsgaXMgdGhlcmUsIGV2ZW4gaWYgaWl0YyBpcyBub3QgeWV0IGxvYWRlZAppZih0eXBlb2Ygd2luZG93LnBsdWdpbiAhPT0gJ2Z1bmN0aW9uJykgd2luZG93LnBsdWdpbiA9IGZ1bmN0aW9uKCkge307CgovL1BMVUdJTiBBVVRIT1JTOiB3cml0aW5nIGEgcGx1Z2luIG91dHNpZGUgb2YgdGhlIElJVEMgYnVpbGQgZW52aXJvbm1lbnQ/IGlmIHNvLCBkZWxldGUgdGhlc2UgbGluZXMhIQovLyhsZWF2aW5nIHRoZW0gaW4gcGxhY2UgbWlnaHQgYnJlYWsgdGhlICdBYm91dCBJSVRDJyBwYWdlIG9yIGJyZWFrIHVwZGF0ZSBjaGVja3MpCnBsdWdpbl9pbmZvLmJ1aWxkTmFtZSA9ICdpaXRjJzsKcGx1Z2luX2luZm8uZGF0ZVRpbWVWZXJzaW9uID0gJzIwMTYxMDAzLjQ3NDAnOwpwbHVnaW5faW5mby5wbHVnaW5JZCA9ICdkcmF3LXRvb2xzJzsKLy9FTkQgUExVR0lOIEFVVEhPUlMgTk9URQoKCgovLyBQTFVHSU4gU1RBUlQgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgovLyB1c2Ugb3duIG5hbWVzcGFjZSBmb3IgcGx1Z2luCndpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzID0gZnVuY3Rpb24oKSB7fTsKCndpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmxvYWRFeHRlcm5hbHMgPSBmdW5jdGlvbigpIHsKICB0cnkgeyBjb25zb2xlLmxvZygnTG9hZGluZyBsZWFmbGV0LmRyYXcgSlMgbm93Jyk7IH0gY2F0Y2goZSkge30KICAvKgoJTGVhZmxldC5kcmF3LCBhIHBsdWdpbiB0aGF0IGFkZHMgZHJhd2luZyBhbmQgZWRpdGluZyB0b29scyB0byBMZWFmbGV0IHBvd2VyZWQgbWFwcy4KCShjKSAyMDEyLTIwMTMsIEphY29iIFRveWUsIFNtYXJ0cmFrCgoJaHR0cHM6Ly9naXRodWIuY29tL0xlYWZsZXQvTGVhZmxldC5kcmF3CglodHRwOi8vbGVhZmxldGpzLmNvbQoJaHR0cHM6Ly9naXRodWIuY29tL2phY29idG95ZQoqLwooZnVuY3Rpb24gKHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewovKgogKiBMZWFmbGV0LmRyYXcgYXNzdW1lcyB0aGF0IHlvdSBoYXZlIGFscmVhZHkgaW5jbHVkZWQgdGhlIExlYWZsZXQgbGlicmFyeS4KICovCgpMLmRyYXdWZXJzaW9uID0gJzAuMi4xLWRldic7CgpMLmRyYXdMb2NhbCA9IHsKCWRyYXc6IHsKCQl0b29sYmFyOiB7CgkJCWFjdGlvbnM6IHsKCQkJCXRpdGxlOiAnQ2FuY2VsIGRyYXdpbmcnLAoJCQkJdGV4dDogJ0NhbmNlbCcKCQkJfSwKCQkJYnV0dG9uczogewoJCQkJcG9seWxpbmU6ICdEcmF3IGEgcG9seWxpbmUnLAoJCQkJcG9seWdvbjogJ0RyYXcgYSBwb2x5Z29uJywKCQkJCXJlY3RhbmdsZTogJ0RyYXcgYSByZWN0YW5nbGUnLAoJCQkJY2lyY2xlOiAnRHJhdyBhIGNpcmNsZScsCgkJCQltYXJrZXI6ICdEcmF3IGEgbWFya2VyJwoJCQl9CgkJfSwKCQloYW5kbGVyczogewoJCQljaXJjbGU6IHsKCQkJCXRvb2x0aXA6IHsKCQkJCQlzdGFydDogJ0NsaWNrIGFuZCBkcmFnIHRvIGRyYXcgY2lyY2xlLicKCQkJCX0KCQkJfSwKCQkJbWFya2VyOiB7CgkJCQl0b29sdGlwOiB7CgkJCQkJc3RhcnQ6ICdDbGljayBtYXAgdG8gcGxhY2UgbWFya2VyLicKCQkJCX0KCQkJfSwKCQkJcG9seWdvbjogewoJCQkJdG9vbHRpcDogewoJCQkJCXN0YXJ0OiAnQ2xpY2sgdG8gc3RhcnQgZHJhd2luZyBzaGFwZS4nLAoJCQkJCWNvbnQ6ICdDbGljayB0byBjb250aW51ZSBkcmF3aW5nIHNoYXBlLicsCgkJCQkJZW5kOiAnQ2xpY2sgZmlyc3QgcG9pbnQgdG8gY2xvc2UgdGhpcyBzaGFwZS4nCgkJCQl9CgkJCX0sCgkJCXBvbHlsaW5lOiB7CgkJCQllcnJvcjogJzxzdHJvbmc+RXJyb3I6PC9zdHJvbmc+IHNoYXBlIGVkZ2VzIGNhbm5vdCBjcm9zcyEnLAoJCQkJdG9vbHRpcDogewoJCQkJCXN0YXJ0OiAnQ2xpY2sgdG8gc3RhcnQgZHJhd2luZyBsaW5lLicsCgkJCQkJY29udDogJ0NsaWNrIHRvIGNvbnRpbnVlIGRyYXdpbmcgbGluZS4nLAoJCQkJCWVuZDogJ0NsaWNrIGxhc3QgcG9pbnQgdG8gZmluaXNoIGxpbmUuJwoJCQkJfQoJCQl9LAoJCQlyZWN0YW5nbGU6IHsKCQkJCXRvb2x0aXA6IHsKCQkJCQlzdGFydDogJ0NsaWNrIGFuZCBkcmFnIHRvIGRyYXcgcmVjdGFuZ2xlLicKCQkJCX0KCQkJfSwKCQkJc2ltcGxlc2hhcGU6IHsKCQkJCXRvb2x0aXA6IHsKCQkJCQllbmQ6ICdSZWxlYXNlIG1vdXNlIHRvIGZpbmlzaCBkcmF3aW5nLicKCQkJCX0KCQkJfQoJCX0KCX0sCgllZGl0OiB7CgkJdG9vbGJhcjogewoJCQlhY3Rpb25zOiB7CgkJCQlzYXZlOiB7CgkJCQkJdGl0bGU6ICdTYXZlIGNoYW5nZXMuJywKCQkJCQl0ZXh0OiAnU2F2ZScKCQkJCX0sCgkJCQljYW5jZWw6IHsKCQkJCQl0aXRsZTogJ0NhbmNlbCBlZGl0aW5nLCBkaXNjYXJkcyBhbGwgY2hhbmdlcy4nLAoJCQkJCXRleHQ6ICdDYW5jZWwnCgkJCQl9CgkJCX0sCgkJCWJ1dHRvbnM6IHsKCQkJCWVkaXQ6ICdFZGl0IGxheWVycycsCgkJCQlyZW1vdmU6ICdEZWxldGUgbGF5ZXJzJwoJCQl9CgkJfSwKCQloYW5kbGVyczogewoJCQllZGl0OiB7CgkJCQl0b29sdGlwOiB7CgkJCQkJdGV4dDogJ0RyYWcgaGFuZGxlcywgb3IgbWFya2VyIHRvIGVkaXQgZmVhdHVyZS4nLAoJCQkJCXN1YnRleHQ6ICdDbGljayBjYW5jZWwgdG8gdW5kbyBjaGFuZ2VzLicKCQkJCX0KCQkJfSwKCQkJcmVtb3ZlOiB7CgkJCQl0b29sdGlwOiB7CgkJCQkJdGV4dDogJ0NsaWNrIG9uIGEgZmVhdHVyZSB0byByZW1vdmUnCgkJCQl9CgkJCX0KCQl9Cgl9Cn07CgpMLkRyYXcgPSB7fTsKCkwuRHJhdy5GZWF0dXJlID0gTC5IYW5kbGVyLmV4dGVuZCh7CglpbmNsdWRlczogTC5NaXhpbi5FdmVudHMsCgoJaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG1hcCwgb3B0aW9ucykgewoJCXRoaXMuX21hcCA9IG1hcDsKCQl0aGlzLl9jb250YWluZXIgPSBtYXAuX2NvbnRhaW5lcjsKCQl0aGlzLl9vdmVybGF5UGFuZSA9IG1hcC5fcGFuZXMub3ZlcmxheVBhbmU7CgkJdGhpcy5fcG9wdXBQYW5lID0gbWFwLl9wYW5lcy5wb3B1cFBhbmU7CgoJCS8vIE1lcmdlIGRlZmF1bHQgc2hhcGVPcHRpb25zIG9wdGlvbnMgd2l0aCBjdXN0b20gc2hhcGVPcHRpb25zCgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zaGFwZU9wdGlvbnMpIHsKCQkJb3B0aW9ucy5zaGFwZU9wdGlvbnMgPSBMLlV0aWwuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMuc2hhcGVPcHRpb25zLCBvcHRpb25zLnNoYXBlT3B0aW9ucyk7CgkJfQoJCUwuVXRpbC5leHRlbmQodGhpcy5vcHRpb25zLCBvcHRpb25zKTsKCX0sCgoJZW5hYmxlOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX2VuYWJsZWQpIHsgcmV0dXJuOyB9CgoJCUwuSGFuZGxlci5wcm90b3R5cGUuZW5hYmxlLmNhbGwodGhpcyk7CgoJCXRoaXMuZmlyZSgnZW5hYmxlZCcsIHsgaGFuZGxlcjogdGhpcy50eXBlIH0pOwoKCQl0aGlzLl9tYXAuZmlyZSgnZHJhdzpkcmF3c3RhcnQnLCB7IGxheWVyVHlwZTogdGhpcy50eXBlIH0pOwoJfSwKCglkaXNhYmxlOiBmdW5jdGlvbiAoKSB7CgkJaWYgKCF0aGlzLl9lbmFibGVkKSB7IHJldHVybjsgfQoKCQlMLkhhbmRsZXIucHJvdG90eXBlLmRpc2FibGUuY2FsbCh0aGlzKTsKCgkJdGhpcy5maXJlKCdkaXNhYmxlZCcsIHsgaGFuZGxlcjogdGhpcy50eXBlIH0pOwoKCQl0aGlzLl9tYXAuZmlyZSgnZHJhdzpkcmF3c3RvcCcsIHsgbGF5ZXJUeXBlOiB0aGlzLnR5cGUgfSk7Cgl9LAoKCWFkZEhvb2tzOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX21hcCkgewoJCQlMLkRvbVV0aWwuZGlzYWJsZVRleHRTZWxlY3Rpb24oKTsKCgkJCXRoaXMuX3Rvb2x0aXAgPSBuZXcgTC5Ub29sdGlwKHRoaXMuX21hcCk7CgoJCQlMLkRvbUV2ZW50LmFkZExpc3RlbmVyKHRoaXMuX2NvbnRhaW5lciwgJ2tleXVwJywgdGhpcy5fY2FuY2VsRHJhd2luZywgdGhpcyk7CgkJfQoJfSwKCglyZW1vdmVIb29rczogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9tYXApIHsKCQkJTC5Eb21VdGlsLmVuYWJsZVRleHRTZWxlY3Rpb24oKTsKCgkJCXRoaXMuX3Rvb2x0aXAuZGlzcG9zZSgpOwoJCQl0aGlzLl90b29sdGlwID0gbnVsbDsKCgkJCUwuRG9tRXZlbnQucmVtb3ZlTGlzdGVuZXIodGhpcy5fY29udGFpbmVyLCAna2V5dXAnLCB0aGlzLl9jYW5jZWxEcmF3aW5nKTsKCQl9Cgl9LAoKCXNldE9wdGlvbnM6IGZ1bmN0aW9uIChvcHRpb25zKSB7CgkJTC5zZXRPcHRpb25zKHRoaXMsIG9wdGlvbnMpOwoJfSwKCglfZmlyZUNyZWF0ZWRFdmVudDogZnVuY3Rpb24gKGxheWVyKSB7CgkJdGhpcy5fbWFwLmZpcmUoJ2RyYXc6Y3JlYXRlZCcsIHsgbGF5ZXI6IGxheWVyLCBsYXllclR5cGU6IHRoaXMudHlwZSB9KTsKCX0sCgoJLy8gQ2FuY2VsIGRyYXdpbmcgd2hlbiB0aGUgZXNjYXBlIGtleSBpcyBwcmVzc2VkCglfY2FuY2VsRHJhd2luZzogZnVuY3Rpb24gKGUpIHsKCQlpZiAoZS5rZXlDb2RlID09PSAyNykgewoJCQl0aGlzLmRpc2FibGUoKTsKCQl9Cgl9Cn0pOwoKTC5EcmF3LlBvbHlsaW5lID0gTC5EcmF3LkZlYXR1cmUuZXh0ZW5kKHsKCXN0YXRpY3M6IHsKCQlUWVBFOiAncG9seWxpbmUnCgl9LAoKCVBvbHk6IEwuR2VvZGVzaWNQb2x5bGluZSwKCglvcHRpb25zOiB7CgkJYWxsb3dJbnRlcnNlY3Rpb246IHRydWUsCgkJcmVwZWF0TW9kZTogZmFsc2UsCgkJZHJhd0Vycm9yOiB7CgkJCWNvbG9yOiAnI2IwMGIwMCcsCgkJCXRpbWVvdXQ6IDI1MDAKCQl9LAoJCWljb246IG5ldyBMLkRpdkljb24oewoJCQlpY29uU2l6ZTogbmV3IEwuUG9pbnQoOCwgOCksCgkJCWNsYXNzTmFtZTogJ2xlYWZsZXQtZGl2LWljb24gbGVhZmxldC1lZGl0aW5nLWljb24nCgkJfSksCgkJZ3VpZGVsaW5lRGlzdGFuY2U6IDIwLAoJCXNoYXBlT3B0aW9uczogewoJCQlzdHJva2U6IHRydWUsCgkJCWNvbG9yOiAnI2YwNmVhYScsCgkJCXdlaWdodDogNCwKCQkJb3BhY2l0eTogMC41LAoJCQlmaWxsOiBmYWxzZSwKCQkJY2xpY2thYmxlOiB0cnVlCgkJfSwKCQltZXRyaWM6IHRydWUsIC8vIFdoZXRoZXIgdG8gdXNlIHRoZSBtZXRyaWMgbWVhc3VyZW1lbnQgc3lzdGVtIG9yIGltcGVyaWFsCgkJekluZGV4T2Zmc2V0OiAyMDAwIC8vIFRoaXMgc2hvdWxkIGJlID4gdGhhbiB0aGUgaGlnaGVzdCB6LWluZGV4IGFueSBtYXAgbGF5ZXJzCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChtYXAsIG9wdGlvbnMpIHsKCQkvLyBOZWVkIHRvIHNldCB0aGlzIGhlcmUgdG8gZW5zdXJlIHRoZSBjb3JyZWN0IG1lc3NhZ2UgaXMgdXNlZC4KCQl0aGlzLm9wdGlvbnMuZHJhd0Vycm9yLm1lc3NhZ2UgPSBMLmRyYXdMb2NhbC5kcmF3LmhhbmRsZXJzLnBvbHlsaW5lLmVycm9yOwoKCQkvLyBNZXJnZSBkZWZhdWx0IGRyYXdFcnJvciBvcHRpb25zIHdpdGggY3VzdG9tIG9wdGlvbnMKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmRyYXdFcnJvcikgewoJCQlvcHRpb25zLmRyYXdFcnJvciA9IEwuVXRpbC5leHRlbmQoe30sIHRoaXMub3B0aW9ucy5kcmF3RXJyb3IsIG9wdGlvbnMuZHJhd0Vycm9yKTsKCQl9CgoJCS8vIFNhdmUgdGhlIHR5cGUgc28gc3VwZXIgY2FuIGZpcmUsIG5lZWQgdG8gZG8gdGhpcyBhcyBjYW5ub3QgZG8gdGhpcy5UWVBFIDooCgkJdGhpcy50eXBlID0gTC5EcmF3LlBvbHlsaW5lLlRZUEU7CgoJCUwuRHJhdy5GZWF0dXJlLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcywgbWFwLCBvcHRpb25zKTsKCX0sCgoJYWRkSG9va3M6IGZ1bmN0aW9uICgpIHsKCQlMLkRyYXcuRmVhdHVyZS5wcm90b3R5cGUuYWRkSG9va3MuY2FsbCh0aGlzKTsKCQlpZiAodGhpcy5fbWFwKSB7CgkJCXRoaXMuX21hcmtlcnMgPSBbXTsKCgkJCXRoaXMuX21hcmtlckdyb3VwID0gbmV3IEwuTGF5ZXJHcm91cCgpOwoJCQl0aGlzLl9tYXAuYWRkTGF5ZXIodGhpcy5fbWFya2VyR3JvdXApOwoKCQkJdGhpcy5fcG9seSA9IG5ldyBMLkdlb2Rlc2ljUG9seWxpbmUoW10sIHRoaXMub3B0aW9ucy5zaGFwZU9wdGlvbnMpOwoKCQkJdGhpcy5fdG9vbHRpcC51cGRhdGVDb250ZW50KHRoaXMuX2dldFRvb2x0aXBUZXh0KCkpOwoKCQkJLy8gTWFrZSBhIHRyYW5zcGFyZW50IG1hcmtlciB0aGF0IHdpbGwgdXNlZCB0byBjYXRjaCBjbGljayBldmVudHMuIFRoZXNlIGNsaWNrCgkJCS8vIGV2ZW50cyB3aWxsIGNyZWF0ZSB0aGUgdmVydGljZXMuIFdlIG5lZWQgdG8gZG8gdGhpcyBzbyB3ZSBjYW4gZW5zdXJlIHRoYXQKCQkJLy8gd2UgY2FuIGNyZWF0ZSB2ZXJ0aWNlcyBvdmVyIG90aGVyIG1hcCBsYXllcnMgKG1hcmtlcnMsIHZlY3RvciBsYXllcnMpLiBXZQoJCQkvLyBhbHNvIGRvIG5vdCB3YW50IHRvIHRyaWdnZXIgYW55IGNsaWNrIGhhbmRsZXJzIG9mIG9iamVjdHMgd2UgYXJlIGNsaWNraW5nIG9uCgkJCS8vIHdoaWxlIGRyYXdpbmcuCgkJCWlmICghdGhpcy5fbW91c2VNYXJrZXIpIHsKCQkJCXRoaXMuX21vdXNlTWFya2VyID0gTC5tYXJrZXIodGhpcy5fbWFwLmdldENlbnRlcigpLCB7CgkJCQkJaWNvbjogTC5kaXZJY29uKHsKCQkJCQkJY2xhc3NOYW1lOiAnbGVhZmxldC1tb3VzZS1tYXJrZXInLAoJCQkJCQlpY29uQW5jaG9yOiBbMjAsIDIwXSwKCQkJCQkJaWNvblNpemU6IFs0MCwgNDBdCgkJCQkJfSksCgkJCQkJb3BhY2l0eTogMCwKCQkJCQl6SW5kZXhPZmZzZXQ6IHRoaXMub3B0aW9ucy56SW5kZXhPZmZzZXQKCQkJCX0pOwoJCQl9CgoJCQl0aGlzLl9tb3VzZU1hcmtlcgoJCQkJLm9uKCdjbGljaycsIHRoaXMuX29uQ2xpY2ssIHRoaXMpCgkJCQkuYWRkVG8odGhpcy5fbWFwKTsKCgkJCXRoaXMuX21hcAoJCQkJLm9uKCdtb3VzZW1vdmUnLCB0aGlzLl9vbk1vdXNlTW92ZSwgdGhpcykKCQkJCS5vbignem9vbWVuZCcsIHRoaXMuX29uWm9vbUVuZCwgdGhpcyk7CgkJfQoJfSwKCglyZW1vdmVIb29rczogZnVuY3Rpb24gKCkgewoJCUwuRHJhdy5GZWF0dXJlLnByb3RvdHlwZS5yZW1vdmVIb29rcy5jYWxsKHRoaXMpOwoKCQl0aGlzLl9jbGVhckhpZGVFcnJvclRpbWVvdXQoKTsKCgkJdGhpcy5fY2xlYW5VcFNoYXBlKCk7CgoJCS8vIHJlbW92ZSBtYXJrZXJzIGZyb20gbWFwCgkJdGhpcy5fbWFwLnJlbW92ZUxheWVyKHRoaXMuX21hcmtlckdyb3VwKTsKCQlkZWxldGUgdGhpcy5fbWFya2VyR3JvdXA7CgkJZGVsZXRlIHRoaXMuX21hcmtlcnM7CgoJCXRoaXMuX21hcC5yZW1vdmVMYXllcih0aGlzLl9wb2x5KTsKCQlkZWxldGUgdGhpcy5fcG9seTsKCgkJdGhpcy5fbW91c2VNYXJrZXIub2ZmKCdjbGljaycsIHRoaXMuX29uQ2xpY2ssIHRoaXMpOwoJCXRoaXMuX21hcC5yZW1vdmVMYXllcih0aGlzLl9tb3VzZU1hcmtlcik7CgkJZGVsZXRlIHRoaXMuX21vdXNlTWFya2VyOwoKCQkvLyBjbGVhbiB1cCBET00KCQl0aGlzLl9jbGVhckd1aWRlcygpOwoKCQl0aGlzLl9tYXAKCQkJLm9mZignbW91c2Vtb3ZlJywgdGhpcy5fb25Nb3VzZU1vdmUsIHRoaXMpCgkJCS5vZmYoJ3pvb21lbmQnLCB0aGlzLl9vblpvb21FbmQsIHRoaXMpOwoJfSwKCglfZmluaXNoU2hhcGU6IGZ1bmN0aW9uICgpIHsKCQl2YXIgaW50ZXJzZWN0cyA9IHRoaXMuX3BvbHkubmV3TGF0TG5nSW50ZXJzZWN0cyh0aGlzLl9wb2x5LmdldExhdExuZ3MoKVswXSwgdHJ1ZSk7CgoJCWlmICgoIXRoaXMub3B0aW9ucy5hbGxvd0ludGVyc2VjdGlvbiAmJiBpbnRlcnNlY3RzKSB8fCAhdGhpcy5fc2hhcGVJc1ZhbGlkKCkpIHsKCQkJdGhpcy5fc2hvd0Vycm9yVG9vbHRpcCgpOwoJCQlyZXR1cm47CgkJfQoKCQl0aGlzLl9maXJlQ3JlYXRlZEV2ZW50KCk7CgkJdGhpcy5kaXNhYmxlKCk7CgkJaWYgKHRoaXMub3B0aW9ucy5yZXBlYXRNb2RlKSB7CgkJCXRoaXMuZW5hYmxlKCk7CgkJfQoJfSwKCgkvL0NhbGxlZCB0byB2ZXJpZnkgdGhlIHNoYXBlIGlzIHZhbGlkIHdoZW4gdGhlIHVzZXIgdHJpZXMgdG8gZmluaXNoIGl0CgkvL1JldHVybiBmYWxzZSBpZiB0aGUgc2hhcGUgaXMgbm90IHZhbGlkCglfc2hhcGVJc1ZhbGlkOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIHRydWU7Cgl9LAoKCV9vblpvb21FbmQ6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl91cGRhdGVHdWlkZSgpOwoJfSwKCglfb25Nb3VzZU1vdmU6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIG5ld1BvcyA9IGUubGF5ZXJQb2ludCwKCQkJbGF0bG5nID0gZS5sYXRsbmc7CgoJCS8vIFNhdmUgbGF0bG5nCgkJLy8gc2hvdWxkIHRoaXMgYmUgbW92ZWQgdG8gX3VwZGF0ZUd1aWRlKCkgPwoJCXRoaXMuX2N1cnJlbnRMYXRMbmcgPSBsYXRsbmc7CgoJCXRoaXMuX3VwZGF0ZVRvb2x0aXAobGF0bG5nKTsKCgkJLy8gVXBkYXRlIHRoZSBndWlkZSBsaW5lCgkJdGhpcy5fdXBkYXRlR3VpZGUobmV3UG9zKTsKCgkJLy8gVXBkYXRlIHRoZSBtb3VzZSBtYXJrZXIgcG9zaXRpb24KCQl0aGlzLl9tb3VzZU1hcmtlci5zZXRMYXRMbmcobGF0bG5nKTsKCgkJTC5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdChlLm9yaWdpbmFsRXZlbnQpOwoJfSwKCglfb25DbGljazogZnVuY3Rpb24gKGUpIHsKCQl2YXIgbGF0bG5nID0gZS50YXJnZXQuZ2V0TGF0TG5nKCksCgkJCW1hcmtlckNvdW50ID0gdGhpcy5fbWFya2Vycy5sZW5ndGg7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zbmFwUG9pbnQpIGxhdGxuZyA9IHRoaXMub3B0aW9ucy5zbmFwUG9pbnQobGF0bG5nKTsKCgkJaWYgKG1hcmtlckNvdW50ID4gMCAmJiAhdGhpcy5vcHRpb25zLmFsbG93SW50ZXJzZWN0aW9uICYmIHRoaXMuX3BvbHkubmV3TGF0TG5nSW50ZXJzZWN0cyhsYXRsbmcpKSB7CgkJCXRoaXMuX3Nob3dFcnJvclRvb2x0aXAoKTsKCQkJcmV0dXJuOwoJCX0KCQllbHNlIGlmICh0aGlzLl9lcnJvclNob3duKSB7CgkJCXRoaXMuX2hpZGVFcnJvclRvb2x0aXAoKTsKCQl9CgoJCXRoaXMuX21hcmtlcnMucHVzaCh0aGlzLl9jcmVhdGVNYXJrZXIobGF0bG5nKSk7CgoJCXRoaXMuX3BvbHkuYWRkTGF0TG5nKGxhdGxuZyk7CgoJCWlmICh0aGlzLl9wb2x5LmdldExhdExuZ3MoKS5sZW5ndGggPT09IDIpIHsKCQkJdGhpcy5fbWFwLmFkZExheWVyKHRoaXMuX3BvbHkpOwoJCX0KCgkJdGhpcy5fdXBkYXRlRmluaXNoSGFuZGxlcigpOwoKCQl0aGlzLl92ZXJ0ZXhBZGRlZChsYXRsbmcpOwoKCQl0aGlzLl9jbGVhckd1aWRlcygpOwoKCQl0aGlzLl91cGRhdGVUb29sdGlwKCk7Cgl9LAoKCV91cGRhdGVGaW5pc2hIYW5kbGVyOiBmdW5jdGlvbiAoKSB7CgkJdmFyIG1hcmtlckNvdW50ID0gdGhpcy5fbWFya2Vycy5sZW5ndGg7CgkJLy8gVGhlIGxhc3QgbWFya2VyIHNob3VsZCBoYXZlIGEgY2xpY2sgaGFuZGxlciB0byBjbG9zZSB0aGUgcG9seWxpbmUKCQlpZiAobWFya2VyQ291bnQgPiAxKSB7CgkJCXRoaXMuX21hcmtlcnNbbWFya2VyQ291bnQgLSAxXS5vbignY2xpY2snLCB0aGlzLl9maW5pc2hTaGFwZSwgdGhpcyk7CgkJfQoKCQkvLyBSZW1vdmUgdGhlIG9sZCBtYXJrZXIgY2xpY2sgaGFuZGxlciAoYXMgb25seSB0aGUgbGFzdCBwb2ludCBzaG91bGQgY2xvc2UgdGhlIHBvbHlsaW5lKQoJCWlmIChtYXJrZXJDb3VudCA+IDIpIHsKCQkJdGhpcy5fbWFya2Vyc1ttYXJrZXJDb3VudCAtIDJdLm9mZignY2xpY2snLCB0aGlzLl9maW5pc2hTaGFwZSwgdGhpcyk7CgkJfQoJfSwKCglfY3JlYXRlTWFya2VyOiBmdW5jdGlvbiAobGF0bG5nKSB7CgkJdmFyIG1hcmtlciA9IG5ldyBMLk1hcmtlcihsYXRsbmcsIHsKCQkJaWNvbjogdGhpcy5vcHRpb25zLmljb24sCgkJCXpJbmRleE9mZnNldDogdGhpcy5vcHRpb25zLnpJbmRleE9mZnNldCAqIDIKCQl9KTsKCgkJdGhpcy5fbWFya2VyR3JvdXAuYWRkTGF5ZXIobWFya2VyKTsKCgkJcmV0dXJuIG1hcmtlcjsKCX0sCgoJX3VwZGF0ZUd1aWRlOiBmdW5jdGlvbiAobmV3UG9zKSB7CgkJdmFyIG1hcmtlckNvdW50ID0gdGhpcy5fbWFya2Vycy5sZW5ndGg7CgoJCWlmIChtYXJrZXJDb3VudCA+IDApIHsKCQkJbmV3UG9zID0gbmV3UG9zIHx8IHRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQodGhpcy5fY3VycmVudExhdExuZyk7CgoJCQkvLyBkcmF3IHRoZSBndWlkZSBsaW5lCgkJCXRoaXMuX2NsZWFyR3VpZGVzKCk7CgkJCXRoaXMuX2RyYXdHdWlkZSgKCQkJCXRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQodGhpcy5fbWFya2Vyc1ttYXJrZXJDb3VudCAtIDFdLmdldExhdExuZygpKSwKCQkJCW5ld1BvcwoJCQkpOwoJCX0KCX0sCgoJX3VwZGF0ZVRvb2x0aXA6IGZ1bmN0aW9uIChsYXRMbmcpIHsKCQl2YXIgdGV4dCA9IHRoaXMuX2dldFRvb2x0aXBUZXh0KCk7CgoJCWlmIChsYXRMbmcpIHsKCQkJdGhpcy5fdG9vbHRpcC51cGRhdGVQb3NpdGlvbihsYXRMbmcpOwoJCX0KCgkJaWYgKCF0aGlzLl9lcnJvclNob3duKSB7CgkJCXRoaXMuX3Rvb2x0aXAudXBkYXRlQ29udGVudCh0ZXh0KTsKCQl9Cgl9LAoKCV9kcmF3R3VpZGU6IGZ1bmN0aW9uIChwb2ludEEsIHBvaW50QikgewovL1RPRE86IHJld3JpdGUgdGhpcyB0byB1c2UgYSByZWd1bGFyIGxlYWZsZXQgbGluZSB3aXRoIGEgZGFzaHBhdHRlcm4hCgoJCXZhciBsZW5ndGggPSBNYXRoLmZsb29yKE1hdGguc3FydChNYXRoLnBvdygocG9pbnRCLnggLSBwb2ludEEueCksIDIpICsgTWF0aC5wb3coKHBvaW50Qi55IC0gcG9pbnRBLnkpLCAyKSkpLAoJCQlpLAoJCQlmcmFjdGlvbiwKCQkJZGFzaFBvaW50LAoJCQlkYXNoOwoKCQkvL2NyZWF0ZSB0aGUgZ3VpZGVzIGNvbnRhaW5lciBpZiB3ZSBoYXZlbid0IHlldAoJCWlmICghdGhpcy5fZ3VpZGVzQ29udGFpbmVyKSB7CgkJCXRoaXMuX2d1aWRlc0NvbnRhaW5lciA9IEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsICdsZWFmbGV0LWRyYXctZ3VpZGVzJywgdGhpcy5fb3ZlcmxheVBhbmUpOwoJCX0KCgkJLy9kcmF3IGEgZGFzaCBldmVyeSBHdWlsZGVMaW5lRGlzdGFuY2UKCQlmb3IgKGkgPSB0aGlzLm9wdGlvbnMuZ3VpZGVsaW5lRGlzdGFuY2U7IGkgPCBsZW5ndGg7IGkgKz0gdGhpcy5vcHRpb25zLmd1aWRlbGluZURpc3RhbmNlKSB7CgkJCS8vd29yayBvdXQgZnJhY3Rpb24gYWxvbmcgbGluZSB3ZSBhcmUKCQkJZnJhY3Rpb24gPSBpIC8gbGVuZ3RoOwoKCQkJLy9jYWxjdWxhdGUgbmV3IHgseSBwb2ludAoJCQlkYXNoUG9pbnQgPSB7CgkJCQl4OiBNYXRoLmZsb29yKChwb2ludEEueCAqICgxIC0gZnJhY3Rpb24pKSArIChmcmFjdGlvbiAqIHBvaW50Qi54KSksCgkJCQl5OiBNYXRoLmZsb29yKChwb2ludEEueSAqICgxIC0gZnJhY3Rpb24pKSArIChmcmFjdGlvbiAqIHBvaW50Qi55KSkKCQkJfTsKCgkJCS8vYWRkIGd1aWRlIGRhc2ggdG8gZ3VpZGUgY29udGFpbmVyCgkJCWRhc2ggPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCAnbGVhZmxldC1kcmF3LWd1aWRlLWRhc2gnLCB0aGlzLl9ndWlkZXNDb250YWluZXIpOwoJCQlkYXNoLnN0eWxlLmJhY2tncm91bmRDb2xvciA9CgkJCQkhdGhpcy5fZXJyb3JTaG93biA/IHRoaXMub3B0aW9ucy5zaGFwZU9wdGlvbnMuY29sb3IgOiB0aGlzLm9wdGlvbnMuZHJhd0Vycm9yLmNvbG9yOwoKCQkJTC5Eb21VdGlsLnNldFBvc2l0aW9uKGRhc2gsIGRhc2hQb2ludCk7CgkJfQoJfSwKCglfdXBkYXRlR3VpZGVDb2xvcjogZnVuY3Rpb24gKGNvbG9yKSB7CgkJaWYgKHRoaXMuX2d1aWRlc0NvbnRhaW5lcikgewoJCQlmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMuX2d1aWRlc0NvbnRhaW5lci5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewoJCQkJdGhpcy5fZ3VpZGVzQ29udGFpbmVyLmNoaWxkTm9kZXNbaV0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7CgkJCX0KCQl9Cgl9LAoKCS8vIHJlbW92ZXMgYWxsIGNoaWxkIGVsZW1lbnRzIChndWlkZSBkYXNoZXMpIGZyb20gdGhlIGd1aWRlcyBjb250YWluZXIKCV9jbGVhckd1aWRlczogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9ndWlkZXNDb250YWluZXIpIHsKCQkJd2hpbGUgKHRoaXMuX2d1aWRlc0NvbnRhaW5lci5maXJzdENoaWxkKSB7CgkJCQl0aGlzLl9ndWlkZXNDb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy5fZ3VpZGVzQ29udGFpbmVyLmZpcnN0Q2hpbGQpOwoJCQl9CgkJfQoJfSwKCglfZ2V0VG9vbHRpcFRleHQ6IGZ1bmN0aW9uICgpIHsKCQl2YXIgbGFiZWxUZXh0LAoJCQlkaXN0YW5jZSwKCQkJZGlzdGFuY2VTdHI7CgoJCWlmICh0aGlzLl9tYXJrZXJzLmxlbmd0aCA9PT0gMCkgewoJCQlsYWJlbFRleHQgPSB7CgkJCQl0ZXh0OiBMLmRyYXdMb2NhbC5kcmF3LmhhbmRsZXJzLnBvbHlsaW5lLnRvb2x0aXAuc3RhcnQKCQkJfTsKCQl9IGVsc2UgewoJCQlkaXN0YW5jZVN0ciA9IHRoaXMuX2dldE1lYXN1cmVtZW50U3RyaW5nKCk7CgoJCQlpZiAodGhpcy5fbWFya2Vycy5sZW5ndGggPT09IDEpIHsKCQkJCWxhYmVsVGV4dCA9IHsKCQkJCQl0ZXh0OiBMLmRyYXdMb2NhbC5kcmF3LmhhbmRsZXJzLnBvbHlsaW5lLnRvb2x0aXAuY29udCwKCQkJCQlzdWJ0ZXh0OiBkaXN0YW5jZVN0cgoJCQkJfTsKCQkJfSBlbHNlIHsKCQkJCWxhYmVsVGV4dCA9IHsKCQkJCQl0ZXh0OiBMLmRyYXdMb2NhbC5kcmF3LmhhbmRsZXJzLnBvbHlsaW5lLnRvb2x0aXAuZW5kLAoJCQkJCXN1YnRleHQ6IGRpc3RhbmNlU3RyCgkJCQl9OwoJCQl9CgkJfQoJCXJldHVybiBsYWJlbFRleHQ7Cgl9LAoKCV9nZXRNZWFzdXJlbWVudFN0cmluZzogZnVuY3Rpb24gKCkgewoJCXZhciBjdXJyZW50TGF0TG5nID0gdGhpcy5fY3VycmVudExhdExuZywKCQkJcHJldmlvdXNMYXRMbmcgPSB0aGlzLl9tYXJrZXJzW3RoaXMuX21hcmtlcnMubGVuZ3RoIC0gMV0uZ2V0TGF0TG5nKCksCgkJCWRpc3RhbmNlOwoKCQkvLyBjYWxjdWxhdGUgdGhlIGRpc3RhbmNlIGZyb20gdGhlIGxhc3QgZml4ZWQgcG9pbnQgdG8gdGhlIG1vdXNlIHBvc2l0aW9uCgkJZGlzdGFuY2UgPSB0aGlzLl9tZWFzdXJlbWVudFJ1bm5pbmdUb3RhbCArIGN1cnJlbnRMYXRMbmcuZGlzdGFuY2VUbyhwcmV2aW91c0xhdExuZyk7CgoJCXJldHVybiBMLkdlb21ldHJ5VXRpbC5yZWFkYWJsZURpc3RhbmNlKGRpc3RhbmNlLCB0aGlzLm9wdGlvbnMubWV0cmljKTsKCX0sCgoJX3Nob3dFcnJvclRvb2x0aXA6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9lcnJvclNob3duID0gdHJ1ZTsKCgkJLy8gVXBkYXRlIHRvb2x0aXAKCQl0aGlzLl90b29sdGlwCgkJCS5zaG93QXNFcnJvcigpCgkJCS51cGRhdGVDb250ZW50KHsgdGV4dDogdGhpcy5vcHRpb25zLmRyYXdFcnJvci5tZXNzYWdlIH0pOwoKCQkvLyBVcGRhdGUgc2hhcGUKCQl0aGlzLl91cGRhdGVHdWlkZUNvbG9yKHRoaXMub3B0aW9ucy5kcmF3RXJyb3IuY29sb3IpOwoJCXRoaXMuX3BvbHkuc2V0U3R5bGUoeyBjb2xvcjogdGhpcy5vcHRpb25zLmRyYXdFcnJvci5jb2xvciB9KTsKCgkJLy8gSGlkZSB0aGUgZXJyb3IgYWZ0ZXIgMiBzZWNvbmRzCgkJdGhpcy5fY2xlYXJIaWRlRXJyb3JUaW1lb3V0KCk7CgkJdGhpcy5faGlkZUVycm9yVGltZW91dCA9IHNldFRpbWVvdXQoTC5VdGlsLmJpbmQodGhpcy5faGlkZUVycm9yVG9vbHRpcCwgdGhpcyksIHRoaXMub3B0aW9ucy5kcmF3RXJyb3IudGltZW91dCk7Cgl9LAoKCV9oaWRlRXJyb3JUb29sdGlwOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fZXJyb3JTaG93biA9IGZhbHNlOwoKCQl0aGlzLl9jbGVhckhpZGVFcnJvclRpbWVvdXQoKTsKCgkJLy8gUmV2ZXJ0IHRvb2x0aXAKCQl0aGlzLl90b29sdGlwCgkJCS5yZW1vdmVFcnJvcigpCgkJCS51cGRhdGVDb250ZW50KHRoaXMuX2dldFRvb2x0aXBUZXh0KCkpOwoKCQkvLyBSZXZlcnQgc2hhcGUKCQl0aGlzLl91cGRhdGVHdWlkZUNvbG9yKHRoaXMub3B0aW9ucy5zaGFwZU9wdGlvbnMuY29sb3IpOwoJCXRoaXMuX3BvbHkuc2V0U3R5bGUoeyBjb2xvcjogdGhpcy5vcHRpb25zLnNoYXBlT3B0aW9ucy5jb2xvciB9KTsKCX0sCgoJX2NsZWFySGlkZUVycm9yVGltZW91dDogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9oaWRlRXJyb3JUaW1lb3V0KSB7CgkJCWNsZWFyVGltZW91dCh0aGlzLl9oaWRlRXJyb3JUaW1lb3V0KTsKCQkJdGhpcy5faGlkZUVycm9yVGltZW91dCA9IG51bGw7CgkJfQoJfSwKCglfdmVydGV4QWRkZWQ6IGZ1bmN0aW9uIChsYXRsbmcpIHsKCQlpZiAodGhpcy5fbWFya2Vycy5sZW5ndGggPT09IDEpIHsKCQkJdGhpcy5fbWVhc3VyZW1lbnRSdW5uaW5nVG90YWwgPSAwOwoJCX0KCQllbHNlIHsKCQkJdGhpcy5fbWVhc3VyZW1lbnRSdW5uaW5nVG90YWwgKz0KCQkJCWxhdGxuZy5kaXN0YW5jZVRvKHRoaXMuX21hcmtlcnNbdGhpcy5fbWFya2Vycy5sZW5ndGggLSAyXS5nZXRMYXRMbmcoKSk7CgkJfQoJfSwKCglfY2xlYW5VcFNoYXBlOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX21hcmtlcnMubGVuZ3RoID4gMSkgewoJCQl0aGlzLl9tYXJrZXJzW3RoaXMuX21hcmtlcnMubGVuZ3RoIC0gMV0ub2ZmKCdjbGljaycsIHRoaXMuX2ZpbmlzaFNoYXBlLCB0aGlzKTsKCQl9Cgl9LAoKCV9maXJlQ3JlYXRlZEV2ZW50OiBmdW5jdGlvbiAoKSB7CgkJdmFyIHBvbHkgPSBuZXcgdGhpcy5Qb2x5KHRoaXMuX3BvbHkuZ2V0TGF0TG5ncygpLCB0aGlzLm9wdGlvbnMuc2hhcGVPcHRpb25zKTsKCQlMLkRyYXcuRmVhdHVyZS5wcm90b3R5cGUuX2ZpcmVDcmVhdGVkRXZlbnQuY2FsbCh0aGlzLCBwb2x5KTsKCX0KfSk7CgoKTC5EcmF3LlBvbHlnb24gPSBMLkRyYXcuUG9seWxpbmUuZXh0ZW5kKHsKCXN0YXRpY3M6IHsKCQlUWVBFOiAncG9seWdvbicKCX0sCgoJUG9seTogTC5HZW9kZXNpY1BvbHlnb24sCgoJb3B0aW9uczogewoJCXNob3dBcmVhOiBmYWxzZSwKCQlzaGFwZU9wdGlvbnM6IHsKCQkJc3Ryb2tlOiB0cnVlLAoJCQljb2xvcjogJyNmMDZlYWEnLAoJCQl3ZWlnaHQ6IDQsCgkJCW9wYWNpdHk6IDAuNSwKCQkJZmlsbDogdHJ1ZSwKCQkJZmlsbENvbG9yOiBudWxsLCAvL3NhbWUgYXMgY29sb3IgYnkgZGVmYXVsdAoJCQlmaWxsT3BhY2l0eTogMC4yLAoJCQljbGlja2FibGU6IHRydWUKCQl9Cgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChtYXAsIG9wdGlvbnMpIHsKCQlMLkRyYXcuUG9seWxpbmUucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBtYXAsIG9wdGlvbnMpOwoKCQkvLyBTYXZlIHRoZSB0eXBlIHNvIHN1cGVyIGNhbiBmaXJlLCBuZWVkIHRvIGRvIHRoaXMgYXMgY2Fubm90IGRvIHRoaXMuVFlQRSA6KAoJCXRoaXMudHlwZSA9IEwuRHJhdy5Qb2x5Z29uLlRZUEU7Cgl9LAoKCV91cGRhdGVGaW5pc2hIYW5kbGVyOiBmdW5jdGlvbiAoKSB7CgkJdmFyIG1hcmtlckNvdW50ID0gdGhpcy5fbWFya2Vycy5sZW5ndGg7CgoJCS8vIFRoZSBmaXJzdCBtYXJrZXIgc2hvbGQgaGF2ZSBhIGNsaWNrIGhhbmRsZXIgdG8gY2xvc2UgdGhlIHBvbHlnb24KCQlpZiAobWFya2VyQ291bnQgPT09IDEpIHsKCQkJdGhpcy5fbWFya2Vyc1swXS5vbignY2xpY2snLCB0aGlzLl9maW5pc2hTaGFwZSwgdGhpcyk7CgkJfQoKCQkvLyBBZGQgYW5kIHVwZGF0ZSB0aGUgZG91YmxlIGNsaWNrIGhhbmRsZXIKCQlpZiAobWFya2VyQ291bnQgPiAyKSB7CgkJCXRoaXMuX21hcmtlcnNbbWFya2VyQ291bnQgLSAxXS5vbignZGJsY2xpY2snLCB0aGlzLl9maW5pc2hTaGFwZSwgdGhpcyk7CgkJCS8vIE9ubHkgbmVlZCB0byByZW1vdmUgaGFuZGxlciBpZiBoYXMgYmVlbiBhZGRlZCBiZWZvcmUKCQkJaWYgKG1hcmtlckNvdW50ID4gMykgewoJCQkJdGhpcy5fbWFya2Vyc1ttYXJrZXJDb3VudCAtIDJdLm9mZignZGJsY2xpY2snLCB0aGlzLl9maW5pc2hTaGFwZSwgdGhpcyk7CgkJCX0KCQl9Cgl9LAoKCV9nZXRUb29sdGlwVGV4dDogZnVuY3Rpb24gKCkgewoJCXZhciB0ZXh0LCBzdWJ0ZXh0OwoKCQlpZiAodGhpcy5fbWFya2Vycy5sZW5ndGggPT09IDApIHsKCQkJdGV4dCA9IEwuZHJhd0xvY2FsLmRyYXcuaGFuZGxlcnMucG9seWdvbi50b29sdGlwLnN0YXJ0OwoJCX0gZWxzZSBpZiAodGhpcy5fbWFya2Vycy5sZW5ndGggPCAzKSB7CgkJCXRleHQgPSBMLmRyYXdMb2NhbC5kcmF3LmhhbmRsZXJzLnBvbHlnb24udG9vbHRpcC5jb250OwoJCX0gZWxzZSB7CgkJCXRleHQgPSBMLmRyYXdMb2NhbC5kcmF3LmhhbmRsZXJzLnBvbHlnb24udG9vbHRpcC5lbmQ7CgkJCXN1YnRleHQgPSB0aGlzLl9nZXRNZWFzdXJlbWVudFN0cmluZygpOwoJCX0KCgkJcmV0dXJuIHsKCQkJdGV4dDogdGV4dCwKCQkJc3VidGV4dDogc3VidGV4dAoJCX07Cgl9LAoKCV9nZXRNZWFzdXJlbWVudFN0cmluZzogZnVuY3Rpb24gKCkgewoJCXZhciBhcmVhID0gdGhpcy5fYXJlYTsKCgkJaWYgKCFhcmVhKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCgkJcmV0dXJuIEwuR2VvbWV0cnlVdGlsLnJlYWRhYmxlQXJlYShhcmVhLCB0aGlzLm9wdGlvbnMubWV0cmljKTsKCX0sCgoJX3NoYXBlSXNWYWxpZDogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9tYXJrZXJzLmxlbmd0aCA+PSAzOwoJfSwKCglfdmVydGV4QWRkZWQ6IGZ1bmN0aW9uICgpIHsKCQkvLyBDaGVjayB0byBzZWUgaWYgd2Ugc2hvdWxkIHNob3cgdGhlIGFyZWEKCQlpZiAodGhpcy5vcHRpb25zLmFsbG93SW50ZXJzZWN0aW9uIHx8ICF0aGlzLm9wdGlvbnMuc2hvd0FyZWEpIHsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIGxhdExuZ3MgPSB0aGlzLl9wb2x5LmdldExhdExuZ3MoKTsKCgkJdGhpcy5fYXJlYSA9IEwuR2VvbWV0cnlVdGlsLmdlb2Rlc2ljQXJlYShsYXRMbmdzKTsKCX0sCgoJX2NsZWFuVXBTaGFwZTogZnVuY3Rpb24gKCkgewoJCXZhciBtYXJrZXJDb3VudCA9IHRoaXMuX21hcmtlcnMubGVuZ3RoOwoKCQlpZiAobWFya2VyQ291bnQgPiAwKSB7CgkJCXRoaXMuX21hcmtlcnNbMF0ub2ZmKCdjbGljaycsIHRoaXMuX2ZpbmlzaFNoYXBlLCB0aGlzKTsKCgkJCWlmIChtYXJrZXJDb3VudCA+IDIpIHsKCQkJCXRoaXMuX21hcmtlcnNbbWFya2VyQ291bnQgLSAxXS5vZmYoJ2RibGNsaWNrJywgdGhpcy5fZmluaXNoU2hhcGUsIHRoaXMpOwoJCQl9CgkJfQoJfQp9KTsKCgpMLlNpbXBsZVNoYXBlID0ge307CgpMLkRyYXcuU2ltcGxlU2hhcGUgPSBMLkRyYXcuRmVhdHVyZS5leHRlbmQoewoJb3B0aW9uczogewoJCXJlcGVhdE1vZGU6IGZhbHNlCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChtYXAsIG9wdGlvbnMpIHsKCQl0aGlzLl9lbmRMYWJlbFRleHQgPSBMLmRyYXdMb2NhbC5kcmF3LmhhbmRsZXJzLnNpbXBsZXNoYXBlLnRvb2x0aXAuZW5kOwoKCQlMLkRyYXcuRmVhdHVyZS5wcm90b3R5cGUuaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG1hcCwgb3B0aW9ucyk7Cgl9LAoKCWFkZEhvb2tzOiBmdW5jdGlvbiAoKSB7CgkJTC5EcmF3LkZlYXR1cmUucHJvdG90eXBlLmFkZEhvb2tzLmNhbGwodGhpcyk7CgkJaWYgKHRoaXMuX21hcCkgewoJCQl0aGlzLl9tYXAuZHJhZ2dpbmcuZGlzYWJsZSgpOwoJCQkvL1RPRE8gcmVmYWN0b3I6IG1vdmUgY3Vyc29yIHRvIHN0eWxlcwoJCQl0aGlzLl9jb250YWluZXIuc3R5bGUuY3Vyc29yID0gJ2Nyb3NzaGFpcic7CgoJCQl0aGlzLl90b29sdGlwLnVwZGF0ZUNvbnRlbnQoeyB0ZXh0OiB0aGlzLl9pbml0aWFsTGFiZWxUZXh0IH0pOwoKCQkJdGhpcy5fbWFwCgkJCQkub24oJ21vdXNlZG93bicsIHRoaXMuX29uTW91c2VEb3duLCB0aGlzKQoJCQkJLm9uKCdtb3VzZW1vdmUnLCB0aGlzLl9vbk1vdXNlTW92ZSwgdGhpcyk7CgkJfQoJfSwKCglyZW1vdmVIb29rczogZnVuY3Rpb24gKCkgewoJCUwuRHJhdy5GZWF0dXJlLnByb3RvdHlwZS5yZW1vdmVIb29rcy5jYWxsKHRoaXMpOwoJCWlmICh0aGlzLl9tYXApIHsKCQkJdGhpcy5fbWFwLmRyYWdnaW5nLmVuYWJsZSgpOwoJCQkvL1RPRE8gcmVmYWN0b3I6IG1vdmUgY3Vyc29yIHRvIHN0eWxlcwoJCQl0aGlzLl9jb250YWluZXIuc3R5bGUuY3Vyc29yID0gJyc7CgoJCQl0aGlzLl9tYXAKCQkJCS5vZmYoJ21vdXNlZG93bicsIHRoaXMuX29uTW91c2VEb3duLCB0aGlzKQoJCQkJLm9mZignbW91c2Vtb3ZlJywgdGhpcy5fb25Nb3VzZU1vdmUsIHRoaXMpOwoKCQkJTC5Eb21FdmVudC5vZmYoZG9jdW1lbnQsICdtb3VzZXVwJywgdGhpcy5fb25Nb3VzZVVwKTsKCgkJCS8vIElmIHRoZSBib3ggZWxlbWVudCBkb2Vzbid0IGV4aXN0IHRoZXkgbXVzdCBub3QgaGF2ZSBtb3ZlZCB0aGUgbW91c2UsIHNvIGRvbid0IG5lZWQgdG8gZGVzdHJveS9yZXR1cm4KCQkJaWYgKHRoaXMuX3NoYXBlKSB7CgkJCQl0aGlzLl9tYXAucmVtb3ZlTGF5ZXIodGhpcy5fc2hhcGUpOwoJCQkJZGVsZXRlIHRoaXMuX3NoYXBlOwoJCQl9CgkJfQoJCXRoaXMuX2lzRHJhd2luZyA9IGZhbHNlOwoJfSwKCglfb25Nb3VzZURvd246IGZ1bmN0aW9uIChlKSB7CgkJdGhpcy5faXNEcmF3aW5nID0gdHJ1ZTsKCQl0aGlzLl9zdGFydExhdExuZyA9IGUubGF0bG5nOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc25hcFBvaW50KSB0aGlzLl9zdGFydExhdExuZyA9IHRoaXMub3B0aW9ucy5zbmFwUG9pbnQodGhpcy5fc3RhcnRMYXRMbmcpOwoKCQlMLkRvbUV2ZW50CgkJCS5vbihkb2N1bWVudCwgJ21vdXNldXAnLCB0aGlzLl9vbk1vdXNlVXAsIHRoaXMpCgkJCS5wcmV2ZW50RGVmYXVsdChlLm9yaWdpbmFsRXZlbnQpOwoJfSwKCglfb25Nb3VzZU1vdmU6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIGxhdGxuZyA9IGUubGF0bG5nOwoKCQl0aGlzLl90b29sdGlwLnVwZGF0ZVBvc2l0aW9uKGxhdGxuZyk7CgkJaWYgKHRoaXMuX2lzRHJhd2luZykgewoJCQl0aGlzLl90b29sdGlwLnVwZGF0ZUNvbnRlbnQoeyB0ZXh0OiB0aGlzLl9lbmRMYWJlbFRleHQgfSk7CgkJCXRoaXMuX2RyYXdTaGFwZShsYXRsbmcpOwoJCX0KCX0sCgoJX29uTW91c2VVcDogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9zaGFwZSkgewoJCQl0aGlzLl9maXJlQ3JlYXRlZEV2ZW50KCk7CgkJfQoKCQl0aGlzLmRpc2FibGUoKTsKCQlpZiAodGhpcy5vcHRpb25zLnJlcGVhdE1vZGUpIHsKCQkJdGhpcy5lbmFibGUoKTsKCQl9Cgl9Cn0pOwoKTC5EcmF3LlJlY3RhbmdsZSA9IEwuRHJhdy5TaW1wbGVTaGFwZS5leHRlbmQoewoJc3RhdGljczogewoJCVRZUEU6ICdyZWN0YW5nbGUnCgl9LAoKCW9wdGlvbnM6IHsKCQlzaGFwZU9wdGlvbnM6IHsKCQkJc3Ryb2tlOiB0cnVlLAoJCQljb2xvcjogJyNmMDZlYWEnLAoJCQl3ZWlnaHQ6IDQsCgkJCW9wYWNpdHk6IDAuNSwKCQkJZmlsbDogdHJ1ZSwKCQkJZmlsbENvbG9yOiBudWxsLCAvL3NhbWUgYXMgY29sb3IgYnkgZGVmYXVsdAoJCQlmaWxsT3BhY2l0eTogMC4yLAoJCQljbGlja2FibGU6IHRydWUKCQl9Cgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChtYXAsIG9wdGlvbnMpIHsKCQkvLyBTYXZlIHRoZSB0eXBlIHNvIHN1cGVyIGNhbiBmaXJlLCBuZWVkIHRvIGRvIHRoaXMgYXMgY2Fubm90IGRvIHRoaXMuVFlQRSA6KAoJCXRoaXMudHlwZSA9IEwuRHJhdy5SZWN0YW5nbGUuVFlQRTsKCgkJdGhpcy5faW5pdGlhbExhYmVsVGV4dCA9IEwuZHJhd0xvY2FsLmRyYXcuaGFuZGxlcnMucmVjdGFuZ2xlLnRvb2x0aXAuc3RhcnQ7CgoJCUwuRHJhdy5TaW1wbGVTaGFwZS5wcm90b3R5cGUuaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG1hcCwgb3B0aW9ucyk7Cgl9LAoKCV9kcmF3U2hhcGU6IGZ1bmN0aW9uIChsYXRsbmcpIHsKCQlpZiAoIXRoaXMuX3NoYXBlKSB7CgkJCXRoaXMuX3NoYXBlID0gbmV3IEwuUmVjdGFuZ2xlKG5ldyBMLkxhdExuZ0JvdW5kcyh0aGlzLl9zdGFydExhdExuZywgbGF0bG5nKSwgdGhpcy5vcHRpb25zLnNoYXBlT3B0aW9ucyk7CgkJCXRoaXMuX21hcC5hZGRMYXllcih0aGlzLl9zaGFwZSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5fc2hhcGUuc2V0Qm91bmRzKG5ldyBMLkxhdExuZ0JvdW5kcyh0aGlzLl9zdGFydExhdExuZywgbGF0bG5nKSk7CgkJfQoJfSwKCglfZmlyZUNyZWF0ZWRFdmVudDogZnVuY3Rpb24gKCkgewoJCXZhciByZWN0YW5nbGUgPSBuZXcgTC5SZWN0YW5nbGUodGhpcy5fc2hhcGUuZ2V0Qm91bmRzKCksIHRoaXMub3B0aW9ucy5zaGFwZU9wdGlvbnMpOwoJCUwuRHJhdy5TaW1wbGVTaGFwZS5wcm90b3R5cGUuX2ZpcmVDcmVhdGVkRXZlbnQuY2FsbCh0aGlzLCByZWN0YW5nbGUpOwoJfQp9KTsKCgpMLkRyYXcuQ2lyY2xlID0gTC5EcmF3LlNpbXBsZVNoYXBlLmV4dGVuZCh7CglzdGF0aWNzOiB7CgkJVFlQRTogJ2NpcmNsZScKCX0sCgoJb3B0aW9uczogewoJCXNoYXBlT3B0aW9uczogewoJCQlzdHJva2U6IHRydWUsCgkJCWNvbG9yOiAnI2YwNmVhYScsCgkJCXdlaWdodDogNCwKCQkJb3BhY2l0eTogMC41LAoJCQlmaWxsOiB0cnVlLAoJCQlmaWxsQ29sb3I6IG51bGwsIC8vc2FtZSBhcyBjb2xvciBieSBkZWZhdWx0CgkJCWZpbGxPcGFjaXR5OiAwLjIsCgkJCWNsaWNrYWJsZTogdHJ1ZQoJCX0sCgkJbWV0cmljOiB0cnVlIC8vIFdoZXRoZXIgdG8gdXNlIHRoZSBtZXRyaWMgbWVhc3VyZW1lbnQgc3lzdGVtIG9yIGltcGVyaWFsCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChtYXAsIG9wdGlvbnMpIHsKCQkvLyBTYXZlIHRoZSB0eXBlIHNvIHN1cGVyIGNhbiBmaXJlLCBuZWVkIHRvIGRvIHRoaXMgYXMgY2Fubm90IGRvIHRoaXMuVFlQRSA6KAoJCXRoaXMudHlwZSA9IEwuRHJhdy5DaXJjbGUuVFlQRTsKCgkJdGhpcy5faW5pdGlhbExhYmVsVGV4dCA9IEwuZHJhd0xvY2FsLmRyYXcuaGFuZGxlcnMuY2lyY2xlLnRvb2x0aXAuc3RhcnQ7CgoJCUwuRHJhdy5TaW1wbGVTaGFwZS5wcm90b3R5cGUuaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG1hcCwgb3B0aW9ucyk7Cgl9LAoKCV9kcmF3U2hhcGU6IGZ1bmN0aW9uIChsYXRsbmcpIHsKCQlpZiAoIXRoaXMuX3NoYXBlKSB7CgkJCXRoaXMuX3NoYXBlID0gbmV3IEwuR2VvZGVzaWNDaXJjbGUodGhpcy5fc3RhcnRMYXRMbmcsIHRoaXMuX3N0YXJ0TGF0TG5nLmRpc3RhbmNlVG8obGF0bG5nKSwgdGhpcy5vcHRpb25zLnNoYXBlT3B0aW9ucyk7CgkJCXRoaXMuX21hcC5hZGRMYXllcih0aGlzLl9zaGFwZSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5fc2hhcGUuc2V0UmFkaXVzKHRoaXMuX3N0YXJ0TGF0TG5nLmRpc3RhbmNlVG8obGF0bG5nKSk7CgkJfQoJfSwKCglfZmlyZUNyZWF0ZWRFdmVudDogZnVuY3Rpb24gKCkgewoJCXZhciBjaXJjbGUgPSBuZXcgTC5HZW9kZXNpY0NpcmNsZSh0aGlzLl9zdGFydExhdExuZywgdGhpcy5fc2hhcGUuZ2V0UmFkaXVzKCksIHRoaXMub3B0aW9ucy5zaGFwZU9wdGlvbnMpOwoJCUwuRHJhdy5TaW1wbGVTaGFwZS5wcm90b3R5cGUuX2ZpcmVDcmVhdGVkRXZlbnQuY2FsbCh0aGlzLCBjaXJjbGUpOwoJfSwKCglfb25Nb3VzZU1vdmU6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIGxhdGxuZyA9IGUubGF0bG5nLAoJCQltZXRyaWMgPSB0aGlzLm9wdGlvbnMubWV0cmljLAoJCQlyYWRpdXM7CgoJCXRoaXMuX3Rvb2x0aXAudXBkYXRlUG9zaXRpb24obGF0bG5nKTsKCQlpZiAodGhpcy5faXNEcmF3aW5nKSB7CgkJCXRoaXMuX2RyYXdTaGFwZShsYXRsbmcpOwoKCQkJLy8gR2V0IHRoZSBuZXcgcmFkaXVzIChyb3VkZWQgdG8gMSBkcCkKCQkJcmFkaXVzID0gdGhpcy5fc2hhcGUuZ2V0UmFkaXVzKCkudG9GaXhlZCgxKTsKCgkJCXRoaXMuX3Rvb2x0aXAudXBkYXRlQ29udGVudCh7CgkJCQl0ZXh0OiB0aGlzLl9lbmRMYWJlbFRleHQsCgkJCQlzdWJ0ZXh0OiAnUmFkaXVzOiAnICsgTC5HZW9tZXRyeVV0aWwucmVhZGFibGVEaXN0YW5jZShyYWRpdXMsIHRoaXMub3B0aW9ucy5tZXRyaWMpCgkJCX0pOwoJCX0KCX0KfSk7CgpMLkRyYXcuTWFya2VyID0gTC5EcmF3LkZlYXR1cmUuZXh0ZW5kKHsKCXN0YXRpY3M6IHsKCQlUWVBFOiAnbWFya2VyJwoJfSwKCglvcHRpb25zOiB7CgkJaWNvbjogbmV3IEwuSWNvbi5EZWZhdWx0KCksCgkJcmVwZWF0TW9kZTogZmFsc2UsCgkJekluZGV4T2Zmc2V0OiAyMDAwIC8vIFRoaXMgc2hvdWxkIGJlID4gdGhhbiB0aGUgaGlnaGVzdCB6LWluZGV4IGFueSBtYXJrZXJzCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChtYXAsIG9wdGlvbnMpIHsKCQkvLyBTYXZlIHRoZSB0eXBlIHNvIHN1cGVyIGNhbiBmaXJlLCBuZWVkIHRvIGRvIHRoaXMgYXMgY2Fubm90IGRvIHRoaXMuVFlQRSA6KAoJCXRoaXMudHlwZSA9IEwuRHJhdy5NYXJrZXIuVFlQRTsKCgkJTC5EcmF3LkZlYXR1cmUucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBtYXAsIG9wdGlvbnMpOwoJfSwKCglhZGRIb29rczogZnVuY3Rpb24gKCkgewoJCUwuRHJhdy5GZWF0dXJlLnByb3RvdHlwZS5hZGRIb29rcy5jYWxsKHRoaXMpOwoKCQlpZiAodGhpcy5fbWFwKSB7CgkJCXRoaXMuX3Rvb2x0aXAudXBkYXRlQ29udGVudCh7IHRleHQ6IEwuZHJhd0xvY2FsLmRyYXcuaGFuZGxlcnMubWFya2VyLnRvb2x0aXAuc3RhcnQgfSk7CgoJCQkvLyBTYW1lIG1vdXNlTWFya2VyIGFzIGluIERyYXcuUG9seWxpbmUKCQkJaWYgKCF0aGlzLl9tb3VzZU1hcmtlcikgewoJCQkJdGhpcy5fbW91c2VNYXJrZXIgPSBMLm1hcmtlcih0aGlzLl9tYXAuZ2V0Q2VudGVyKCksIHsKCQkJCQlpY29uOiBMLmRpdkljb24oewoJCQkJCQljbGFzc05hbWU6ICdsZWFmbGV0LW1vdXNlLW1hcmtlcicsCgkJCQkJCWljb25BbmNob3I6IFsyMCwgMjBdLAoJCQkJCQlpY29uU2l6ZTogWzQwLCA0MF0KCQkJCQl9KSwKCQkJCQlvcGFjaXR5OiAwLAoJCQkJCXpJbmRleE9mZnNldDogdGhpcy5vcHRpb25zLnpJbmRleE9mZnNldAoJCQkJfSk7CgkJCX0KCgkJCXRoaXMuX21vdXNlTWFya2VyCgkJCQkub24oJ2NsaWNrJywgdGhpcy5fb25DbGljaywgdGhpcykKCQkJCS5hZGRUbyh0aGlzLl9tYXApOwoKCQkJdGhpcy5fbWFwLm9uKCdtb3VzZW1vdmUnLCB0aGlzLl9vbk1vdXNlTW92ZSwgdGhpcyk7CgkJfQoJfSwKCglyZW1vdmVIb29rczogZnVuY3Rpb24gKCkgewoJCUwuRHJhdy5GZWF0dXJlLnByb3RvdHlwZS5yZW1vdmVIb29rcy5jYWxsKHRoaXMpOwoKCQlpZiAodGhpcy5fbWFwKSB7CgkJCWlmICh0aGlzLl9tYXJrZXIpIHsKCQkJCXRoaXMuX21hcmtlci5vZmYoJ2NsaWNrJywgdGhpcy5fb25DbGljaywgdGhpcyk7CgkJCQl0aGlzLl9tYXAKCQkJCQkub2ZmKCdjbGljaycsIHRoaXMuX29uQ2xpY2ssIHRoaXMpCgkJCQkJLnJlbW92ZUxheWVyKHRoaXMuX21hcmtlcik7CgkJCQlkZWxldGUgdGhpcy5fbWFya2VyOwoJCQl9CgoJCQl0aGlzLl9tb3VzZU1hcmtlci5vZmYoJ2NsaWNrJywgdGhpcy5fb25DbGljaywgdGhpcyk7CgkJCXRoaXMuX21hcC5yZW1vdmVMYXllcih0aGlzLl9tb3VzZU1hcmtlcik7CgkJCWRlbGV0ZSB0aGlzLl9tb3VzZU1hcmtlcjsKCgkJCXRoaXMuX21hcC5vZmYoJ21vdXNlbW92ZScsIHRoaXMuX29uTW91c2VNb3ZlLCB0aGlzKTsKCQl9Cgl9LAoKCV9vbk1vdXNlTW92ZTogZnVuY3Rpb24gKGUpIHsKCQl2YXIgbGF0bG5nID0gZS5sYXRsbmc7CgoJCXRoaXMuX3Rvb2x0aXAudXBkYXRlUG9zaXRpb24obGF0bG5nKTsKCQl0aGlzLl9tb3VzZU1hcmtlci5zZXRMYXRMbmcobGF0bG5nKTsKCgkJaWYgKCF0aGlzLl9tYXJrZXIpIHsKCQkJdGhpcy5fbWFya2VyID0gbmV3IEwuTWFya2VyKGxhdGxuZywgewoJCQkJaWNvbjogdGhpcy5vcHRpb25zLmljb24sCgkJCQl6SW5kZXhPZmZzZXQ6IHRoaXMub3B0aW9ucy56SW5kZXhPZmZzZXQKCQkJfSk7CgkJCS8vIEJpbmQgdG8gYm90aCBtYXJrZXIgYW5kIG1hcCB0byBtYWtlIHN1cmUgd2UgZ2V0IHRoZSBjbGljayBldmVudC4KCQkJdGhpcy5fbWFya2VyLm9uKCdjbGljaycsIHRoaXMuX29uQ2xpY2ssIHRoaXMpOwoJCQl0aGlzLl9tYXAKCQkJCS5vbignY2xpY2snLCB0aGlzLl9vbkNsaWNrLCB0aGlzKQoJCQkJLmFkZExheWVyKHRoaXMuX21hcmtlcik7CgkJfQoJCWVsc2UgewoJCQl0aGlzLl9tYXJrZXIuc2V0TGF0TG5nKGxhdGxuZyk7CgkJfQoJfSwKCglfb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zbmFwUG9pbnQpIHRoaXMuX21hcmtlci5zZXRMYXRMbmcodGhpcy5vcHRpb25zLnNuYXBQb2ludCh0aGlzLl9tYXJrZXIuZ2V0TGF0TG5nKCkpKTsKCgkJdGhpcy5fZmlyZUNyZWF0ZWRFdmVudCgpOwoKCQl0aGlzLmRpc2FibGUoKTsKCQlpZiAodGhpcy5vcHRpb25zLnJlcGVhdE1vZGUpIHsKCQkJdGhpcy5lbmFibGUoKTsKCQl9Cgl9LAoKCV9maXJlQ3JlYXRlZEV2ZW50OiBmdW5jdGlvbiAoKSB7CgkJdmFyIG1hcmtlciA9IG5ldyBMLk1hcmtlcih0aGlzLl9tYXJrZXIuZ2V0TGF0TG5nKCksIHsgaWNvbjogdGhpcy5vcHRpb25zLmljb24gfSk7CgkJTC5EcmF3LkZlYXR1cmUucHJvdG90eXBlLl9maXJlQ3JlYXRlZEV2ZW50LmNhbGwodGhpcywgbWFya2VyKTsKCX0KfSk7CgpMLkVkaXQgPSBMLkVkaXQgfHwge307CgovKgogKiBMLkVkaXQuUG9seSBpcyBhbiBlZGl0aW5nIGhhbmRsZXIgZm9yIHBvbHlsaW5lcyBhbmQgcG9seWdvbnMuCiAqLwoKTC5FZGl0LlBvbHkgPSBMLkhhbmRsZXIuZXh0ZW5kKHsKCW9wdGlvbnM6IHsKCQlpY29uOiBuZXcgTC5EaXZJY29uKHsKCQkJaWNvblNpemU6IG5ldyBMLlBvaW50KDgsIDgpLAoJCQljbGFzc05hbWU6ICdsZWFmbGV0LWRpdi1pY29uIGxlYWZsZXQtZWRpdGluZy1pY29uJwoJCX0pCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChwb2x5LCBvcHRpb25zKSB7CgkJdGhpcy5fcG9seSA9IHBvbHk7CgkJTC5zZXRPcHRpb25zKHRoaXMsIG9wdGlvbnMpOwoJfSwKCglhZGRIb29rczogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9wb2x5Ll9tYXApIHsKCQkJaWYgKCF0aGlzLl9tYXJrZXJHcm91cCkgewoJCQkJdGhpcy5faW5pdE1hcmtlcnMoKTsKCQkJfQoJCQl0aGlzLl9wb2x5Ll9tYXAuYWRkTGF5ZXIodGhpcy5fbWFya2VyR3JvdXApOwoJCX0KCX0sCgoJcmVtb3ZlSG9va3M6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fcG9seS5fbWFwKSB7CgkJCXRoaXMuX3BvbHkuX21hcC5yZW1vdmVMYXllcih0aGlzLl9tYXJrZXJHcm91cCk7CgkJCWRlbGV0ZSB0aGlzLl9tYXJrZXJHcm91cDsKCQkJZGVsZXRlIHRoaXMuX21hcmtlcnM7CgkJfQoJfSwKCgl1cGRhdGVNYXJrZXJzOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fbWFya2VyR3JvdXAuY2xlYXJMYXllcnMoKTsKCQl0aGlzLl9pbml0TWFya2VycygpOwoJfSwKCglfaW5pdE1hcmtlcnM6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIXRoaXMuX21hcmtlckdyb3VwKSB7CgkJCXRoaXMuX21hcmtlckdyb3VwID0gbmV3IEwuTGF5ZXJHcm91cCgpOwoJCX0KCQl0aGlzLl9tYXJrZXJzID0gW107CgoJCXZhciBsYXRsbmdzID0gdGhpcy5fcG9seS5nZXRMYXRMbmdzKCksCgkJCWksIGosIGxlbiwgbWFya2VyOwoKCQkvLyBUT0RPIHJlZmFjdG9yIGhvbGVzIGltcGxlbWVudGF0aW9uIGluIFBvbHlnb24gdG8gc3VwcG9ydCBpdCBoZXJlCgoJCWZvciAoaSA9IDAsIGxlbiA9IGxhdGxuZ3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCgkJCW1hcmtlciA9IHRoaXMuX2NyZWF0ZU1hcmtlcihsYXRsbmdzW2ldLCBpKTsKCQkJbWFya2VyLm9uKCdjbGljaycsIHRoaXMuX29uTWFya2VyQ2xpY2ssIHRoaXMpOwoJCQl0aGlzLl9tYXJrZXJzLnB1c2gobWFya2VyKTsKCQl9CgoJCXZhciBtYXJrZXJMZWZ0LCBtYXJrZXJSaWdodDsKCgkJZm9yIChpID0gMCwgaiA9IGxlbiAtIDE7IGkgPCBsZW47IGogPSBpKyspIHsKCQkJaWYgKGkgPT09IDAgJiYgIShMLkdlb2Rlc2ljUG9seWdvbiAmJiAodGhpcy5fcG9seSBpbnN0YW5jZW9mIEwuR2VvZGVzaWNQb2x5Z29uKSkpIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQltYXJrZXJMZWZ0ID0gdGhpcy5fbWFya2Vyc1tqXTsKCQkJbWFya2VyUmlnaHQgPSB0aGlzLl9tYXJrZXJzW2ldOwoKCQkJdGhpcy5fY3JlYXRlTWlkZGxlTWFya2VyKG1hcmtlckxlZnQsIG1hcmtlclJpZ2h0KTsKCQkJdGhpcy5fdXBkYXRlUHJldk5leHQobWFya2VyTGVmdCwgbWFya2VyUmlnaHQpOwoJCX0KCX0sCgoJX2NyZWF0ZU1hcmtlcjogZnVuY3Rpb24gKGxhdGxuZywgaW5kZXgpIHsKCQl2YXIgbWFya2VyID0gbmV3IEwuTWFya2VyKGxhdGxuZywgewoJCQlkcmFnZ2FibGU6IHRydWUsCgkJCWljb246IHRoaXMub3B0aW9ucy5pY29uCgkJfSk7CgoJCW1hcmtlci5fb3JpZ0xhdExuZyA9IGxhdGxuZzsKCQltYXJrZXIuX2luZGV4ID0gaW5kZXg7CgoJCW1hcmtlci5vbignZHJhZycsIHRoaXMuX29uTWFya2VyRHJhZywgdGhpcyk7CgkJbWFya2VyLm9uKCdkcmFnZW5kJywgdGhpcy5fZmlyZUVkaXQsIHRoaXMpOwoKCQl0aGlzLl9tYXJrZXJHcm91cC5hZGRMYXllcihtYXJrZXIpOwoKCQlyZXR1cm4gbWFya2VyOwoJfSwKCglfcmVtb3ZlTWFya2VyOiBmdW5jdGlvbiAobWFya2VyKSB7CgkJdmFyIGkgPSBtYXJrZXIuX2luZGV4OwoKCQl0aGlzLl9tYXJrZXJHcm91cC5yZW1vdmVMYXllcihtYXJrZXIpOwoJCXRoaXMuX21hcmtlcnMuc3BsaWNlKGksIDEpOwoJCXRoaXMuX3BvbHkuc3BsaWNlTGF0TG5ncyhpLCAxKTsKCQl0aGlzLl91cGRhdGVJbmRleGVzKGksIC0xKTsKCgkJbWFya2VyCgkJCS5vZmYoJ2RyYWcnLCB0aGlzLl9vbk1hcmtlckRyYWcsIHRoaXMpCgkJCS5vZmYoJ2RyYWdlbmQnLCB0aGlzLl9maXJlRWRpdCwgdGhpcykKCQkJLm9mZignY2xpY2snLCB0aGlzLl9vbk1hcmtlckNsaWNrLCB0aGlzKTsKCX0sCgoJX2ZpcmVFZGl0OiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fcG9seS5lZGl0ZWQgPSB0cnVlOwoJCXRoaXMuX3BvbHkuZmlyZSgnZWRpdCcpOwoJfSwKCglfb25NYXJrZXJEcmFnOiBmdW5jdGlvbiAoZSkgewoJCXZhciBtYXJrZXIgPSBlLnRhcmdldDsKCgkJTC5leHRlbmQobWFya2VyLl9vcmlnTGF0TG5nLCBtYXJrZXIuX2xhdGxuZyk7CgoJCWlmIChtYXJrZXIuX21pZGRsZUxlZnQpIHsKCQkJbWFya2VyLl9taWRkbGVMZWZ0LnNldExhdExuZyh0aGlzLl9nZXRNaWRkbGVMYXRMbmcobWFya2VyLl9wcmV2LCBtYXJrZXIpKTsKCQl9CgkJaWYgKG1hcmtlci5fbWlkZGxlUmlnaHQpIHsKCQkJbWFya2VyLl9taWRkbGVSaWdodC5zZXRMYXRMbmcodGhpcy5fZ2V0TWlkZGxlTGF0TG5nKG1hcmtlciwgbWFya2VyLl9uZXh0KSk7CgkJfQoKCQl0aGlzLl9wb2x5LnJlZHJhdygpOwoJfSwKCglfb25NYXJrZXJDbGljazogZnVuY3Rpb24gKGUpIHsKCQkvLyB3ZSB3YW50IHRvIHJlbW92ZSB0aGUgbWFya2VyIG9uIGNsaWNrLCBidXQgaWYgbGF0bG5nIGNvdW50IDwgMywgcG9seWxpbmUgd291bGQgYmUgaW52YWxpZAoJCWlmICh0aGlzLl9wb2x5LmdldExhdExuZ3MoKS5sZW5ndGggPCAzKSB7IHJldHVybjsgfQoKCQl2YXIgbWFya2VyID0gZS50YXJnZXQ7CgoJCS8vIHJlbW92ZSB0aGUgbWFya2VyCgkJdGhpcy5fcmVtb3ZlTWFya2VyKG1hcmtlcik7CgoJCS8vIHVwZGF0ZSBwcmV2L25leHQgbGlua3Mgb2YgYWRqYWNlbnQgbWFya2VycwoJCXRoaXMuX3VwZGF0ZVByZXZOZXh0KG1hcmtlci5fcHJldiwgbWFya2VyLl9uZXh0KTsKCgkJLy8gcmVtb3ZlIGdob3N0IG1hcmtlcnMgbmVhciB0aGUgcmVtb3ZlZCBtYXJrZXIKCQlpZiAobWFya2VyLl9taWRkbGVMZWZ0KSB7CgkJCXRoaXMuX21hcmtlckdyb3VwLnJlbW92ZUxheWVyKG1hcmtlci5fbWlkZGxlTGVmdCk7CgkJfQoJCWlmIChtYXJrZXIuX21pZGRsZVJpZ2h0KSB7CgkJCXRoaXMuX21hcmtlckdyb3VwLnJlbW92ZUxheWVyKG1hcmtlci5fbWlkZGxlUmlnaHQpOwoJCX0KCgkJLy8gY3JlYXRlIGEgZ2hvc3QgbWFya2VyIGluIHBsYWNlIG9mIHRoZSByZW1vdmVkIG9uZQoJCWlmIChtYXJrZXIuX3ByZXYgJiYgbWFya2VyLl9uZXh0KSB7CgkJCXRoaXMuX2NyZWF0ZU1pZGRsZU1hcmtlcihtYXJrZXIuX3ByZXYsIG1hcmtlci5fbmV4dCk7CgoJCX0gZWxzZSBpZiAoIW1hcmtlci5fcHJldikgewoJCQltYXJrZXIuX25leHQuX21pZGRsZUxlZnQgPSBudWxsOwoKCQl9IGVsc2UgaWYgKCFtYXJrZXIuX25leHQpIHsKCQkJbWFya2VyLl9wcmV2Ll9taWRkbGVSaWdodCA9IG51bGw7CgkJfQoKCQl0aGlzLl9maXJlRWRpdCgpOwoJfSwKCglfdXBkYXRlSW5kZXhlczogZnVuY3Rpb24gKGluZGV4LCBkZWx0YSkgewoJCXRoaXMuX21hcmtlckdyb3VwLmVhY2hMYXllcihmdW5jdGlvbiAobWFya2VyKSB7CgkJCWlmIChtYXJrZXIuX2luZGV4ID4gaW5kZXgpIHsKCQkJCW1hcmtlci5faW5kZXggKz0gZGVsdGE7CgkJCX0KCQl9KTsKCX0sCgoJX2NyZWF0ZU1pZGRsZU1hcmtlcjogZnVuY3Rpb24gKG1hcmtlcjEsIG1hcmtlcjIpIHsKCQl2YXIgbGF0bG5nID0gdGhpcy5fZ2V0TWlkZGxlTGF0TG5nKG1hcmtlcjEsIG1hcmtlcjIpLAoJCSAgICBtYXJrZXIgPSB0aGlzLl9jcmVhdGVNYXJrZXIobGF0bG5nKSwKCQkgICAgb25DbGljaywKCQkgICAgb25EcmFnU3RhcnQsCgkJICAgIG9uRHJhZ0VuZDsKCgkJbWFya2VyLnNldE9wYWNpdHkoMC42KTsKCgkJbWFya2VyMS5fbWlkZGxlUmlnaHQgPSBtYXJrZXIyLl9taWRkbGVMZWZ0ID0gbWFya2VyOwoKCQlvbkRyYWdTdGFydCA9IGZ1bmN0aW9uICgpIHsKCQkJdmFyIGkgPSBtYXJrZXIyLl9pbmRleDsKCgkJCW1hcmtlci5faW5kZXggPSBpOwoKCQkJbWFya2VyCgkJCSAgICAub2ZmKCdjbGljaycsIG9uQ2xpY2ssIHRoaXMpCgkJCSAgICAub24oJ2NsaWNrJywgdGhpcy5fb25NYXJrZXJDbGljaywgdGhpcyk7CgoJCQlsYXRsbmcubGF0ID0gbWFya2VyLmdldExhdExuZygpLmxhdDsKCQkJbGF0bG5nLmxuZyA9IG1hcmtlci5nZXRMYXRMbmcoKS5sbmc7CgkJCXRoaXMuX3BvbHkuc3BsaWNlTGF0TG5ncyhpLCAwLCBsYXRsbmcpOwoJCQl0aGlzLl9tYXJrZXJzLnNwbGljZShpLCAwLCBtYXJrZXIpOwoKCQkJbWFya2VyLnNldE9wYWNpdHkoMSk7CgoJCQl0aGlzLl91cGRhdGVJbmRleGVzKGksIDEpOwoJCQltYXJrZXIyLl9pbmRleCsrOwoJCQl0aGlzLl91cGRhdGVQcmV2TmV4dChtYXJrZXIxLCBtYXJrZXIpOwoJCQl0aGlzLl91cGRhdGVQcmV2TmV4dChtYXJrZXIsIG1hcmtlcjIpOwoJCX07CgoJCW9uRHJhZ0VuZCA9IGZ1bmN0aW9uICgpIHsKCQkJbWFya2VyLm9mZignZHJhZ3N0YXJ0Jywgb25EcmFnU3RhcnQsIHRoaXMpOwoJCQltYXJrZXIub2ZmKCdkcmFnZW5kJywgb25EcmFnRW5kLCB0aGlzKTsKCgkJCXRoaXMuX2NyZWF0ZU1pZGRsZU1hcmtlcihtYXJrZXIxLCBtYXJrZXIpOwoJCQl0aGlzLl9jcmVhdGVNaWRkbGVNYXJrZXIobWFya2VyLCBtYXJrZXIyKTsKCQl9OwoKCQlvbkNsaWNrID0gZnVuY3Rpb24gKCkgewoJCQlvbkRyYWdTdGFydC5jYWxsKHRoaXMpOwoJCQlvbkRyYWdFbmQuY2FsbCh0aGlzKTsKCQkJdGhpcy5fZmlyZUVkaXQoKTsKCQl9OwoKCQltYXJrZXIKCQkgICAgLm9uKCdjbGljaycsIG9uQ2xpY2ssIHRoaXMpCgkJICAgIC5vbignZHJhZ3N0YXJ0Jywgb25EcmFnU3RhcnQsIHRoaXMpCgkJICAgIC5vbignZHJhZ2VuZCcsIG9uRHJhZ0VuZCwgdGhpcyk7CgoJCXRoaXMuX21hcmtlckdyb3VwLmFkZExheWVyKG1hcmtlcik7Cgl9LAoKCV91cGRhdGVQcmV2TmV4dDogZnVuY3Rpb24gKG1hcmtlcjEsIG1hcmtlcjIpIHsKCQlpZiAobWFya2VyMSkgewoJCQltYXJrZXIxLl9uZXh0ID0gbWFya2VyMjsKCQl9CgkJaWYgKG1hcmtlcjIpIHsKCQkJbWFya2VyMi5fcHJldiA9IG1hcmtlcjE7CgkJfQoJfSwKCglfZ2V0TWlkZGxlTGF0TG5nOiBmdW5jdGlvbiAobWFya2VyMSwgbWFya2VyMikgewoJCXZhciBtYXAgPSB0aGlzLl9wb2x5Ll9tYXAsCgkJICAgIHAxID0gbWFwLmxhdExuZ1RvTGF5ZXJQb2ludChtYXJrZXIxLmdldExhdExuZygpKSwKCQkgICAgcDIgPSBtYXAubGF0TG5nVG9MYXllclBvaW50KG1hcmtlcjIuZ2V0TGF0TG5nKCkpOwoKCQlyZXR1cm4gbWFwLmxheWVyUG9pbnRUb0xhdExuZyhwMS5fYWRkKHAyKS5fZGl2aWRlQnkoMikpOwoJfQp9KTsKCkwuUG9seWxpbmUuYWRkSW5pdEhvb2soZnVuY3Rpb24gKCkgewoKCS8vIENoZWNrIHRvIHNlZSBpZiBoYW5kbGVyIGhhcyBhbHJlYWR5IGJlZW4gaW5pdGlhbGl6ZWQuIFRoaXMgaXMgdG8gc3VwcG9ydCB2ZXJzaW9ucyBvZiBMZWFmbGV0IHRoYXQgc3RpbGwgaGF2ZSBMLkhhbmRsZXIuUG9seUVkaXQKCWlmICh0aGlzLmVkaXRpbmcpIHsKCQlyZXR1cm47Cgl9CgoJaWYgKEwuRWRpdC5Qb2x5KSB7CgkJdGhpcy5lZGl0aW5nID0gbmV3IEwuRWRpdC5Qb2x5KHRoaXMpOwoKCQlpZiAodGhpcy5vcHRpb25zLmVkaXRhYmxlKSB7CgkJCXRoaXMuZWRpdGluZy5lbmFibGUoKTsKCQl9Cgl9CgoJdGhpcy5vbignYWRkJywgZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLmVkaXRpbmcgJiYgdGhpcy5lZGl0aW5nLmVuYWJsZWQoKSkgewoJCQl0aGlzLmVkaXRpbmcuYWRkSG9va3MoKTsKCQl9Cgl9KTsKCgl0aGlzLm9uKCdyZW1vdmUnLCBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuZWRpdGluZyAmJiB0aGlzLmVkaXRpbmcuZW5hYmxlZCgpKSB7CgkJCXRoaXMuZWRpdGluZy5yZW1vdmVIb29rcygpOwoJCX0KCX0pOwp9KTsKCgpMLkVkaXQgPSBMLkVkaXQgfHwge307CgpMLkVkaXQuU2ltcGxlU2hhcGUgPSBMLkhhbmRsZXIuZXh0ZW5kKHsKCW9wdGlvbnM6IHsKCQltb3ZlSWNvbjogbmV3IEwuRGl2SWNvbih7CgkJCWljb25TaXplOiBuZXcgTC5Qb2ludCg4LCA4KSwKCQkJY2xhc3NOYW1lOiAnbGVhZmxldC1kaXYtaWNvbiBsZWFmbGV0LWVkaXRpbmctaWNvbiBsZWFmbGV0LWVkaXQtbW92ZScKCQl9KSwKCQlyZXNpemVJY29uOiBuZXcgTC5EaXZJY29uKHsKCQkJaWNvblNpemU6IG5ldyBMLlBvaW50KDgsIDgpLAoJCQljbGFzc05hbWU6ICdsZWFmbGV0LWRpdi1pY29uIGxlYWZsZXQtZWRpdGluZy1pY29uIGxlYWZsZXQtZWRpdC1yZXNpemUnCgkJfSkKCX0sCgoJaW5pdGlhbGl6ZTogZnVuY3Rpb24gKHNoYXBlLCBvcHRpb25zKSB7CgkJdGhpcy5fc2hhcGUgPSBzaGFwZTsKCQlMLlV0aWwuc2V0T3B0aW9ucyh0aGlzLCBvcHRpb25zKTsKCX0sCgoJYWRkSG9va3M6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fc2hhcGUuX21hcCkgewoJCQl0aGlzLl9tYXAgPSB0aGlzLl9zaGFwZS5fbWFwOwoKCQkJaWYgKCF0aGlzLl9tYXJrZXJHcm91cCkgewoJCQkJdGhpcy5faW5pdE1hcmtlcnMoKTsKCQkJfQoJCQl0aGlzLl9tYXAuYWRkTGF5ZXIodGhpcy5fbWFya2VyR3JvdXApOwoJCX0KCX0sCgoJcmVtb3ZlSG9va3M6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fc2hhcGUuX21hcCkgewoJCQl0aGlzLl91bmJpbmRNYXJrZXIodGhpcy5fbW92ZU1hcmtlcik7CgoJCQlmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMuX3Jlc2l6ZU1hcmtlcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CgkJCQl0aGlzLl91bmJpbmRNYXJrZXIodGhpcy5fcmVzaXplTWFya2Vyc1tpXSk7CgkJCX0KCQkJdGhpcy5fcmVzaXplTWFya2VycyA9IG51bGw7CgoJCQl0aGlzLl9tYXAucmVtb3ZlTGF5ZXIodGhpcy5fbWFya2VyR3JvdXApOwoJCQlkZWxldGUgdGhpcy5fbWFya2VyR3JvdXA7CgkJfQoKCQl0aGlzLl9tYXAgPSBudWxsOwoJfSwKCgl1cGRhdGVNYXJrZXJzOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fbWFya2VyR3JvdXAuY2xlYXJMYXllcnMoKTsKCQl0aGlzLl9pbml0TWFya2VycygpOwoJfSwKCglfaW5pdE1hcmtlcnM6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIXRoaXMuX21hcmtlckdyb3VwKSB7CgkJCXRoaXMuX21hcmtlckdyb3VwID0gbmV3IEwuTGF5ZXJHcm91cCgpOwoJCX0KCgkJLy8gQ3JlYXRlIGNlbnRlciBtYXJrZXIKCQl0aGlzLl9jcmVhdGVNb3ZlTWFya2VyKCk7CgoJCS8vIENyZWF0ZSBlZGdlIG1hcmtlcgoJCXRoaXMuX2NyZWF0ZVJlc2l6ZU1hcmtlcigpOwoJfSwKCglfY3JlYXRlTW92ZU1hcmtlcjogZnVuY3Rpb24gKCkgewoJCS8vIENoaWxkcmVuIG92ZXJyaWRlCgl9LAoKCV9jcmVhdGVSZXNpemVNYXJrZXI6IGZ1bmN0aW9uICgpIHsKCQkvLyBDaGlsZHJlbiBvdmVycmlkZQoJfSwKCglfY3JlYXRlTWFya2VyOiBmdW5jdGlvbiAobGF0bG5nLCBpY29uKSB7CgkJdmFyIG1hcmtlciA9IG5ldyBMLk1hcmtlcihsYXRsbmcsIHsKCQkJZHJhZ2dhYmxlOiB0cnVlLAoJCQlpY29uOiBpY29uLAoJCQl6SW5kZXhPZmZzZXQ6IDEwCgkJfSk7CgoJCXRoaXMuX2JpbmRNYXJrZXIobWFya2VyKTsKCgkJdGhpcy5fbWFya2VyR3JvdXAuYWRkTGF5ZXIobWFya2VyKTsKCgkJcmV0dXJuIG1hcmtlcjsKCX0sCgoJX2JpbmRNYXJrZXI6IGZ1bmN0aW9uIChtYXJrZXIpIHsKCQltYXJrZXIKCQkJLm9uKCdkcmFnc3RhcnQnLCB0aGlzLl9vbk1hcmtlckRyYWdTdGFydCwgdGhpcykKCQkJLm9uKCdkcmFnJywgdGhpcy5fb25NYXJrZXJEcmFnLCB0aGlzKQoJCQkub24oJ2RyYWdlbmQnLCB0aGlzLl9vbk1hcmtlckRyYWdFbmQsIHRoaXMpOwoJfSwKCglfdW5iaW5kTWFya2VyOiBmdW5jdGlvbiAobWFya2VyKSB7CgkJbWFya2VyCgkJCS5vZmYoJ2RyYWdzdGFydCcsIHRoaXMuX29uTWFya2VyRHJhZ1N0YXJ0LCB0aGlzKQoJCQkub2ZmKCdkcmFnJywgdGhpcy5fb25NYXJrZXJEcmFnLCB0aGlzKQoJCQkub2ZmKCdkcmFnZW5kJywgdGhpcy5fb25NYXJrZXJEcmFnRW5kLCB0aGlzKTsKCX0sCgoJX29uTWFya2VyRHJhZ1N0YXJ0OiBmdW5jdGlvbiAoZSkgewoJCXZhciBtYXJrZXIgPSBlLnRhcmdldDsKCQltYXJrZXIuc2V0T3BhY2l0eSgwKTsKCX0sCgoJX2ZpcmVFZGl0OiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fc2hhcGUuZWRpdGVkID0gdHJ1ZTsKCQl0aGlzLl9zaGFwZS5maXJlKCdlZGl0Jyk7Cgl9LAoKCV9vbk1hcmtlckRyYWc6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIG1hcmtlciA9IGUudGFyZ2V0LAoJCQlsYXRsbmcgPSBtYXJrZXIuZ2V0TGF0TG5nKCk7CgoJCWlmIChtYXJrZXIgPT09IHRoaXMuX21vdmVNYXJrZXIpIHsKCQkJdGhpcy5fbW92ZShsYXRsbmcpOwoJCX0gZWxzZSB7CgkJCXRoaXMuX3Jlc2l6ZShsYXRsbmcpOwoJCX0KCgkJdGhpcy5fc2hhcGUucmVkcmF3KCk7Cgl9LAoKCV9vbk1hcmtlckRyYWdFbmQ6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIG1hcmtlciA9IGUudGFyZ2V0OwoJCW1hcmtlci5zZXRPcGFjaXR5KDEpOwoKCQl0aGlzLl9zaGFwZS5maXJlKCdlZGl0Jyk7CgkJdGhpcy5fZmlyZUVkaXQoKTsKCX0sCgoJX21vdmU6IGZ1bmN0aW9uICgpIHsKCQkvLyBDaGlsZHJlbiBvdmVycmlkZQoJfSwKCglfcmVzaXplOiBmdW5jdGlvbiAoKSB7CgkJLy8gQ2hpbGRyZW4gb3ZlcnJpZGUKCX0KfSk7CgpMLkVkaXQgPSBMLkVkaXQgfHwge307CgpMLkVkaXQuUmVjdGFuZ2xlID0gTC5FZGl0LlNpbXBsZVNoYXBlLmV4dGVuZCh7CglfY3JlYXRlTW92ZU1hcmtlcjogZnVuY3Rpb24gKCkgewoJCXZhciBib3VuZHMgPSB0aGlzLl9zaGFwZS5nZXRCb3VuZHMoKSwKCQkJY2VudGVyID0gYm91bmRzLmdldENlbnRlcigpOwoKCQl0aGlzLl9tb3ZlTWFya2VyID0gdGhpcy5fY3JlYXRlTWFya2VyKGNlbnRlciwgdGhpcy5vcHRpb25zLm1vdmVJY29uKTsKCX0sCgoJX2NyZWF0ZVJlc2l6ZU1hcmtlcjogZnVuY3Rpb24gKCkgewoJCXZhciBjb3JuZXJzID0gdGhpcy5fZ2V0Q29ybmVycygpOwoKCQl0aGlzLl9yZXNpemVNYXJrZXJzID0gW107CgoJCWZvciAodmFyIGkgPSAwLCBsID0gY29ybmVycy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKCQkJdGhpcy5fcmVzaXplTWFya2Vycy5wdXNoKHRoaXMuX2NyZWF0ZU1hcmtlcihjb3JuZXJzW2ldLCB0aGlzLm9wdGlvbnMucmVzaXplSWNvbikpOwoJCQkvLyBNb25rZXkgaW4gdGhlIGNvcm5lciBpbmRleCBhcyB3ZSB3aWxsIG5lZWQgdG8ga25vdyB0aGlzIGZvciBkcmFnZ2luZwoJCQl0aGlzLl9yZXNpemVNYXJrZXJzW2ldLl9jb3JuZXJJbmRleCA9IGk7CgkJfQoJfSwKCglfb25NYXJrZXJEcmFnU3RhcnQ6IGZ1bmN0aW9uIChlKSB7CgkJTC5FZGl0LlNpbXBsZVNoYXBlLnByb3RvdHlwZS5fb25NYXJrZXJEcmFnU3RhcnQuY2FsbCh0aGlzLCBlKTsKCgkJLy8gU2F2ZSBhIHJlZmVyZW5jZSB0byB0aGUgb3Bwb3NpdGUgcG9pbnQKCQl2YXIgY29ybmVycyA9IHRoaXMuX2dldENvcm5lcnMoKSwKCQkJbWFya2VyID0gZS50YXJnZXQsCgkJCWN1cnJlbnRDb3JuZXJJbmRleCA9IG1hcmtlci5fY29ybmVySW5kZXg7CgoJCXRoaXMuX29wcG9zaXRlQ29ybmVyID0gY29ybmVyc1soY3VycmVudENvcm5lckluZGV4ICsgMikgJSA0XTsKCgkJdGhpcy5fdG9nZ2xlQ29ybmVyTWFya2VycygwLCBjdXJyZW50Q29ybmVySW5kZXgpOwoJfSwKCglfb25NYXJrZXJEcmFnRW5kOiBmdW5jdGlvbiAoZSkgewoJCXZhciBtYXJrZXIgPSBlLnRhcmdldCwKCQkJYm91bmRzLCBjZW50ZXI7CgoJCS8vIFJlc2V0IG1vdmUgbWFya2VyIHBvc2l0aW9uIHRvIHRoZSBjZW50ZXIKCQlpZiAobWFya2VyID09PSB0aGlzLl9tb3ZlTWFya2VyKSB7CgkJCWJvdW5kcyA9IHRoaXMuX3NoYXBlLmdldEJvdW5kcygpOwoJCQljZW50ZXIgPSBib3VuZHMuZ2V0Q2VudGVyKCk7CgoJCQltYXJrZXIuc2V0TGF0TG5nKGNlbnRlcik7CgkJfQoKCQl0aGlzLl90b2dnbGVDb3JuZXJNYXJrZXJzKDEpOwoKCQl0aGlzLl9yZXBvc2l0aW9uQ29ybmVyTWFya2VycygpOwoKCQlMLkVkaXQuU2ltcGxlU2hhcGUucHJvdG90eXBlLl9vbk1hcmtlckRyYWdFbmQuY2FsbCh0aGlzLCBlKTsKCX0sCgoJX21vdmU6IGZ1bmN0aW9uIChuZXdDZW50ZXIpIHsKCQl2YXIgbGF0bG5ncyA9IHRoaXMuX3NoYXBlLmdldExhdExuZ3MoKSwKCQkJYm91bmRzID0gdGhpcy5fc2hhcGUuZ2V0Qm91bmRzKCksCgkJCWNlbnRlciA9IGJvdW5kcy5nZXRDZW50ZXIoKSwKCQkJb2Zmc2V0LCBuZXdMYXRMbmdzID0gW107CgoJCS8vIE9mZnNldCB0aGUgbGF0bG5ncyB0byB0aGUgbmV3IGNlbnRlcgoJCWZvciAodmFyIGkgPSAwLCBsID0gbGF0bG5ncy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKCQkJb2Zmc2V0ID0gW2xhdGxuZ3NbaV0ubGF0IC0gY2VudGVyLmxhdCwgbGF0bG5nc1tpXS5sbmcgLSBjZW50ZXIubG5nXTsKCQkJbmV3TGF0TG5ncy5wdXNoKFtuZXdDZW50ZXIubGF0ICsgb2Zmc2V0WzBdLCBuZXdDZW50ZXIubG5nICsgb2Zmc2V0WzFdXSk7CgkJfQoKCQl0aGlzLl9zaGFwZS5zZXRMYXRMbmdzKG5ld0xhdExuZ3MpOwoKCQkvLyBSZXNwb2l0aW9uIHRoZSByZXNpemUgbWFya2VycwoJCXRoaXMuX3JlcG9zaXRpb25Db3JuZXJNYXJrZXJzKCk7Cgl9LAoKCV9yZXNpemU6IGZ1bmN0aW9uIChsYXRsbmcpIHsKCQl2YXIgYm91bmRzOwoKCQkvLyBVcGRhdGUgdGhlIHNoYXBlIGJhc2VkIG9uIHRoZSBjdXJyZW50IHBvc2l0aW9uIG9mIHRoaXMgY29ybmVyIGFuZCB0aGUgb3Bwb3NpdGUgcG9pbnQKCQl0aGlzLl9zaGFwZS5zZXRCb3VuZHMoTC5sYXRMbmdCb3VuZHMobGF0bG5nLCB0aGlzLl9vcHBvc2l0ZUNvcm5lcikpOwoKCQkvLyBSZXNwb2l0aW9uIHRoZSBtb3ZlIG1hcmtlcgoJCWJvdW5kcyA9IHRoaXMuX3NoYXBlLmdldEJvdW5kcygpOwoJCXRoaXMuX21vdmVNYXJrZXIuc2V0TGF0TG5nKGJvdW5kcy5nZXRDZW50ZXIoKSk7Cgl9LAoKCV9nZXRDb3JuZXJzOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGJvdW5kcyA9IHRoaXMuX3NoYXBlLmdldEJvdW5kcygpLAoJCQludyA9IGJvdW5kcy5nZXROb3J0aFdlc3QoKSwKCQkJbmUgPSBib3VuZHMuZ2V0Tm9ydGhFYXN0KCksCgkJCXNlID0gYm91bmRzLmdldFNvdXRoRWFzdCgpLAoJCQlzdyA9IGJvdW5kcy5nZXRTb3V0aFdlc3QoKTsKCgkJcmV0dXJuIFtudywgbmUsIHNlLCBzd107Cgl9LAoKCV90b2dnbGVDb3JuZXJNYXJrZXJzOiBmdW5jdGlvbiAob3BhY2l0eSkgewoJCWZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5fcmVzaXplTWFya2Vycy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKCQkJdGhpcy5fcmVzaXplTWFya2Vyc1tpXS5zZXRPcGFjaXR5KG9wYWNpdHkpOwoJCX0KCX0sCgoJX3JlcG9zaXRpb25Db3JuZXJNYXJrZXJzOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGNvcm5lcnMgPSB0aGlzLl9nZXRDb3JuZXJzKCk7CgoJCWZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5fcmVzaXplTWFya2Vycy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKCQkJdGhpcy5fcmVzaXplTWFya2Vyc1tpXS5zZXRMYXRMbmcoY29ybmVyc1tpXSk7CgkJfQoJfQp9KTsKCkwuUmVjdGFuZ2xlLmFkZEluaXRIb29rKGZ1bmN0aW9uICgpIHsKCWlmIChMLkVkaXQuUmVjdGFuZ2xlKSB7CgkJdGhpcy5lZGl0aW5nID0gbmV3IEwuRWRpdC5SZWN0YW5nbGUodGhpcyk7CgoJCWlmICh0aGlzLm9wdGlvbnMuZWRpdGFibGUpIHsKCQkJdGhpcy5lZGl0aW5nLmVuYWJsZSgpOwoJCX0KCX0KfSk7CgpMLkVkaXQgPSBMLkVkaXQgfHwge307CgpMLkVkaXQuQ2lyY2xlID0gTC5FZGl0LlNpbXBsZVNoYXBlLmV4dGVuZCh7CglfY3JlYXRlTW92ZU1hcmtlcjogZnVuY3Rpb24gKCkgewoJCXZhciBjZW50ZXIgPSB0aGlzLl9zaGFwZS5nZXRMYXRMbmcoKTsKCgkJdGhpcy5fbW92ZU1hcmtlciA9IHRoaXMuX2NyZWF0ZU1hcmtlcihjZW50ZXIsIHRoaXMub3B0aW9ucy5tb3ZlSWNvbik7Cgl9LAoKCV9jcmVhdGVSZXNpemVNYXJrZXI6IGZ1bmN0aW9uICgpIHsKCQl2YXIgY2VudGVyID0gdGhpcy5fc2hhcGUuZ2V0TGF0TG5nKCksCgkJCXJlc2l6ZW1hcmtlclBvaW50ID0gdGhpcy5fZ2V0UmVzaXplTWFya2VyUG9pbnQoY2VudGVyKTsKCgkJdGhpcy5fcmVzaXplTWFya2VycyA9IFtdOwoJCXRoaXMuX3Jlc2l6ZU1hcmtlcnMucHVzaCh0aGlzLl9jcmVhdGVNYXJrZXIocmVzaXplbWFya2VyUG9pbnQsIHRoaXMub3B0aW9ucy5yZXNpemVJY29uKSk7Cgl9LAoKCV9nZXRSZXNpemVNYXJrZXJQb2ludDogZnVuY3Rpb24gKGxhdGxuZykgewogICAgICAgICAgICAgICAgdmFyIGxhdFJhZGl1cyA9ICh0aGlzLl9zaGFwZS5nZXRSYWRpdXMoKSAvIDQwMDc1MDE3KSAqIDM2MDsKCQlyZXR1cm4gTC5sYXRMbmcobGF0bG5nLmxhdCtsYXRSYWRpdXMsbGF0bG5nLmxuZyk7Cgl9LAoKCV9tb3ZlOiBmdW5jdGlvbiAobGF0bG5nKSB7CgkJdmFyIHJlc2l6ZW1hcmtlclBvaW50ID0gdGhpcy5fZ2V0UmVzaXplTWFya2VyUG9pbnQobGF0bG5nKTsKCgkJLy8gTW92ZSB0aGUgcmVzaXplIG1hcmtlcgoJCXRoaXMuX3Jlc2l6ZU1hcmtlcnNbMF0uc2V0TGF0TG5nKHJlc2l6ZW1hcmtlclBvaW50KTsKCgkJLy8gTW92ZSB0aGUgY2lyY2xlCgkJdGhpcy5fc2hhcGUuc2V0TGF0TG5nKGxhdGxuZyk7Cgl9LAoKCV9yZXNpemU6IGZ1bmN0aW9uIChsYXRsbmcpIHsKCQl2YXIgbW92ZUxhdExuZyA9IHRoaXMuX21vdmVNYXJrZXIuZ2V0TGF0TG5nKCksCgkJCXJhZGl1cyA9IG1vdmVMYXRMbmcuZGlzdGFuY2VUbyhsYXRsbmcpOwoKCQl0aGlzLl9zaGFwZS5zZXRSYWRpdXMocmFkaXVzKTsKCX0KfSk7CgpMLkNpcmNsZS5hZGRJbml0SG9vayhmdW5jdGlvbiAoKSB7CglpZiAoTC5FZGl0LkNpcmNsZSkgewoJCXRoaXMuZWRpdGluZyA9IG5ldyBMLkVkaXQuQ2lyY2xlKHRoaXMpOwoKCQlpZiAodGhpcy5vcHRpb25zLmVkaXRhYmxlKSB7CgkJCXRoaXMuZWRpdGluZy5lbmFibGUoKTsKCQl9Cgl9CgoJdGhpcy5vbignYWRkJywgZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLmVkaXRpbmcgJiYgdGhpcy5lZGl0aW5nLmVuYWJsZWQoKSkgewoJCQl0aGlzLmVkaXRpbmcuYWRkSG9va3MoKTsKCQl9Cgl9KTsKCgl0aGlzLm9uKCdyZW1vdmUnLCBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuZWRpdGluZyAmJiB0aGlzLmVkaXRpbmcuZW5hYmxlZCgpKSB7CgkJCXRoaXMuZWRpdGluZy5yZW1vdmVIb29rcygpOwoJCX0KCX0pOwp9KTsKCkwuR2VvZGVzaWNDaXJjbGUuYWRkSW5pdEhvb2soZnVuY3Rpb24gKCkgewoJaWYgKEwuRWRpdC5DaXJjbGUpIHsKCQl0aGlzLmVkaXRpbmcgPSBuZXcgTC5FZGl0LkNpcmNsZSh0aGlzKTsKCgkJaWYgKHRoaXMub3B0aW9ucy5lZGl0YWJsZSkgewoJCQl0aGlzLmVkaXRpbmcuZW5hYmxlKCk7CgkJfQoJfQoKCXRoaXMub24oJ2FkZCcsIGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5lZGl0aW5nICYmIHRoaXMuZWRpdGluZy5lbmFibGVkKCkpIHsKCQkJdGhpcy5lZGl0aW5nLmFkZEhvb2tzKCk7CgkJfQoJfSk7CgoJdGhpcy5vbigncmVtb3ZlJywgZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLmVkaXRpbmcgJiYgdGhpcy5lZGl0aW5nLmVuYWJsZWQoKSkgewoJCQl0aGlzLmVkaXRpbmcucmVtb3ZlSG9va3MoKTsKCQl9Cgl9KTsKfSk7CgovKgogKiBMLkxhdExuZ1V0aWwgY29udGFpbnMgZGlmZmVyZW50IHV0aWxpdHkgZnVuY3Rpb25zIGZvciBMYXRMbmdzLgogKi8KCkwuTGF0TG5nVXRpbCA9IHsKCS8vIENsb25lcyBhIExhdExuZ3NbXSwgcmV0dXJucyBbXVtdCgljbG9uZUxhdExuZ3M6IGZ1bmN0aW9uIChsYXRsbmdzKSB7CgkJdmFyIGNsb25lID0gW107CgkJZm9yICh2YXIgaSA9IDAsIGwgPSBsYXRsbmdzLmxlbmd0aDsgaSA8IGw7IGkrKykgewoJCQljbG9uZS5wdXNoKHRoaXMuY2xvbmVMYXRMbmcobGF0bG5nc1tpXSkpOwoJCX0KCQlyZXR1cm4gY2xvbmU7Cgl9LAoKCWNsb25lTGF0TG5nOiBmdW5jdGlvbiAobGF0bG5nKSB7CgkJcmV0dXJuIEwubGF0TG5nKGxhdGxuZy5sYXQsIGxhdGxuZy5sbmcpOwoJfQp9OwoKTC5HZW9tZXRyeVV0aWwgPSB7CgkvLyBQb3J0ZWQgZnJvbSB0aGUgT3BlbkxheWVycyBpbXBsZW1lbnRhdGlvbi4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9vcGVubGF5ZXJzL29wZW5sYXllcnMvYmxvYi9tYXN0ZXIvbGliL09wZW5MYXllcnMvR2VvbWV0cnkvTGluZWFyUmluZy5qcyNMMjcwCglnZW9kZXNpY0FyZWE6IGZ1bmN0aW9uIChsYXRMbmdzKSB7CgkJdmFyIHBvaW50c0NvdW50ID0gbGF0TG5ncy5sZW5ndGgsCgkJCWFyZWEgPSAwLjAsCgkJCWQyciA9IEwuTGF0TG5nLkRFR19UT19SQUQsCgkJCXAxLCBwMjsKCgkJaWYgKHBvaW50c0NvdW50ID4gMikgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHBvaW50c0NvdW50OyBpKyspIHsKCQkJCXAxID0gbGF0TG5nc1tpXTsKCQkJCXAyID0gbGF0TG5nc1soaSArIDEpICUgcG9pbnRzQ291bnRdOwoJCQkJYXJlYSArPSAoKHAyLmxuZyAtIHAxLmxuZykgKiBkMnIpICoKCQkJCQkJKDIgKyBNYXRoLnNpbihwMS5sYXQgKiBkMnIpICsgTWF0aC5zaW4ocDIubGF0ICogZDJyKSk7CgkJCX0KCQkJYXJlYSA9IGFyZWEgKiA2MzY3MDAwLjAgKiA2MzY3MDAwLjAgLyAyLjA7CgkJfQoKCQlyZXR1cm4gTWF0aC5hYnMoYXJlYSk7Cgl9LAoKCXJlYWRhYmxlQXJlYTogZnVuY3Rpb24gKGFyZWEsIGlzTWV0cmljKSB7CgkJdmFyIGFyZWFTdHI7CgoJCWlmIChpc01ldHJpYykgewoJCQlpZiAoYXJlYSA+PSAxMDAwMCkgewoJCQkJYXJlYVN0ciA9IChhcmVhICogMC4wMDAxKS50b0ZpeGVkKDIpICsgJyBoYSc7CgkJCX0gZWxzZSB7CgkJCQlhcmVhU3RyID0gYXJlYS50b0ZpeGVkKDIpICsgJyBtJnN1cDI7JzsKCQkJfQoJCX0gZWxzZSB7CgkJCWFyZWEgKj0gMC44MzYxMjc7IC8vIFNxdWFyZSB5YXJkcyBpbiAxIG1ldGVyCgoJCQlpZiAoYXJlYSA+PSAzMDk3NjAwKSB7IC8vMzA5NzYwMCBzcXVhcmUgeWFyZHMgaW4gMSBzcXVhcmUgbWlsZQoJCQkJYXJlYVN0ciA9IChhcmVhIC8gMzA5NzYwMCkudG9GaXhlZCgyKSArICcgbWkmc3VwMjsnOwoJCQl9IGVsc2UgaWYgKGFyZWEgPj0gNDg0MCkgey8vNDgwNDAgc3F1YXJlIHlhcmRzIGluIDEgYWNyZQoJCQkJYXJlYVN0ciA9IChhcmVhIC8gNDg0MCkudG9GaXhlZCgyKSArICcgYWNyZXMnOwoJCQl9IGVsc2UgewoJCQkJYXJlYVN0ciA9IE1hdGguY2VpbChhcmVhKSArICcgeWQmc3VwMjsnOwoJCQl9CgkJfQoKCQlyZXR1cm4gYXJlYVN0cjsKCX0sCgoJcmVhZGFibGVEaXN0YW5jZTogZnVuY3Rpb24gKGRpc3RhbmNlLCBpc01ldHJpYykgewoJCXZhciBkaXN0YW5jZVN0cjsKCgkJaWYgKGlzTWV0cmljKSB7CgkJCS8vIHNob3cgbWV0cmVzIHdoZW4gZGlzdGFuY2UgaXMgPCAxa20sIHRoZW4gc2hvdyBrbQoJCQlpZiAoZGlzdGFuY2UgPiAxMDAwKSB7CgkJCQlkaXN0YW5jZVN0ciA9IChkaXN0YW5jZSAgLyAxMDAwKS50b0ZpeGVkKDIpICsgJyBrbSc7CgkJCX0gZWxzZSB7CgkJCQlkaXN0YW5jZVN0ciA9IE1hdGguY2VpbChkaXN0YW5jZSkgKyAnIG0nOwoJCQl9CgkJfSBlbHNlIHsKCQkJZGlzdGFuY2UgKj0gMS4wOTM2MTsKCgkJCWlmIChkaXN0YW5jZSA+IDE3NjApIHsKCQkJCWRpc3RhbmNlU3RyID0gKGRpc3RhbmNlIC8gMTc2MCkudG9GaXhlZCgyKSArICcgbWlsZXMnOwoJCQl9IGVsc2UgewoJCQkJZGlzdGFuY2VTdHIgPSBNYXRoLmNlaWwoZGlzdGFuY2UpICsgJyB5ZCc7CgkJCX0KCQl9CgoJCXJldHVybiBkaXN0YW5jZVN0cjsKCX0KfTsKCkwuVXRpbC5leHRlbmQoTC5MaW5lVXRpbCwgewoJLy8gQ2hlY2tzIHRvIHNlZSBpZiB0d28gbGluZSBzZWdtZW50cyBpbnRlcnNlY3QuIERvZXMgbm90IGhhbmRsZSBkZWdlbmVyYXRlIGNhc2VzLgoJLy8gaHR0cDovL2NvbXBnZW9tLmNzLnVpdWMuZWR1L35qZWZmZS90ZWFjaGluZy8zNzMvbm90ZXMveDA2LXN3ZWVwbGluZS5wZGYKCXNlZ21lbnRzSW50ZXJzZWN0OiBmdW5jdGlvbiAoLypQb2ludCovIHAsIC8qUG9pbnQqLyBwMSwgLypQb2ludCovIHAyLCAvKlBvaW50Ki8gcDMpIHsKCQlyZXR1cm4JdGhpcy5fY2hlY2tDb3VudGVyY2xvY2t3aXNlKHAsIHAyLCBwMykgIT09CgkJCQl0aGlzLl9jaGVja0NvdW50ZXJjbG9ja3dpc2UocDEsIHAyLCBwMykgJiYKCQkJCXRoaXMuX2NoZWNrQ291bnRlcmNsb2Nrd2lzZShwLCBwMSwgcDIpICE9PQoJCQkJdGhpcy5fY2hlY2tDb3VudGVyY2xvY2t3aXNlKHAsIHAxLCBwMyk7Cgl9LAoKCS8vIGNoZWNrIHRvIHNlZSBpZiBwb2ludHMgYXJlIGluIGNvdW50ZXJjbG9ja3dpc2Ugb3JkZXIKCV9jaGVja0NvdW50ZXJjbG9ja3dpc2U6IGZ1bmN0aW9uICgvKlBvaW50Ki8gcCwgLypQb2ludCovIHAxLCAvKlBvaW50Ki8gcDIpIHsKCQlyZXR1cm4gKHAyLnkgLSBwLnkpICogKHAxLnggLSBwLngpID4gKHAxLnkgLSBwLnkpICogKHAyLnggLSBwLngpOwoJfQp9KTsKCkwuUG9seWxpbmUuaW5jbHVkZSh7CgkvLyBDaGVjayB0byBzZWUgaWYgdGhpcyBwb2x5bGluZSBoYXMgYW55IGxpbmVzZWdtZW50cyB0aGF0IGludGVyc2VjdC4KCS8vIE5PVEU6IGRvZXMgbm90IHN1cHBvcnQgZGV0ZWN0aW5nIGludGVyc2VjdGlvbiBmb3IgZGVnZW5lcmF0ZSBjYXNlcy4KCWludGVyc2VjdHM6IGZ1bmN0aW9uICgpIHsKCQl2YXIgcG9pbnRzID0gdGhpcy5fb3JpZ2luYWxQb2ludHMsCgkJCWxlbiA9IHBvaW50cyA/IHBvaW50cy5sZW5ndGggOiAwLAoJCQlpLCBwLCBwMTsKCgkJaWYgKHRoaXMuX3Rvb0Zld1BvaW50c0ZvckludGVyc2VjdGlvbigpKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWZvciAoaSA9IGxlbiAtIDE7IGkgPj0gMzsgaS0tKSB7CgkJCXAgPSBwb2ludHNbaSAtIDFdOwoJCQlwMSA9IHBvaW50c1tpXTsKCgoJCQlpZiAodGhpcy5fbGluZVNlZ21lbnRzSW50ZXJzZWN0c1JhbmdlKHAsIHAxLCBpIC0gMikpIHsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfQoKCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCS8vIENoZWNrIGZvciBpbnRlcnNlY3Rpb24gaWYgbmV3IGxhdGxuZyB3YXMgYWRkZWQgdG8gdGhpcyBwb2x5bGluZS4KCS8vIE5PVEU6IGRvZXMgbm90IHN1cHBvcnQgZGV0ZWN0aW5nIGludGVyc2VjdGlvbiBmb3IgZGVnZW5lcmF0ZSBjYXNlcy4KCW5ld0xhdExuZ0ludGVyc2VjdHM6IGZ1bmN0aW9uIChsYXRsbmcsIHNraXBGaXJzdCkgewoJCS8vIENhbm5vdCBjaGVjayBhIHBvbHlsaW5lIGZvciBpbnRlcnNlY3RpbmcgbGF0cy9sbmdzIHdoZW4gbm90IGFkZGVkIHRvIHRoZSBtYXAKCQlpZiAoIXRoaXMuX21hcCkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQlyZXR1cm4gdGhpcy5uZXdQb2ludEludGVyc2VjdHModGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludChsYXRsbmcpLCBza2lwRmlyc3QpOwoJfSwKCgkvLyBDaGVjayBmb3IgaW50ZXJzZWN0aW9uIGlmIG5ldyBwb2ludCB3YXMgYWRkZWQgdG8gdGhpcyBwb2x5bGluZS4KCS8vIG5ld1BvaW50IG11c3QgYmUgYSBsYXllciBwb2ludC4KCS8vIE5PVEU6IGRvZXMgbm90IHN1cHBvcnQgZGV0ZWN0aW5nIGludGVyc2VjdGlvbiBmb3IgZGVnZW5lcmF0ZSBjYXNlcy4KCW5ld1BvaW50SW50ZXJzZWN0czogZnVuY3Rpb24gKG5ld1BvaW50LCBza2lwRmlyc3QpIHsKCQl2YXIgcG9pbnRzID0gdGhpcy5fb3JpZ2luYWxQb2ludHMsCgkJCWxlbiA9IHBvaW50cyA/IHBvaW50cy5sZW5ndGggOiAwLAoJCQlsYXN0UG9pbnQgPSBwb2ludHMgPyBwb2ludHNbbGVuIC0gMV0gOiBudWxsLAoJCQkvLyBUaGUgcHJldmlvdXMgcHJldmlvdXMgbGluZSBzZWdtZW50LiBQcmV2aW91cyBsaW5lIHNlZ2VtZW50IGRvZXNuJ3QgbmVlZCB0ZXN0aW5nLgoJCQltYXhJbmRleCA9IGxlbiAtIDI7CgoJCWlmICh0aGlzLl90b29GZXdQb2ludHNGb3JJbnRlcnNlY3Rpb24oMSkpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJcmV0dXJuIHRoaXMuX2xpbmVTZWdtZW50c0ludGVyc2VjdHNSYW5nZShsYXN0UG9pbnQsIG5ld1BvaW50LCBtYXhJbmRleCwgc2tpcEZpcnN0ID8gMSA6IDApOwoJfSwKCgkvLyBQb2x5bGluZXMgd2l0aCAyIHNpZGVzIGNhbiBvbmx5IGludGVyc2VjdCBpbiBjYXNlcyB3aGVyZSBwb2ludHMgYXJlIGNvbGxpbmVhciAod2UgZG9uJ3Qgc3VwcG9ydCBkZXRlY3RpbmcgdGhlc2UpLgoJLy8gQ2Fubm90IGhhdmUgaW50ZXJzZWN0aW9uIHdoZW4gPCAzIGxpbmUgc2VnbWVudHMgKDwgNCBwb2ludHMpCglfdG9vRmV3UG9pbnRzRm9ySW50ZXJzZWN0aW9uOiBmdW5jdGlvbiAoZXh0cmFQb2ludHMpIHsKCQl2YXIgcG9pbnRzID0gdGhpcy5fb3JpZ2luYWxQb2ludHMsCgkJCWxlbiA9IHBvaW50cyA/IHBvaW50cy5sZW5ndGggOiAwOwoJCS8vIEluY3JlbWVudCBsZW5ndGggYnkgZXh0cmFQb2ludHMgaWYgcHJlc2VudAoJCWxlbiArPSBleHRyYVBvaW50cyB8fCAwOwoKCQlyZXR1cm4gIXRoaXMuX29yaWdpbmFsUG9pbnRzIHx8IGxlbiA8PSAzOwoJfSwKCgkvLyBDaGVja3MgYSBsaW5lIHNlZ21lbnQgaW50ZXJzZWN0aW9ucyB3aXRoIGFueSBsaW5lIHNlZ2VtZW50cyBiZWZvcmUgaXRzIHByZWRlY2Vzc29yLgoJLy8gRG9uJ3QgbmVlZCB0byBjaGVjayB0aGUgcHJlZGVjZXNzb3IgYXMgd2lsbCBuZXZlciBpbnRlcnNlY3QuCglfbGluZVNlZ21lbnRzSW50ZXJzZWN0c1JhbmdlOiBmdW5jdGlvbiAocCwgcDEsIG1heEluZGV4LCBtaW5JbmRleCkgewoJCXZhciBwb2ludHMgPSB0aGlzLl9vcmlnaW5hbFBvaW50cywKCQkJcDIsIHAzOwoKCQltaW5JbmRleCA9IG1pbkluZGV4IHx8IDA7CgoJCS8vIENoZWNrIGFsbCBwcmV2aW91cyBsaW5lIHNlZ21lbnRzIChiZXNpZGUgdGhlIGltbWVkaWF0ZWx5IHByZXZpb3VzKSBmb3IgaW50ZXJzZWN0aW9ucwoJCWZvciAodmFyIGogPSBtYXhJbmRleDsgaiA+IG1pbkluZGV4OyBqLS0pIHsKCQkJcDIgPSBwb2ludHNbaiAtIDFdOwoJCQlwMyA9IHBvaW50c1tqXTsKCgkJCWlmIChMLkxpbmVVdGlsLnNlZ21lbnRzSW50ZXJzZWN0KHAsIHAxLCBwMiwgcDMpKSB7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCgkJcmV0dXJuIGZhbHNlOwoJfQp9KTsKCkwuUG9seWdvbi5pbmNsdWRlKHsKCS8vIENoZWNrcyBhIHBvbHlnb24gZm9yIGFueSBpbnRlcnNlY3RpbmcgbGluZSBzZWdtZW50cy4gSWdub3JlcyBob2xlcy4KCWludGVyc2VjdHM6IGZ1bmN0aW9uICgpIHsKCQl2YXIgcG9seWxpbmVJbnRlcnNlY3RzLAoJCQlwb2ludHMgPSB0aGlzLl9vcmlnaW5hbFBvaW50cywKCQkJbGVuLCBmaXJzdFBvaW50LCBsYXN0UG9pbnQsIG1heEluZGV4OwoKCQlpZiAodGhpcy5fdG9vRmV3UG9pbnRzRm9ySW50ZXJzZWN0aW9uKCkpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJcG9seWxpbmVJbnRlcnNlY3RzID0gTC5Qb2x5bGluZS5wcm90b3R5cGUuaW50ZXJzZWN0cy5jYWxsKHRoaXMpOwoKCQkvLyBJZiBhbHJlYWR5IGZvdW5kIGFuIGludGVyc2VjdGlvbiBkb24ndCBuZWVkIHRvIGNoZWNrIGZvciBhbnkgbW9yZS4KCQlpZiAocG9seWxpbmVJbnRlcnNlY3RzKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCgkJbGVuID0gcG9pbnRzLmxlbmd0aDsKCQlmaXJzdFBvaW50ID0gcG9pbnRzWzBdOwoJCWxhc3RQb2ludCA9IHBvaW50c1tsZW4gLSAxXTsKCQltYXhJbmRleCA9IGxlbiAtIDI7CgoJCS8vIENoZWNrIHRoZSBsaW5lIHNlZ21lbnQgYmV0d2VlbiBsYXN0IGFuZCBmaXJzdCBwb2ludC4gRG9uJ3QgbmVlZCB0byBjaGVjayB0aGUgZmlyc3QgbGluZSBzZWdtZW50IChtaW5JbmRleCA9IDEpCgkJcmV0dXJuIHRoaXMuX2xpbmVTZWdtZW50c0ludGVyc2VjdHNSYW5nZShsYXN0UG9pbnQsIGZpcnN0UG9pbnQsIG1heEluZGV4LCAxKTsKCX0KfSk7CgpMLkNvbnRyb2wuRHJhdyA9IEwuQ29udHJvbC5leHRlbmQoewoKCW9wdGlvbnM6IHsKCQlwb3NpdGlvbjogJ3RvcGxlZnQnLAoJCWRyYXc6IHt9LAoJCWVkaXQ6IGZhbHNlCgl9LAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CgkJaWYgKEwudmVyc2lvbiA8PSAiMC41LjEiKSB7CgkJCXRocm93IG5ldyBFcnJvcignTGVhZmxldC5kcmF3IDAuMi4wKyByZXF1aXJlcyBMZWFmbGV0IDAuNi4wKy4gRG93bmxvYWQgbGF0ZXN0IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL0xlYWZsZXQvTGVhZmxldC8nKTsKCQl9CgoJCUwuQ29udHJvbC5wcm90b3R5cGUuaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMpOwoKCQl2YXIgaWQsIHRvb2xiYXI7CgoJCXRoaXMuX3Rvb2xiYXJzID0ge307CgoJCS8vIEluaXRpYWxpemUgdG9vbGJhcnMKCQlpZiAoTC5EcmF3VG9vbGJhciAmJiB0aGlzLm9wdGlvbnMuZHJhdykgewoJCQl0b29sYmFyID0gbmV3IEwuRHJhd1Rvb2xiYXIodGhpcy5vcHRpb25zLmRyYXcpOwoJCQlpZCA9IEwuc3RhbXAodG9vbGJhcik7CgkJCXRoaXMuX3Rvb2xiYXJzW2lkXSA9IHRvb2xiYXI7CgoJCQkvLyBMaXN0ZW4gZm9yIHdoZW4gdG9vbGJhciBpcyBlbmFibGVkCgkJCXRoaXMuX3Rvb2xiYXJzW2lkXS5vbignZW5hYmxlJywgdGhpcy5fdG9vbGJhckVuYWJsZWQsIHRoaXMpOwoJCX0KCgkJaWYgKEwuRWRpdFRvb2xiYXIgJiYgdGhpcy5vcHRpb25zLmVkaXQpIHsKCQkJdG9vbGJhciA9IG5ldyBMLkVkaXRUb29sYmFyKHRoaXMub3B0aW9ucy5lZGl0KTsKCQkJaWQgPSBMLnN0YW1wKHRvb2xiYXIpOwoJCQl0aGlzLl90b29sYmFyc1tpZF0gPSB0b29sYmFyOwoKCQkJLy8gTGlzdGVuIGZvciB3aGVuIHRvb2xiYXIgaXMgZW5hYmxlZAoJCQl0aGlzLl90b29sYmFyc1tpZF0ub24oJ2VuYWJsZScsIHRoaXMuX3Rvb2xiYXJFbmFibGVkLCB0aGlzKTsKCQl9Cgl9LAoKCW9uQWRkOiBmdW5jdGlvbiAobWFwKSB7CgkJdmFyIGNvbnRhaW5lciA9IEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsICdsZWFmbGV0LWRyYXcnKSwKCQkJYWRkZWRUb3BDbGFzcyA9IGZhbHNlLAoJCQl0b3BDbGFzc05hbWUgPSAnbGVhZmxldC1kcmF3LXRvb2xiYXItdG9wJywKCQkJdG9vbGJhckNvbnRhaW5lcjsKCgkJZm9yICh2YXIgdG9vbGJhcklkIGluIHRoaXMuX3Rvb2xiYXJzKSB7CgkJCWlmICh0aGlzLl90b29sYmFycy5oYXNPd25Qcm9wZXJ0eSh0b29sYmFySWQpKSB7CgkJCQl0b29sYmFyQ29udGFpbmVyID0gdGhpcy5fdG9vbGJhcnNbdG9vbGJhcklkXS5hZGRUb29sYmFyKG1hcCk7CgoJCQkJLy8gQWRkIGNsYXNzIHRvIHRoZSBmaXJzdCB0b29sYmFyIHRvIHJlbW92ZSB0aGUgbWFyZ2luCgkJCQlpZiAoIWFkZGVkVG9wQ2xhc3MpIHsKCQkJCQlpZiAoIUwuRG9tVXRpbC5oYXNDbGFzcyh0b29sYmFyQ29udGFpbmVyLCB0b3BDbGFzc05hbWUpKSB7CgkJCQkJCUwuRG9tVXRpbC5hZGRDbGFzcyh0b29sYmFyQ29udGFpbmVyLmNoaWxkTm9kZXNbMF0sIHRvcENsYXNzTmFtZSk7CgkJCQkJfQoJCQkJCWFkZGVkVG9wQ2xhc3MgPSB0cnVlOwoJCQkJfQoKCQkJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0b29sYmFyQ29udGFpbmVyKTsKCQkJfQoJCX0KCgkJcmV0dXJuIGNvbnRhaW5lcjsKCX0sCgoJb25SZW1vdmU6IGZ1bmN0aW9uICgpIHsKCQlmb3IgKHZhciB0b29sYmFySWQgaW4gdGhpcy5fdG9vbGJhcnMpIHsKCQkJaWYgKHRoaXMuX3Rvb2xiYXJzLmhhc093blByb3BlcnR5KHRvb2xiYXJJZCkpIHsKCQkJCXRoaXMuX3Rvb2xiYXJzW3Rvb2xiYXJJZF0ucmVtb3ZlVG9vbGJhcigpOwoJCQl9CgkJfQoJfSwKCglzZXREcmF3aW5nT3B0aW9uczogZnVuY3Rpb24gKG9wdGlvbnMpIHsKCQlmb3IgKHZhciB0b29sYmFySWQgaW4gdGhpcy5fdG9vbGJhcnMpIHsKCQkJaWYgKHRoaXMuX3Rvb2xiYXJzW3Rvb2xiYXJJZF0gaW5zdGFuY2VvZiBMLkRyYXdUb29sYmFyKSB7CgkJCQl0aGlzLl90b29sYmFyc1t0b29sYmFySWRdLnNldE9wdGlvbnMob3B0aW9ucyk7CgkJCX0KCQl9Cgl9LAoKCV90b29sYmFyRW5hYmxlZDogZnVuY3Rpb24gKGUpIHsKCQl2YXIgaWQgPSAnJyArIEwuc3RhbXAoZS50YXJnZXQpOwoKCQlmb3IgKHZhciB0b29sYmFySWQgaW4gdGhpcy5fdG9vbGJhcnMpIHsKCQkJaWYgKHRoaXMuX3Rvb2xiYXJzLmhhc093blByb3BlcnR5KHRvb2xiYXJJZCkgJiYgdG9vbGJhcklkICE9PSBpZCkgewoJCQkJdGhpcy5fdG9vbGJhcnNbdG9vbGJhcklkXS5kaXNhYmxlKCk7CgkJCX0KCQl9Cgl9Cn0pOwoKTC5NYXAubWVyZ2VPcHRpb25zKHsKCWRyYXdDb250cm9sOiBmYWxzZQp9KTsKCkwuTWFwLmFkZEluaXRIb29rKGZ1bmN0aW9uICgpIHsKCWlmICh0aGlzLm9wdGlvbnMuZHJhd0NvbnRyb2wpIHsKCQl0aGlzLmRyYXdDb250cm9sID0gbmV3IEwuQ29udHJvbC5EcmF3KCk7CgkJdGhpcy5hZGRDb250cm9sKHRoaXMuZHJhd0NvbnRyb2wpOwoJfQp9KTsKCkwuVG9vbGJhciA9IEwuQ2xhc3MuZXh0ZW5kKHsKCWluY2x1ZGVzOiBbTC5NaXhpbi5FdmVudHNdLAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CgkJTC5zZXRPcHRpb25zKHRoaXMsIG9wdGlvbnMpOwoKCQl0aGlzLl9tb2RlcyA9IHt9OwoJCXRoaXMuX2FjdGlvbkJ1dHRvbnMgPSBbXTsKCQl0aGlzLl9hY3RpdmVNb2RlID0gbnVsbDsKCX0sCgoJZW5hYmxlZDogZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLl9hY3RpdmVNb2RlICE9PSBudWxsOwoJfSwKCglkaXNhYmxlOiBmdW5jdGlvbiAoKSB7CgkJaWYgKCF0aGlzLmVuYWJsZWQoKSkgeyByZXR1cm47IH0KCgkJdGhpcy5fYWN0aXZlTW9kZS5oYW5kbGVyLmRpc2FibGUoKTsKCX0sCgoJcmVtb3ZlVG9vbGJhcjogZnVuY3Rpb24gKCkgewoJCS8vIERpc3Bvc2UgZWFjaCBoYW5kbGVyCgkJZm9yICh2YXIgaGFuZGxlcklkIGluIHRoaXMuX21vZGVzKSB7CgkJCWlmICh0aGlzLl9tb2Rlcy5oYXNPd25Qcm9wZXJ0eShoYW5kbGVySWQpKSB7CgkJCQkvLyBVbmJpbmQgaGFuZGxlciBidXR0b24KCQkJCXRoaXMuX2Rpc3Bvc2VCdXR0b24odGhpcy5fbW9kZXNbaGFuZGxlcklkXS5idXR0b24sIHRoaXMuX21vZGVzW2hhbmRsZXJJZF0uaGFuZGxlci5lbmFibGUpOwoKCQkJCS8vIE1ha2Ugc3VyZSBpcyBkaXNhYmxlZAoJCQkJdGhpcy5fbW9kZXNbaGFuZGxlcklkXS5oYW5kbGVyLmRpc2FibGUoKTsKCgkJCQkvLyBVbmJpbmQgaGFuZGxlcgoJCQkJdGhpcy5fbW9kZXNbaGFuZGxlcklkXS5oYW5kbGVyCgkJCQkJLm9mZignZW5hYmxlZCcsIHRoaXMuX2hhbmRsZXJBY3RpdmF0ZWQsIHRoaXMpCgkJCQkJLm9mZignZGlzYWJsZWQnLCB0aGlzLl9oYW5kbGVyRGVhY3RpdmF0ZWQsIHRoaXMpOwoJCQl9CgkJfQoJCXRoaXMuX21vZGVzID0ge307CgoJCS8vIERpc3Bvc2UgdGhlIGFjdGlvbnMgdG9vbGJhcgoJCWZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5fYWN0aW9uQnV0dG9ucy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKCQkJdGhpcy5fZGlzcG9zZUJ1dHRvbih0aGlzLl9hY3Rpb25CdXR0b25zW2ldLmJ1dHRvbiwgdGhpcy5fYWN0aW9uQnV0dG9uc1tpXS5jYWxsYmFjayk7CgkJfQoJCXRoaXMuX2FjdGlvbkJ1dHRvbnMgPSBbXTsKCQl0aGlzLl9hY3Rpb25zQ29udGFpbmVyID0gbnVsbDsKCX0sCgoJX2luaXRNb2RlSGFuZGxlcjogZnVuY3Rpb24gKGhhbmRsZXIsIGNvbnRhaW5lciwgYnV0dG9uSW5kZXgsIGNsYXNzTmFtZVByZWRpeCwgYnV0dG9uVGl0bGUpIHsKCQl2YXIgdHlwZSA9IGhhbmRsZXIudHlwZTsKCgkJdGhpcy5fbW9kZXNbdHlwZV0gPSB7fTsKCgkJdGhpcy5fbW9kZXNbdHlwZV0uaGFuZGxlciA9IGhhbmRsZXI7CgoJCXRoaXMuX21vZGVzW3R5cGVdLmJ1dHRvbiA9IHRoaXMuX2NyZWF0ZUJ1dHRvbih7CgkJCXRpdGxlOiBidXR0b25UaXRsZSwKCQkJY2xhc3NOYW1lOiBjbGFzc05hbWVQcmVkaXggKyAnLScgKyB0eXBlLAoJCQljb250YWluZXI6IGNvbnRhaW5lciwKCQkJY2FsbGJhY2s6IHRoaXMuX21vZGVzW3R5cGVdLmhhbmRsZXIuZW5hYmxlLAoJCQljb250ZXh0OiB0aGlzLl9tb2Rlc1t0eXBlXS5oYW5kbGVyCgkJfSk7CgoJCXRoaXMuX21vZGVzW3R5cGVdLmJ1dHRvbkluZGV4ID0gYnV0dG9uSW5kZXg7CgoJCXRoaXMuX21vZGVzW3R5cGVdLmhhbmRsZXIKCQkJLm9uKCdlbmFibGVkJywgdGhpcy5faGFuZGxlckFjdGl2YXRlZCwgdGhpcykKCQkJLm9uKCdkaXNhYmxlZCcsIHRoaXMuX2hhbmRsZXJEZWFjdGl2YXRlZCwgdGhpcyk7Cgl9LAoKCV9jcmVhdGVCdXR0b246IGZ1bmN0aW9uIChvcHRpb25zKSB7CgkJdmFyIGxpbmsgPSBMLkRvbVV0aWwuY3JlYXRlKCdhJywgb3B0aW9ucy5jbGFzc05hbWUgfHwgJycsIG9wdGlvbnMuY29udGFpbmVyKTsKCQlsaW5rLmhyZWYgPSAnIyc7CgoJCWlmIChvcHRpb25zLnRleHQpIHsKCQkJbGluay5pbm5lckhUTUwgPSBvcHRpb25zLnRleHQ7CgkJfQoKCQlpZiAob3B0aW9ucy50aXRsZSkgewoJCQlsaW5rLnRpdGxlID0gb3B0aW9ucy50aXRsZTsKCQl9CgoJCUwuRG9tRXZlbnQKCQkJLm9uKGxpbmssICdjbGljaycsIEwuRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKQoJCQkub24obGluaywgJ21vdXNlZG93bicsIEwuRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKQoJCQkub24obGluaywgJ2RibGNsaWNrJywgTC5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24pCgkJCS5vbihsaW5rLCAnY2xpY2snLCBMLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KQoJCQkub24obGluaywgJ2NsaWNrJywgb3B0aW9ucy5jYWxsYmFjaywgb3B0aW9ucy5jb250ZXh0KTsKCgkJcmV0dXJuIGxpbms7Cgl9LAoKCV9kaXNwb3NlQnV0dG9uOiBmdW5jdGlvbiAoYnV0dG9uLCBjYWxsYmFjaykgewoJCUwuRG9tRXZlbnQKCQkJLm9mZihidXR0b24sICdjbGljaycsIEwuRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKQoJCQkub2ZmKGJ1dHRvbiwgJ21vdXNlZG93bicsIEwuRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKQoJCQkub2ZmKGJ1dHRvbiwgJ2RibGNsaWNrJywgTC5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24pCgkJCS5vZmYoYnV0dG9uLCAnY2xpY2snLCBMLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KQoJCQkub2ZmKGJ1dHRvbiwgJ2NsaWNrJywgY2FsbGJhY2spOwoJfSwKCglfaGFuZGxlckFjdGl2YXRlZDogZnVuY3Rpb24gKGUpIHsKCQkvLyBEaXNhYmxlIGFjdGl2ZSBtb2RlIChpZiBwcmVzZW50KQoJCWlmICh0aGlzLl9hY3RpdmVNb2RlICYmIHRoaXMuX2FjdGl2ZU1vZGUuaGFuZGxlci5lbmFibGVkKCkpIHsKCQkJdGhpcy5fYWN0aXZlTW9kZS5oYW5kbGVyLmRpc2FibGUoKTsKCQl9CgoJCS8vIENhY2hlIG5ldyBhY3RpdmUgZmVhdHVyZQoJCXRoaXMuX2FjdGl2ZU1vZGUgPSB0aGlzLl9tb2Rlc1tlLmhhbmRsZXJdOwoKCQlMLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fYWN0aXZlTW9kZS5idXR0b24sICdsZWFmbGV0LWRyYXctdG9vbGJhci1idXR0b24tZW5hYmxlZCcpOwoKCQl0aGlzLl9zaG93QWN0aW9uc1Rvb2xiYXIoKTsKCgkJdGhpcy5maXJlKCdlbmFibGUnKTsKCX0sCgoJX2hhbmRsZXJEZWFjdGl2YXRlZDogZnVuY3Rpb24gKCkgewoJCXRoaXMuX2hpZGVBY3Rpb25zVG9vbGJhcigpOwoKCQlMLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fYWN0aXZlTW9kZS5idXR0b24sICdsZWFmbGV0LWRyYXctdG9vbGJhci1idXR0b24tZW5hYmxlZCcpOwoKCQl0aGlzLl9hY3RpdmVNb2RlID0gbnVsbDsKCgkJdGhpcy5maXJlKCdkaXNhYmxlJyk7Cgl9LAoKCV9jcmVhdGVBY3Rpb25zOiBmdW5jdGlvbiAoYnV0dG9ucykgewoJCXZhciBjb250YWluZXIgPSBMLkRvbVV0aWwuY3JlYXRlKCd1bCcsICdsZWFmbGV0LWRyYXctYWN0aW9ucycpLAoJCQlsID0gYnV0dG9ucy5sZW5ndGgsCgkJCWxpLCBidXR0b247CgoJCWZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7CgkJCWxpID0gTC5Eb21VdGlsLmNyZWF0ZSgnbGknLCAnJywgY29udGFpbmVyKTsKCgkJCWJ1dHRvbiA9IHRoaXMuX2NyZWF0ZUJ1dHRvbih7CgkJCQl0aXRsZTogYnV0dG9uc1tpXS50aXRsZSwKCQkJCXRleHQ6IGJ1dHRvbnNbaV0udGV4dCwKCQkJCWNvbnRhaW5lcjogbGksCgkJCQljYWxsYmFjazogYnV0dG9uc1tpXS5jYWxsYmFjaywKCQkJCWNvbnRleHQ6IGJ1dHRvbnNbaV0uY29udGV4dAoJCQl9KTsKCgkJCXRoaXMuX2FjdGlvbkJ1dHRvbnMucHVzaCh7CgkJCQlidXR0b246IGJ1dHRvbiwKCQkJCWNhbGxiYWNrOiBidXR0b25zW2ldLmNhbGxiYWNrCgkJCX0pOwoJCX0KCgkJcmV0dXJuIGNvbnRhaW5lcjsKCX0sCgoJX3Nob3dBY3Rpb25zVG9vbGJhcjogZnVuY3Rpb24gKCkgewoJCXZhciBidXR0b25JbmRleCA9IHRoaXMuX2FjdGl2ZU1vZGUuYnV0dG9uSW5kZXgsCgkJCWxhc3RCdXR0b25JbmRleCA9IHRoaXMuX2xhc3RCdXR0b25JbmRleCwKCQkJYnV0dG9uSGVpZ2h0ID0gMjYsIC8vIFRPRE86IHRoaXMgc2hvdWxkIGJlIGNhbGN1bGF0ZWQKCQkJYm9yZGVySGVpZ2h0ID0gMSwgLy8gVE9ETzogdGhpcyBzaG91bGQgYWxzbyBiZSBjYWxjdWxhdGVkCgkJCXRvb2xiYXJQb3NpdGlvbiA9IChidXR0b25JbmRleCAqIGJ1dHRvbkhlaWdodCkgKyAoYnV0dG9uSW5kZXggKiBib3JkZXJIZWlnaHQpIC0gMTsKCgkJLy8gQ29ycmVjdGx5IHBvc2l0aW9uIHRoZSBjYW5jZWwgYnV0dG9uCgkJdGhpcy5fYWN0aW9uc0NvbnRhaW5lci5zdHlsZS50b3AgPSB0b29sYmFyUG9zaXRpb24gKyAncHgnOwoKCQlpZiAoYnV0dG9uSW5kZXggPT09IDApIHsKCQkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX3Rvb2xiYXJDb250YWluZXIsICdsZWFmbGV0LWRyYXctdG9vbGJhci1ub3RvcCcpOwoJCQlMLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fYWN0aW9uc0NvbnRhaW5lciwgJ2xlYWZsZXQtZHJhdy1hY3Rpb25zLXRvcCcpOwoJCX0KCgkJaWYgKGJ1dHRvbkluZGV4ID09PSBsYXN0QnV0dG9uSW5kZXgpIHsKCQkJTC5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX3Rvb2xiYXJDb250YWluZXIsICdsZWFmbGV0LWRyYXctdG9vbGJhci1ub2JvdHRvbScpOwoJCQlMLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fYWN0aW9uc0NvbnRhaW5lciwgJ2xlYWZsZXQtZHJhdy1hY3Rpb25zLWJvdHRvbScpOwoJCX0KCgkJdGhpcy5fYWN0aW9uc0NvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKCX0sCgoJX2hpZGVBY3Rpb25zVG9vbGJhcjogZnVuY3Rpb24gKCkgewoJCXRoaXMuX2FjdGlvbnNDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCgkJTC5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX3Rvb2xiYXJDb250YWluZXIsICdsZWFmbGV0LWRyYXctdG9vbGJhci1ub3RvcCcpOwoJCUwuRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl90b29sYmFyQ29udGFpbmVyLCAnbGVhZmxldC1kcmF3LXRvb2xiYXItbm9ib3R0b20nKTsKCQlMLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fYWN0aW9uc0NvbnRhaW5lciwgJ2xlYWZsZXQtZHJhdy1hY3Rpb25zLXRvcCcpOwoJCUwuRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl9hY3Rpb25zQ29udGFpbmVyLCAnbGVhZmxldC1kcmF3LWFjdGlvbnMtYm90dG9tJyk7Cgl9Cn0pOwoKTC5Ub29sdGlwID0gTC5DbGFzcy5leHRlbmQoewoJaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG1hcCkgewoJCXRoaXMuX21hcCA9IG1hcDsKCQl0aGlzLl9wb3B1cFBhbmUgPSBtYXAuX3BhbmVzLnBvcHVwUGFuZTsKCgkJdGhpcy5fY29udGFpbmVyID0gTC5Eb21VdGlsLmNyZWF0ZSgnZGl2JywgJ2xlYWZsZXQtZHJhdy10b29sdGlwJywgdGhpcy5fcG9wdXBQYW5lKTsKCQl0aGlzLl9zaW5nbGVMaW5lTGFiZWwgPSBmYWxzZTsKCX0sCgoJZGlzcG9zZTogZnVuY3Rpb24gKCkgewoJCXRoaXMuX3BvcHVwUGFuZS5yZW1vdmVDaGlsZCh0aGlzLl9jb250YWluZXIpOwoJCXRoaXMuX2NvbnRhaW5lciA9IG51bGw7Cgl9LAoKCXVwZGF0ZUNvbnRlbnQ6IGZ1bmN0aW9uIChsYWJlbFRleHQpIHsKCQlsYWJlbFRleHQuc3VidGV4dCA9IGxhYmVsVGV4dC5zdWJ0ZXh0IHx8ICcnOwoKCQkvLyB1cGRhdGUgdGhlIHZlcnRpY2FsIHBvc2l0aW9uIChvbmx5IGlmIGNoYW5nZWQpCgkJaWYgKGxhYmVsVGV4dC5zdWJ0ZXh0Lmxlbmd0aCA9PT0gMCAmJiAhdGhpcy5fc2luZ2xlTGluZUxhYmVsKSB7CgkJCUwuRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl9jb250YWluZXIsICdsZWFmbGV0LWRyYXctdG9vbHRpcC1zaW5nbGUnKTsKCQkJdGhpcy5fc2luZ2xlTGluZUxhYmVsID0gdHJ1ZTsKCQl9CgkJZWxzZSBpZiAobGFiZWxUZXh0LnN1YnRleHQubGVuZ3RoID4gMCAmJiB0aGlzLl9zaW5nbGVMaW5lTGFiZWwpIHsKCQkJTC5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX2NvbnRhaW5lciwgJ2xlYWZsZXQtZHJhdy10b29sdGlwLXNpbmdsZScpOwoJCQl0aGlzLl9zaW5nbGVMaW5lTGFiZWwgPSBmYWxzZTsKCQl9CgoJCXRoaXMuX2NvbnRhaW5lci5pbm5lckhUTUwgPQoJCQkobGFiZWxUZXh0LnN1YnRleHQubGVuZ3RoID4gMCA/ICc8c3BhbiBjbGFzcz0ibGVhZmxldC1kcmF3LXRvb2x0aXAtc3VidGV4dCI+JyArIGxhYmVsVGV4dC5zdWJ0ZXh0ICsgJzwvc3Bhbj4nICsgJzxiciAvPicgOiAnJykgKwoJCQknPHNwYW4+JyArIGxhYmVsVGV4dC50ZXh0ICsgJzwvc3Bhbj4nOwoKCQlyZXR1cm4gdGhpczsKCX0sCgoJdXBkYXRlUG9zaXRpb246IGZ1bmN0aW9uIChsYXRsbmcpIHsKCQl2YXIgcG9zID0gdGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludChsYXRsbmcpOwoKCQlMLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fY29udGFpbmVyLCBwb3MpOwoKCQlyZXR1cm4gdGhpczsKCX0sCgoJc2hvd0FzRXJyb3I6IGZ1bmN0aW9uICgpIHsKCQlMLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fY29udGFpbmVyLCAnbGVhZmxldC1lcnJvci1kcmF3LXRvb2x0aXAnKTsKCQlyZXR1cm4gdGhpczsKCX0sCgoJcmVtb3ZlRXJyb3I6IGZ1bmN0aW9uICgpIHsKCQlMLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fY29udGFpbmVyLCAnbGVhZmxldC1lcnJvci1kcmF3LXRvb2x0aXAnKTsKCQlyZXR1cm4gdGhpczsKCX0KfSk7CgpMLkRyYXdUb29sYmFyID0gTC5Ub29sYmFyLmV4dGVuZCh7CgoJb3B0aW9uczogewoJCXBvbHlsaW5lOiB7fSwKCQlwb2x5Z29uOiB7fSwKCQlyZWN0YW5nbGU6IHt9LAoJCWNpcmNsZToge30sCgkJbWFya2VyOiB7fQoJfSwKCglpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewoJCS8vIEVuc3VyZSB0aGF0IHRoZSBvcHRpb25zIGFyZSBtZXJnZWQgY29ycmVjdGx5IHNpbmNlIEwuZXh0ZW5kIGlzIG9ubHkgc2hhbGxvdwoJCWZvciAodmFyIHR5cGUgaW4gdGhpcy5vcHRpb25zKSB7CgkJCWlmICh0aGlzLm9wdGlvbnMuaGFzT3duUHJvcGVydHkodHlwZSkpIHsKCQkJCWlmIChvcHRpb25zW3R5cGVdKSB7CgkJCQkJb3B0aW9uc1t0eXBlXSA9IEwuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnNbdHlwZV0sIG9wdGlvbnNbdHlwZV0pOwoJCQkJfQoJCQl9CgkJfQoKCQlMLlRvb2xiYXIucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBvcHRpb25zKTsKCX0sCgoJYWRkVG9vbGJhcjogZnVuY3Rpb24gKG1hcCkgewoJCXZhciBjb250YWluZXIgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCAnbGVhZmxldC1kcmF3LXNlY3Rpb24nKSwKCQkJYnV0dG9uSW5kZXggPSAwLAoJCQlidXR0b25DbGFzc1ByZWZpeCA9ICdsZWFmbGV0LWRyYXctZHJhdyc7CgoJCXRoaXMuX3Rvb2xiYXJDb250YWluZXIgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCAnbGVhZmxldC1kcmF3LXRvb2xiYXIgbGVhZmxldC1iYXInKTsKCgoJCWlmICh0aGlzLm9wdGlvbnMucG9seWxpbmUpIHsKCQkJdGhpcy5faW5pdE1vZGVIYW5kbGVyKAoJCQkJbmV3IEwuRHJhdy5Qb2x5bGluZShtYXAsIHRoaXMub3B0aW9ucy5wb2x5bGluZSksCgkJCQl0aGlzLl90b29sYmFyQ29udGFpbmVyLAoJCQkJYnV0dG9uSW5kZXgrKywKCQkJCWJ1dHRvbkNsYXNzUHJlZml4LAoJCQkJTC5kcmF3TG9jYWwuZHJhdy50b29sYmFyLmJ1dHRvbnMucG9seWxpbmUKCQkJKTsKCQl9CgoJCWlmICh0aGlzLm9wdGlvbnMucG9seWdvbikgewoJCQl0aGlzLl9pbml0TW9kZUhhbmRsZXIoCgkJCQluZXcgTC5EcmF3LlBvbHlnb24obWFwLCB0aGlzLm9wdGlvbnMucG9seWdvbiksCgkJCQl0aGlzLl90b29sYmFyQ29udGFpbmVyLAoJCQkJYnV0dG9uSW5kZXgrKywKCQkJCWJ1dHRvbkNsYXNzUHJlZml4LAoJCQkJTC5kcmF3TG9jYWwuZHJhdy50b29sYmFyLmJ1dHRvbnMucG9seWdvbgoJCQkpOwoJCX0KCgkJaWYgKHRoaXMub3B0aW9ucy5yZWN0YW5nbGUpIHsKCQkJdGhpcy5faW5pdE1vZGVIYW5kbGVyKAoJCQkJbmV3IEwuRHJhdy5SZWN0YW5nbGUobWFwLCB0aGlzLm9wdGlvbnMucmVjdGFuZ2xlKSwKCQkJCXRoaXMuX3Rvb2xiYXJDb250YWluZXIsCgkJCQlidXR0b25JbmRleCsrLAoJCQkJYnV0dG9uQ2xhc3NQcmVmaXgsCgkJCQlMLmRyYXdMb2NhbC5kcmF3LnRvb2xiYXIuYnV0dG9ucy5yZWN0YW5nbGUKCQkJKTsKCQl9CgoJCWlmICh0aGlzLm9wdGlvbnMuY2lyY2xlKSB7CgkJCXRoaXMuX2luaXRNb2RlSGFuZGxlcigKCQkJCW5ldyBMLkRyYXcuQ2lyY2xlKG1hcCwgdGhpcy5vcHRpb25zLmNpcmNsZSksCgkJCQl0aGlzLl90b29sYmFyQ29udGFpbmVyLAoJCQkJYnV0dG9uSW5kZXgrKywKCQkJCWJ1dHRvbkNsYXNzUHJlZml4LAoJCQkJTC5kcmF3TG9jYWwuZHJhdy50b29sYmFyLmJ1dHRvbnMuY2lyY2xlCgkJCSk7CgkJfQoKCQlpZiAodGhpcy5vcHRpb25zLm1hcmtlcikgewoJCQl0aGlzLl9pbml0TW9kZUhhbmRsZXIoCgkJCQluZXcgTC5EcmF3Lk1hcmtlcihtYXAsIHRoaXMub3B0aW9ucy5tYXJrZXIpLAoJCQkJdGhpcy5fdG9vbGJhckNvbnRhaW5lciwKCQkJCWJ1dHRvbkluZGV4KyssCgkJCQlidXR0b25DbGFzc1ByZWZpeCwKCQkJCUwuZHJhd0xvY2FsLmRyYXcudG9vbGJhci5idXR0b25zLm1hcmtlcgoJCQkpOwoJCX0KCgkJLy8gU2F2ZSBidXR0b24gaW5kZXggb2YgdGhlIGxhc3QgYnV0dG9uLCAtMSBhcyB3ZSB3b3VsZCBoYXZlICsrIGFmdGVyIHRoZSBsYXN0IGJ1dHRvbgoJCXRoaXMuX2xhc3RCdXR0b25JbmRleCA9IC0tYnV0dG9uSW5kZXg7CgoJCS8vIENyZWF0ZSB0aGUgYWN0aW9ucyBwYXJ0IG9mIHRoZSB0b29sYmFyCgkJdGhpcy5fYWN0aW9uc0NvbnRhaW5lciA9IHRoaXMuX2NyZWF0ZUFjdGlvbnMoWwoJCQl7CgkJCQl0aXRsZTogTC5kcmF3TG9jYWwuZHJhdy50b29sYmFyLmFjdGlvbnMudGl0bGUsCgkJCQl0ZXh0OiBMLmRyYXdMb2NhbC5kcmF3LnRvb2xiYXIuYWN0aW9ucy50ZXh0LAoJCQkJY2FsbGJhY2s6IHRoaXMuZGlzYWJsZSwKCQkJCWNvbnRleHQ6IHRoaXMKCQkJfQoJCV0pOwoKCQkvLyBBZGQgZHJhdyBhbmQgY2FuY2VsIGNvbnRhaW5lcnMgdG8gdGhlIGNvbnRyb2wgY29udGFpbmVyCgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuX3Rvb2xiYXJDb250YWluZXIpOwoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9hY3Rpb25zQ29udGFpbmVyKTsKCgkJcmV0dXJuIGNvbnRhaW5lcjsKCX0sCgoJc2V0T3B0aW9uczogZnVuY3Rpb24gKG9wdGlvbnMpIHsKCQlMLnNldE9wdGlvbnModGhpcywgb3B0aW9ucyk7CgoJCWZvciAodmFyIHR5cGUgaW4gdGhpcy5fbW9kZXMpIHsKCQkJaWYgKHRoaXMuX21vZGVzLmhhc093blByb3BlcnR5KHR5cGUpICYmIG9wdGlvbnMuaGFzT3duUHJvcGVydHkodHlwZSkpIHsKCQkJCXRoaXMuX21vZGVzW3R5cGVdLmhhbmRsZXIuc2V0T3B0aW9ucyhvcHRpb25zW3R5cGVdKTsKCQkJfQoJCX0KCX0KfSk7CgovKkwuTWFwLm1lcmdlT3B0aW9ucyh7CgllZGl0Q29udHJvbDogdHJ1ZQp9KTsqLwoKTC5FZGl0VG9vbGJhciA9IEwuVG9vbGJhci5leHRlbmQoewoJb3B0aW9uczogewoJCWVkaXQ6IHsKCQkJc2VsZWN0ZWRQYXRoT3B0aW9uczogewoJCQkJY29sb3I6ICcjZmU1N2ExJywgLyogSG90IHBpbmsgYWxsIHRoZSB0aGluZ3MhICovCgkJCQlvcGFjaXR5OiAwLjYsCgkJCQlkYXNoQXJyYXk6ICcxMCwgMTAnLAoKCQkJCWZpbGw6IHRydWUsCgkJCQlmaWxsQ29sb3I6ICcjZmU1N2ExJywKCQkJCWZpbGxPcGFjaXR5OiAwLjEKCQkJfQoJCX0sCgkJcmVtb3ZlOiB7fSwKCQlmZWF0dXJlR3JvdXA6IG51bGwgLyogUkVRVUlSRUQhIFRPRE86IHBlcmhhcHMgaWYgbm90IHNldCB0aGVuIGFsbCBsYXllcnMgb24gdGhlIG1hcCBhcmUgc2VsZWN0YWJsZT8gKi8KCX0sCgoJaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsKCQkvLyBOZWVkIHRvIHNldCB0aGlzIG1hbnVhbGx5IHNpbmNlIG51bGwgaXMgYW4gYWNjZXB0YWJsZSB2YWx1ZSBoZXJlCgkJaWYgKG9wdGlvbnMuZWRpdCkgewoJCQlpZiAodHlwZW9mIG9wdGlvbnMuZWRpdC5zZWxlY3RlZFBhdGhPcHRpb25zID09PSAndW5kZWZpbmVkJykgewoJCQkJb3B0aW9ucy5lZGl0LnNlbGVjdGVkUGF0aE9wdGlvbnMgPSB0aGlzLm9wdGlvbnMuZWRpdC5zZWxlY3RlZFBhdGhPcHRpb25zOwoJCQl9CgkJCW9wdGlvbnMuZWRpdCA9IEwuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMuZWRpdCwgb3B0aW9ucy5lZGl0KTsKCQl9CgoJCWlmIChvcHRpb25zLnJlbW92ZSkgewoJCQlvcHRpb25zLnJlbW92ZSA9IEwuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMucmVtb3ZlLCBvcHRpb25zLnJlbW92ZSk7CgkJfQoKCQlMLlRvb2xiYXIucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBvcHRpb25zKTsKCgkJdGhpcy5fc2VsZWN0ZWRGZWF0dXJlQ291bnQgPSAwOwoJfSwKCglhZGRUb29sYmFyOiBmdW5jdGlvbiAobWFwKSB7CgkJdmFyIGNvbnRhaW5lciA9IEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsICdsZWFmbGV0LWRyYXctc2VjdGlvbicpLAoJCQlidXR0b25JbmRleCA9IDAsCgkJCWJ1dHRvbkNsYXNzUHJlZml4ID0gJ2xlYWZsZXQtZHJhdy1lZGl0JzsKCgkJdGhpcy5fdG9vbGJhckNvbnRhaW5lciA9IEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsICdsZWFmbGV0LWRyYXctdG9vbGJhciBsZWFmbGV0LWJhcicpOwoKCQl0aGlzLl9tYXAgPSBtYXA7CgoJCWlmICh0aGlzLm9wdGlvbnMuZWRpdCkgewoJCQl0aGlzLl9pbml0TW9kZUhhbmRsZXIoCgkJCQluZXcgTC5FZGl0VG9vbGJhci5FZGl0KG1hcCwgewoJCQkJCWZlYXR1cmVHcm91cDogdGhpcy5vcHRpb25zLmZlYXR1cmVHcm91cCwKCQkJCQlzZWxlY3RlZFBhdGhPcHRpb25zOiB0aGlzLm9wdGlvbnMuZWRpdC5zZWxlY3RlZFBhdGhPcHRpb25zCgkJCQl9KSwKCQkJCXRoaXMuX3Rvb2xiYXJDb250YWluZXIsCgkJCQlidXR0b25JbmRleCsrLAoJCQkJYnV0dG9uQ2xhc3NQcmVmaXgsCgkJCQlMLmRyYXdMb2NhbC5lZGl0LnRvb2xiYXIuYnV0dG9ucy5lZGl0CgkJCSk7CgkJfQoKCQlpZiAodGhpcy5vcHRpb25zLnJlbW92ZSkgewoJCQl0aGlzLl9pbml0TW9kZUhhbmRsZXIoCgkJCQluZXcgTC5FZGl0VG9vbGJhci5EZWxldGUobWFwLCB7CgkJCQkJZmVhdHVyZUdyb3VwOiB0aGlzLm9wdGlvbnMuZmVhdHVyZUdyb3VwCgkJCQl9KSwKCQkJCXRoaXMuX3Rvb2xiYXJDb250YWluZXIsCgkJCQlidXR0b25JbmRleCsrLAoJCQkJYnV0dG9uQ2xhc3NQcmVmaXgsCgkJCQlMLmRyYXdMb2NhbC5lZGl0LnRvb2xiYXIuYnV0dG9ucy5yZW1vdmUKCQkJKTsKCQl9CgoJCS8vIFNhdmUgYnV0dG9uIGluZGV4IG9mIHRoZSBsYXN0IGJ1dHRvbiwgLTEgYXMgd2Ugd291bGQgaGF2ZSArKyBhZnRlciB0aGUgbGFzdCBidXR0b24KCQl0aGlzLl9sYXN0QnV0dG9uSW5kZXggPSAtLWJ1dHRvbkluZGV4OwoKCQkvLyBDcmVhdGUgdGhlIGFjdGlvbnMgcGFydCBvZiB0aGUgdG9vbGJhcgoJCXRoaXMuX2FjdGlvbnNDb250YWluZXIgPSB0aGlzLl9jcmVhdGVBY3Rpb25zKFsKCQkJewoJCQkJdGl0bGU6IEwuZHJhd0xvY2FsLmVkaXQudG9vbGJhci5hY3Rpb25zLnNhdmUudGl0bGUsCgkJCQl0ZXh0OiBMLmRyYXdMb2NhbC5lZGl0LnRvb2xiYXIuYWN0aW9ucy5zYXZlLnRleHQsCgkJCQljYWxsYmFjazogdGhpcy5fc2F2ZSwKCQkJCWNvbnRleHQ6IHRoaXMKCQkJfSwKCQkJewoJCQkJdGl0bGU6IEwuZHJhd0xvY2FsLmVkaXQudG9vbGJhci5hY3Rpb25zLmNhbmNlbC50aXRsZSwKCQkJCXRleHQ6IEwuZHJhd0xvY2FsLmVkaXQudG9vbGJhci5hY3Rpb25zLmNhbmNlbC50ZXh0LAoJCQkJY2FsbGJhY2s6IHRoaXMuZGlzYWJsZSwKCQkJCWNvbnRleHQ6IHRoaXMKCQkJfQoJCV0pOwoKCQkvLyBBZGQgZHJhdyBhbmQgY2FuY2VsIGNvbnRhaW5lcnMgdG8gdGhlIGNvbnRyb2wgY29udGFpbmVyCgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuX3Rvb2xiYXJDb250YWluZXIpOwoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9hY3Rpb25zQ29udGFpbmVyKTsKCgkJcmV0dXJuIGNvbnRhaW5lcjsKCX0sCgoJZGlzYWJsZTogZnVuY3Rpb24gKCkgewoJCWlmICghdGhpcy5lbmFibGVkKCkpIHsgcmV0dXJuOyB9CgoJCXRoaXMuX2FjdGl2ZU1vZGUuaGFuZGxlci5yZXZlcnRMYXllcnMoKTsKCgkJTC5Ub29sYmFyLnByb3RvdHlwZS5kaXNhYmxlLmNhbGwodGhpcyk7Cgl9LAoKCV9zYXZlOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fYWN0aXZlTW9kZS5oYW5kbGVyLnNhdmUoKTsKCQl0aGlzLl9hY3RpdmVNb2RlLmhhbmRsZXIuZGlzYWJsZSgpOwoJfQp9KTsKCkwuRWRpdFRvb2xiYXIuRWRpdCA9IEwuSGFuZGxlci5leHRlbmQoewoJc3RhdGljczogewoJCVRZUEU6ICdlZGl0JwoJfSwKCglpbmNsdWRlczogTC5NaXhpbi5FdmVudHMsCgoJaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG1hcCwgb3B0aW9ucykgewoJCUwuSGFuZGxlci5wcm90b3R5cGUuaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG1hcCk7CgoJCS8vIFNldCBvcHRpb25zIHRvIHRoZSBkZWZhdWx0IHVubGVzcyBhbHJlYWR5IHNldAoJCXRoaXMuX3NlbGVjdGVkUGF0aE9wdGlvbnMgPSBvcHRpb25zLnNlbGVjdGVkUGF0aE9wdGlvbnM7CgoJCS8vIFN0b3JlIHRoZSBzZWxlY3RhYmxlIGxheWVyIGdyb3VwIGZvciBlYXNlIG9mIGFjY2VzcwoJCXRoaXMuX2ZlYXR1cmVHcm91cCA9IG9wdGlvbnMuZmVhdHVyZUdyb3VwOwoKCQlpZiAoISh0aGlzLl9mZWF0dXJlR3JvdXAgaW5zdGFuY2VvZiBMLkZlYXR1cmVHcm91cCkpIHsKCQkJdGhyb3cgbmV3IEVycm9yKCdvcHRpb25zLmZlYXR1cmVHcm91cCBtdXN0IGJlIGEgTC5GZWF0dXJlR3JvdXAnKTsKCQl9CgoJCXRoaXMuX3VuZWRpdGVkTGF5ZXJQcm9wcyA9IHt9OwoKCQkvLyBTYXZlIHRoZSB0eXBlIHNvIHN1cGVyIGNhbiBmaXJlLCBuZWVkIHRvIGRvIHRoaXMgYXMgY2Fubm90IGRvIHRoaXMuVFlQRSA6KAoJCXRoaXMudHlwZSA9IEwuRWRpdFRvb2xiYXIuRWRpdC5UWVBFOwoJfSwKCgllbmFibGU6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fZW5hYmxlZCkgeyByZXR1cm47IH0KCgkJTC5IYW5kbGVyLnByb3RvdHlwZS5lbmFibGUuY2FsbCh0aGlzKTsKCgkJdGhpcy5fZmVhdHVyZUdyb3VwCgkJCS5vbignbGF5ZXJhZGQnLCB0aGlzLl9lbmFibGVMYXllckVkaXQsIHRoaXMpCgkJCS5vbignbGF5ZXJyZW1vdmUnLCB0aGlzLl9kaXNhYmxlTGF5ZXJFZGl0LCB0aGlzKTsKCgkJdGhpcy5maXJlKCdlbmFibGVkJywge2hhbmRsZXI6IHRoaXMudHlwZX0pOwoJCXRoaXMuX21hcC5maXJlKCdkcmF3OmVkaXRzdGFydCcsIHsgaGFuZGxlcjogdGhpcy50eXBlIH0pOwoJfSwKCglkaXNhYmxlOiBmdW5jdGlvbiAoKSB7CgkJaWYgKCF0aGlzLl9lbmFibGVkKSB7IHJldHVybjsgfQoKCQl0aGlzLmZpcmUoJ2Rpc2FibGVkJywge2hhbmRsZXI6IHRoaXMudHlwZX0pOwoJCXRoaXMuX21hcC5maXJlKCdkcmF3OmVkaXRzdG9wJywgeyBoYW5kbGVyOiB0aGlzLnR5cGUgfSk7CgoJCXRoaXMuX2ZlYXR1cmVHcm91cAoJCQkub2ZmKCdsYXllcmFkZCcsIHRoaXMuX2VuYWJsZUxheWVyRWRpdCwgdGhpcykKCQkJLm9mZignbGF5ZXJyZW1vdmUnLCB0aGlzLl9kaXNhYmxlTGF5ZXJFZGl0LCB0aGlzKTsKCgkJTC5IYW5kbGVyLnByb3RvdHlwZS5kaXNhYmxlLmNhbGwodGhpcyk7Cgl9LAoKCWFkZEhvb2tzOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX21hcCkgewoJCQl0aGlzLl9mZWF0dXJlR3JvdXAuZWFjaExheWVyKHRoaXMuX2VuYWJsZUxheWVyRWRpdCwgdGhpcyk7CgoJCQl0aGlzLl90b29sdGlwID0gbmV3IEwuVG9vbHRpcCh0aGlzLl9tYXApOwoJCQl0aGlzLl90b29sdGlwLnVwZGF0ZUNvbnRlbnQoewoJCQkJdGV4dDogTC5kcmF3TG9jYWwuZWRpdC5oYW5kbGVycy5lZGl0LnRvb2x0aXAudGV4dCwKCQkJCXN1YnRleHQ6IEwuZHJhd0xvY2FsLmVkaXQuaGFuZGxlcnMuZWRpdC50b29sdGlwLnN1YnRleHQKCQkJfSk7CgoJCQl0aGlzLl9tYXAub24oJ21vdXNlbW92ZScsIHRoaXMuX29uTW91c2VNb3ZlLCB0aGlzKTsKCQl9Cgl9LAoKCXJlbW92ZUhvb2tzOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX21hcCkgewoJCQkvLyBDbGVhbiB1cCBzZWxlY3RlZCBsYXllcnMuCgkJCXRoaXMuX2ZlYXR1cmVHcm91cC5lYWNoTGF5ZXIodGhpcy5fZGlzYWJsZUxheWVyRWRpdCwgdGhpcyk7CgoJCQkvLyBDbGVhciB0aGUgYmFja3VwcyBvZiB0aGUgb3JpZ2luYWwgbGF5ZXJzCgkJCXRoaXMuX3VuZWRpdGVkTGF5ZXJQcm9wcyA9IHt9OwoKCQkJdGhpcy5fdG9vbHRpcC5kaXNwb3NlKCk7CgkJCXRoaXMuX3Rvb2x0aXAgPSBudWxsOwoKCQkJdGhpcy5fbWFwLm9mZignbW91c2Vtb3ZlJywgdGhpcy5fb25Nb3VzZU1vdmUsIHRoaXMpOwoJCX0KCX0sCgoJcmV2ZXJ0TGF5ZXJzOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5fZmVhdHVyZUdyb3VwLmVhY2hMYXllcihmdW5jdGlvbiAobGF5ZXIpIHsKCQkJdGhpcy5fcmV2ZXJ0TGF5ZXIobGF5ZXIpOwoJCX0sIHRoaXMpOwoJfSwKCglzYXZlOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGVkaXRlZExheWVycyA9IG5ldyBMLkxheWVyR3JvdXAoKTsKCQl0aGlzLl9mZWF0dXJlR3JvdXAuZWFjaExheWVyKGZ1bmN0aW9uIChsYXllcikgewoJCQlpZiAobGF5ZXIuZWRpdGVkKSB7CgkJCQllZGl0ZWRMYXllcnMuYWRkTGF5ZXIobGF5ZXIpOwoJCQkJbGF5ZXIuZWRpdGVkID0gZmFsc2U7CgkJCX0KCQl9KTsKCQl0aGlzLl9tYXAuZmlyZSgnZHJhdzplZGl0ZWQnLCB7bGF5ZXJzOiBlZGl0ZWRMYXllcnN9KTsKCX0sCgoJX2JhY2t1cExheWVyOiBmdW5jdGlvbiAobGF5ZXIpIHsKCQl2YXIgaWQgPSBMLlV0aWwuc3RhbXAobGF5ZXIpOwoKCQlpZiAoIXRoaXMuX3VuZWRpdGVkTGF5ZXJQcm9wc1tpZF0pIHsKCQkJaWYgKGxheWVyIGluc3RhbmNlb2YgTC5HZW9kZXNpY0NpcmNsZSB8fCBsYXllciBpbnN0YW5jZW9mIEwuQ2lyY2xlKSB7CgkJCQl0aGlzLl91bmVkaXRlZExheWVyUHJvcHNbaWRdID0gewoJCQkJCWxhdGxuZzogTC5MYXRMbmdVdGlsLmNsb25lTGF0TG5nKGxheWVyLmdldExhdExuZygpKSwKCQkJCQlyYWRpdXM6IGxheWVyLmdldFJhZGl1cygpCgkJCQl9OwoJCQl9IGVsc2UgaWYgKGxheWVyIGluc3RhbmNlb2YgTC5HZW9kZXNpY1BvbHlsaW5lIHx8IGxheWVyIGluc3RhbmNlb2YgTC5HZW9kZXNpY1BvbHlnb24gfHwgbGF5ZXIgaW5zdGFuY2VvZiBMLlJlY3RhbmdsZSkgewoJCQkJLy8gUG9seWxpbmUsIFBvbHlnb24gb3IgUmVjdGFuZ2xlCgkJCQl0aGlzLl91bmVkaXRlZExheWVyUHJvcHNbaWRdID0gewoJCQkJCWxhdGxuZ3M6IEwuTGF0TG5nVXRpbC5jbG9uZUxhdExuZ3MobGF5ZXIuZ2V0TGF0TG5ncygpKQoJCQkJfTsKCQkJfSBlbHNlIHsgLy8gTWFya2VyCgkJCQl0aGlzLl91bmVkaXRlZExheWVyUHJvcHNbaWRdID0gewoJCQkJCWxhdGxuZzogTC5MYXRMbmdVdGlsLmNsb25lTGF0TG5nKGxheWVyLmdldExhdExuZygpKQoJCQkJfTsKCQkJfQoJCX0KCX0sCgoJX3JldmVydExheWVyOiBmdW5jdGlvbiAobGF5ZXIpIHsKCQl2YXIgaWQgPSBMLlV0aWwuc3RhbXAobGF5ZXIpOwoJCWxheWVyLmVkaXRlZCA9IGZhbHNlOwoJCWlmICh0aGlzLl91bmVkaXRlZExheWVyUHJvcHMuaGFzT3duUHJvcGVydHkoaWQpKSB7CgkJCWlmIChsYXllciBpbnN0YW5jZW9mIEwuR2VvZGVzaWNDaXJjbGUgfHwgbGF5ZXIgaW5zdGFuY2VvZiBMLkNpcmNsZSkgewoJCQkJbGF5ZXIuc2V0TGF0TG5nKHRoaXMuX3VuZWRpdGVkTGF5ZXJQcm9wc1tpZF0ubGF0bG5nKTsKCQkJCWxheWVyLnNldFJhZGl1cyh0aGlzLl91bmVkaXRlZExheWVyUHJvcHNbaWRdLnJhZGl1cyk7CgkJCX0gZWxzZSBpZiAobGF5ZXIgaW5zdGFuY2VvZiBMLkdlb2Rlc2ljUG9seWxpbmUgfHwgbGF5ZXIgaW5zdGFuY2VvZiBMLkdlb2Rlc2ljUG9seWdvbiB8fCBsYXllciBpbnN0YW5jZW9mIEwuUmVjdGFuZ2xlKSB7CgkJCQkvLyBQb2x5bGluZSwgUG9seWdvbiBvciBSZWN0YW5nbGUKCQkJCWxheWVyLnNldExhdExuZ3ModGhpcy5fdW5lZGl0ZWRMYXllclByb3BzW2lkXS5sYXRsbmdzKTsKCQkJfSBlbHNlIHsgLy8gTWFya2VyCgkJCQlsYXllci5zZXRMYXRMbmcodGhpcy5fdW5lZGl0ZWRMYXllclByb3BzW2lkXS5sYXRsbmcpOwoJCQl9CgkJfQoJfSwKCglfdG9nZ2xlTWFya2VySGlnaGxpZ2h0OiBmdW5jdGlvbiAobWFya2VyKSB7CgkJaWYgKCFtYXJrZXIuX2ljb24pIHsKCQkJcmV0dXJuOwoJCX0KCQkvLyBUaGlzIGlzIHF1aXRlIG5hdWdodHksIGJ1dCBJIGRvbid0IHNlZSBhbm90aGVyIHdheSBvZiBkb2luZyBpdC4gKHNob3J0IG9mIHNldHRpbmcgYSBuZXcgaWNvbikKCQl2YXIgaWNvbiA9IG1hcmtlci5faWNvbjsKCgkJaWNvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKCQlpZiAoTC5Eb21VdGlsLmhhc0NsYXNzKGljb24sICdsZWFmbGV0LWVkaXQtbWFya2VyLXNlbGVjdGVkJykpIHsKCQkJTC5Eb21VdGlsLnJlbW92ZUNsYXNzKGljb24sICdsZWFmbGV0LWVkaXQtbWFya2VyLXNlbGVjdGVkJyk7CgkJCS8vIE9mZnNldCBhcyB0aGUgYm9yZGVyIHdpbGwgbWFrZSB0aGUgaWNvbiBtb3ZlLgoJCQl0aGlzLl9vZmZzZXRNYXJrZXIoaWNvbiwgLTQpOwoKCQl9IGVsc2UgewoJCQlMLkRvbVV0aWwuYWRkQ2xhc3MoaWNvbiwgJ2xlYWZsZXQtZWRpdC1tYXJrZXItc2VsZWN0ZWQnKTsKCQkJLy8gT2Zmc2V0IGFzIHRoZSBib3JkZXIgd2lsbCBtYWtlIHRoZSBpY29uIG1vdmUuCgkJCXRoaXMuX29mZnNldE1hcmtlcihpY29uLCA0KTsKCQl9CgoJCWljb24uc3R5bGUuZGlzcGxheSA9ICcnOwoJfSwKCglfb2Zmc2V0TWFya2VyOiBmdW5jdGlvbiAoaWNvbiwgb2Zmc2V0KSB7CgkJdmFyIGljb25NYXJnaW5Ub3AgPSBwYXJzZUludChpY29uLnN0eWxlLm1hcmdpblRvcCwgMTApIC0gb2Zmc2V0LAoJCQlpY29uTWFyZ2luTGVmdCA9IHBhcnNlSW50KGljb24uc3R5bGUubWFyZ2luTGVmdCwgMTApIC0gb2Zmc2V0OwoKCQlpY29uLnN0eWxlLm1hcmdpblRvcCA9IGljb25NYXJnaW5Ub3AgKyAncHgnOwoJCWljb24uc3R5bGUubWFyZ2luTGVmdCA9IGljb25NYXJnaW5MZWZ0ICsgJ3B4JzsKCX0sCgoJX2VuYWJsZUxheWVyRWRpdDogZnVuY3Rpb24gKGUpIHsKCQl2YXIgbGF5ZXIgPSBlLmxheWVyIHx8IGUudGFyZ2V0IHx8IGUsCgkJCWlzTWFya2VyID0gbGF5ZXIgaW5zdGFuY2VvZiBMLk1hcmtlciwKCQkJcGF0aE9wdGlvbnM7CgoJCS8vIERvbid0IGRvIGFueXRoaW5nIGlmIHRoaXMgbGF5ZXIgaXMgYSBtYXJrZXIgYnV0IGRvZXNuJ3QgaGF2ZSBhbiBpY29uLiBNYXJrZXJzCgkJLy8gc2hvdWxkIHVzdWFsbHkgaGF2ZSBpY29ucy4gSWYgdXNpbmcgTGVhZmxldC5kcmF3IHdpdGggTGVhZmxldC5tYXJrZXJjbHVzdGVyIHRoZXJlCgkJLy8gaXMgYSBjaGFuY2UgdGhhdCBhIG1hcmtlciBkb2Vzbid0LgoJCWlmIChpc01hcmtlciAmJiAhbGF5ZXIuX2ljb24pIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gQmFjayB1cCB0aGlzIGxheWVyIChpZiBoYXZlbid0IGJlZm9yZSkKCQl0aGlzLl9iYWNrdXBMYXllcihsYXllcik7CgoJCS8vIFVwZGF0ZSBsYXllciBzdHlsZSBzbyBhcHBlYXJzIGVkaXRhYmxlCgkJaWYgKHRoaXMuX3NlbGVjdGVkUGF0aE9wdGlvbnMpIHsKCQkJcGF0aE9wdGlvbnMgPSBMLlV0aWwuZXh0ZW5kKHt9LCB0aGlzLl9zZWxlY3RlZFBhdGhPcHRpb25zKTsKCgkJCWlmIChpc01hcmtlcikgewoJCQkJdGhpcy5fdG9nZ2xlTWFya2VySGlnaGxpZ2h0KGxheWVyKTsKCQkJfSBlbHNlIHsKCQkJCWxheWVyLm9wdGlvbnMucHJldmlvdXNPcHRpb25zID0gbGF5ZXIub3B0aW9uczsKCgkJCQkvLyBNYWtlIHN1cmUgdGhhdCBQb2x5bGluZXMgYXJlIG5vdCBmaWxsZWQKCQkJCWlmICghKGxheWVyIGluc3RhbmNlb2YgTC5DaXJjbGUpICYmICEobGF5ZXIgaW5zdGFuY2VvZiBMLkdlb2Rlc2ljQ2lyY2xlKSAmJiAhKGxheWVyIGluc3RhbmNlb2YgTC5HZW9kZXNpY1BvbHlnb24pICYmICEobGF5ZXIgaW5zdGFuY2VvZiBMLlJlY3RhbmdsZSkpIHsKCQkJCQlwYXRoT3B0aW9ucy5maWxsID0gZmFsc2U7CgkJCQl9CgoJCQkJbGF5ZXIuc2V0U3R5bGUocGF0aE9wdGlvbnMpOwoJCQl9CgkJfQoKCQlpZiAoaXNNYXJrZXIpIHsKCQkJbGF5ZXIuZHJhZ2dpbmcuZW5hYmxlKCk7CgkJCWxheWVyLm9uKCdkcmFnZW5kJywgdGhpcy5fb25NYXJrZXJEcmFnRW5kKTsKCQl9IGVsc2UgewoJCQlsYXllci5lZGl0aW5nLmVuYWJsZSgpOwoJCX0KCX0sCgoJX2Rpc2FibGVMYXllckVkaXQ6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIGxheWVyID0gZS5sYXllciB8fCBlLnRhcmdldCB8fCBlOwoJCWxheWVyLmVkaXRlZCA9IGZhbHNlOwoKCQkvLyBSZXNldCBsYXllciBzdHlsZXMgdG8gdGhhdCBvZiBiZWZvcmUgc2VsZWN0CgkJaWYgKHRoaXMuX3NlbGVjdGVkUGF0aE9wdGlvbnMpIHsKCQkJaWYgKGxheWVyIGluc3RhbmNlb2YgTC5NYXJrZXIpIHsKCQkJCXRoaXMuX3RvZ2dsZU1hcmtlckhpZ2hsaWdodChsYXllcik7CgkJCX0gZWxzZSB7CgkJCQkvLyByZXNldCB0aGUgbGF5ZXIgc3R5bGUgdG8gd2hhdCBpcyB3YXMgYmVmb3JlIGJlaW5nIHNlbGVjdGVkCgkJCQlsYXllci5zZXRTdHlsZShsYXllci5vcHRpb25zLnByZXZpb3VzT3B0aW9ucyk7CgkJCQkvLyByZW1vdmUgdGhlIGNhY2hlZCBvcHRpb25zIGZvciB0aGUgbGF5ZXIgb2JqZWN0CgkJCQlkZWxldGUgbGF5ZXIub3B0aW9ucy5wcmV2aW91c09wdGlvbnM7CgkJCX0KCQl9CgoJCWlmIChsYXllciBpbnN0YW5jZW9mIEwuTWFya2VyKSB7CgkJCWxheWVyLmRyYWdnaW5nLmRpc2FibGUoKTsKCQkJbGF5ZXIub2ZmKCdkcmFnZW5kJywgdGhpcy5fb25NYXJrZXJEcmFnRW5kLCB0aGlzKTsKCQl9IGVsc2UgewoJCQlsYXllci5lZGl0aW5nLmRpc2FibGUoKTsKCQl9Cgl9LAoKCV9vbk1hcmtlckRyYWdFbmQ6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIGxheWVyID0gZS50YXJnZXQ7CgkJbGF5ZXIuZWRpdGVkID0gdHJ1ZTsKCX0sCgoJX29uTW91c2VNb3ZlOiBmdW5jdGlvbiAoZSkgewoJCXRoaXMuX3Rvb2x0aXAudXBkYXRlUG9zaXRpb24oZS5sYXRsbmcpOwoJfQp9KTsKCgpMLkVkaXRUb29sYmFyLkRlbGV0ZSA9IEwuSGFuZGxlci5leHRlbmQoewoJc3RhdGljczogewoJCVRZUEU6ICdyZW1vdmUnIC8vIG5vdCBkZWxldGUgYXMgZGVsZXRlIGlzIHJlc2VydmVkIGluIGpzCgl9LAoKCWluY2x1ZGVzOiBMLk1peGluLkV2ZW50cywKCglpbml0aWFsaXplOiBmdW5jdGlvbiAobWFwLCBvcHRpb25zKSB7CgkJTC5IYW5kbGVyLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcywgbWFwKTsKCgkJTC5VdGlsLnNldE9wdGlvbnModGhpcywgb3B0aW9ucyk7CgoJCS8vIFN0b3JlIHRoZSBzZWxlY3RhYmxlIGxheWVyIGdyb3VwIGZvciBlYXNlIG9mIGFjY2VzcwoJCXRoaXMuX2RlbGV0YWJsZUxheWVycyA9IHRoaXMub3B0aW9ucy5mZWF0dXJlR3JvdXA7CgoJCWlmICghKHRoaXMuX2RlbGV0YWJsZUxheWVycyBpbnN0YW5jZW9mIEwuRmVhdHVyZUdyb3VwKSkgewoJCQl0aHJvdyBuZXcgRXJyb3IoJ29wdGlvbnMuZmVhdHVyZUdyb3VwIG11c3QgYmUgYSBMLkZlYXR1cmVHcm91cCcpOwoJCX0KCgkJLy8gU2F2ZSB0aGUgdHlwZSBzbyBzdXBlciBjYW4gZmlyZSwgbmVlZCB0byBkbyB0aGlzIGFzIGNhbm5vdCBkbyB0aGlzLlRZUEUgOigKCQl0aGlzLnR5cGUgPSBMLkVkaXRUb29sYmFyLkRlbGV0ZS5UWVBFOwoJfSwKCgllbmFibGU6IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fZW5hYmxlZCkgeyByZXR1cm47IH0KCgkJTC5IYW5kbGVyLnByb3RvdHlwZS5lbmFibGUuY2FsbCh0aGlzKTsKCgkJdGhpcy5fZGVsZXRhYmxlTGF5ZXJzCgkJCS5vbignbGF5ZXJhZGQnLCB0aGlzLl9lbmFibGVMYXllckRlbGV0ZSwgdGhpcykKCQkJLm9uKCdsYXllcnJlbW92ZScsIHRoaXMuX2Rpc2FibGVMYXllckRlbGV0ZSwgdGhpcyk7CgoJCXRoaXMuZmlyZSgnZW5hYmxlZCcsIHsgaGFuZGxlcjogdGhpcy50eXBlfSk7CgkJdGhpcy5fbWFwLmZpcmUoJ2RyYXc6ZWRpdHN0YXJ0JywgeyBoYW5kbGVyOiB0aGlzLnR5cGUgfSk7Cgl9LAoKCWRpc2FibGU6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIXRoaXMuX2VuYWJsZWQpIHsgcmV0dXJuOyB9CgoJCUwuSGFuZGxlci5wcm90b3R5cGUuZGlzYWJsZS5jYWxsKHRoaXMpOwoKCQl0aGlzLl9kZWxldGFibGVMYXllcnMKCQkJLm9mZignbGF5ZXJhZGQnLCB0aGlzLl9lbmFibGVMYXllckRlbGV0ZSwgdGhpcykKCQkJLm9mZignbGF5ZXJyZW1vdmUnLCB0aGlzLl9kaXNhYmxlTGF5ZXJEZWxldGUsIHRoaXMpOwoKCQl0aGlzLmZpcmUoJ2Rpc2FibGVkJywgeyBoYW5kbGVyOiB0aGlzLnR5cGV9KTsKCQl0aGlzLl9tYXAuZmlyZSgnZHJhdzplZGl0c3RvcCcsIHsgaGFuZGxlcjogdGhpcy50eXBlIH0pOwoJfSwKCglhZGRIb29rczogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLl9tYXApIHsKCQkJdGhpcy5fZGVsZXRhYmxlTGF5ZXJzLmVhY2hMYXllcih0aGlzLl9lbmFibGVMYXllckRlbGV0ZSwgdGhpcyk7CgkJCXRoaXMuX2RlbGV0ZWRMYXllcnMgPSBuZXcgTC5sYXllckdyb3VwKCk7CgoJCQl0aGlzLl90b29sdGlwID0gbmV3IEwuVG9vbHRpcCh0aGlzLl9tYXApOwoJCQl0aGlzLl90b29sdGlwLnVwZGF0ZUNvbnRlbnQoeyB0ZXh0OiBMLmRyYXdMb2NhbC5lZGl0LmhhbmRsZXJzLnJlbW92ZS50b29sdGlwLnRleHQgfSk7CgoJCQl0aGlzLl9tYXAub24oJ21vdXNlbW92ZScsIHRoaXMuX29uTW91c2VNb3ZlLCB0aGlzKTsKCQl9Cgl9LAoKCXJlbW92ZUhvb2tzOiBmdW5jdGlvbiAoKSB7CgkJaWYgKHRoaXMuX21hcCkgewoJCQl0aGlzLl9kZWxldGFibGVMYXllcnMuZWFjaExheWVyKHRoaXMuX2Rpc2FibGVMYXllckRlbGV0ZSwgdGhpcyk7CgkJCXRoaXMuX2RlbGV0ZWRMYXllcnMgPSBudWxsOwoKCQkJdGhpcy5fdG9vbHRpcC5kaXNwb3NlKCk7CgkJCXRoaXMuX3Rvb2x0aXAgPSBudWxsOwoKCQkJdGhpcy5fbWFwLm9mZignbW91c2Vtb3ZlJywgdGhpcy5fb25Nb3VzZU1vdmUsIHRoaXMpOwoJCX0KCX0sCgoJcmV2ZXJ0TGF5ZXJzOiBmdW5jdGlvbiAoKSB7CgkJLy8gSXRlcmF0ZSBvZiB0aGUgZGVsZXRlZCBsYXllcnMgYW5kIGFkZCB0aGVtIGJhY2sgaW50byB0aGUgZmVhdHVyZUdyb3VwCgkJdGhpcy5fZGVsZXRlZExheWVycy5lYWNoTGF5ZXIoZnVuY3Rpb24gKGxheWVyKSB7CgkJCXRoaXMuX2RlbGV0YWJsZUxheWVycy5hZGRMYXllcihsYXllcik7CgkJfSwgdGhpcyk7Cgl9LAoKCXNhdmU6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9tYXAuZmlyZSgnZHJhdzpkZWxldGVkJywgeyBsYXllcnM6IHRoaXMuX2RlbGV0ZWRMYXllcnMgfSk7Cgl9LAoKCV9lbmFibGVMYXllckRlbGV0ZTogZnVuY3Rpb24gKGUpIHsKCQl2YXIgbGF5ZXIgPSBlLmxheWVyIHx8IGUudGFyZ2V0IHx8IGU7CgoJCWxheWVyLm9uKCdjbGljaycsIHRoaXMuX3JlbW92ZUxheWVyLCB0aGlzKTsKCX0sCgoJX2Rpc2FibGVMYXllckRlbGV0ZTogZnVuY3Rpb24gKGUpIHsKCQl2YXIgbGF5ZXIgPSBlLmxheWVyIHx8IGUudGFyZ2V0IHx8IGU7CgoJCWxheWVyLm9mZignY2xpY2snLCB0aGlzLl9yZW1vdmVMYXllciwgdGhpcyk7CgoJCS8vIFJlbW92ZSBmcm9tIHRoZSBkZWxldGVkIGxheWVycyBzbyB3ZSBjYW4ndCBhY2NpZGVudGx5IHJldmVydCBpZiB0aGUgdXNlciBwcmVzc2VzIGNhbmNlbAoJCXRoaXMuX2RlbGV0ZWRMYXllcnMucmVtb3ZlTGF5ZXIobGF5ZXIpOwoJfSwKCglfcmVtb3ZlTGF5ZXI6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIGxheWVyID0gZS5sYXllciB8fCBlLnRhcmdldCB8fCBlOwoKCQl0aGlzLl9kZWxldGFibGVMYXllcnMucmVtb3ZlTGF5ZXIobGF5ZXIpOwoKCQl0aGlzLl9kZWxldGVkTGF5ZXJzLmFkZExheWVyKGxheWVyKTsKCX0sCgoJX29uTW91c2VNb3ZlOiBmdW5jdGlvbiAoZSkgewoJCXRoaXMuX3Rvb2x0aXAudXBkYXRlUG9zaXRpb24oZS5sYXRsbmcpOwoJfQp9KTsKCgp9KHRoaXMsIGRvY3VtZW50KSk7CgogIC8vIFNwZWN0cnVtIENvbG9ycGlja2VyIHYxLjIuMAovLyBodHRwczovL2dpdGh1Yi5jb20vYmdyaW5zL3NwZWN0cnVtCi8vIEF1dGhvcjogQnJpYW4gR3JpbnN0ZWFkCi8vIExpY2Vuc2U6IE1JVAoKKGZ1bmN0aW9uICh3aW5kb3csICQsIHVuZGVmaW5lZCkgewogICAgdmFyIGRlZmF1bHRPcHRzID0gewoKICAgICAgICAvLyBDYWxsYmFja3MKICAgICAgICBiZWZvcmVTaG93OiBub29wLAogICAgICAgIG1vdmU6IG5vb3AsCiAgICAgICAgY2hhbmdlOiBub29wLAogICAgICAgIHNob3c6IG5vb3AsCiAgICAgICAgaGlkZTogbm9vcCwKCiAgICAgICAgLy8gT3B0aW9ucwogICAgICAgIGNvbG9yOiBmYWxzZSwKICAgICAgICBmbGF0OiBmYWxzZSwKICAgICAgICBzaG93SW5wdXQ6IGZhbHNlLAogICAgICAgIGFsbG93RW1wdHk6IGZhbHNlLAogICAgICAgIHNob3dCdXR0b25zOiB0cnVlLAogICAgICAgIGNsaWNrb3V0RmlyZXNDaGFuZ2U6IGZhbHNlLAogICAgICAgIHNob3dJbml0aWFsOiBmYWxzZSwKICAgICAgICBzaG93UGFsZXR0ZTogZmFsc2UsCiAgICAgICAgc2hvd1BhbGV0dGVPbmx5OiBmYWxzZSwKICAgICAgICBzaG93U2VsZWN0aW9uUGFsZXR0ZTogdHJ1ZSwKICAgICAgICBsb2NhbFN0b3JhZ2VLZXk6IGZhbHNlLAogICAgICAgIGFwcGVuZFRvOiAiYm9keSIsCiAgICAgICAgbWF4U2VsZWN0aW9uU2l6ZTogNywKICAgICAgICBjYW5jZWxUZXh0OiAiY2FuY2VsIiwKICAgICAgICBjaG9vc2VUZXh0OiAiY2hvb3NlIiwKICAgICAgICBwcmVmZXJyZWRGb3JtYXQ6IGZhbHNlLAogICAgICAgIGNsYXNzTmFtZTogIiIsCiAgICAgICAgc2hvd0FscGhhOiBmYWxzZSwKICAgICAgICB0aGVtZTogInNwLWxpZ2h0IiwKICAgICAgICBwYWxldHRlOiBbJ2ZmZicsICcwMDAnXSwKICAgICAgICBzZWxlY3Rpb25QYWxldHRlOiBbXSwKICAgICAgICBkaXNhYmxlZDogZmFsc2UKICAgIH0sCiAgICBzcGVjdHJ1bXMgPSBbXSwKICAgIElFID0gISEvbXNpZS9pLmV4ZWMoIHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50ICksCiAgICByZ2JhU3VwcG9ydCA9IChmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBjb250YWlucyggc3RyLCBzdWJzdHIgKSB7CiAgICAgICAgICAgIHJldHVybiAhIX4oJycgKyBzdHIpLmluZGV4T2Yoc3Vic3RyKTsKICAgICAgICB9CgogICAgICAgIHZhciBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdmFyIHN0eWxlID0gZWxlbS5zdHlsZTsKICAgICAgICBzdHlsZS5jc3NUZXh0ID0gJ2JhY2tncm91bmQtY29sb3I6cmdiYSgwLDAsMCwuNSknOwogICAgICAgIHJldHVybiBjb250YWlucyhzdHlsZS5iYWNrZ3JvdW5kQ29sb3IsICdyZ2JhJykgfHwgY29udGFpbnMoc3R5bGUuYmFja2dyb3VuZENvbG9yLCAnaHNsYScpOwogICAgfSkoKSwKICAgIGlucHV0VHlwZUNvbG9yU3VwcG9ydCA9IChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgY29sb3JJbnB1dCA9ICQoIjxpbnB1dCB0eXBlPSdjb2xvcicgdmFsdWU9JyEnIC8+IilbMF07CiAgICAgICAgcmV0dXJuIGNvbG9ySW5wdXQudHlwZSA9PT0gImNvbG9yIiAmJiBjb2xvcklucHV0LnZhbHVlICE9PSAiISI7CiAgICB9KSgpLAogICAgcmVwbGFjZUlucHV0ID0gWwogICAgICAgICI8ZGl2IGNsYXNzPSdzcC1yZXBsYWNlcic+IiwKICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLXByZXZpZXcnPjxkaXYgY2xhc3M9J3NwLXByZXZpZXctaW5uZXInPjwvZGl2PjwvZGl2PiIsCiAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC1kZCc+JiM5NjYwOzwvZGl2PiIsCiAgICAgICAgIjwvZGl2PiIKICAgIF0uam9pbignJyksCiAgICBtYXJrdXAgPSAoZnVuY3Rpb24gKCkgewoKICAgICAgICAvLyBJRSBkb2VzIG5vdCBzdXBwb3J0IGdyYWRpZW50cyB3aXRoIG11bHRpcGxlIHN0b3BzLCBzbyB3ZSBuZWVkIHRvIHNpbXVsYXRlCiAgICAgICAgLy8gIHRoYXQgZm9yIHRoZSByYWluYm93IHNsaWRlciB3aXRoIDggZGl2cyB0aGF0IGVhY2ggaGF2ZSBhIHNpbmdsZSBncmFkaWVudAogICAgICAgIHZhciBncmFkaWVudEZpeCA9ICIiOwogICAgICAgIGlmIChJRSkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSA2OyBpKyspIHsKICAgICAgICAgICAgICAgIGdyYWRpZW50Rml4ICs9ICI8ZGl2IGNsYXNzPSdzcC0iICsgaSArICInPjwvZGl2PiI7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC1jb250YWluZXIgc3AtaGlkZGVuJz4iLAogICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLXBhbGV0dGUtY29udGFpbmVyJz4iLAogICAgICAgICAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC1wYWxldHRlIHNwLXRodW1iIHNwLWNmJz48L2Rpdj4iLAogICAgICAgICAgICAgICAgIjwvZGl2PiIsCiAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtcGlja2VyLWNvbnRhaW5lcic+IiwKICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtdG9wIHNwLWNmJz4iLAogICAgICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtZmlsbCc+PC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLXRvcC1pbm5lcic+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC1jb2xvcic+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3Atc2F0Jz4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtdmFsJz4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLWRyYWdnZXInPjwvZGl2PiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtY2xlYXIgc3AtY2xlYXItZGlzcGxheScgdGl0bGU9J0NsZWFyIENvbG9yIFNlbGVjdGlvbic+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLWh1ZSc+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3Atc2xpZGVyJz48L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyYWRpZW50Rml4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIsCiAgICAgICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtYWxwaGEnPjxkaXYgY2xhc3M9J3NwLWFscGhhLWlubmVyJz48ZGl2IGNsYXNzPSdzcC1hbHBoYS1oYW5kbGUnPjwvZGl2PjwvZGl2PjwvZGl2PiIsCiAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIsCiAgICAgICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLWlucHV0LWNvbnRhaW5lciBzcC1jZic+IiwKICAgICAgICAgICAgICAgICAgICAgICAgIjxpbnB1dCBjbGFzcz0nc3AtaW5wdXQnIHR5cGU9J3RleHQnIHNwZWxsY2hlY2s9J2ZhbHNlJyAgLz4iLAogICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC1pbml0aWFsIHNwLXRodW1iIHNwLWNmJz48L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC1idXR0b24tY29udGFpbmVyIHNwLWNmJz4iLAogICAgICAgICAgICAgICAgICAgICAgICAiPGEgY2xhc3M9J3NwLWNhbmNlbCcgaHJlZj0nIyc+PC9hPiIsCiAgICAgICAgICAgICAgICAgICAgICAgICI8YnV0dG9uIGNsYXNzPSdzcC1jaG9vc2UnPjwvYnV0dG9uPiIsCiAgICAgICAgICAgICAgICAgICAgIjwvZGl2PiIsCiAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgIjwvZGl2PiIKICAgICAgICBdLmpvaW4oIiIpOwogICAgfSkoKTsKCiAgICBmdW5jdGlvbiBwYWxldHRlVGVtcGxhdGUgKHAsIGNvbG9yLCBjbGFzc05hbWUpIHsKICAgICAgICB2YXIgaHRtbCA9IFtdOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgY3VycmVudCA9IHBbaV07CiAgICAgICAgICAgIGlmKGN1cnJlbnQpIHsKICAgICAgICAgICAgICAgIHZhciB0aW55ID0gdGlueWNvbG9yKGN1cnJlbnQpOwogICAgICAgICAgICAgICAgdmFyIGMgPSB0aW55LnRvSHNsKCkubCA8IDAuNSA/ICJzcC10aHVtYi1lbCBzcC10aHVtYi1kYXJrIiA6ICJzcC10aHVtYi1lbCBzcC10aHVtYi1saWdodCI7CiAgICAgICAgICAgICAgICBjICs9ICh0aW55Y29sb3IuZXF1YWxzKGNvbG9yLCBjdXJyZW50KSkgPyAiIHNwLXRodW1iLWFjdGl2ZSIgOiAiIjsKCiAgICAgICAgICAgICAgICB2YXIgc3dhdGNoU3R5bGUgPSByZ2JhU3VwcG9ydCA/ICgiYmFja2dyb3VuZC1jb2xvcjoiICsgdGlueS50b1JnYlN0cmluZygpKSA6ICJmaWx0ZXI6IiArIHRpbnkudG9GaWx0ZXIoKTsKICAgICAgICAgICAgICAgIGh0bWwucHVzaCgnPHNwYW4gdGl0bGU9IicgKyB0aW55LnRvUmdiU3RyaW5nKCkgKyAnIiBkYXRhLWNvbG9yPSInICsgdGlueS50b1JnYlN0cmluZygpICsgJyIgY2xhc3M9IicgKyBjICsgJyI+PHNwYW4gY2xhc3M9InNwLXRodW1iLWlubmVyIiBzdHlsZT0iJyArIHN3YXRjaFN0eWxlICsgJzsiIC8+PC9zcGFuPicpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGNscyA9ICdzcC1jbGVhci1kaXNwbGF5JzsKICAgICAgICAgICAgICAgIGh0bWwucHVzaCgnPHNwYW4gdGl0bGU9Ik5vIENvbG9yIFNlbGVjdGVkIiBkYXRhLWNvbG9yPSIiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50OyIgY2xhc3M9IicgKyBjbHMgKyAnIj48L3NwYW4+Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICI8ZGl2IGNsYXNzPSdzcC1jZiAiICsgY2xhc3NOYW1lICsgIic+IiArIGh0bWwuam9pbignJykgKyAiPC9kaXY+IjsKICAgIH0KCiAgICBmdW5jdGlvbiBoaWRlQWxsKCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3BlY3RydW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChzcGVjdHJ1bXNbaV0pIHsKICAgICAgICAgICAgICAgIHNwZWN0cnVtc1tpXS5oaWRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaW5zdGFuY2VPcHRpb25zKG8sIGNhbGxiYWNrQ29udGV4dCkgewogICAgICAgIHZhciBvcHRzID0gJC5leHRlbmQoe30sIGRlZmF1bHRPcHRzLCBvKTsKICAgICAgICBvcHRzLmNhbGxiYWNrcyA9IHsKICAgICAgICAgICAgJ21vdmUnOiBiaW5kKG9wdHMubW92ZSwgY2FsbGJhY2tDb250ZXh0KSwKICAgICAgICAgICAgJ2NoYW5nZSc6IGJpbmQob3B0cy5jaGFuZ2UsIGNhbGxiYWNrQ29udGV4dCksCiAgICAgICAgICAgICdzaG93JzogYmluZChvcHRzLnNob3csIGNhbGxiYWNrQ29udGV4dCksCiAgICAgICAgICAgICdoaWRlJzogYmluZChvcHRzLmhpZGUsIGNhbGxiYWNrQ29udGV4dCksCiAgICAgICAgICAgICdiZWZvcmVTaG93JzogYmluZChvcHRzLmJlZm9yZVNob3csIGNhbGxiYWNrQ29udGV4dCkKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gb3B0czsKICAgIH0KCiAgICBmdW5jdGlvbiBzcGVjdHJ1bShlbGVtZW50LCBvKSB7CgogICAgICAgIHZhciBvcHRzID0gaW5zdGFuY2VPcHRpb25zKG8sIGVsZW1lbnQpLAogICAgICAgICAgICBmbGF0ID0gb3B0cy5mbGF0LAogICAgICAgICAgICBzaG93U2VsZWN0aW9uUGFsZXR0ZSA9IG9wdHMuc2hvd1NlbGVjdGlvblBhbGV0dGUsCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZUtleSA9IG9wdHMubG9jYWxTdG9yYWdlS2V5LAogICAgICAgICAgICB0aGVtZSA9IG9wdHMudGhlbWUsCiAgICAgICAgICAgIGNhbGxiYWNrcyA9IG9wdHMuY2FsbGJhY2tzLAogICAgICAgICAgICByZXNpemUgPSB0aHJvdHRsZShyZWZsb3csIDEwKSwKICAgICAgICAgICAgdmlzaWJsZSA9IGZhbHNlLAogICAgICAgICAgICBkcmFnV2lkdGggPSAwLAogICAgICAgICAgICBkcmFnSGVpZ2h0ID0gMCwKICAgICAgICAgICAgZHJhZ0hlbHBlckhlaWdodCA9IDAsCiAgICAgICAgICAgIHNsaWRlSGVpZ2h0ID0gMCwKICAgICAgICAgICAgc2xpZGVXaWR0aCA9IDAsCiAgICAgICAgICAgIGFscGhhV2lkdGggPSAwLAogICAgICAgICAgICBhbHBoYVNsaWRlSGVscGVyV2lkdGggPSAwLAogICAgICAgICAgICBzbGlkZUhlbHBlckhlaWdodCA9IDAsCiAgICAgICAgICAgIGN1cnJlbnRIdWUgPSAwLAogICAgICAgICAgICBjdXJyZW50U2F0dXJhdGlvbiA9IDAsCiAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IDAsCiAgICAgICAgICAgIGN1cnJlbnRBbHBoYSA9IDEsCiAgICAgICAgICAgIHBhbGV0dGUgPSBvcHRzLnBhbGV0dGUuc2xpY2UoMCksCiAgICAgICAgICAgIHBhbGV0dGVBcnJheSA9ICQuaXNBcnJheShwYWxldHRlWzBdKSA/IHBhbGV0dGUgOiBbcGFsZXR0ZV0sCiAgICAgICAgICAgIHNlbGVjdGlvblBhbGV0dGUgPSBvcHRzLnNlbGVjdGlvblBhbGV0dGUuc2xpY2UoMCksCiAgICAgICAgICAgIG1heFNlbGVjdGlvblNpemUgPSBvcHRzLm1heFNlbGVjdGlvblNpemUsCiAgICAgICAgICAgIGRyYWdnaW5nQ2xhc3MgPSAic3AtZHJhZ2dpbmciLAogICAgICAgICAgICBzaGlmdE1vdmVtZW50RGlyZWN0aW9uID0gbnVsbDsKCiAgICAgICAgdmFyIGRvYyA9IGVsZW1lbnQub3duZXJEb2N1bWVudCwKICAgICAgICAgICAgYm9keSA9IGRvYy5ib2R5LAogICAgICAgICAgICBib3VuZEVsZW1lbnQgPSAkKGVsZW1lbnQpLAogICAgICAgICAgICBkaXNhYmxlZCA9IGZhbHNlLAogICAgICAgICAgICBjb250YWluZXIgPSAkKG1hcmt1cCwgZG9jKS5hZGRDbGFzcyh0aGVtZSksCiAgICAgICAgICAgIGRyYWdnZXIgPSBjb250YWluZXIuZmluZCgiLnNwLWNvbG9yIiksCiAgICAgICAgICAgIGRyYWdIZWxwZXIgPSBjb250YWluZXIuZmluZCgiLnNwLWRyYWdnZXIiKSwKICAgICAgICAgICAgc2xpZGVyID0gY29udGFpbmVyLmZpbmQoIi5zcC1odWUiKSwKICAgICAgICAgICAgc2xpZGVIZWxwZXIgPSBjb250YWluZXIuZmluZCgiLnNwLXNsaWRlciIpLAogICAgICAgICAgICBhbHBoYVNsaWRlcklubmVyID0gY29udGFpbmVyLmZpbmQoIi5zcC1hbHBoYS1pbm5lciIpLAogICAgICAgICAgICBhbHBoYVNsaWRlciA9IGNvbnRhaW5lci5maW5kKCIuc3AtYWxwaGEiKSwKICAgICAgICAgICAgYWxwaGFTbGlkZUhlbHBlciA9IGNvbnRhaW5lci5maW5kKCIuc3AtYWxwaGEtaGFuZGxlIiksCiAgICAgICAgICAgIHRleHRJbnB1dCA9IGNvbnRhaW5lci5maW5kKCIuc3AtaW5wdXQiKSwKICAgICAgICAgICAgcGFsZXR0ZUNvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKCIuc3AtcGFsZXR0ZSIpLAogICAgICAgICAgICBpbml0aWFsQ29sb3JDb250YWluZXIgPSBjb250YWluZXIuZmluZCgiLnNwLWluaXRpYWwiKSwKICAgICAgICAgICAgY2FuY2VsQnV0dG9uID0gY29udGFpbmVyLmZpbmQoIi5zcC1jYW5jZWwiKSwKICAgICAgICAgICAgY2xlYXJCdXR0b24gPSBjb250YWluZXIuZmluZCgiLnNwLWNsZWFyIiksCiAgICAgICAgICAgIGNob29zZUJ1dHRvbiA9IGNvbnRhaW5lci5maW5kKCIuc3AtY2hvb3NlIiksCiAgICAgICAgICAgIGlzSW5wdXQgPSBib3VuZEVsZW1lbnQuaXMoImlucHV0IiksCiAgICAgICAgICAgIGlzSW5wdXRUeXBlQ29sb3IgPSBpc0lucHV0ICYmIGlucHV0VHlwZUNvbG9yU3VwcG9ydCAmJiBib3VuZEVsZW1lbnQuYXR0cigidHlwZSIpID09PSAiY29sb3IiLAogICAgICAgICAgICBzaG91bGRSZXBsYWNlID0gaXNJbnB1dCAmJiAhZmxhdCwKICAgICAgICAgICAgcmVwbGFjZXIgPSAoc2hvdWxkUmVwbGFjZSkgPyAkKHJlcGxhY2VJbnB1dCkuYWRkQ2xhc3ModGhlbWUpLmFkZENsYXNzKG9wdHMuY2xhc3NOYW1lKSA6ICQoW10pLAogICAgICAgICAgICBvZmZzZXRFbGVtZW50ID0gKHNob3VsZFJlcGxhY2UpID8gcmVwbGFjZXIgOiBib3VuZEVsZW1lbnQsCiAgICAgICAgICAgIHByZXZpZXdFbGVtZW50ID0gcmVwbGFjZXIuZmluZCgiLnNwLXByZXZpZXctaW5uZXIiKSwKICAgICAgICAgICAgaW5pdGlhbENvbG9yID0gb3B0cy5jb2xvciB8fCAoaXNJbnB1dCAmJiBib3VuZEVsZW1lbnQudmFsKCkpLAogICAgICAgICAgICBjb2xvck9uU2hvdyA9IGZhbHNlLAogICAgICAgICAgICBwcmVmZXJyZWRGb3JtYXQgPSBvcHRzLnByZWZlcnJlZEZvcm1hdCwKICAgICAgICAgICAgY3VycmVudFByZWZlcnJlZEZvcm1hdCA9IHByZWZlcnJlZEZvcm1hdCwKICAgICAgICAgICAgY2xpY2tvdXRGaXJlc0NoYW5nZSA9ICFvcHRzLnNob3dCdXR0b25zIHx8IG9wdHMuY2xpY2tvdXRGaXJlc0NoYW5nZSwKICAgICAgICAgICAgaXNFbXB0eSA9ICFpbml0aWFsQ29sb3IsCiAgICAgICAgICAgIGFsbG93RW1wdHkgPSBvcHRzLmFsbG93RW1wdHkgJiYgIWlzSW5wdXRUeXBlQ29sb3I7CgogICAgICAgIGZ1bmN0aW9uIGFwcGx5T3B0aW9ucygpIHsKCiAgICAgICAgICAgIGlmIChvcHRzLnNob3dQYWxldHRlT25seSkgewogICAgICAgICAgICAgICAgb3B0cy5zaG93UGFsZXR0ZSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnRhaW5lci50b2dnbGVDbGFzcygic3AtZmxhdCIsIGZsYXQpOwogICAgICAgICAgICBjb250YWluZXIudG9nZ2xlQ2xhc3MoInNwLWlucHV0LWRpc2FibGVkIiwgIW9wdHMuc2hvd0lucHV0KTsKICAgICAgICAgICAgY29udGFpbmVyLnRvZ2dsZUNsYXNzKCJzcC1hbHBoYS1lbmFibGVkIiwgb3B0cy5zaG93QWxwaGEpOwogICAgICAgICAgICBjb250YWluZXIudG9nZ2xlQ2xhc3MoInNwLWNsZWFyLWVuYWJsZWQiLCBhbGxvd0VtcHR5KTsKICAgICAgICAgICAgY29udGFpbmVyLnRvZ2dsZUNsYXNzKCJzcC1idXR0b25zLWRpc2FibGVkIiwgIW9wdHMuc2hvd0J1dHRvbnMpOwogICAgICAgICAgICBjb250YWluZXIudG9nZ2xlQ2xhc3MoInNwLXBhbGV0dGUtZGlzYWJsZWQiLCAhb3B0cy5zaG93UGFsZXR0ZSk7CiAgICAgICAgICAgIGNvbnRhaW5lci50b2dnbGVDbGFzcygic3AtcGFsZXR0ZS1vbmx5Iiwgb3B0cy5zaG93UGFsZXR0ZU9ubHkpOwogICAgICAgICAgICBjb250YWluZXIudG9nZ2xlQ2xhc3MoInNwLWluaXRpYWwtZGlzYWJsZWQiLCAhb3B0cy5zaG93SW5pdGlhbCk7CiAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhvcHRzLmNsYXNzTmFtZSk7CgogICAgICAgICAgICByZWZsb3coKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7CgogICAgICAgICAgICBpZiAoSUUpIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCIqOm5vdChpbnB1dCkiKS5hdHRyKCJ1bnNlbGVjdGFibGUiLCAib24iKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXBwbHlPcHRpb25zKCk7CgogICAgICAgICAgICBpZiAoc2hvdWxkUmVwbGFjZSkgewogICAgICAgICAgICAgICAgYm91bmRFbGVtZW50LmFmdGVyKHJlcGxhY2VyKS5oaWRlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghYWxsb3dFbXB0eSkgewogICAgICAgICAgICAgICAgY2xlYXJCdXR0b24uaGlkZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmxhdCkgewogICAgICAgICAgICAgICAgYm91bmRFbGVtZW50LmFmdGVyKGNvbnRhaW5lcikuaGlkZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewoKICAgICAgICAgICAgICAgIHZhciBhcHBlbmRUbyA9IG9wdHMuYXBwZW5kVG8gPT09ICJwYXJlbnQiID8gYm91bmRFbGVtZW50LnBhcmVudCgpIDogJChvcHRzLmFwcGVuZFRvKTsKICAgICAgICAgICAgICAgIGlmIChhcHBlbmRUby5sZW5ndGggIT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBhcHBlbmRUbyA9ICQoImJvZHkiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBhcHBlbmRUby5hcHBlbmQoY29udGFpbmVyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZUtleSAmJiB3aW5kb3cubG9jYWxTdG9yYWdlKSB7CgogICAgICAgICAgICAgICAgLy8gTWlncmF0ZSBvbGQgcGFsZXR0ZXMgb3ZlciB0byBuZXcgZm9ybWF0LiAgTWF5IHdhbnQgdG8gcmVtb3ZlIHRoaXMgZXZlbnR1YWxseS4KICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG9sZFBhbGV0dGUgPSB3aW5kb3cubG9jYWxTdG9yYWdlW2xvY2FsU3RvcmFnZUtleV0uc3BsaXQoIiwjIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFBhbGV0dGUubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgd2luZG93LmxvY2FsU3RvcmFnZVtsb2NhbFN0b3JhZ2VLZXldOwogICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2gob2xkUGFsZXR0ZSwgZnVuY3Rpb24oaSwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZENvbG9yVG9TZWxlY3Rpb25QYWxldHRlKGMpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaChlKSB7IH0KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvblBhbGV0dGUgPSB3aW5kb3cubG9jYWxTdG9yYWdlW2xvY2FsU3RvcmFnZUtleV0uc3BsaXQoIjsiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7IH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgb2Zmc2V0RWxlbWVudC5iaW5kKCJjbGljay5zcGVjdHJ1bSB0b3VjaHN0YXJ0LnNwZWN0cnVtIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIGlmICghZGlzYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICB0b2dnbGUoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICAgICAgICAgIGlmICghJChlLnRhcmdldCkuaXMoImlucHV0IikpIHsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYoYm91bmRFbGVtZW50LmlzKCI6ZGlzYWJsZWQiKSB8fCAob3B0cy5kaXNhYmxlZCA9PT0gdHJ1ZSkpIHsKICAgICAgICAgICAgICAgIGRpc2FibGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gUHJldmVudCBjbGlja3MgZnJvbSBidWJibGluZyB1cCB0byBkb2N1bWVudC4gIFRoaXMgd291bGQgY2F1c2UgaXQgdG8gYmUgaGlkZGVuLgogICAgICAgICAgICBjb250YWluZXIuY2xpY2soc3RvcFByb3BhZ2F0aW9uKTsKCiAgICAgICAgICAgIC8vIEhhbmRsZSB1c2VyIHR5cGVkIGlucHV0CiAgICAgICAgICAgIHRleHRJbnB1dC5jaGFuZ2Uoc2V0RnJvbVRleHRJbnB1dCk7CiAgICAgICAgICAgIHRleHRJbnB1dC5iaW5kKCJwYXN0ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoc2V0RnJvbVRleHRJbnB1dCwgMSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0ZXh0SW5wdXQua2V5ZG93bihmdW5jdGlvbiAoZSkgeyBpZiAoZS5rZXlDb2RlID09IDEzKSB7IHNldEZyb21UZXh0SW5wdXQoKTsgfSB9KTsKCiAgICAgICAgICAgIGNhbmNlbEJ1dHRvbi50ZXh0KG9wdHMuY2FuY2VsVGV4dCk7CiAgICAgICAgICAgIGNhbmNlbEJ1dHRvbi5iaW5kKCJjbGljay5zcGVjdHJ1bSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgaGlkZSgiY2FuY2VsIik7CiAgICAgICAgICAgIH0pOwoKCiAgICAgICAgICAgIGNsZWFyQnV0dG9uLmJpbmQoImNsaWNrLnNwZWN0cnVtIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgICBpc0VtcHR5ID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBtb3ZlKCk7CiAgICAgICAgICAgICAgICBpZihmbGF0KSB7CiAgICAgICAgICAgICAgICAgICAgLy9mb3IgdGhlIGZsYXQgc3R5bGUsIHRoaXMgaXMgYSBjaGFuZ2UgZXZlbnQKICAgICAgICAgICAgICAgICAgICB1cGRhdGVPcmlnaW5hbElucHV0KHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCgogICAgICAgICAgICBjaG9vc2VCdXR0b24udGV4dChvcHRzLmNob29zZVRleHQpOwogICAgICAgICAgICBjaG9vc2VCdXR0b24uYmluZCgiY2xpY2suc3BlY3RydW0iLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgICBpZiAoaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlT3JpZ2luYWxJbnB1dCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBoaWRlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZHJhZ2dhYmxlKGFscGhhU2xpZGVyLCBmdW5jdGlvbiAoZHJhZ1gsIGRyYWdZLCBlKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50QWxwaGEgPSAoZHJhZ1ggLyBhbHBoYVdpZHRoKTsKICAgICAgICAgICAgICAgIGlzRW1wdHkgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEFscGhhID0gTWF0aC5yb3VuZChjdXJyZW50QWxwaGEgKiAxMCkgLyAxMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtb3ZlKCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZHJhZ2dhYmxlKHNsaWRlciwgZnVuY3Rpb24gKGRyYWdYLCBkcmFnWSkgewogICAgICAgICAgICAgICAgY3VycmVudEh1ZSA9IHBhcnNlRmxvYXQoZHJhZ1kgLyBzbGlkZUhlaWdodCk7CiAgICAgICAgICAgICAgICBpc0VtcHR5ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBtb3ZlKCk7CiAgICAgICAgICAgIH0sIGRyYWdTdGFydCwgZHJhZ1N0b3ApOwoKICAgICAgICAgICAgZHJhZ2dhYmxlKGRyYWdnZXIsIGZ1bmN0aW9uIChkcmFnWCwgZHJhZ1ksIGUpIHsKCiAgICAgICAgICAgICAgICAvLyBzaGlmdCtkcmFnIHNob3VsZCBzbmFwIHRoZSBtb3ZlbWVudCB0byBlaXRoZXIgdGhlIHggb3IgeSBheGlzLgogICAgICAgICAgICAgICAgaWYgKCFlLnNoaWZ0S2V5KSB7CiAgICAgICAgICAgICAgICAgICAgc2hpZnRNb3ZlbWVudERpcmVjdGlvbiA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICghc2hpZnRNb3ZlbWVudERpcmVjdGlvbikgewogICAgICAgICAgICAgICAgICAgIHZhciBvbGREcmFnWCA9IGN1cnJlbnRTYXR1cmF0aW9uICogZHJhZ1dpZHRoOwogICAgICAgICAgICAgICAgICAgIHZhciBvbGREcmFnWSA9IGRyYWdIZWlnaHQgLSAoY3VycmVudFZhbHVlICogZHJhZ0hlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZ1cnRoZXJGcm9tWCA9IE1hdGguYWJzKGRyYWdYIC0gb2xkRHJhZ1gpID4gTWF0aC5hYnMoZHJhZ1kgLSBvbGREcmFnWSk7CgogICAgICAgICAgICAgICAgICAgIHNoaWZ0TW92ZW1lbnREaXJlY3Rpb24gPSBmdXJ0aGVyRnJvbVggPyAieCIgOiAieSI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIHNldFNhdHVyYXRpb24gPSAhc2hpZnRNb3ZlbWVudERpcmVjdGlvbiB8fCBzaGlmdE1vdmVtZW50RGlyZWN0aW9uID09PSAieCI7CiAgICAgICAgICAgICAgICB2YXIgc2V0VmFsdWUgPSAhc2hpZnRNb3ZlbWVudERpcmVjdGlvbiB8fCBzaGlmdE1vdmVtZW50RGlyZWN0aW9uID09PSAieSI7CgogICAgICAgICAgICAgICAgaWYgKHNldFNhdHVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2F0dXJhdGlvbiA9IHBhcnNlRmxvYXQoZHJhZ1ggLyBkcmFnV2lkdGgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHNldFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gcGFyc2VGbG9hdCgoZHJhZ0hlaWdodCAtIGRyYWdZKSAvIGRyYWdIZWlnaHQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlzRW1wdHkgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBtb3ZlKCk7CgogICAgICAgICAgICB9LCBkcmFnU3RhcnQsIGRyYWdTdG9wKTsKCiAgICAgICAgICAgIGlmICghIWluaXRpYWxDb2xvcikgewogICAgICAgICAgICAgICAgc2V0KGluaXRpYWxDb2xvcik7CgogICAgICAgICAgICAgICAgLy8gSW4gY2FzZSBjb2xvciB3YXMgYmxhY2sgLSB1cGRhdGUgdGhlIHByZXZpZXcgVUkgYW5kIHNldCB0aGUgZm9ybWF0CiAgICAgICAgICAgICAgICAvLyBzaW5jZSB0aGUgc2V0IGZ1bmN0aW9uIHdpbGwgbm90IHJ1biAoZGVmYXVsdCBjb2xvciBpcyBibGFjaykuCiAgICAgICAgICAgICAgICB1cGRhdGVVSSgpOwogICAgICAgICAgICAgICAgY3VycmVudFByZWZlcnJlZEZvcm1hdCA9IHByZWZlcnJlZEZvcm1hdCB8fCB0aW55Y29sb3IoaW5pdGlhbENvbG9yKS5mb3JtYXQ7CgogICAgICAgICAgICAgICAgYWRkQ29sb3JUb1NlbGVjdGlvblBhbGV0dGUoaW5pdGlhbENvbG9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHVwZGF0ZVVJKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmbGF0KSB7CiAgICAgICAgICAgICAgICBzaG93KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHBhbGxldEVsZW1lbnRDbGljayhlKSB7CiAgICAgICAgICAgICAgICBpZiAoZS5kYXRhICYmIGUuZGF0YS5pZ25vcmUpIHsKICAgICAgICAgICAgICAgICAgICBzZXQoJCh0aGlzKS5kYXRhKCJjb2xvciIpKTsKICAgICAgICAgICAgICAgICAgICBtb3ZlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZXQoJCh0aGlzKS5kYXRhKCJjb2xvciIpKTsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVPcmlnaW5hbElucHV0KHRydWUpOwogICAgICAgICAgICAgICAgICAgIG1vdmUoKTsKICAgICAgICAgICAgICAgICAgICBoaWRlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGFsZXR0ZUV2ZW50ID0gSUUgPyAibW91c2Vkb3duLnNwZWN0cnVtIiA6ICJjbGljay5zcGVjdHJ1bSB0b3VjaHN0YXJ0LnNwZWN0cnVtIjsKICAgICAgICAgICAgcGFsZXR0ZUNvbnRhaW5lci5kZWxlZ2F0ZSgiLnNwLXRodW1iLWVsIiwgcGFsZXR0ZUV2ZW50LCBwYWxsZXRFbGVtZW50Q2xpY2spOwogICAgICAgICAgICBpbml0aWFsQ29sb3JDb250YWluZXIuZGVsZWdhdGUoIi5zcC10aHVtYi1lbDpudGgtY2hpbGQoMSkiLCBwYWxldHRlRXZlbnQsIHsgaWdub3JlOiB0cnVlIH0sIHBhbGxldEVsZW1lbnRDbGljayk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhZGRDb2xvclRvU2VsZWN0aW9uUGFsZXR0ZShjb2xvcikgewogICAgICAgICAgICBpZiAoc2hvd1NlbGVjdGlvblBhbGV0dGUpIHsKICAgICAgICAgICAgICAgIHZhciBjb2xvclJnYiA9IHRpbnljb2xvcihjb2xvcikudG9SZ2JTdHJpbmcoKTsKICAgICAgICAgICAgICAgIGlmICgkLmluQXJyYXkoY29sb3JSZ2IsIHNlbGVjdGlvblBhbGV0dGUpID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvblBhbGV0dGUucHVzaChjb2xvclJnYik7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoc2VsZWN0aW9uUGFsZXR0ZS5sZW5ndGggPiBtYXhTZWxlY3Rpb25TaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvblBhbGV0dGUuc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZUtleSAmJiB3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZVtsb2NhbFN0b3JhZ2VLZXldID0gc2VsZWN0aW9uUGFsZXR0ZS5qb2luKCI7Iik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoKGUpIHsgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRVbmlxdWVTZWxlY3Rpb25QYWxldHRlKCkgewogICAgICAgICAgICB2YXIgdW5pcXVlID0gW107CiAgICAgICAgICAgIHZhciBwID0gc2VsZWN0aW9uUGFsZXR0ZTsKICAgICAgICAgICAgdmFyIHBhbGV0dGVMb29rdXAgPSB7fTsKICAgICAgICAgICAgdmFyIHJnYjsKCiAgICAgICAgICAgIGlmIChvcHRzLnNob3dQYWxldHRlKSB7CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYWxldHRlQXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHBhbGV0dGVBcnJheVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgICAgICByZ2IgPSB0aW55Y29sb3IocGFsZXR0ZUFycmF5W2ldW2pdKS50b1JnYlN0cmluZygpOwogICAgICAgICAgICAgICAgICAgICAgICBwYWxldHRlTG9va3VwW3JnYl0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHJnYiA9IHRpbnljb2xvcihwW2ldKS50b1JnYlN0cmluZygpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIXBhbGV0dGVMb29rdXAuaGFzT3duUHJvcGVydHkocmdiKSkgewogICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWUucHVzaChwW2ldKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFsZXR0ZUxvb2t1cFtyZ2JdID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB1bmlxdWUucmV2ZXJzZSgpLnNsaWNlKDAsIG9wdHMubWF4U2VsZWN0aW9uU2l6ZSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkcmF3UGFsZXR0ZSgpIHsKCiAgICAgICAgICAgIHZhciBjdXJyZW50Q29sb3IgPSBnZXQoKTsKCiAgICAgICAgICAgIHZhciBodG1sID0gJC5tYXAocGFsZXR0ZUFycmF5LCBmdW5jdGlvbiAocGFsZXR0ZSwgaSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhbGV0dGVUZW1wbGF0ZShwYWxldHRlLCBjdXJyZW50Q29sb3IsICJzcC1wYWxldHRlLXJvdyBzcC1wYWxldHRlLXJvdy0iICsgaSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHNlbGVjdGlvblBhbGV0dGUpIHsKICAgICAgICAgICAgICAgIGh0bWwucHVzaChwYWxldHRlVGVtcGxhdGUoZ2V0VW5pcXVlU2VsZWN0aW9uUGFsZXR0ZSgpLCBjdXJyZW50Q29sb3IsICJzcC1wYWxldHRlLXJvdyBzcC1wYWxldHRlLXJvdy1zZWxlY3Rpb24iKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBhbGV0dGVDb250YWluZXIuaHRtbChodG1sLmpvaW4oIiIpKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRyYXdJbml0aWFsKCkgewogICAgICAgICAgICBpZiAob3B0cy5zaG93SW5pdGlhbCkgewogICAgICAgICAgICAgICAgdmFyIGluaXRpYWwgPSBjb2xvck9uU2hvdzsKICAgICAgICAgICAgICAgIHZhciBjdXJyZW50ID0gZ2V0KCk7CiAgICAgICAgICAgICAgICBpbml0aWFsQ29sb3JDb250YWluZXIuaHRtbChwYWxldHRlVGVtcGxhdGUoW2luaXRpYWwsIGN1cnJlbnRdLCBjdXJyZW50LCAic3AtcGFsZXR0ZS1yb3ctaW5pdGlhbCIpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZHJhZ1N0YXJ0KCkgewogICAgICAgICAgICBpZiAoZHJhZ0hlaWdodCA8PSAwIHx8IGRyYWdXaWR0aCA8PSAwIHx8IHNsaWRlSGVpZ2h0IDw9IDApIHsKICAgICAgICAgICAgICAgIHJlZmxvdygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhkcmFnZ2luZ0NsYXNzKTsKICAgICAgICAgICAgc2hpZnRNb3ZlbWVudERpcmVjdGlvbiA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkcmFnU3RvcCgpIHsKICAgICAgICAgICAgY29udGFpbmVyLnJlbW92ZUNsYXNzKGRyYWdnaW5nQ2xhc3MpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0RnJvbVRleHRJbnB1dCgpIHsKCiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHRleHRJbnB1dC52YWwoKTsKCiAgICAgICAgICAgIGlmICgodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09ICIiKSAmJiBhbGxvd0VtcHR5KSB7CiAgICAgICAgICAgICAgICBzZXQobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgdGlueSA9IHRpbnljb2xvcih2YWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAodGlueS5vaykgewogICAgICAgICAgICAgICAgICAgIHNldCh0aW55KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRleHRJbnB1dC5hZGRDbGFzcygic3AtdmFsaWRhdGlvbi1lcnJvciIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0b2dnbGUoKSB7CiAgICAgICAgICAgIGlmICh2aXNpYmxlKSB7CiAgICAgICAgICAgICAgICBoaWRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBzaG93KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNob3coKSB7CiAgICAgICAgICAgIHZhciBldmVudCA9ICQuRXZlbnQoJ2JlZm9yZVNob3cuc3BlY3RydW0nKTsKCiAgICAgICAgICAgIGlmICh2aXNpYmxlKSB7CiAgICAgICAgICAgICAgICByZWZsb3coKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYm91bmRFbGVtZW50LnRyaWdnZXIoZXZlbnQsIFsgZ2V0KCkgXSk7CgogICAgICAgICAgICBpZiAoY2FsbGJhY2tzLmJlZm9yZVNob3coZ2V0KCkpID09PSBmYWxzZSB8fCBldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBoaWRlQWxsKCk7CiAgICAgICAgICAgIHZpc2libGUgPSB0cnVlOwoKICAgICAgICAgICAgJChkb2MpLmJpbmQoImNsaWNrLnNwZWN0cnVtIiwgaGlkZSk7CiAgICAgICAgICAgICQod2luZG93KS5iaW5kKCJyZXNpemUuc3BlY3RydW0iLCByZXNpemUpOwogICAgICAgICAgICByZXBsYWNlci5hZGRDbGFzcygic3AtYWN0aXZlIik7CiAgICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmVDbGFzcygic3AtaGlkZGVuIik7CgogICAgICAgICAgICBpZiAob3B0cy5zaG93UGFsZXR0ZSkgewogICAgICAgICAgICAgICAgZHJhd1BhbGV0dGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZWZsb3coKTsKICAgICAgICAgICAgdXBkYXRlVUkoKTsKCiAgICAgICAgICAgIGNvbG9yT25TaG93ID0gZ2V0KCk7CgogICAgICAgICAgICBkcmF3SW5pdGlhbCgpOwogICAgICAgICAgICBjYWxsYmFja3Muc2hvdyhjb2xvck9uU2hvdyk7CiAgICAgICAgICAgIGJvdW5kRWxlbWVudC50cmlnZ2VyKCdzaG93LnNwZWN0cnVtJywgWyBjb2xvck9uU2hvdyBdKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGhpZGUoZSkgewoKICAgICAgICAgICAgLy8gUmV0dXJuIG9uIHJpZ2h0IGNsaWNrCiAgICAgICAgICAgIGlmIChlICYmIGUudHlwZSA9PSAiY2xpY2siICYmIGUuYnV0dG9uID09IDIpIHsgcmV0dXJuOyB9CgogICAgICAgICAgICAvLyBSZXR1cm4gaWYgaGlkaW5nIGlzIHVubmVjZXNzYXJ5CiAgICAgICAgICAgIGlmICghdmlzaWJsZSB8fCBmbGF0KSB7IHJldHVybjsgfQogICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7CgogICAgICAgICAgICAkKGRvYykudW5iaW5kKCJjbGljay5zcGVjdHJ1bSIsIGhpZGUpOwogICAgICAgICAgICAkKHdpbmRvdykudW5iaW5kKCJyZXNpemUuc3BlY3RydW0iLCByZXNpemUpOwoKICAgICAgICAgICAgcmVwbGFjZXIucmVtb3ZlQ2xhc3MoInNwLWFjdGl2ZSIpOwogICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoInNwLWhpZGRlbiIpOwoKICAgICAgICAgICAgdmFyIGNvbG9ySGFzQ2hhbmdlZCA9ICF0aW55Y29sb3IuZXF1YWxzKGdldCgpLCBjb2xvck9uU2hvdyk7CgogICAgICAgICAgICBpZiAoY29sb3JIYXNDaGFuZ2VkKSB7CiAgICAgICAgICAgICAgICBpZiAoY2xpY2tvdXRGaXJlc0NoYW5nZSAmJiBlICE9PSAiY2FuY2VsIikgewogICAgICAgICAgICAgICAgICAgIHVwZGF0ZU9yaWdpbmFsSW5wdXQodHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FsbGJhY2tzLmhpZGUoZ2V0KCkpOwogICAgICAgICAgICBib3VuZEVsZW1lbnQudHJpZ2dlcignaGlkZS5zcGVjdHJ1bScsIFsgZ2V0KCkgXSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZXZlcnQoKSB7CiAgICAgICAgICAgIHNldChjb2xvck9uU2hvdywgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXQoY29sb3IsIGlnbm9yZUZvcm1hdENoYW5nZSkgewogICAgICAgICAgICBpZiAodGlueWNvbG9yLmVxdWFscyhjb2xvciwgZ2V0KCkpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBuZXdDb2xvcjsKICAgICAgICAgICAgaWYgKCFjb2xvciAmJiBhbGxvd0VtcHR5KSB7CiAgICAgICAgICAgICAgICBpc0VtcHR5ID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlzRW1wdHkgPSBmYWxzZTsKICAgICAgICAgICAgICAgIG5ld0NvbG9yID0gdGlueWNvbG9yKGNvbG9yKTsKICAgICAgICAgICAgICAgIHZhciBuZXdIc3YgPSBuZXdDb2xvci50b0hzdigpOwoKICAgICAgICAgICAgICAgIGN1cnJlbnRIdWUgPSAobmV3SHN2LmggJSAzNjApIC8gMzYwOwogICAgICAgICAgICAgICAgY3VycmVudFNhdHVyYXRpb24gPSBuZXdIc3YuczsKICAgICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IG5ld0hzdi52OwogICAgICAgICAgICAgICAgY3VycmVudEFscGhhID0gbmV3SHN2LmE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlVUkoKTsKCiAgICAgICAgICAgIGlmIChuZXdDb2xvciAmJiBuZXdDb2xvci5vayAmJiAhaWdub3JlRm9ybWF0Q2hhbmdlKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50UHJlZmVycmVkRm9ybWF0ID0gcHJlZmVycmVkRm9ybWF0IHx8IG5ld0NvbG9yLmZvcm1hdDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0KG9wdHMpIHsKICAgICAgICAgICAgb3B0cyA9IG9wdHMgfHwgeyB9OwoKICAgICAgICAgICAgaWYgKGFsbG93RW1wdHkgJiYgaXNFbXB0eSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aW55Y29sb3IuZnJvbVJhdGlvKHsKICAgICAgICAgICAgICAgIGg6IGN1cnJlbnRIdWUsCiAgICAgICAgICAgICAgICBzOiBjdXJyZW50U2F0dXJhdGlvbiwKICAgICAgICAgICAgICAgIHY6IGN1cnJlbnRWYWx1ZSwKICAgICAgICAgICAgICAgIGE6IE1hdGgucm91bmQoY3VycmVudEFscGhhICogMTAwKSAvIDEwMAogICAgICAgICAgICB9LCB7IGZvcm1hdDogb3B0cy5mb3JtYXQgfHwgY3VycmVudFByZWZlcnJlZEZvcm1hdCB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGlzVmFsaWQoKSB7CiAgICAgICAgICAgIHJldHVybiAhdGV4dElucHV0Lmhhc0NsYXNzKCJzcC12YWxpZGF0aW9uLWVycm9yIik7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtb3ZlKCkgewogICAgICAgICAgICB1cGRhdGVVSSgpOwoKICAgICAgICAgICAgY2FsbGJhY2tzLm1vdmUoZ2V0KCkpOwogICAgICAgICAgICBib3VuZEVsZW1lbnQudHJpZ2dlcignbW92ZS5zcGVjdHJ1bScsIFsgZ2V0KCkgXSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB1cGRhdGVVSSgpIHsKCiAgICAgICAgICAgIHRleHRJbnB1dC5yZW1vdmVDbGFzcygic3AtdmFsaWRhdGlvbi1lcnJvciIpOwoKICAgICAgICAgICAgdXBkYXRlSGVscGVyTG9jYXRpb25zKCk7CgogICAgICAgICAgICAvLyBVcGRhdGUgZHJhZ2dlciBiYWNrZ3JvdW5kIGNvbG9yIChncmFkaWVudHMgdGFrZSBjYXJlIG9mIHNhdHVyYXRpb24gYW5kIHZhbHVlKS4KICAgICAgICAgICAgdmFyIGZsYXRDb2xvciA9IHRpbnljb2xvci5mcm9tUmF0aW8oeyBoOiBjdXJyZW50SHVlLCBzOiAxLCB2OiAxIH0pOwogICAgICAgICAgICBkcmFnZ2VyLmNzcygiYmFja2dyb3VuZC1jb2xvciIsIGZsYXRDb2xvci50b0hleFN0cmluZygpKTsKCiAgICAgICAgICAgIC8vIEdldCBhIGZvcm1hdCB0aGF0IGFscGhhIHdpbGwgYmUgaW5jbHVkZWQgaW4gKGhleCBhbmQgbmFtZXMgaWdub3JlIGFscGhhKQogICAgICAgICAgICB2YXIgZm9ybWF0ID0gY3VycmVudFByZWZlcnJlZEZvcm1hdDsKICAgICAgICAgICAgaWYgKGN1cnJlbnRBbHBoYSA8IDEpIHsKICAgICAgICAgICAgICAgIGlmIChmb3JtYXQgPT09ICJoZXgiIHx8IGZvcm1hdCA9PT0gImhleDMiIHx8IGZvcm1hdCA9PT0gImhleDYiIHx8IGZvcm1hdCA9PT0gIm5hbWUiKSB7CiAgICAgICAgICAgICAgICAgICAgZm9ybWF0ID0gInJnYiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZWFsQ29sb3IgPSBnZXQoeyBmb3JtYXQ6IGZvcm1hdCB9KSwKICAgICAgICAgICAgICAgIGRpc3BsYXlDb2xvciA9ICcnOwoKICAgICAgICAgICAgIC8vcmVzZXQgYmFja2dyb3VuZCBpbmZvIGZvciBwcmV2aWV3IGVsZW1lbnQKICAgICAgICAgICAgcHJldmlld0VsZW1lbnQucmVtb3ZlQ2xhc3MoInNwLWNsZWFyLWRpc3BsYXkiKTsKICAgICAgICAgICAgcHJldmlld0VsZW1lbnQuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgJ3RyYW5zcGFyZW50Jyk7CgogICAgICAgICAgICBpZiAoIXJlYWxDb2xvciAmJiBhbGxvd0VtcHR5KSB7CiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHJlcGxhY2VkIGVsZW1lbnRzIGJhY2tncm91bmQgd2l0aCBpY29uIGluZGljYXRpbmcgbm8gY29sb3Igc2VsZWN0aW9uCiAgICAgICAgICAgICAgICBwcmV2aWV3RWxlbWVudC5hZGRDbGFzcygic3AtY2xlYXItZGlzcGxheSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICB2YXIgcmVhbEhleCA9IHJlYWxDb2xvci50b0hleFN0cmluZygpLAogICAgICAgICAgICAgICAgICAgIHJlYWxSZ2IgPSByZWFsQ29sb3IudG9SZ2JTdHJpbmcoKTsKCiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHJlcGxhY2VkIGVsZW1lbnRzIGJhY2tncm91bmQgY29sb3IgKHdpdGggYWN0dWFsIHNlbGVjdGVkIGNvbG9yKQogICAgICAgICAgICAgICAgaWYgKHJnYmFTdXBwb3J0IHx8IHJlYWxDb2xvci5hbHBoYSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIHByZXZpZXdFbGVtZW50LmNzcygiYmFja2dyb3VuZC1jb2xvciIsIHJlYWxSZ2IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcHJldmlld0VsZW1lbnQuY3NzKCJiYWNrZ3JvdW5kLWNvbG9yIiwgInRyYW5zcGFyZW50Iik7CiAgICAgICAgICAgICAgICAgICAgcHJldmlld0VsZW1lbnQuY3NzKCJmaWx0ZXIiLCByZWFsQ29sb3IudG9GaWx0ZXIoKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKG9wdHMuc2hvd0FscGhhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJnYiA9IHJlYWxDb2xvci50b1JnYigpOwogICAgICAgICAgICAgICAgICAgIHJnYi5hID0gMDsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhbEFscGhhID0gdGlueWNvbG9yKHJnYikudG9SZ2JTdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZ3JhZGllbnQgPSAibGluZWFyLWdyYWRpZW50KGxlZnQsICIgKyByZWFsQWxwaGEgKyAiLCAiICsgcmVhbEhleCArICIpIjsKCiAgICAgICAgICAgICAgICAgICAgaWYgKElFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhU2xpZGVySW5uZXIuY3NzKCJmaWx0ZXIiLCB0aW55Y29sb3IocmVhbEFscGhhKS50b0ZpbHRlcih7IGdyYWRpZW50VHlwZTogMSB9LCByZWFsSGV4KSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBhbHBoYVNsaWRlcklubmVyLmNzcygiYmFja2dyb3VuZCIsICItd2Via2l0LSIgKyBncmFkaWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhU2xpZGVySW5uZXIuY3NzKCJiYWNrZ3JvdW5kIiwgIi1tb3otIiArIGdyYWRpZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGFTbGlkZXJJbm5lci5jc3MoImJhY2tncm91bmQiLCAiLW1zLSIgKyBncmFkaWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhU2xpZGVySW5uZXIuY3NzKCJiYWNrZ3JvdW5kIiwgZ3JhZGllbnQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkaXNwbGF5Q29sb3IgPSByZWFsQ29sb3IudG9TdHJpbmcoZm9ybWF0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHRleHQgZW50cnkgaW5wdXQgYXMgaXQgY2hhbmdlcyBoYXBwZW4KICAgICAgICAgICAgaWYgKG9wdHMuc2hvd0lucHV0KSB7CiAgICAgICAgICAgICAgICB0ZXh0SW5wdXQudmFsKGRpc3BsYXlDb2xvcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChvcHRzLnNob3dQYWxldHRlKSB7CiAgICAgICAgICAgICAgICBkcmF3UGFsZXR0ZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkcmF3SW5pdGlhbCgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlSGVscGVyTG9jYXRpb25zKCkgewogICAgICAgICAgICB2YXIgcyA9IGN1cnJlbnRTYXR1cmF0aW9uOwogICAgICAgICAgICB2YXIgdiA9IGN1cnJlbnRWYWx1ZTsKCiAgICAgICAgICAgIGlmKGFsbG93RW1wdHkgJiYgaXNFbXB0eSkgewogICAgICAgICAgICAgICAgLy9pZiBzZWxlY3RlZCBjb2xvciBpcyBlbXB0eSwgaGlkZSB0aGUgaGVscGVycwogICAgICAgICAgICAgICAgYWxwaGFTbGlkZUhlbHBlci5oaWRlKCk7CiAgICAgICAgICAgICAgICBzbGlkZUhlbHBlci5oaWRlKCk7CiAgICAgICAgICAgICAgICBkcmFnSGVscGVyLmhpZGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vbWFrZSBzdXJlIGhlbHBlcnMgYXJlIHZpc2libGUKICAgICAgICAgICAgICAgIGFscGhhU2xpZGVIZWxwZXIuc2hvdygpOwogICAgICAgICAgICAgICAgc2xpZGVIZWxwZXIuc2hvdygpOwogICAgICAgICAgICAgICAgZHJhZ0hlbHBlci5zaG93KCk7CgogICAgICAgICAgICAgICAgLy8gV2hlcmUgdG8gc2hvdyB0aGUgbGl0dGxlIGNpcmNsZSBpbiB0aGF0IGRpc3BsYXlzIHlvdXIgY3VycmVudCBzZWxlY3RlZCBjb2xvcgogICAgICAgICAgICAgICAgdmFyIGRyYWdYID0gcyAqIGRyYWdXaWR0aDsKICAgICAgICAgICAgICAgIHZhciBkcmFnWSA9IGRyYWdIZWlnaHQgLSAodiAqIGRyYWdIZWlnaHQpOwogICAgICAgICAgICAgICAgZHJhZ1ggPSBNYXRoLm1heCgKICAgICAgICAgICAgICAgICAgICAtZHJhZ0hlbHBlckhlaWdodCwKICAgICAgICAgICAgICAgICAgICBNYXRoLm1pbihkcmFnV2lkdGggLSBkcmFnSGVscGVySGVpZ2h0LCBkcmFnWCAtIGRyYWdIZWxwZXJIZWlnaHQpCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgZHJhZ1kgPSBNYXRoLm1heCgKICAgICAgICAgICAgICAgICAgICAtZHJhZ0hlbHBlckhlaWdodCwKICAgICAgICAgICAgICAgICAgICBNYXRoLm1pbihkcmFnSGVpZ2h0IC0gZHJhZ0hlbHBlckhlaWdodCwgZHJhZ1kgLSBkcmFnSGVscGVySGVpZ2h0KQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGRyYWdIZWxwZXIuY3NzKHsKICAgICAgICAgICAgICAgICAgICAidG9wIjogZHJhZ1ksCiAgICAgICAgICAgICAgICAgICAgImxlZnQiOiBkcmFnWAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdmFyIGFscGhhWCA9IGN1cnJlbnRBbHBoYSAqIGFscGhhV2lkdGg7CiAgICAgICAgICAgICAgICBhbHBoYVNsaWRlSGVscGVyLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgImxlZnQiOiBhbHBoYVggLSAoYWxwaGFTbGlkZUhlbHBlcldpZHRoIC8gMikKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIFdoZXJlIHRvIHNob3cgdGhlIGJhciB0aGF0IGRpc3BsYXlzIHlvdXIgY3VycmVudCBzZWxlY3RlZCBodWUKICAgICAgICAgICAgICAgIHZhciBzbGlkZVkgPSAoY3VycmVudEh1ZSkgKiBzbGlkZUhlaWdodDsKICAgICAgICAgICAgICAgIHNsaWRlSGVscGVyLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgInRvcCI6IHNsaWRlWSAtIHNsaWRlSGVscGVySGVpZ2h0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlT3JpZ2luYWxJbnB1dChmaXJlQ2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIGNvbG9yID0gZ2V0KCksCiAgICAgICAgICAgICAgICBkaXNwbGF5Q29sb3IgPSAnJywKICAgICAgICAgICAgICAgIGhhc0NoYW5nZWQgPSAhdGlueWNvbG9yLmVxdWFscyhjb2xvciwgY29sb3JPblNob3cpOwoKICAgICAgICAgICAgaWYoY29sb3IpIHsKICAgICAgICAgICAgICAgIGRpc3BsYXlDb2xvciA9IGNvbG9yLnRvU3RyaW5nKGN1cnJlbnRQcmVmZXJyZWRGb3JtYXQpOwogICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBzZWxlY3Rpb24gcGFsZXR0ZSB3aXRoIHRoZSBjdXJyZW50IGNvbG9yCiAgICAgICAgICAgICAgICBhZGRDb2xvclRvU2VsZWN0aW9uUGFsZXR0ZShjb2xvcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc0lucHV0KSB7CiAgICAgICAgICAgICAgICBib3VuZEVsZW1lbnQudmFsKGRpc3BsYXlDb2xvcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbG9yT25TaG93ID0gY29sb3I7CgogICAgICAgICAgICBpZiAoZmlyZUNhbGxiYWNrICYmIGhhc0NoYW5nZWQpIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5jaGFuZ2UoY29sb3IpOwogICAgICAgICAgICAgICAgYm91bmRFbGVtZW50LnRyaWdnZXIoJ2NoYW5nZScsIFsgY29sb3IgXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlZmxvdygpIHsKICAgICAgICAgICAgZHJhZ1dpZHRoID0gZHJhZ2dlci53aWR0aCgpOwogICAgICAgICAgICBkcmFnSGVpZ2h0ID0gZHJhZ2dlci5oZWlnaHQoKTsKICAgICAgICAgICAgZHJhZ0hlbHBlckhlaWdodCA9IGRyYWdIZWxwZXIuaGVpZ2h0KCk7CiAgICAgICAgICAgIHNsaWRlV2lkdGggPSBzbGlkZXIud2lkdGgoKTsKICAgICAgICAgICAgc2xpZGVIZWlnaHQgPSBzbGlkZXIuaGVpZ2h0KCk7CiAgICAgICAgICAgIHNsaWRlSGVscGVySGVpZ2h0ID0gc2xpZGVIZWxwZXIuaGVpZ2h0KCk7CiAgICAgICAgICAgIGFscGhhV2lkdGggPSBhbHBoYVNsaWRlci53aWR0aCgpOwogICAgICAgICAgICBhbHBoYVNsaWRlSGVscGVyV2lkdGggPSBhbHBoYVNsaWRlSGVscGVyLndpZHRoKCk7CgogICAgICAgICAgICBpZiAoIWZsYXQpIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jc3MoInBvc2l0aW9uIiwgImFic29sdXRlIik7CiAgICAgICAgICAgICAgICBjb250YWluZXIub2Zmc2V0KGdldE9mZnNldChjb250YWluZXIsIG9mZnNldEVsZW1lbnQpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdXBkYXRlSGVscGVyTG9jYXRpb25zKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICBib3VuZEVsZW1lbnQuc2hvdygpOwogICAgICAgICAgICBvZmZzZXRFbGVtZW50LnVuYmluZCgiY2xpY2suc3BlY3RydW0gdG91Y2hzdGFydC5zcGVjdHJ1bSIpOwogICAgICAgICAgICBjb250YWluZXIucmVtb3ZlKCk7CiAgICAgICAgICAgIHJlcGxhY2VyLnJlbW92ZSgpOwogICAgICAgICAgICBzcGVjdHJ1bXNbc3BlY3QuaWRdID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG9wdGlvbihvcHRpb25OYW1lLCBvcHRpb25WYWx1ZSkgewogICAgICAgICAgICBpZiAob3B0aW9uTmFtZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJC5leHRlbmQoe30sIG9wdHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvcHRpb25WYWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb3B0c1tvcHRpb25OYW1lXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3B0c1tvcHRpb25OYW1lXSA9IG9wdGlvblZhbHVlOwogICAgICAgICAgICBhcHBseU9wdGlvbnMoKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGVuYWJsZSgpIHsKICAgICAgICAgICAgZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgYm91bmRFbGVtZW50LmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICBvZmZzZXRFbGVtZW50LnJlbW92ZUNsYXNzKCJzcC1kaXNhYmxlZCIpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZGlzYWJsZSgpIHsKICAgICAgICAgICAgaGlkZSgpOwogICAgICAgICAgICBkaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgIGJvdW5kRWxlbWVudC5hdHRyKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICBvZmZzZXRFbGVtZW50LmFkZENsYXNzKCJzcC1kaXNhYmxlZCIpOwogICAgICAgIH0KCiAgICAgICAgaW5pdGlhbGl6ZSgpOwoKICAgICAgICB2YXIgc3BlY3QgPSB7CiAgICAgICAgICAgIHNob3c6IHNob3csCiAgICAgICAgICAgIGhpZGU6IGhpZGUsCiAgICAgICAgICAgIHRvZ2dsZTogdG9nZ2xlLAogICAgICAgICAgICByZWZsb3c6IHJlZmxvdywKICAgICAgICAgICAgb3B0aW9uOiBvcHRpb24sCiAgICAgICAgICAgIGVuYWJsZTogZW5hYmxlLAogICAgICAgICAgICBkaXNhYmxlOiBkaXNhYmxlLAogICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICAgICAgICBzZXQoYyk7CiAgICAgICAgICAgICAgICB1cGRhdGVPcmlnaW5hbElucHV0KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldDogZ2V0LAogICAgICAgICAgICBkZXN0cm95OiBkZXN0cm95LAogICAgICAgICAgICBjb250YWluZXI6IGNvbnRhaW5lcgogICAgICAgIH07CgogICAgICAgIHNwZWN0LmlkID0gc3BlY3RydW1zLnB1c2goc3BlY3QpIC0gMTsKCiAgICAgICAgcmV0dXJuIHNwZWN0OwogICAgfQoKICAgIC8qKgogICAgKiBjaGVja09mZnNldCAtIGdldCB0aGUgb2Zmc2V0IGJlbG93L2Fib3ZlIGFuZCBsZWZ0L3JpZ2h0IGVsZW1lbnQgZGVwZW5kaW5nIG9uIHNjcmVlbiBwb3NpdGlvbgogICAgKiBUaGFua3MgaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkvYmxvYi9tYXN0ZXIvdWkvanF1ZXJ5LnVpLmRhdGVwaWNrZXIuanMKICAgICovCiAgICBmdW5jdGlvbiBnZXRPZmZzZXQocGlja2VyLCBpbnB1dCkgewogICAgICAgIHZhciBleHRyYVkgPSAwOwogICAgICAgIHZhciBkcFdpZHRoID0gcGlja2VyLm91dGVyV2lkdGgoKTsKICAgICAgICB2YXIgZHBIZWlnaHQgPSBwaWNrZXIub3V0ZXJIZWlnaHQoKTsKICAgICAgICB2YXIgaW5wdXRIZWlnaHQgPSBpbnB1dC5vdXRlckhlaWdodCgpOwogICAgICAgIHZhciBkb2MgPSBwaWNrZXJbMF0ub3duZXJEb2N1bWVudDsKICAgICAgICB2YXIgZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgdmFyIHZpZXdXaWR0aCA9IGRvY0VsZW0uY2xpZW50V2lkdGggKyAkKGRvYykuc2Nyb2xsTGVmdCgpOwogICAgICAgIHZhciB2aWV3SGVpZ2h0ID0gZG9jRWxlbS5jbGllbnRIZWlnaHQgKyAkKGRvYykuc2Nyb2xsVG9wKCk7CiAgICAgICAgdmFyIG9mZnNldCA9IGlucHV0Lm9mZnNldCgpOwogICAgICAgIG9mZnNldC50b3AgKz0gaW5wdXRIZWlnaHQ7CgogICAgICAgIG9mZnNldC5sZWZ0IC09CiAgICAgICAgICAgIE1hdGgubWluKG9mZnNldC5sZWZ0LCAob2Zmc2V0LmxlZnQgKyBkcFdpZHRoID4gdmlld1dpZHRoICYmIHZpZXdXaWR0aCA+IGRwV2lkdGgpID8KICAgICAgICAgICAgTWF0aC5hYnMob2Zmc2V0LmxlZnQgKyBkcFdpZHRoIC0gdmlld1dpZHRoKSA6IDApOwoKICAgICAgICBvZmZzZXQudG9wIC09CiAgICAgICAgICAgIE1hdGgubWluKG9mZnNldC50b3AsICgob2Zmc2V0LnRvcCArIGRwSGVpZ2h0ID4gdmlld0hlaWdodCAmJiB2aWV3SGVpZ2h0ID4gZHBIZWlnaHQpID8KICAgICAgICAgICAgTWF0aC5hYnMoZHBIZWlnaHQgKyBpbnB1dEhlaWdodCAtIGV4dHJhWSkgOiBleHRyYVkpKTsKCiAgICAgICAgcmV0dXJuIG9mZnNldDsKICAgIH0KCiAgICAvKioKICAgICogbm9vcCAtIGRvIG5vdGhpbmcKICAgICovCiAgICBmdW5jdGlvbiBub29wKCkgewoKICAgIH0KCiAgICAvKioKICAgICogc3RvcFByb3BhZ2F0aW9uIC0gbWFrZXMgdGhlIGNvZGUgb25seSBkb2luZyB0aGlzIGEgbGl0dGxlIGVhc2llciB0byByZWFkIGluIGxpbmUKICAgICovCiAgICBmdW5jdGlvbiBzdG9wUHJvcGFnYXRpb24oZSkgewogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAqIENyZWF0ZSBhIGZ1bmN0aW9uIGJvdW5kIHRvIGEgZ2l2ZW4gb2JqZWN0CiAgICAqIFRoYW5rcyB0byB1bmRlcnNjb3JlLmpzCiAgICAqLwogICAgZnVuY3Rpb24gYmluZChmdW5jLCBvYmopIHsKICAgICAgICB2YXIgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7CiAgICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkob2JqLCBhcmdzLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgICAgICB9OwogICAgfQoKICAgIC8qKgogICAgKiBMaWdodHdlaWdodCBkcmFnIGhlbHBlci4gIEhhbmRsZXMgY29udGFpbm1lbnQgd2l0aGluIHRoZSBlbGVtZW50LCBzbyB0aGF0CiAgICAqIHdoZW4gZHJhZ2dpbmcsIHRoZSB4IGlzIHdpdGhpbiBbMCxlbGVtZW50LndpZHRoXSBhbmQgeSBpcyB3aXRoaW4gWzAsZWxlbWVudC5oZWlnaHRdCiAgICAqLwogICAgZnVuY3Rpb24gZHJhZ2dhYmxlKGVsZW1lbnQsIG9ubW92ZSwgb25zdGFydCwgb25zdG9wKSB7CiAgICAgICAgb25tb3ZlID0gb25tb3ZlIHx8IGZ1bmN0aW9uICgpIHsgfTsKICAgICAgICBvbnN0YXJ0ID0gb25zdGFydCB8fCBmdW5jdGlvbiAoKSB7IH07CiAgICAgICAgb25zdG9wID0gb25zdG9wIHx8IGZ1bmN0aW9uICgpIHsgfTsKICAgICAgICB2YXIgZG9jID0gZWxlbWVudC5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50OwogICAgICAgIHZhciBkcmFnZ2luZyA9IGZhbHNlOwogICAgICAgIHZhciBvZmZzZXQgPSB7fTsKICAgICAgICB2YXIgbWF4SGVpZ2h0ID0gMDsKICAgICAgICB2YXIgbWF4V2lkdGggPSAwOwogICAgICAgIHZhciBoYXNUb3VjaCA9ICgnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cpOwoKICAgICAgICB2YXIgZHVyaW5nRHJhZ0V2ZW50cyA9IHt9OwogICAgICAgIGR1cmluZ0RyYWdFdmVudHNbInNlbGVjdHN0YXJ0Il0gPSBwcmV2ZW50OwogICAgICAgIGR1cmluZ0RyYWdFdmVudHNbImRyYWdzdGFydCJdID0gcHJldmVudDsKICAgICAgICBkdXJpbmdEcmFnRXZlbnRzWyJ0b3VjaG1vdmUgbW91c2Vtb3ZlIl0gPSBtb3ZlOwogICAgICAgIGR1cmluZ0RyYWdFdmVudHNbInRvdWNoZW5kIG1vdXNldXAiXSA9IHN0b3A7CgogICAgICAgIGZ1bmN0aW9uIHByZXZlbnQoZSkgewogICAgICAgICAgICBpZiAoZS5zdG9wUHJvcGFnYXRpb24pIHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGUucHJldmVudERlZmF1bHQpIHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlLnJldHVyblZhbHVlID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtb3ZlKGUpIHsKICAgICAgICAgICAgaWYgKGRyYWdnaW5nKSB7CiAgICAgICAgICAgICAgICAvLyBNb3VzZXVwIGhhcHBlbmVkIG91dHNpZGUgb2Ygd2luZG93CiAgICAgICAgICAgICAgICBpZiAoSUUgJiYgZG9jdW1lbnQuZG9jdW1lbnRNb2RlIDwgOSAmJiAhZS5idXR0b24pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RvcCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciB0b3VjaGVzID0gZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXM7CiAgICAgICAgICAgICAgICB2YXIgcGFnZVggPSB0b3VjaGVzID8gdG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVg7CiAgICAgICAgICAgICAgICB2YXIgcGFnZVkgPSB0b3VjaGVzID8gdG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7CgogICAgICAgICAgICAgICAgdmFyIGRyYWdYID0gTWF0aC5tYXgoMCwgTWF0aC5taW4ocGFnZVggLSBvZmZzZXQubGVmdCwgbWF4V2lkdGgpKTsKICAgICAgICAgICAgICAgIHZhciBkcmFnWSA9IE1hdGgubWF4KDAsIE1hdGgubWluKHBhZ2VZIC0gb2Zmc2V0LnRvcCwgbWF4SGVpZ2h0KSk7CgogICAgICAgICAgICAgICAgaWYgKGhhc1RvdWNoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU3RvcCBzY3JvbGxpbmcgaW4gaU9TCiAgICAgICAgICAgICAgICAgICAgcHJldmVudChlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBvbm1vdmUuYXBwbHkoZWxlbWVudCwgW2RyYWdYLCBkcmFnWSwgZV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHN0YXJ0KGUpIHsKICAgICAgICAgICAgdmFyIHJpZ2h0Y2xpY2sgPSAoZS53aGljaCkgPyAoZS53aGljaCA9PSAzKSA6IChlLmJ1dHRvbiA9PSAyKTsKICAgICAgICAgICAgdmFyIHRvdWNoZXMgPSBlLm9yaWdpbmFsRXZlbnQudG91Y2hlczsKCiAgICAgICAgICAgIGlmICghcmlnaHRjbGljayAmJiAhZHJhZ2dpbmcpIHsKICAgICAgICAgICAgICAgIGlmIChvbnN0YXJ0LmFwcGx5KGVsZW1lbnQsIGFyZ3VtZW50cykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgZHJhZ2dpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIG1heEhlaWdodCA9ICQoZWxlbWVudCkuaGVpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGggPSAkKGVsZW1lbnQpLndpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gJChlbGVtZW50KS5vZmZzZXQoKTsKCiAgICAgICAgICAgICAgICAgICAgJChkb2MpLmJpbmQoZHVyaW5nRHJhZ0V2ZW50cyk7CiAgICAgICAgICAgICAgICAgICAgJChkb2MuYm9keSkuYWRkQ2xhc3MoInNwLWRyYWdnaW5nIik7CgogICAgICAgICAgICAgICAgICAgIGlmICghaGFzVG91Y2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbW92ZShlKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHByZXZlbnQoZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc3RvcCgpIHsKICAgICAgICAgICAgaWYgKGRyYWdnaW5nKSB7CiAgICAgICAgICAgICAgICAkKGRvYykudW5iaW5kKGR1cmluZ0RyYWdFdmVudHMpOwogICAgICAgICAgICAgICAgJChkb2MuYm9keSkucmVtb3ZlQ2xhc3MoInNwLWRyYWdnaW5nIik7CiAgICAgICAgICAgICAgICBvbnN0b3AuYXBwbHkoZWxlbWVudCwgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkcmFnZ2luZyA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgJChlbGVtZW50KS5iaW5kKCJ0b3VjaHN0YXJ0IG1vdXNlZG93biIsIHN0YXJ0KTsKICAgIH0KCiAgICBmdW5jdGlvbiB0aHJvdHRsZShmdW5jLCB3YWl0LCBkZWJvdW5jZSkgewogICAgICAgIHZhciB0aW1lb3V0OwogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjb250ZXh0ID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsKICAgICAgICAgICAgdmFyIHRocm90dGxlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgICAgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKGRlYm91bmNlKSBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgICAgIGlmIChkZWJvdW5jZSB8fCAhdGltZW91dCkgdGltZW91dCA9IHNldFRpbWVvdXQodGhyb3R0bGVyLCB3YWl0KTsKICAgICAgICB9OwogICAgfQoKCiAgICBmdW5jdGlvbiBsb2coKXsvKiBqc2hpbnQgLVcwMjEgKi9pZih3aW5kb3cuY29uc29sZSl7aWYoRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQpbG9nPUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5sb2csY29uc29sZSk7ZWxzZSBsb2c9ZnVuY3Rpb24oKXtGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuY2FsbChjb25zb2xlLmxvZyxjb25zb2xlLGFyZ3VtZW50cyk7fTtsb2cuYXBwbHkodGhpcyxhcmd1bWVudHMpO319CgogICAgLyoqCiAgICAqIERlZmluZSBhIGpRdWVyeSBwbHVnaW4KICAgICovCiAgICB2YXIgZGF0YUlEID0gInNwZWN0cnVtLmlkIjsKICAgICQuZm4uc3BlY3RydW0gPSBmdW5jdGlvbiAob3B0cywgZXh0cmEpIHsKCiAgICAgICAgaWYgKHR5cGVvZiBvcHRzID09ICJzdHJpbmciKSB7CgogICAgICAgICAgICB2YXIgcmV0dXJuVmFsdWUgPSB0aGlzOwogICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBhcmd1bWVudHMsIDEgKTsKCiAgICAgICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgc3BlY3QgPSBzcGVjdHJ1bXNbJCh0aGlzKS5kYXRhKGRhdGFJRCldOwogICAgICAgICAgICAgICAgaWYgKHNwZWN0KSB7CgogICAgICAgICAgICAgICAgICAgIHZhciBtZXRob2QgPSBzcGVjdFtvcHRzXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW1ldGhvZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoICJTcGVjdHJ1bTogbm8gc3VjaCBtZXRob2Q6ICciICsgb3B0cyArICInIiApOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdHMgPT0gImdldCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBzcGVjdC5nZXQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAob3B0cyA9PSAiY29udGFpbmVyIikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHNwZWN0LmNvbnRhaW5lcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAob3B0cyA9PSAib3B0aW9uIikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHNwZWN0Lm9wdGlvbi5hcHBseShzcGVjdCwgYXJncyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG9wdHMgPT0gImRlc3Ryb3kiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWN0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVEYXRhKGRhdGFJRCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2QuYXBwbHkoc3BlY3QsIGFyZ3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7CiAgICAgICAgfQoKICAgICAgICAvLyBJbml0aWFsaXppbmcgYSBuZXcgaW5zdGFuY2Ugb2Ygc3BlY3RydW0KICAgICAgICByZXR1cm4gdGhpcy5zcGVjdHJ1bSgiZGVzdHJveSIpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc3BlY3QgPSBzcGVjdHJ1bSh0aGlzLCBvcHRzKTsKICAgICAgICAgICAgJCh0aGlzKS5kYXRhKGRhdGFJRCwgc3BlY3QuaWQpOwogICAgICAgIH0pOwogICAgfTsKCiAgICAkLmZuLnNwZWN0cnVtLmxvYWQgPSB0cnVlOwogICAgJC5mbi5zcGVjdHJ1bS5sb2FkT3B0cyA9IHt9OwogICAgJC5mbi5zcGVjdHJ1bS5kcmFnZ2FibGUgPSBkcmFnZ2FibGU7CiAgICAkLmZuLnNwZWN0cnVtLmRlZmF1bHRzID0gZGVmYXVsdE9wdHM7CgogICAgJC5zcGVjdHJ1bSA9IHsgfTsKICAgICQuc3BlY3RydW0ubG9jYWxpemF0aW9uID0geyB9OwogICAgJC5zcGVjdHJ1bS5wYWxldHRlcyA9IHsgfTsKCiAgICAkLmZuLnNwZWN0cnVtLnByb2Nlc3NOYXRpdmVDb2xvcklucHV0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIWlucHV0VHlwZUNvbG9yU3VwcG9ydCkgewogICAgICAgICAgICAkKCJpbnB1dFt0eXBlPWNvbG9yXSIpLnNwZWN0cnVtKHsKICAgICAgICAgICAgICAgIHByZWZlcnJlZEZvcm1hdDogImhleDYiCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH07CgogICAgLy8gVGlueUNvbG9yIHYwLjkuMTYKICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9iZ3JpbnMvVGlueUNvbG9yCiAgICAvLyAyMDEzLTA4LTEwLCBCcmlhbiBHcmluc3RlYWQsIE1JVCBMaWNlbnNlCgogICAgKGZ1bmN0aW9uKCkgewoKICAgIHZhciB0cmltTGVmdCA9IC9eW1xzLCNdKy8sCiAgICAgICAgdHJpbVJpZ2h0ID0gL1xzKyQvLAogICAgICAgIHRpbnlDb3VudGVyID0gMCwKICAgICAgICBtYXRoID0gTWF0aCwKICAgICAgICBtYXRoUm91bmQgPSBtYXRoLnJvdW5kLAogICAgICAgIG1hdGhNaW4gPSBtYXRoLm1pbiwKICAgICAgICBtYXRoTWF4ID0gbWF0aC5tYXgsCiAgICAgICAgbWF0aFJhbmRvbSA9IG1hdGgucmFuZG9tOwoKICAgIGZ1bmN0aW9uIHRpbnljb2xvciAoY29sb3IsIG9wdHMpIHsKCiAgICAgICAgY29sb3IgPSAoY29sb3IpID8gY29sb3IgOiAnJzsKICAgICAgICBvcHRzID0gb3B0cyB8fCB7IH07CgogICAgICAgIC8vIElmIGlucHV0IGlzIGFscmVhZHkgYSB0aW55Y29sb3IsIHJldHVybiBpdHNlbGYKICAgICAgICBpZiAodHlwZW9mIGNvbG9yID09ICJvYmplY3QiICYmIGNvbG9yLmhhc093blByb3BlcnR5KCJfdGNfaWQiKSkgewogICAgICAgICAgIHJldHVybiBjb2xvcjsKICAgICAgICB9CgogICAgICAgIHZhciByZ2IgPSBpbnB1dFRvUkdCKGNvbG9yKTsKICAgICAgICB2YXIgciA9IHJnYi5yLAogICAgICAgICAgICBnID0gcmdiLmcsCiAgICAgICAgICAgIGIgPSByZ2IuYiwKICAgICAgICAgICAgYSA9IHJnYi5hLAogICAgICAgICAgICByb3VuZEEgPSBtYXRoUm91bmQoMTAwKmEpIC8gMTAwLAogICAgICAgICAgICBmb3JtYXQgPSBvcHRzLmZvcm1hdCB8fCByZ2IuZm9ybWF0OwoKICAgICAgICAvLyBEb24ndCBsZXQgdGhlIHJhbmdlIG9mIFswLDI1NV0gY29tZSBiYWNrIGluIFswLDFdLgogICAgICAgIC8vIFBvdGVudGlhbGx5IGxvc2UgYSBsaXR0bGUgYml0IG9mIHByZWNpc2lvbiBoZXJlLCBidXQgd2lsbCBmaXggaXNzdWVzIHdoZXJlCiAgICAgICAgLy8gLjUgZ2V0cyBpbnRlcnByZXRlZCBhcyBoYWxmIG9mIHRoZSB0b3RhbCwgaW5zdGVhZCBvZiBoYWxmIG9mIDEKICAgICAgICAvLyBJZiBpdCB3YXMgc3VwcG9zZWQgdG8gYmUgMTI4LCB0aGlzIHdhcyBhbHJlYWR5IHRha2VuIGNhcmUgb2YgYnkgYGlucHV0VG9SZ2JgCiAgICAgICAgaWYgKHIgPCAxKSB7IHIgPSBtYXRoUm91bmQocik7IH0KICAgICAgICBpZiAoZyA8IDEpIHsgZyA9IG1hdGhSb3VuZChnKTsgfQogICAgICAgIGlmIChiIDwgMSkgeyBiID0gbWF0aFJvdW5kKGIpOyB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG9rOiByZ2Iub2ssCiAgICAgICAgICAgIGZvcm1hdDogZm9ybWF0LAogICAgICAgICAgICBfdGNfaWQ6IHRpbnlDb3VudGVyKyssCiAgICAgICAgICAgIGFscGhhOiBhLAogICAgICAgICAgICBnZXRBbHBoYTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0QWxwaGE6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBhID0gYm91bmRBbHBoYSh2YWx1ZSk7CiAgICAgICAgICAgICAgICByb3VuZEEgPSBtYXRoUm91bmQoMTAwKmEpIC8gMTAwOwogICAgICAgICAgICB9LAogICAgICAgICAgICB0b0hzdjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgaHN2ID0gcmdiVG9Ic3YociwgZywgYik7CiAgICAgICAgICAgICAgICByZXR1cm4geyBoOiBoc3YuaCAqIDM2MCwgczogaHN2LnMsIHY6IGhzdi52LCBhOiBhIH07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvSHN2U3RyaW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBoc3YgPSByZ2JUb0hzdihyLCBnLCBiKTsKICAgICAgICAgICAgICAgIHZhciBoID0gbWF0aFJvdW5kKGhzdi5oICogMzYwKSwgcyA9IG1hdGhSb3VuZChoc3YucyAqIDEwMCksIHYgPSBtYXRoUm91bmQoaHN2LnYgKiAxMDApOwogICAgICAgICAgICAgICAgcmV0dXJuIChhID09IDEpID8KICAgICAgICAgICAgICAgICAgImhzdigiICArIGggKyAiLCAiICsgcyArICIlLCAiICsgdiArICIlKSIgOgogICAgICAgICAgICAgICAgICAiaHN2YSgiICsgaCArICIsICIgKyBzICsgIiUsICIgKyB2ICsgIiUsICIrIHJvdW5kQSArICIpIjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdG9Ic2w6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGhzbCA9IHJnYlRvSHNsKHIsIGcsIGIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHsgaDogaHNsLmggKiAzNjAsIHM6IGhzbC5zLCBsOiBoc2wubCwgYTogYSB9OwogICAgICAgICAgICB9LAogICAgICAgICAgICB0b0hzbFN0cmluZzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgaHNsID0gcmdiVG9Ic2wociwgZywgYik7CiAgICAgICAgICAgICAgICB2YXIgaCA9IG1hdGhSb3VuZChoc2wuaCAqIDM2MCksIHMgPSBtYXRoUm91bmQoaHNsLnMgKiAxMDApLCBsID0gbWF0aFJvdW5kKGhzbC5sICogMTAwKTsKICAgICAgICAgICAgICAgIHJldHVybiAoYSA9PSAxKSA/CiAgICAgICAgICAgICAgICAgICJoc2woIiAgKyBoICsgIiwgIiArIHMgKyAiJSwgIiArIGwgKyAiJSkiIDoKICAgICAgICAgICAgICAgICAgImhzbGEoIiArIGggKyAiLCAiICsgcyArICIlLCAiICsgbCArICIlLCAiKyByb3VuZEEgKyAiKSI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvSGV4OiBmdW5jdGlvbihhbGxvdzNDaGFyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmdiVG9IZXgociwgZywgYiwgYWxsb3czQ2hhcik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvSGV4U3RyaW5nOiBmdW5jdGlvbihhbGxvdzNDaGFyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJyMnICsgcmdiVG9IZXgociwgZywgYiwgYWxsb3czQ2hhcik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvUmdiOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7IHI6IG1hdGhSb3VuZChyKSwgZzogbWF0aFJvdW5kKGcpLCBiOiBtYXRoUm91bmQoYiksIGE6IGEgfTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdG9SZ2JTdHJpbmc6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIChhID09IDEpID8KICAgICAgICAgICAgICAgICAgInJnYigiICArIG1hdGhSb3VuZChyKSArICIsICIgKyBtYXRoUm91bmQoZykgKyAiLCAiICsgbWF0aFJvdW5kKGIpICsgIikiIDoKICAgICAgICAgICAgICAgICAgInJnYmEoIiArIG1hdGhSb3VuZChyKSArICIsICIgKyBtYXRoUm91bmQoZykgKyAiLCAiICsgbWF0aFJvdW5kKGIpICsgIiwgIiArIHJvdW5kQSArICIpIjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdG9QZXJjZW50YWdlUmdiOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7IHI6IG1hdGhSb3VuZChib3VuZDAxKHIsIDI1NSkgKiAxMDApICsgIiUiLCBnOiBtYXRoUm91bmQoYm91bmQwMShnLCAyNTUpICogMTAwKSArICIlIiwgYjogbWF0aFJvdW5kKGJvdW5kMDEoYiwgMjU1KSAqIDEwMCkgKyAiJSIsIGE6IGEgfTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdG9QZXJjZW50YWdlUmdiU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoYSA9PSAxKSA/CiAgICAgICAgICAgICAgICAgICJyZ2IoIiAgKyBtYXRoUm91bmQoYm91bmQwMShyLCAyNTUpICogMTAwKSArICIlLCAiICsgbWF0aFJvdW5kKGJvdW5kMDEoZywgMjU1KSAqIDEwMCkgKyAiJSwgIiArIG1hdGhSb3VuZChib3VuZDAxKGIsIDI1NSkgKiAxMDApICsgIiUpIiA6CiAgICAgICAgICAgICAgICAgICJyZ2JhKCIgKyBtYXRoUm91bmQoYm91bmQwMShyLCAyNTUpICogMTAwKSArICIlLCAiICsgbWF0aFJvdW5kKGJvdW5kMDEoZywgMjU1KSAqIDEwMCkgKyAiJSwgIiArIG1hdGhSb3VuZChib3VuZDAxKGIsIDI1NSkgKiAxMDApICsgIiUsICIgKyByb3VuZEEgKyAiKSI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvTmFtZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAoYSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAidHJhbnNwYXJlbnQiOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBoZXhOYW1lc1tyZ2JUb0hleChyLCBnLCBiLCB0cnVlKV0gfHwgZmFsc2U7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvRmlsdGVyOiBmdW5jdGlvbihzZWNvbmRDb2xvcikgewogICAgICAgICAgICAgICAgdmFyIGhleCA9IHJnYlRvSGV4KHIsIGcsIGIpOwogICAgICAgICAgICAgICAgdmFyIHNlY29uZEhleCA9IGhleDsKICAgICAgICAgICAgICAgIHZhciBhbHBoYUhleCA9IE1hdGgucm91bmQocGFyc2VGbG9hdChhKSAqIDI1NSkudG9TdHJpbmcoMTYpOwogICAgICAgICAgICAgICAgdmFyIHNlY29uZEFscGhhSGV4ID0gYWxwaGFIZXg7CiAgICAgICAgICAgICAgICB2YXIgZ3JhZGllbnRUeXBlID0gb3B0cyAmJiBvcHRzLmdyYWRpZW50VHlwZSA/ICJHcmFkaWVudFR5cGUgPSAxLCAiIDogIiI7CgogICAgICAgICAgICAgICAgaWYgKHNlY29uZENvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSB0aW55Y29sb3Ioc2Vjb25kQ29sb3IpOwogICAgICAgICAgICAgICAgICAgIHNlY29uZEhleCA9IHMudG9IZXgoKTsKICAgICAgICAgICAgICAgICAgICBzZWNvbmRBbHBoYUhleCA9IE1hdGgucm91bmQocGFyc2VGbG9hdChzLmFscGhhKSAqIDI1NSkudG9TdHJpbmcoMTYpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiAicHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LmdyYWRpZW50KCIrZ3JhZGllbnRUeXBlKyJzdGFydENvbG9yc3RyPSMiICsgcGFkMihhbHBoYUhleCkgKyBoZXggKyAiLGVuZENvbG9yc3RyPSMiICsgcGFkMihzZWNvbmRBbHBoYUhleCkgKyBzZWNvbmRIZXggKyAiKSI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbihmb3JtYXQpIHsKICAgICAgICAgICAgICAgIHZhciBmb3JtYXRTZXQgPSAhIWZvcm1hdDsKICAgICAgICAgICAgICAgIGZvcm1hdCA9IGZvcm1hdCB8fCB0aGlzLmZvcm1hdDsKCiAgICAgICAgICAgICAgICB2YXIgZm9ybWF0dGVkU3RyaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICB2YXIgaGFzQWxwaGFBbmRGb3JtYXROb3RTZXQgPSAhZm9ybWF0U2V0ICYmIGEgPCAxICYmIGEgPiAwOwogICAgICAgICAgICAgICAgdmFyIGZvcm1hdFdpdGhBbHBoYSA9IGhhc0FscGhhQW5kRm9ybWF0Tm90U2V0ICYmIChmb3JtYXQgPT09ICJoZXgiIHx8IGZvcm1hdCA9PT0gImhleDYiIHx8IGZvcm1hdCA9PT0gImhleDMiIHx8IGZvcm1hdCA9PT0gIm5hbWUiKTsKCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0ID09PSAicmdiIikgewogICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN0cmluZyA9IHRoaXMudG9SZ2JTdHJpbmcoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQgPT09ICJwcmdiIikgewogICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN0cmluZyA9IHRoaXMudG9QZXJjZW50YWdlUmdiU3RyaW5nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0ID09PSAiaGV4IiB8fCBmb3JtYXQgPT09ICJoZXg2IikgewogICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN0cmluZyA9IHRoaXMudG9IZXhTdHJpbmcoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXQgPT09ICJoZXgzIikgewogICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN0cmluZyA9IHRoaXMudG9IZXhTdHJpbmcodHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0ID09PSAibmFtZSIpIHsKICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRTdHJpbmcgPSB0aGlzLnRvTmFtZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGZvcm1hdCA9PT0gImhzbCIpIHsKICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRTdHJpbmcgPSB0aGlzLnRvSHNsU3RyaW5nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0ID09PSAiaHN2IikgewogICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN0cmluZyA9IHRoaXMudG9Ic3ZTdHJpbmcoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0V2l0aEFscGhhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9SZ2JTdHJpbmcoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVkU3RyaW5nIHx8IHRoaXMudG9IZXhTdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CgogICAgLy8gSWYgaW5wdXQgaXMgYW4gb2JqZWN0LCBmb3JjZSAxIGludG8gIjEuMCIgdG8gaGFuZGxlIHJhdGlvcyBwcm9wZXJseQogICAgLy8gU3RyaW5nIGlucHV0IHJlcXVpcmVzICIxLjAiIGFzIGlucHV0LCBzbyAxIHdpbGwgYmUgdHJlYXRlZCBhcyAxCiAgICB0aW55Y29sb3IuZnJvbVJhdGlvID0gZnVuY3Rpb24oY29sb3IsIG9wdHMpIHsKICAgICAgICBpZiAodHlwZW9mIGNvbG9yID09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIHZhciBuZXdDb2xvciA9IHt9OwogICAgICAgICAgICBmb3IgKHZhciBpIGluIGNvbG9yKSB7CiAgICAgICAgICAgICAgICBpZiAoY29sb3IuaGFzT3duUHJvcGVydHkoaSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gImEiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NvbG9yW2ldID0gY29sb3JbaV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBuZXdDb2xvcltpXSA9IGNvbnZlcnRUb1BlcmNlbnRhZ2UoY29sb3JbaV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb2xvciA9IG5ld0NvbG9yOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRpbnljb2xvcihjb2xvciwgb3B0cyk7CiAgICB9OwoKICAgIC8vIEdpdmVuIGEgc3RyaW5nIG9yIG9iamVjdCwgY29udmVydCB0aGF0IGlucHV0IHRvIFJHQgogICAgLy8gUG9zc2libGUgc3RyaW5nIGlucHV0czoKICAgIC8vCiAgICAvLyAgICAgInJlZCIKICAgIC8vICAgICAiI2YwMCIgb3IgImYwMCIKICAgIC8vICAgICAiI2ZmMDAwMCIgb3IgImZmMDAwMCIKICAgIC8vICAgICAicmdiIDI1NSAwIDAiIG9yICJyZ2IgKDI1NSwgMCwgMCkiCiAgICAvLyAgICAgInJnYiAxLjAgMCAwIiBvciAicmdiICgxLCAwLCAwKSIKICAgIC8vICAgICAicmdiYSAoMjU1LCAwLCAwLCAxKSIgb3IgInJnYmEgMjU1LCAwLCAwLCAxIgogICAgLy8gICAgICJyZ2JhICgxLjAsIDAsIDAsIDEpIiBvciAicmdiYSAxLjAsIDAsIDAsIDEiCiAgICAvLyAgICAgImhzbCgwLCAxMDAlLCA1MCUpIiBvciAiaHNsIDAgMTAwJSA1MCUiCiAgICAvLyAgICAgImhzbGEoMCwgMTAwJSwgNTAlLCAxKSIgb3IgImhzbGEgMCAxMDAlIDUwJSwgMSIKICAgIC8vICAgICAiaHN2KDAsIDEwMCUsIDEwMCUpIiBvciAiaHN2IDAgMTAwJSAxMDAlIgogICAgLy8KICAgIGZ1bmN0aW9uIGlucHV0VG9SR0IoY29sb3IpIHsKCiAgICAgICAgdmFyIHJnYiA9IHsgcjogMCwgZzogMCwgYjogMCB9OwogICAgICAgIHZhciBhID0gMTsKICAgICAgICB2YXIgb2sgPSBmYWxzZTsKICAgICAgICB2YXIgZm9ybWF0ID0gZmFsc2U7CgogICAgICAgIGlmICh0eXBlb2YgY29sb3IgPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgY29sb3IgPSBzdHJpbmdJbnB1dFRvT2JqZWN0KGNvbG9yKTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgY29sb3IgPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgaWYgKGNvbG9yLmhhc093blByb3BlcnR5KCJyIikgJiYgY29sb3IuaGFzT3duUHJvcGVydHkoImciKSAmJiBjb2xvci5oYXNPd25Qcm9wZXJ0eSgiYiIpKSB7CiAgICAgICAgICAgICAgICByZ2IgPSByZ2JUb1JnYihjb2xvci5yLCBjb2xvci5nLCBjb2xvci5iKTsKICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGZvcm1hdCA9IFN0cmluZyhjb2xvci5yKS5zdWJzdHIoLTEpID09PSAiJSIgPyAicHJnYiIgOiAicmdiIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChjb2xvci5oYXNPd25Qcm9wZXJ0eSgiaCIpICYmIGNvbG9yLmhhc093blByb3BlcnR5KCJzIikgJiYgY29sb3IuaGFzT3duUHJvcGVydHkoInYiKSkgewogICAgICAgICAgICAgICAgY29sb3IucyA9IGNvbnZlcnRUb1BlcmNlbnRhZ2UoY29sb3Iucyk7CiAgICAgICAgICAgICAgICBjb2xvci52ID0gY29udmVydFRvUGVyY2VudGFnZShjb2xvci52KTsKICAgICAgICAgICAgICAgIHJnYiA9IGhzdlRvUmdiKGNvbG9yLmgsIGNvbG9yLnMsIGNvbG9yLnYpOwogICAgICAgICAgICAgICAgb2sgPSB0cnVlOwogICAgICAgICAgICAgICAgZm9ybWF0ID0gImhzdiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY29sb3IuaGFzT3duUHJvcGVydHkoImgiKSAmJiBjb2xvci5oYXNPd25Qcm9wZXJ0eSgicyIpICYmIGNvbG9yLmhhc093blByb3BlcnR5KCJsIikpIHsKICAgICAgICAgICAgICAgIGNvbG9yLnMgPSBjb252ZXJ0VG9QZXJjZW50YWdlKGNvbG9yLnMpOwogICAgICAgICAgICAgICAgY29sb3IubCA9IGNvbnZlcnRUb1BlcmNlbnRhZ2UoY29sb3IubCk7CiAgICAgICAgICAgICAgICByZ2IgPSBoc2xUb1JnYihjb2xvci5oLCBjb2xvci5zLCBjb2xvci5sKTsKICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGZvcm1hdCA9ICJoc2wiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29sb3IuaGFzT3duUHJvcGVydHkoImEiKSkgewogICAgICAgICAgICAgICAgYSA9IGNvbG9yLmE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGEgPSBib3VuZEFscGhhKGEpOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvazogb2ssCiAgICAgICAgICAgIGZvcm1hdDogY29sb3IuZm9ybWF0IHx8IGZvcm1hdCwKICAgICAgICAgICAgcjogbWF0aE1pbigyNTUsIG1hdGhNYXgocmdiLnIsIDApKSwKICAgICAgICAgICAgZzogbWF0aE1pbigyNTUsIG1hdGhNYXgocmdiLmcsIDApKSwKICAgICAgICAgICAgYjogbWF0aE1pbigyNTUsIG1hdGhNYXgocmdiLmIsIDApKSwKICAgICAgICAgICAgYTogYQogICAgICAgIH07CiAgICB9CgoKICAgIC8vIENvbnZlcnNpb24gRnVuY3Rpb25zCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIGByZ2JUb0hzbGAsIGByZ2JUb0hzdmAsIGBoc2xUb1JnYmAsIGBoc3ZUb1JnYmAgbW9kaWZpZWQgZnJvbToKICAgIC8vIDxodHRwOi8vbWppamFja3Nvbi5jb20vMjAwOC8wMi9yZ2ItdG8taHNsLWFuZC1yZ2ItdG8taHN2LWNvbG9yLW1vZGVsLWNvbnZlcnNpb24tYWxnb3JpdGhtcy1pbi1qYXZhc2NyaXB0PgoKICAgIC8vIGByZ2JUb1JnYmAKICAgIC8vIEhhbmRsZSBib3VuZHMgLyBwZXJjZW50YWdlIGNoZWNraW5nIHRvIGNvbmZvcm0gdG8gQ1NTIGNvbG9yIHNwZWMKICAgIC8vIDxodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLWNvbG9yLz4KICAgIC8vICpBc3N1bWVzOiogciwgZywgYiBpbiBbMCwgMjU1XSBvciBbMCwgMV0KICAgIC8vICpSZXR1cm5zOiogeyByLCBnLCBiIH0gaW4gWzAsIDI1NV0KICAgIGZ1bmN0aW9uIHJnYlRvUmdiKHIsIGcsIGIpewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHI6IGJvdW5kMDEociwgMjU1KSAqIDI1NSwKICAgICAgICAgICAgZzogYm91bmQwMShnLCAyNTUpICogMjU1LAogICAgICAgICAgICBiOiBib3VuZDAxKGIsIDI1NSkgKiAyNTUKICAgICAgICB9OwogICAgfQoKICAgIC8vIGByZ2JUb0hzbGAKICAgIC8vIENvbnZlcnRzIGFuIFJHQiBjb2xvciB2YWx1ZSB0byBIU0wuCiAgICAvLyAqQXNzdW1lczoqIHIsIGcsIGFuZCBiIGFyZSBjb250YWluZWQgaW4gWzAsIDI1NV0gb3IgWzAsIDFdCiAgICAvLyAqUmV0dXJuczoqIHsgaCwgcywgbCB9IGluIFswLDFdCiAgICBmdW5jdGlvbiByZ2JUb0hzbChyLCBnLCBiKSB7CgogICAgICAgIHIgPSBib3VuZDAxKHIsIDI1NSk7CiAgICAgICAgZyA9IGJvdW5kMDEoZywgMjU1KTsKICAgICAgICBiID0gYm91bmQwMShiLCAyNTUpOwoKICAgICAgICB2YXIgbWF4ID0gbWF0aE1heChyLCBnLCBiKSwgbWluID0gbWF0aE1pbihyLCBnLCBiKTsKICAgICAgICB2YXIgaCwgcywgbCA9IChtYXggKyBtaW4pIC8gMjsKCiAgICAgICAgaWYobWF4ID09IG1pbikgewogICAgICAgICAgICBoID0gcyA9IDA7IC8vIGFjaHJvbWF0aWMKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBkID0gbWF4IC0gbWluOwogICAgICAgICAgICBzID0gbCA+IDAuNSA/IGQgLyAoMiAtIG1heCAtIG1pbikgOiBkIC8gKG1heCArIG1pbik7CiAgICAgICAgICAgIHN3aXRjaChtYXgpIHsKICAgICAgICAgICAgICAgIGNhc2UgcjogaCA9IChnIC0gYikgLyBkICsgKGcgPCBiID8gNiA6IDApOyBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgZzogaCA9IChiIC0gcikgLyBkICsgMjsgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGI6IGggPSAociAtIGcpIC8gZCArIDQ7IGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBoIC89IDY7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyBoOiBoLCBzOiBzLCBsOiBsIH07CiAgICB9CgogICAgLy8gYGhzbFRvUmdiYAogICAgLy8gQ29udmVydHMgYW4gSFNMIGNvbG9yIHZhbHVlIHRvIFJHQi4KICAgIC8vICpBc3N1bWVzOiogaCBpcyBjb250YWluZWQgaW4gWzAsIDFdIG9yIFswLCAzNjBdIGFuZCBzIGFuZCBsIGFyZSBjb250YWluZWQgWzAsIDFdIG9yIFswLCAxMDBdCiAgICAvLyAqUmV0dXJuczoqIHsgciwgZywgYiB9IGluIHRoZSBzZXQgWzAsIDI1NV0KICAgIGZ1bmN0aW9uIGhzbFRvUmdiKGgsIHMsIGwpIHsKICAgICAgICB2YXIgciwgZywgYjsKCiAgICAgICAgaCA9IGJvdW5kMDEoaCwgMzYwKTsKICAgICAgICBzID0gYm91bmQwMShzLCAxMDApOwogICAgICAgIGwgPSBib3VuZDAxKGwsIDEwMCk7CgogICAgICAgIGZ1bmN0aW9uIGh1ZTJyZ2IocCwgcSwgdCkgewogICAgICAgICAgICBpZih0IDwgMCkgdCArPSAxOwogICAgICAgICAgICBpZih0ID4gMSkgdCAtPSAxOwogICAgICAgICAgICBpZih0IDwgMS82KSByZXR1cm4gcCArIChxIC0gcCkgKiA2ICogdDsKICAgICAgICAgICAgaWYodCA8IDEvMikgcmV0dXJuIHE7CiAgICAgICAgICAgIGlmKHQgPCAyLzMpIHJldHVybiBwICsgKHEgLSBwKSAqICgyLzMgLSB0KSAqIDY7CiAgICAgICAgICAgIHJldHVybiBwOwogICAgICAgIH0KCiAgICAgICAgaWYocyA9PT0gMCkgewogICAgICAgICAgICByID0gZyA9IGIgPSBsOyAvLyBhY2hyb21hdGljCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgcSA9IGwgPCAwLjUgPyBsICogKDEgKyBzKSA6IGwgKyBzIC0gbCAqIHM7CiAgICAgICAgICAgIHZhciBwID0gMiAqIGwgLSBxOwogICAgICAgICAgICByID0gaHVlMnJnYihwLCBxLCBoICsgMS8zKTsKICAgICAgICAgICAgZyA9IGh1ZTJyZ2IocCwgcSwgaCk7CiAgICAgICAgICAgIGIgPSBodWUycmdiKHAsIHEsIGggLSAxLzMpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgcjogciAqIDI1NSwgZzogZyAqIDI1NSwgYjogYiAqIDI1NSB9OwogICAgfQoKICAgIC8vIGByZ2JUb0hzdmAKICAgIC8vIENvbnZlcnRzIGFuIFJHQiBjb2xvciB2YWx1ZSB0byBIU1YKICAgIC8vICpBc3N1bWVzOiogciwgZywgYW5kIGIgYXJlIGNvbnRhaW5lZCBpbiB0aGUgc2V0IFswLCAyNTVdIG9yIFswLCAxXQogICAgLy8gKlJldHVybnM6KiB7IGgsIHMsIHYgfSBpbiBbMCwxXQogICAgZnVuY3Rpb24gcmdiVG9Ic3YociwgZywgYikgewoKICAgICAgICByID0gYm91bmQwMShyLCAyNTUpOwogICAgICAgIGcgPSBib3VuZDAxKGcsIDI1NSk7CiAgICAgICAgYiA9IGJvdW5kMDEoYiwgMjU1KTsKCiAgICAgICAgdmFyIG1heCA9IG1hdGhNYXgociwgZywgYiksIG1pbiA9IG1hdGhNaW4ociwgZywgYik7CiAgICAgICAgdmFyIGgsIHMsIHYgPSBtYXg7CgogICAgICAgIHZhciBkID0gbWF4IC0gbWluOwogICAgICAgIHMgPSBtYXggPT09IDAgPyAwIDogZCAvIG1heDsKCiAgICAgICAgaWYobWF4ID09IG1pbikgewogICAgICAgICAgICBoID0gMDsgLy8gYWNocm9tYXRpYwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgc3dpdGNoKG1heCkgewogICAgICAgICAgICAgICAgY2FzZSByOiBoID0gKGcgLSBiKSAvIGQgKyAoZyA8IGIgPyA2IDogMCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBnOiBoID0gKGIgLSByKSAvIGQgKyAyOyBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgYjogaCA9IChyIC0gZykgLyBkICsgNDsgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaCAvPSA2OwogICAgICAgIH0KICAgICAgICByZXR1cm4geyBoOiBoLCBzOiBzLCB2OiB2IH07CiAgICB9CgogICAgLy8gYGhzdlRvUmdiYAogICAgLy8gQ29udmVydHMgYW4gSFNWIGNvbG9yIHZhbHVlIHRvIFJHQi4KICAgIC8vICpBc3N1bWVzOiogaCBpcyBjb250YWluZWQgaW4gWzAsIDFdIG9yIFswLCAzNjBdIGFuZCBzIGFuZCB2IGFyZSBjb250YWluZWQgaW4gWzAsIDFdIG9yIFswLCAxMDBdCiAgICAvLyAqUmV0dXJuczoqIHsgciwgZywgYiB9IGluIHRoZSBzZXQgWzAsIDI1NV0KICAgICBmdW5jdGlvbiBoc3ZUb1JnYihoLCBzLCB2KSB7CgogICAgICAgIGggPSBib3VuZDAxKGgsIDM2MCkgKiA2OwogICAgICAgIHMgPSBib3VuZDAxKHMsIDEwMCk7CiAgICAgICAgdiA9IGJvdW5kMDEodiwgMTAwKTsKCiAgICAgICAgdmFyIGkgPSBtYXRoLmZsb29yKGgpLAogICAgICAgICAgICBmID0gaCAtIGksCiAgICAgICAgICAgIHAgPSB2ICogKDEgLSBzKSwKICAgICAgICAgICAgcSA9IHYgKiAoMSAtIGYgKiBzKSwKICAgICAgICAgICAgdCA9IHYgKiAoMSAtICgxIC0gZikgKiBzKSwKICAgICAgICAgICAgbW9kID0gaSAlIDYsCiAgICAgICAgICAgIHIgPSBbdiwgcSwgcCwgcCwgdCwgdl1bbW9kXSwKICAgICAgICAgICAgZyA9IFt0LCB2LCB2LCBxLCBwLCBwXVttb2RdLAogICAgICAgICAgICBiID0gW3AsIHAsIHQsIHYsIHYsIHFdW21vZF07CgogICAgICAgIHJldHVybiB7IHI6IHIgKiAyNTUsIGc6IGcgKiAyNTUsIGI6IGIgKiAyNTUgfTsKICAgIH0KCiAgICAvLyBgcmdiVG9IZXhgCiAgICAvLyBDb252ZXJ0cyBhbiBSR0IgY29sb3IgdG8gaGV4CiAgICAvLyBBc3N1bWVzIHIsIGcsIGFuZCBiIGFyZSBjb250YWluZWQgaW4gdGhlIHNldCBbMCwgMjU1XQogICAgLy8gUmV0dXJucyBhIDMgb3IgNiBjaGFyYWN0ZXIgaGV4CiAgICBmdW5jdGlvbiByZ2JUb0hleChyLCBnLCBiLCBhbGxvdzNDaGFyKSB7CgogICAgICAgIHZhciBoZXggPSBbCiAgICAgICAgICAgIHBhZDIobWF0aFJvdW5kKHIpLnRvU3RyaW5nKDE2KSksCiAgICAgICAgICAgIHBhZDIobWF0aFJvdW5kKGcpLnRvU3RyaW5nKDE2KSksCiAgICAgICAgICAgIHBhZDIobWF0aFJvdW5kKGIpLnRvU3RyaW5nKDE2KSkKICAgICAgICBdOwoKICAgICAgICAvLyBSZXR1cm4gYSAzIGNoYXJhY3RlciBoZXggaWYgcG9zc2libGUKICAgICAgICBpZiAoYWxsb3czQ2hhciAmJiBoZXhbMF0uY2hhckF0KDApID09IGhleFswXS5jaGFyQXQoMSkgJiYgaGV4WzFdLmNoYXJBdCgwKSA9PSBoZXhbMV0uY2hhckF0KDEpICYmIGhleFsyXS5jaGFyQXQoMCkgPT0gaGV4WzJdLmNoYXJBdCgxKSkgewogICAgICAgICAgICByZXR1cm4gaGV4WzBdLmNoYXJBdCgwKSArIGhleFsxXS5jaGFyQXQoMCkgKyBoZXhbMl0uY2hhckF0KDApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGhleC5qb2luKCIiKTsKICAgIH0KCiAgICAvLyBgZXF1YWxzYAogICAgLy8gQ2FuIGJlIGNhbGxlZCB3aXRoIGFueSB0aW55Y29sb3IgaW5wdXQKICAgIHRpbnljb2xvci5lcXVhbHMgPSBmdW5jdGlvbiAoY29sb3IxLCBjb2xvcjIpIHsKICAgICAgICBpZiAoIWNvbG9yMSB8fCAhY29sb3IyKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIHJldHVybiB0aW55Y29sb3IoY29sb3IxKS50b1JnYlN0cmluZygpID09IHRpbnljb2xvcihjb2xvcjIpLnRvUmdiU3RyaW5nKCk7CiAgICB9OwogICAgdGlueWNvbG9yLnJhbmRvbSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aW55Y29sb3IuZnJvbVJhdGlvKHsKICAgICAgICAgICAgcjogbWF0aFJhbmRvbSgpLAogICAgICAgICAgICBnOiBtYXRoUmFuZG9tKCksCiAgICAgICAgICAgIGI6IG1hdGhSYW5kb20oKQogICAgICAgIH0pOwogICAgfTsKCgogICAgLy8gTW9kaWZpY2F0aW9uIEZ1bmN0aW9ucwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gVGhhbmtzIHRvIGxlc3MuanMgZm9yIHNvbWUgb2YgdGhlIGJhc2ljcyBoZXJlCiAgICAvLyA8aHR0cHM6Ly9naXRodWIuY29tL2Nsb3VkaGVhZC9sZXNzLmpzL2Jsb2IvbWFzdGVyL2xpYi9sZXNzL2Z1bmN0aW9ucy5qcz4KCiAgICB0aW55Y29sb3IuZGVzYXR1cmF0ZSA9IGZ1bmN0aW9uIChjb2xvciwgYW1vdW50KSB7CiAgICAgICAgYW1vdW50ID0gKGFtb3VudCA9PT0gMCkgPyAwIDogKGFtb3VudCB8fCAxMCk7CiAgICAgICAgdmFyIGhzbCA9IHRpbnljb2xvcihjb2xvcikudG9Ic2woKTsKICAgICAgICBoc2wucyAtPSBhbW91bnQgLyAxMDA7CiAgICAgICAgaHNsLnMgPSBjbGFtcDAxKGhzbC5zKTsKICAgICAgICByZXR1cm4gdGlueWNvbG9yKGhzbCk7CiAgICB9OwogICAgdGlueWNvbG9yLnNhdHVyYXRlID0gZnVuY3Rpb24gKGNvbG9yLCBhbW91bnQpIHsKICAgICAgICBhbW91bnQgPSAoYW1vdW50ID09PSAwKSA/IDAgOiAoYW1vdW50IHx8IDEwKTsKICAgICAgICB2YXIgaHNsID0gdGlueWNvbG9yKGNvbG9yKS50b0hzbCgpOwogICAgICAgIGhzbC5zICs9IGFtb3VudCAvIDEwMDsKICAgICAgICBoc2wucyA9IGNsYW1wMDEoaHNsLnMpOwogICAgICAgIHJldHVybiB0aW55Y29sb3IoaHNsKTsKICAgIH07CiAgICB0aW55Y29sb3IuZ3JleXNjYWxlID0gZnVuY3Rpb24oY29sb3IpIHsKICAgICAgICByZXR1cm4gdGlueWNvbG9yLmRlc2F0dXJhdGUoY29sb3IsIDEwMCk7CiAgICB9OwogICAgdGlueWNvbG9yLmxpZ2h0ZW4gPSBmdW5jdGlvbihjb2xvciwgYW1vdW50KSB7CiAgICAgICAgYW1vdW50ID0gKGFtb3VudCA9PT0gMCkgPyAwIDogKGFtb3VudCB8fCAxMCk7CiAgICAgICAgdmFyIGhzbCA9IHRpbnljb2xvcihjb2xvcikudG9Ic2woKTsKICAgICAgICBoc2wubCArPSBhbW91bnQgLyAxMDA7CiAgICAgICAgaHNsLmwgPSBjbGFtcDAxKGhzbC5sKTsKICAgICAgICByZXR1cm4gdGlueWNvbG9yKGhzbCk7CiAgICB9OwogICAgdGlueWNvbG9yLmRhcmtlbiA9IGZ1bmN0aW9uIChjb2xvciwgYW1vdW50KSB7CiAgICAgICAgYW1vdW50ID0gKGFtb3VudCA9PT0gMCkgPyAwIDogKGFtb3VudCB8fCAxMCk7CiAgICAgICAgdmFyIGhzbCA9IHRpbnljb2xvcihjb2xvcikudG9Ic2woKTsKICAgICAgICBoc2wubCAtPSBhbW91bnQgLyAxMDA7CiAgICAgICAgaHNsLmwgPSBjbGFtcDAxKGhzbC5sKTsKICAgICAgICByZXR1cm4gdGlueWNvbG9yKGhzbCk7CiAgICB9OwogICAgdGlueWNvbG9yLmNvbXBsZW1lbnQgPSBmdW5jdGlvbihjb2xvcikgewogICAgICAgIHZhciBoc2wgPSB0aW55Y29sb3IoY29sb3IpLnRvSHNsKCk7CiAgICAgICAgaHNsLmggPSAoaHNsLmggKyAxODApICUgMzYwOwogICAgICAgIHJldHVybiB0aW55Y29sb3IoaHNsKTsKICAgIH07CgoKICAgIC8vIENvbWJpbmF0aW9uIEZ1bmN0aW9ucwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBUaGFua3MgdG8galF1ZXJ5IHhDb2xvciBmb3Igc29tZSBvZiB0aGUgaWRlYXMgYmVoaW5kIHRoZXNlCiAgICAvLyA8aHR0cHM6Ly9naXRodWIuY29tL2luZnVzaW9uL2pRdWVyeS14Y29sb3IvYmxvYi9tYXN0ZXIvanF1ZXJ5Lnhjb2xvci5qcz4KCiAgICB0aW55Y29sb3IudHJpYWQgPSBmdW5jdGlvbihjb2xvcikgewogICAgICAgIHZhciBoc2wgPSB0aW55Y29sb3IoY29sb3IpLnRvSHNsKCk7CiAgICAgICAgdmFyIGggPSBoc2wuaDsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICB0aW55Y29sb3IoY29sb3IpLAogICAgICAgICAgICB0aW55Y29sb3IoeyBoOiAoaCArIDEyMCkgJSAzNjAsIHM6IGhzbC5zLCBsOiBoc2wubCB9KSwKICAgICAgICAgICAgdGlueWNvbG9yKHsgaDogKGggKyAyNDApICUgMzYwLCBzOiBoc2wucywgbDogaHNsLmwgfSkKICAgICAgICBdOwogICAgfTsKICAgIHRpbnljb2xvci50ZXRyYWQgPSBmdW5jdGlvbihjb2xvcikgewogICAgICAgIHZhciBoc2wgPSB0aW55Y29sb3IoY29sb3IpLnRvSHNsKCk7CiAgICAgICAgdmFyIGggPSBoc2wuaDsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICB0aW55Y29sb3IoY29sb3IpLAogICAgICAgICAgICB0aW55Y29sb3IoeyBoOiAoaCArIDkwKSAlIDM2MCwgczogaHNsLnMsIGw6IGhzbC5sIH0pLAogICAgICAgICAgICB0aW55Y29sb3IoeyBoOiAoaCArIDE4MCkgJSAzNjAsIHM6IGhzbC5zLCBsOiBoc2wubCB9KSwKICAgICAgICAgICAgdGlueWNvbG9yKHsgaDogKGggKyAyNzApICUgMzYwLCBzOiBoc2wucywgbDogaHNsLmwgfSkKICAgICAgICBdOwogICAgfTsKICAgIHRpbnljb2xvci5zcGxpdGNvbXBsZW1lbnQgPSBmdW5jdGlvbihjb2xvcikgewogICAgICAgIHZhciBoc2wgPSB0aW55Y29sb3IoY29sb3IpLnRvSHNsKCk7CiAgICAgICAgdmFyIGggPSBoc2wuaDsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICB0aW55Y29sb3IoY29sb3IpLAogICAgICAgICAgICB0aW55Y29sb3IoeyBoOiAoaCArIDcyKSAlIDM2MCwgczogaHNsLnMsIGw6IGhzbC5sfSksCiAgICAgICAgICAgIHRpbnljb2xvcih7IGg6IChoICsgMjE2KSAlIDM2MCwgczogaHNsLnMsIGw6IGhzbC5sfSkKICAgICAgICBdOwogICAgfTsKICAgIHRpbnljb2xvci5hbmFsb2dvdXMgPSBmdW5jdGlvbihjb2xvciwgcmVzdWx0cywgc2xpY2VzKSB7CiAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMgfHwgNjsKICAgICAgICBzbGljZXMgPSBzbGljZXMgfHwgMzA7CgogICAgICAgIHZhciBoc2wgPSB0aW55Y29sb3IoY29sb3IpLnRvSHNsKCk7CiAgICAgICAgdmFyIHBhcnQgPSAzNjAgLyBzbGljZXM7CiAgICAgICAgdmFyIHJldCA9IFt0aW55Y29sb3IoY29sb3IpXTsKCiAgICAgICAgZm9yIChoc2wuaCA9ICgoaHNsLmggLSAocGFydCAqIHJlc3VsdHMgPj4gMSkpICsgNzIwKSAlIDM2MDsgLS1yZXN1bHRzOyApIHsKICAgICAgICAgICAgaHNsLmggPSAoaHNsLmggKyBwYXJ0KSAlIDM2MDsKICAgICAgICAgICAgcmV0LnB1c2godGlueWNvbG9yKGhzbCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0OwogICAgfTsKICAgIHRpbnljb2xvci5tb25vY2hyb21hdGljID0gZnVuY3Rpb24oY29sb3IsIHJlc3VsdHMpIHsKICAgICAgICByZXN1bHRzID0gcmVzdWx0cyB8fCA2OwogICAgICAgIHZhciBoc3YgPSB0aW55Y29sb3IoY29sb3IpLnRvSHN2KCk7CiAgICAgICAgdmFyIGggPSBoc3YuaCwgcyA9IGhzdi5zLCB2ID0gaHN2LnY7CiAgICAgICAgdmFyIHJldCA9IFtdOwogICAgICAgIHZhciBtb2RpZmljYXRpb24gPSAxIC8gcmVzdWx0czsKCiAgICAgICAgd2hpbGUgKHJlc3VsdHMtLSkgewogICAgICAgICAgICByZXQucHVzaCh0aW55Y29sb3IoeyBoOiBoLCBzOiBzLCB2OiB2fSkpOwogICAgICAgICAgICB2ID0gKHYgKyBtb2RpZmljYXRpb24pICUgMTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXQ7CiAgICB9OwoKCiAgICAvLyBSZWFkYWJpbGl0eSBGdW5jdGlvbnMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gPGh0dHA6Ly93d3cudzMub3JnL1RSL0FFUlQjY29sb3ItY29udHJhc3Q+CgogICAgLy8gYHJlYWRhYmlsaXR5YAogICAgLy8gQW5hbHl6ZSB0aGUgMiBjb2xvcnMgYW5kIHJldHVybnMgYW4gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogICAgLy8gICAgYGJyaWdodG5lc3NgOiBkaWZmZXJlbmNlIGluIGJyaWdodG5lc3MgYmV0d2VlbiB0aGUgdHdvIGNvbG9ycwogICAgLy8gICAgYGNvbG9yYDogZGlmZmVyZW5jZSBpbiBjb2xvci9odWUgYmV0d2VlbiB0aGUgdHdvIGNvbG9ycwogICAgdGlueWNvbG9yLnJlYWRhYmlsaXR5ID0gZnVuY3Rpb24oY29sb3IxLCBjb2xvcjIpIHsKICAgICAgICB2YXIgYSA9IHRpbnljb2xvcihjb2xvcjEpLnRvUmdiKCk7CiAgICAgICAgdmFyIGIgPSB0aW55Y29sb3IoY29sb3IyKS50b1JnYigpOwogICAgICAgIHZhciBicmlnaHRuZXNzQSA9IChhLnIgKiAyOTkgKyBhLmcgKiA1ODcgKyBhLmIgKiAxMTQpIC8gMTAwMDsKICAgICAgICB2YXIgYnJpZ2h0bmVzc0IgPSAoYi5yICogMjk5ICsgYi5nICogNTg3ICsgYi5iICogMTE0KSAvIDEwMDA7CiAgICAgICAgdmFyIGNvbG9yRGlmZiA9ICgKICAgICAgICAgICAgTWF0aC5tYXgoYS5yLCBiLnIpIC0gTWF0aC5taW4oYS5yLCBiLnIpICsKICAgICAgICAgICAgTWF0aC5tYXgoYS5nLCBiLmcpIC0gTWF0aC5taW4oYS5nLCBiLmcpICsKICAgICAgICAgICAgTWF0aC5tYXgoYS5iLCBiLmIpIC0gTWF0aC5taW4oYS5iLCBiLmIpCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgYnJpZ2h0bmVzczogTWF0aC5hYnMoYnJpZ2h0bmVzc0EgLSBicmlnaHRuZXNzQiksCiAgICAgICAgICAgIGNvbG9yOiBjb2xvckRpZmYKICAgICAgICB9OwogICAgfTsKCiAgICAvLyBgcmVhZGFibGVgCiAgICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9BRVJUI2NvbG9yLWNvbnRyYXN0CiAgICAvLyBFbnN1cmUgdGhhdCBmb3JlZ3JvdW5kIGFuZCBiYWNrZ3JvdW5kIGNvbG9yIGNvbWJpbmF0aW9ucyBwcm92aWRlIHN1ZmZpY2llbnQgY29udHJhc3QuCiAgICAvLyAqRXhhbXBsZSoKICAgIC8vICAgIHRpbnljb2xvci5yZWFkYWJsZSgiIzAwMCIsICIjMTExIikgPT4gZmFsc2UKICAgIHRpbnljb2xvci5yZWFkYWJsZSA9IGZ1bmN0aW9uKGNvbG9yMSwgY29sb3IyKSB7CiAgICAgICAgdmFyIHJlYWRhYmlsaXR5ID0gdGlueWNvbG9yLnJlYWRhYmlsaXR5KGNvbG9yMSwgY29sb3IyKTsKICAgICAgICByZXR1cm4gcmVhZGFiaWxpdHkuYnJpZ2h0bmVzcyA+IDEyNSAmJiByZWFkYWJpbGl0eS5jb2xvciA+IDUwMDsKICAgIH07CgogICAgLy8gYG1vc3RSZWFkYWJsZWAKICAgIC8vIEdpdmVuIGEgYmFzZSBjb2xvciBhbmQgYSBsaXN0IG9mIHBvc3NpYmxlIGZvcmVncm91bmQgb3IgYmFja2dyb3VuZAogICAgLy8gY29sb3JzIGZvciB0aGF0IGJhc2UsIHJldHVybnMgdGhlIG1vc3QgcmVhZGFibGUgY29sb3IuCiAgICAvLyAqRXhhbXBsZSoKICAgIC8vICAgIHRpbnljb2xvci5tb3N0UmVhZGFibGUoIiMxMjMiLCBbIiNmZmYiLCAiIzAwMCJdKSA9PiAiIzAwMCIKICAgIHRpbnljb2xvci5tb3N0UmVhZGFibGUgPSBmdW5jdGlvbihiYXNlQ29sb3IsIGNvbG9yTGlzdCkgewogICAgICAgIHZhciBiZXN0Q29sb3IgPSBudWxsOwogICAgICAgIHZhciBiZXN0U2NvcmUgPSAwOwogICAgICAgIHZhciBiZXN0SXNSZWFkYWJsZSA9IGZhbHNlOwogICAgICAgIGZvciAodmFyIGk9MDsgaSA8IGNvbG9yTGlzdC5sZW5ndGg7IGkrKykgewoKICAgICAgICAgICAgLy8gV2Ugbm9ybWFsaXplIGJvdGggYXJvdW5kIHRoZSAiYWNjZXB0YWJsZSIgYnJlYWtpbmcgcG9pbnQsCiAgICAgICAgICAgIC8vIGJ1dCByYW5rIGJyaWdodG5lc3MgY29uc3RyYXN0IGhpZ2hlciB0aGFuIGh1ZS4KCiAgICAgICAgICAgIHZhciByZWFkYWJpbGl0eSA9IHRpbnljb2xvci5yZWFkYWJpbGl0eShiYXNlQ29sb3IsIGNvbG9yTGlzdFtpXSk7CiAgICAgICAgICAgIHZhciByZWFkYWJsZSA9IHJlYWRhYmlsaXR5LmJyaWdodG5lc3MgPiAxMjUgJiYgcmVhZGFiaWxpdHkuY29sb3IgPiA1MDA7CiAgICAgICAgICAgIHZhciBzY29yZSA9IDMgKiAocmVhZGFiaWxpdHkuYnJpZ2h0bmVzcyAvIDEyNSkgKyAocmVhZGFiaWxpdHkuY29sb3IgLyA1MDApOwoKICAgICAgICAgICAgaWYgKChyZWFkYWJsZSAmJiAhIGJlc3RJc1JlYWRhYmxlKSB8fAogICAgICAgICAgICAgICAgKHJlYWRhYmxlICYmIGJlc3RJc1JlYWRhYmxlICYmIHNjb3JlID4gYmVzdFNjb3JlKSB8fAogICAgICAgICAgICAgICAgKCghIHJlYWRhYmxlKSAmJiAoISBiZXN0SXNSZWFkYWJsZSkgJiYgc2NvcmUgPiBiZXN0U2NvcmUpKSB7CiAgICAgICAgICAgICAgICBiZXN0SXNSZWFkYWJsZSA9IHJlYWRhYmxlOwogICAgICAgICAgICAgICAgYmVzdFNjb3JlID0gc2NvcmU7CiAgICAgICAgICAgICAgICBiZXN0Q29sb3IgPSB0aW55Y29sb3IoY29sb3JMaXN0W2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYmVzdENvbG9yOwogICAgfTsKCgogICAgLy8gQmlnIExpc3Qgb2YgQ29sb3JzCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIDxodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLWNvbG9yLyNzdmctY29sb3I+CiAgICB2YXIgbmFtZXMgPSB0aW55Y29sb3IubmFtZXMgPSB7CiAgICAgICAgYWxpY2VibHVlOiAiZjBmOGZmIiwKICAgICAgICBhbnRpcXVld2hpdGU6ICJmYWViZDciLAogICAgICAgIGFxdWE6ICIwZmYiLAogICAgICAgIGFxdWFtYXJpbmU6ICI3ZmZmZDQiLAogICAgICAgIGF6dXJlOiAiZjBmZmZmIiwKICAgICAgICBiZWlnZTogImY1ZjVkYyIsCiAgICAgICAgYmlzcXVlOiAiZmZlNGM0IiwKICAgICAgICBibGFjazogIjAwMCIsCiAgICAgICAgYmxhbmNoZWRhbG1vbmQ6ICJmZmViY2QiLAogICAgICAgIGJsdWU6ICIwMGYiLAogICAgICAgIGJsdWV2aW9sZXQ6ICI4YTJiZTIiLAogICAgICAgIGJyb3duOiAiYTUyYTJhIiwKICAgICAgICBidXJseXdvb2Q6ICJkZWI4ODciLAogICAgICAgIGJ1cm50c2llbm5hOiAiZWE3ZTVkIiwKICAgICAgICBjYWRldGJsdWU6ICI1ZjllYTAiLAogICAgICAgIGNoYXJ0cmV1c2U6ICI3ZmZmMDAiLAogICAgICAgIGNob2NvbGF0ZTogImQyNjkxZSIsCiAgICAgICAgY29yYWw6ICJmZjdmNTAiLAogICAgICAgIGNvcm5mbG93ZXJibHVlOiAiNjQ5NWVkIiwKICAgICAgICBjb3Juc2lsazogImZmZjhkYyIsCiAgICAgICAgY3JpbXNvbjogImRjMTQzYyIsCiAgICAgICAgY3lhbjogIjBmZiIsCiAgICAgICAgZGFya2JsdWU6ICIwMDAwOGIiLAogICAgICAgIGRhcmtjeWFuOiAiMDA4YjhiIiwKICAgICAgICBkYXJrZ29sZGVucm9kOiAiYjg4NjBiIiwKICAgICAgICBkYXJrZ3JheTogImE5YTlhOSIsCiAgICAgICAgZGFya2dyZWVuOiAiMDA2NDAwIiwKICAgICAgICBkYXJrZ3JleTogImE5YTlhOSIsCiAgICAgICAgZGFya2toYWtpOiAiYmRiNzZiIiwKICAgICAgICBkYXJrbWFnZW50YTogIjhiMDA4YiIsCiAgICAgICAgZGFya29saXZlZ3JlZW46ICI1NTZiMmYiLAogICAgICAgIGRhcmtvcmFuZ2U6ICJmZjhjMDAiLAogICAgICAgIGRhcmtvcmNoaWQ6ICI5OTMyY2MiLAogICAgICAgIGRhcmtyZWQ6ICI4YjAwMDAiLAogICAgICAgIGRhcmtzYWxtb246ICJlOTk2N2EiLAogICAgICAgIGRhcmtzZWFncmVlbjogIjhmYmM4ZiIsCiAgICAgICAgZGFya3NsYXRlYmx1ZTogIjQ4M2Q4YiIsCiAgICAgICAgZGFya3NsYXRlZ3JheTogIjJmNGY0ZiIsCiAgICAgICAgZGFya3NsYXRlZ3JleTogIjJmNGY0ZiIsCiAgICAgICAgZGFya3R1cnF1b2lzZTogIjAwY2VkMSIsCiAgICAgICAgZGFya3Zpb2xldDogIjk0MDBkMyIsCiAgICAgICAgZGVlcHBpbms6ICJmZjE0OTMiLAogICAgICAgIGRlZXBza3libHVlOiAiMDBiZmZmIiwKICAgICAgICBkaW1ncmF5OiAiNjk2OTY5IiwKICAgICAgICBkaW1ncmV5OiAiNjk2OTY5IiwKICAgICAgICBkb2RnZXJibHVlOiAiMWU5MGZmIiwKICAgICAgICBmaXJlYnJpY2s6ICJiMjIyMjIiLAogICAgICAgIGZsb3JhbHdoaXRlOiAiZmZmYWYwIiwKICAgICAgICBmb3Jlc3RncmVlbjogIjIyOGIyMiIsCiAgICAgICAgZnVjaHNpYTogImYwZiIsCiAgICAgICAgZ2FpbnNib3JvOiAiZGNkY2RjIiwKICAgICAgICBnaG9zdHdoaXRlOiAiZjhmOGZmIiwKICAgICAgICBnb2xkOiAiZmZkNzAwIiwKICAgICAgICBnb2xkZW5yb2Q6ICJkYWE1MjAiLAogICAgICAgIGdyYXk6ICI4MDgwODAiLAogICAgICAgIGdyZWVuOiAiMDA4MDAwIiwKICAgICAgICBncmVlbnllbGxvdzogImFkZmYyZiIsCiAgICAgICAgZ3JleTogIjgwODA4MCIsCiAgICAgICAgaG9uZXlkZXc6ICJmMGZmZjAiLAogICAgICAgIGhvdHBpbms6ICJmZjY5YjQiLAogICAgICAgIGluZGlhbnJlZDogImNkNWM1YyIsCiAgICAgICAgaW5kaWdvOiAiNGIwMDgyIiwKICAgICAgICBpdm9yeTogImZmZmZmMCIsCiAgICAgICAga2hha2k6ICJmMGU2OGMiLAogICAgICAgIGxhdmVuZGVyOiAiZTZlNmZhIiwKICAgICAgICBsYXZlbmRlcmJsdXNoOiAiZmZmMGY1IiwKICAgICAgICBsYXduZ3JlZW46ICI3Y2ZjMDAiLAogICAgICAgIGxlbW9uY2hpZmZvbjogImZmZmFjZCIsCiAgICAgICAgbGlnaHRibHVlOiAiYWRkOGU2IiwKICAgICAgICBsaWdodGNvcmFsOiAiZjA4MDgwIiwKICAgICAgICBsaWdodGN5YW46ICJlMGZmZmYiLAogICAgICAgIGxpZ2h0Z29sZGVucm9keWVsbG93OiAiZmFmYWQyIiwKICAgICAgICBsaWdodGdyYXk6ICJkM2QzZDMiLAogICAgICAgIGxpZ2h0Z3JlZW46ICI5MGVlOTAiLAogICAgICAgIGxpZ2h0Z3JleTogImQzZDNkMyIsCiAgICAgICAgbGlnaHRwaW5rOiAiZmZiNmMxIiwKICAgICAgICBsaWdodHNhbG1vbjogImZmYTA3YSIsCiAgICAgICAgbGlnaHRzZWFncmVlbjogIjIwYjJhYSIsCiAgICAgICAgbGlnaHRza3libHVlOiAiODdjZWZhIiwKICAgICAgICBsaWdodHNsYXRlZ3JheTogIjc4OSIsCiAgICAgICAgbGlnaHRzbGF0ZWdyZXk6ICI3ODkiLAogICAgICAgIGxpZ2h0c3RlZWxibHVlOiAiYjBjNGRlIiwKICAgICAgICBsaWdodHllbGxvdzogImZmZmZlMCIsCiAgICAgICAgbGltZTogIjBmMCIsCiAgICAgICAgbGltZWdyZWVuOiAiMzJjZDMyIiwKICAgICAgICBsaW5lbjogImZhZjBlNiIsCiAgICAgICAgbWFnZW50YTogImYwZiIsCiAgICAgICAgbWFyb29uOiAiODAwMDAwIiwKICAgICAgICBtZWRpdW1hcXVhbWFyaW5lOiAiNjZjZGFhIiwKICAgICAgICBtZWRpdW1ibHVlOiAiMDAwMGNkIiwKICAgICAgICBtZWRpdW1vcmNoaWQ6ICJiYTU1ZDMiLAogICAgICAgIG1lZGl1bXB1cnBsZTogIjkzNzBkYiIsCiAgICAgICAgbWVkaXVtc2VhZ3JlZW46ICIzY2IzNzEiLAogICAgICAgIG1lZGl1bXNsYXRlYmx1ZTogIjdiNjhlZSIsCiAgICAgICAgbWVkaXVtc3ByaW5nZ3JlZW46ICIwMGZhOWEiLAogICAgICAgIG1lZGl1bXR1cnF1b2lzZTogIjQ4ZDFjYyIsCiAgICAgICAgbWVkaXVtdmlvbGV0cmVkOiAiYzcxNTg1IiwKICAgICAgICBtaWRuaWdodGJsdWU6ICIxOTE5NzAiLAogICAgICAgIG1pbnRjcmVhbTogImY1ZmZmYSIsCiAgICAgICAgbWlzdHlyb3NlOiAiZmZlNGUxIiwKICAgICAgICBtb2NjYXNpbjogImZmZTRiNSIsCiAgICAgICAgbmF2YWpvd2hpdGU6ICJmZmRlYWQiLAogICAgICAgIG5hdnk6ICIwMDAwODAiLAogICAgICAgIG9sZGxhY2U6ICJmZGY1ZTYiLAogICAgICAgIG9saXZlOiAiODA4MDAwIiwKICAgICAgICBvbGl2ZWRyYWI6ICI2YjhlMjMiLAogICAgICAgIG9yYW5nZTogImZmYTUwMCIsCiAgICAgICAgb3JhbmdlcmVkOiAiZmY0NTAwIiwKICAgICAgICBvcmNoaWQ6ICJkYTcwZDYiLAogICAgICAgIHBhbGVnb2xkZW5yb2Q6ICJlZWU4YWEiLAogICAgICAgIHBhbGVncmVlbjogIjk4ZmI5OCIsCiAgICAgICAgcGFsZXR1cnF1b2lzZTogImFmZWVlZSIsCiAgICAgICAgcGFsZXZpb2xldHJlZDogImRiNzA5MyIsCiAgICAgICAgcGFwYXlhd2hpcDogImZmZWZkNSIsCiAgICAgICAgcGVhY2hwdWZmOiAiZmZkYWI5IiwKICAgICAgICBwZXJ1OiAiY2Q4NTNmIiwKICAgICAgICBwaW5rOiAiZmZjMGNiIiwKICAgICAgICBwbHVtOiAiZGRhMGRkIiwKICAgICAgICBwb3dkZXJibHVlOiAiYjBlMGU2IiwKICAgICAgICBwdXJwbGU6ICI4MDAwODAiLAogICAgICAgIHJlZDogImYwMCIsCiAgICAgICAgcm9zeWJyb3duOiAiYmM4ZjhmIiwKICAgICAgICByb3lhbGJsdWU6ICI0MTY5ZTEiLAogICAgICAgIHNhZGRsZWJyb3duOiAiOGI0NTEzIiwKICAgICAgICBzYWxtb246ICJmYTgwNzIiLAogICAgICAgIHNhbmR5YnJvd246ICJmNGE0NjAiLAogICAgICAgIHNlYWdyZWVuOiAiMmU4YjU3IiwKICAgICAgICBzZWFzaGVsbDogImZmZjVlZSIsCiAgICAgICAgc2llbm5hOiAiYTA1MjJkIiwKICAgICAgICBzaWx2ZXI6ICJjMGMwYzAiLAogICAgICAgIHNreWJsdWU6ICI4N2NlZWIiLAogICAgICAgIHNsYXRlYmx1ZTogIjZhNWFjZCIsCiAgICAgICAgc2xhdGVncmF5OiAiNzA4MDkwIiwKICAgICAgICBzbGF0ZWdyZXk6ICI3MDgwOTAiLAogICAgICAgIHNub3c6ICJmZmZhZmEiLAogICAgICAgIHNwcmluZ2dyZWVuOiAiMDBmZjdmIiwKICAgICAgICBzdGVlbGJsdWU6ICI0NjgyYjQiLAogICAgICAgIHRhbjogImQyYjQ4YyIsCiAgICAgICAgdGVhbDogIjAwODA4MCIsCiAgICAgICAgdGhpc3RsZTogImQ4YmZkOCIsCiAgICAgICAgdG9tYXRvOiAiZmY2MzQ3IiwKICAgICAgICB0dXJxdW9pc2U6ICI0MGUwZDAiLAogICAgICAgIHZpb2xldDogImVlODJlZSIsCiAgICAgICAgd2hlYXQ6ICJmNWRlYjMiLAogICAgICAgIHdoaXRlOiAiZmZmIiwKICAgICAgICB3aGl0ZXNtb2tlOiAiZjVmNWY1IiwKICAgICAgICB5ZWxsb3c6ICJmZjAiLAogICAgICAgIHllbGxvd2dyZWVuOiAiOWFjZDMyIgogICAgfTsKCiAgICAvLyBNYWtlIGl0IGVhc3kgdG8gYWNjZXNzIGNvbG9ycyB2aWEgYGhleE5hbWVzW2hleF1gCiAgICB2YXIgaGV4TmFtZXMgPSB0aW55Y29sb3IuaGV4TmFtZXMgPSBmbGlwKG5hbWVzKTsKCgogICAgLy8gVXRpbGl0aWVzCiAgICAvLyAtLS0tLS0tLS0KCiAgICAvLyBgeyAnbmFtZTEnOiAndmFsMScgfWAgYmVjb21lcyBgeyAndmFsMSc6ICduYW1lMScgfWAKICAgIGZ1bmN0aW9uIGZsaXAobykgewogICAgICAgIHZhciBmbGlwcGVkID0geyB9OwogICAgICAgIGZvciAodmFyIGkgaW4gbykgewogICAgICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShpKSkgewogICAgICAgICAgICAgICAgZmxpcHBlZFtvW2ldXSA9IGk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZsaXBwZWQ7CiAgICB9CgogICAgLy8gUmV0dXJuIGEgdmFsaWQgYWxwaGEgdmFsdWUgWzAsMV0gd2l0aCBhbGwgaW52YWxpZCB2YWx1ZXMgYmVpbmcgc2V0IHRvIDEKICAgIGZ1bmN0aW9uIGJvdW5kQWxwaGEoYSkgewogICAgICAgIGEgPSBwYXJzZUZsb2F0KGEpOwoKICAgICAgICBpZiAoaXNOYU4oYSkgfHwgYSA8IDAgfHwgYSA+IDEpIHsKICAgICAgICAgICAgYSA9IDE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYTsKICAgIH0KCiAgICAvLyBUYWtlIGlucHV0IGZyb20gWzAsIG5dIGFuZCByZXR1cm4gaXQgYXMgWzAsIDFdCiAgICBmdW5jdGlvbiBib3VuZDAxKG4sIG1heCkgewogICAgICAgIGlmIChpc09uZVBvaW50WmVybyhuKSkgeyBuID0gIjEwMCUiOyB9CgogICAgICAgIHZhciBwcm9jZXNzUGVyY2VudCA9IGlzUGVyY2VudGFnZShuKTsKICAgICAgICBuID0gbWF0aE1pbihtYXgsIG1hdGhNYXgoMCwgcGFyc2VGbG9hdChuKSkpOwoKICAgICAgICAvLyBBdXRvbWF0aWNhbGx5IGNvbnZlcnQgcGVyY2VudGFnZSBpbnRvIG51bWJlcgogICAgICAgIGlmIChwcm9jZXNzUGVyY2VudCkgewogICAgICAgICAgICBuID0gcGFyc2VJbnQobiAqIG1heCwgMTApIC8gMTAwOwogICAgICAgIH0KCiAgICAgICAgLy8gSGFuZGxlIGZsb2F0aW5nIHBvaW50IHJvdW5kaW5nIGVycm9ycwogICAgICAgIGlmICgobWF0aC5hYnMobiAtIG1heCkgPCAwLjAwMDAwMSkpIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQoKICAgICAgICAvLyBDb252ZXJ0IGludG8gWzAsIDFdIHJhbmdlIGlmIGl0IGlzbid0IGFscmVhZHkKICAgICAgICByZXR1cm4gKG4gJSBtYXgpIC8gcGFyc2VGbG9hdChtYXgpOwogICAgfQoKICAgIC8vIEZvcmNlIGEgbnVtYmVyIGJldHdlZW4gMCBhbmQgMQogICAgZnVuY3Rpb24gY2xhbXAwMSh2YWwpIHsKICAgICAgICByZXR1cm4gbWF0aE1pbigxLCBtYXRoTWF4KDAsIHZhbCkpOwogICAgfQoKICAgIC8vIFBhcnNlIGFuIGludGVnZXIgaW50byBoZXgKICAgIGZ1bmN0aW9uIHBhcnNlSGV4KHZhbCkgewogICAgICAgIHJldHVybiBwYXJzZUludCh2YWwsIDE2KTsKICAgIH0KCiAgICAvLyBOZWVkIHRvIGhhbmRsZSAxLjAgYXMgMTAwJSwgc2luY2Ugb25jZSBpdCBpcyBhIG51bWJlciwgdGhlcmUgaXMgbm8gZGlmZmVyZW5jZSBiZXR3ZWVuIGl0IGFuZCAxCiAgICAvLyA8aHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy83NDIyMDcyL2phdmFzY3JpcHQtaG93LXRvLWRldGVjdC1udW1iZXItYXMtYS1kZWNpbWFsLWluY2x1ZGluZy0xLTA+CiAgICBmdW5jdGlvbiBpc09uZVBvaW50WmVybyhuKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBuID09ICJzdHJpbmciICYmIG4uaW5kZXhPZignLicpICE9IC0xICYmIHBhcnNlRmxvYXQobikgPT09IDE7CiAgICB9CgogICAgLy8gQ2hlY2sgdG8gc2VlIGlmIHN0cmluZyBwYXNzZWQgaW4gaXMgYSBwZXJjZW50YWdlCiAgICBmdW5jdGlvbiBpc1BlcmNlbnRhZ2UobikgewogICAgICAgIHJldHVybiB0eXBlb2YgbiA9PT0gInN0cmluZyIgJiYgbi5pbmRleE9mKCclJykgIT0gLTE7CiAgICB9CgogICAgLy8gRm9yY2UgYSBoZXggdmFsdWUgdG8gaGF2ZSAyIGNoYXJhY3RlcnMKICAgIGZ1bmN0aW9uIHBhZDIoYykgewogICAgICAgIHJldHVybiBjLmxlbmd0aCA9PSAxID8gJzAnICsgYyA6ICcnICsgYzsKICAgIH0KCiAgICAvLyBSZXBsYWNlIGEgZGVjaW1hbCB3aXRoIGl0J3MgcGVyY2VudGFnZSB2YWx1ZQogICAgZnVuY3Rpb24gY29udmVydFRvUGVyY2VudGFnZShuKSB7CiAgICAgICAgaWYgKG4gPD0gMSkgewogICAgICAgICAgICBuID0gKG4gKiAxMDApICsgIiUiOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG47CiAgICB9CgogICAgdmFyIG1hdGNoZXJzID0gKGZ1bmN0aW9uKCkgewoKICAgICAgICAvLyA8aHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy12YWx1ZXMvI2ludGVnZXJzPgogICAgICAgIHZhciBDU1NfSU5URUdFUiA9ICJbLVxcK10/XFxkKyU/IjsKCiAgICAgICAgLy8gPGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtdmFsdWVzLyNudW1iZXItdmFsdWU+CiAgICAgICAgdmFyIENTU19OVU1CRVIgPSAiWy1cXCtdP1xcZCpcXC5cXGQrJT8iOwoKICAgICAgICAvLyBBbGxvdyBwb3NpdGl2ZS9uZWdhdGl2ZSBpbnRlZ2VyL251bWJlci4gIERvbid0IGNhcHR1cmUgdGhlIGVpdGhlci9vciwganVzdCB0aGUgZW50aXJlIG91dGNvbWUuCiAgICAgICAgdmFyIENTU19VTklUID0gIig/OiIgKyBDU1NfTlVNQkVSICsgIil8KD86IiArIENTU19JTlRFR0VSICsgIikiOwoKICAgICAgICAvLyBBY3R1YWwgbWF0Y2hpbmcuCiAgICAgICAgLy8gUGFyZW50aGVzZXMgYW5kIGNvbW1hcyBhcmUgb3B0aW9uYWwsIGJ1dCBub3QgcmVxdWlyZWQuCiAgICAgICAgLy8gV2hpdGVzcGFjZSBjYW4gdGFrZSB0aGUgcGxhY2Ugb2YgY29tbWFzIG9yIG9wZW5pbmcgcGFyZW4KICAgICAgICB2YXIgUEVSTUlTU0lWRV9NQVRDSDMgPSAiW1xcc3xcXChdKygiICsgQ1NTX1VOSVQgKyAiKVssfFxcc10rKCIgKyBDU1NfVU5JVCArICIpWyx8XFxzXSsoIiArIENTU19VTklUICsgIilcXHMqXFwpPyI7CiAgICAgICAgdmFyIFBFUk1JU1NJVkVfTUFUQ0g0ID0gIltcXHN8XFwoXSsoIiArIENTU19VTklUICsgIilbLHxcXHNdKygiICsgQ1NTX1VOSVQgKyAiKVssfFxcc10rKCIgKyBDU1NfVU5JVCArICIpWyx8XFxzXSsoIiArIENTU19VTklUICsgIilcXHMqXFwpPyI7CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHJnYjogbmV3IFJlZ0V4cCgicmdiIiArIFBFUk1JU1NJVkVfTUFUQ0gzKSwKICAgICAgICAgICAgcmdiYTogbmV3IFJlZ0V4cCgicmdiYSIgKyBQRVJNSVNTSVZFX01BVENINCksCiAgICAgICAgICAgIGhzbDogbmV3IFJlZ0V4cCgiaHNsIiArIFBFUk1JU1NJVkVfTUFUQ0gzKSwKICAgICAgICAgICAgaHNsYTogbmV3IFJlZ0V4cCgiaHNsYSIgKyBQRVJNSVNTSVZFX01BVENINCksCiAgICAgICAgICAgIGhzdjogbmV3IFJlZ0V4cCgiaHN2IiArIFBFUk1JU1NJVkVfTUFUQ0gzKSwKICAgICAgICAgICAgaGV4MzogL14oWzAtOWEtZkEtRl17MX0pKFswLTlhLWZBLUZdezF9KShbMC05YS1mQS1GXXsxfSkkLywKICAgICAgICAgICAgaGV4NjogL14oWzAtOWEtZkEtRl17Mn0pKFswLTlhLWZBLUZdezJ9KShbMC05YS1mQS1GXXsyfSkkLwogICAgICAgIH07CiAgICB9KSgpOwoKICAgIC8vIGBzdHJpbmdJbnB1dFRvT2JqZWN0YAogICAgLy8gUGVybWlzc2l2ZSBzdHJpbmcgcGFyc2luZy4gIFRha2UgaW4gYSBudW1iZXIgb2YgZm9ybWF0cywgYW5kIG91dHB1dCBhbiBvYmplY3QKICAgIC8vIGJhc2VkIG9uIGRldGVjdGVkIGZvcm1hdC4gIFJldHVybnMgYHsgciwgZywgYiB9YCBvciBgeyBoLCBzLCBsIH1gIG9yIGB7IGgsIHMsIHZ9YAogICAgZnVuY3Rpb24gc3RyaW5nSW5wdXRUb09iamVjdChjb2xvcikgewoKICAgICAgICBjb2xvciA9IGNvbG9yLnJlcGxhY2UodHJpbUxlZnQsJycpLnJlcGxhY2UodHJpbVJpZ2h0LCAnJykudG9Mb3dlckNhc2UoKTsKICAgICAgICB2YXIgbmFtZWQgPSBmYWxzZTsKICAgICAgICBpZiAobmFtZXNbY29sb3JdKSB7CiAgICAgICAgICAgIGNvbG9yID0gbmFtZXNbY29sb3JdOwogICAgICAgICAgICBuYW1lZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGNvbG9yID09ICd0cmFuc3BhcmVudCcpIHsKICAgICAgICAgICAgcmV0dXJuIHsgcjogMCwgZzogMCwgYjogMCwgYTogMCwgZm9ybWF0OiAibmFtZSIgfTsKICAgICAgICB9CgogICAgICAgIC8vIFRyeSB0byBtYXRjaCBzdHJpbmcgaW5wdXQgdXNpbmcgcmVndWxhciBleHByZXNzaW9ucy4KICAgICAgICAvLyBLZWVwIG1vc3Qgb2YgdGhlIG51bWJlciBib3VuZGluZyBvdXQgb2YgdGhpcyBmdW5jdGlvbiAtIGRvbid0IHdvcnJ5IGFib3V0IFswLDFdIG9yIFswLDEwMF0gb3IgWzAsMzYwXQogICAgICAgIC8vIEp1c3QgcmV0dXJuIGFuIG9iamVjdCBhbmQgbGV0IHRoZSBjb252ZXJzaW9uIGZ1bmN0aW9ucyBoYW5kbGUgdGhhdC4KICAgICAgICAvLyBUaGlzIHdheSB0aGUgcmVzdWx0IHdpbGwgYmUgdGhlIHNhbWUgd2hldGhlciB0aGUgdGlueWNvbG9yIGlzIGluaXRpYWxpemVkIHdpdGggc3RyaW5nIG9yIG9iamVjdC4KICAgICAgICB2YXIgbWF0Y2g7CiAgICAgICAgaWYgKChtYXRjaCA9IG1hdGNoZXJzLnJnYi5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgcjogbWF0Y2hbMV0sIGc6IG1hdGNoWzJdLCBiOiBtYXRjaFszXSB9OwogICAgICAgIH0KICAgICAgICBpZiAoKG1hdGNoID0gbWF0Y2hlcnMucmdiYS5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgcjogbWF0Y2hbMV0sIGc6IG1hdGNoWzJdLCBiOiBtYXRjaFszXSwgYTogbWF0Y2hbNF0gfTsKICAgICAgICB9CiAgICAgICAgaWYgKChtYXRjaCA9IG1hdGNoZXJzLmhzbC5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgaDogbWF0Y2hbMV0sIHM6IG1hdGNoWzJdLCBsOiBtYXRjaFszXSB9OwogICAgICAgIH0KICAgICAgICBpZiAoKG1hdGNoID0gbWF0Y2hlcnMuaHNsYS5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgaDogbWF0Y2hbMV0sIHM6IG1hdGNoWzJdLCBsOiBtYXRjaFszXSwgYTogbWF0Y2hbNF0gfTsKICAgICAgICB9CiAgICAgICAgaWYgKChtYXRjaCA9IG1hdGNoZXJzLmhzdi5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgaDogbWF0Y2hbMV0sIHM6IG1hdGNoWzJdLCB2OiBtYXRjaFszXSB9OwogICAgICAgIH0KICAgICAgICBpZiAoKG1hdGNoID0gbWF0Y2hlcnMuaGV4Ni5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHI6IHBhcnNlSGV4KG1hdGNoWzFdKSwKICAgICAgICAgICAgICAgIGc6IHBhcnNlSGV4KG1hdGNoWzJdKSwKICAgICAgICAgICAgICAgIGI6IHBhcnNlSGV4KG1hdGNoWzNdKSwKICAgICAgICAgICAgICAgIGZvcm1hdDogbmFtZWQgPyAibmFtZSIgOiAiaGV4IgogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAoKG1hdGNoID0gbWF0Y2hlcnMuaGV4My5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHI6IHBhcnNlSGV4KG1hdGNoWzFdICsgJycgKyBtYXRjaFsxXSksCiAgICAgICAgICAgICAgICBnOiBwYXJzZUhleChtYXRjaFsyXSArICcnICsgbWF0Y2hbMl0pLAogICAgICAgICAgICAgICAgYjogcGFyc2VIZXgobWF0Y2hbM10gKyAnJyArIG1hdGNoWzNdKSwKICAgICAgICAgICAgICAgIGZvcm1hdDogbmFtZWQgPyAibmFtZSIgOiAiaGV4IgogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIEV4cG9zZSB0aW55Y29sb3IgdG8gd2luZG93LCBkb2VzIG5vdCBuZWVkIHRvIHJ1biBpbiBub24tYnJvd3NlciBjb250ZXh0LgogICAgd2luZG93LnRpbnljb2xvciA9IHRpbnljb2xvcjsKCiAgICB9KSgpOwoKCiAgICAkKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoJC5mbi5zcGVjdHJ1bS5sb2FkKSB7CiAgICAgICAgICAgICQuZm4uc3BlY3RydW0ucHJvY2Vzc05hdGl2ZUNvbG9ySW5wdXRzKCk7CiAgICAgICAgfQogICAgfSk7Cgp9KSh3aW5kb3csIGpRdWVyeSk7CgogIHRyeSB7IGNvbnNvbGUubG9nKCdkb25lIGxvYWRpbmcgbGVhZmxldC5kcmF3IEpTJyk7IH0gY2F0Y2goZSkge30KCiAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuYm9vdCgpOwoKICAkKCdoZWFkJykuYXBwZW5kKCc8c3R5bGU+LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG4vKiBUb29sYmFyc1xuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi5sZWFmbGV0LWRyYXctc2VjdGlvbiB7XG4JcG9zaXRpb246IHJlbGF0aXZlO1xufVxuXG4ubGVhZmxldC1kcmF3LXRvb2xiYXIge1xuCW1hcmdpbi10b3A6IDEycHg7XG59XG5cbi5sZWFmbGV0LWRyYXctdG9vbGJhci10b3Age1xuCW1hcmdpbi10b3A6IDA7XG59XG5cbi5sZWFmbGV0LWRyYXctdG9vbGJhci1ub3RvcCBhOmZpcnN0LWNoaWxkIHtcbglib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogMDtcbn1cblxuLmxlYWZsZXQtZHJhdy10b29sYmFyLW5vYm90dG9tIGE6bGFzdC1jaGlsZCB7XG4JYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDA7XG59XG5cbi5sZWFmbGV0LWRyYXctdG9vbGJhciBhIHtcbgliYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFOSUFBQUFlQ0FZQUFBQlpzMENOQUFBQUdYUkZXSFJUYjJaMGQyRnlaUUJCWkc5aVpTQkpiV0ZuWlZKbFlXUjVjY2xsUEFBQUF0VkpSRUZVZU5yc21sRnkyakFRaGtXRzkzQ0QwaE0wUFVIaGhkZkFEZUFFQ1NjSW5BQTRRYmxCZU9ZRmNvSzZKeWc1UWR3VHRMdnA3NDdHaE5nbVd0dHgvbS9HWTQyczhVcXkvbDFKbG5PRUVFSUlJWVFRUWdnaGhCQkNDQ0dFSE5OaUY1QzZNeGdNT25JYmI3ZmJwY0c3WjNLN1MyWFB4ZGFzeUh2YUFTdjBKMGxMSlZwR0RiNlJhNE9HSGhvK2VMcHlHOHJWUVZhc2JiZHVOd2F0MnUwaTZ3QzdzYkhOcTNTKzJOemoyVTZmUy9xTDVFME1xdkJmT0JobjFVUWtOUFpKQmFTQ0NpMGtlZWRZYnQ5VDJXdExRZm1PNFRXTW5NYXQzQlluSGs4dFBEUHM2bUMrOTBUa1BER054RzVrSUNDMTEzdmhzWDdmS2RMYUZ6b0dKbEtIdFZFVXloU1pxWkI4ajJFeHVFNkl5RnhRVlFrcFEwUm1Zc0ozL0FFUmFmUlo0ZEVOb3FMMjc5ZVFrVWxzN2lDaUE2NEVGZXdjNDBycDYvalNDRlhYR1VRN29JaTA4ZjNBSFowbElnZFBOVzdDZWcvVHVVV09vZ3NwRzNxYTUwL24ra24wVVR1ZXdJWndYS0Y0RnBIWStwemhuSHRTWmxQQzJ1aXNhUFFtSWRWRVJFMWpXTEJzeUtqVTlhSnM1S2ZsV3h5VkNjZ21RMFNUVkxRS3VqWUs5YUtMT29vSUZCRlIxQkFoZFl6S25yTldPa29MbHdibWZtZUlLUEttZUxYbG9xWWljZ1duRUhGRGhQU3BRdHQrSCs1MDZvUHBqeitJSDQzcmNPdUxDQnNMUTB1blVZbVFTaFJSRW5ienZ2dWhJVUw2V2FIeldLZWkzUjJ1enBuTzdTMEUyWjJycFpCS0ZwSERRbnIxd1NMU3hxaHNudjZPTTlZTWM4dnZqVHJNZEJmMHZZa290NUN3RmZ4VWxvZzhsamxGMG9nMUVwekhORWZScWRIL3MrV0poZjBoOE1hR3ozV2U1OWpSckMzdEFoKzVCVUdWSmFKbkx5azJWKzcxYmNyWTJlM3FWQ0dtSlhiSlN2OGhpLzRlWWViaG42Z1lHWDN6dlZ3OS9FOTZhWHIrRGM1N1gvZVRMTG4rdlZnZi84bGgvNWY3dC9XNmgyZ2VrWTdLRW5VRmJlNjZDbzRJd1haeXdzRTVneE1OcWVYQ3FaTU52dGlDQ3puMGZ5UkNDQ0dFRUVJSUlZUVFRZ2doaEJCQ0NDRkcvQlZnQU11V1d0ZnFWamtNQUFBQUFFbEZUa1N1UW1DQyk7XG4JYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDtcbn1cblxuLmxlYWZsZXQtcmV0aW5hIC5sZWFmbGV0LWRyYXctdG9vbGJhciBhIHtcbgliYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFhUUFBQUE4Q0FZQUFBQXBEczZ2QUFBQUdYUkZXSFJUYjJaMGQyRnlaUUJCWkc5aVpTQkpiV0ZuWlZKbFlXUjVjY2xsUEFBQUJWMUpSRUZVZU5yczNkMVIyMEFVaG1IQlVJQkxjQ3FJNlVEY2NBMFZZRmNBcVFCVEFiZ0NRd1Z3elExT0JUZ1Z4Q1U0RlpBOXlkR01va2kyZmxabXorcDlaalRCeE5hdzdNKzNLd2twU1FBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFMbzU0bGNBQU1OMWZuNytVZWQ5cjYrdnZlZkZDZFVCQUY0Rzlvbjc1ODF0Mzl6Zy9jaHZKSUpBcWtyclE2U3p4ekpNM1Q5THQwbWpmSEkvKzRxbUJnd2lqRWJTOTkzcnhGb29WWTJ4ZFZkUXJKRENiWmhMZlNuQk5IWGZrMEM2STVpaXF1TnJ0NlZ1R3hmK2UrTzJWVXdURVZmZWtiYmxLN2ROQ3YrOWxyTEs1TXVWZHh0Qk9TYzEzcnAxWlYzblBqZk9oVkhHWkNoOXRxTUFHOFZIUHEyTHJ3M05rc3FZRHliZnN5VmpLOSt4VGpiU21oK1JlcDY1TW00TTEvZUZsbm0wYjVEV3NyNFlLNS9VNmEzYkxtcVVNVE1yQm8zYnoxSkRPLy83T01zSFYyeDl0NDgrZkJ6Z2dCN0RrcjJLREdSdjdyMnlwUW1zRGN6dkRjSW9xKzkzL2F6Rk1zc0ErMXh6b0piM1BPdG5MUFhaZHcyU3htRWtZYWFyS2htVVo4bmZRL1JCaGhFckpNOERlc2d6NlpwaFZEV0RmckswckIvaUNra0Q1Ym5qYmk0dHJSNTJsRmtHMjJ5Z25WUzArZURMcWl1ajk0WjlOaDlHV1ovZmFQaHM5ZnYzMnFjSkk2dUJWR2RBRDNYZzZoQkdlZEtvN3l3RTA5QUNxZVhBbFZRTTVLY1dEdC9wclA5blNabWxqYzRMNzVYWHR5VmwvUkx5T2FXU1EyeC9Kb2ZhRjB2ckx3dVprajYvem9jUzJqc0pvR0dVRGVnbWxyeWV3a2pJb0NjblFXOWRtYi9RTElPeTlGQy9pZTVEOW5WbW9NelRPbUdrRTRxNW5Md3ZoRkoyRWNSRHdHWE1IMFpkdVhLY2RlanoyWVZNbDBNNnl0SEhaUEw0azM4eGhOSC93WVJ3NmpoTm1wMHoyaWMxY3A3MHFtUjFNTjh4TU0yMTMrN2FSMmp5L2ZhdVk1L2YxdDBIQWcwa3dxalVoaVlaOU1Ec3c3V0JjcGRkMnIzUGVzOCtRcmJ1ME9mTlhzQWdLNXo4S3FmcDYyZ0N5WGdZalhzS0l3SXBQS21SZmFMYndMejFFVVo2WGdxV0FzbHlHS202bDhIMk1sUERRWTJON1BQUUs2YTI3ekduWVJoTjZUS0dBaW1DTU1wKzNyNzhva2tpUUNPOW1xNnFYODk3bktRUlJnUVNZYlJEbnljdlZ6UkpCS0NzUDk2V2hWTEZaZCt4clBicm5qTWlqRHc1eUdYZkVZV1JIRzllNmIzcFVtT3JMNkRKeEdoU0VVclh5ZjQvakkxbGNoWE5CUXlza0NJTW83NVhTVFQwNEd5TTdOTzN4WjVCT3RWdDFISWZGaEZHMWdNcDBqQks5T2FvandNY3FJYTRVckN3VDkvdFc5cGlsMXYvdkZpK29XeWhycktOTURxQTNnN1p4UnBHaFZYU2xFQ0syaUx4ZjM1Z1lhaDlYM1Q0ckhsMTc5NkF3RmRJQXdpamJCYnBjNVhFN0N1OE9sNTdYdEdzckxSLy9UbmIzUHJuZ1pVRVBuMkZ0T2YrU0xFZWY4MW1rVDR1ZWVXUzd6REpZd1Y4M1Z4MVpyUjlqeHVzOHMydGptUUMzWFpzNGpFeUJsWklBd21qYkpYazZ4RE1pdVlZYkIzN0NCSnpEK3JUT3hqTUdwYlJ5cFdpK1orenkvT3Ewb3A5SW9SQUtybmZVZXduQXg4OE5VUWFjN2dEczV6Z3YyeFpSL0taUzJ0UFVzMlZmVlV6bEdiR25vU2Nydys1blAwbWU5aGVnOVhSVGZMdjMyQzkwRnU2T1RsQWc0NzZlTExNQ0YzRFhDVGxmeHhZZDJXMDRiaDcrS0hrNmxucWFGQ1BNTmV5UDdxeWYzVmYzbFJOeWl3OVpGSVZEN2ZMZy9YdTlWRWFiU2VVM1BHN0kyOTNicTA2aDJUaGlhQ2V5aThQTkJ2dmVJc01aakl3L2RDdjE1RmNHanM0ZXRIT3RRWlRzYzQzR2tTTDJDWVorbmp5WmNuSzZORndQZnE0VWJLcDB4SWhQdy9wSklIUEdkZFNCeVRadm1kZkd6dVVnWHFyL3RrQXl5MHJwVTB1bEdhVzI3YlVveXZQcVI3ZGFITnhrZ1NSSEthN1kzSUpBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBakxid0VHQUJkSWswNENXbXJZQUFBQUFFbEZUa1N1UW1DQyk7XG4JYmFja2dyb3VuZC1zaXplOiAyMTBweCAzMHB4O1xufVxuXG4ubGVhZmxldC1kcmF3IGEge1xuCWRpc3BsYXk6IGJsb2NrO1xuCXRleHQtYWxpZ246IGNlbnRlcjtcbgl0ZXh0LWRlY29yYXRpb246IG5vbmU7XG59XG5cbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuLyogVG9vbGJhciBhY3Rpb25zIG1lbnVcbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4ubGVhZmxldC1kcmF3LWFjdGlvbnMge1xuCWRpc3BsYXk6IG5vbmU7XG4JbGlzdC1zdHlsZTogbm9uZTtcbgltYXJnaW46IDA7XG4JcGFkZGluZzogMDtcbglwb3NpdGlvbjogYWJzb2x1dGU7XG4JbGVmdDogMjZweDsgLyogbGVhZmxldC1kcmF3LXRvb2xiYXIubGVmdCArIGxlYWZsZXQtZHJhdy10b29sYmFyLndpZHRoICovXG4JdG9wOiAwO1xuCXdoaXRlLXNwYWNlOiBub3dyYXA7XG59XG5cbi5sZWFmbGV0LXJpZ2h0IC5sZWFmbGV0LWRyYXctYWN0aW9ucyB7XG4JcmlnaHQ6MjZweDtcbglsZWZ0OmF1dG87XG59XG5cbi5sZWFmbGV0LWRyYXctYWN0aW9ucyBsaSB7XG4JZGlzcGxheTogaW5saW5lLWJsb2NrO1xufVxuXG4ubGVhZmxldC1kcmF3LWFjdGlvbnMgbGk6Zmlyc3QtY2hpbGQgYSB7XG4JYm9yZGVyLWxlZnQ6IG5vbmU7XG59XG5cbi5sZWFmbGV0LWRyYXctYWN0aW9ucyBsaTpsYXN0LWNoaWxkIGEge1xuCS13ZWJraXQtYm9yZGVyLXJhZGl1czogMCA0cHggNHB4IDA7XG4JICAgICAgICBib3JkZXItcmFkaXVzOiAwIDRweCA0cHggMDtcbn1cblxuLmxlYWZsZXQtcmlnaHQgLmxlYWZsZXQtZHJhdy1hY3Rpb25zIGxpOmxhc3QtY2hpbGQgYSB7XG4JLXdlYmtpdC1ib3JkZXItcmFkaXVzOiAwO1xuCSAgICAgICAgYm9yZGVyLXJhZGl1czogMDtcbn1cblxuLmxlYWZsZXQtcmlnaHQgLmxlYWZsZXQtZHJhdy1hY3Rpb25zIGxpOmZpcnN0LWNoaWxkIGEge1xuCS13ZWJraXQtYm9yZGVyLXJhZGl1czogNHB4IDAgMCA0cHg7XG4JICAgICAgICBib3JkZXItcmFkaXVzOiA0cHggMCAwIDRweDtcbn1cblxuLmxlYWZsZXQtZHJhdy1hY3Rpb25zIGEge1xuCWJhY2tncm91bmQtY29sb3I6ICM5MTkxODc7XG4JYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjQUFBO1xuCWNvbG9yOiAjRkZGO1xuCWZvbnQ6IDExcHgvMTlweCAiSGVsdmV0aWNhIE5ldWUiLCBBcmlhbCwgSGVsdmV0aWNhLCBzYW5zLXNlcmlmO1xuCWxpbmUtaGVpZ2h0OiAyOHB4O1xuCXRleHQtZGVjb3JhdGlvbjogbm9uZTtcbglwYWRkaW5nLWxlZnQ6IDEwcHg7XG4JcGFkZGluZy1yaWdodDogMTBweDtcbgloZWlnaHQ6IDI4cHg7XG59XG5cbi5sZWFmbGV0LWRyYXctYWN0aW9ucy1ib3R0b20ge1xuCW1hcmdpbi10b3A6IDA7XG59XG5cbi5sZWFmbGV0LWRyYXctYWN0aW9ucy10b3Age1xuCW1hcmdpbi10b3A6IDFweDtcbn1cblxuLmxlYWZsZXQtZHJhdy1hY3Rpb25zLXRvcCBhLFxuLmxlYWZsZXQtZHJhdy1hY3Rpb25zLWJvdHRvbSBhIHtcbgloZWlnaHQ6IDI3cHg7XG4JbGluZS1oZWlnaHQ6IDI3cHg7XG59XG5cbi5sZWFmbGV0LWRyYXctYWN0aW9ucyBhOmhvdmVyIHtcbgliYWNrZ3JvdW5kLWNvbG9yOiAjQTBBMDk4O1xufVxuXG4ubGVhZmxldC1kcmF3LWFjdGlvbnMtdG9wLmxlYWZsZXQtZHJhdy1hY3Rpb25zLWJvdHRvbSBhIHtcbgloZWlnaHQ6IDI2cHg7XG4JbGluZS1oZWlnaHQ6IDI2cHg7XG59XG5cbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuLyogRHJhdyB0b29sYmFyXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLmxlYWZsZXQtZHJhdy10b29sYmFyIC5sZWFmbGV0LWRyYXctZHJhdy1wb2x5bGluZSB7XG4JYmFja2dyb3VuZC1wb3NpdGlvbjogLTJweCAtMnB4O1xufVxuXG4ubGVhZmxldC1kcmF3LXRvb2xiYXIgLmxlYWZsZXQtZHJhdy1kcmF3LXBvbHlnb24ge1xuCWJhY2tncm91bmQtcG9zaXRpb246IC0zMXB4IC0ycHg7XG59XG5cbi5sZWFmbGV0LWRyYXctdG9vbGJhciAubGVhZmxldC1kcmF3LWRyYXctcmVjdGFuZ2xlIHtcbgliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtNjJweCAtMnB4O1xufVxuXG4ubGVhZmxldC1kcmF3LXRvb2xiYXIgLmxlYWZsZXQtZHJhdy1kcmF3LWNpcmNsZSB7XG4JYmFja2dyb3VuZC1wb3NpdGlvbjogLTkycHggLTJweDtcbn1cblxuLmxlYWZsZXQtZHJhdy10b29sYmFyIC5sZWFmbGV0LWRyYXctZHJhdy1tYXJrZXIge1xuCWJhY2tncm91bmQtcG9zaXRpb246IC0xMjJweCAtMnB4O1xufVxuXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cbi8qIEVkaXQgdG9vbGJhclxuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi5sZWFmbGV0LWRyYXctdG9vbGJhciAubGVhZmxldC1kcmF3LWVkaXQtZWRpdCB7XG4JYmFja2dyb3VuZC1wb3NpdGlvbjogLTE1MnB4IC0ycHg7XG59XG5cbi5sZWFmbGV0LWRyYXctdG9vbGJhciAubGVhZmxldC1kcmF3LWVkaXQtcmVtb3ZlIHtcbgliYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTgycHggLTJweDtcbn1cblxuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG4vKiBEcmF3aW5nIHN0eWxlc1xuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi5sZWFmbGV0LW1vdXNlLW1hcmtlciB7XG4JYmFja2dyb3VuZC1jb2xvcjogI2ZmZjtcbgljdXJzb3I6IGNyb3NzaGFpcjtcbn1cblxuLmxlYWZsZXQtZHJhdy10b29sdGlwIHtcbgliYWNrZ3JvdW5kOiByZ2IoNTQsIDU0LCA1NCk7XG4JYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjUpO1xuCWJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50O1xuCS13ZWJraXQtYm9yZGVyLXJhZGl1czogNHB4O1xuCSAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuCWNvbG9yOiAjZmZmO1xuCWZvbnQ6IDEycHgvMThweCAiSGVsdmV0aWNhIE5ldWUiLCBBcmlhbCwgSGVsdmV0aWNhLCBzYW5zLXNlcmlmO1xuCW1hcmdpbi1sZWZ0OiAyMHB4O1xuCW1hcmdpbi10b3A6IC0yMXB4O1xuCXBhZGRpbmc6IDRweCA4cHg7XG4JcG9zaXRpb246IGFic29sdXRlO1xuCXdoaXRlLXNwYWNlOiBub3dyYXA7XG4Jei1pbmRleDogNjtcbn1cblxuLmxlYWZsZXQtZHJhdy10b29sdGlwOmJlZm9yZSB7XG4JYm9yZGVyLXJpZ2h0OiA2cHggc29saWQgYmxhY2s7XG4JYm9yZGVyLXJpZ2h0LWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNSk7XG4JYm9yZGVyLXRvcDogNnB4IHNvbGlkIHRyYW5zcGFyZW50O1xuCWJvcmRlci1ib3R0b206IDZweCBzb2xpZCB0cmFuc3BhcmVudDtcbgljb250ZW50OiAiIjtcbglwb3NpdGlvbjogYWJzb2x1dGU7XG4JdG9wOiA3cHg7XG4JbGVmdDogLTdweDtcbn1cblxuLmxlYWZsZXQtZXJyb3ItZHJhdy10b29sdGlwIHtcbgliYWNrZ3JvdW5kLWNvbG9yOiAjRjJERURFO1xuCWJvcmRlcjogMXB4IHNvbGlkICNFNkI2QkQ7XG4JY29sb3I6ICNCOTRBNDg7XG59XG5cbi5sZWFmbGV0LWVycm9yLWRyYXctdG9vbHRpcDpiZWZvcmUge1xuCWJvcmRlci1yaWdodC1jb2xvcjogI0U2QjZCRDtcbn1cblxuLmxlYWZsZXQtZHJhdy10b29sdGlwLXNpbmdsZSB7XG4JbWFyZ2luLXRvcDogLTEycHhcbn1cblxuLmxlYWZsZXQtZHJhdy10b29sdGlwLXN1YnRleHQge1xuCWNvbG9yOiAjZjhkNWU0O1xufVxuXG4ubGVhZmxldC1kcmF3LWd1aWRlLWRhc2gge1xuCWZvbnQtc2l6ZTogMSU7XG4Jb3BhY2l0eTogMC42O1xuCXBvc2l0aW9uOiBhYnNvbHV0ZTtcbgl3aWR0aDogNXB4O1xuCWhlaWdodDogNXB4O1xufVxuXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cbi8qIEVkaXQgc3R5bGVzXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLmxlYWZsZXQtZWRpdC1tYXJrZXItc2VsZWN0ZWQge1xuCWJhY2tncm91bmQ6IHJnYmEoMjU0LCA4NywgMTYxLCAwLjEpO1xuCWJvcmRlcjogNHB4IGRhc2hlZCByZ2JhKDI1NCwgODcsIDE2MSwgMC42KTtcbgktd2Via2l0LWJvcmRlci1yYWRpdXM6IDRweDtcbgkgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbn1cblxuLmxlYWZsZXQtZWRpdC1tb3ZlIHtcbgljdXJzb3I6IG1vdmU7XG59XG5cbi5sZWFmbGV0LWVkaXQtcmVzaXplIHtcbgljdXJzb3I6IHBvaW50ZXI7XG59XG48L3N0eWxlPicpOwogICQoJ2hlYWQnKS5hcHBlbmQoJzxzdHlsZT4vKioqXG5TcGVjdHJ1bSBDb2xvcnBpY2tlciB2MS4yLjBcbmh0dHBzOi8vZ2l0aHViLmNvbS9iZ3JpbnMvc3BlY3RydW1cbkF1dGhvcjogQnJpYW4gR3JpbnN0ZWFkXG5MaWNlbnNlOiBNSVRcbioqKi9cblxuLnNwLWNvbnRhaW5lciB7XG4gICAgcG9zaXRpb246YWJzb2x1dGU7XG4gICAgdG9wOjA7XG4gICAgbGVmdDowO1xuICAgIGRpc3BsYXk6aW5saW5lLWJsb2NrO1xuICAgICpkaXNwbGF5OiBpbmxpbmU7XG4gICAgKnpvb206IDE7XG4gICAgLyogaHR0cHM6Ly9naXRodWIuY29tL2Jncmlucy9zcGVjdHJ1bS9pc3N1ZXMvNDAgKi9cbiAgICB6LWluZGV4OiA5OTk5OTk0O1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG59XG4uc3AtY29udGFpbmVyLnNwLWZsYXQge1xuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbn1cblxuLyogaHR0cDovL2Fuc2NpYXRoLnR1bWJsci5jb20vcG9zdC83MzQ3NDk1ODY5L2Nzcy1hc3BlY3QtcmF0aW8gKi9cbi5zcC10b3Age1xuICBwb3NpdGlvbjpyZWxhdGl2ZTtcbiAgd2lkdGg6IDEwMCU7XG4gIGRpc3BsYXk6aW5saW5lLWJsb2NrO1xufVxuLnNwLXRvcC1pbm5lciB7XG4gICBwb3NpdGlvbjphYnNvbHV0ZTtcbiAgIHRvcDowO1xuICAgbGVmdDowO1xuICAgYm90dG9tOjA7XG4gICByaWdodDowO1xufVxuLnNwLWNvbG9yIHtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgdG9wOjA7XG4gICAgbGVmdDowO1xuICAgIGJvdHRvbTowO1xuICAgIHJpZ2h0OjIwJTtcbn1cbi5zcC1odWUge1xuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICB0b3A6MDtcbiAgICByaWdodDowO1xuICAgIGJvdHRvbTowO1xuICAgIGxlZnQ6ODQlO1xuICAgIGhlaWdodDogMTAwJTtcbn1cblxuLnNwLWNsZWFyLWVuYWJsZWQgLnNwLWh1ZSB7XG4gICAgdG9wOjMzcHg7XG4gICAgaGVpZ2h0OiA3Ny41JTtcbn1cblxuLnNwLWZpbGwge1xuICAgIHBhZGRpbmctdG9wOiA4MCU7XG59XG4uc3Atc2F0LCAuc3AtdmFsIHtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgdG9wOjA7XG4gICAgbGVmdDowO1xuICAgIHJpZ2h0OjA7XG4gICAgYm90dG9tOjA7XG59XG5cbi5zcC1hbHBoYS1lbmFibGVkIC5zcC10b3Age1xuICAgIG1hcmdpbi1ib3R0b206IDE4cHg7XG59XG4uc3AtYWxwaGEtZW5hYmxlZCAuc3AtYWxwaGEge1xuICAgIGRpc3BsYXk6IGJsb2NrO1xufVxuLnNwLWFscGhhLWhhbmRsZSB7XG4gICAgcG9zaXRpb246YWJzb2x1dGU7XG4gICAgdG9wOi00cHg7XG4gICAgYm90dG9tOiAtNHB4O1xuICAgIHdpZHRoOiA2cHg7XG4gICAgbGVmdDogNTAlO1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICBib3JkZXI6IDFweCBzb2xpZCBibGFjaztcbiAgICBiYWNrZ3JvdW5kOiB3aGl0ZTtcbiAgICBvcGFjaXR5OiAuODtcbn1cbi5zcC1hbHBoYSB7XG4gICAgZGlzcGxheTogbm9uZTtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgYm90dG9tOiAtMTRweDtcbiAgICByaWdodDogMDtcbiAgICBsZWZ0OiAwO1xuICAgIGhlaWdodDogOHB4O1xufVxuLnNwLWFscGhhLWlubmVyIHtcbiAgICBib3JkZXI6IHNvbGlkIDFweCAjMzMzO1xufVxuXG4uc3AtY2xlYXIge1xuICAgIGRpc3BsYXk6IG5vbmU7XG59XG5cbi5zcC1jbGVhci5zcC1jbGVhci1kaXNwbGF5IHtcbiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7XG59XG5cbi5zcC1jbGVhci1lbmFibGVkIC5zcC1jbGVhciB7XG4gICAgZGlzcGxheTogYmxvY2s7XG4gICAgcG9zaXRpb246YWJzb2x1dGU7XG4gICAgdG9wOjBweDtcbiAgICByaWdodDowO1xuICAgIGJvdHRvbTowO1xuICAgIGxlZnQ6ODQlO1xuICAgIGhlaWdodDogMjhweDtcbn1cblxuLyogRG9uXCd0IGFsbG93IHRleHQgc2VsZWN0aW9uICovXG4uc3AtY29udGFpbmVyLCAuc3AtcmVwbGFjZXIsIC5zcC1wcmV2aWV3LCAuc3AtZHJhZ2dlciwgLnNwLXNsaWRlciwgLnNwLWFscGhhLCAuc3AtY2xlYXIsIC5zcC1hbHBoYS1oYW5kbGUsIC5zcC1jb250YWluZXIuc3AtZHJhZ2dpbmcgLnNwLWlucHV0LCAuc3AtY29udGFpbmVyIGJ1dHRvbiAge1xuICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTtcbiAgICAtbW96LXVzZXItc2VsZWN0OiAtbW96LW5vbmU7XG4gICAgLW8tdXNlci1zZWxlY3Q6bm9uZTtcbiAgICB1c2VyLXNlbGVjdDogbm9uZTtcbn1cblxuLnNwLWNvbnRhaW5lci5zcC1pbnB1dC1kaXNhYmxlZCAuc3AtaW5wdXQtY29udGFpbmVyIHtcbiAgICBkaXNwbGF5OiBub25lO1xufVxuLnNwLWNvbnRhaW5lci5zcC1idXR0b25zLWRpc2FibGVkIC5zcC1idXR0b24tY29udGFpbmVyIHtcbiAgICBkaXNwbGF5OiBub25lO1xufVxuLnNwLXBhbGV0dGUtb25seSAuc3AtcGlja2VyLWNvbnRhaW5lciB7XG4gICAgZGlzcGxheTogbm9uZTtcbn1cbi5zcC1wYWxldHRlLWRpc2FibGVkIC5zcC1wYWxldHRlLWNvbnRhaW5lciB7XG4gICAgZGlzcGxheTogbm9uZTtcbn1cblxuLnNwLWluaXRpYWwtZGlzYWJsZWQgLnNwLWluaXRpYWwge1xuICAgIGRpc3BsYXk6IG5vbmU7XG59XG5cblxuLyogR3JhZGllbnRzIGZvciBodWUsIHNhdHVyYXRpb24gYW5kIHZhbHVlIGluc3RlYWQgb2YgaW1hZ2VzLiAgTm90IHByZXR0eS4uLiBidXQgaXQgd29ya3MgKi9cbi5zcC1zYXQge1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtZ3JhZGllbnQobGluZWFyLCAgMCAwLCAxMDAlIDAsIGZyb20oI0ZGRiksIHRvKHJnYmEoMjA0LCAxNTQsIDEyOSwgMCkpKTtcbiAgICBiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudChsZWZ0LCAjRkZGLCByZ2JhKDIwNCwgMTU0LCAxMjksIDApKTtcbiAgICBiYWNrZ3JvdW5kLWltYWdlOiAtbW96LWxpbmVhci1ncmFkaWVudChsZWZ0LCAjZmZmLCByZ2JhKDIwNCwgMTU0LCAxMjksIDApKTtcbiAgICBiYWNrZ3JvdW5kLWltYWdlOiAtby1saW5lYXItZ3JhZGllbnQobGVmdCwgI2ZmZiwgcmdiYSgyMDQsIDE1NCwgMTI5LCAwKSk7XG4gICAgYmFja2dyb3VuZC1pbWFnZTogLW1zLWxpbmVhci1ncmFkaWVudChsZWZ0LCAjZmZmLCByZ2JhKDIwNCwgMTU0LCAxMjksIDApKTtcbiAgICBiYWNrZ3JvdW5kLWltYWdlOiBsaW5lYXItZ3JhZGllbnQodG8gcmlnaHQsICNmZmYsIHJnYmEoMjA0LCAxNTQsIDEyOSwgMCkpO1xuICAgIC1tcy1maWx0ZXI6ICJwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoR3JhZGllbnRUeXBlID0gMSwgc3RhcnRDb2xvcnN0cj0jRkZGRkZGRkYsIGVuZENvbG9yc3RyPSMwMENDOUE4MSkiO1xuICAgIGZpbHRlciA6IHByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudChHcmFkaWVudFR5cGUgPSAxLCBzdGFydENvbG9yc3RyPVwnI0ZGRkZGRkZGXCcsIGVuZENvbG9yc3RyPVwnIzAwQ0M5QTgxXCcpO1xufVxuLnNwLXZhbCB7XG4gICAgYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIDAgMTAwJSwgMCAwLCBmcm9tKCMwMDAwMDApLCB0byhyZ2JhKDIwNCwgMTU0LCAxMjksIDApKSk7XG4gICAgYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1saW5lYXItZ3JhZGllbnQoYm90dG9tLCAjMDAwMDAwLCByZ2JhKDIwNCwgMTU0LCAxMjksIDApKTtcbiAgICBiYWNrZ3JvdW5kLWltYWdlOiAtbW96LWxpbmVhci1ncmFkaWVudChib3R0b20sICMwMDAsIHJnYmEoMjA0LCAxNTQsIDEyOSwgMCkpO1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IC1vLWxpbmVhci1ncmFkaWVudChib3R0b20sICMwMDAsIHJnYmEoMjA0LCAxNTQsIDEyOSwgMCkpO1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IC1tcy1saW5lYXItZ3JhZGllbnQoYm90dG9tLCAjMDAwLCByZ2JhKDIwNCwgMTU0LCAxMjksIDApKTtcbiAgICBiYWNrZ3JvdW5kLWltYWdlOiBsaW5lYXItZ3JhZGllbnQodG8gdG9wLCAjMDAwLCByZ2JhKDIwNCwgMTU0LCAxMjksIDApKTtcbiAgICAtbXMtZmlsdGVyOiAicHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LmdyYWRpZW50KHN0YXJ0Q29sb3JzdHI9IzAwQ0M5QTgxLCBlbmRDb2xvcnN0cj0jRkYwMDAwMDApIjtcbiAgICBmaWx0ZXIgOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj1cJyMwMENDOUE4MVwnLCBlbmRDb2xvcnN0cj1cJyNGRjAwMDAwMFwnKTtcbn1cblxuLnNwLWh1ZSB7XG4gICAgYmFja2dyb3VuZDogLW1vei1saW5lYXItZ3JhZGllbnQodG9wLCAjZmYwMDAwIDAlLCAjZmZmZjAwIDE3JSwgIzAwZmYwMCAzMyUsICMwMGZmZmYgNTAlLCAjMDAwMGZmIDY3JSwgI2ZmMDBmZiA4MyUsICNmZjAwMDAgMTAwJSk7XG4gICAgYmFja2dyb3VuZDogLW1zLWxpbmVhci1ncmFkaWVudCh0b3AsICNmZjAwMDAgMCUsICNmZmZmMDAgMTclLCAjMDBmZjAwIDMzJSwgIzAwZmZmZiA1MCUsICMwMDAwZmYgNjclLCAjZmYwMGZmIDgzJSwgI2ZmMDAwMCAxMDAlKTtcbiAgICBiYWNrZ3JvdW5kOiAtby1saW5lYXItZ3JhZGllbnQodG9wLCAjZmYwMDAwIDAlLCAjZmZmZjAwIDE3JSwgIzAwZmYwMCAzMyUsICMwMGZmZmYgNTAlLCAjMDAwMGZmIDY3JSwgI2ZmMDBmZiA4MyUsICNmZjAwMDAgMTAwJSk7XG4gICAgYmFja2dyb3VuZDogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIGxlZnQgdG9wLCBsZWZ0IGJvdHRvbSwgZnJvbSgjZmYwMDAwKSwgY29sb3Itc3RvcCgwLjE3LCAjZmZmZjAwKSwgY29sb3Itc3RvcCgwLjMzLCAjMDBmZjAwKSwgY29sb3Itc3RvcCgwLjUsICMwMGZmZmYpLCBjb2xvci1zdG9wKDAuNjcsICMwMDAwZmYpLCBjb2xvci1zdG9wKDAuODMsICNmZjAwZmYpLCB0bygjZmYwMDAwKSk7XG4gICAgYmFja2dyb3VuZDogLXdlYmtpdC1saW5lYXItZ3JhZGllbnQodG9wLCAjZmYwMDAwIDAlLCAjZmZmZjAwIDE3JSwgIzAwZmYwMCAzMyUsICMwMGZmZmYgNTAlLCAjMDAwMGZmIDY3JSwgI2ZmMDBmZiA4MyUsICNmZjAwMDAgMTAwJSk7XG59XG5cbi8qIElFIGZpbHRlcnMgZG8gbm90IHN1cHBvcnQgbXVsdGlwbGUgY29sb3Igc3RvcHMuXG4gICBHZW5lcmF0ZSA2IGRpdnMsIGxpbmUgdGhlbSB1cCwgYW5kIGRvIHR3byBjb2xvciBncmFkaWVudHMgZm9yIGVhY2guXG4gICBZZXMsIHJlYWxseS5cbiAqL1xuLnNwLTEge1xuICAgIGhlaWdodDoxNyU7XG4gICAgZmlsdGVyOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj1cJyNmZjAwMDBcJywgZW5kQ29sb3JzdHI9XCcjZmZmZjAwXCcpO1xufVxuLnNwLTIge1xuICAgIGhlaWdodDoxNiU7XG4gICAgZmlsdGVyOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj1cJyNmZmZmMDBcJywgZW5kQ29sb3JzdHI9XCcjMDBmZjAwXCcpO1xufVxuLnNwLTMge1xuICAgIGhlaWdodDoxNyU7XG4gICAgZmlsdGVyOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj1cJyMwMGZmMDBcJywgZW5kQ29sb3JzdHI9XCcjMDBmZmZmXCcpO1xufVxuLnNwLTQge1xuICAgIGhlaWdodDoxNyU7XG4gICAgZmlsdGVyOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj1cJyMwMGZmZmZcJywgZW5kQ29sb3JzdHI9XCcjMDAwMGZmXCcpO1xufVxuLnNwLTUge1xuICAgIGhlaWdodDoxNiU7XG4gICAgZmlsdGVyOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj1cJyMwMDAwZmZcJywgZW5kQ29sb3JzdHI9XCcjZmYwMGZmXCcpO1xufVxuLnNwLTYge1xuICAgIGhlaWdodDoxNyU7XG4gICAgZmlsdGVyOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj1cJyNmZjAwZmZcJywgZW5kQ29sb3JzdHI9XCcjZmYwMDAwXCcpO1xufVxuXG4uc3AtaGlkZGVuIHtcbiAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7XG59XG5cbi8qIENsZWFyZml4IGhhY2sgKi9cbi5zcC1jZjpiZWZvcmUsIC5zcC1jZjphZnRlciB7IGNvbnRlbnQ6ICIiOyBkaXNwbGF5OiB0YWJsZTsgfVxuLnNwLWNmOmFmdGVyIHsgY2xlYXI6IGJvdGg7IH1cbi5zcC1jZiB7ICp6b29tOiAxOyB9XG5cbi8qIE1vYmlsZSBkZXZpY2VzLCBtYWtlIGh1ZSBzbGlkZXIgYmlnZ2VyIHNvIGl0IGlzIGVhc2llciB0byBzbGlkZSAqL1xuQG1lZGlhIChtYXgtZGV2aWNlLXdpZHRoOiA0ODBweCkge1xuICAgIC5zcC1jb2xvciB7IHJpZ2h0OiA0MCU7IH1cbiAgICAuc3AtaHVlIHsgbGVmdDogNjMlOyB9XG4gICAgLnNwLWZpbGwgeyBwYWRkaW5nLXRvcDogNjAlOyB9XG59XG4uc3AtZHJhZ2dlciB7XG4gICBib3JkZXItcmFkaXVzOiA1cHg7XG4gICBoZWlnaHQ6IDVweDtcbiAgIHdpZHRoOiA1cHg7XG4gICBib3JkZXI6IDFweCBzb2xpZCAjZmZmO1xuICAgYmFja2dyb3VuZDogIzAwMDtcbiAgIGN1cnNvcjogcG9pbnRlcjtcbiAgIHBvc2l0aW9uOmFic29sdXRlO1xuICAgdG9wOjA7XG4gICBsZWZ0OiAwO1xufVxuLnNwLXNsaWRlciB7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgIHRvcDowO1xuICAgIGN1cnNvcjpwb2ludGVyO1xuICAgIGhlaWdodDogM3B4O1xuICAgIGxlZnQ6IC0xcHg7XG4gICAgcmlnaHQ6IC0xcHg7XG4gICAgYm9yZGVyOiAxcHggc29saWQgIzAwMDtcbiAgICBiYWNrZ3JvdW5kOiB3aGl0ZTtcbiAgICBvcGFjaXR5OiAuODtcbn1cblxuLypcblRoZW1lIGF1dGhvcnM6XG5IZXJlIGFyZSB0aGUgYmFzaWMgdGhlbWVhYmxlIGRpc3BsYXkgb3B0aW9ucyAoY29sb3JzLCBmb250cywgZ2xvYmFsIHdpZHRocykuXG5TZWUgaHR0cDovL2Jncmlucy5naXRodWIuaW8vc3BlY3RydW0vdGhlbWVzLyBmb3IgaW5zdHJ1Y3Rpb25zLlxuKi9cblxuLnNwLWNvbnRhaW5lciB7XG4gICAgYm9yZGVyLXJhZGl1czogMDtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRUNFQ0VDO1xuICAgIGJvcmRlcjogc29saWQgMXB4ICNmMGM0OUI7XG4gICAgcGFkZGluZzogMDtcbn1cbi5zcC1jb250YWluZXIsIC5zcC1jb250YWluZXIgYnV0dG9uLCAuc3AtY29udGFpbmVyIGlucHV0LCAuc3AtY29sb3IsIC5zcC1odWUsIC5zcC1jbGVhclxue1xuICAgIGZvbnQ6IG5vcm1hbCAxMnB4ICJMdWNpZGEgR3JhbmRlIiwgIkx1Y2lkYSBTYW5zIFVuaWNvZGUiLCAiTHVjaWRhIFNhbnMiLCBHZW5ldmEsIFZlcmRhbmEsIHNhbnMtc2VyaWY7XG4gICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgICAtbXMtYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xufVxuLnNwLXRvcFxue1xuICAgIG1hcmdpbi1ib3R0b206IDNweDtcbn1cbi5zcC1jb2xvciwgLnNwLWh1ZSwgLnNwLWNsZWFyXG57XG4gICAgYm9yZGVyOiBzb2xpZCAxcHggIzY2Njtcbn1cblxuLyogSW5wdXQgKi9cbi5zcC1pbnB1dC1jb250YWluZXIge1xuICAgIGZsb2F0OnJpZ2h0O1xuICAgIHdpZHRoOiAxMDBweDtcbiAgICBtYXJnaW4tYm90dG9tOiA0cHg7XG59XG4uc3AtaW5pdGlhbC1kaXNhYmxlZCAgLnNwLWlucHV0LWNvbnRhaW5lciB7XG4gICAgd2lkdGg6IDEwMCU7XG59XG4uc3AtaW5wdXQge1xuICAgZm9udC1zaXplOiAxMnB4ICFpbXBvcnRhbnQ7XG4gICBib3JkZXI6IDFweCBpbnNldDtcbiAgIHBhZGRpbmc6IDRweCA1cHg7XG4gICBtYXJnaW46IDA7XG4gICB3aWR0aDogMTAwJTtcbiAgIGJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7XG4gICBib3JkZXItcmFkaXVzOiAzcHg7XG4gICBjb2xvcjogIzIyMjtcbn1cbi5zcC1pbnB1dDpmb2N1cyAge1xuICAgIGJvcmRlcjogMXB4IHNvbGlkIG9yYW5nZTtcbn1cbi5zcC1pbnB1dC5zcC12YWxpZGF0aW9uLWVycm9yXG57XG4gICAgYm9yZGVyOiAxcHggc29saWQgcmVkO1xuICAgIGJhY2tncm91bmQ6ICNmZGQ7XG59XG4uc3AtcGlja2VyLWNvbnRhaW5lciAsIC5zcC1wYWxldHRlLWNvbnRhaW5lclxue1xuICAgIGZsb2F0OmxlZnQ7XG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIHBhZGRpbmc6IDEwcHg7XG4gICAgcGFkZGluZy1ib3R0b206IDMwMHB4O1xuICAgIG1hcmdpbi1ib3R0b206IC0yOTBweDtcbn1cbi5zcC1waWNrZXItY29udGFpbmVyXG57XG4gICAgd2lkdGg6IDE3MnB4O1xuICAgIGJvcmRlci1sZWZ0OiBzb2xpZCAxcHggI2ZmZjtcbn1cblxuLyogUGFsZXR0ZXMgKi9cbi5zcC1wYWxldHRlLWNvbnRhaW5lclxue1xuICAgIGJvcmRlci1yaWdodDogc29saWQgMXB4ICNjY2M7XG59XG5cbi5zcC1wYWxldHRlIC5zcC10aHVtYi1lbCB7XG4gICAgZGlzcGxheTogYmxvY2s7XG4gICAgcG9zaXRpb246cmVsYXRpdmU7XG4gICAgZmxvYXQ6bGVmdDtcbiAgICB3aWR0aDogMjRweDtcbiAgICBoZWlnaHQ6IDE1cHg7XG4gICAgbWFyZ2luOiAzcHg7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICAgIGJvcmRlcjpzb2xpZCAycHggdHJhbnNwYXJlbnQ7XG59XG4uc3AtcGFsZXR0ZSAuc3AtdGh1bWItZWw6aG92ZXIsIC5zcC1wYWxldHRlIC5zcC10aHVtYi1lbC5zcC10aHVtYi1hY3RpdmUge1xuICAgIGJvcmRlci1jb2xvcjogb3JhbmdlO1xufVxuLnNwLXRodW1iLWVsXG57XG4gICAgcG9zaXRpb246cmVsYXRpdmU7XG59XG5cbi8qIEluaXRpYWwgKi9cbi5zcC1pbml0aWFsXG57XG4gICAgZmxvYXQ6IGxlZnQ7XG4gICAgYm9yZGVyOiBzb2xpZCAxcHggIzMzMztcbn1cbi5zcC1pbml0aWFsIHNwYW4ge1xuICAgIHdpZHRoOiAzMHB4O1xuICAgIGhlaWdodDogMjVweDtcbiAgICBib3JkZXI6bm9uZTtcbiAgICBkaXNwbGF5OmJsb2NrO1xuICAgIGZsb2F0OmxlZnQ7XG4gICAgbWFyZ2luOjA7XG59XG5cbi5zcC1pbml0aWFsIC5zcC1jbGVhci1kaXNwbGF5IHtcbiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7XG59XG5cbi8qIEJ1dHRvbnMgKi9cbi5zcC1idXR0b24tY29udGFpbmVyIHtcbiAgICBmbG9hdDogcmlnaHQ7XG59XG5cbi8qIFJlcGxhY2VyICh0aGUgbGl0dGxlIHByZXZpZXcgZGl2IHRoYXQgc2hvd3MgdXAgaW5zdGVhZCBvZiB0aGUgPGlucHV0PikgKi9cbi5zcC1yZXBsYWNlciB7XG4gICAgbWFyZ2luOjA7XG4gICAgb3ZlcmZsb3c6aGlkZGVuO1xuICAgIGN1cnNvcjpwb2ludGVyO1xuICAgIHBhZGRpbmc6IDRweDtcbiAgICBkaXNwbGF5OmlubGluZS1ibG9jaztcbiAgICAqem9vbTogMTtcbiAgICAqZGlzcGxheTogaW5saW5lO1xuICAgIGJvcmRlcjogc29saWQgMXB4ICM5MTc2NWQ7XG4gICAgYmFja2dyb3VuZDogI2VlZTtcbiAgICBjb2xvcjogIzMzMztcbiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO1xufVxuLnNwLXJlcGxhY2VyOmhvdmVyLCAuc3AtcmVwbGFjZXIuc3AtYWN0aXZlIHtcbiAgICBib3JkZXItY29sb3I6ICNGMEM0OUI7XG4gICAgY29sb3I6ICMxMTE7XG59XG4uc3AtcmVwbGFjZXIuc3AtZGlzYWJsZWQge1xuICAgIGN1cnNvcjpkZWZhdWx0O1xuICAgIGJvcmRlci1jb2xvcjogc2lsdmVyO1xuICAgIGNvbG9yOiBzaWx2ZXI7XG59XG4uc3AtZGQge1xuICAgIHBhZGRpbmc6IDJweCAwO1xuICAgIGhlaWdodDogMTZweDtcbiAgICBsaW5lLWhlaWdodDogMTZweDtcbiAgICBmbG9hdDpsZWZ0O1xuICAgIGZvbnQtc2l6ZToxMHB4O1xufVxuLnNwLXByZXZpZXdcbntcbiAgICBwb3NpdGlvbjpyZWxhdGl2ZTtcbiAgICB3aWR0aDoyNXB4O1xuICAgIGhlaWdodDogMjBweDtcbiAgICBib3JkZXI6IHNvbGlkIDFweCAjMjIyO1xuICAgIG1hcmdpbi1yaWdodDogNXB4O1xuICAgIGZsb2F0OmxlZnQ7XG4gICAgei1pbmRleDogMDtcbn1cblxuLnNwLXBhbGV0dGVcbntcbiAgICAqd2lkdGg6IDIyMHB4O1xuICAgIG1heC13aWR0aDogMjIwcHg7XG59XG4uc3AtcGFsZXR0ZSAuc3AtdGh1bWItZWxcbntcbiAgICB3aWR0aDoxNnB4O1xuICAgIGhlaWdodDogMTZweDtcbiAgICBtYXJnaW46MnB4IDFweDtcbiAgICBib3JkZXI6IHNvbGlkIDFweCAjZDBkMGQwO1xufVxuXG4uc3AtY29udGFpbmVyXG57XG4gICAgcGFkZGluZy1ib3R0b206MDtcbn1cblxuXG4vKiBCdXR0b25zOiBodHRwOi8vaGVsbG9oYXBweS5vcmcvY3NzMy1idXR0b25zLyAqL1xuLnNwLWNvbnRhaW5lciBidXR0b24ge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZWVlZWVlO1xuICBiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudCh0b3AsICNlZWVlZWUsICNjY2NjY2MpO1xuICBiYWNrZ3JvdW5kLWltYWdlOiAtbW96LWxpbmVhci1ncmFkaWVudCh0b3AsICNlZWVlZWUsICNjY2NjY2MpO1xuICBiYWNrZ3JvdW5kLWltYWdlOiAtbXMtbGluZWFyLWdyYWRpZW50KHRvcCwgI2VlZWVlZSwgI2NjY2NjYyk7XG4gIGJhY2tncm91bmQtaW1hZ2U6IC1vLWxpbmVhci1ncmFkaWVudCh0b3AsICNlZWVlZWUsICNjY2NjY2MpO1xuICBiYWNrZ3JvdW5kLWltYWdlOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCAjZWVlZWVlLCAjY2NjY2NjKTtcbiAgYm9yZGVyOiAxcHggc29saWQgI2NjYztcbiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNiYmI7XG4gIGJvcmRlci1yYWRpdXM6IDNweDtcbiAgY29sb3I6ICMzMzM7XG4gIGZvbnQtc2l6ZTogMTRweDtcbiAgbGluZS1oZWlnaHQ6IDE7XG4gIHBhZGRpbmc6IDVweCA0cHg7XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgdGV4dC1zaGFkb3c6IDAgMXB4IDAgI2VlZTtcbiAgdmVydGljYWwtYWxpZ246IG1pZGRsZTtcbn1cbi5zcC1jb250YWluZXIgYnV0dG9uOmhvdmVyIHtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZGRkZGRkO1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KHRvcCwgI2RkZGRkZCwgI2JiYmJiYik7XG4gICAgYmFja2dyb3VuZC1pbWFnZTogLW1vei1saW5lYXItZ3JhZGllbnQodG9wLCAjZGRkZGRkLCAjYmJiYmJiKTtcbiAgICBiYWNrZ3JvdW5kLWltYWdlOiAtbXMtbGluZWFyLWdyYWRpZW50KHRvcCwgI2RkZGRkZCwgI2JiYmJiYik7XG4gICAgYmFja2dyb3VuZC1pbWFnZTogLW8tbGluZWFyLWdyYWRpZW50KHRvcCwgI2RkZGRkZCwgI2JiYmJiYik7XG4gICAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2RkZGRkZCwgI2JiYmJiYik7XG4gICAgYm9yZGVyOiAxcHggc29saWQgI2JiYjtcbiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzk5OTtcbiAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgdGV4dC1zaGFkb3c6IDAgMXB4IDAgI2RkZDtcbn1cbi5zcC1jb250YWluZXIgYnV0dG9uOmFjdGl2ZSB7XG4gICAgYm9yZGVyOiAxcHggc29saWQgI2FhYTtcbiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzg4ODtcbiAgICAtd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgMCA1cHggMnB4ICNhYWFhYWEsIDAgMXB4IDAgMCAjZWVlZWVlO1xuICAgIC1tb3otYm94LXNoYWRvdzogaW5zZXQgMCAwIDVweCAycHggI2FhYWFhYSwgMCAxcHggMCAwICNlZWVlZWU7XG4gICAgLW1zLWJveC1zaGFkb3c6IGluc2V0IDAgMCA1cHggMnB4ICNhYWFhYWEsIDAgMXB4IDAgMCAjZWVlZWVlO1xuICAgIC1vLWJveC1zaGFkb3c6IGluc2V0IDAgMCA1cHggMnB4ICNhYWFhYWEsIDAgMXB4IDAgMCAjZWVlZWVlO1xuICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMCA1cHggMnB4ICNhYWFhYWEsIDAgMXB4IDAgMCAjZWVlZWVlO1xufVxuLnNwLWNhbmNlbFxue1xuICAgIGZvbnQtc2l6ZTogMTFweDtcbiAgICBjb2xvcjogI2Q5M2YzZiAhaW1wb3J0YW50O1xuICAgIG1hcmdpbjowO1xuICAgIHBhZGRpbmc6MnB4O1xuICAgIG1hcmdpbi1yaWdodDogNXB4O1xuICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7XG4gICAgdGV4dC1kZWNvcmF0aW9uOm5vbmU7XG5cbn1cbi5zcC1jYW5jZWw6aG92ZXJcbntcbiAgICBjb2xvcjogI2Q5M2YzZiAhaW1wb3J0YW50O1xuICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lO1xufVxuXG5cbi5zcC1wYWxldHRlIHNwYW46aG92ZXIsIC5zcC1wYWxldHRlIHNwYW4uc3AtdGh1bWItYWN0aXZlXG57XG4gICAgYm9yZGVyLWNvbG9yOiAjMDAwO1xufVxuXG4uc3AtcHJldmlldywgLnNwLWFscGhhLCAuc3AtdGh1bWItZWxcbntcbiAgICBwb3NpdGlvbjpyZWxhdGl2ZTtcbiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFBd0FBQUFNQ0FJQUFBRFpGOHV3QUFBQUdVbEVRVlFZVjJNNGd3SCtZd0NHSWFzSVV3aFQyNUJWQkFEdHpZTllySHZ2NGdBQUFBQkpSVTVFcmtKZ2dnPT0pO1xufVxuLnNwLXByZXZpZXctaW5uZXIsIC5zcC1hbHBoYS1pbm5lciwgLnNwLXRodW1iLWlubmVyXG57XG4gICAgZGlzcGxheTpibG9jaztcbiAgICBwb3NpdGlvbjphYnNvbHV0ZTtcbiAgICB0b3A6MDtsZWZ0OjA7Ym90dG9tOjA7cmlnaHQ6MDtcbn1cblxuLnNwLXBhbGV0dGUgLnNwLXRodW1iLWlubmVyXG57XG4gICAgYmFja2dyb3VuZC1wb3NpdGlvbjogNTAlIDUwJTtcbiAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0O1xufVxuXG4uc3AtcGFsZXR0ZSAuc3AtdGh1bWItbGlnaHQuc3AtdGh1bWItYWN0aXZlIC5zcC10aHVtYi1pbm5lclxue1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJJQUFBQVNDQVlBQUFCV3pvNVhBQUFBR1hSRldIUlRiMlowZDJGeVpRQkJaRzlpWlNCSmJXRm5aVkpsWVdSNWNjbGxQQUFBQUlWSlJFRlVlTnBpWUJoc2dKRk1mZnhBWEFCbE41SnJ1VDRRM3dmaS8wRHNUNjRoOFVEOEhtcElQQ1dHL0tlbUlmT0pDVUIrQW9hY3g2RUdCWnlIQnFJK1dzREN3dVE5bWh4ZWcyQTIxME50Zm84a2xrOXNPTWlqYVVSbTd5YzFVUDJSTkNNYktFOU9ESzFITTZpZWdZTGtmeDhwbGlnQzlsQ0Q3S21Sb2YwWmhqUUFDREFBY2VvdnJ0cFZCUmtBQUFBQVNVVk9SSzVDWUlJPSk7XG59XG5cbi5zcC1wYWxldHRlIC5zcC10aHVtYi1kYXJrLnNwLXRodW1iLWFjdGl2ZSAuc3AtdGh1bWItaW5uZXJcbntcbiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCSUFBQUFTQ0FZQUFBQld6bzVYQUFBQUFYTlNSMElBcnM0YzZRQUFBQVJuUVUxQkFBQ3hqd3Y4WVFVQUFBQUpjRWhaY3dBQURzTUFBQTdEQWNkdnFHUUFBQUFhZEVWWWRGTnZablIzWVhKbEFGQmhhVzUwTGs1RlZDQjJNeTQxTGpFd01QUnlvUUFBQU1kSlJFRlVPRSt0a2dzTnd6QU1STXVnRUFhaEVBYWhFQVpoRUFxbEVBWmhFQW9oRUFZaDgxWDJkSW04ZktwRXNwTEd2dWRQT3NVWXB4RTJCSUpDcm9KbUVXOXFKK01LYUJGaEVNTmFiU3k5b0ljSVB3ckIrYWZ2QVVGb0s0SDB0TWFRM1h0bHJnZ0RoT1ZWTXVUNEU1TU1HMEZCYkNFWXpqWVQ3T3hMRXZJSFFMWTJ6V3dRM0QrOWx1eU9RVGZLRGlGRDNpVUlmUGs4VnFyS2pnQWlTZkdGUGVjcmc2SE42bS9pQmN3aURBbzdXaUJlYXdhK0t3aDd0Wm9TQ0dMTXF3bFNBelZEaG9LKzZ2SDRHMFA1d2RrQUFBQUFTVVZPUks1Q1lJST0pO1xufVxuXG4uc3AtY2xlYXItZGlzcGxheSB7XG4gICAgYmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O1xuICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjtcbiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRkFBVUFQY0FBQUFBQUptWm1aMmRuWjZlbnFLaW9xT2pvNlNrcEtXbHBhYW1wcWVucDZpb3FLbXBxYXFxcXF1cnEvSHg4Zkx5OHZUMDlQWDE5ZmYzOS9qNCtQbjUrZnI2K3Z2Nyt3QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUNINUJBRUFBUDhBTEFBQUFBQVVBQlFBQUFpaEFQOUZvUEN2b01HREJ5MDgrRWRoUUFJSkNDTXliQ0RBQVlVRUFSQkFsRmlRUW9NQUJRaEtVSkJ4WTBTUElDRVlIQm5nZ0VtREtBdW9QTWpTNWNHWU14SFczSWlUNDc4SkpBOE0vQ2pUWjBHZ0xSZWtOR3B3QXNZQUJISXlwY0FnUU1zSVREdFdKWUJSNk5TcU1pY285Y3FSNnRLZlk3R2VCQ3VWd2xpcERObWVmQXRUcmtTekIxUmFJQW9Yb2RzQUJpWkFFRkIwNmdJQldDMW1MVmdCYTBBQU93PT0pO1xufVxuPC9zdHlsZT4nKTsKfQoKd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZ2V0TWFya2VySWNvbiA9IGZ1bmN0aW9uKGNvbG9yKSB7CiAgaWYgKHR5cGVvZihjb2xvcikgPT09ICd1bmRlZmluZWQnKSB7CiAgICBjb25zb2xlLndhcm4oJ0NvbG9yIGlzIG5vdCBzZXQgb3Igbm90IGEgdmFsaWQgY29sb3IuIFVzaW5nIGRlZmF1bHQgY29sb3IgYXMgZmFsbGJhY2suJyk7CiAgICBjb2xvciA9ICcjYTI0YWMzJzsKICB9CgogIHZhciBzdmdJY29uID0gd2luZG93LnBsdWdpbi5kcmF3VG9vbHMubWFya2VyVGVtcGxhdGUucmVwbGFjZSgvJUNPTE9SJS9nLCBjb2xvcik7CgogIHJldHVybiBMLmRpdkljb24oewogICAgaWNvblNpemU6IG5ldyBMLlBvaW50KDI1LCA0MSksCiAgICBpY29uQW5jaG9yOiBuZXcgTC5Qb2ludCgxMiwgNDEpLAogICAgaHRtbDogc3ZnSWNvbiwKICAgIGNsYXNzTmFtZTogJ2xlYWZsZXQtaWl0Yy1jdXN0b20taWNvbicsCiAgICAvLyBMLmRpdkljb24gZG9lcyBub3QgdXNlIHRoZSBvcHRpb24gY29sb3IsIGJ1dCB3ZSBzdG9yZSBpdCBoZXJlIHRvCiAgICAvLyBiZSBhYmxlIHRvIHNpbXBseSByZXRyaWV2ZSB0aGUgY29sb3IgZm9yIHNlcmlhbGl6aW5nIG1hcmtlcnMKICAgIGNvbG9yOiBjb2xvcgogIH0pOwp9Cgp3aW5kb3cucGx1Z2luLmRyYXdUb29scy5jdXJyZW50Q29sb3IgPSAnI2EyNGFjMyc7CndpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLm1hcmtlclRlbXBsYXRlID0gJzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ij8+XG48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyJcbgl2ZXJzaW9uPSIxLjEiIGJhc2VQcm9maWxlPSJmdWxsIlxuCXdpZHRoPSIyNXB4IiBoZWlnaHQ9IjQxcHgiIHZpZXdCb3g9IjAgMCAyNSA0MSI+XG5cbgk8cGF0aCBkPSJNMS4zNjI0MTg0NDc2NSwxOC42NzQ4ODEyNDY3NSBBMTIuNSwxMi41IDAgMSwxIDIzLjYzNzU4MTU1MjM1LDE4LjY3NDg4MTI0Njc1IEwxMi41LDQwLjUzMzYxNTgwNzMgWiIgc3R5bGU9InN0cm9rZTpub25lOyBmaWxsOiAlQ09MT1IlOyIgLz5cbgk8cGF0aCBkPSJNMS44MDc5MjE3MDk3NSwxOC40NDc4ODU5OTY4NSBBMTIsMTIgMCAxLDEgMjMuMTkyMDc4MjkwMjUsMTguNDQ3ODg1OTk2ODUgTDEyLjUsMzkuNDMyMjcxMTc1IFoiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDsgc3Ryb2tlLXdpZHRoOjFweDsgc3Ryb2tlLW9wYWNpdHk6IDAuMTU7IGZpbGw6IG5vbmU7IiAvPlxuCTxwYXRoIGQ9Ik0yLjkyMTY3OTg2NSwxNy44ODAzOTc4NzIyIEExMC43NSwxMC43NSAwIDEsMSAyMi4wNzgzMjAxMzUsMTcuODgwMzk3ODcyMiBMMTIuNSwzNi42Nzg5MDk1OTQzIFoiIHN0eWxlPSJzdHJva2U6I2ZmZmZmZjsgc3Ryb2tlLXdpZHRoOjEuNXB4OyBzdHJva2Utb3BhY2l0eTogMC4zNTsgZmlsbDogbm9uZTsiIC8+XG5cbgk8cGF0aCBkPSJNMTkuODYxMjE1OTMyMTUsMTcuMjUgTDEyLjUsMjEuNSBMNS4xMzg3ODQwNjc4NSwxNy4yNSBMNS4xMzg3ODQwNjc4NSw4Ljc1IEwxMi41LDQuNSBMMTkuODYxMjE1OTMyMTUsOC43NSBaIE03LjczNjg2MDI3OTIsMTAuMjUgTDE3LjI2MzEzOTcyMDgsMTAuMjUgTDEyLjUsMTguNSBaIE0xMi41LDEzIEw3LjczNjg2MDI3OTIsMTAuMjUgTTEyLjUsMTMgTDE3LjI2MzEzOTcyMDgsMTAuMjUgTTEyLjUsMTMgTDEyLjUsMTguNSBNMTkuODYxMjE1OTMyMTUsMTcuMjUgTDE2LjM5NzExNDMxNzA1LDE1LjI1IE01LjEzODc4NDA2Nzg1LDE3LjI1IEw4LjYwMjg4NTY4Mjk1LDE1LjI1IE0xMi41LDQuNSBMMTIuNSw4LjUiIHN0eWxlPSJzdHJva2U6I2ZmZmZmZjsgc3Ryb2tlLXdpZHRoOjEuMjVweDsgc3Ryb2tlLW9wYWNpdHk6IDE7IGZpbGw6IG5vbmU7IiAvPlxuXG48L3N2Zz4nOwoKd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uKCkgewoKICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5saW5lT3B0aW9ucyA9IHsKICAgIHN0cm9rZTogdHJ1ZSwKICAgIGNvbG9yOiB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5jdXJyZW50Q29sb3IsCiAgICB3ZWlnaHQ6IDQsCiAgICBvcGFjaXR5OiAwLjUsCiAgICBmaWxsOiBmYWxzZSwKICAgIGNsaWNrYWJsZTogdHJ1ZQogIH07CgogIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLnBvbHlnb25PcHRpb25zID0gTC5leHRlbmQoe30sIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmxpbmVPcHRpb25zLCB7CiAgICBmaWxsOiB0cnVlLAogICAgZmlsbENvbG9yOiBudWxsLCAvLyB0byB1c2UgdGhlIHNhbWUgYXMgJ2NvbG9yJyBmb3IgZmlsbAogICAgZmlsbE9wYWNpdHk6IDAuMgogIH0pOwoKICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5lZGl0T3B0aW9ucyA9IEwuZXh0ZW5kKHt9LCB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5wb2x5Z29uT3B0aW9ucywgewogICAgZGFzaEFycmF5OiBbMTAsMTBdCiAgfSk7CiAgZGVsZXRlIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmVkaXRPcHRpb25zLmNvbG9yOwoKICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5tYXJrZXJPcHRpb25zID0gewogICAgaWNvbjogd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuY3VycmVudE1hcmtlciwKICAgIHpJbmRleE9mZnNldDogMjAwMAogIH07Cgp9Cgp3aW5kb3cucGx1Z2luLmRyYXdUb29scy5zZXREcmF3Q29sb3IgPSBmdW5jdGlvbihjb2xvcikgewogIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmN1cnJlbnRDb2xvciA9IGNvbG9yOwogIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmN1cnJlbnRNYXJrZXIgPSB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5nZXRNYXJrZXJJY29uKGNvbG9yKTsKICAKICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5saW5lT3B0aW9ucy5jb2xvciA9IGNvbG9yOwogIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLnBvbHlnb25PcHRpb25zLmNvbG9yID0gY29sb3I7CiAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMubWFya2VyT3B0aW9ucy5pY29uID0gd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuY3VycmVudE1hcmtlcjsKICAKICBwbHVnaW4uZHJhd1Rvb2xzLmRyYXdDb250cm9sLnNldERyYXdpbmdPcHRpb25zKHsKICAgIHBvbHlnb246ICB7IHNoYXBlT3B0aW9uczogcGx1Z2luLmRyYXdUb29scy5wb2x5Z29uT3B0aW9ucyB9LAogICAgcG9seWxpbmU6IHsgc2hhcGVPcHRpb25zOiBwbHVnaW4uZHJhd1Rvb2xzLmxpbmVPcHRpb25zIH0sCiAgICBjaXJjbGU6ICAgeyBzaGFwZU9wdGlvbnM6IHBsdWdpbi5kcmF3VG9vbHMucG9seWdvbk9wdGlvbnMgfSwKICAgIG1hcmtlcjogICB7IGljb246ICAgICAgICAgcGx1Z2luLmRyYXdUb29scy5tYXJrZXJPcHRpb25zLmljb24gfSwKICB9KTsKfQoKLy8gcmVuZGVycyB0aGUgZHJhdyBjb250cm9sIGJ1dHRvbnMgaW4gdGhlIHRvcCBsZWZ0IGNvcm5lcgp3aW5kb3cucGx1Z2luLmRyYXdUb29scy5hZGREcmF3Q29udHJvbCA9IGZ1bmN0aW9uKCkgewogIHZhciBkcmF3Q29udHJvbCA9IG5ldyBMLkNvbnRyb2wuRHJhdyh7CiAgICBkcmF3OiB7CiAgICAgIHJlY3RhbmdsZTogZmFsc2UsCiAgICAgIHBvbHlnb246IHsKICAgICAgICB0aXRsZTogJ0FkZCBhIHBvbHlnb25cblxuJwogICAgICAgICAgKyAnQ2xpY2sgb24gdGhlIGJ1dHRvbiwgdGhlbiBjbGljayBvbiB0aGUgbWFwIHRvXG4nCiAgICAgICAgICArICdkZWZpbmUgdGhlIHN0YXJ0IG9mIHRoZSBwb2x5Z29uLiBDb250aW51ZSBjbGlja2luZ1xuJwogICAgICAgICAgKyAndG8gZHJhdyB0aGUgbGluZSB5b3Ugd2FudC4gQ2xpY2sgdGhlIGZpcnN0IG9yIGxhc3RcbicKICAgICAgICAgICsgJ3BvaW50IG9mIHRoZSBsaW5lIChhIHNtYWxsIHdoaXRlIHJlY3RhbmdsZSkgdG9cbicKICAgICAgICAgICsgJ2ZpbmlzaC4gRG91YmxlIGNsaWNraW5nIGFsc28gd29ya3MuJywKICAgICAgICBzaGFwZU9wdGlvbnM6IHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLnBvbHlnb25PcHRpb25zLAogICAgICAgIHNuYXBQb2ludDogd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZ2V0U25hcExhdExuZywKICAgICAgfSwKCiAgICAgIHBvbHlsaW5lOiB7CiAgICAgICAgdGl0bGU6ICdBZGQgYSAocG9seSkgbGluZS5cblxuJwogICAgICAgICAgKyAnQ2xpY2sgb24gdGhlIGJ1dHRvbiwgdGhlbiBjbGljayBvbiB0aGUgbWFwIHRvXG4nCiAgICAgICAgICArICdkZWZpbmUgdGhlIHN0YXJ0IG9mIHRoZSBsaW5lLiBDb250aW51ZSBjbGlja2luZ1xuJwogICAgICAgICAgKyAndG8gZHJhdyB0aGUgbGluZSB5b3Ugd2FudC4gQ2xpY2sgdGhlIDxiPmxhc3Q8L2I+XG4nCiAgICAgICAgICArICdwb2ludCBvZiB0aGUgbGluZSAoYSBzbWFsbCB3aGl0ZSByZWN0YW5nbGUpIHRvXG4nCiAgICAgICAgICArICdmaW5pc2guIERvdWJsZSBjbGlja2luZyBhbHNvIHdvcmtzLicsCiAgICAgICAgc2hhcGVPcHRpb25zOiB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5saW5lT3B0aW9ucywKICAgICAgICBzbmFwUG9pbnQ6IHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmdldFNuYXBMYXRMbmcsCiAgICAgIH0sCgogICAgICBjaXJjbGU6IHsKICAgICAgICB0aXRsZTogJ0FkZCBhIGNpcmNsZS5cblxuJwogICAgICAgICAgKyAnQ2xpY2sgb24gdGhlIGJ1dHRvbiwgdGhlbiBjbGljay1BTkQtSE9MRCBvbiB0aGVcbicKICAgICAgICAgICsgJ21hcCB3aGVyZSB0aGUgY2lyY2xl4oCZcyBjZW50ZXIgc2hvdWxkIGJlLiBNb3ZlXG4nCiAgICAgICAgICArICd0aGUgbW91c2UgdG8gY29udHJvbCB0aGUgcmFkaXVzLiBSZWxlYXNlIHRoZSBtb3VzZVxuJwogICAgICAgICAgKyAndG8gZmluaXNoLicsCiAgICAgICAgc2hhcGVPcHRpb25zOiB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5wb2x5Z29uT3B0aW9ucywKICAgICAgICBzbmFwUG9pbnQ6IHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmdldFNuYXBMYXRMbmcsCiAgICAgIH0sCgogICAgICAvLyBPcHRpb25zIGZvciBtYXJrZXIgKGljb24sIHpJbmRleE9mZnNldCkgYXJlIG5vdCBzZXQgdmlhIHNoYXBlT3B0aW9ucywKICAgICAgLy8gc28gd2UgaGF2ZSBtZXJnZSB0aGVtIGhlcmUhCiAgICAgIG1hcmtlcjogTC5leHRlbmQoe30sIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLm1hcmtlck9wdGlvbnMsIHsKICAgICAgICB0aXRsZTogJ0FkZCBhIG1hcmtlci5cblxuJwogICAgICAgICAgKyAnQ2xpY2sgb24gdGhlIGJ1dHRvbiwgdGhlbiBjbGljayBvbiB0aGUgbWFwIHdoZXJlXG4nCiAgICAgICAgICArICd5b3Ugd2FudCB0aGUgbWFya2VyIHRvIGFwcGVhci4nLAogICAgICAgIHNuYXBQb2ludDogd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZ2V0U25hcExhdExuZywKICAgICAgICByZXBlYXRNb2RlOiB0cnVlCiAgICAgIH0pLAoKICAgIH0sCgogICAgZWRpdDogewogICAgICBmZWF0dXJlR3JvdXA6IHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmRyYXduSXRlbXMsCgogICAgICBlZGl0OiB7CiAgICAgICAgdGl0bGU6ICdFZGl0IGRyYXduIGl0ZW1zJywKICAgICAgICBzZWxlY3RlZFBhdGhPcHRpb25zOiB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5lZGl0T3B0aW9ucywKICAgICAgfSwKCiAgICAgIHJlbW92ZTogewogICAgICAgIHRpdGxlOiAnRGVsZXRlIGRyYXduIGl0ZW1zJwogICAgICB9LAoKICAgIH0sCgogIH0pOwoKICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5kcmF3Q29udHJvbCA9IGRyYXdDb250cm9sOwoKICBtYXAuYWRkQ29udHJvbChkcmF3Q29udHJvbCk7CiAgLy9wbHVnaW4uZHJhd1Rvb2xzLmFkZEN1c3RvbUJ1dHRvbnMoKTsKCiAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuc2V0QWNjZXNzS2V5cygpOwogIGZvciAodmFyIHRvb2xiYXJJZCBpbiBkcmF3Q29udHJvbC5fdG9vbGJhcnMpIHsKICAgIGlmIChkcmF3Q29udHJvbC5fdG9vbGJhcnNbdG9vbGJhcklkXSBpbnN0YW5jZW9mIEwuVG9vbGJhcikgewogICAgICBkcmF3Q29udHJvbC5fdG9vbGJhcnNbdG9vbGJhcklkXS5vbignZW5hYmxlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgc2V0VGltZW91dCh3aW5kb3cucGx1Z2luLmRyYXdUb29scy5zZXRBY2Nlc3NLZXlzLCAxMCk7CiAgICAgIH0pOwogICAgfQogIH0KfQoKd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuc2V0QWNjZXNzS2V5cyA9IGZ1bmN0aW9uKCkgewogIHZhciBleHByID0gL1xzKlxbXHcrXF0kLzsKICAvLyB0aGVyZSBpcyBubyBBUEkgdG8gYWRkIGFjY2Vzc2tleXMsIHNvIGhhdmUgdG8gZGlnIGluIHRoZSBET00KICAvLyBtdXN0IGJlIHNhbWUgb3JkZXIgYXMgaW4gbWFya3VwLiBOb3RlIHRoYXQgZWFjaCB0b29sYmFyIGhhcyBhIGNvbnRhaW5lciBmb3Igc2F2ZS9jYW5jZWwKICB2YXIgYWNjZXNzS2V5cyA9IFsKICAgICdsJywgJ3AnLCAnbycsICdtJywgLy8gbGluZSwgcG9seWdvbiwgY2lyY2xlLCBtYXJrZXIKICAgICdhJywgICAgICAgICAgICAgICAgLy8gY2FuY2VsIChfYWJvcnQpCiAgICAnZScsICdkJywgICAgICAgICAgIC8vIGVkaXQsIGRlbGV0ZQogICAgJ3MnLCAnYScsICAgICAgICAgICAvLyBzYXZlLCBjYW5jZWwKICBdOwogIHZhciBidXR0b25zID0gd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZHJhd0NvbnRyb2wuX2NvbnRhaW5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpOwogIGZvcih2YXIgaT0wO2k8YnV0dG9ucy5sZW5ndGg7aSsrKSB7CiAgICB2YXIgYnV0dG9uID0gYnV0dG9uc1tpXTsKCiAgICB2YXIgdGl0bGUgPSBidXR0b24udGl0bGU7CiAgICB2YXIgaW5kZXggPSB0aXRsZS5zZWFyY2goZXhwcik7CiAgICBpZihpbmRleCAhPT0gLTEpIHRpdGxlID0gdGl0bGUuc3Vic3RyKDAsIGluZGV4KTsKCiAgICBpZighYnV0dG9uLm9mZnNldFBhcmVudCkgeyAvLyBlbGVtZW50IGhpZGRlbiwgZGVsZXRlIGFjY2Vzc0tleSAoc28gb3RoZXIgZWxlbWVudHMgY2FuIHVzZSBpdCkKICAgICAgYnV0dG9uLmFjY2Vzc0tleSA9ICcnOwogICAgfSBlbHNlIGlmKGFjY2Vzc0tleXNbaV0pIHsKICAgICAgYnV0dG9uLmFjY2Vzc0tleSA9IGFjY2Vzc0tleXNbaV07CiAgICAgIGlmKHRpdGxlID09PSAiIikgdGl0bGUgPSAiWyIgKyBhY2Nlc3NLZXlzW2ldICsgIl0iOwogICAgICBlbHNlIHRpdGxlICs9ICIgWyIgKyBhY2Nlc3NLZXlzW2ldICsgIl0iOwogICAgfQogICAgYnV0dG9uLnRpdGxlID0gdGl0bGU7CiAgfQp9CgoKLy8gZ2l2ZW4gYSBwb2ludCBpdCB0cmllcyB0byBmaW5kIHRoZSBtb3N0IHN1aXRhYmxlIHBvcnRhbCB0bwovLyBzbmFwIHRvLiBJdCB0YWtlcyB0aGUgQ2lyY2xlTWFya2Vy4oCZcyByYWRpdXMgYW5kIHdlaWdodCBpbnRvIGFjY291bnQuCi8vIFdpbGwgcmV0dXJuIG51bGwgaWYgbm90aGluZyB0byBzbmFwIHRvIG9yIGEgTGF0TG5nIGluc3RhbmNlLgp3aW5kb3cucGx1Z2luLmRyYXdUb29scy5nZXRTbmFwTGF0TG5nID0gZnVuY3Rpb24odW5zbmFwcGVkTGF0TG5nKSB7CiAgdmFyIGNvbnRhaW5lclBvaW50ID0gbWFwLmxhdExuZ1RvQ29udGFpbmVyUG9pbnQodW5zbmFwcGVkTGF0TG5nKTsKICB2YXIgY2FuZGlkYXRlcyA9IFtdOwogICQuZWFjaCh3aW5kb3cucG9ydGFscywgZnVuY3Rpb24oZ3VpZCwgcG9ydGFsKSB7CiAgICB2YXIgbGwgPSBwb3J0YWwuZ2V0TGF0TG5nKCk7CiAgICB2YXIgcHAgPSBtYXAubGF0TG5nVG9Db250YWluZXJQb2ludChsbCk7CiAgICB2YXIgc2l6ZSA9IHBvcnRhbC5vcHRpb25zLndlaWdodCArIHBvcnRhbC5vcHRpb25zLnJhZGl1czsKICAgIHZhciBkaXN0ID0gcHAuZGlzdGFuY2VUbyhjb250YWluZXJQb2ludCk7CiAgICBpZihkaXN0ID4gc2l6ZSkgcmV0dXJuIHRydWU7CiAgICBjYW5kaWRhdGVzLnB1c2goW2Rpc3QsIGxsXSk7CiAgfSk7CgogIGlmKGNhbmRpZGF0ZXMubGVuZ3RoID09PSAwKSByZXR1cm4gdW5zbmFwcGVkTGF0TG5nOwogIGNhbmRpZGF0ZXMgPSBjYW5kaWRhdGVzLnNvcnQoZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gYVswXS1iWzBdOyB9KTsKICByZXR1cm4gbmV3IEwuTGF0TG5nKGNhbmRpZGF0ZXNbMF1bMV0ubGF0LCBjYW5kaWRhdGVzWzBdWzFdLmxuZyk7ICAvL3JldHVybiBhIGNsb25lIG9mIHRoZSBwb3J0YWwgbG9jYXRpb24KfQoKCndpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLnNhdmUgPSBmdW5jdGlvbigpIHsKICB2YXIgZGF0YSA9IFtdOwoKICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5kcmF3bkl0ZW1zLmVhY2hMYXllciggZnVuY3Rpb24obGF5ZXIpIHsKICAgIHZhciBpdGVtID0ge307CiAgICBpZiAobGF5ZXIgaW5zdGFuY2VvZiBMLkdlb2Rlc2ljQ2lyY2xlIHx8IGxheWVyIGluc3RhbmNlb2YgTC5DaXJjbGUpIHsKICAgICAgaXRlbS50eXBlID0gJ2NpcmNsZSc7CiAgICAgIGl0ZW0ubGF0TG5nID0gbGF5ZXIuZ2V0TGF0TG5nKCk7CiAgICAgIGl0ZW0ucmFkaXVzID0gbGF5ZXIuZ2V0UmFkaXVzKCk7CiAgICAgIGl0ZW0uY29sb3IgPSBsYXllci5vcHRpb25zLmNvbG9yOwogICAgfSBlbHNlIGlmIChsYXllciBpbnN0YW5jZW9mIEwuR2VvZGVzaWNQb2x5Z29uIHx8IGxheWVyIGluc3RhbmNlb2YgTC5Qb2x5Z29uKSB7CiAgICAgIGl0ZW0udHlwZSA9ICdwb2x5Z29uJzsKICAgICAgaXRlbS5sYXRMbmdzID0gbGF5ZXIuZ2V0TGF0TG5ncygpOwogICAgICBpdGVtLmNvbG9yID0gbGF5ZXIub3B0aW9ucy5jb2xvcjsKICAgIH0gZWxzZSBpZiAobGF5ZXIgaW5zdGFuY2VvZiBMLkdlb2Rlc2ljUG9seWxpbmUgfHwgbGF5ZXIgaW5zdGFuY2VvZiBMLlBvbHlsaW5lKSB7CiAgICAgIGl0ZW0udHlwZSA9ICdwb2x5bGluZSc7CiAgICAgIGl0ZW0ubGF0TG5ncyA9IGxheWVyLmdldExhdExuZ3MoKTsKICAgICAgaXRlbS5jb2xvciA9IGxheWVyLm9wdGlvbnMuY29sb3I7CiAgICB9IGVsc2UgaWYgKGxheWVyIGluc3RhbmNlb2YgTC5NYXJrZXIpIHsKICAgICAgaXRlbS50eXBlID0gJ21hcmtlcic7CiAgICAgIGl0ZW0ubGF0TG5nID0gbGF5ZXIuZ2V0TGF0TG5nKCk7CiAgICAgIGl0ZW0uY29sb3IgPSBsYXllci5vcHRpb25zLmljb24ub3B0aW9ucy5jb2xvcjsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnNvbGUud2FybignVW5rbm93biBsYXllciB0eXBlIHdoZW4gc2F2aW5nIGRyYXcgdG9vbHMgbGF5ZXInKTsKICAgICAgcmV0dXJuOyAvLy5lYWNoTGF5ZXIgJ2NvbnRpbnVlJwogICAgfQoKICAgIGRhdGEucHVzaChpdGVtKTsKICB9KTsKCiAgbG9jYWxTdG9yYWdlWydwbHVnaW4tZHJhdy10b29scy1sYXllciddID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7CgogIGNvbnNvbGUubG9nKCdkcmF3LXRvb2xzOiBzYXZlZCB0byBsb2NhbFN0b3JhZ2UnKTsKfQoKd2luZG93LnBsdWdpbi5kcmF3VG9vbHMubG9hZCA9IGZ1bmN0aW9uKCkgewogIHRyeSB7CiAgICB2YXIgZGF0YVN0ciA9IGxvY2FsU3RvcmFnZVsncGx1Z2luLWRyYXctdG9vbHMtbGF5ZXInXTsKICAgIGlmIChkYXRhU3RyID09PSB1bmRlZmluZWQpIHJldHVybjsKCiAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoZGF0YVN0cik7CiAgICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5pbXBvcnQoZGF0YSk7CgogIH0gY2F0Y2goZSkgewogICAgY29uc29sZS53YXJuKCdkcmF3LXRvb2xzOiBmYWlsZWQgdG8gbG9hZCBkYXRhIGZyb20gbG9jYWxTdG9yYWdlOiAnK2UpOwogIH0KfQoKd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuaW1wb3J0ID0gZnVuY3Rpb24oZGF0YSkgewogICQuZWFjaChkYXRhLCBmdW5jdGlvbihpbmRleCxpdGVtKSB7CiAgICB2YXIgbGF5ZXIgPSBudWxsOwogICAgdmFyIGV4dHJhT3B0ID0ge307CiAgICBpZiAoaXRlbS5jb2xvcikgZXh0cmFPcHQuY29sb3IgPSBpdGVtLmNvbG9yOwoKICAgIHN3aXRjaChpdGVtLnR5cGUpIHsKICAgICAgY2FzZSAncG9seWxpbmUnOgogICAgICAgIGxheWVyID0gTC5nZW9kZXNpY1BvbHlsaW5lKGl0ZW0ubGF0TG5ncywgTC5leHRlbmQoe30sd2luZG93LnBsdWdpbi5kcmF3VG9vbHMubGluZU9wdGlvbnMsZXh0cmFPcHQpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAncG9seWdvbic6CiAgICAgICAgbGF5ZXIgPSBMLmdlb2Rlc2ljUG9seWdvbihpdGVtLmxhdExuZ3MsIEwuZXh0ZW5kKHt9LHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLnBvbHlnb25PcHRpb25zLGV4dHJhT3B0KSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2NpcmNsZSc6CiAgICAgICAgbGF5ZXIgPSBMLmdlb2Rlc2ljQ2lyY2xlKGl0ZW0ubGF0TG5nLCBpdGVtLnJhZGl1cywgTC5leHRlbmQoe30sd2luZG93LnBsdWdpbi5kcmF3VG9vbHMucG9seWdvbk9wdGlvbnMsZXh0cmFPcHQpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnbWFya2VyJzoKICAgICAgICB2YXIgZXh0cmFNYXJrZXJPcHQgPSB7fTsKICAgICAgICBpZiAoaXRlbS5jb2xvcikgZXh0cmFNYXJrZXJPcHQuaWNvbiA9IHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmdldE1hcmtlckljb24oaXRlbS5jb2xvcik7CiAgICAgICAgbGF5ZXIgPSBMLm1hcmtlcihpdGVtLmxhdExuZywgTC5leHRlbmQoe30sd2luZG93LnBsdWdpbi5kcmF3VG9vbHMubWFya2VyT3B0aW9ucyxleHRyYU1hcmtlck9wdCkpOwogICAgICAgIHdpbmRvdy5yZWdpc3Rlck1hcmtlckZvck9NUyhsYXllcik7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc29sZS53YXJuKCd1bmtub3duIGxheWVyIHR5cGUgIicraXRlbS50eXBlKyciIHdoZW4gbG9hZGluZyBkcmF3IHRvb2xzIGxheWVyJyk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAobGF5ZXIpIHsKICAgICAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZHJhd25JdGVtcy5hZGRMYXllcihsYXllcik7CiAgICB9CiAgfSk7CgogIHJ1bkhvb2tzKCdwbHVnaW5EcmF3VG9vbHMnLCB7ZXZlbnQ6ICdpbXBvcnQnfSk7Cgp9CgoKLy9EcmF3IFRvb2xzIE9wdGlvbnMKCi8vIE1hbnVhbCBpbXBvcnQsIGV4cG9ydCBhbmQgcmVzZXQgZGF0YQp3aW5kb3cucGx1Z2luLmRyYXdUb29scy5tYW51YWxPcHQgPSBmdW5jdGlvbigpIHsKCiAgdmFyIGh0bWwgPSAnPGRpdiBjbGFzcz0iZHJhd3Rvb2xzU3R5bGVzIj4nCiAgICAgICAgICAgKyAnPGlucHV0IHR5cGU9ImNvbG9yIiBuYW1lPSJkcmF3Q29sb3IiIGlkPSJkcmF3dG9vbHNfY29sb3IiPjwvaW5wdXQ+JwovL1RPRE86IGFkZCBsaW5lIHN0eWxlIGNob29zZXJzOiB0aGlja25lc3MsIG1heWJlIGRhc2ggc3R5bGVzPwogICAgICAgICAgICsgJzwvZGl2PicKICAgICAgICAgICArICc8ZGl2IGNsYXNzPSJkcmF3dG9vbHNTZXRib3giPicKICAgICAgICAgICArICc8YSBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmRyYXdUb29scy5vcHRDb3B5KCk7IiB0YWJpbmRleD0iMCI+Q29weSBEcmF3biBJdGVtczwvYT4nCiAgICAgICAgICAgKyAnPGEgb25jbGljaz0id2luZG93LnBsdWdpbi5kcmF3VG9vbHMub3B0UGFzdGUoKTtyZXR1cm4gZmFsc2U7IiB0YWJpbmRleD0iMCI+UGFzdGUgRHJhd24gSXRlbXM8L2E+JwogICAgICAgICAgICsgKHdpbmRvdy5yZXF1ZXN0RmlsZSAhPSB1bmRlZmluZWQKICAgICAgICAgICAgID8gJzxhIG9uY2xpY2s9IndpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLm9wdEltcG9ydCgpO3JldHVybiBmYWxzZTsiIHRhYmluZGV4PSIwIj5JbXBvcnQgRHJhd24gSXRlbXM8L2E+JyA6ICcnKQogICAgICAgICAgICsgKCh0eXBlb2YgYW5kcm9pZCAhPT0gJ3VuZGVmaW5lZCcgJiYgYW5kcm9pZCAmJiBhbmRyb2lkLnNhdmVGaWxlKQogICAgICAgICAgICAgPyAnPGEgb25jbGljaz0id2luZG93LnBsdWdpbi5kcmF3VG9vbHMub3B0RXhwb3J0KCk7cmV0dXJuIGZhbHNlOyIgdGFiaW5kZXg9IjAiPkV4cG9ydCBEcmF3biBJdGVtczwvYT4nIDogJycpCiAgICAgICAgICAgKyAnPGEgb25jbGljaz0id2luZG93LnBsdWdpbi5kcmF3VG9vbHMub3B0UmVzZXQoKTtyZXR1cm4gZmFsc2U7IiB0YWJpbmRleD0iMCI+UmVzZXQgRHJhd24gSXRlbXM8L2E+JwogICAgICAgICAgICsgJzxhIG9uY2xpY2s9IndpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLnNuYXBUb1BvcnRhbHMoKTtyZXR1cm4gZmFsc2U7IiB0YWJpbmRleD0iMCI+U25hcCB0byBwb3J0YWxzPC9hPicKICAgICAgICAgICArICc8L2Rpdj4nOwoKICBkaWFsb2coewogICAgaHRtbDogaHRtbCwKICAgIGlkOiAncGx1Z2luLWRyYXd0b29scy1vcHRpb25zJywKICAgIGRpYWxvZ0NsYXNzOiAndWktZGlhbG9nLWRyYXd0b29sc1NldCcsCiAgICB0aXRsZTogJ0RyYXcgVG9vbHMgT3B0aW9ucycKICB9KTsKCiAgLy8gbmVlZCB0byBpbml0aWFsaXNlIHRoZSAnc3BlY3RydW0nIGNvbG91ciBwaWNrZXIKICAkKCcjZHJhd3Rvb2xzX2NvbG9yJykuc3BlY3RydW0oewogICAgZmxhdDogZmFsc2UsCiAgICBzaG93SW5wdXQ6IGZhbHNlLAogICAgc2hvd0J1dHRvbnM6IGZhbHNlLAogICAgc2hvd1BhbGV0dGU6IHRydWUsCiAgICBzaG93U2VsZWN0aW9uUGFsZXR0ZTogZmFsc2UsCiAgICBwYWxldHRlOiBbIFsnI2EyNGFjMycsJyM1MTRhYzMnLCcjNGFhOGMzJywnIzUxYzM0YSddLAogICAgICAgICAgICAgICBbJyNjMWMzNGEnLCcjYzM4YTRhJywnI2MzNGE0YScsJyNjMzRhNmYnXSwKICAgICAgICAgICAgICAgWycjMDAwMDAwJywnIzY2NjY2NicsJyNiYmJiYmInLCcjZmZmZmZmJ10KICAgIF0sCiAgICBjaGFuZ2U6IGZ1bmN0aW9uKGNvbG9yKSB7IHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLnNldERyYXdDb2xvcihjb2xvci50b0hleFN0cmluZygpKTsgfSwKLy8gICAgbW92ZTogZnVuY3Rpb24oY29sb3IpIHsgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuc2V0RHJhd0NvbG9yKGNvbG9yLnRvSGV4U3RyaW5nKCkpOyB9LAogICAgY29sb3I6IHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmN1cnJlbnRDb2xvciwKICB9KTsKfQoKd2luZG93LnBsdWdpbi5kcmF3VG9vbHMub3B0QWxlcnQgPSBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAkKCcudWktZGlhbG9nLWRyYXd0b29sc1NldCAudWktZGlhbG9nLWJ1dHRvbnNldCcpLnByZXBlbmQoJzxwIGNsYXNzPSJkcmF3dG9vbHMtYWxlcnQiIHN0eWxlPSJmbG9hdDpsZWZ0O21hcmdpbi10b3A6NHB4OyI+JyttZXNzYWdlKyc8L3A+Jyk7CiAgICAkKCcuZHJhd3Rvb2xzLWFsZXJ0JykuZGVsYXkoMjUwMCkuZmFkZU91dCgpOwp9Cgp3aW5kb3cucGx1Z2luLmRyYXdUb29scy5vcHRDb3B5ID0gZnVuY3Rpb24oKSB7CiAgICBpZiAodHlwZW9mIGFuZHJvaWQgIT09ICd1bmRlZmluZWQnICYmIGFuZHJvaWQgJiYgYW5kcm9pZC5zaGFyZVN0cmluZykgewogICAgICAgIGFuZHJvaWQuc2hhcmVTdHJpbmcobG9jYWxTdG9yYWdlWydwbHVnaW4tZHJhdy10b29scy1sYXllciddKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBzdG9ja1dhcm5pbmdzID0ge307CiAgICAgIHZhciBzdG9ja0xpbmtzID0gW107CiAgICAgIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmRyYXduSXRlbXMuZWFjaExheWVyKCBmdW5jdGlvbihsYXllcikgewogICAgICAgIGlmIChsYXllciBpbnN0YW5jZW9mIEwuR2VvZGVzaWNDaXJjbGUgfHwgbGF5ZXIgaW5zdGFuY2VvZiBMLkNpcmNsZSkgewogICAgICAgICAgc3RvY2tXYXJuaW5ncy5ub0NpcmNsZSA9IHRydWU7CiAgICAgICAgICByZXR1cm47IC8vLmVhY2hMYXllciAnY29udGludWUnCiAgICAgICAgfSBlbHNlIGlmIChsYXllciBpbnN0YW5jZW9mIEwuR2VvZGVzaWNQb2x5Z29uIHx8IGxheWVyIGluc3RhbmNlb2YgTC5Qb2x5Z29uKSB7CiAgICAgICAgICBzdG9ja1dhcm5pbmdzLnBvbHlBc0xpbmUgPSB0cnVlOwogICAgICAgICAgLy8gYnV0IHdlIGNhbiBleHBvcnQgdGhlbQogICAgICAgIH0gZWxzZSBpZiAobGF5ZXIgaW5zdGFuY2VvZiBMLkdlb2Rlc2ljUG9seWxpbmUgfHwgbGF5ZXIgaW5zdGFuY2VvZiBMLlBvbHlsaW5lKSB7CiAgICAgICAgICAvLyBwb2x5bGluZXMgYXJlIGZpbmUKICAgICAgICB9IGVsc2UgaWYgKGxheWVyIGluc3RhbmNlb2YgTC5NYXJrZXIpIHsKICAgICAgICAgIHN0b2NrV2FybmluZ3Mubm9NYXJrZXIgPSB0cnVlOwogICAgICAgICAgcmV0dXJuOyAvLy5lYWNoTGF5ZXIgJ2NvbnRpbnVlJwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdG9ja1dhcm5pbmdzLnVua25vd24gPSB0cnVlOyAvL3Nob3VsZCBuZXZlciBoYXBwZW4KICAgICAgICAgIHJldHVybjsgLy8uZWFjaExheWVyICdjb250aW51ZScKICAgICAgICB9CiAgICAgICAgLy8gb25seSBwb2x5Z29ucyBhbmQgcG9seWxpbmVzIG1ha2UgaXQgdGhyb3VnaCB0byBoZXJlCiAgICAgICAgdmFyIGxhdExuZ3MgPSBsYXllci5nZXRMYXRMbmdzKCk7CiAgICAgICAgLy8gc3RvY2sgb25seSBoYW5kbGVzIG9uZSBsaW5lIHNlZ21lbnQgYXQgYSB0aW1lCiAgICAgICAgZm9yICh2YXIgaT0wOyBpPGxhdExuZ3MubGVuZ3RoLTE7IGkrKykgewogICAgICAgICAgc3RvY2tMaW5rcy5wdXNoKFtsYXRMbmdzW2ldLmxhdCxsYXRMbmdzW2ldLmxuZyxsYXRMbmdzW2krMV0ubGF0LGxhdExuZ3NbaSsxXS5sbmddKTsKICAgICAgICB9CiAgICAgICAgLy8gZm9yIHBvbHlnb25zLCB3ZSBhbHNvIG5lZWQgYSBmaW5hbCBsaW5rIGZyb20gbGFzdCB0byBmaXJzdCBwb2ludAogICAgICAgIGlmIChsYXllciBpbnN0YW5jZW9mIEwuR2VvZGVzaWNQb2x5Z29uIHx8IGxheWVyIGluc3RhbmNlb2YgTC5Qb2x5Z29uKSB7CiAgICAgICAgICBzdG9ja0xpbmtzLnB1c2goW2xhdExuZ3NbbGF0TG5ncy5sZW5ndGgtMV0ubGF0LGxhdExuZ3NbbGF0TG5ncy5sZW5ndGgtMV0ubG5nLGxhdExuZ3NbMF0ubGF0LGxhdExuZ3NbMF0ubG5nXSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdmFyIHN0b2NrVXJsID0gJ2h0dHBzOi8vd3d3LmluZ3Jlc3MuY29tL2ludGVsP2xsPScrbWFwLmdldENlbnRlcigpLmxhdCsnLCcrbWFwLmdldENlbnRlcigpLmxuZysnJno9JyttYXAuZ2V0Wm9vbSgpKycmcGxzPScrc3RvY2tMaW5rcy5tYXAoZnVuY3Rpb24obGluayl7cmV0dXJuIGxpbmsuam9pbignLCcpO30pLmpvaW4oJ18nKTsKICAgICAgdmFyIHN0b2NrV2FyblRleHRzID0gW107CiAgICAgIGlmIChzdG9ja1dhcm5pbmdzLnBvbHlBc0xpbmUpIHN0b2NrV2FyblRleHRzLnB1c2goJ05vdGU6IHBvbHlnb25zIGFyZSBleHBvcnRlZCBhcyBsaW5lcycpOwogICAgICBpZiAoc3RvY2tMaW5rcy5sZW5ndGg+NDApIHN0b2NrV2FyblRleHRzLnB1c2goJ1dhcm5pbmc6IFN0b2NrIGludGVsIG1heSBub3Qgd29yayB3aXRoIG1vcmUgdGhhbiA0MCBsaW5lIHNlZ21lbnRzIC0gdGhlcmUgYXJlICcrc3RvY2tMaW5rcy5sZW5ndGgpOwogICAgICBpZiAoc3RvY2tXYXJuaW5ncy5ub0NpcmNsZSkgc3RvY2tXYXJuVGV4dHMucHVzaCgnV2FybmluZzogQ2lyY2xlcyBjYW5ub3QgYmUgZXhwb3J0ZWQgdG8gc3RvY2sgaW50ZWwnKTsKICAgICAgaWYgKHN0b2NrV2FybmluZ3Mubm9NYXJrZXIpIHN0b2NrV2FyblRleHRzLnB1c2goJ1dhcm5pbmc6IE1hcmtlcnMgY2Fubm90IGJlIGV4cG9ydGVkIHRvIHN0b2NrIGludGVsJyk7CiAgICAgIGlmIChzdG9ja1dhcm5pbmdzLnVua25vd24pIHN0b2NrV2FyblRleHRzLnB1c2goJ1dhcm5pbmc6IFVOS05PV04gSVRFTSBUWVBFJyk7CgogICAgICB2YXIgaHRtbCA9ICc8cD48YSBvbmNsaWNrPSIkKFwnLnVpLWRpYWxvZy1kcmF3dG9vbHNTZXQtY29weSB0ZXh0YXJlYVwnKS5zZWxlY3QoKTsiPlNlbGVjdCBhbGw8L2E+IGFuZCBwcmVzcyBDVFJMK0MgdG8gY29weSBpdC48L3A+JwogICAgICAgICAgICAgICAgKyc8dGV4dGFyZWEgcmVhZG9ubHkgb25jbGljaz0iJChcJy51aS1kaWFsb2ctZHJhd3Rvb2xzU2V0LWNvcHkgdGV4dGFyZWFcJykuc2VsZWN0KCk7Ij4nK2xvY2FsU3RvcmFnZVsncGx1Z2luLWRyYXctdG9vbHMtbGF5ZXInXSsnPC90ZXh0YXJlYT4nCiAgICAgICAgICAgICAgICArJzxwPm9yLCBleHBvcnQgYXMgYSBsaW5rIGZvciB0aGUgc3RhbmRhcmQgaW50ZWwgbWFwIChmb3Igbm9uIElJVEMgdXNlcnMpPC9wPicKICAgICAgICAgICAgICAgICsnPGlucHV0IG9uY2xpY2s9ImV2ZW50LnRhcmdldC5zZWxlY3QoKTsiIHR5cGU9InRleHQiIHNpemU9IjkwIiB2YWx1ZT0iJytzdG9ja1VybCsnIi8+JzsKICAgICAgaWYgKHN0b2NrV2FyblRleHRzLmxlbmd0aD4wKSB7CiAgICAgICAgaHRtbCArPSAnPHVsPjxsaT4nK3N0b2NrV2FyblRleHRzLmpvaW4oJzwvbGk+PGxpPicpKyc8L2xpPjwvdWw+JzsKICAgICAgfQoKICAgICAgZGlhbG9nKHsKICAgICAgICBodG1sOiBodG1sLAogICAgICAgIHdpZHRoOiA2MDAsCiAgICAgICAgZGlhbG9nQ2xhc3M6ICd1aS1kaWFsb2ctZHJhd3Rvb2xzU2V0LWNvcHknLAogICAgICAgIHRpdGxlOiAnRHJhdyBUb29scyBFeHBvcnQnCiAgICAgICAgfSk7CiAgICB9Cn0KCndpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLm9wdEV4cG9ydCA9IGZ1bmN0aW9uKCkgewogIGlmKHR5cGVvZiBhbmRyb2lkICE9PSAndW5kZWZpbmVkJyAmJiBhbmRyb2lkICYmIGFuZHJvaWQuc2F2ZUZpbGUpIHsKICAgIGFuZHJvaWQuc2F2ZUZpbGUoJ0lJVEMtZHJhd24taXRlbXMuanNvbicsICdhcHBsaWNhdGlvbi9qc29uJywgbG9jYWxTdG9yYWdlWydwbHVnaW4tZHJhdy10b29scy1sYXllciddKTsKICB9Cn0KCndpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLm9wdFBhc3RlID0gZnVuY3Rpb24oKSB7CiAgdmFyIHByb21wdEFjdGlvbiA9IHByb21wdCgnUHJlc3MgQ1RSTCtWIHRvIHBhc3RlIChkcmF3LXRvb2xzIGRhdGEgb3Igc3RvY2sgaW50ZWwgVVJMKS4nLCAnJyk7CiAgaWYocHJvbXB0QWN0aW9uICE9PSBudWxsICYmIHByb21wdEFjdGlvbiAhPT0gJycpIHsKICAgIHRyeSB7CiAgICAgIC8vIGZpcnN0IHNlZSBpZiBpdCBsb29rcyBsaWtlIGEgVVJMLWZvcm1hdCBzdG9jayBpbnRlbCBsaW5rLCBhbmQgaWYgc28sIHRyeSBhbmQgcGFyc2Ugb3V0IGFueSBzdG9jayBkcmF3biBpdGVtcwogICAgICAvLyBmcm9tIHRoZSBwbHMgcGFyYW1ldGVyCiAgICAgIGlmIChwcm9tcHRBY3Rpb24ubWF0Y2gobmV3IFJlZ0V4cCgiXihodHRwcz86Ly8pPyh3d3dcXC4paW5ncmVzc1xcLmNvbS9pbnRlbC4qWz8mXXBscz0iKSkpIHsKICAgICAgICAvL2xvb2tzIGxpa2UgYSBpbmdyZXNzIFVSTCB0aGF0IGhhcyBkcmF3biBpdGVtcy4uLgogICAgICAgIHZhciBpdGVtcyA9IHByb21wdEFjdGlvbi5zcGxpdCgvWz8mXS8pOwogICAgICAgIHZhciBmb3VuZEF0ID0gLTE7CiAgICAgICAgZm9yICh2YXIgaT0wOyBpPGl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoaXRlbXNbaV0uc3Vic3RyKDAsNCkgPT0gInBscz0iKSB7CiAgICAgICAgICAgIGZvdW5kQXQgPSBpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGZvdW5kQXQgPT0gLTEpIHRocm93ICgiTm8gZHJhd24gaXRlbXMgZm91bmQgaW4gaW50ZWwgVVJMIik7CgogICAgICAgIHZhciBuZXdMaW5lcyA9IFtdOwogICAgICAgIHZhciBsaW5lc1N0ciA9IGl0ZW1zW2ZvdW5kQXRdLnN1YnN0cig0KS5zcGxpdCgnXycpOwogICAgICAgIGZvciAodmFyIGk9MDsgaTxsaW5lc1N0ci5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGZsb2F0cyA9IGxpbmVzU3RyW2ldLnNwbGl0KCcsJykubWFwKE51bWJlcik7CiAgICAgICAgICBpZiAoZmxvYXRzLmxlbmd0aCAhPSA0KSB0aHJvdygiVVJMIGl0ZW0gbm90IGEgc2V0IG9mIGZvdXIgZmxvYXRzIik7CiAgICAgICAgICBmb3IgKHZhciBqPTA7IGo8ZmxvYXRzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGlmIChpc05hTihmbG9hdHNbal0pKSB0aHJvdygiVVJMIGl0ZW0gaGFkIGludmFsaWQgbnVtYmVyIik7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgbGF5ZXIgPSBMLmdlb2Rlc2ljUG9seWxpbmUoW1tmbG9hdHNbMF0sZmxvYXRzWzFdXSxbZmxvYXRzWzJdLGZsb2F0c1szXV1dLCB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5saW5lT3B0aW9ucyk7CiAgICAgICAgICBuZXdMaW5lcy5wdXNoKGxheWVyKTsKICAgICAgICB9CgogICAgICAgIC8vIGFsbCBwYXJzZWQgT0sgLSBjbGVhciBhbmQgaW5zZXJ0CiAgICAgICAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZHJhd25JdGVtcy5jbGVhckxheWVycygpOwogICAgICAgIGZvciAodmFyIGk9MDsgaTxuZXdMaW5lcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZHJhd25JdGVtcy5hZGRMYXllcihuZXdMaW5lc1tpXSk7CiAgICAgICAgfQogICAgICAgIHJ1bkhvb2tzKCdwbHVnaW5EcmF3VG9vbHMnLCB7ZXZlbnQ6ICdpbXBvcnQnfSk7CgogICAgICAgIGNvbnNvbGUubG9nKCdEUkFXVE9PTFM6IHJlc2V0IGFuZCBpbXBvcnRlZCBkcmF3biBpdGVtcyBmcm9tIHN0b2NrIFVSTCcpOwogICAgICAgIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLm9wdEFsZXJ0KCdJbXBvcnQgU3VjY2Vzc2Z1bC4nKTsKCgogICAgICB9IGVsc2UgewogICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShwcm9tcHRBY3Rpb24pOwogICAgICAgIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmRyYXduSXRlbXMuY2xlYXJMYXllcnMoKTsKICAgICAgICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5pbXBvcnQoZGF0YSk7CiAgICAgICAgY29uc29sZS5sb2coJ0RSQVdUT09MUzogcmVzZXQgYW5kIGltcG9ydGVkIGRyYXduIGl0ZW1zJyk7CiAgICAgICAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMub3B0QWxlcnQoJ0ltcG9ydCBTdWNjZXNzZnVsLicpOwogICAgICB9CgogICAgICAvLyB0byB3cml0ZSBiYWNrIHRoZSBkYXRhIHRvIGxvY2FsU3RvcmFnZQogICAgICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5zYXZlKCk7CiAgICB9IGNhdGNoKGUpIHsKICAgICAgY29uc29sZS53YXJuKCdEUkFXVE9PTFM6IGZhaWxlZCB0byBpbXBvcnQgZGF0YTogJytlKTsKICAgICAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMub3B0QWxlcnQoJzxzcGFuIHN0eWxlPSJjb2xvcjogI2Y4OCI+SW1wb3J0IGZhaWxlZDwvc3Bhbj4nKTsKICAgIH0KICB9Cn0KCndpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLm9wdEltcG9ydCA9IGZ1bmN0aW9uKCkgewogIGlmICh3aW5kb3cucmVxdWVzdEZpbGUgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwogIHdpbmRvdy5yZXF1ZXN0RmlsZShmdW5jdGlvbihmaWxlbmFtZSwgY29udGVudCkgewogICAgdHJ5IHsKICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKGNvbnRlbnQpOwogICAgICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5kcmF3bkl0ZW1zLmNsZWFyTGF5ZXJzKCk7CiAgICAgIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmltcG9ydChkYXRhKTsKICAgICAgY29uc29sZS5sb2coJ0RSQVdUT09MUzogcmVzZXQgYW5kIGltcG9ydGVkIGRyYXduIHRpZW1zJyk7CiAgICAgIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLm9wdEFsZXJ0KCdJbXBvcnQgU3VjY2Vzc2Z1bC4nKTsKCiAgICAgIC8vIHRvIHdyaXRlIGJhY2sgdGhlIGRhdGEgdG8gbG9jYWxTdG9yYWdlCiAgICAgIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLnNhdmUoKTsKICAgIH0gY2F0Y2goZSkgewogICAgICBjb25zb2xlLndhcm4oJ0RSQVdUT09MUzogZmFpbGVkIHRvIGltcG9ydCBkYXRhOiAnK2UpOwogICAgICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5vcHRBbGVydCgnPHNwYW4gc3R5bGU9ImNvbG9yOiAjZjg4Ij5JbXBvcnQgZmFpbGVkPC9zcGFuPicpOwogICAgfQogIH0pOwp9Cgp3aW5kb3cucGx1Z2luLmRyYXdUb29scy5vcHRSZXNldCA9IGZ1bmN0aW9uKCkgewogIHZhciBwcm9tcHRBY3Rpb24gPSBjb25maXJtKCdBbGwgZHJhd24gaXRlbXMgd2lsbCBiZSBkZWxldGVkLiBBcmUgeW91IHN1cmU/JywgJycpOwogIGlmKHByb21wdEFjdGlvbikgewogICAgZGVsZXRlIGxvY2FsU3RvcmFnZVsncGx1Z2luLWRyYXctdG9vbHMtbGF5ZXInXTsKICAgIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmRyYXduSXRlbXMuY2xlYXJMYXllcnMoKTsKICAgIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmxvYWQoKTsKICAgIGNvbnNvbGUubG9nKCdEUkFXVE9PTFM6IHJlc2V0IGFsbCBkcmF3biBpdGVtcycpOwogICAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMub3B0QWxlcnQoJ1Jlc2V0IFN1Y2Nlc3NmdWwuICcpOwogICAgcnVuSG9va3MoJ3BsdWdpbkRyYXdUb29scycsIHtldmVudDogJ2NsZWFyJ30pOwogIH0KfQoKd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuc25hcFRvUG9ydGFscyA9IGZ1bmN0aW9uKCkgewogIHZhciBkYXRhUGFyYW1zID0gZ2V0TWFwWm9vbVRpbGVQYXJhbWV0ZXJzKGdldERhdGFab29tRm9yTWFwWm9vbShtYXAuZ2V0Wm9vbSgpKSk7CiAgaWYgKGRhdGFQYXJhbXMubGV2ZWwgPiAwKSB7CiAgICBpZiAoIWNvbmZpcm0oJ05vdCBhbGwgcG9ydGFscyBhcmUgdmlzaWJsZSBvbiB0aGUgbWFwLiBTbmFwIHRvIHBvcnRhbHMgbWF5IG1vdmUgdmFsaWQgcG9pbnRzIHRvIHRoZSB3cm9uZyBwbGFjZS4gQ29udGludWU/JykpIHsKICAgICAgcmV0dXJuOwogICAgfQogIH0KCiAgaWYgKG1hcERhdGFSZXF1ZXN0LnN0YXR1cy5zaG9ydCAhPSAnZG9uZScpIHsKICAgIGlmICghY29uZmlybSgnTWFwIGRhdGEgaGFzIG5vdCBjb21wbGV0ZWx5IGxvYWRlZCwgc28gc29tZSBwb3J0YWxzIG1heSBiZSBtaXNzaW5nLiBEbyB5b3Ugd2FudCB0byBjb250aW51ZT8nKSkgewogICAgICByZXR1cm47CiAgICB9CiAgfQoKICB2YXIgdmlzaWJsZUJvdW5kcyA9IG1hcC5nZXRCb3VuZHMoKTsKCiAgLy8gbGV0J3MgZG8gYWxsIHRoZSBkaXN0YW5jZSBjYWxjdWxhdGlvbnMgaW4gc2NyZWVuIHNwYWNlLiAyZCBpcyBtdWNoIGVhc2llciwgc2hvdWxkIGJlIGZhc3RlciwgYW5kIGlzIG1vcmUgdGhhbiBnb29kIGVub3VnaAogIC8vIHdlJ2xsIHByZS1wcm9qZWN0IGFsbCB0aGUgb24tc2NyZWVuIHBvcnRhbHMgdG9vLCB0byBzYXZlIHJlcGVhdGVkbHkgZG9pbmcgaXQKICB2YXIgdmlzaWJsZVBvcnRhbHMgPSB7fTsKICAkLmVhY2god2luZG93LnBvcnRhbHMsIGZ1bmN0aW9uKGd1aWQscG9ydGFsKSB7CiAgICB2YXIgbGwgPSBwb3J0YWwuZ2V0TGF0TG5nKCk7CiAgICBpZiAodmlzaWJsZUJvdW5kcy5jb250YWlucyhsbCkpIHsKICAgICAgdmlzaWJsZVBvcnRhbHNbZ3VpZF0gPSBtYXAucHJvamVjdChsbCk7CiAgICB9CiAgfSk7CgogIGlmIChPYmplY3Qua2V5cyh2aXNpYmxlUG9ydGFscykubGVuZ3RoID09IDApIHsKICAgIGFsZXJ0KCdFcnJvcjogTm8gcG9ydGFscyB2aXNpYmxlIGluIHRoaXMgdmlldyAtIG5vdGhpbmcgdG8gc25hcCBwb2ludHMgdG8hJyk7CiAgICByZXR1cm47CiAgfQoKICB2YXIgZmluZENsb3Nlc3RQb3J0YWxMYXRMbmcgPSBmdW5jdGlvbihsYXRsbmcpIHsKICAgIHZhciB0ZXN0cG9pbnQgPSBtYXAucHJvamVjdChsYXRsbmcpOwoKICAgIHZhciBtaW5EaXN0U3F1YXJlZCA9IHVuZGVmaW5lZDsKICAgIHZhciBtaW5HdWlkID0gdW5kZWZpbmVkOwogICAgZm9yICh2YXIgZ3VpZCBpbiB2aXNpYmxlUG9ydGFscykgewogICAgICB2YXIgcCA9IHZpc2libGVQb3J0YWxzW2d1aWRdOwogICAgICB2YXIgZGlzdFNxdWFyZWQgPSAodGVzdHBvaW50LngtcC54KSoodGVzdHBvaW50LngtcC54KSArICh0ZXN0cG9pbnQueS1wLnkpKih0ZXN0cG9pbnQueS1wLnkpOwogICAgICBpZiAobWluRGlzdFNxdWFyZWQgPT0gdW5kZWZpbmVkIHx8IG1pbkRpc3RTcXVhcmVkID4gZGlzdFNxdWFyZWQpIHsKICAgICAgICBtaW5EaXN0U3F1YXJlZCA9IGRpc3RTcXVhcmVkOwogICAgICAgIG1pbkd1aWQgPSBndWlkOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWluR3VpZCA/IHBvcnRhbHNbbWluR3VpZF0uZ2V0TGF0TG5nKCkgOiB1bmRlZmluZWQ7IC8vc2hvdWxkIG5ldmVyIGhpdCAndW5kZWZpbmVkJyBjYXNlIC0gYXMgd2UgYWJvcnQgd2hlbiB0aGUgbGlzdCBpcyBlbXB0eQogIH07CgoKICB2YXIgY2hhbmdlZENvdW50ID0gMDsKICB2YXIgdGVzdENvdW50ID0gMDsKCiAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZHJhd25JdGVtcy5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpIHsKICAgIGlmIChsYXllci5nZXRMYXRMbmcpIHsKICAgICAgLy9jaXJjbGVzIGFuZCBtYXJrZXJzIC0gYSBzaW5nbGUgcG9pbnQgdG8gc25hcAogICAgICB2YXIgbGwgPSBsYXllci5nZXRMYXRMbmcoKTsKICAgICAgaWYgKHZpc2libGVCb3VuZHMuY29udGFpbnMobGwpKSB7CiAgICAgICAgdGVzdENvdW50Kys7CiAgICAgICAgdmFyIG5ld2xsID0gZmluZENsb3Nlc3RQb3J0YWxMYXRMbmcobGwpOwogICAgICAgIGlmICghbmV3bGwuZXF1YWxzKGxsKSkgewogICAgICAgICAgbGF5ZXIuc2V0TGF0TG5nKG5ldyBMLkxhdExuZyhuZXdsbC5sYXQsbmV3bGwubG5nKSk7CiAgICAgICAgICBjaGFuZ2VkQ291bnQrKzsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAobGF5ZXIuZ2V0TGF0TG5ncykgewogICAgICB2YXIgbGxzID0gbGF5ZXIuZ2V0TGF0TG5ncygpOwogICAgICB2YXIgbGF5ZXJDaGFuZ2VkID0gZmFsc2U7CiAgICAgIGZvciAodmFyIGk9MDsgaTxsbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodmlzaWJsZUJvdW5kcy5jb250YWlucyhsbHNbaV0pKSB7CiAgICAgICAgICB0ZXN0Q291bnQrKzsKICAgICAgICAgIHZhciBuZXdsbCA9IGZpbmRDbG9zZXN0UG9ydGFsTGF0TG5nKGxsc1tpXSk7CiAgICAgICAgICBpZiAoIW5ld2xsLmVxdWFscyhsbHNbaV0pKSB7CiAgICAgICAgICAgIGxsc1tpXSA9IG5ldyBMLkxhdExuZyhuZXdsbC5sYXQsbmV3bGwubG5nKTsKICAgICAgICAgICAgY2hhbmdlZENvdW50Kys7CiAgICAgICAgICAgIGxheWVyQ2hhbmdlZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChsYXllckNoYW5nZWQpIHsKICAgICAgICBsYXllci5zZXRMYXRMbmdzKGxscyk7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgaWYoY2hhbmdlZENvdW50ID4gMCkgewogICAgcnVuSG9va3MoJ3BsdWdpbkRyYXdUb29scycse2V2ZW50OidsYXllcnNTbmFwcGVkVG9Qb3J0YWxzJ30pOyAvL29yIHNob3VsZCB3ZSBzZW5kICdsYXllcnNFZGl0ZWQnPyBhcyB0aGF0J3MgZWZmZWN0aXZlbHkgd2hhdCdzIGhhcHBlbmVkLi4uCiAgfQoKICBhbGVydCgnVGVzdGVkICcrdGVzdENvdW50KycgcG9pbnRzLCBhbmQgbW92ZWQgJytjaGFuZ2VkQ291bnQrJyBvbnRvIHBvcnRhbCBjb29yZGluYXRlcycpOwoKICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5zYXZlKCk7Cn0KCndpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmJvb3QgPSBmdW5jdGlvbigpIHsKICAvLyBhZGQgYSBjdXN0b20gaG9vayBmb3IgZHJhdyB0b29scyB0byBzaGFyZSBpdCdzIGFjdGl2aXR5IHdpdGggb3RoZXIgcGx1Z2lucwogIHBsdWdpbkNyZWF0ZUhvb2soJ3BsdWdpbkRyYXdUb29scycpOwoKICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5jdXJyZW50TWFya2VyID0gd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZ2V0TWFya2VySWNvbih3aW5kb3cucGx1Z2luLmRyYXdUb29scy5jdXJyZW50Q29sb3IpOwoKICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5zZXRPcHRpb25zKCk7CgogIC8vY3JlYXRlIGEgbGVhZmxldCBGZWF0dXJlR3JvdXAgdG8gaG9sZCBkcmF3biBpdGVtcwogIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLmRyYXduSXRlbXMgPSBuZXcgTC5GZWF0dXJlR3JvdXAoKTsKCiAgLy9sb2FkIGFueSBwcmV2aW91c2x5IHNhdmVkIGl0ZW1zCiAgcGx1Z2luLmRyYXdUb29scy5sb2FkKCk7CgogIC8vYWRkIHRoZSBkcmF3IGNvbnRyb2wgLSB0aGlzIHJlZmVyZW5jZXMgdGhlIGFib3ZlIEZlYXR1cmVHcm91cCBmb3IgZWRpdGluZyBwdXJwb3NlcwogIHBsdWdpbi5kcmF3VG9vbHMuYWRkRHJhd0NvbnRyb2woKTsKCiAgLy9zdGFydCBvZmYgaGlkZGVuLiBpZiB0aGUgbGF5ZXIgaXMgZW5hYmxlZCwgdGhlIGJlbG93IGFkZExheWVyR3JvdXAgd2lsbCBhZGQgaXQsIHRyaWdnZXJpbmcgYSAnc2hvdycKICAkKCcubGVhZmxldC1kcmF3LXNlY3Rpb24nKS5oaWRlKCk7CgoKICAvL2hpZGUgdGhlIGRyYXcgdG9vbHMgd2hlbiB0aGUgJ2RyYXduIGl0ZW1zJyBsYXllciBpcyBvZmYsIHNob3cgaXQgd2hlbiBvbgogIG1hcC5vbignbGF5ZXJhZGQnLCBmdW5jdGlvbihvYmopIHsKICAgIGlmKG9iai5sYXllciA9PT0gd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZHJhd25JdGVtcykgewogICAgICAkKCcubGVhZmxldC1kcmF3LXNlY3Rpb24nKS5zaG93KCk7CiAgICB9CiAgfSk7CiAgbWFwLm9uKCdsYXllcnJlbW92ZScsIGZ1bmN0aW9uKG9iaikgewogICAgaWYob2JqLmxheWVyID09PSB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5kcmF3bkl0ZW1zKSB7CiAgICAgICQoJy5sZWFmbGV0LWRyYXctc2VjdGlvbicpLmhpZGUoKTsKICAgIH0KICB9KTsKCiAgLy9hZGQgdGhlIGxheWVyCiAgd2luZG93LmFkZExheWVyR3JvdXAoJ0RyYXduIEl0ZW1zJywgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZHJhd25JdGVtcywgdHJ1ZSk7CgoKICAvL3BsYWNlIGNyZWF0ZWQgaXRlbXMgaW50byB0aGUgc3BlY2lmaWMgbGF5ZXIKICBtYXAub24oJ2RyYXc6Y3JlYXRlZCcsIGZ1bmN0aW9uKGUpIHsKICAgIHZhciB0eXBlPWUubGF5ZXJUeXBlOwogICAgdmFyIGxheWVyPWUubGF5ZXI7CiAgICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5kcmF3bkl0ZW1zLmFkZExheWVyKGxheWVyKTsKICAgIHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLnNhdmUoKTsKCiAgICBpZihsYXllciBpbnN0YW5jZW9mIEwuTWFya2VyKSB7CiAgICAgIHdpbmRvdy5yZWdpc3Rlck1hcmtlckZvck9NUyhsYXllcik7CiAgICB9CgogICAgcnVuSG9va3MoJ3BsdWdpbkRyYXdUb29scycse2V2ZW50OidsYXllckNyZWF0ZWQnLGxheWVyOmxheWVyfSk7CiAgfSk7CgogIG1hcC5vbignZHJhdzpkZWxldGVkJywgZnVuY3Rpb24oZSkgewogICAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuc2F2ZSgpOwogICAgcnVuSG9va3MoJ3BsdWdpbkRyYXdUb29scycse2V2ZW50OidsYXllcnNEZWxldGVkJ30pOwogIH0pOwoKICBtYXAub24oJ2RyYXc6ZWRpdGVkJywgZnVuY3Rpb24oZSkgewogICAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuc2F2ZSgpOwogICAgcnVuSG9va3MoJ3BsdWdpbkRyYXdUb29scycse2V2ZW50OidsYXllcnNFZGl0ZWQnfSk7CiAgfSk7CiAgLy9hZGQgb3B0aW9ucyBtZW51CiAgJCgnI3Rvb2xib3gnKS5hcHBlbmQoJzxhIG9uY2xpY2s9IndpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzLm1hbnVhbE9wdCgpO3JldHVybiBmYWxzZTsiIGFjY2Vzc2tleT0ieCIgdGl0bGU9Ilt4XSI+RHJhd1Rvb2xzIE9wdDwvYT4nKTsKCiAgJCgnaGVhZCcpLmFwcGVuZCgnPHN0eWxlPicgKwogICAgICAgICcuZHJhd3Rvb2xzU2V0Ym94ID4gYSB7IGRpc3BsYXk6YmxvY2s7IGNvbG9yOiNmZmNlMDA7IGJvcmRlcjoxcHggc29saWQgI2ZmY2UwMDsgcGFkZGluZzozcHggMDsgbWFyZ2luOjEwcHggYXV0bzsgd2lkdGg6ODAlOyB0ZXh0LWFsaWduOmNlbnRlcjsgYmFja2dyb3VuZDpyZ2JhKDgsNDgsNzgsLjkpOyB9JysKICAgICAgICAnLnVpLWRpYWxvZy1kcmF3dG9vbHNTZXQtY29weSB0ZXh0YXJlYSB7IHdpZHRoOjk2JTsgaGVpZ2h0OjI1MHB4OyByZXNpemU6dmVydGljYWw7IH0nKwogICAgICAgICc8L3N0eWxlPicpOwoKfQoKCnZhciBzZXR1cCA9ICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5sb2FkRXh0ZXJuYWxzOwoKLy8gUExVR0lOIEVORCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKc2V0dXAuaW5mbyA9IHBsdWdpbl9pbmZvOyAvL2FkZCB0aGUgc2NyaXB0IGluZm8gZGF0YSB0byB0aGUgZnVuY3Rpb24gYXMgYSBwcm9wZXJ0eQppZighd2luZG93LmJvb3RQbHVnaW5zKSB3aW5kb3cuYm9vdFBsdWdpbnMgPSBbXTsKd2luZG93LmJvb3RQbHVnaW5zLnB1c2goc2V0dXApOwovLyBpZiBJSVRDIGhhcyBhbHJlYWR5IGJvb3RlZCwgaW1tZWRpYXRlbHkgcnVuIHRoZSAnc2V0dXAnIGZ1bmN0aW9uCmlmKHdpbmRvdy5paXRjTG9hZGVkICYmIHR5cGVvZiBzZXR1cCA9PT0gJ2Z1bmN0aW9uJykgc2V0dXAoKTsKfSAvLyB3cmFwcGVyIGVuZAovLyBpbmplY3QgY29kZSBpbnRvIHNpdGUgY29udGV4dAp2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CnZhciBpbmZvID0ge307CmlmICh0eXBlb2YgR01faW5mbyAhPT0gJ3VuZGVmaW5lZCcgJiYgR01faW5mbyAmJiBHTV9pbmZvLnNjcmlwdCkgaW5mby5zY3JpcHQgPSB7IHZlcnNpb246IEdNX2luZm8uc2NyaXB0LnZlcnNpb24sIG5hbWU6IEdNX2luZm8uc2NyaXB0Lm5hbWUsIGRlc2NyaXB0aW9uOiBHTV9pbmZvLnNjcmlwdC5kZXNjcmlwdGlvbiB9OwpzY3JpcHQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJygnKyB3cmFwcGVyICsnKSgnK0pTT04uc3RyaW5naWZ5KGluZm8pKycpOycpKTsKKGRvY3VtZW50LmJvZHkgfHwgZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmFwcGVuZENoaWxkKHNjcmlwdCk7CgoK"},{"name":"IITC plugin: Fix Google Map offsets in China","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null}},"storage":{"data":{},"ts":1480917632219},"enabled":true,"position":6,"file_url":"https://static.iitc.me/build/release/plugins/fix-googlemap-china-offset.user.js","uuid":"5fa7cfc0-6224-4f48-8eaa-2794647cca48","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLWZpeC1nb29nbGVtYXAtY2hpbmEtb2Zmc2V0QGJyZWV6ZXdpc2gKLy8gQG5hbWUgICAgICAgICAgIElJVEMgcGx1Z2luOiBGaXggR29vZ2xlIE1hcCBvZmZzZXRzIGluIENoaW5hCi8vIEBjYXRlZ29yeSAgICAgICBUd2Vha3MKLy8gQHZlcnNpb24gICAgICAgIDAuMC4xLjIwMTYxMDAzLjQ3NDAKLy8gQG5hbWVzcGFjZSAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9qb25hdGtpbnMvaW5ncmVzcy1pbnRlbC10b3RhbC1jb252ZXJzaW9uCi8vIEB1cGRhdGVVUkwgICAgICBodHRwczovL3N0YXRpYy5paXRjLm1lL2J1aWxkL3JlbGVhc2UvcGx1Z2lucy9maXgtZ29vZ2xlbWFwLWNoaW5hLW9mZnNldC5tZXRhLmpzCi8vIEBkb3dubG9hZFVSTCAgICBodHRwczovL3N0YXRpYy5paXRjLm1lL2J1aWxkL3JlbGVhc2UvcGx1Z2lucy9maXgtZ29vZ2xlbWFwLWNoaW5hLW9mZnNldC51c2VyLmpzCi8vIEBkZXNjcmlwdGlvbiAgICBbaWl0Yy0yMDE2LTEwLTAzLTAwNDc0MF0gU2hvdyBjb3JyZWN0IEdvb2dsZSBNYXAgZm9yIENoaW5hIHVzZXIgYnkgYXBwbHlpbmcgb2Zmc2V0IHR3ZWFrcy4KLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBpbmNsdWRlICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAZ3JhbnQgICAgICAgICAgbm9uZQovLyA9PS9Vc2VyU2NyaXB0PT0KCgpmdW5jdGlvbiB3cmFwcGVyKHBsdWdpbl9pbmZvKSB7Ci8vIGVuc3VyZSBwbHVnaW4gZnJhbWV3b3JrIGlzIHRoZXJlLCBldmVuIGlmIGlpdGMgaXMgbm90IHlldCBsb2FkZWQKaWYodHlwZW9mIHdpbmRvdy5wbHVnaW4gIT09ICdmdW5jdGlvbicpIHdpbmRvdy5wbHVnaW4gPSBmdW5jdGlvbigpIHt9OwoKLy9QTFVHSU4gQVVUSE9SUzogd3JpdGluZyBhIHBsdWdpbiBvdXRzaWRlIG9mIHRoZSBJSVRDIGJ1aWxkIGVudmlyb25tZW50PyBpZiBzbywgZGVsZXRlIHRoZXNlIGxpbmVzISEKLy8obGVhdmluZyB0aGVtIGluIHBsYWNlIG1pZ2h0IGJyZWFrIHRoZSAnQWJvdXQgSUlUQycgcGFnZSBvciBicmVhayB1cGRhdGUgY2hlY2tzKQpwbHVnaW5faW5mby5idWlsZE5hbWUgPSAnaWl0Yyc7CnBsdWdpbl9pbmZvLmRhdGVUaW1lVmVyc2lvbiA9ICcyMDE2MTAwMy40NzQwJzsKcGx1Z2luX2luZm8ucGx1Z2luSWQgPSAnZml4LWdvb2dsZW1hcC1jaGluYS1vZmZzZXQnOwovL0VORCBQTFVHSU4gQVVUSE9SUyBOT1RFCgoKCi8vIFBMVUdJTiBTVEFSVCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLy8gdXNlIG93biBuYW1lc3BhY2UgZm9yIHBsdWdpbgp3aW5kb3cucGx1Z2luLmZpeENoaW5hT2Zmc2V0ID0ge307CgovLyBCZWZvcmUgdW5kZXJzdGFuZGluZyBob3cgdGhpcyBwbHVnaW4gd29ya3MsIHlvdSBzaG91bGQga25vdyAzIHBvaW50czoKLy8gCi8vICAgUG9pbnQxLgovLyAgICAgVGhlIGNvb3JkaW5hdGUgc3lzdGVtIG9mIEluZ3Jlc3MgaXMgV0dTLTg0LgovLyAgICAgSG93ZXZlciwgdGhlIHRpbGVzIG9mIEdvb2dsZSBtYXBzIChleGNlcHQgc2F0ZWxsaXRlIG1hcCkgaW4gQ2hpbmEgaGF2ZQovLyAgICAgb2Zmc2V0cyAoYmFzZSBvbiBHQ0otMDIgY29vcmRpbmF0ZSBzeXN0ZW0pIGJ5IENoaW5hIHBvbGljeS4KLy8gICAgIFRoYXQgbWVhbnMsIGlmIHlvdSByZXF1ZXN0IG1hcCB0aWxlcyBieSBnaXZpbmcgR0NKLTAyIHBvc2l0aW9uLCB5b3UKLy8gICAgIHdpbGwgZ2V0IHRoZSBjb3JyZWN0IG1hcC4KLy8gICAKLy8gICBQb2ludDIuCi8vICAgICBDdXJyZW50bHkgdGhlcmUgYXJlIG5vIGVhc3kgYWxnb3JpdGhtIHRvIHRyYW5zZm9ybSBmcm9tIEdDSi0wMiB0byBXR1MtODQsCi8vICAgICBidXQgd2UgY2FuIGVhc2lseSB0cmFuc2Zvcm0gZGF0YSBmcm9tIFdHUy04NCB0byBHQ0otMDIuCi8vICAgCi8vICAgUG9pbnQzLgovLyAgICAgV2hlbiB1c2luZyBHb29nbGUgbWFwcyBpbiBJSVRDLCB0aGUgbGF5ZXIgc3RydWN0dXJlIGxvb2tzIGxpa2UgdGhpczoKLy8gICAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vICAgICB8IE90aGVyIExlYWZsZXQgbGF5ZXJzIHwgIChJbmNsdWRpbmcgcG9ydGFscywgbGlua3MsIGZpZWxkcywgYW5kIHNvIG9uKQovLyAgICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gICAgIHwgICAgICAgTC5Hb29nbGUgICAgICAgfCAgKE9ubHkgZm9yIGNvbnRyb2xpbmcpCi8vICAgICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAgICAgfCAgIEdvb2dsZSBNYXAgbGF5ZXIgICB8ICAoR2VuZXJhdGVkIGJ5IEdvb2dsZSBNYXAgQVBJcywgZm9yIHJlbmRlcmluZyBtYXBzKQovLyAgICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gICAgIAovLyAgICAgV2hlbiB1c2VycyBhcmUgaW50ZXJhY3Rpbmcgd2l0aCBMLkdvb2dsZSAoZm9yIGV4YW1wbGUsIGRyYWdnaW5nLCB6b29taW5nKSwKLy8gICAgIEwuR29vZ2xlIHdpbGwgcGVyZm9ybSB0aGUgc2FtZSBhY3Rpb24gb24gdGhlIEdvb2dsZSBNYXAgbGF5ZXIgdXNpbmcgR29vZ2xlCi8vICAgICBNYXAgQVBJcy4gCi8vIAovLyBTbywgaGVyZSBpcyB0aGUgaW50ZXJuYWwgb2YgdGhlIHBsdWdpbjoKLy8gCi8vIFRoZSBwbHVnaW4gb3ZlcndyaXRlcyBiZWhhdmlvdXJzIG9mIEwuR29vZ2xlLiBXaGVuIHVzZXJzIGFyZSBkcmFnZ2luZyB0aGUgbWFwLAovLyBMLkdvb2dsZSB3aWxsIHBhc3Mgb2Zmc2V0ZWQgcG9zaXRpb25zIHRvIEdvb2dsZSBNYXAgQVBJcyAoV0dTLTg0IHRvIEdDSi0wMikuCi8vIFNvIEdvb2dsZSBNYXAgQVBJcyB3aWxsIHJlbmRlciBhIGNvcnJlY3QgbWFwLgovLyAKLy8gVGhlIG9mZnNldCBiZXR3ZWVuIEdvb2dsZSBtYXBzIGFuZCBJbmdyZXNzIG9iamVjdHMgY2FuIGFsc28gYmUgZml4ZWQgYnkgYXBwbHlpbmcKLy8gV0dTLTg0IHRvIEdDSi0wMiB0cmFuc2Zvcm1hdGlvbiBvbiBJbmdyZXNzIG9iamVjdHMuIEhvd2V2ZXIgd2UgY2Fubm90IHNpbXBseSBrbm93Ci8vIHRoZSByZXF1ZXN0aW5nIGJvdW5kcyBvZiBJbmdyZXNzIG9iamVjdHMgYmVjYXVzZSB3ZSBjYW5ub3QgdHJhbnNmb3JtIEdDSi0wMiB0bwovLyBXR1MtODQuIEFzIGEgcmVzdWx0LCB0aGUgSW5ncmVzcyBvYmplY3RzIG9uIG1hcHMgd291bGQgYmUgaW5jb21wbGV0ZS4KLy8gCi8vIFRoZSBhbGdvcml0aG0gb2YgdHJhbnNmb3JtaW5nIFdHUy04NCB0byBHQ0otMDIgY29tZXMgZnJvbToKLy8gaHR0cHM6Ly9vbjR3cDcuY29kZXBsZXguY29tL1NvdXJjZUNvbnRyb2wvY2hhbmdlc2V0L3ZpZXcvMjE0ODMjMzUzOTM2Ci8vIFRoZXJlIGlzIG5vIG9mZmljaWFsIGFsZ29yaXRobSBiZWNhdXNlIGl0IGlzIGNsYXNzaWZpZWQgaW5mb3JtYXRpb24uCgovLy8vLy8vLy8vLyBiZWdpbiBXR1M4NCB0byBHQ0otMDIgdHJhbnNmb3JtZXIgLy8vLy8vLy8vCnZhciBXR1M4NHRyYW5zZm9ybWVyID0gd2luZG93LnBsdWdpbi5maXhDaGluYU9mZnNldC5XR1M4NHRyYW5zZm9ybWVyID0gZnVuY3Rpb24oKSB7fTsKLy8gS3Jhc292c2t5IDE5NDAKLy8gCi8vIGEgPSA2Mzc4MjQ1LjAsIDEvZiA9IDI5OC4zCi8vIGIgPSBhICogKDEgLSBmKQovLyBlZSA9IChhXjIgLSBiXjIpIC8gYV4yOwpXR1M4NHRyYW5zZm9ybWVyLnByb3RvdHlwZS5hID0gNjM3ODI0NS4wOwpXR1M4NHRyYW5zZm9ybWVyLnByb3RvdHlwZS5lZSA9IDAuMDA2NjkzNDIxNjIyOTY1OTQzMjM7CgpXR1M4NHRyYW5zZm9ybWVyLnByb3RvdHlwZS50cmFuc2Zvcm0gPSBmdW5jdGlvbih3Z0xhdCwgd2dMbmcpIHsKCiAgaWYodGhpcy5pc091dE9mQ2hpbmEod2dMYXQsIHdnTG5nKSkKICAgIHJldHVybiB7bGF0OiB3Z0xhdCwgbG5nOiB3Z0xuZ307CgogIGRMYXQgPSB0aGlzLnRyYW5zZm9ybUxhdCh3Z0xuZyAtIDEwNS4wLCB3Z0xhdCAtIDM1LjApOwogIGRMbmcgPSB0aGlzLnRyYW5zZm9ybUxuZyh3Z0xuZyAtIDEwNS4wLCB3Z0xhdCAtIDM1LjApOwogIHJhZExhdCA9IHdnTGF0IC8gMTgwLjAgKiBNYXRoLlBJOwogIG1hZ2ljID0gTWF0aC5zaW4ocmFkTGF0KTsKICBtYWdpYyA9IDEgLSB0aGlzLmVlICogbWFnaWMgKiBtYWdpYzsKICBzcXJ0TWFnaWMgPSBNYXRoLnNxcnQobWFnaWMpOwogIGRMYXQgPSAoZExhdCAqIDE4MC4wKSAvICgodGhpcy5hICogKDEgLSB0aGlzLmVlKSkgLyAobWFnaWMgKiBzcXJ0TWFnaWMpICogTWF0aC5QSSk7CiAgZExuZyA9IChkTG5nICogMTgwLjApIC8gKHRoaXMuYSAvIHNxcnRNYWdpYyAqIE1hdGguY29zKHJhZExhdCkgKiBNYXRoLlBJKTsKICBtZ0xhdCA9IHdnTGF0ICsgZExhdDsKICBtZ0xuZyA9IHdnTG5nICsgZExuZzsKCiAgcmV0dXJuIHtsYXQ6IG1nTGF0LCBsbmc6IG1nTG5nfTsKCn07CgpXR1M4NHRyYW5zZm9ybWVyLnByb3RvdHlwZS5pc091dE9mQ2hpbmEgPSBmdW5jdGlvbihsYXQsIGxuZykgewogIAogIGlmKGxuZyA8IDcyLjAwNCB8fCBsbmcgPiAxMzcuODM0NykgcmV0dXJuIHRydWU7CiAgaWYobGF0IDwgMC44MjkzIHx8IGxhdCA+IDU1LjgyNzEpIHJldHVybiB0cnVlOwogIAogIHJldHVybiBmYWxzZTsKCn07CgpXR1M4NHRyYW5zZm9ybWVyLnByb3RvdHlwZS50cmFuc2Zvcm1MYXQgPSBmdW5jdGlvbih4LCB5KSB7CiAgCiAgdmFyIHJldCA9IC0xMDAuMCArIDIuMCAqIHggKyAzLjAgKiB5ICsgMC4yICogeSAqIHkgKyAwLjEgKiB4ICogeSArIDAuMiAqIE1hdGguc3FydChNYXRoLmFicyh4KSk7CiAgcmV0ICs9ICgyMC4wICogTWF0aC5zaW4oNi4wICogeCAqIE1hdGguUEkpICsgMjAuMCAqIE1hdGguc2luKDIuMCAqIHggKiBNYXRoLlBJKSkgKiAyLjAgLyAzLjA7CiAgcmV0ICs9ICgyMC4wICogTWF0aC5zaW4oeSAqIE1hdGguUEkpICsgNDAuMCAqIE1hdGguc2luKHkgLyAzLjAgKiBNYXRoLlBJKSkgKiAyLjAgLyAzLjA7CiAgcmV0ICs9ICgxNjAuMCAqIE1hdGguc2luKHkgLyAxMi4wICogTWF0aC5QSSkgKyAzMjAgKiBNYXRoLnNpbih5ICogTWF0aC5QSSAvIDMwLjApKSAqIDIuMCAvIDMuMDsKICAKICByZXR1cm4gcmV0OwoKfTsKCldHUzg0dHJhbnNmb3JtZXIucHJvdG90eXBlLnRyYW5zZm9ybUxuZyA9IGZ1bmN0aW9uKHgsIHkpIHsKICAKICB2YXIgcmV0ID0gMzAwLjAgKyB4ICsgMi4wICogeSArIDAuMSAqIHggKiB4ICsgMC4xICogeCAqIHkgKyAwLjEgKiBNYXRoLnNxcnQoTWF0aC5hYnMoeCkpOwogIHJldCArPSAoMjAuMCAqIE1hdGguc2luKDYuMCAqIHggKiBNYXRoLlBJKSArIDIwLjAgKiBNYXRoLnNpbigyLjAgKiB4ICogTWF0aC5QSSkpICogMi4wIC8gMy4wOwogIHJldCArPSAoMjAuMCAqIE1hdGguc2luKHggKiBNYXRoLlBJKSArIDQwLjAgKiBNYXRoLnNpbih4IC8gMy4wICogTWF0aC5QSSkpICogMi4wIC8gMy4wOwogIHJldCArPSAoMTUwLjAgKiBNYXRoLnNpbih4IC8gMTIuMCAqIE1hdGguUEkpICsgMzAwLjAgKiBNYXRoLnNpbih4IC8gMzAuMCAqIE1hdGguUEkpKSAqIDIuMCAvIDMuMDsKICAKICByZXR1cm4gcmV0OwoKfTsKLy8vLy8vLy8vLy8gZW5kIFdHUzg0IHRvIEdDSi0wMiB0cmFuc2Zvcm1lciAvLy8vLy8vLy8KCnZhciBXR1M4NHRvR0NKMDIgPSBuZXcgV0dTODR0cmFuc2Zvcm1lcigpOwoKLy8vLy8vLy8vLy8gYmVnaW4gb3ZlcndyaXRlZCBMLkdvb2dsZSAvLy8vLy8vLy8Kd2luZG93LnBsdWdpbi5maXhDaGluYU9mZnNldC5MID0ge307CndpbmRvdy5wbHVnaW4uZml4Q2hpbmFPZmZzZXQuTC5Hb29nbGUgPSB7CiAgCiAgX3VwZGF0ZTogZnVuY3Rpb24oZSkgewoKICAgIGlmKCF0aGlzLl9nb29nbGUpIHJldHVybjsKICAgIHRoaXMuX3Jlc2l6ZSgpOwoKICAgIHZhciBjZW50ZXIgPSBlICYmIGUubGF0bG5nID8gZS5sYXRsbmcgOiB0aGlzLl9tYXAuZ2V0Q2VudGVyKCk7CgogICAgLy8vLy8gbW9kaWZpZWQgaGVyZSAvLy8KICAgIHZhciBfY2VudGVyID0gd2luZG93LnBsdWdpbi5maXhDaGluYU9mZnNldC5nZXRMYXRMbmcoY2VudGVyLCB0aGlzLl90eXBlKTsKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAKICAgIHRoaXMuX2dvb2dsZS5zZXRDZW50ZXIoX2NlbnRlcik7CiAgICB0aGlzLl9nb29nbGUuc2V0Wm9vbSh0aGlzLl9tYXAuZ2V0Wm9vbSgpKTsKCiAgICB0aGlzLl9jaGVja1pvb21MZXZlbHMoKTsKCiAgfSwKCiAgX2hhbmRsZVpvb21BbmltOiBmdW5jdGlvbiAoZSkgewoKICAgIHZhciBjZW50ZXIgPSBlLmNlbnRlcjsKCiAgICAvLy8vLyBtb2RpZmllZCBoZXJlIC8vLwogICAgdmFyIF9jZW50ZXIgPSB3aW5kb3cucGx1Z2luLmZpeENoaW5hT2Zmc2V0LmdldExhdExuZyhjZW50ZXIsIHRoaXMuX3R5cGUpOwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIAogICAgdGhpcy5fZ29vZ2xlLnNldENlbnRlcihfY2VudGVyKTsKICAgIHRoaXMuX2dvb2dsZS5zZXRab29tKGUuem9vbSk7CgogIH0KCn0KLy8vLy8vLy8vLy8gZW5kIG92ZXJ3cml0ZWQgTC5Hb29nbGUgLy8vLy8vLy8vCgp3aW5kb3cucGx1Z2luLmZpeENoaW5hT2Zmc2V0LmdldExhdExuZyA9IGZ1bmN0aW9uKHBvcywgdHlwZSkgewogIAogIC8vIE5vIG9mZnNldHMgaW4gc2F0ZWxsaXRlIGFuZCBoeWJyaWQgbWFwcyAgCiAgaWYodHlwZSAhPT0gJ1NBVEVMTElURScgJiYgdHlwZSAhPT0gJ0hZQlJJRCcpIHsKICAgIHZhciBuZXdQb3MgPSBXR1M4NHRvR0NKMDIudHJhbnNmb3JtKHBvcy5sYXQsIHBvcy5sbmcpOwogICAgcmV0dXJuIG5ldyBnb29nbGUubWFwcy5MYXRMbmcobmV3UG9zLmxhdCwgbmV3UG9zLmxuZyk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHBvcy5sYXQsIHBvcy5sbmcpOwogIH0KCn07Cgp3aW5kb3cucGx1Z2luLmZpeENoaW5hT2Zmc2V0Lm92ZXJ3cml0ZSA9IGZ1bmN0aW9uKGRlc3QsIHNyYykgewogIAogIGZvcih2YXIga2V5IGluIHNyYykgewogICAgaWYoc3JjLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgZGVzdFtrZXldID0gc3JjW2tleV07CiAgICB9CiAgfQoKfQoKdmFyIHNldHVwID0gZnVuY3Rpb24oKSB7CgogIHdpbmRvdy5wbHVnaW4uZml4Q2hpbmFPZmZzZXQub3ZlcndyaXRlKEwuR29vZ2xlLnByb3RvdHlwZSwgd2luZG93LnBsdWdpbi5maXhDaGluYU9mZnNldC5MLkdvb2dsZSk7Cgp9CgovLyBQTFVHSU4gRU5EIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgpzZXR1cC5pbmZvID0gcGx1Z2luX2luZm87IC8vYWRkIHRoZSBzY3JpcHQgaW5mbyBkYXRhIHRvIHRoZSBmdW5jdGlvbiBhcyBhIHByb3BlcnR5CmlmKCF3aW5kb3cuYm9vdFBsdWdpbnMpIHdpbmRvdy5ib290UGx1Z2lucyA9IFtdOwp3aW5kb3cuYm9vdFBsdWdpbnMucHVzaChzZXR1cCk7Ci8vIGlmIElJVEMgaGFzIGFscmVhZHkgYm9vdGVkLCBpbW1lZGlhdGVseSBydW4gdGhlICdzZXR1cCcgZnVuY3Rpb24KaWYod2luZG93LmlpdGNMb2FkZWQgJiYgdHlwZW9mIHNldHVwID09PSAnZnVuY3Rpb24nKSBzZXR1cCgpOwp9IC8vIHdyYXBwZXIgZW5kCi8vIGluamVjdCBjb2RlIGludG8gc2l0ZSBjb250ZXh0CnZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKdmFyIGluZm8gPSB7fTsKaWYgKHR5cGVvZiBHTV9pbmZvICE9PSAndW5kZWZpbmVkJyAmJiBHTV9pbmZvICYmIEdNX2luZm8uc2NyaXB0KSBpbmZvLnNjcmlwdCA9IHsgdmVyc2lvbjogR01faW5mby5zY3JpcHQudmVyc2lvbiwgbmFtZTogR01faW5mby5zY3JpcHQubmFtZSwgZGVzY3JpcHRpb246IEdNX2luZm8uc2NyaXB0LmRlc2NyaXB0aW9uIH07CnNjcmlwdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnKCcrIHdyYXBwZXIgKycpKCcrSlNPTi5zdHJpbmdpZnkoaW5mbykrJyk7JykpOwooZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCgo="},{"name":"IITC plugin: cross links","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null}},"storage":{"data":{},"ts":1480917632224},"enabled":true,"position":7,"file_url":"https://static.iitc.me/build/release/plugins/cross_link.user.js","uuid":"d70db0ef-1225-48bf-b391-6bb376932f2d","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLWNyb3NzLWxpbmtzQG1jYmVuCi8vIEBuYW1lICAgICAgICAgICBJSVRDIHBsdWdpbjogY3Jvc3MgbGlua3MKLy8gQGNhdGVnb3J5ICAgICAgIExheWVyCi8vIEB2ZXJzaW9uICAgICAgICAxLjEuMi4yMDE2MTAwMy40NzQwCi8vIEBuYW1lc3BhY2UgICAgICBodHRwczovL2dpdGh1Yi5jb20vam9uYXRraW5zL2luZ3Jlc3MtaW50ZWwtdG90YWwtY29udmVyc2lvbgovLyBAdXBkYXRlVVJMICAgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3BsdWdpbnMvY3Jvc3NfbGluay5tZXRhLmpzCi8vIEBkb3dubG9hZFVSTCAgICBodHRwczovL3N0YXRpYy5paXRjLm1lL2J1aWxkL3JlbGVhc2UvcGx1Z2lucy9jcm9zc19saW5rLnVzZXIuanMKLy8gQGRlc2NyaXB0aW9uICAgIFtpaXRjLTIwMTYtMTAtMDMtMDA0NzQwXSBFWFBFUklNRU5UQUw6IENoZWNrcyBmb3IgZXhpc3RpbmcgbGlua3MgdGhhdCBjcm9zcyBwbGFubmVkIGxpbmtzLiBSZXF1aXJlcyBkcmF3LXRvb2xzIHBsdWdpbi4KLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBpbmNsdWRlICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAZ3JhbnQgICAgICAgICAgbm9uZQovLyA9PS9Vc2VyU2NyaXB0PT0KCgpmdW5jdGlvbiB3cmFwcGVyKHBsdWdpbl9pbmZvKSB7Ci8vIGVuc3VyZSBwbHVnaW4gZnJhbWV3b3JrIGlzIHRoZXJlLCBldmVuIGlmIGlpdGMgaXMgbm90IHlldCBsb2FkZWQKaWYodHlwZW9mIHdpbmRvdy5wbHVnaW4gIT09ICdmdW5jdGlvbicpIHdpbmRvdy5wbHVnaW4gPSBmdW5jdGlvbigpIHt9OwoKLy9QTFVHSU4gQVVUSE9SUzogd3JpdGluZyBhIHBsdWdpbiBvdXRzaWRlIG9mIHRoZSBJSVRDIGJ1aWxkIGVudmlyb25tZW50PyBpZiBzbywgZGVsZXRlIHRoZXNlIGxpbmVzISEKLy8obGVhdmluZyB0aGVtIGluIHBsYWNlIG1pZ2h0IGJyZWFrIHRoZSAnQWJvdXQgSUlUQycgcGFnZSBvciBicmVhayB1cGRhdGUgY2hlY2tzKQpwbHVnaW5faW5mby5idWlsZE5hbWUgPSAnaWl0Yyc7CnBsdWdpbl9pbmZvLmRhdGVUaW1lVmVyc2lvbiA9ICcyMDE2MTAwMy40NzQwJzsKcGx1Z2luX2luZm8ucGx1Z2luSWQgPSAnY3Jvc3NfbGluayc7Ci8vRU5EIFBMVUdJTiBBVVRIT1JTIE5PVEUKCgoKLy8gUExVR0lOIFNUQVJUIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKd2luZG93LnBsdWdpbi5jcm9zc0xpbmtzID0gZnVuY3Rpb24oKSB7fTsKCgp3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MuZ3JlYXRDaXJjbGVBcmNJbnRlcnNlY3QgPSBmdW5jdGlvbihhMCxhMSxiMCxiMSkgewogIC8vIGJhc2VkIG9uIHRoZSBmb3JtdWxhIGF0IGh0dHA6Ly93aWxsaWFtcy5iZXN0LnZ3aC5uZXQvYXZmb3JtLmh0bSNJbnQKCiAgLy8gbWV0aG9kOgogIC8vIGNoZWNrIHRvIGVuc3VyZSBubyBsaW5lIHNlZ21lbnQgaXMgemVybyBsZW5ndGggLSBpZiBzbywgY2Fubm90IGNyb3NzCiAgLy8gY2hlY2sgdG8gc2VlIGlmIGVpdGhlciBvZiB0aGUgbGluZXMgc3RhcnQvZW5kIGF0IHRoZSBzYW1lIHBvaW50LiBpZiBzbywgdGhlbiB0aGV5IGNhbm5vdCBjcm9zcwogIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUgbGluZSBzZWdtZW50cyBvdmVybGFwIGluIGxvbmdpdHVkZS4gaWYgbm90LCBubyBjcm9zc2luZwogIC8vIGlmIG92ZXJsYXAsIGNsaXAgZWFjaCBsaW5lIHRvIHRoZSBvdmVybGFwcGluZyBsb25naXR1ZGVzLCB0aGVuIHNlZSBpZiBsYXRpdHVkZXMgY3Jvc3MgCgogIC8vIGFudGktbWVyaWRpYW4gaGFuZGxpbmcuIHRoaXMgY29kZSB3aWxsIG5vdCBzZW5zaWJseSBoYW5kbGUgYSBjYXNlIHdoZXJlIG9uZSBwb2ludCBpcwogIC8vIGNsb3NlIHRvIC0xODAgZGVncmVlcyBhbmQgdGhlIG90aGVyICsxODAgZGVncmVlcy4gdW53cmFwIGNvb3JkaW5hdGVzIGluIHRoaXMgY2FzZSwgc28gb25lIHBvaW50CiAgLy8gaXMgYmV5b25kICstMTgwIGRlZ3JlZXMuIHRoaXMgaXMgYWxyZWFkeSB0cnVlIGluIElJVEMKICAvLyBGSVhNRT8gaWYgdGhlIHR3byBsaW5lcyBoYXZlIGJlZW4gJ3Vud3JhcHBlZCcgZGlmZmVyZW50bHkgLSBvbmUgcG9zaXRpdmUsIG9uZSBuZWdhdGl2ZSAtIGl0IHdpbGwgZmFpbAoKICAvLyB6ZXJvIGxlbmd0aCBsaW5lIHRlc3RzCiAgaWYgKGEwLmVxdWFscyhhMSkpIHJldHVybiBmYWxzZTsKICBpZiAoYjAuZXF1YWxzKGIxKSkgcmV0dXJuIGZhbHNlOwoKICAvLyBsaW5lcyBoYXZlIGEgY29tbW9uIHBvaW50CiAgaWYgKGEwLmVxdWFscyhiMCkgfHwgYTAuZXF1YWxzKGIxKSkgcmV0dXJuIGZhbHNlOwogIGlmIChhMS5lcXVhbHMoYjApIHx8IGExLmVxdWFscyhiMSkpIHJldHVybiBmYWxzZTsKCgogIC8vIGNoZWNrIGZvciAnaG9yaXpvbnRhbCcgb3ZlcmxhcCBpbiBsbmdpdHVkZQogIGlmIChNYXRoLm1pbihhMC5sbmcsYTEubG5nKSA+IE1hdGgubWF4KGIwLmxuZyxiMS5sbmcpKSByZXR1cm4gZmFsc2U7CiAgaWYgKE1hdGgubWF4KGEwLmxuZyxhMS5sbmcpIDwgTWF0aC5taW4oYjAubG5nLGIxLmxuZykpIHJldHVybiBmYWxzZTsKCgogIC8vIG9rLCBvdXIgdHdvIGxpbmVzIGhhdmUgc29tZSBob3Jpem9udGFsIG92ZXJsYXAgaW4gbG9uZ2l0dWRlCiAgLy8gMS4gY2FsY3VsYXRlIHRoZSBvdmVybGFwcGluZyBtaW4vbWF4IGxvbmdpdHVkZQogIC8vIDIuIGNhbGN1bGF0ZSBlYWNoIGxpbmUgbGF0aXR1ZGUgYXQgZWFjaCBwb2ludAogIC8vIDMuIGlmIGxhdGl0dWRlcyBjaGFuZ2UgcGxhY2UgYmV0d2VlbiBvdmVybGFwcGluZyByYW5nZSwgdGhlIGxpbmVzIGNyb3NzCgoKICAvLyBjbGFzcyB0byBob2xkIHRoZSBwcmUtY2FsY3VsYXRlZCBtYXRocyBmb3IgYSBnZW9kZXNpYyBsaW5lCiAgLy8gVE9ETzogbW92ZSB0aGlzIG91dHNpZGUgdGhpcyBmdW5jdGlvbiwgc28gaXQgY2FuIGJlIHByZS1jYWxjdWxhdGVkIG9uY2UgZm9yIGVhY2ggbGluZSB3ZSB0ZXN0CiAgdmFyIEdlb2Rlc2ljTGluZSA9IGZ1bmN0aW9uKHN0YXJ0LGVuZCkgewogICAgdmFyIGQyciA9IE1hdGguUEkvMTgwLjA7CiAgICB2YXIgcjJkID0gMTgwLjAvTWF0aC5QSTsKCiAgICAvLyBtYXRocyBiYXNlZCBvbiBodHRwOi8vd2lsbGlhbXMuYmVzdC52d2gubmV0L2F2Zm9ybS5odG0jSW50CgogICAgaWYgKHN0YXJ0LmxuZyA9PSBlbmQubG5nKSB7CiAgICAgIHRocm93ICdFcnJvcjogY2Fubm90IGNhbGN1bGF0ZSBsYXRpdHVkZSBmb3IgbWVyaWRpYW5zJzsKICAgIH0KCiAgICAvLyBvbmx5IHRoZSB2YXJpYWJsZXMgbmVlZGVkIHRvIGNhbGN1bGF0ZSBhIGxhdGl0dWRlIGZvciBhIGdpdmVuIGxvbmdpdHVkZSBhcmUgc3RvcmVkIGluICd0aGlzJwogICAgdGhpcy5sYXQxID0gc3RhcnQubGF0ICogZDJyOwogICAgdGhpcy5sYXQyID0gZW5kLmxhdCAqIGQycjsKICAgIHRoaXMubG5nMSA9IHN0YXJ0LmxuZyAqIGQycjsKICAgIHRoaXMubG5nMiA9IGVuZC5sbmcgKiBkMnI7CgogICAgdmFyIGRMbmcgPSB0aGlzLmxuZzEtdGhpcy5sbmcyOwoKICAgIHZhciBzaW5MYXQxID0gTWF0aC5zaW4odGhpcy5sYXQxKTsKICAgIHZhciBzaW5MYXQyID0gTWF0aC5zaW4odGhpcy5sYXQyKTsKICAgIHZhciBjb3NMYXQxID0gTWF0aC5jb3ModGhpcy5sYXQxKTsKICAgIHZhciBjb3NMYXQyID0gTWF0aC5jb3ModGhpcy5sYXQyKTsKCiAgICB0aGlzLnNpbkxhdDFDb3NMYXQyID0gc2luTGF0MSpjb3NMYXQyOwogICAgdGhpcy5zaW5MYXQyQ29zTGF0MSA9IHNpbkxhdDIqY29zTGF0MTsKCiAgICB0aGlzLmNvc0xhdDFDb3NMYXQyU2luRExuZyA9IGNvc0xhdDEqY29zTGF0MipNYXRoLnNpbihkTG5nKTsKICB9CgogIEdlb2Rlc2ljTGluZS5wcm90b3R5cGUuaXNNZXJpZGlhbiA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMubG5nMSA9PSB0aGlzLmxuZzI7CiAgfQoKICBHZW9kZXNpY0xpbmUucHJvdG90eXBlLmxhdEF0TG5nID0gZnVuY3Rpb24obG5nKSB7CiAgICBsbmcgPSBsbmcgKiBNYXRoLlBJIC8gMTgwOyAvL3RvIHJhZGlhbnMKCiAgICB2YXIgbGF0OwogICAgLy8gaWYgd2UncmUgdGVzdGluZyB0aGUgc3RhcnQvZW5kIHBvaW50LCByZXR1cm4gdGhhdCBkaXJlY3RseSByYXRoZXIgdGhhbiBjYWxjdWxhdGluZwogICAgLy8gMS4gdGhpcyBtYXkgYmUgZnJhY3Rpb25hbGx5IGZhc3Rlciwgbm8gY29tcGxleCBtYXRocwogICAgLy8gMi4gdGhlcmUncyBvZGQgcm91bmRpbmcgaXNzdWVzIHRoYXQgb2NjdXIgb24gc29tZSBicm93c2VycyAobm90aWNlZCBvbiBJSVRDIE1PYmlsZSkgZm9yIHZlcnkgc2hvcnQgbGlua3MgLSB0aGlzIG1heSBoZWxwCiAgICBpZiAobG5nID09IHRoaXMubG5nMSkgewogICAgICBsYXQgPSB0aGlzLmxhdDE7CiAgICB9IGVsc2UgaWYgKGxuZyA9PSB0aGlzLmxuZzIpIHsKICAgICAgbGF0ID0gdGhpcy5sYXQyOwogICAgfSBlbHNlIHsKICAgICAgbGF0ID0gTWF0aC5hdGFuICggKHRoaXMuc2luTGF0MUNvc0xhdDIqTWF0aC5zaW4obG5nLXRoaXMubG5nMikgLSB0aGlzLnNpbkxhdDJDb3NMYXQxKk1hdGguc2luKGxuZy10aGlzLmxuZzEpKQogICAgICAgICAgICAgICAgICAgICAgIC8gdGhpcy5jb3NMYXQxQ29zTGF0MlNpbkRMbmcpOwogICAgfQogICAgcmV0dXJuIGxhdCAqIDE4MCAvIE1hdGguUEk7IC8vIHJldHVybiB2YWx1ZSBpbiBkZWdyZWVzCiAgfQoKCgogIC8vIGNhbGN1bGF0ZSB0aGUgbG9uZ2l0dWRlIG9mIHRoZSBvdmVybGFwcGluZyByZWdpb24KICB2YXIgbGVmdExuZyA9IE1hdGgubWF4KCBNYXRoLm1pbihhMC5sbmcsYTEubG5nKSwgTWF0aC5taW4oYjAubG5nLGIxLmxuZykgKTsKICB2YXIgcmlnaHRMbmcgPSBNYXRoLm1pbiggTWF0aC5tYXgoYTAubG5nLGExLmxuZyksIE1hdGgubWF4KGIwLmxuZyxiMS5sbmcpICk7CgogIC8vIGNhbGN1bGF0ZSB0aGUgbGF0aXR1ZGVzIGZvciBlYWNoIGxpbmUgYXQgbGVmdCArIHJpZ2h0IGxvbmdpdHVkZXMKICAvLyBOT1RFOiBuZWVkIGEgc3BlY2lhbCBjYXNlIGZvciBtZXJpZGlhbnMgLSBhcyBHZW9kZXNpY0xpbmUubGF0QXRMbmcgbWV0aG9kIGlzIGludmFsaWQgaW4gdGhhdCBjYXNlCiAgdmFyIGFMZWZ0TGF0LCBhUmlnaHRMYXQ7CiAgaWYgKGEwLmxuZyA9PSBhMS5sbmcpIHsKICAgIC8vICdsZWZ0JyBhbmQgJ3JpZ2h0JyBub3cgYmVjb21lICd0b3AnIGFuZCAnYm90dG9tJyAoaW4gc29tZSBvcmRlcikgLSB3aGljaCBpcyBmaW5lIGZvciB0aGUgYmVsb3cgaW50ZXJzZWN0aW9uIGNvZGUKICAgIGFMZWZ0TGF0ID0gYTAubGF0OwogICAgYVJpZ2h0TGF0ID0gYTEubGF0OwogIH0gZWxzZSB7CiAgICB2YXIgYUdlbyA9IG5ldyBHZW9kZXNpY0xpbmUoYTAsYTEpOwogICAgYUxlZnRMYXQgPSBhR2VvLmxhdEF0TG5nKGxlZnRMbmcpOwogICAgYVJpZ2h0TGF0ID0gYUdlby5sYXRBdExuZyhyaWdodExuZyk7CiAgfQoKICB2YXIgYkxlZnRMYXQsIGJSaWdodExhdDsKICBpZiAoYjAubG5nID09IGIxLmxuZykgewogICAgLy8gJ2xlZnQnIGFuZCAncmlnaHQnIG5vdyBiZWNvbWUgJ3RvcCcgYW5kICdib3R0b20nIChpbiBzb21lIG9yZGVyKSAtIHdoaWNoIGlzIGZpbmUgZm9yIHRoZSBiZWxvdyBpbnRlcnNlY3Rpb24gY29kZQogICAgYkxlZnRMYXQgPSBiMC5sYXQ7CiAgICBiUmlnaHRMYXQgPSBiMS5sYXQ7CiAgfSBlbHNlIHsKICAgIHZhciBiR2VvID0gbmV3IEdlb2Rlc2ljTGluZShiMCxiMSk7CiAgICBiTGVmdExhdCA9IGJHZW8ubGF0QXRMbmcobGVmdExuZyk7CiAgICBiUmlnaHRMYXQgPSBiR2VvLmxhdEF0TG5nKHJpZ2h0TG5nKTsKICB9CgogIC8vIGlmIGJvdGggYSBhcmUgbGVzcyBvciBncmVhdGVyIHRoYW4gYm90aCBiLCB0aGVuIGxpbmVzIGRvIG5vdCBjcm9zcwoKICBpZiAoYUxlZnRMYXQgPCBiTGVmdExhdCAmJiBhUmlnaHRMYXQgPCBiUmlnaHRMYXQpIHJldHVybiBmYWxzZTsKICBpZiAoYUxlZnRMYXQgPiBiTGVmdExhdCAmJiBhUmlnaHRMYXQgPiBiUmlnaHRMYXQpIHJldHVybiBmYWxzZTsKCiAgLy8gbGF0aXR1ZGVzIGNyb3NzIGJldHdlZW4gbGVmdCBhbmQgcmlnaHQgLSBzbyBnZW9kZXNpYyBsaW5lcyBjcm9zcwogIHJldHVybiB0cnVlOwp9CgoKCndpbmRvdy5wbHVnaW4uY3Jvc3NMaW5rcy50ZXN0UG9seUxpbmUgPSBmdW5jdGlvbiAocG9seWxpbmUsIGxpbmssY2xvc2VkKSB7CgogICAgdmFyIGEgPSBsaW5rLmdldExhdExuZ3MoKTsKICAgIHZhciBiID0gcG9seWxpbmUuZ2V0TGF0TG5ncygpOwoKICAgIGZvciAodmFyIGk9MDtpPGIubGVuZ3RoLTE7KytpKSB7CiAgICAgICAgaWYgKHdpbmRvdy5wbHVnaW4uY3Jvc3NMaW5rcy5ncmVhdENpcmNsZUFyY0ludGVyc2VjdChhWzBdLGFbMV0sYltpXSxiW2krMV0pKSByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBpZiAoY2xvc2VkKSB7CiAgICAgICAgaWYgKHdpbmRvdy5wbHVnaW4uY3Jvc3NMaW5rcy5ncmVhdENpcmNsZUFyY0ludGVyc2VjdChhWzBdLGFbMV0sYltiLmxlbmd0aC0xXSxiWzBdKSkgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwp9Cgp3aW5kb3cucGx1Z2luLmNyb3NzTGlua3Mub25MaW5rQWRkZWQgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgaWYgKHdpbmRvdy5wbHVnaW4uY3Jvc3NMaW5rcy5kaXNhYmxlZCkgcmV0dXJuOwoKICAgIHBsdWdpbi5jcm9zc0xpbmtzLnRlc3RMaW5rKGRhdGEubGluayk7Cn0KCndpbmRvdy5wbHVnaW4uY3Jvc3NMaW5rcy5jaGVja0FsbExpbmtzID0gZnVuY3Rpb24oKSB7CiAgICBpZiAod2luZG93LnBsdWdpbi5jcm9zc0xpbmtzLmRpc2FibGVkKSByZXR1cm47CgogICAgY29uc29sZS5kZWJ1ZygiQ3Jvc3MtTGlua3M6IGNoZWNraW5nIGFsbCBsaW5rcyIpOwogICAgcGx1Z2luLmNyb3NzTGlua3MubGlua0xheWVyLmNsZWFyTGF5ZXJzKCk7CiAgICBwbHVnaW4uY3Jvc3NMaW5rcy5saW5rTGF5ZXJHdWlkcyA9IHt9OwoKICAgICQuZWFjaCh3aW5kb3cubGlua3MsIGZ1bmN0aW9uKGd1aWQsIGxpbmspIHsKICAgICAgICBwbHVnaW4uY3Jvc3NMaW5rcy50ZXN0TGluayhsaW5rKTsKICAgIH0pOwp9Cgp3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MudGVzdExpbmsgPSBmdW5jdGlvbiAobGluaykgewogICAgaWYgKHBsdWdpbi5jcm9zc0xpbmtzLmxpbmtMYXllckd1aWRzW2xpbmsub3B0aW9ucy5ndWlkXSkgcmV0dXJuOwoKICAgIGZvciAodmFyIGkgaW4gcGx1Z2luLmRyYXdUb29scy5kcmF3bkl0ZW1zLl9sYXllcnMpIHsgLy8gbGVhZmxldCBkb24ndCBzdXBwb3J0IGJyZWFraW5nIG91dCBvZiB0aGUgbG9vcAogICAgICAgdmFyIGxheWVyID0gcGx1Z2luLmRyYXdUb29scy5kcmF3bkl0ZW1zLl9sYXllcnNbaV07CiAgICAgICBpZiAobGF5ZXIgaW5zdGFuY2VvZiBMLkdlb2Rlc2ljUG9seWdvbikgewogICAgICAgICAgIGlmIChwbHVnaW4uY3Jvc3NMaW5rcy50ZXN0UG9seUxpbmUobGF5ZXIsIGxpbmssdHJ1ZSkpIHsKICAgICAgICAgICAgICAgcGx1Z2luLmNyb3NzTGlua3Muc2hvd0xpbmsobGluayk7CiAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGxheWVyIGluc3RhbmNlb2YgTC5HZW9kZXNpY1BvbHlsaW5lKSB7CiAgICAgICAgICAgIGlmIChwbHVnaW4uY3Jvc3NMaW5rcy50ZXN0UG9seUxpbmUobGF5ZXIsIGxpbmspKSB7CiAgICAgICAgICAgICAgICBwbHVnaW4uY3Jvc3NMaW5rcy5zaG93TGluayhsaW5rKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKfQoKCndpbmRvdy5wbHVnaW4uY3Jvc3NMaW5rcy5zaG93TGluayA9IGZ1bmN0aW9uKGxpbmspIHsKCiAgICB2YXIgcG9seSA9IEwuZ2VvZGVzaWNQb2x5bGluZShsaW5rLmdldExhdExuZ3MoKSwgewogICAgICAgY29sb3I6ICcjZDIyJywKICAgICAgIG9wYWNpdHk6IDAuNywKICAgICAgIHdlaWdodDogNSwKICAgICAgIGNsaWNrYWJsZTogZmFsc2UsCiAgICAgICBkYXNoQXJyYXk6IFs4LDhdLAoKICAgICAgIGd1aWQ6IGxpbmsub3B0aW9ucy5ndWlkCiAgICB9KTsKCiAgICBwb2x5LmFkZFRvKHBsdWdpbi5jcm9zc0xpbmtzLmxpbmtMYXllcik7CiAgICBwbHVnaW4uY3Jvc3NMaW5rcy5saW5rTGF5ZXJHdWlkc1tsaW5rLm9wdGlvbnMuZ3VpZF09cG9seTsKfQoKd2luZG93LnBsdWdpbi5jcm9zc0xpbmtzLm9uTWFwRGF0YVJlZnJlc2hFbmQgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAod2luZG93LnBsdWdpbi5jcm9zc0xpbmtzLmRpc2FibGVkKSByZXR1cm47CgogICAgd2luZG93LnBsdWdpbi5jcm9zc0xpbmtzLmxpbmtMYXllci5icmluZ1RvRnJvbnQoKTsKCiAgICB3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MudGVzdEZvckRlbGV0ZWRMaW5rcygpOwp9Cgp3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MudGVzdEFsbExpbmtzQWdhaW5zdExheWVyID0gZnVuY3Rpb24gKGxheWVyKSB7CiAgICBpZiAod2luZG93LnBsdWdpbi5jcm9zc0xpbmtzLmRpc2FibGVkKSByZXR1cm47CgogICAgJC5lYWNoKHdpbmRvdy5saW5rcywgZnVuY3Rpb24oZ3VpZCwgbGluaykgewogICAgICAgIGlmICghcGx1Z2luLmNyb3NzTGlua3MubGlua0xheWVyR3VpZHNbbGluay5vcHRpb25zLmd1aWRdKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGxheWVyIGluc3RhbmNlb2YgTC5HZW9kZXNpY1BvbHlnb24pIHsKICAgICAgICAgICAgICAgIGlmIChwbHVnaW4uY3Jvc3NMaW5rcy50ZXN0UG9seUxpbmUobGF5ZXIsIGxpbmssdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBwbHVnaW4uY3Jvc3NMaW5rcy5zaG93TGluayhsaW5rKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChsYXllciBpbnN0YW5jZW9mIEwuR2VvZGVzaWNQb2x5bGluZSkgewogICAgICAgICAgICAgICAgaWYgKHBsdWdpbi5jcm9zc0xpbmtzLnRlc3RQb2x5TGluZShsYXllciwgbGluaykpIHsKICAgICAgICAgICAgICAgICAgICBwbHVnaW4uY3Jvc3NMaW5rcy5zaG93TGluayhsaW5rKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwp9Cgp3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MudGVzdEZvckRlbGV0ZWRMaW5rcyA9IGZ1bmN0aW9uICgpIHsKICAgIHdpbmRvdy5wbHVnaW4uY3Jvc3NMaW5rcy5saW5rTGF5ZXIuZWFjaExheWVyKCBmdW5jdGlvbihsYXllcikgewogICAgICAgIHZhciBndWlkID0gbGF5ZXIub3B0aW9ucy5ndWlkOwogICAgICAgIGlmICghd2luZG93LmxpbmtzW2d1aWRdKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJsaW5rIHJlbW92ZWQiKTsKICAgICAgICAgICAgcGx1Z2luLmNyb3NzTGlua3MubGlua0xheWVyLnJlbW92ZUxheWVyKGxheWVyKTsKICAgICAgICAgICAgZGVsZXRlIHBsdWdpbi5jcm9zc0xpbmtzLmxpbmtMYXllckd1aWRzW2d1aWRdOwogICAgICAgIH0KICAgIH0pOwp9Cgp3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MuY3JlYXRlTGF5ZXIgPSBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5wbHVnaW4uY3Jvc3NMaW5rcy5saW5rTGF5ZXIgPSBuZXcgTC5GZWF0dXJlR3JvdXAoKTsKICAgIHdpbmRvdy5wbHVnaW4uY3Jvc3NMaW5rcy5saW5rTGF5ZXJHdWlkcz17fTsKICAgIHdpbmRvdy5hZGRMYXllckdyb3VwKCdDcm9zcyBMaW5rcycsIHdpbmRvdy5wbHVnaW4uY3Jvc3NMaW5rcy5saW5rTGF5ZXIsIHRydWUpOwoKICAgIG1hcC5vbignbGF5ZXJhZGQnLCBmdW5jdGlvbihvYmopIHsKICAgICAgaWYob2JqLmxheWVyID09PSB3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MubGlua0xheWVyKSB7CiAgICAgICAgZGVsZXRlIHdpbmRvdy5wbHVnaW4uY3Jvc3NMaW5rcy5kaXNhYmxlZDsKICAgICAgICB3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MuY2hlY2tBbGxMaW5rcygpOwogICAgICB9CiAgICB9KTsKICAgIG1hcC5vbignbGF5ZXJyZW1vdmUnLCBmdW5jdGlvbihvYmopIHsKICAgICAgaWYob2JqLmxheWVyID09PSB3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MubGlua0xheWVyKSB7CiAgICAgICAgd2luZG93LnBsdWdpbi5jcm9zc0xpbmtzLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICB3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MubGlua0xheWVyLmNsZWFyTGF5ZXJzKCk7CiAgICAgICAgcGx1Z2luLmNyb3NzTGlua3MubGlua0xheWVyR3VpZHMgPSB7fTsKICAgICAgfQogICAgfSk7CgogICAgLy8gZW5zdXJlICdkaXNhYmxlZCcgZmxhZyBpcyBpbml0aWFsaXNlZAogICAgaWYgKCFtYXAuaGFzTGF5ZXIod2luZG93LnBsdWdpbi5jcm9zc0xpbmtzLmxpbmtMYXllcikpIHsKICAgICAgICB3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MuZGlzYWJsZWQgPSB0cnVlOwogICAgfQp9Cgp2YXIgc2V0dXAgPSBmdW5jdGlvbigpIHsKICAgIGlmICh3aW5kb3cucGx1Z2luLmRyYXdUb29scyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICBhbGVydCgiJ0Nyb3NzLUxpbmtzJyByZXF1aXJlcyAnZHJhdy10b29scyciKTsKICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyB0aGlzIHBsdWdpbiBhbHNvIG5lZWRzIHRvIGNyZWF0ZSB0aGUgZHJhdy10b29scyBob29rLCBpbiBjYXNlIGl0IGlzIGluaXRpYWxpc2VkIGJlZm9yZSBkcmF3LXRvb2xzCiAgICB3aW5kb3cucGx1Z2luQ3JlYXRlSG9vaygncGx1Z2luRHJhd1Rvb2xzJyk7CgogICAgd2luZG93LnBsdWdpbi5jcm9zc0xpbmtzLmNyZWF0ZUxheWVyKCk7CgogICAgLy8gZXZlbnRzCiAgICB3aW5kb3cuYWRkSG9vaygncGx1Z2luRHJhd1Rvb2xzJyxmdW5jdGlvbihlKSB7CiAgICAgICAgaWYgKGUuZXZlbnQgPT0gJ2xheWVyQ3JlYXRlZCcpIHsKICAgICAgICAgICAgLy8gd2UgY2FuIGp1c3QgdGVzdCB0aGUgbmV3IGxheWVyIGluIHRoaXMgY2FzZQogICAgICAgICAgICB3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MudGVzdEFsbExpbmtzQWdhaW5zdExheWVyKGUubGF5ZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGFsbCBvdGhlciBldmVudCB0eXBlcyAtIGFzc3VtZSBhbnl0aGluZyBjb3VsZCBoYXZlIGJlZW4gbW9kaWZpZWQgYW5kIHJlLWNoZWNrIGFsbCBsaW5rcwogICAgICAgICAgICB3aW5kb3cucGx1Z2luLmNyb3NzTGlua3MuY2hlY2tBbGxMaW5rcygpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHdpbmRvdy5hZGRIb29rKCdsaW5rQWRkZWQnLCB3aW5kb3cucGx1Z2luLmNyb3NzTGlua3Mub25MaW5rQWRkZWQpOwogICAgd2luZG93LmFkZEhvb2soJ21hcERhdGFSZWZyZXNoRW5kJywgd2luZG93LnBsdWdpbi5jcm9zc0xpbmtzLm9uTWFwRGF0YVJlZnJlc2hFbmQpOwoKICAgIAp9CgovLyBQTFVHSU4gRU5EIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgpzZXR1cC5pbmZvID0gcGx1Z2luX2luZm87IC8vYWRkIHRoZSBzY3JpcHQgaW5mbyBkYXRhIHRvIHRoZSBmdW5jdGlvbiBhcyBhIHByb3BlcnR5CmlmKCF3aW5kb3cuYm9vdFBsdWdpbnMpIHdpbmRvdy5ib290UGx1Z2lucyA9IFtdOwp3aW5kb3cuYm9vdFBsdWdpbnMucHVzaChzZXR1cCk7Ci8vIGlmIElJVEMgaGFzIGFscmVhZHkgYm9vdGVkLCBpbW1lZGlhdGVseSBydW4gdGhlICdzZXR1cCcgZnVuY3Rpb24KaWYod2luZG93LmlpdGNMb2FkZWQgJiYgdHlwZW9mIHNldHVwID09PSAnZnVuY3Rpb24nKSBzZXR1cCgpOwp9IC8vIHdyYXBwZXIgZW5kCi8vIGluamVjdCBjb2RlIGludG8gc2l0ZSBjb250ZXh0CnZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKdmFyIGluZm8gPSB7fTsKaWYgKHR5cGVvZiBHTV9pbmZvICE9PSAndW5kZWZpbmVkJyAmJiBHTV9pbmZvICYmIEdNX2luZm8uc2NyaXB0KSBpbmZvLnNjcmlwdCA9IHsgdmVyc2lvbjogR01faW5mby5zY3JpcHQudmVyc2lvbiwgbmFtZTogR01faW5mby5zY3JpcHQubmFtZSwgZGVzY3JpcHRpb246IEdNX2luZm8uc2NyaXB0LmRlc2NyaXB0aW9uIH07CnNjcmlwdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnKCcrIHdyYXBwZXIgKycpKCcrSlNPTi5zdHJpbmdpZnkoaW5mbykrJyk7JykpOwooZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCgo="},{"name":"IITC plugin: show list of portals","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1480919321359,"data":{}},"enabled":true,"position":8,"file_url":"https://static.iitc.me/build/release/plugins/portals-list.user.js","uuid":"f432cdc0-eb4d-45fd-87eb-a58bdea307c5","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLXBvcnRhbHMtbGlzdEB0ZW85NgovLyBAbmFtZSAgICAgICAgICAgSUlUQyBwbHVnaW46IHNob3cgbGlzdCBvZiBwb3J0YWxzCi8vIEBjYXRlZ29yeSAgICAgICBJbmZvCi8vIEB2ZXJzaW9uICAgICAgICAwLjIuMS4yMDE2MTAwMy40NzQwCi8vIEBuYW1lc3BhY2UgICAgICBodHRwczovL2dpdGh1Yi5jb20vam9uYXRraW5zL2luZ3Jlc3MtaW50ZWwtdG90YWwtY29udmVyc2lvbgovLyBAdXBkYXRlVVJMICAgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3BsdWdpbnMvcG9ydGFscy1saXN0Lm1ldGEuanMKLy8gQGRvd25sb2FkVVJMICAgIGh0dHBzOi8vc3RhdGljLmlpdGMubWUvYnVpbGQvcmVsZWFzZS9wbHVnaW5zL3BvcnRhbHMtbGlzdC51c2VyLmpzCi8vIEBkZXNjcmlwdGlvbiAgICBbaWl0Yy0yMDE2LTEwLTAzLTAwNDc0MF0gRGlzcGxheSBhIHNvcnRhYmxlIGxpc3Qgb2YgYWxsIHZpc2libGUgcG9ydGFscyB3aXRoIGZ1bGwgZGV0YWlscyBhYm91dCB0aGUgdGVhbSwgcmVzb25hdG9ycywgbGlua3MsIGV0Yy4KLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBpbmNsdWRlICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAZ3JhbnQgICAgICAgICAgbm9uZQovLyA9PS9Vc2VyU2NyaXB0PT0KCgpmdW5jdGlvbiB3cmFwcGVyKHBsdWdpbl9pbmZvKSB7Ci8vIGVuc3VyZSBwbHVnaW4gZnJhbWV3b3JrIGlzIHRoZXJlLCBldmVuIGlmIGlpdGMgaXMgbm90IHlldCBsb2FkZWQKaWYodHlwZW9mIHdpbmRvdy5wbHVnaW4gIT09ICdmdW5jdGlvbicpIHdpbmRvdy5wbHVnaW4gPSBmdW5jdGlvbigpIHt9OwoKLy9QTFVHSU4gQVVUSE9SUzogd3JpdGluZyBhIHBsdWdpbiBvdXRzaWRlIG9mIHRoZSBJSVRDIGJ1aWxkIGVudmlyb25tZW50PyBpZiBzbywgZGVsZXRlIHRoZXNlIGxpbmVzISEKLy8obGVhdmluZyB0aGVtIGluIHBsYWNlIG1pZ2h0IGJyZWFrIHRoZSAnQWJvdXQgSUlUQycgcGFnZSBvciBicmVhayB1cGRhdGUgY2hlY2tzKQpwbHVnaW5faW5mby5idWlsZE5hbWUgPSAnaWl0Yyc7CnBsdWdpbl9pbmZvLmRhdGVUaW1lVmVyc2lvbiA9ICcyMDE2MTAwMy40NzQwJzsKcGx1Z2luX2luZm8ucGx1Z2luSWQgPSAncG9ydGFscy1saXN0JzsKLy9FTkQgUExVR0lOIEFVVEhPUlMgTk9URQoKCgovLyBQTFVHSU4gU1RBUlQgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCi8vIHVzZSBvd24gbmFtZXNwYWNlIGZvciBwbHVnaW4Kd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdCA9IGZ1bmN0aW9uKCkge307Cgp3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0Lmxpc3RQb3J0YWxzID0gW107CndpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3Quc29ydEJ5ID0gMTsgLy8gc2Vjb25kIGNvbHVtbjogbGV2ZWwKd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5zb3J0T3JkZXIgPSAtMTsKd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5lbmxQID0gMDsKd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5yZXNQID0gMDsKd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5uZXVQID0gMDsKd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5maWx0ZXIgPSAwOwoKLyoKICogcGx1Z2lucyBtYXkgYWRkIGZpZWxkcyBieSBhcHBlbmRpbmcgdGhlaXIgc3BlY2lmaWF0aW9uIHRvIHRoZSBmb2xsb3dpbmcgbGlzdC4gVGhlIGZvbGxvd2luZyBtZW1iZXJzIGFyZSBzdXBwb3J0ZWQ6CiAqIHRpdGxlOiBTdHJpbmcKICogICAgIE5hbWUgb2YgdGhlIGNvbHVtbi4gUmVxdWlyZWQuCiAqIHZhbHVlOiBmdW5jdGlvbihwb3J0YWwpCiAqICAgICBUaGUgcmF3IHZhbHVlIG9mIHRoaXMgZmllbGQuIENhbiBieSBhbnl0aGluZy4gUmVxdWlyZWQsIGJ1dCBjYW4gYmUgZHVtbXkgaW1wbGVtZW50YXRpb24gaWYgc29ydFZhbHVlIGFuZCBmb3JtYXQKICogICAgIGFyZSBpbXBsZW1lbnRlZC4KICogc29ydFZhbHVlOiBmdW5jdGlvbih2YWx1ZSwgcG9ydGFsKQogKiAgICAgVGhlIHZhbHVlIHRvIHNvcnQgYnkuIE9wdGlvbmFsLCB1c2VzIHZhbHVlIGlmIG9taXR0ZWQuIFRoZSByYXcgdmFsdWUgaXMgcGFzc2VkIGFzIGZpcnN0IGFyZ3VtZW50LgogKiBzb3J0OiBmdW5jdGlvbih2YWx1ZUEsIHZhbHVlQiwgcG9ydGFsQSwgcG9ydGFsQikKICogICAgIEN1c3RvbSBzb3J0aW5nIGZ1bmN0aW9uLiBTZWUgQXJyYXkuc29ydCgpIGZvciBkZXRhaWxzIG9uIHJldHVybiB2YWx1ZS4gQm90aCB0aGUgcmF3IHZhbHVlcyBhbmQgdGhlIHBvcnRhbCBvYmplY3RzCiAqICAgICBhcmUgcGFzc2VkIGFzIGFyZ3VtZW50cy4gT3B0aW9uYWwuIFNldCB0byBudWxsIHRvIGRpc2FibGUgc29ydGluZwogKiBmb3JtYXQ6IGZ1bmN0aW9uKGNlbGwsIHBvcnRhbCwgdmFsdWUpCiAqICAgICBVc2VkIHRvIGZpbGwgYW5kIGZvcm1hdCB0aGUgY2VsbCwgd2hpY2ggaXMgZ2l2ZW4gYXMgYSBET00gbm9kZS4gSWYgb21pdHRlZCwgdGhlIHJhdyB2YWx1ZSBpcyBwdXQgaW4gdGhlIGNlbGwuCiAqIGRlZmF1bHRPcmRlcjogLTF8MQogKiAgICAgV2hpY2ggb3JkZXIgc2hvdWxkIGJ5IGRlZmF1bHQgYmUgdXNlZCBmb3IgdGhpcyBjb2x1bW4uIC0xIG1lYW5zIGRlc2NlbmRpbmcuIERlZmF1bHQ6IDEKICovCgoKd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5maWVsZHMgPSBbCiAgewogICAgdGl0bGU6ICJQb3J0YWwgTmFtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24ocG9ydGFsKSB7IHJldHVybiBwb3J0YWwub3B0aW9ucy5kYXRhLnRpdGxlOyB9LAogICAgc29ydFZhbHVlOiBmdW5jdGlvbih2YWx1ZSwgcG9ydGFsKSB7IHJldHVybiB2YWx1ZS50b0xvd2VyQ2FzZSgpOyB9LAogICAgZm9ybWF0OiBmdW5jdGlvbihjZWxsLCBwb3J0YWwsIHZhbHVlKSB7CiAgICAgICQoY2VsbCkKICAgICAgICAuYXBwZW5kKHBsdWdpbi5wb3J0YWxzbGlzdC5nZXRQb3J0YWxMaW5rKHBvcnRhbCkpCiAgICAgICAgLmFkZENsYXNzKCJwb3J0YWxUaXRsZSIpOwogICAgfQogIH0sCiAgewogICAgdGl0bGU6ICJMZXZlbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24ocG9ydGFsKSB7IHJldHVybiBwb3J0YWwub3B0aW9ucy5kYXRhLmxldmVsOyB9LAogICAgZm9ybWF0OiBmdW5jdGlvbihjZWxsLCBwb3J0YWwsIHZhbHVlKSB7CiAgICAgICQoY2VsbCkKICAgICAgICAuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgQ09MT1JTX0xWTFt2YWx1ZV0pCiAgICAgICAgLnRleHQoJ0wnICsgdmFsdWUpOwogICAgfSwKICAgIGRlZmF1bHRPcmRlcjogLTEsCiAgfSwKICB7CiAgICB0aXRsZTogIlRlYW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uKHBvcnRhbCkgeyByZXR1cm4gcG9ydGFsLm9wdGlvbnMudGVhbTsgfSwKICAgIGZvcm1hdDogZnVuY3Rpb24oY2VsbCwgcG9ydGFsLCB2YWx1ZSkgewogICAgICAkKGNlbGwpLnRleHQoWydORVUnLCAnUkVTJywgJ0VOTCddW3ZhbHVlXSk7CiAgICB9CiAgfSwKICB7CiAgICB0aXRsZTogIkhlYWx0aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24ocG9ydGFsKSB7IHJldHVybiBwb3J0YWwub3B0aW9ucy5kYXRhLmhlYWx0aDsgfSwKICAgIHNvcnRWYWx1ZTogZnVuY3Rpb24odmFsdWUsIHBvcnRhbCkgeyByZXR1cm4gcG9ydGFsLm9wdGlvbnMudGVhbT09PVRFQU1fTk9ORSA/IC0xIDogdmFsdWU7IH0sCiAgICBmb3JtYXQ6IGZ1bmN0aW9uKGNlbGwsIHBvcnRhbCwgdmFsdWUpIHsKICAgICAgJChjZWxsKQogICAgICAgIC5hZGRDbGFzcygiYWxpZ25SIikKICAgICAgICAudGV4dChwb3J0YWwub3B0aW9ucy50ZWFtPT09VEVBTV9OT05FID8gJy0nIDogdmFsdWUrJyUnKTsKICAgIH0sCiAgICBkZWZhdWx0T3JkZXI6IC0xLAogIH0sCiAgewogICAgdGl0bGU6ICJSZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uKHBvcnRhbCkgeyByZXR1cm4gcG9ydGFsLm9wdGlvbnMuZGF0YS5yZXNDb3VudDsgfSwKICAgIGZvcm1hdDogZnVuY3Rpb24oY2VsbCwgcG9ydGFsLCB2YWx1ZSkgewogICAgICAkKGNlbGwpCiAgICAgICAgLmFkZENsYXNzKCJhbGlnblIiKQogICAgICAgIC50ZXh0KHZhbHVlKTsKICAgIH0sCiAgICBkZWZhdWx0T3JkZXI6IC0xLAogIH0sCiAgewogICAgdGl0bGU6ICJMaW5rcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24ocG9ydGFsKSB7IHJldHVybiB3aW5kb3cuZ2V0UG9ydGFsTGlua3MocG9ydGFsLm9wdGlvbnMuZ3VpZCk7IH0sCiAgICBzb3J0VmFsdWU6IGZ1bmN0aW9uKHZhbHVlLCBwb3J0YWwpIHsgcmV0dXJuIHZhbHVlLmluLmxlbmd0aCArIHZhbHVlLm91dC5sZW5ndGg7IH0sCiAgICBmb3JtYXQ6IGZ1bmN0aW9uKGNlbGwsIHBvcnRhbCwgdmFsdWUpIHsKICAgICAgJChjZWxsKQogICAgICAgIC5hZGRDbGFzcygiYWxpZ25SIikKICAgICAgICAuYWRkQ2xhc3MoJ2hlbHAnKQogICAgICAgIC5hdHRyKCd0aXRsZScsICdJbjpcdCcgKyB2YWx1ZS5pbi5sZW5ndGggKyAnXG5PdXQ6XHQnICsgdmFsdWUub3V0Lmxlbmd0aCkKICAgICAgICAudGV4dCh2YWx1ZS5pbi5sZW5ndGgrdmFsdWUub3V0Lmxlbmd0aCk7CiAgICB9LAogICAgZGVmYXVsdE9yZGVyOiAtMSwKICB9LAogIHsKICAgIHRpdGxlOiAiRmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbihwb3J0YWwpIHsgcmV0dXJuIGdldFBvcnRhbEZpZWxkc0NvdW50KHBvcnRhbC5vcHRpb25zLmd1aWQpIH0sCiAgICBmb3JtYXQ6IGZ1bmN0aW9uKGNlbGwsIHBvcnRhbCwgdmFsdWUpIHsKICAgICAgJChjZWxsKQogICAgICAgIC5hZGRDbGFzcygiYWxpZ25SIikKICAgICAgICAudGV4dCh2YWx1ZSk7CiAgICB9LAogICAgZGVmYXVsdE9yZGVyOiAtMSwKICB9LAogIHsKICAgIHRpdGxlOiAiQVAiLAogICAgdmFsdWU6IGZ1bmN0aW9uKHBvcnRhbCkgewogICAgICB2YXIgbGlua3MgPSB3aW5kb3cuZ2V0UG9ydGFsTGlua3MocG9ydGFsLm9wdGlvbnMuZ3VpZCk7CiAgICAgIHZhciBmaWVsZHMgPSBnZXRQb3J0YWxGaWVsZHNDb3VudChwb3J0YWwub3B0aW9ucy5ndWlkKTsKICAgICAgcmV0dXJuIHBvcnRhbEFwR2Fpbk1hdGhzKHBvcnRhbC5vcHRpb25zLmRhdGEucmVzQ291bnQsIGxpbmtzLmluLmxlbmd0aCtsaW5rcy5vdXQubGVuZ3RoLCBmaWVsZHMpOwogICAgfSwKICAgIHNvcnRWYWx1ZTogZnVuY3Rpb24odmFsdWUsIHBvcnRhbCkgeyByZXR1cm4gdmFsdWUuZW5lbXlBcDsgfSwKICAgIGZvcm1hdDogZnVuY3Rpb24oY2VsbCwgcG9ydGFsLCB2YWx1ZSkgewogICAgICB2YXIgdGl0bGUgPSAnJzsKICAgICAgaWYgKHRlYW1TdHJpbmdUb0lkKFBMQVlFUi50ZWFtKSA9PSBwb3J0YWwub3B0aW9ucy50ZWFtKSB7CiAgICAgICAgdGl0bGUgKz0gJ0ZyaWVuZGx5IEFQOlx0Jyt2YWx1ZS5mcmllbmRseUFwKydcbicKICAgICAgICAgICAgICAgKyAnLSBkZXBsb3kgJysoOC1wb3J0YWwub3B0aW9ucy5kYXRhLnJlc0NvdW50KSsnIHJlc29uYXRvcihzKVxuJwogICAgICAgICAgICAgICArICctIHVwZ3JhZGVzL21vZHMgdW5rbm93blxuJzsKICAgICAgfQogICAgICB0aXRsZSArPSAnRW5lbXkgQVA6XHQnK3ZhbHVlLmVuZW15QXArJ1xuJwogICAgICAgICAgICAgKyAnLSBEZXN0cm95IEFQOlx0Jyt2YWx1ZS5kZXN0cm95QXArJ1xuJwogICAgICAgICAgICAgKyAnLSBDYXB0dXJlIEFQOlx0Jyt2YWx1ZS5jYXB0dXJlQXA7CgogICAgICAkKGNlbGwpCiAgICAgICAgLmFkZENsYXNzKCJhbGlnblIiKQogICAgICAgIC5hZGRDbGFzcygnaGVscCcpCiAgICAgICAgLnByb3AoJ3RpdGxlJywgdGl0bGUpCiAgICAgICAgLmh0bWwoZGlnaXRzKHZhbHVlLmVuZW15QXApKTsKICAgIH0sCiAgICBkZWZhdWx0T3JkZXI6IC0xLAogIH0sCl07CgovL2ZpbGwgdGhlIGxpc3RQb3J0YWxzIGFycmF5IHdpdGggcG9ydGFscyBhdmFsaWFibGUgb24gdGhlIG1hcCAobGV2ZWwgZmlsdGVyZWQgcG9ydGFscyB3aWxsIG5vdCBhcHBlYXIgaW4gdGhlIHRhYmxlKQp3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LmdldFBvcnRhbHMgPSBmdW5jdGlvbigpIHsKICAvL2ZpbHRlciA6IDAgPSBBbGwsIDEgPSBOZXV0cmFsLCAyID0gUmVzLCAzID0gRW5sLCAteCA9IGFsbCBidXQgeAogIHZhciByZXR2YWw9ZmFsc2U7CgogIHZhciBkaXNwbGF5Qm91bmRzID0gbWFwLmdldEJvdW5kcygpOwoKICB3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0Lmxpc3RQb3J0YWxzID0gW107CiAgJC5lYWNoKHdpbmRvdy5wb3J0YWxzLCBmdW5jdGlvbihpLCBwb3J0YWwpIHsKICAgIC8vIGVsaW1pbmF0ZSBvZmZzY3JlZW4gcG9ydGFscyAoc2VsZWN0ZWQsIGFuZCBpbiBwYWRkaW5nKQogICAgaWYoIWRpc3BsYXlCb3VuZHMuY29udGFpbnMocG9ydGFsLmdldExhdExuZygpKSkgcmV0dXJuIHRydWU7CgogICAgcmV0dmFsPXRydWU7CgogICAgc3dpdGNoIChwb3J0YWwub3B0aW9ucy50ZWFtKSB7CiAgICAgIGNhc2UgVEVBTV9SRVM6CiAgICAgICAgd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5yZXNQKys7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgVEVBTV9FTkw6CiAgICAgICAgd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5lbmxQKys7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5uZXVQKys7CiAgICB9CgogICAgLy8gY2FjaGUgdmFsdWVzIGFuZCBET00gbm9kZXMKICAgIHZhciBvYmogPSB7IHBvcnRhbDogcG9ydGFsLCB2YWx1ZXM6IFtdLCBzb3J0VmFsdWVzOiBbXSB9OwoKICAgIHZhciByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOwogICAgcm93LmNsYXNzTmFtZSA9IFRFQU1fVE9fQ1NTW3BvcnRhbC5vcHRpb25zLnRlYW1dOwogICAgb2JqLnJvdyA9IHJvdzsKCiAgICB2YXIgY2VsbCA9IHJvdy5pbnNlcnRDZWxsKC0xKTsKICAgIGNlbGwuY2xhc3NOYW1lID0gJ2FsaWduUic7CgogICAgd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5maWVsZHMuZm9yRWFjaChmdW5jdGlvbihmaWVsZCwgaSkgewogICAgICBjZWxsID0gcm93Lmluc2VydENlbGwoLTEpOwoKICAgICAgdmFyIHZhbHVlID0gZmllbGQudmFsdWUocG9ydGFsKTsKICAgICAgb2JqLnZhbHVlcy5wdXNoKHZhbHVlKTsKCiAgICAgIG9iai5zb3J0VmFsdWVzLnB1c2goZmllbGQuc29ydFZhbHVlID8gZmllbGQuc29ydFZhbHVlKHZhbHVlLCBwb3J0YWwpIDogdmFsdWUpOwoKICAgICAgaWYoZmllbGQuZm9ybWF0KSB7CiAgICAgICAgZmllbGQuZm9ybWF0KGNlbGwsIHBvcnRhbCwgdmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIGNlbGwudGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgICAgfQogICAgfSk7CgogICAgd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5saXN0UG9ydGFscy5wdXNoKG9iaik7CiAgfSk7CgogIHJldHVybiByZXR2YWw7Cn0KCndpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QuZGlzcGxheVBMID0gZnVuY3Rpb24oKSB7CiAgdmFyIGxpc3Q7CiAgLy8gcGx1Z2lucyAoZS5nLiBib29rbWFya3MpIGNhbiBpbnNlcnQgZmllbGRzIGJlZm9yZSB0aGUgc3RhbmRhcmQgb25lcyAtIHNvIHdlIG5lZWQgdG8gc2VhcmNoIGZvciB0aGUgJ2xldmVsJyBjb2x1bW4KICB3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LnNvcnRCeSA9IHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QuZmllbGRzLm1hcChmdW5jdGlvbihmKXtyZXR1cm4gZi50aXRsZTt9KS5pbmRleE9mKCdMZXZlbCcpOwogIHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3Quc29ydE9yZGVyID0gLTE7CiAgd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5lbmxQID0gMDsKICB3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LnJlc1AgPSAwOwogIHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QubmV1UCA9IDA7CiAgd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5maWx0ZXIgPSAwOwoKICBpZiAod2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5nZXRQb3J0YWxzKCkpIHsKICAgIGxpc3QgPSB3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LnBvcnRhbFRhYmxlKHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3Quc29ydEJ5LCB3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LnNvcnRPcmRlcix3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LmZpbHRlcik7CiAgfSBlbHNlIHsKICAgIGxpc3QgPSAkKCc8dGFibGUgY2xhc3M9Im5vUG9ydGFscyI+PHRyPjx0ZD5Ob3RoaW5nIHRvIHNob3chPC90ZD48L3RyPjwvdGFibGU+Jyk7CiAgfTsKCiAgaWYod2luZG93LnVzZUFuZHJvaWRQYW5lcygpKSB7CiAgICAkKCc8ZGl2IGlkPSJwb3J0YWxzbGlzdCIgY2xhc3M9Im1vYmlsZSI+JykuYXBwZW5kKGxpc3QpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpOwogIH0gZWxzZSB7CiAgICBkaWFsb2coewogICAgICBodG1sOiAkKCc8ZGl2IGlkPSJwb3J0YWxzbGlzdCI+JykuYXBwZW5kKGxpc3QpLAogICAgICBkaWFsb2dDbGFzczogJ3VpLWRpYWxvZy1wb3J0YWxzbGlzdCcsCiAgICAgIHRpdGxlOiAnUG9ydGFsIGxpc3Q6ICcgKyB3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0Lmxpc3RQb3J0YWxzLmxlbmd0aCArICcgJyArICh3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0Lmxpc3RQb3J0YWxzLmxlbmd0aCA9PSAxID8gJ3BvcnRhbCcgOiAncG9ydGFscycpLAogICAgICBpZDogJ3BvcnRhbC1saXN0JywKICAgICAgd2lkdGg6IDcwMAogICAgfSk7CiAgfQp9Cgp3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LnBvcnRhbFRhYmxlID0gZnVuY3Rpb24oc29ydEJ5LCBzb3J0T3JkZXIsIGZpbHRlcikgewogIC8vIHNhdmUgdGhlIHNvcnRCeS9zb3J0T3JkZXIvZmlsdGVyCiAgd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5zb3J0QnkgPSBzb3J0Qnk7CiAgd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5zb3J0T3JkZXIgPSBzb3J0T3JkZXI7CiAgd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5maWx0ZXIgPSBmaWx0ZXI7CgogIHZhciBwb3J0YWxzID0gd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5saXN0UG9ydGFsczsKICB2YXIgc29ydEZpZWxkID0gd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5maWVsZHNbc29ydEJ5XTsKCiAgcG9ydGFscy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgIHZhciB2YWx1ZUEgPSBhLnNvcnRWYWx1ZXNbc29ydEJ5XTsKICAgIHZhciB2YWx1ZUIgPSBiLnNvcnRWYWx1ZXNbc29ydEJ5XTsKCiAgICBpZihzb3J0RmllbGQuc29ydCkgewogICAgICByZXR1cm4gc29ydE9yZGVyICogc29ydEZpZWxkLnNvcnQodmFsdWVBLCB2YWx1ZUIsIGEucG9ydGFsLCBiLnBvcnRhbCk7CiAgICB9CgovL0ZJWE1FOiBzb3J0IGlzbid0IHN0YWJsZSwgc28gcmUtc29ydGluZyBpZGVudGljYWwgdmFsdWVzIGNhbiBjaGFuZ2UgdGhlIG9yZGVyIG9mIHRoZSBsaXN0LgovL2ZhbGwgYmFjayB0byBzb21ldGhpbmcgY29uc3RhbnQgKGUuZy4gcG9ydGFsIG5hbWU/LCBwb3J0YWwgR1VJRD8pLAovL29yIHN3aXRjaCB0byBhIHN0YWJsZSBzb3J0IHNvIG9yZGVyIG9mIGVxdWFsIGl0ZW1zIGRvZXNuJ3QgY2hhbmdlCiAgICByZXR1cm4gc29ydE9yZGVyICoKICAgICAgKHZhbHVlQSA8IHZhbHVlQiA/IC0xIDoKICAgICAgdmFsdWVBID4gdmFsdWVCID8gIDEgOgogICAgICAwKTsKICB9KTsKCiAgaWYoZmlsdGVyICE9PSAwKSB7CiAgICBwb3J0YWxzID0gcG9ydGFscy5maWx0ZXIoZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiBmaWx0ZXIgPCAwCiAgICAgICAgPyBvYmoucG9ydGFsLm9wdGlvbnMudGVhbSsxICE9IC1maWx0ZXIKICAgICAgICA6IG9iai5wb3J0YWwub3B0aW9ucy50ZWFtKzEgPT0gZmlsdGVyOwogICAgfSk7CiAgfQoKICB2YXIgdGFibGUsIHJvdywgY2VsbDsKICB2YXIgY29udGFpbmVyID0gJCgnPGRpdj4nKTsKCiAgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpOwogIHRhYmxlLmNsYXNzTmFtZSA9ICdmaWx0ZXInOwogIGNvbnRhaW5lci5hcHBlbmQodGFibGUpOwoKICByb3cgPSB0YWJsZS5pbnNlcnRSb3coLTEpOwoKICB2YXIgbGVuZ3RoID0gd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5saXN0UG9ydGFscy5sZW5ndGg7CgogIFsiQWxsIiwgIk5ldXRyYWwiLCAiUmVzaXN0YW5jZSIsICJFbmxpZ2h0ZW5lZCJdLmZvckVhY2goZnVuY3Rpb24obGFiZWwsIGkpIHsKICAgIGNlbGwgPSByb3cuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKSk7CiAgICBjZWxsLmNsYXNzTmFtZSA9ICdmaWx0ZXInICsgbGFiZWwuc3Vic3RyKDAsIDMpOwogICAgY2VsbC50ZXh0Q29udGVudCA9IGxhYmVsKyc6JzsKICAgIGNlbGwudGl0bGUgPSAnU2hvdyBvbmx5IHBvcnRhbHMgb2YgdGhpcyBjb2xvcic7CiAgICAkKGNlbGwpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAkKCcjcG9ydGFsc2xpc3QnKS5lbXB0eSgpLmFwcGVuZCh3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LnBvcnRhbFRhYmxlKHNvcnRCeSwgc29ydE9yZGVyLCBpKSk7CiAgICB9KTsKCgogICAgY2VsbCA9IHJvdy5pbnNlcnRDZWxsKC0xKTsKICAgIGNlbGwuY2xhc3NOYW1lID0gJ2ZpbHRlcicgKyBsYWJlbC5zdWJzdHIoMCwgMyk7CiAgICBpZihpICE9IDApIGNlbGwudGl0bGUgPSAnSGlkZSBwb3J0YWxzIG9mIHRoaXMgY29sb3InOwogICAgJChjZWxsKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgJCgnI3BvcnRhbHNsaXN0JykuZW1wdHkoKS5hcHBlbmQod2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5wb3J0YWxUYWJsZShzb3J0QnksIHNvcnRPcmRlciwgLWkpKTsKICAgIH0pOwoKICAgIHN3aXRjaChpLTEpIHsKICAgICAgY2FzZSAtMToKICAgICAgICBjZWxsLnRleHRDb250ZW50ID0gbGVuZ3RoOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDA6CiAgICAgICAgY2VsbC50ZXh0Q29udGVudCA9IHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QubmV1UCArICcgKCcgKyBNYXRoLnJvdW5kKHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QubmV1UC9sZW5ndGgqMTAwKSArICclKSc7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMToKICAgICAgICBjZWxsLnRleHRDb250ZW50ID0gd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5yZXNQICsgJyAoJyArIE1hdGgucm91bmQod2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5yZXNQL2xlbmd0aCoxMDApICsgJyUpJzsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAyOgogICAgICAgIGNlbGwudGV4dENvbnRlbnQgPSB3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LmVubFAgKyAnICgnICsgTWF0aC5yb3VuZCh3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LmVubFAvbGVuZ3RoKjEwMCkgKyAnJSknOwogICAgfQogIH0pOwoKICB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7CiAgdGFibGUuY2xhc3NOYW1lID0gJ3BvcnRhbHMnOwogIGNvbnRhaW5lci5hcHBlbmQodGFibGUpOwoKICB2YXIgdGhlYWQgPSB0YWJsZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpKTsKICByb3cgPSB0aGVhZC5pbnNlcnRSb3coLTEpOwoKICBjZWxsID0gcm93LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJykpOwogIGNlbGwudGV4dENvbnRlbnQgPSAnIyc7CgogIHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QuZmllbGRzLmZvckVhY2goZnVuY3Rpb24oZmllbGQsIGkpIHsKICAgIGNlbGwgPSByb3cuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKSk7CiAgICBjZWxsLnRleHRDb250ZW50ID0gZmllbGQudGl0bGU7CiAgICBpZihmaWVsZC5zb3J0ICE9PSBudWxsKSB7CiAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgic29ydGFibGUiKTsKICAgICAgaWYoaSA9PSB3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LnNvcnRCeSkgewogICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgic29ydGVkIik7CiAgICAgIH0KCiAgICAgICQoY2VsbCkuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIG9yZGVyOwogICAgICAgIGlmKGkgPT0gc29ydEJ5KSB7CiAgICAgICAgICBvcmRlciA9IC1zb3J0T3JkZXI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9yZGVyID0gZmllbGQuZGVmYXVsdE9yZGVyIDwgMCA/IC0xIDogMTsKICAgICAgICB9CgogICAgICAgICQoJyNwb3J0YWxzbGlzdCcpLmVtcHR5KCkuYXBwZW5kKHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QucG9ydGFsVGFibGUoaSwgb3JkZXIsIGZpbHRlcikpOwogICAgICB9KTsKICAgIH0KICB9KTsKCiAgcG9ydGFscy5mb3JFYWNoKGZ1bmN0aW9uKG9iaiwgaSkgewogICAgdmFyIHJvdyA9IG9iai5yb3cKICAgIGlmKHJvdy5wYXJlbnROb2RlKSByb3cucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyb3cpOwoKICAgIHJvdy5jZWxsc1swXS50ZXh0Q29udGVudCA9IGkrMTsKCiAgICB0YWJsZS5hcHBlbmRDaGlsZChyb3cpOwogIH0pOwoKICBjb250YWluZXIuYXBwZW5kKCc8ZGl2IGNsYXNzPSJkaXNjbGFpbWVyIj5DbGljayBvbiBwb3J0YWxzIHRhYmxlIGhlYWRlcnMgdG8gc29ydCBieSB0aGF0IGNvbHVtbi4gJwogICAgKyAnQ2xpY2sgb24gPGI+QWxsLCBOZXV0cmFsLCBSZXNpc3RhbmNlLCBFbmxpZ2h0ZW5lZDwvYj4gdG8gb25seSBzaG93IHBvcnRhbHMgb3duZXIgYnkgdGhhdCBmYWN0aW9uIG9yIG9uIHRoZSBudW1iZXIgYmVoaW5kIHRoZSBmYWN0aW9ucyB0byBzaG93IGFsbCBidXQgdGhvc2UgcG9ydGFscy48L2Rpdj4nKTsKCiAgcmV0dXJuIGNvbnRhaW5lcjsKfQoKLy8gcG9ydGFsIGxpbmsgLSBzaW5nbGUgY2xpY2s6IHNlbGVjdCBwb3J0YWwKLy8gICAgICAgICAgICAgICBkb3VibGUgY2xpY2s6IHpvb20gdG8gYW5kIHNlbGVjdCBwb3J0YWwKLy8gY29kZSBmcm9tIGdldFBvcnRhbExpbmsgZnVuY3Rpb24gYnkgeGVsaW8gZnJvbSBpaXRjOiBBUCBMaXN0IC0gaHR0cHM6Ly9yYXcuZ2l0aHViLmNvbS9icmV1bmlncy9pbmdyZXNzLWludGVsLXRvdGFsLWNvbnZlcnNpb24vZ2gtcGFnZXMvcGx1Z2lucy9hcC1saXN0LnVzZXIuanMKd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5nZXRQb3J0YWxMaW5rID0gZnVuY3Rpb24ocG9ydGFsKSB7CiAgdmFyIGNvb3JkID0gcG9ydGFsLmdldExhdExuZygpOwogIHZhciBwZXJtYSA9ICcvaW50ZWw/bGw9Jytjb29yZC5sYXQrJywnK2Nvb3JkLmxuZysnJno9MTcmcGxsPScrY29vcmQubGF0KycsJytjb29yZC5sbmc7CgogIC8vIGpRdWVyeSdzIGV2ZW50IGhhbmRsZXJzIHNlZW0gdG8gYmUgcmVtb3ZlZCB3aGVuIHRoZSBub2RlcyBhcmUgcmVtb3ZlIGZyb20gdGhlIERPTQogIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogIGxpbmsudGV4dENvbnRlbnQgPSBwb3J0YWwub3B0aW9ucy5kYXRhLnRpdGxlOwogIGxpbmsuaHJlZiA9IHBlcm1hOwogIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihldikgewogICAgcmVuZGVyUG9ydGFsRGV0YWlscyhwb3J0YWwub3B0aW9ucy5ndWlkKTsKICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICByZXR1cm4gZmFsc2U7CiAgfSwgZmFsc2UpOwogIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBmdW5jdGlvbihldikgewogICAgem9vbVRvQW5kU2hvd1BvcnRhbChwb3J0YWwub3B0aW9ucy5ndWlkLCBbY29vcmQubGF0LCBjb29yZC5sbmddKTsKICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICByZXR1cm4gZmFsc2U7CiAgfSk7CiAgcmV0dXJuIGxpbms7Cn0KCndpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3Qub25QYW5lQ2hhbmdlZCA9IGZ1bmN0aW9uKHBhbmUpIHsKICBpZihwYW5lID09ICJwbHVnaW4tcG9ydGFsc2xpc3QiKQogICAgd2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5kaXNwbGF5UEwoKTsKICBlbHNlCiAgICAkKCIjcG9ydGFsc2xpc3QiKS5yZW1vdmUoKQp9OwoKdmFyIHNldHVwID0gIGZ1bmN0aW9uKCkgewogIGlmKHdpbmRvdy51c2VBbmRyb2lkUGFuZXMoKSkgewogICAgYW5kcm9pZC5hZGRQYW5lKCJwbHVnaW4tcG9ydGFsc2xpc3QiLCAiUG9ydGFscyBsaXN0IiwgImljX2FjdGlvbl9wYXN0ZSIpOwogICAgYWRkSG9vaygicGFuZUNoYW5nZWQiLCB3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0Lm9uUGFuZUNoYW5nZWQpOwogIH0gZWxzZSB7CiAgICAkKCcjdG9vbGJveCcpLmFwcGVuZCgnPGEgb25jbGljaz0id2luZG93LnBsdWdpbi5wb3J0YWxzbGlzdC5kaXNwbGF5UEwoKSIgdGl0bGU9IkRpc3BsYXkgYSBsaXN0IG9mIHBvcnRhbHMgaW4gdGhlIGN1cnJlbnQgdmlldyBbdF0iIGFjY2Vzc2tleT0idCI+UG9ydGFscyBsaXN0PC9hPicpOwogIH0KCiAgJCgiPHN0eWxlPiIpCiAgICAucHJvcCgidHlwZSIsICJ0ZXh0L2NzcyIpCiAgICAuaHRtbCgiI3BvcnRhbHNsaXN0Lm1vYmlsZSB7XG4gIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50O1xuICBib3JkZXI6IDAgbm9uZSAhaW1wb3J0YW50O1xuICBoZWlnaHQ6IDEwMCUgIWltcG9ydGFudDtcbiAgd2lkdGg6IDEwMCUgIWltcG9ydGFudDtcbiAgbGVmdDogMCAhaW1wb3J0YW50O1xuICB0b3A6IDAgIWltcG9ydGFudDtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBvdmVyZmxvdzogYXV0bztcbn1cblxuI3BvcnRhbHNsaXN0IHRhYmxlIHtcbiAgbWFyZ2luLXRvcDogNXB4O1xuICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlO1xuICBlbXB0eS1jZWxsczogc2hvdztcbiAgd2lkdGg6IDEwMCU7XG4gIGNsZWFyOiBib3RoO1xufVxuXG4jcG9ydGFsc2xpc3QgdGFibGUgdGQsICNwb3J0YWxzbGlzdCB0YWJsZSB0aCB7XG4gIGJhY2tncm91bmQtY29sb3I6ICMxYjQxNWU7XG4gIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjMGIzMTRlO1xuICBjb2xvcjogd2hpdGU7XG4gIHBhZGRpbmc6IDNweDtcbn1cblxuI3BvcnRhbHNsaXN0IHRhYmxlIHRoIHtcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xufVxuXG4jcG9ydGFsc2xpc3QgdGFibGUgLmFsaWduUiB7XG4gIHRleHQtYWxpZ246IHJpZ2h0O1xufVxuXG4jcG9ydGFsc2xpc3QgdGFibGUucG9ydGFscyB0ZCB7XG4gIHdoaXRlLXNwYWNlOiBub3dyYXA7XG59XG5cbiNwb3J0YWxzbGlzdCB0YWJsZSB0aC5zb3J0YWJsZSB7XG4gIGN1cnNvcjogcG9pbnRlcjtcbn1cblxuI3BvcnRhbHNsaXN0IHRhYmxlIC5wb3J0YWxUaXRsZSB7XG4gIG1pbi13aWR0aDogMTIwcHggIWltcG9ydGFudDtcbiAgbWF4LXdpZHRoOiAyNDBweCAhaW1wb3J0YW50O1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpcztcbn1cblxuI3BvcnRhbHNsaXN0IC5zb3J0ZWQge1xuICBjb2xvcjogI0ZGQ0UwMDtcbn1cblxuI3BvcnRhbHNsaXN0IHRhYmxlLmZpbHRlciB7XG4gIHRhYmxlLWxheW91dDogZml4ZWQ7XG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgYm9yZGVyLWNvbGxhcHNlOiBzZXBhcmF0ZTtcbiAgYm9yZGVyLXNwYWNpbmc6IDFweDtcbn1cblxuI3BvcnRhbHNsaXN0IHRhYmxlLmZpbHRlciB0aCB7XG4gIHRleHQtYWxpZ246IGxlZnQ7XG4gIHBhZGRpbmctbGVmdDogMC4zZW07XG4gIG92ZXJmbG93OiBoaWRkZW47XG4gIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO1xufVxuXG4jcG9ydGFsc2xpc3QgdGFibGUuZmlsdGVyIHRkIHtcbiAgdGV4dC1hbGlnbjogcmlnaHQ7XG4gIHBhZGRpbmctcmlnaHQ6IDAuM2VtO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpcztcbn1cblxuI3BvcnRhbHNsaXN0IC5maWx0ZXJOZXUge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjNjY2O1xufVxuXG4jcG9ydGFsc2xpc3QgdGFibGUgdHIucmVzIHRkLCAjcG9ydGFsc2xpc3QgLmZpbHRlclJlcyB7XG4gIGJhY2tncm91bmQtY29sb3I6ICMwMDU2ODQ7XG59XG5cbiNwb3J0YWxzbGlzdCB0YWJsZSB0ci5lbmwgdGQsICNwb3J0YWxzbGlzdCAuZmlsdGVyRW5sIHtcbiAgYmFja2dyb3VuZC1jb2xvcjogIzAxN2YwMTtcbn1cblxuI3BvcnRhbHNsaXN0IHRhYmxlIHRyLm5vbmUgdGQge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwO1xufVxuXG4jcG9ydGFsc2xpc3QgLmRpc2NsYWltZXIge1xuICBtYXJnaW4tdG9wOiAxMHB4O1xuICBmb250LXNpemU6IDEwcHg7XG59XG5cbiNwb3J0YWxzbGlzdC5tb2JpbGUgdGFibGUuZmlsdGVyIHRyIHtcbiAgZGlzcGxheTogYmxvY2s7XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbn1cbiNwb3J0YWxzbGlzdC5tb2JpbGUgdGFibGUuZmlsdGVyIHRoLCAjcG9ydGFsc2xpc3QubW9iaWxlIHRhYmxlLmZpbHRlciB0ZCB7XG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgd2lkdGg6IDIyJTtcbn1cblxuIikKICAgIC5hcHBlbmRUbygiaGVhZCIpOwoKfQoKLy8gUExVR0lOIEVORCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKc2V0dXAuaW5mbyA9IHBsdWdpbl9pbmZvOyAvL2FkZCB0aGUgc2NyaXB0IGluZm8gZGF0YSB0byB0aGUgZnVuY3Rpb24gYXMgYSBwcm9wZXJ0eQppZighd2luZG93LmJvb3RQbHVnaW5zKSB3aW5kb3cuYm9vdFBsdWdpbnMgPSBbXTsKd2luZG93LmJvb3RQbHVnaW5zLnB1c2goc2V0dXApOwovLyBpZiBJSVRDIGhhcyBhbHJlYWR5IGJvb3RlZCwgaW1tZWRpYXRlbHkgcnVuIHRoZSAnc2V0dXAnIGZ1bmN0aW9uCmlmKHdpbmRvdy5paXRjTG9hZGVkICYmIHR5cGVvZiBzZXR1cCA9PT0gJ2Z1bmN0aW9uJykgc2V0dXAoKTsKfSAvLyB3cmFwcGVyIGVuZAovLyBpbmplY3QgY29kZSBpbnRvIHNpdGUgY29udGV4dAp2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CnZhciBpbmZvID0ge307CmlmICh0eXBlb2YgR01faW5mbyAhPT0gJ3VuZGVmaW5lZCcgJiYgR01faW5mbyAmJiBHTV9pbmZvLnNjcmlwdCkgaW5mby5zY3JpcHQgPSB7IHZlcnNpb246IEdNX2luZm8uc2NyaXB0LnZlcnNpb24sIG5hbWU6IEdNX2luZm8uc2NyaXB0Lm5hbWUsIGRlc2NyaXB0aW9uOiBHTV9pbmZvLnNjcmlwdC5kZXNjcmlwdGlvbiB9OwpzY3JpcHQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJygnKyB3cmFwcGVyICsnKSgnK0pTT04uc3RyaW5naWZ5KGluZm8pKycpOycpKTsKKGRvY3VtZW50LmJvZHkgfHwgZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmFwcGVuZENoaWxkKHNjcmlwdCk7CgoK"},{"name":"IITC plugin: Show total counts of portals","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1480919327014,"data":{}},"enabled":true,"position":9,"file_url":"https://static.iitc.me/build/release/plugins/portal-counts.user.js","uuid":"cc7dc288-f5b3-4d56-9ea1-d9df64180a6e","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLXBvcnRhbHMtY291bnRAeWVua3kKLy8gQG5hbWUgICAgICAgICAgIElJVEMgcGx1Z2luOiBTaG93IHRvdGFsIGNvdW50cyBvZiBwb3J0YWxzCi8vIEBjYXRlZ29yeSAgICAgICBJbmZvCi8vIEB2ZXJzaW9uICAgICAgICAwLjEuMi4yMDE2MTAwMy40NzQwCi8vIEBuYW1lc3BhY2UgICAgICBodHRwczovL2dpdGh1Yi5jb20vam9uYXRraW5zL2luZ3Jlc3MtaW50ZWwtdG90YWwtY29udmVyc2lvbgovLyBAdXBkYXRlVVJMICAgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3BsdWdpbnMvcG9ydGFsLWNvdW50cy5tZXRhLmpzCi8vIEBkb3dubG9hZFVSTCAgICBodHRwczovL3N0YXRpYy5paXRjLm1lL2J1aWxkL3JlbGVhc2UvcGx1Z2lucy9wb3J0YWwtY291bnRzLnVzZXIuanMKLy8gQGRlc2NyaXB0aW9uICAgIFtpaXRjLTIwMTYtMTAtMDMtMDA0NzQwXSBEaXNwbGF5IGEgbGlzdCBvZiBhbGwgbG9jYWxpemVkIHBvcnRhbHMgYnkgbGV2ZWwgYW5kIGZhY3Rpb24uCi8vIEBpbmNsdWRlICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQG1hdGNoICAgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQG1hdGNoICAgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBtYXRjaCAgICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBtYXRjaCAgICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQGdyYW50ICAgICAgICAgIG5vbmUKLy8gPT0vVXNlclNjcmlwdD09CgoKZnVuY3Rpb24gd3JhcHBlcihwbHVnaW5faW5mbykgewovLyBlbnN1cmUgcGx1Z2luIGZyYW1ld29yayBpcyB0aGVyZSwgZXZlbiBpZiBpaXRjIGlzIG5vdCB5ZXQgbG9hZGVkCmlmKHR5cGVvZiB3aW5kb3cucGx1Z2luICE9PSAnZnVuY3Rpb24nKSB3aW5kb3cucGx1Z2luID0gZnVuY3Rpb24oKSB7fTsKCi8vUExVR0lOIEFVVEhPUlM6IHdyaXRpbmcgYSBwbHVnaW4gb3V0c2lkZSBvZiB0aGUgSUlUQyBidWlsZCBlbnZpcm9ubWVudD8gaWYgc28sIGRlbGV0ZSB0aGVzZSBsaW5lcyEhCi8vKGxlYXZpbmcgdGhlbSBpbiBwbGFjZSBtaWdodCBicmVhayB0aGUgJ0Fib3V0IElJVEMnIHBhZ2Ugb3IgYnJlYWsgdXBkYXRlIGNoZWNrcykKcGx1Z2luX2luZm8uYnVpbGROYW1lID0gJ2lpdGMnOwpwbHVnaW5faW5mby5kYXRlVGltZVZlcnNpb24gPSAnMjAxNjEwMDMuNDc0MCc7CnBsdWdpbl9pbmZvLnBsdWdpbklkID0gJ3BvcnRhbC1jb3VudHMnOwovL0VORCBQTFVHSU4gQVVUSE9SUyBOT1RFCgoKCi8vIFBMVUdJTiBTVEFSVCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLyogd2hhdHNuZXcKKiAwLjEuMCAgOiBkaXNwbGF5IGdyYXBocwoqIDAuMC4xMCA6IHNob3cgaW4gbmF2IGRyYXdlciBvbiBtb2JpbGUgZGV2aWNlcwoqIDAuMC45ICA6IGZpeCBmb3IgbmV3IGludGVsIG1hcAoqIDAuMC44ICA6IHVzZSBkaWFsb2coKSBpbnN0ZWFkIG9mIGFsZXJ0KCkKKiAwLjAuNiAgOiBpZ25vcmluZyBvdXRzaWRlIGJvdW5kcyBwb3J0YWxzIChldmVuIGlmIGNsb3NlIHRvKQoqIDAuMC41ICA6IGNoYW5nZWQgdGFibGUgbGF5b3V0LCBhZGRlZCBzb21lIGNvbG9ycwoqIDAuMC40ICA6IHJldmVyc2Ugc2hvdyBvcmRlciBvZiBwb3J0YWxzLCB1c2luZyBNQVhfUE9SVEFMX0xFVkVMIG5vdyBmb3IgYXJyYXksIGNoYW5nZWQgdGFibGUgbGF5b3V0IHRvIGJlIG1vcmUgY29tcGFjdCwgY2xlYW5lZCB1cCBjb2RlCiogMC4wLjMgIDogZml4ZWQgaW5jb3JyZWN0IHJvdW5kZWQgcG9ydGFsIGxldmVscywgYWRqdXN0ZWQgdmlld3BvcnQKKiAwLjAuMiAgOiBmaXhlZCBjb3VudHMgdG8gYmUgcmVzZXQgYWZ0ZXIgc2Nyb2xsaW5nCiogMC4wLjEgIDogaW5pdGlhbCByZWxlYXNlLCBzaG93IGNvdW50IG9mIHBvcnRhbHMKKi8KCi8vIHVzZSBvd24gbmFtZXNwYWNlIGZvciBwbHVnaW4Kd2luZG93LnBsdWdpbi5wb3J0YWxjb3VudHMgPSB7CiAgQkFSX1RPUDogMjAsCiAgQkFSX0hFSUdIVDogMTgwLAogIEJBUl9XSURUSDogMjUsCiAgQkFSX1BBRERJTkc6IDUsCiAgUkFESVVTX0lOTkVSOiA3MCwKICBSQURJVVNfT1VURVI6IDEwMCwKICBDRU5URVJfWDogMjAwLAogIENFTlRFUl9ZOiAxMDAsCn07CgovL2NvdW50IHBvcnRhbHMgZm9yIGVhY2ggbGV2ZWwgYXZhaWxhYmxlIG9uIHRoZSBtYXAKd2luZG93LnBsdWdpbi5wb3J0YWxjb3VudHMuZ2V0UG9ydGFscyA9IGZ1bmN0aW9uICgpewogIC8vY29uc29sZS5sb2coJyoqIGdldFBvcnRhbHMnKTsKICB2YXIgc2VsZiA9IHdpbmRvdy5wbHVnaW4ucG9ydGFsY291bnRzOwogIHZhciBkaXNwbGF5Qm91bmRzID0gbWFwLmdldEJvdW5kcygpOwogIHNlbGYuZW5sUCA9IDA7CiAgc2VsZi5yZXNQID0gMDsKICBzZWxmLm5ldVAgPSAwOwoKICBzZWxmLlBvcnRhbHNFbmwgPSBuZXcgQXJyYXkoKTsKICBzZWxmLlBvcnRhbHNSZXMgPSBuZXcgQXJyYXkoKTsKICBmb3IodmFyIGxldmVsID0gd2luZG93Lk1BWF9QT1JUQUxfTEVWRUw7IGxldmVsID4gMDsgbGV2ZWwtLSl7CiAgICBzZWxmLlBvcnRhbHNFbmxbbGV2ZWxdID0gMDsKICAgIHNlbGYuUG9ydGFsc1Jlc1tsZXZlbF0gPSAwOwogIH0KCiAgJC5lYWNoKHdpbmRvdy5wb3J0YWxzLCBmdW5jdGlvbihpLCBwb3J0YWwpIHsKICAgIHZhciBsZXZlbCA9IHBvcnRhbC5vcHRpb25zLmxldmVsOwogICAgdmFyIHRlYW0gPSBwb3J0YWwub3B0aW9ucy50ZWFtOwogICAgLy8ganVzdCBjb3VudCBwb3J0YWxzIGluIHZpZXdwb3J0CiAgICBpZighZGlzcGxheUJvdW5kcy5jb250YWlucyhwb3J0YWwuZ2V0TGF0TG5nKCkpKSByZXR1cm4gdHJ1ZTsKICAgIHN3aXRjaCAodGVhbSl7CiAgICAgIGNhc2UgMSA6CiAgICAgICAgc2VsZi5yZXNQKys7CiAgICAgICAgc2VsZi5Qb3J0YWxzUmVzW2xldmVsXSsrOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDIgOgogICAgICAgIHNlbGYuZW5sUCsrOwogICAgICAgIHNlbGYuUG9ydGFsc0VubFtsZXZlbF0rKzsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBzZWxmLm5ldVArKzsKICAgICAgICBicmVhazsKICAgIH0KICB9KTsKCiAgLy9nZXQgcG9ydGFscyBpbmZvcm1hdGlvbnMgZnJvbSBJSVRDCiAgdmFyIG1pbmx2bCA9IGdldE1pblBvcnRhbExldmVsKCk7CiAgdmFyIHRvdGFsID0gc2VsZi5uZXVQICsgc2VsZi5lbmxQICsgc2VsZi5yZXNQOwoKICB2YXIgY291bnRzID0gJyc7CiAgaWYodG90YWwgPiAwKSB7CiAgICBjb3VudHMgKz0gJzx0YWJsZT48dHI+PHRoPjwvdGg+PHRoIGNsYXNzPSJlbmwiPkVubGlnaHRlbmVkPC90aD48dGggY2xhc3M9InJlcyI+UmVzaXN0YW5jZTwvdGg+PC90cj4nOyAgLy8nK3NlbGYuZW5sUCsnIFBvcnRhbChzKTwvdGg+PC90cj4nOwogICAgZm9yKHZhciBsZXZlbCA9IHdpbmRvdy5NQVhfUE9SVEFMX0xFVkVMOyBsZXZlbCA+IDA7IGxldmVsLS0pewogICAgICBjb3VudHMgKz0gJzx0cj48dGQgY2xhc3M9IkwnK2xldmVsKyciPkxldmVsICcrbGV2ZWwrJzwvdGQ+JzsKICAgICAgaWYobWlubHZsID4gbGV2ZWwpCiAgICAgICAgY291bnRzICs9ICc8dGQgY29sc3Bhbj0iMiI+em9vbSBpbiB0byBzZWUgcG9ydGFscyBpbiB0aGlzIGxldmVsPC90ZD4nOwogICAgICBlbHNlCiAgICAgICAgY291bnRzICs9ICc8dGQgY2xhc3M9ImVubCI+JytzZWxmLlBvcnRhbHNFbmxbbGV2ZWxdKyc8L3RkPjx0ZCBjbGFzcz0icmVzIj4nK3NlbGYuUG9ydGFsc1Jlc1tsZXZlbF0rJzwvdGQ+JzsKICAgICAgY291bnRzICs9ICc8L3RyPic7CiAgICB9CgogICAgY291bnRzICs9ICc8dHI+PHRoPlRvdGFsOjwvdGg+PHRkIGNsYXNzPSJlbmwiPicrc2VsZi5lbmxQKyc8L3RkPjx0ZCBjbGFzcz0icmVzIj4nK3NlbGYucmVzUCsnPC90ZD48L3RyPic7CgogICAgY291bnRzICs9ICc8dHI+PHRkPk5ldXRyYWw6PC90ZD48dGQgY29sc3Bhbj0iMiI+JzsKICAgIGlmKG1pbmx2bCA+IDApCiAgICAgIGNvdW50cyArPSAnem9vbSBpbiB0byBzZWUgdW5jbGFpbWVkIHBvcnRhbHMnOwogICAgZWxzZQogICAgICBjb3VudHMgKz0gc2VsZi5uZXVQOwogICAgY291bnRzICs9ICc8L3RkPjwvdHI+PC90YWJsZT4nOwoKICAgIHZhciBzdmcgPSAkKCc8c3ZnIHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIj4nKS5jc3MoJ21hcmdpbi10b3AnLCAxMCk7CgogICAgdmFyIGFsbCA9IHNlbGYuUG9ydGFsc1Jlcy5tYXAoZnVuY3Rpb24odmFsLGkpe3JldHVybiB2YWwrc2VsZi5Qb3J0YWxzRW5sW2ldfSk7CiAgICBhbGxbMF0gPSBzZWxmLm5ldVA7CgogICAgLy8gYmFyIGdyYXBocwogICAgc2VsZi5tYWtlQmFyKHNlbGYuUG9ydGFsc0VubCwgJ0VubCcsIENPTE9SU1syXSwgMCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkuYXBwZW5kVG8oc3ZnKTsKICAgIHNlbGYubWFrZUJhcihhbGwgICAgICAgICAgICAsICdBbGwnLCAnI0ZGRkZGRicsIDEqKHNlbGYuQkFSX1dJRFRIICsgc2VsZi5CQVJfUEFERElORykpLmFwcGVuZFRvKHN2Zyk7CiAgICBzZWxmLm1ha2VCYXIoc2VsZi5Qb3J0YWxzUmVzLCAnUmVzJywgQ09MT1JTWzFdLCAyKihzZWxmLkJBUl9XSURUSCArIHNlbGYuQkFSX1BBRERJTkcpKS5hcHBlbmRUbyhzdmcpOwoKICAgIC8vIHBpZSBncmFwaAogICAgdmFyIGcgPSAkKCc8Zz4nKQogICAgICAuYXR0cigndHJhbnNmb3JtJywgc2VsZi5mb3JtYXQoJ3RyYW5zbGF0ZSglcywlcyknLCBzZWxmLkNFTlRFUl9YLCBzZWxmLkNFTlRFUl9ZKSkKICAgICAgLmFwcGVuZFRvKHN2Zyk7CgogICAgLy8gaW5uZXIgcGFydHMgLSBmYWN0aW9ucwogICAgc2VsZi5tYWtlUGllKDAsICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlc1AvdG90YWwsICAgICAgICAgICAgICAgQ09MT1JTWzFdKS5hcHBlbmRUbyhnKTsKICAgIHNlbGYubWFrZVBpZShzZWxmLnJlc1AvdG90YWwsICAgICAgICAgICAgICAgKHNlbGYubmV1UCArIHNlbGYucmVzUCkvdG90YWwsIENPTE9SU1swXSkuYXBwZW5kVG8oZyk7CiAgICBzZWxmLm1ha2VQaWUoKHNlbGYubmV1UCArIHNlbGYucmVzUCkvdG90YWwsIDEsICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDT0xPUlNbMl0pLmFwcGVuZFRvKGcpOwoKICAgIC8vIG91dGVyIHBhcnQgLSBsZXZlbHMKICAgIHZhciBhbmdsZSA9IDA7CiAgICBmb3IodmFyIGk9c2VsZi5Qb3J0YWxzUmVzLmxlbmd0aC0xO2k+PTA7aS0tKSB7CiAgICAgIGlmKCFzZWxmLlBvcnRhbHNSZXNbaV0pCiAgICAgICAgY29udGludWU7CgogICAgICB2YXIgZGlmZiA9IHNlbGYuUG9ydGFsc1Jlc1tpXSAvIHRvdGFsOwogICAgICBzZWxmLm1ha2VSaW5nKGFuZ2xlLCBhbmdsZStkaWZmLCBDT0xPUlNfTFZMW2ldKS5hcHBlbmRUbyhnKTsKICAgICAgYW5nbGUgKz0gZGlmZjsKICAgIH0KCiAgICB2YXIgZGlmZiA9IHNlbGYubmV1UCAvIHRvdGFsOwogICAgc2VsZi5tYWtlUmluZyhhbmdsZSwgYW5nbGUrZGlmZiwgQ09MT1JTX0xWTFswXSkuYXBwZW5kVG8oZyk7CiAgICBhbmdsZSArPSBkaWZmOwoKICAgIGZvcih2YXIgaT0wO2k8c2VsZi5Qb3J0YWxzRW5sLmxlbmd0aDtpKyspIHsKICAgICAgaWYoIXNlbGYuUG9ydGFsc0VubFtpXSkKICAgICAgICBjb250aW51ZTsKCiAgICAgIHZhciBkaWZmID0gc2VsZi5Qb3J0YWxzRW5sW2ldIC8gdG90YWw7CiAgICAgIHNlbGYubWFrZVJpbmcoYW5nbGUsIGFuZ2xlK2RpZmYsIENPTE9SU19MVkxbaV0pLmFwcGVuZFRvKGcpOwogICAgICBhbmdsZSArPSBkaWZmOwogICAgfQoKICAgIC8vIGJsYWNrIGxpbmUgZnJvbSBjZW50ZXIgdG8gdG9wCiAgICAkKCc8bGluZT4nKQogICAgICAuYXR0cih7CiAgICAgICAgeDE6IHNlbGYucmVzUDxzZWxmLmVubFAgPyAwLjUgOiAtMC41LAogICAgICAgIHkxOiAwLAogICAgICAgIHgyOiBzZWxmLnJlc1A8c2VsZi5lbmxQID8gMC41IDogLTAuNSwKICAgICAgICB5MjogLXNlbGYuUkFESVVTX09VVEVSLAogICAgICAgIHN0cm9rZTogJyMwMDAnLAogICAgICAgICdzdHJva2Utd2lkdGgnOiAxCiAgICAgIH0pCiAgICAgIC5hcHBlbmRUbyhnKTsKCiAgICAvLyBpZiB0aGVyZSBhcmUgbm8gbmV1dHJhbCBwb3J0YWxzLCBkcmF3IGEgYmxhY2sgbGluZSBiZXR3ZWVuIHJlcyBhbmQgZW5sCiAgICBpZihzZWxmLm5ldVAgPT0gMCkgewogICAgICB2YXIgeCA9IE1hdGguc2luKCgwLjUgLSBzZWxmLnJlc1AvdG90YWwpICogMiAqIE1hdGguUEkpICogc2VsZi5SQURJVVNfT1VURVI7CiAgICAgIHZhciB5ID0gTWF0aC5jb3MoKDAuNSAtIHNlbGYucmVzUC90b3RhbCkgKiAyICogTWF0aC5QSSkgKiBzZWxmLlJBRElVU19PVVRFUjsKCiAgICAgICQoJzxsaW5lPicpCiAgICAgICAgLmF0dHIoewogICAgICAgICAgeDE6IHNlbGYucmVzUDxzZWxmLmVubFAgPyAwLjUgOiAtMC41LAogICAgICAgICAgeTE6IDAsCiAgICAgICAgICB4MjogeCwKICAgICAgICAgIHkyOiB5LAogICAgICAgICAgc3Ryb2tlOiAnIzAwMCcsCiAgICAgICAgICAnc3Ryb2tlLXdpZHRoJzogMQogICAgICAgIH0pCiAgICAgICAgLmFwcGVuZFRvKGcpOwogICAgfQoKICAgIGNvdW50cyArPSAkKCc8ZGl2PicpLmFwcGVuZChzdmcpLmh0bWwoKTsKICB9IGVsc2UgewogICAgY291bnRzICs9ICc8cD5ObyBQb3J0YWxzIGluIHJhbmdlITwvcD4nOwogIH0KCiAgLy8gSSd2ZSBvbmx5IHNlZW4gdGhlIGJhY2tlbmQgcmVkdWNlIHRoZSBwb3J0YWxzIHJldHVybmVkIGZvciBMNCsgb3IgZnVydGhlciBvdXQgem9vbSBsZXZlbHMgLSBidXQgdGhpcyBjb3VsZCBjaGFuZ2UKICAvLyBVUERBVEU6IG5vdyBzZWVuIGZvciBMMisgaW4gZGVuc2UgYXJlYXMgKG1hcCB6b29tIGxldmVsIDE0IG9yIGxvd2VyKQogIGlmIChnZXRNaW5Qb3J0YWxMZXZlbCgpID49IDIpIHsKICAgY291bnRzICs9ICc8cCBjbGFzcz0iaGVscCIgdGl0bGU9IlRvIHJlZHVjZSBkYXRhIHVzYWdlIGFuZCBzcGVlZCB1cCBtYXAgZGlzcGxheSwgdGhlIGJhY2tlbmQgc2VydmVycyBvbmx5IHJldHVybiBzb21lIHBvcnRhbHMgaW4gZGVuc2UgYXJlYXMuIj48Yj5XYXJuaW5nPC9iPjogUG9ydGFsIGNvdW50cyBjYW4gYmUgaW5hY2N1cmF0ZSB3aGVuIHpvb21lZCBvdXQ8L3A+JzsKICB9CgogIHZhciB0b3RhbCA9IHNlbGYuZW5sUCArIHNlbGYucmVzUCArIHNlbGYubmV1UDsKICB2YXIgdGl0bGUgPSB0b3RhbCArICcgJyArICh0b3RhbCA9PSAxID8gJ3BvcnRhbCcgOiAncG9ydGFscycpOwoKICBpZih3aW5kb3cudXNlQW5kcm9pZFBhbmVzKCkpIHsKICAgICQoJzxkaXYgaWQ9InBvcnRhbGNvdW50cyIgY2xhc3M9Im1vYmlsZSI+JwogICAgKyAnPGRpdiBjbGFzcz0idWktZGlhbG9nLXRpdGxlYmFyIj48c3BhbiBjbGFzcz0idWktZGlhbG9nLXRpdGxlIHVpLWRpYWxvZy10aXRsZS1hY3RpdmUiPicgKyB0aXRsZSArICc8L3NwYW4+PC9kaXY+JwogICAgKyBjb3VudHMKICAgICsgJzwvZGl2PicpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpOwogIH0gZWxzZSB7CiAgICBkaWFsb2coewogICAgICBodG1sOiAnPGRpdiBpZD0icG9ydGFsY291bnRzIj4nICsgY291bnRzICsgJzwvZGl2PicsCiAgICAgIHRpdGxlOiAnUG9ydGFsIGNvdW50czogJyArIHRpdGxlLAogICAgICB3aWR0aDogJ2F1dG8nCiAgICB9KTsKICB9Cn0KCndpbmRvdy5wbHVnaW4ucG9ydGFsY291bnRzLm1ha2VCYXIgPSBmdW5jdGlvbihwb3J0YWxzLCB0ZXh0LCBjb2xvciwgc2hpZnQpIHsKICB2YXIgc2VsZiA9IHdpbmRvdy5wbHVnaW4ucG9ydGFsY291bnRzOwogIHZhciBnID0gJCgnPGc+JykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnK3NoaWZ0KycsMCknKTsKICB2YXIgc3VtID0gcG9ydGFscy5yZWR1Y2UoZnVuY3Rpb24oYSxiKXsgcmV0dXJuIGErYiB9KTsKICB2YXIgdG9wID0gc2VsZi5CQVJfVE9QOwoKICBpZihzdW0gIT0gMCkgewogICAgZm9yKHZhciBpPXBvcnRhbHMubGVuZ3RoLTE7aT49MDtpLS0pIHsKICAgICAgaWYoIXBvcnRhbHNbaV0pCiAgICAgICAgY29udGludWU7CiAgICAgIHZhciBoZWlnaHQgPSBzZWxmLkJBUl9IRUlHSFQgKiBwb3J0YWxzW2ldIC8gc3VtOwogICAgICAkKCc8cmVjdD4nKQogICAgICAgIC5hdHRyKHsKICAgICAgICAgIHg6IDAsCiAgICAgICAgICB5OiB0b3AsCiAgICAgICAgICB3aWR0aDogc2VsZi5CQVJfV0lEVEgsCiAgICAgICAgICBoZWlnaHQ6IGhlaWdodCwKICAgICAgICAgIGZpbGw6IENPTE9SU19MVkxbaV0KICAgICAgICB9KQogICAgICAgIC5hcHBlbmRUbyhnKTsKICAgICAgdG9wICs9IGhlaWdodDsKICAgIH0KICB9CgogICQoJzx0ZXh0PicpCiAgICAuaHRtbCh0ZXh0KQogICAgLmF0dHIoewogICAgICB4OiBzZWxmLkJBUl9XSURUSCAqIDAuNSwKICAgICAgeTogc2VsZi5CQVJfVE9QICogMC43NSwKICAgICAgZmlsbDogY29sb3IsCiAgICAgICd0ZXh0LWFuY2hvcic6ICdtaWRkbGUnCiAgICB9KQogICAgLmFwcGVuZFRvKGcpOwoKICByZXR1cm4gZzsKfTsKCndpbmRvdy5wbHVnaW4ucG9ydGFsY291bnRzLm1ha2VQaWUgPSBmdW5jdGlvbihzdGFydEFuZ2xlLCBlbmRBbmdsZSwgY29sb3IpIHsKICBpZihzdGFydEFuZ2xlID09IGVuZEFuZ2xlKQogICAgcmV0dXJuICQoW10pOyAvLyByZXR1cm4gZW1wdHkgZWxlbWVudCBxdWVyeQoKICB2YXIgc2VsZiA9IHdpbmRvdy5wbHVnaW4ucG9ydGFsY291bnRzOwogIHZhciBsYXJnZV9hcmMgPSAoZW5kQW5nbGUgLSBzdGFydEFuZ2xlKSA+IDAuNSA/IDEgOiAwOwoKICB2YXIgbGFiZWxBbmdsZSA9IChlbmRBbmdsZSArIHN0YXJ0QW5nbGUpIC8gMjsKICB2YXIgbGFiZWwgPSBNYXRoLnJvdW5kKChlbmRBbmdsZSAtIHN0YXJ0QW5nbGUpICogMTAwKSArICclJzsKCiAgc3RhcnRBbmdsZSA9IDAuNSAtIHN0YXJ0QW5nbGU7CiAgZW5kQW5nbGUgICA9IDAuNSAtIGVuZEFuZ2xlOwogIGxhYmVsQW5nbGUgPSAwLjUgLSBsYWJlbEFuZ2xlOwoKICB2YXIgcDF4ID0gTWF0aC5zaW4oc3RhcnRBbmdsZSAqIDIgKiBNYXRoLlBJKSAqIHNlbGYuUkFESVVTX0lOTkVSOwogIHZhciBwMXkgPSBNYXRoLmNvcyhzdGFydEFuZ2xlICogMiAqIE1hdGguUEkpICogc2VsZi5SQURJVVNfSU5ORVI7CiAgdmFyIHAyeCA9IE1hdGguc2luKGVuZEFuZ2xlICAgKiAyICogTWF0aC5QSSkgKiBzZWxmLlJBRElVU19JTk5FUjsKICB2YXIgcDJ5ID0gTWF0aC5jb3MoZW5kQW5nbGUgICAqIDIgKiBNYXRoLlBJKSAqIHNlbGYuUkFESVVTX0lOTkVSOwogIHZhciBseCAgPSBNYXRoLnNpbihsYWJlbEFuZ2xlICogMiAqIE1hdGguUEkpICogc2VsZi5SQURJVVNfSU5ORVIgLyAxLjU7CiAgdmFyIGx5ICA9IE1hdGguY29zKGxhYmVsQW5nbGUgKiAyICogTWF0aC5QSSkgKiBzZWxmLlJBRElVU19JTk5FUiAvIDEuNTsKCiAgLy8gZm9yIGEgZnVsbCBjaXJjbGUsIGJvdGggY29vcmRpbmF0ZXMgd291bGQgYmUgaWRlbnRpY2FsLCBzbyBubyBjaXJjbGUgd291bGQgYmUgZHJhd24KICBpZihzdGFydEFuZ2xlID09IDAuNSAmJiBlbmRBbmdsZSA9PSAtMC41KQogICAgcDJ4IC09IDFFLTU7CgogIHZhciB0ZXh0ID0gJCgnPHRleHQ+JykKICAgIC5hdHRyKHsKICAgICAgJ3RleHQtYW5jaG9yJzogJ21pZGRsZScsCiAgICAgICdkb21pbmFudC1iYXNlbGluZScgOidjZW50cmFsJywKICAgICAgeDogbHgsCiAgICAgIHk6IGx5CiAgICB9KQogICAgLmh0bWwobGFiZWwpOwoKICB2YXIgcGF0aCA9ICQoJzxwYXRoPicpCiAgICAuYXR0cih7CiAgICAgIGZpbGw6IGNvbG9yLAogICAgICBkOiBzZWxmLmZvcm1hdCgnTSAlcywlcyBBICVzLCVzIDAgJXMgMSAlcywlcyBMIDAsMCB6JywgcDF4LHAxeSwgc2VsZi5SQURJVVNfSU5ORVIsc2VsZi5SQURJVVNfSU5ORVIsIGxhcmdlX2FyYywgcDJ4LHAyeSkKICAgIH0pOwoKICByZXR1cm4gcGF0aC5hZGQodGV4dCk7IC8vIGNvbmNhdCBwYXRoIGFuZCB0ZXh0Cn07Cgp3aW5kb3cucGx1Z2luLnBvcnRhbGNvdW50cy5tYWtlUmluZyA9IGZ1bmN0aW9uKHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBjb2xvcikgewogIHZhciBzZWxmID0gd2luZG93LnBsdWdpbi5wb3J0YWxjb3VudHM7CiAgdmFyIGxhcmdlX2FyYyA9IChlbmRBbmdsZSAtIHN0YXJ0QW5nbGUpID4gMC41ID8gMSA6IDA7CgogIHN0YXJ0QW5nbGUgPSAwLjUgLSBzdGFydEFuZ2xlOwogIGVuZEFuZ2xlICAgPSAwLjUgLSBlbmRBbmdsZTsKCiAgdmFyIHAxeCA9IE1hdGguc2luKHN0YXJ0QW5nbGUgKiAyICogTWF0aC5QSSkgKiBzZWxmLlJBRElVU19PVVRFUjsKICB2YXIgcDF5ID0gTWF0aC5jb3Moc3RhcnRBbmdsZSAqIDIgKiBNYXRoLlBJKSAqIHNlbGYuUkFESVVTX09VVEVSOwogIHZhciBwMnggPSBNYXRoLnNpbihlbmRBbmdsZSAgICogMiAqIE1hdGguUEkpICogc2VsZi5SQURJVVNfT1VURVI7CiAgdmFyIHAyeSA9IE1hdGguY29zKGVuZEFuZ2xlICAgKiAyICogTWF0aC5QSSkgKiBzZWxmLlJBRElVU19PVVRFUjsKICB2YXIgcDN4ID0gTWF0aC5zaW4oZW5kQW5nbGUgICAqIDIgKiBNYXRoLlBJKSAqIHNlbGYuUkFESVVTX0lOTkVSOwogIHZhciBwM3kgPSBNYXRoLmNvcyhlbmRBbmdsZSAgICogMiAqIE1hdGguUEkpICogc2VsZi5SQURJVVNfSU5ORVI7CiAgdmFyIHA0eCA9IE1hdGguc2luKHN0YXJ0QW5nbGUgKiAyICogTWF0aC5QSSkgKiBzZWxmLlJBRElVU19JTk5FUjsKICB2YXIgcDR5ID0gTWF0aC5jb3Moc3RhcnRBbmdsZSAqIDIgKiBNYXRoLlBJKSAqIHNlbGYuUkFESVVTX0lOTkVSOwoKICAvLyBmb3IgYSBmdWxsIGNpcmNsZSwgYm90aCBjb29yZGluYXRlcyB3b3VsZCBiZSBpZGVudGljYWwsIHNvIG5vIGNpcmNsZSB3b3VsZCBiZSBkcmF3bgogIGlmKHN0YXJ0QW5nbGUgPT0gMC41ICYmIGVuZEFuZ2xlID09IC0wLjUpIHsKICAgIHAyeCAtPSAxRS01OwogICAgcDN4IC09IDFFLTU7CiAgfQoKICByZXR1cm4gJCgnPHBhdGg+JykKICAgIC5hdHRyKHsKICAgICAgZmlsbDogY29sb3IsCiAgICAgIGQ6IHNlbGYuZm9ybWF0KCdNICVzLCVzICcsIHAxeCwgcDF5KQogICAgICAgKyBzZWxmLmZvcm1hdCgnQSAlcywlcyAwICVzIDEgJXMsJXMgJywgc2VsZi5SQURJVVNfT1VURVIsc2VsZi5SQURJVVNfT1VURVIsIGxhcmdlX2FyYywgcDJ4LHAyeSkKICAgICAgICsgc2VsZi5mb3JtYXQoJ0wgJXMsJXMgJywgcDN4LHAzeSkKICAgICAgICsgc2VsZi5mb3JtYXQoJ0EgJXMsJXMgMCAlcyAwICVzLCVzICcsIHNlbGYuUkFESVVTX0lOTkVSLHNlbGYuUkFESVVTX0lOTkVSLCBsYXJnZV9hcmMsIHA0eCxwNHkpCiAgICAgICArICdaJwogICAgfSk7Cn07Cgp3aW5kb3cucGx1Z2luLnBvcnRhbGNvdW50cy5mb3JtYXQgPSBmdW5jdGlvbihzdHIpIHsKICB2YXIgcmUgPSAvJXMvOwogIGZvcih2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHN0ciA9IHN0ci5yZXBsYWNlKHJlLCBhcmd1bWVudHNbaV0pOwogIH0KICByZXR1cm4gc3RyOwp9Cgp3aW5kb3cucGx1Z2luLnBvcnRhbGNvdW50cy5vblBhbmVDaGFuZ2VkID0gZnVuY3Rpb24ocGFuZSkgewogIGlmKHBhbmUgPT0gJ3BsdWdpbi1wb3J0YWxjb3VudHMnKQogICAgd2luZG93LnBsdWdpbi5wb3J0YWxjb3VudHMuZ2V0UG9ydGFscygpOwogIGVsc2UKICAgICQoJyNwb3J0YWxjb3VudHMnKS5yZW1vdmUoKQp9OwoKdmFyIHNldHVwID0gIGZ1bmN0aW9uKCkgewogIGlmKHdpbmRvdy51c2VBbmRyb2lkUGFuZXMoKSkgewogICAgYW5kcm9pZC5hZGRQYW5lKCdwbHVnaW4tcG9ydGFsY291bnRzJywgJ1BvcnRhbCBjb3VudHMnLCAnaWNfYWN0aW9uX2RhdGFfdXNhZ2UnKTsKICAgIGFkZEhvb2soJ3BhbmVDaGFuZ2VkJywgd2luZG93LnBsdWdpbi5wb3J0YWxjb3VudHMub25QYW5lQ2hhbmdlZCk7CiAgfSBlbHNlIHsKICAgICQoJyN0b29sYm94JykuYXBwZW5kKCcgPGEgb25jbGljaz0id2luZG93LnBsdWdpbi5wb3J0YWxjb3VudHMuZ2V0UG9ydGFscygpIiB0aXRsZT0iRGlzcGxheSBhIHN1bW1hcnkgb2YgcG9ydGFscyBpbiB0aGUgY3VycmVudCB2aWV3Ij5Qb3J0YWwgY291bnRzPC9hPicpOwogIH0KCiAgJCgnaGVhZCcpLmFwcGVuZCgnPHN0eWxlPicgKwogICAgJyNwb3J0YWxjb3VudHMubW9iaWxlIHtiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsgYm9yZGVyOiAwIG5vbmUgIWltcG9ydGFudDsgaGVpZ2h0OiAxMDAlICFpbXBvcnRhbnQ7IHdpZHRoOiAxMDAlICFpbXBvcnRhbnQ7IGxlZnQ6IDAgIWltcG9ydGFudDsgdG9wOiAwICFpbXBvcnRhbnQ7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgb3ZlcmZsb3c6IGF1dG87IHotaW5kZXg6IDkwMDAgIWltcG9ydGFudDsgfScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUge21hcmdpbi10b3A6NXB4OyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyBlbXB0eS1jZWxsczogc2hvdzsgd2lkdGg6MTAwJTsgY2xlYXI6IGJvdGg7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQsICNwb3J0YWxjb3VudHMgdGFibGUgdGgge2JvcmRlci1ib3R0b206IDFweCBzb2xpZCAjMGIzMTRlOyBwYWRkaW5nOjNweDsgY29sb3I6d2hpdGU7IGJhY2tncm91bmQtY29sb3I6IzFiNDE1ZX0nICsKICAgICcjcG9ydGFsY291bnRzIHRhYmxlIHRyLnJlcyB0aCB7ICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDA1Njg0OyB9JyArCiAgICAnI3BvcnRhbGNvdW50cyB0YWJsZSB0ci5lbmwgdGggeyAgYmFja2dyb3VuZC1jb2xvcjogIzAxN2YwMTsgfScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGggeyB0ZXh0LWFsaWduOiBjZW50ZXI7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQgeyB0ZXh0LWFsaWduOiBjZW50ZXI7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQuTDAgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwMDAwICFpbXBvcnRhbnQ7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQuTDEgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjRkVDRTVBICFpbXBvcnRhbnQ7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQuTDIgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZBNjMwICFpbXBvcnRhbnQ7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQuTDMgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjRkY3MzE1ICFpbXBvcnRhbnQ7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQuTDQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjRTQwMDAwICFpbXBvcnRhbnQ7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQuTDUgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjRkQyOTkyICFpbXBvcnRhbnQ7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQuTDYgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjRUIyNkNEICFpbXBvcnRhbnQ7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQuTDcgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjQzEyNEUwICFpbXBvcnRhbnQ7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQuTDggeyBiYWNrZ3JvdW5kLWNvbG9yOiAjOTYyN0Y0ICFpbXBvcnRhbnQ7fScgKwogICAgJyNwb3J0YWxjb3VudHMgdGFibGUgdGQ6bnRoLWNoaWxkKDEpIHsgdGV4dC1hbGlnbjogbGVmdDt9JyArCiAgICAnI3BvcnRhbGNvdW50cyB0YWJsZSB0aDpudGgtY2hpbGQoMSkgeyB0ZXh0LWFsaWduOiBsZWZ0O30nICsKICAgICc8L3N0eWxlPicpOwp9CgovLyBQTFVHSU4gRU5EIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgpzZXR1cC5pbmZvID0gcGx1Z2luX2luZm87IC8vYWRkIHRoZSBzY3JpcHQgaW5mbyBkYXRhIHRvIHRoZSBmdW5jdGlvbiBhcyBhIHByb3BlcnR5CmlmKCF3aW5kb3cuYm9vdFBsdWdpbnMpIHdpbmRvdy5ib290UGx1Z2lucyA9IFtdOwp3aW5kb3cuYm9vdFBsdWdpbnMucHVzaChzZXR1cCk7Ci8vIGlmIElJVEMgaGFzIGFscmVhZHkgYm9vdGVkLCBpbW1lZGlhdGVseSBydW4gdGhlICdzZXR1cCcgZnVuY3Rpb24KaWYod2luZG93LmlpdGNMb2FkZWQgJiYgdHlwZW9mIHNldHVwID09PSAnZnVuY3Rpb24nKSBzZXR1cCgpOwp9IC8vIHdyYXBwZXIgZW5kCi8vIGluamVjdCBjb2RlIGludG8gc2l0ZSBjb250ZXh0CnZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKdmFyIGluZm8gPSB7fTsKaWYgKHR5cGVvZiBHTV9pbmZvICE9PSAndW5kZWZpbmVkJyAmJiBHTV9pbmZvICYmIEdNX2luZm8uc2NyaXB0KSBpbmZvLnNjcmlwdCA9IHsgdmVyc2lvbjogR01faW5mby5zY3JpcHQudmVyc2lvbiwgbmFtZTogR01faW5mby5zY3JpcHQubmFtZSwgZGVzY3JpcHRpb246IEdNX2luZm8uc2NyaXB0LmRlc2NyaXB0aW9uIH07CnNjcmlwdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnKCcrIHdyYXBwZXIgKycpKCcrSlNPTi5zdHJpbmdpZnkoaW5mbykrJyk7JykpOwooZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCgo="},{"name":"IITC plugin: Keys","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1480919349898,"data":{}},"enabled":true,"position":10,"file_url":"https://static.iitc.me/build/release/plugins/keys.user.js","uuid":"0a589b83-309a-4bc5-9496-82b8b51007d0","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLWtleXNAeGVsaW8KLy8gQG5hbWUgICAgICAgICAgIElJVEMgcGx1Z2luOiBLZXlzCi8vIEBjYXRlZ29yeSAgICAgICBLZXlzCi8vIEB2ZXJzaW9uICAgICAgICAwLjMuMC4yMDE2MTAwMy40NzQwCi8vIEBuYW1lc3BhY2UgICAgICBodHRwczovL2dpdGh1Yi5jb20vam9uYXRraW5zL2luZ3Jlc3MtaW50ZWwtdG90YWwtY29udmVyc2lvbgovLyBAdXBkYXRlVVJMICAgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3BsdWdpbnMva2V5cy5tZXRhLmpzCi8vIEBkb3dubG9hZFVSTCAgICBodHRwczovL3N0YXRpYy5paXRjLm1lL2J1aWxkL3JlbGVhc2UvcGx1Z2lucy9rZXlzLnVzZXIuanMKLy8gQGRlc2NyaXB0aW9uICAgIFtpaXRjLTIwMTYtMTAtMDMtMDA0NzQwXSBBbGxvdyBtYW51YWwgZW50cnkgb2Yga2V5IGNvdW50cyBmb3IgZWFjaCBwb3J0YWwuIFVzZSB0aGUgJ2tleXMtb24tbWFwJyBwbHVnaW4gdG8gc2hvdyB0aGUgbnVtYmVycyBvbiB0aGUgbWFwLCBhbmQgJ3N5bmMnIHRvIHNoYXJlIGJldHdlZW4gbXVsdGlwbGUgYnJvd3NlcnMgb3IgZGVza3RvcC9tb2JpbGUuCi8vIEBpbmNsdWRlICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQG1hdGNoICAgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQG1hdGNoICAgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBtYXRjaCAgICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBtYXRjaCAgICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQGdyYW50ICAgICAgICAgIG5vbmUKLy8gPT0vVXNlclNjcmlwdD09CgoKZnVuY3Rpb24gd3JhcHBlcihwbHVnaW5faW5mbykgewovLyBlbnN1cmUgcGx1Z2luIGZyYW1ld29yayBpcyB0aGVyZSwgZXZlbiBpZiBpaXRjIGlzIG5vdCB5ZXQgbG9hZGVkCmlmKHR5cGVvZiB3aW5kb3cucGx1Z2luICE9PSAnZnVuY3Rpb24nKSB3aW5kb3cucGx1Z2luID0gZnVuY3Rpb24oKSB7fTsKCi8vUExVR0lOIEFVVEhPUlM6IHdyaXRpbmcgYSBwbHVnaW4gb3V0c2lkZSBvZiB0aGUgSUlUQyBidWlsZCBlbnZpcm9ubWVudD8gaWYgc28sIGRlbGV0ZSB0aGVzZSBsaW5lcyEhCi8vKGxlYXZpbmcgdGhlbSBpbiBwbGFjZSBtaWdodCBicmVhayB0aGUgJ0Fib3V0IElJVEMnIHBhZ2Ugb3IgYnJlYWsgdXBkYXRlIGNoZWNrcykKcGx1Z2luX2luZm8uYnVpbGROYW1lID0gJ2lpdGMnOwpwbHVnaW5faW5mby5kYXRlVGltZVZlcnNpb24gPSAnMjAxNjEwMDMuNDc0MCc7CnBsdWdpbl9pbmZvLnBsdWdpbklkID0gJ2tleXMnOwovL0VORCBQTFVHSU4gQVVUSE9SUyBOT1RFCgoKCi8vIFBMVUdJTiBTVEFSVCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLy8gdXNlIG93biBuYW1lc3BhY2UgZm9yIHBsdWdpbgp3aW5kb3cucGx1Z2luLmtleXMgPSBmdW5jdGlvbigpIHt9OwoKLy8gZGVsYXkgaW4gbXMKd2luZG93LnBsdWdpbi5rZXlzLlNZTkNfREVMQVkgPSA1MDAwOwoKd2luZG93LnBsdWdpbi5rZXlzLkxPQ0FMX1NUT1JBR0VfS0VZID0gJ3BsdWdpbi1rZXlzLWRhdGEnOwoKd2luZG93LnBsdWdpbi5rZXlzLktFWSA9IHtrZXk6ICdwbHVnaW4ta2V5cy1kYXRhJywgZmllbGQ6ICdrZXlzJ307CndpbmRvdy5wbHVnaW4ua2V5cy5VUERBVEVfUVVFVUUgPSB7a2V5OiAncGx1Z2luLWtleXMtZGF0YS1xdWV1ZScsIGZpZWxkOiAndXBkYXRlUXVldWUnfTsKd2luZG93LnBsdWdpbi5rZXlzLlVQREFUSU5HX1FVRVVFID0ge2tleTogJ3BsdWdpbi1rZXlzLWRhdGEtdXBkYXRpbmctcXVldWUnLCBmaWVsZDogJ3VwZGF0aW5nUXVldWUnfTsKCndpbmRvdy5wbHVnaW4ua2V5cy5rZXlzID0ge307CndpbmRvdy5wbHVnaW4ua2V5cy51cGRhdGVRdWV1ZSA9IHt9Owp3aW5kb3cucGx1Z2luLmtleXMudXBkYXRpbmdRdWV1ZSA9IHt9OwoKd2luZG93LnBsdWdpbi5rZXlzLmVuYWJsZVN5bmMgPSBmYWxzZTsKCndpbmRvdy5wbHVnaW4ua2V5cy5kaXNhYmxlZE1lc3NhZ2UgPSBudWxsOwp3aW5kb3cucGx1Z2luLmtleXMuY29udGVudEhUTUwgPSBudWxsOwoKd2luZG93LnBsdWdpbi5rZXlzLmFkZFRvU2lkZWJhciA9IGZ1bmN0aW9uKCkgewogIGlmKHR5cGVvZihTdG9yYWdlKSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICQoJyNwb3J0YWxkZXRhaWxzID4gLmltZ3ByZXZpZXcnKS5hZnRlcihwbHVnaW4ua2V5cy5kaXNhYmxlZE1lc3NhZ2UpOwogICAgcmV0dXJuOwogIH0KCiAgJCgnI3BvcnRhbGRldGFpbHMgPiAuaW1ncHJldmlldycpLmFmdGVyKHBsdWdpbi5rZXlzLmNvbnRlbnRIVE1MKTsKICBwbHVnaW4ua2V5cy51cGRhdGVEaXNwbGF5Q291bnQoKTsKfQoKd2luZG93LnBsdWdpbi5rZXlzLnVwZGF0ZURpc3BsYXlDb3VudCA9IGZ1bmN0aW9uKCkgewogIHZhciBndWlkID0gd2luZG93LnNlbGVjdGVkUG9ydGFsOwogIHZhciBjb3VudCA9IHBsdWdpbi5rZXlzLmtleXNbZ3VpZF0gfHwgMDsKICAkKCcja2V5cy1jb3VudCcpLmh0bWwoY291bnQpOwp9Cgp3aW5kb3cucGx1Z2luLmtleXMuYWRkS2V5ID0gZnVuY3Rpb24oYWRkQ291bnQsIGd1aWQpIHsKICBpZihndWlkID09IHVuZGVmaW5lZCkgZ3VpZCA9IHdpbmRvdy5zZWxlY3RlZFBvcnRhbDsKCiAgdmFyIG9sZENvdW50ID0gcGx1Z2luLmtleXMua2V5c1tndWlkXTsKICB2YXIgbmV3Q291bnQgPSBNYXRoLm1heCgob2xkQ291bnQgfHwgMCkgKyBhZGRDb3VudCwgMCk7CiAgaWYob2xkQ291bnQgIT09IG5ld0NvdW50KSB7CiAgICBpZihuZXdDb3VudCA9PT0gMCkgewogICAgICBkZWxldGUgcGx1Z2luLmtleXMua2V5c1tndWlkXTsKICAgICAgcGx1Z2luLmtleXMudXBkYXRlUXVldWVbZ3VpZF0gPSBudWxsOwogICAgfSBlbHNlIHsKICAgICAgcGx1Z2luLmtleXMua2V5c1tndWlkXSA9IG5ld0NvdW50OwogICAgICBwbHVnaW4ua2V5cy51cGRhdGVRdWV1ZVtndWlkXSA9IG5ld0NvdW50OwogICAgfQoKICAgIHBsdWdpbi5rZXlzLnN0b3JlTG9jYWwocGx1Z2luLmtleXMuS0VZKTsKICAgIHBsdWdpbi5rZXlzLnN0b3JlTG9jYWwocGx1Z2luLmtleXMuVVBEQVRFX1FVRVVFKTsKICAgIHBsdWdpbi5rZXlzLnVwZGF0ZURpc3BsYXlDb3VudCgpOwogICAgd2luZG93LnJ1bkhvb2tzKCdwbHVnaW5LZXlzVXBkYXRlS2V5Jywge2d1aWQ6IGd1aWQsIGNvdW50OiBuZXdDb3VudH0pOwogICAgcGx1Z2luLmtleXMuZGVsYXlTeW5jKCk7CiAgfQp9CgovLyBEZWxheSB0aGUgc3luY2luZyB0byBncm91cCBhIGZldyB1cGRhdGVzIGluIGEgc2luZ2xlIHJlcXVlc3QKd2luZG93LnBsdWdpbi5rZXlzLmRlbGF5U3luYyA9IGZ1bmN0aW9uKCkgewogIGlmKCFwbHVnaW4ua2V5cy5lbmFibGVTeW5jKSByZXR1cm47CiAgY2xlYXJUaW1lb3V0KHBsdWdpbi5rZXlzLmRlbGF5U3luYy50aW1lcik7CiAgcGx1Z2luLmtleXMuZGVsYXlTeW5jLnRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgcGx1Z2luLmtleXMuZGVsYXlTeW5jLnRpbWVyID0gbnVsbDsKICAgICAgd2luZG93LnBsdWdpbi5rZXlzLnN5bmNOb3coKTsKICAgIH0sIHBsdWdpbi5rZXlzLlNZTkNfREVMQVkpOwp9CgovLyBTdG9yZSB0aGUgdXBkYXRlUXVldWUgaW4gdXBkYXRpbmdRdWV1ZSBhbmQgdXBsb2FkCndpbmRvdy5wbHVnaW4ua2V5cy5zeW5jTm93ID0gZnVuY3Rpb24oKSB7CiAgaWYoIXBsdWdpbi5rZXlzLmVuYWJsZVN5bmMpIHJldHVybjsKICAkLmV4dGVuZChwbHVnaW4ua2V5cy51cGRhdGluZ1F1ZXVlLCBwbHVnaW4ua2V5cy51cGRhdGVRdWV1ZSk7CiAgcGx1Z2luLmtleXMudXBkYXRlUXVldWUgPSB7fTsKICBwbHVnaW4ua2V5cy5zdG9yZUxvY2FsKHBsdWdpbi5rZXlzLlVQREFUSU5HX1FVRVVFKTsKICBwbHVnaW4ua2V5cy5zdG9yZUxvY2FsKHBsdWdpbi5rZXlzLlVQREFURV9RVUVVRSk7CgogIHBsdWdpbi5zeW5jLnVwZGF0ZU1hcCgna2V5cycsICdrZXlzJywgT2JqZWN0LmtleXMocGx1Z2luLmtleXMudXBkYXRpbmdRdWV1ZSkpOwp9CgovLyBDYWxsIGFmdGVyIElJVEMgYW5kIGFsbCBwbHVnaW4gbG9hZGVkCndpbmRvdy5wbHVnaW4ua2V5cy5yZWdpc3RlckZpZWxkRm9yU3luY2luZyA9IGZ1bmN0aW9uKCkgewogIGlmKCF3aW5kb3cucGx1Z2luLnN5bmMpIHJldHVybjsKICB3aW5kb3cucGx1Z2luLnN5bmMucmVnaXN0ZXJNYXBGb3JTeW5jKCdrZXlzJywgJ2tleXMnLCB3aW5kb3cucGx1Z2luLmtleXMuc3luY0NhbGxiYWNrLCB3aW5kb3cucGx1Z2luLmtleXMuc3luY0luaXRpYWxlZCk7Cn0KCi8vIENhbGwgYWZ0ZXIgbG9jYWwgb3IgcmVtb3RlIGNoYW5nZSB1cGxvYWRlZAp3aW5kb3cucGx1Z2luLmtleXMuc3luY0NhbGxiYWNrID0gZnVuY3Rpb24ocGx1Z2luTmFtZSwgZmllbGROYW1lLCBlLCBmdWxsVXBkYXRlZCkgewogIGlmKGZpZWxkTmFtZSA9PT0gJ2tleXMnKSB7CiAgICBwbHVnaW4ua2V5cy5zdG9yZUxvY2FsKHBsdWdpbi5rZXlzLktFWSk7CiAgICAvLyBBbGwgZGF0YSBpcyByZXBsYWNlZCBpZiBvdGhlciBjbGllbnQgdXBkYXRlIHRoZSBkYXRhIGR1cmluZyB0aGlzIGNsaWVudCBvZmZsaW5lLCAKICAgIC8vIGZpcmUgJ3BsdWdpbktleXNSZWZyZXNoQWxsJyB0byBub3RpZnkgYSBmdWxsIHVwZGF0ZQogICAgaWYoZnVsbFVwZGF0ZWQpIHsKICAgICAgcGx1Z2luLmtleXMudXBkYXRlRGlzcGxheUNvdW50KCk7CiAgICAgIHdpbmRvdy5ydW5Ib29rcygncGx1Z2luS2V5c1JlZnJlc2hBbGwnKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmKCFlKSByZXR1cm47CiAgICBpZihlLmlzTG9jYWwpIHsKICAgICAgLy8gVXBkYXRlIHB1c2hlZCBzdWNjZXNzZnVsbHksIHJlbW92ZSBpdCBmcm9tIHVwZGF0aW5nUXVldWUKICAgICAgZGVsZXRlIHBsdWdpbi5rZXlzLnVwZGF0aW5nUXVldWVbZS5wcm9wZXJ0eV07CiAgICB9IGVsc2UgewogICAgICAvLyBSZW1vdGUgdXBkYXRlCiAgICAgIGRlbGV0ZSBwbHVnaW4ua2V5cy51cGRhdGVRdWV1ZVtlLnByb3BlcnR5XTsKICAgICAgcGx1Z2luLmtleXMuc3RvcmVMb2NhbChwbHVnaW4ua2V5cy5VUERBVEVfUVVFVUUpOwogICAgICBwbHVnaW4ua2V5cy51cGRhdGVEaXNwbGF5Q291bnQoKTsKICAgICAgd2luZG93LnJ1bkhvb2tzKCdwbHVnaW5LZXlzVXBkYXRlS2V5Jywge2d1aWQ6IGUucHJvcGVydHksIGNvdW50OiBwbHVnaW4ua2V5cy5rZXlzW2UucHJvcGVydHldfSk7CiAgICB9CiAgfQp9CgovLyBzeW5jaW5nIG9mIHRoZSBmaWVsZCBpcyBpbml0aWFsZWQsIHVwbG9hZCBhbGwgcXVldWVkIHVwZGF0ZQp3aW5kb3cucGx1Z2luLmtleXMuc3luY0luaXRpYWxlZCA9IGZ1bmN0aW9uKHBsdWdpbk5hbWUsIGZpZWxkTmFtZSkgewogIGlmKGZpZWxkTmFtZSA9PT0gJ2tleXMnKSB7CiAgICBwbHVnaW4ua2V5cy5lbmFibGVTeW5jID0gdHJ1ZTsKICAgIGlmKE9iamVjdC5rZXlzKHBsdWdpbi5rZXlzLnVwZGF0ZVF1ZXVlKS5sZW5ndGggPiAwKSB7CiAgICAgIHBsdWdpbi5rZXlzLmRlbGF5U3luYygpOwogICAgfQogIH0KfQoKd2luZG93LnBsdWdpbi5rZXlzLnN0b3JlTG9jYWwgPSBmdW5jdGlvbihtYXBwaW5nKSB7CiAgaWYodHlwZW9mKHBsdWdpbi5rZXlzW21hcHBpbmcuZmllbGRdKSAhPT0gJ3VuZGVmaW5lZCcgJiYgcGx1Z2luLmtleXNbbWFwcGluZy5maWVsZF0gIT09IG51bGwpIHsKICAgIGxvY2FsU3RvcmFnZVttYXBwaW5nLmtleV0gPSBKU09OLnN0cmluZ2lmeShwbHVnaW4ua2V5c1ttYXBwaW5nLmZpZWxkXSk7CiAgfSBlbHNlIHsKICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKG1hcHBpbmcua2V5KTsKICB9Cn0KCndpbmRvdy5wbHVnaW4ua2V5cy5sb2FkTG9jYWwgPSBmdW5jdGlvbihtYXBwaW5nKSB7CiAgdmFyIG9iamVjdEpTT04gPSBsb2NhbFN0b3JhZ2VbbWFwcGluZy5rZXldOwogIGlmKCFvYmplY3RKU09OKSByZXR1cm47CiAgcGx1Z2luLmtleXNbbWFwcGluZy5maWVsZF0gPSBtYXBwaW5nLmNvbnZlcnRGdW5jIAogICAgICAgICAgICAgICAgICAgICAgICAgID8gbWFwcGluZy5jb252ZXJ0RnVuYyhKU09OLnBhcnNlKG9iamVjdEpTT04pKQogICAgICAgICAgICAgICAgICAgICAgICAgIDogSlNPTi5wYXJzZShvYmplY3RKU09OKTsKfQoKLy8gRm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHksIHdpbGwgY2hhbmdlIHRvIHVzZSBsb2FkTG9jYWwgYWZ0ZXIgYSBmZXcgdmVyc2lvbgp3aW5kb3cucGx1Z2luLmtleXMubG9hZEtleXMgPSBmdW5jdGlvbigpIHsKICB2YXIga2V5c09iamVjdEpTT04gPSBsb2NhbFN0b3JhZ2VbcGx1Z2luLmtleXMuS0VZLmtleV07CiAgaWYoIWtleXNPYmplY3RKU09OKSByZXR1cm47CiAgdmFyIGtleXNPYmplY3QgPSBKU09OLnBhcnNlKGtleXNPYmplY3RKU09OKTsKICAvLyBNb3ZlIGtleXMgZGF0YSB1cCBvbmUgbGV2ZWwsIGl0IHdhcyB7a2V5czoga2V5c19kYXRhfSBpbiBsb2NhbHN0b3JhZ2UgaW4gcHJldmlvdXMgdmVyc2lvbgogIHBsdWdpbi5rZXlzLmtleXMgPSBrZXlzT2JqZWN0LmtleXMgPyBrZXlzT2JqZWN0LmtleXMgOiBrZXlzT2JqZWN0OwogIGlmKGtleXNPYmplY3Qua2V5cykgcGx1Z2luLmtleXMuc3RvcmVMb2NhbChwbHVnaW4ua2V5cy5LRVkpOwp9Cgp3aW5kb3cucGx1Z2luLmtleXMuc2V0dXBDU1MgPSBmdW5jdGlvbigpIHsKICAkKCI8c3R5bGU+IikKICAgIC5wcm9wKCJ0eXBlIiwgInRleHQvY3NzIikKICAgIC5odG1sKCIja2V5cy1jb250ZW50LW91dGVyIHtcbiAgZGlzcGxheTogdGFibGU7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDI2cHg7XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbn1cblxuI2tleXMtY29udGVudC1vdXRlciA+IGRpdntcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO1xuICBtYXJnaW46IDZweCAzcHggMXB4IDNweDtcbn1cblxuI2tleXMtbGFiZWwge1xuICBwYWRkaW5nOiAwIDRweDtcbiAgY3Vyc29yOiBoZWxwO1xufVxuXG4ja2V5cy1hZGQge1xufVxuXG4ja2V5cy1jb3VudCB7XG4gIHdpZHRoOiAyNnB4O1xuICBoZWlnaHQ6IDE4cHggIWltcG9ydGFudDtcbiAgYm9yZGVyOiAxcHggc29saWQ7XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgY3Vyc29yOiBoZWxwO1xufVxuXG4ja2V5cy1zdWJ0cmFjdCB7XG59XG5cbi5rZXlzLWJ1dHRvbiB7XG4gIHBvc2l0aW9uOnJlbGF0aXZlO1xuICB3aWR0aDogMTZweDtcbiAgaGVpZ2h0OiAxNnB4ICFpbXBvcnRhbnQ7XG59XG5cbi5rZXlzLWJ1dHRvbiA+IGRpdiB7XG4gIGJhY2tncm91bmQtY29sb3I6IHJnYigzMiwgMTY4LCAxNzcpO1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG59XG5cbi5rZXlzLWJ1dHRvbi1taW51cyB7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDRweDtcbiAgdG9wOiA2cHg7XG59XG5cbi5rZXlzLWJ1dHRvbi1wbHVzLWgge1xuICB3aWR0aDogMTAwJTtcbiAgaGVpZ2h0OiA0cHg7XG4gIHRvcDogNnB4O1xufVxuXG4ua2V5cy1idXR0b24tcGx1cy12IHtcbiAgd2lkdGg6IDRweDtcbiAgaGVpZ2h0OiAxMDAlO1xuICBsZWZ0OiA2cHg7XG59XG5cbiNrZXlzLWhlbHAge1xuICBmb250LXdlaWdodDogOTAwO1xuICBtYXJnaW46IDZweCAzcHggMXB4IDIwcHggIWltcG9ydGFudDtcbiAgY3Vyc29yOiBoZWxwO1xufVxuXG4ucG9ydGFsLWxpc3Qta2V5cyBidXR0b24ge1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xuICBmb250LXNpemU6IDAuOWVtO1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7XG4gIG1pbi13aWR0aDogMDtcbiAgcGFkZGluZzogMDtcbiAgd2lkdGg6IDEuNWVtO1xuICBtYXJnaW46IC02cHggMCAtM3B4O1xufVxuI3BvcnRhbHNsaXN0Lm1vYmlsZSAucG9ydGFsLWxpc3Qta2V5cyBidXR0b24ge1xuICB3aWR0aDogM2VtO1xuICBoZWlnaHQ6IDEuNWVtO1xufVxuLnBvcnRhbC1saXN0LWtleXMgLnBsdXMge1xuICBtYXJnaW4tbGVmdDogMC4zZW07XG4gIG1hcmdpbi1yaWdodDogLTFweDtcbn1cblxuIikKICAgIC5hcHBlbmRUbygiaGVhZCIpOwp9Cgp3aW5kb3cucGx1Z2luLmtleXMuc2V0dXBDb250ZW50ID0gZnVuY3Rpb24oKSB7CiAgcGx1Z2luLmtleXMuY29udGVudEhUTUwgPSAnPGRpdiBpZD0ia2V5cy1jb250ZW50LW91dGVyIj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJzxkaXYgaWQ9ImtleXMtbGFiZWwiIHRpdGxlPSJQcm9ibGVtPyBQb2ludCB0byB0aGUgcXVlc3Rpb24gbWFyayEiPktleShzKTo8L2Rpdj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJzxkaXYgaWQ9ImtleXMtYWRkIiBjbGFzcz0ia2V5cy1idXR0b24iICcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnb25jbGljaz0id2luZG93LnBsdWdpbi5rZXlzLmFkZEtleSgtMSk7Ij4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICc8ZGl2IGNsYXNzPSJrZXlzLWJ1dHRvbi1taW51cyI+PC9kaXY+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICc8L2Rpdj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJzxkaXYgaWQ9ImtleXMtY291bnQiIHRpdGxlPSJQcm9ibGVtPyBQb2ludCB0byB0aGUgcXVlc3Rpb24gbWFyayEiPjwvZGl2PicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBpZD0ia2V5cy1zdWJ0cmFjdCIgY2xhc3M9ImtleXMtYnV0dG9uIiAnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJ29uY2xpY2s9IndpbmRvdy5wbHVnaW4ua2V5cy5hZGRLZXkoMSk7Ij4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz0ia2V5cy1idXR0b24tcGx1cy12Ij48L2Rpdj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz0ia2V5cy1idXR0b24tcGx1cy1oIj48L2Rpdj4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJzwvZGl2PicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBpZD0ia2V5cy1oZWxwIiB0aXRsZT0iWW91IE1VU1QgbWFudWFsbHkgaW5wdXQgeW91ciBjb3VudCBvZiBrZXlzIVxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICdUaGlzIHBsdWdpbiBDQU5OT1QgYXV0b21hdGljYWxseSBnZXQgdGhlIGtleXMgZnJvbSBJbmdyZXNzISI+PzwvZGl2PicKICAgICAgICAgICAgICAgICAgICAgICAgICArICc8L2Rpdj4nOwogIHBsdWdpbi5rZXlzLmRpc2FibGVkTWVzc2FnZSA9ICc8ZGl2IGlkPSJrZXlzLWNvbnRlbnQtb3V0ZXIiIHRpdGxlPSJZb3VyIGJyb3dzZXIgZG8gbm90IHN1cHBvcnQgbG9jYWxTdG9yYWdlIj5QbHVnaW4gS2V5cyBkaXNhYmxlZDwvZGl2Pic7Cn0KCndpbmRvdy5wbHVnaW4ua2V5cy5zZXR1cFBvcnRhbHNMaXN0ID0gZnVuY3Rpb24oKSB7CiAgaWYoIXdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QpIHJldHVybjsKCiAgd2luZG93LmFkZEhvb2soJ3BsdWdpbktleXNVcGRhdGVLZXknLCBmdW5jdGlvbihkYXRhKSB7CiAgICAkKCdbZGF0YS1saXN0LWtleWNvdW50PSInK2RhdGEuZ3VpZCsnIl0nKS50ZXh0KGRhdGEuY291bnQpOwogIH0pOwoKICB3aW5kb3cuYWRkSG9vaygncGx1Z2luS2V5c1JlZnJlc2hBbGwnLCBmdW5jdGlvbigpIHsKICAgICQoJ1tkYXRhLWxpc3Qta2V5Y291bnRdJykuZWFjaChmdW5jdGlvbihpLCBlbGVtZW50KSB7CiAgICAgIHZhciBndWlkID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoImRhdGEtbGlzdC1rZXljb3VudCIpOwogICAgICAkKGVsZW1lbnQpLnRleHQocGx1Z2luLmtleXMua2V5c1tndWlkXSB8fCAwKTsKICAgIH0pOwogIH0pOwoKICB3aW5kb3cucGx1Z2luLnBvcnRhbHNsaXN0LmZpZWxkcy5wdXNoKHsKICAgIHRpdGxlOiAiS2V5cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24ocG9ydGFsKSB7IHJldHVybiBwb3J0YWwub3B0aW9ucy5ndWlkOyB9LCAvLyB3ZSBzdG9yZSB0aGUgZ3VpZCwgYnV0IGltcGxlbWVudCBhIGN1c3RvbSBjb21wYXJhdG9yIHNvIHRoZSBsaXN0IGRvZXMgc29ydCBwcm9wZXJseSB3aXRob3V0IGNsb3NpbmcgYW5kIHJlb3BlbmluZyB0aGUgZGlhbG9nCiAgICBzb3J0OiBmdW5jdGlvbihndWlkQSwgZ3VpZEIpIHsKICAgICAgdmFyIGtleXNBID0gcGx1Z2luLmtleXMua2V5c1tndWlkQV0gfHwgMDsKICAgICAgdmFyIGtleXNCID0gcGx1Z2luLmtleXMua2V5c1tndWlkQl0gfHwgMDsKICAgICAgcmV0dXJuIGtleXNBIC0ga2V5c0I7CiAgICB9LAogICAgZm9ybWF0OiBmdW5jdGlvbihjZWxsLCBwb3J0YWwsIGd1aWQpIHsKICAgICAgJChjZWxsKQogICAgICAgIC5hZGRDbGFzcygiYWxpZ25SIHBvcnRhbC1saXN0LWtleXMgdWktZGlhbG9nLWJ1dHRvbnNldCIpIC8vIHVpLWRpYWxvZy1idXR0b25zZXQgZm9yIHByb3BlciBidXR0b24gc3R5bGVzCiAgICAgICAgLmFwcGVuZCgkKCc8c3Bhbj4nKQogICAgICAgICAgLnRleHQocGx1Z2luLmtleXMua2V5c1tndWlkXSB8fCAwKQogICAgICAgICAgLmF0dHIoewogICAgICAgICAgICAiY2xhc3MiOiAidmFsdWUiLAogICAgICAgICAgICAiZGF0YS1saXN0LWtleWNvdW50IjogZ3VpZAogICAgICAgICAgfSkpOwogICAgICAvLyBmb3Igc29tZSByZWFzb24sIGpRdWVyeSByZW1vdmVzIGV2ZW50IGxpc3RlbmVycyB3aGVuIHRoZSBsaXN0IGlzIHNvcnRlZC4gVGhlcmVmb3JlIHdlIHVzZSBET00ncyBhZGRFdmVudExpc3RlbmVyCiAgICAgICQoJzxidXR0b24+JykKICAgICAgICAudGV4dCgnKycpCiAgICAgICAgLmFkZENsYXNzKCJwbHVzIikKICAgICAgICAuYXBwZW5kVG8oY2VsbCkKICAgICAgICBbMF0uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbigpIHsgd2luZG93LnBsdWdpbi5rZXlzLmFkZEtleSgxLCBndWlkKTsgfSwgZmFsc2UpOwogICAgICAkKCc8YnV0dG9uPicpCiAgICAgICAgLnRleHQoJy0nKQogICAgICAgIC5hZGRDbGFzcygibWludXMiKQogICAgICAgIC5hcHBlbmRUbyhjZWxsKQogICAgICAgIFswXS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKCkgeyB3aW5kb3cucGx1Z2luLmtleXMuYWRkS2V5KC0xLCBndWlkKTsgfSwgZmFsc2UpOwogICAgfSwKICB9KTsKfQoKdmFyIHNldHVwID0gIGZ1bmN0aW9uKCkgewogIGlmKCQuaW5BcnJheSgncGx1Z2luS2V5c1VwZGF0ZUtleScsIHdpbmRvdy5WQUxJRF9IT09LUykgPCAwKQogICAgd2luZG93LlZBTElEX0hPT0tTLnB1c2goJ3BsdWdpbktleXNVcGRhdGVLZXknKTsKICBpZigkLmluQXJyYXkoJ3BsdWdpbktleXNSZWZyZXNoQWxsJywgd2luZG93LlZBTElEX0hPT0tTKSA8IDApCiAgICB3aW5kb3cuVkFMSURfSE9PS1MucHVzaCgncGx1Z2luS2V5c1JlZnJlc2hBbGwnKTsKCiAgd2luZG93LnBsdWdpbi5rZXlzLnNldHVwQ1NTKCk7CiAgd2luZG93LnBsdWdpbi5rZXlzLnNldHVwQ29udGVudCgpOwogIHdpbmRvdy5wbHVnaW4ua2V5cy5sb2FkTG9jYWwocGx1Z2luLmtleXMuVVBEQVRFX1FVRVVFKTsKICB3aW5kb3cucGx1Z2luLmtleXMubG9hZEtleXMoKTsKICB3aW5kb3cuYWRkSG9vaygncG9ydGFsRGV0YWlsc1VwZGF0ZWQnLCB3aW5kb3cucGx1Z2luLmtleXMuYWRkVG9TaWRlYmFyKTsKICB3aW5kb3cuYWRkSG9vaygnaWl0Y0xvYWRlZCcsIHdpbmRvdy5wbHVnaW4ua2V5cy5yZWdpc3RlckZpZWxkRm9yU3luY2luZyk7CgogIGlmKHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QpIHsKICAgIHdpbmRvdy5wbHVnaW4ua2V5cy5zZXR1cFBvcnRhbHNMaXN0KCk7CiAgfSBlbHNlIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgIGlmKHdpbmRvdy5wbHVnaW4ucG9ydGFsc2xpc3QpCiAgICAgICAgd2luZG93LnBsdWdpbi5rZXlzLnNldHVwUG9ydGFsc0xpc3QoKTsKICAgIH0sIDUwMCk7CiAgfQp9CgovLyBQTFVHSU4gRU5EIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgpzZXR1cC5pbmZvID0gcGx1Z2luX2luZm87IC8vYWRkIHRoZSBzY3JpcHQgaW5mbyBkYXRhIHRvIHRoZSBmdW5jdGlvbiBhcyBhIHByb3BlcnR5CmlmKCF3aW5kb3cuYm9vdFBsdWdpbnMpIHdpbmRvdy5ib290UGx1Z2lucyA9IFtdOwp3aW5kb3cuYm9vdFBsdWdpbnMucHVzaChzZXR1cCk7Ci8vIGlmIElJVEMgaGFzIGFscmVhZHkgYm9vdGVkLCBpbW1lZGlhdGVseSBydW4gdGhlICdzZXR1cCcgZnVuY3Rpb24KaWYod2luZG93LmlpdGNMb2FkZWQgJiYgdHlwZW9mIHNldHVwID09PSAnZnVuY3Rpb24nKSBzZXR1cCgpOwp9IC8vIHdyYXBwZXIgZW5kCi8vIGluamVjdCBjb2RlIGludG8gc2l0ZSBjb250ZXh0CnZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKdmFyIGluZm8gPSB7fTsKaWYgKHR5cGVvZiBHTV9pbmZvICE9PSAndW5kZWZpbmVkJyAmJiBHTV9pbmZvICYmIEdNX2luZm8uc2NyaXB0KSBpbmZvLnNjcmlwdCA9IHsgdmVyc2lvbjogR01faW5mby5zY3JpcHQudmVyc2lvbiwgbmFtZTogR01faW5mby5zY3JpcHQubmFtZSwgZGVzY3JpcHRpb246IEdNX2luZm8uc2NyaXB0LmRlc2NyaXB0aW9uIH07CnNjcmlwdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnKCcrIHdyYXBwZXIgKycpKCcrSlNPTi5zdHJpbmdpZnkoaW5mbykrJyk7JykpOwooZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCgo="},{"name":"IITC plugin: Show farms by level","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1480919467846,"data":{}},"enabled":true,"position":11,"file_url":"https://static.iitc.me/build/release/plugins/layer-farms-find.user.js","uuid":"6b157a1d-b0f2-43bb-85ee-700542d86024","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLWZhcm1zQDk0OQovLyBAbmFtZSAgICAgICAgICAgSUlUQyBwbHVnaW46IFNob3cgZmFybXMgYnkgbGV2ZWwKLy8gQGNhdGVnb3J5ICAgICAgIEluZm8KLy8gQHZlcnNpb24gICAgICAgIDEuNC4xLjIwMTYxMDAzLjQ3NDAKLy8gQG5hbWVzcGFjZSAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9qb25hdGtpbnMvaW5ncmVzcy1pbnRlbC10b3RhbC1jb252ZXJzaW9uCi8vIEB1cGRhdGVVUkwgICAgICBodHRwczovL3N0YXRpYy5paXRjLm1lL2J1aWxkL3JlbGVhc2UvcGx1Z2lucy9sYXllci1mYXJtcy1maW5kLm1ldGEuanMKLy8gQGRvd25sb2FkVVJMICAgIGh0dHBzOi8vc3RhdGljLmlpdGMubWUvYnVpbGQvcmVsZWFzZS9wbHVnaW5zL2xheWVyLWZhcm1zLWZpbmQudXNlci5qcwovLyBAZGVzY3JpcHRpb24gICAgW2lpdGMtMjAxNi0xMC0wMy0wMDQ3NDBdIEZpbmQgZmFybXMgYnkgbWluaW11bSBsZXZlbC4KLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBpbmNsdWRlICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAZ3JhbnQgICAgICAgICAgbm9uZQovLyA9PS9Vc2VyU2NyaXB0PT0KCi8vQ0hBTkdFTE9HCi8qCnYxLjMuMApBZGRlZCBtb2JpbGUgc3VwcG9ydAoKdjEuMi4xCkZpeGVkIGRyb3Bkb3duIGxvY2F0aW9uIG92ZXJsYXAKCnYxLjIuMApDaXJjbGUgaXMgc2VudCB0byBiYWNrIG9uIG1vdXNlb3ZlcgpDbGlja2luZyBvbiBjaXJjbGUgZGlzcGxheXMgcG9ydGFsIGNvdW50cyBmb3IgZmFybSAoaW5jbHVkaW5nIHBvcnRhbHMgb2YgbGV2ZWwgbG93ZXIgdGhhbiBmYXJtKQoKdjEuMS4yCkZpeGVkIHRoZSBwb3J0YWwgY291bnRzIChzaG93biBpbiBjb25zb2xlKQoKdjEuMS4xCkNoYW5nZWQgY2lyY2xlIHN0cm9rZSB3ZWlnaHQgYW5kIG9wYWNpdHksIG1ha2luZyBpdCBlYXNpZXIgdG8gc2VlIHdoZW4gem9vbWVkIG91dC4KCnYxLjEuMApDaGFuZ2VkIHJhZGl1cyBmdW5jdGlvbiBhbmQgY2VudGVyIGZ1bmN0aW9uIC0gCkNlbnRlciBpcyBub3cgdGhlIG1pZHBvaW50IG9mIHRoZSBtYXggYW5kIG1pbiBsb25nIGFuZCBsYXQgY29vcmRzClJhZGl1cyBpcyBkaXN0YW5jZSBmcm9tIGNlbnRlciB0byBmdXJ0aGVzdCBwb3J0YWwgKGkuZS4sIG5vdyB0aGUgY2lyY2xlIHdpbGwgYmUgbGltaXRlZCB0byBwb3J0YWxzIGluIHRoZSBmYXJtKQoKKi8KCgoKCmZ1bmN0aW9uIHdyYXBwZXIocGx1Z2luX2luZm8pIHsKLy8gZW5zdXJlIHBsdWdpbiBmcmFtZXdvcmsgaXMgdGhlcmUsIGV2ZW4gaWYgaWl0YyBpcyBub3QgeWV0IGxvYWRlZAppZih0eXBlb2Ygd2luZG93LnBsdWdpbiAhPT0gJ2Z1bmN0aW9uJykgd2luZG93LnBsdWdpbiA9IGZ1bmN0aW9uKCkge307CgovL1BMVUdJTiBBVVRIT1JTOiB3cml0aW5nIGEgcGx1Z2luIG91dHNpZGUgb2YgdGhlIElJVEMgYnVpbGQgZW52aXJvbm1lbnQ/IGlmIHNvLCBkZWxldGUgdGhlc2UgbGluZXMhIQovLyhsZWF2aW5nIHRoZW0gaW4gcGxhY2UgbWlnaHQgYnJlYWsgdGhlICdBYm91dCBJSVRDJyBwYWdlIG9yIGJyZWFrIHVwZGF0ZSBjaGVja3MpCnBsdWdpbl9pbmZvLmJ1aWxkTmFtZSA9ICdpaXRjJzsKcGx1Z2luX2luZm8uZGF0ZVRpbWVWZXJzaW9uID0gJzIwMTYxMDAzLjQ3NDAnOwpwbHVnaW5faW5mby5wbHVnaW5JZCA9ICdsYXllci1mYXJtcy1maW5kJzsKLy9FTkQgUExVR0lOIEFVVEhPUlMgTk9URQoKCgovLyBQTFVHSU4gU1RBUlQgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgovLyB1c2Ugb3duIG5hbWVzcGFjZSBmb3IgcGx1Z2luCndpbmRvdy5wbHVnaW4uZmFybUZpbmQgPSBmdW5jdGlvbigpIHt9OwoKd2luZG93LnBsdWdpbi5mYXJtRmluZC5nZXROZWFyYnlQb3J0YWxDb3VudCA9IGZ1bmN0aW9uKHBvcnRhbCl7CiAgICAKICAgIHZhciBjaXJjbGUgPSBuZXcgZ29vZ2xlLm1hcHMuQ2lyY2xlKCk7CiAgICB2YXIgY2VudGVyID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhwb3J0YWwuZ2V0TGF0TG5nKCkubGF0LCBwb3J0YWwuZ2V0TGF0TG5nKCkubG5nKTsKICAgIGNpcmNsZS5zZXRDZW50ZXIoY2VudGVyKTsKICAgIGNpcmNsZS5zZXRSYWRpdXMod2luZG93LnBsdWdpbi5mYXJtRmluZC5SYWRpdXMpOwoKICAgIAogICAgdmFyIG5lYXJieThQb3J0YWxzID0gMDsKICAgIAogICAgJC5lYWNoKHdpbmRvdy5wb3J0YWxzLCBmdW5jdGlvbihpLCBvdGhlclBvcnRhbCkgewogICAgICAgIHZhciB0aGlzUG9ydGFsID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhvdGhlclBvcnRhbC5nZXRMYXRMbmcoKS5sYXQsIG90aGVyUG9ydGFsLmdldExhdExuZygpLmxuZyk7CiAgICAgIAkgaWYgKGNpcmNsZS5nZXRCb3VuZHMoKS5jb250YWlucyh0aGlzUG9ydGFsKSkKICAgICAgICAgICAgIGlmIChvdGhlclBvcnRhbC5vcHRpb25zLmxldmVsID49IHdpbmRvdy5wbHVnaW4uZmFybUZpbmQubWluTGV2ZWwpIG5lYXJieThQb3J0YWxzKys7CiAgICB9KTsKICAgIC8vY29uc29sZS5sb2cobmVhcmJ5OFBvcnRhbHMpOyAgICAgICAgIAogICAgcmV0dXJuIG5lYXJieThQb3J0YWxzOwp9OwoKd2luZG93LnBsdWdpbi5mYXJtRmluZC5jaGVja1BvcnRhbHMgPSBmdW5jdGlvbigpewogICAgcG9zc2libGVGYXJtUG9ydGFscyA9IFtdOwogICAgd2luZG93LnBsdWdpbi5mYXJtRmluZC5sZXZlbExheWVyR3JvdXAuY2xlYXJMYXllcnMoKTsKICAgIC8vY29uc29sZS5sb2cod2luZG93LnBvcnRhbHMubGVuZ3RoKTsKCSQuZWFjaCh3aW5kb3cucG9ydGFscywgZnVuY3Rpb24oaSwgcG9ydGFsKSB7CiAgICAgICAgCgkJaWYgKHdpbmRvdy5wbHVnaW4uZmFybUZpbmQuZ2V0TmVhcmJ5UG9ydGFsQ291bnQocG9ydGFsKSA+IHdpbmRvdy5wbHVnaW4uZmFybUZpbmQubWluTmVhcmJ5KQogICAgICAgIHsKICAgICAgICAgCS8vY29uc29sZS5sb2coIkZhcm0gaWRlbnRpZmllZCIpOwogICAgICAgICAgICBwb3NzaWJsZUZhcm1Qb3J0YWxzLnB1c2gocG9ydGFsKTsKICAgICAgICB9Cgl9KTsKICAgIGNvbnNvbGUubG9nKCJGYXJtIFBvcnRhbHM6ICIgKyBwb3NzaWJsZUZhcm1Qb3J0YWxzLmxlbmd0aCk7CiAgICB2YXIgZmFybXMgPSBbXTsKICAgIGZvciAoaSA9IDA7IGk8IHBvc3NpYmxlRmFybVBvcnRhbHMubGVuZ3RoO2krKykKICAgIHsKICAgICAgICAvL2NvbnNvbGUubG9nKCJDaGVja2luZyBwb3J0YWwgIiArIGkpOwogICAgIAl2YXIgdGhpc1BvcnRhbCA9IHBvc3NpYmxlRmFybVBvcnRhbHNbaV07CiAgICAgICAgdmFyIGFscmVhZHlJbkZhcm0gPSBmYWxzZTsKICAgICAgICBmb3IgKHggPSAwOyB4PCBmYXJtcy5sZW5ndGg7eCsrKQogICAgICAgIHsKICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhhbHJlYWR5SW5GYXJtKTsKICAgICAgICAgCWlmICh0aGlzUG9ydGFsIGluIGZhcm1zW3hdKSBhbHJlYWR5SW5GYXJtID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy9jb25zb2xlLmxvZygiUG9ydGFsICIgKyBpICsgIiBhbHJlYWR5IGluIGZhcm06ICIgKyBhbHJlYWR5SW5GYXJtKTsKICAgICAgICAKICAgICAgICBpZiAoIWFscmVhZHlJbkZhcm0pCiAgICAgICAgewogICAgICAgICAgICB2YXIgcG9ydGFsc0luRmFybSA9IFtdOwogICAgICAgIAl2YXIgY2lyY2xlID0gbmV3IGdvb2dsZS5tYXBzLkNpcmNsZSgpOwogICAgCQl2YXIgY2VudGVyID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyh0aGlzUG9ydGFsLmdldExhdExuZygpLmxhdCwgdGhpc1BvcnRhbC5nZXRMYXRMbmcoKS5sbmcpOwogICAgCQljaXJjbGUuc2V0Q2VudGVyKGNlbnRlcik7CiAgICAJCWNpcmNsZS5zZXRSYWRpdXMod2luZG93LnBsdWdpbi5mYXJtRmluZC5SYWRpdXMpOwogICAgICAgICAgICBwb3J0YWxzSW5GYXJtLnB1c2godGhpc1BvcnRhbCk7CiAgICAgICAgICAgIGZvciAocCA9IDA7IHA8IHBvc3NpYmxlRmFybVBvcnRhbHMubGVuZ3RoO3ArKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiQ2hlY2tpbmcgZGlzdGFuY2UgZnJvbSBwb3J0YWwgIiArIHApOwogICAgICAgICAgICAgICAgdmFyIHBvcnRhbExvYyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocG9zc2libGVGYXJtUG9ydGFsc1twXS5nZXRMYXRMbmcoKS5sYXQsIHBvc3NpYmxlRmFybVBvcnRhbHNbcF0uZ2V0TGF0TG5nKCkubG5nKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGZhcm1JbmRleCA9IDA7CiAgICAgICAgICAgICAJaWYgKGNpcmNsZS5nZXRCb3VuZHMoKS5jb250YWlucyhwb3J0YWxMb2MpICYmIHBvc3NpYmxlRmFybVBvcnRhbHNbcF0gIT0gdGhpc1BvcnRhbCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYWxyZWFkeUluQW5vdGhlckZhcm0gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHggPSAwOyB4PCBmYXJtcy5sZW5ndGg7eCsrKQogICAgICAgIAkJCXsKICAgICAgICAgICAgCQkJLy9jb25zb2xlLmxvZyhhbHJlYWR5SW5GYXJtKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChvID0gMDsgbzwgZmFybXNbeF0ubGVuZ3RoOyBvKyspCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3NzaWJsZUZhcm1Qb3J0YWxzW3BdID09IGZhcm1zW3hdW29dKQogICAgICAgICAgICAgICAgICAgICAgICAJewogICAgICAgICAgICAgICAgICAgICAgICAgICAgCS8vY29uc29sZS5sb2coIlBvcnRhbCAiICsgcCArICIgaW4gZmFybSAiICsgKHgrMSkgKyAiIGF0IGluZGV4ICIgKyBvKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAlhbHJlYWR5SW5Bbm90aGVyRmFybSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIAkJZmFybUluZGV4ID0geDsKICAgICAgICAgICAgICAgICAgICAgICAgCX0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAJCQkJCiAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgCQkJfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIkFscmVhZHkgaW4gYW5vdGhlciBmYXJtOiAiICsgYWxyZWFkeUluQW5vdGhlckZhcm0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChhbHJlYWR5SW5Bbm90aGVyRmFybSA9PSBmYWxzZSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIkZhcm0gIiArIChmYXJtcy5sZW5ndGggKyAxKSArICIgYWRkaW5nIHBvcnRhbCAiICsgcCk7CiAgICAgICAgICAgICAgICAgICAgCXBvcnRhbHNJbkZhcm0ucHVzaChwb3NzaWJsZUZhcm1Qb3J0YWxzW3BdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgCS8vaG1tbS4uLiBwb3J0YWwgaXMgaW4gcmFuZ2UsIGJ1dCBwb3J0YWwgaXMgaW4gYW5vdGhlciBmYXJtLCBzbyBsZXQncyBleHRlbmQgdGhpcyBmYXJtCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihwcnQgPSAwOyBwcnQgPCBwb3J0YWxzSW5GYXJtLmxlbmd0aDsgcHJ0KyspCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIAkgICBmYXJtc1tmYXJtSW5kZXhdLnB1c2gocG9ydGFsc0luRmFybVtwcnRdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiRmFybSAiICsgKGZhcm1JbmRleCArIDEpICsgIiBub3cgaGFzICIgKyBmYXJtc1tmYXJtSW5kZXhdLmxlbmd0aCArICIgcG9ydGFscyIpOwogICAgICAgICAgICAgICAgICAgICAgICBwID0gNjAwMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghYWxyZWFkeUluQW5vdGhlckZhcm0pCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGZhcm1zLnB1c2gocG9ydGFsc0luRmFybSk7CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJGYXJtICIgKyAoZmFybXMubGVuZ3RoKSArICI6ICIgKyBwb3J0YWxzSW5GYXJtLmxlbmd0aCArICIgcG9ydGFscyIpOwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy9jb25zb2xlLmxvZyhmYXJtcy5sZW5ndGgpOwogICAgZm9yIChpID0gMDsgaSA8IGZhcm1zLmxlbmd0aDsgaSsrKQogICAgewogICAgICAgIGZhcm1zW2ldID0gZmluZFVuaXF1ZShmYXJtc1tpXSk7CiAgICAgICAgY29uc29sZS5sb2coIkZhcm0gIiArIChpKzEpICsgIjogIiArIGZhcm1zW2ldLmxlbmd0aCArICIgcG9ydGFscyIpOwogICAgICAgIAogICAgfQogICAgLy9jb25zb2xlLmxvZyhmYXJtcyk7CiAgICAKICAgIAogICAgCiAgICB3aW5kb3cucGx1Z2luLmZhcm1GaW5kLmRyYXduSXRlbXMgPSBuZXcgTC5GZWF0dXJlR3JvdXAoKTsKICAgIAogICAgCiAgICBmb3IgKGZhcm0gPSAwOyBmYXJtIDwgZmFybXMubGVuZ3RoOyBmYXJtKyspCiAgICB7CiAgICAJd2luZG93LnBsdWdpbi5mYXJtRmluZC5kcmF3Q2lyY2xlKGZhcm1zW2Zhcm1dKTsKICAgIH0KICAgIAogICAgCn07CiAgICAKICAgIGZpbmRVbmlxdWUgPSBmdW5jdGlvbihmYXJtKSB7CiAgICAgICAgdmFyIHVuaXF1ZSA9IFtdOwogICAgICAgIGZvcihwID0gMDsgcCA8IGZhcm0ubGVuZ3RoOyBwKyspCiAgICAgICAgewogICAgICAgICAgICAvL2NvbnNvbGUubG9nKGZhcm1bcF0ub3B0aW9ucy5ndWlkKTsKICAgICAgICAJdmFyIGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAodSA9IDA7IHUgPCB1bmlxdWUubGVuZ3RoOyB1KyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2codW5pcXVlW3VdLm9wdGlvbnMuZ3VpZCk7CiAgICAgICAgICAgICAJaWYgKGZhcm1bcF0ub3B0aW9ucy5ndWlkID09IHVuaXF1ZVt1XS5vcHRpb25zLmd1aWQpCiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghZm91bmQpCiAgICAgICAgICAgICAgICB1bmlxdWUucHVzaChmYXJtW3BdKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHVuaXF1ZTsKfQogICAgCndpbmRvdy5wbHVnaW4uZmFybUZpbmQuZHJhd0NpcmNsZSA9IGZ1bmN0aW9uKGZhcm0pCnsKCXZhciBsYXRBcnJheSA9IFtdOwoJdmFyIGxuZ0FycmF5ID0gW107CiAgICB2YXIgY291bnRBcnJheSA9IFtdOwoJLy9jb25zb2xlLmxvZygiRmluZCBDZW50ZXIiKTsKCWZvciAocCA9IDA7IHAgPCBmYXJtLmxlbmd0aDsgcCsrKQogICAgewoJCWxhdEFycmF5LnB1c2goZmFybVtwXS5nZXRMYXRMbmcoKS5sYXQpOwoJCWxuZ0FycmF5LnB1c2goZmFybVtwXS5nZXRMYXRMbmcoKS5sbmcpOwoJICAgIHZhciBsZXZlbCA9IE1hdGguZmxvb3IoZmFybVtwXS5vcHRpb25zLmxldmVsKTsKICAgICAgICBpZiAoY291bnRBcnJheVtsZXZlbF0gPT0gbnVsbCkKICAgICAgICAgICAgY291bnRBcnJheVtsZXZlbF0gPSAwOwogICAgICAgIGNvdW50QXJyYXlbbGV2ZWxdKys7CiAgICB9CiAgICAKICAgIGNvbnNvbGUubG9nKGNvdW50QXJyYXkpOwogICAgdmFyIHBvcHVwTXNnID0gIlBvcnRhbCBDb3VudDxicj4iOwogICAgZm9yIChpID0gMTsgaSA8IDk7IGkrKykKICAgIHsKICAgICAJaWYgKGNvdW50QXJyYXlbaV0gIT0gbnVsbCkKICAgICAgICAgICAgcG9wdXBNc2cgKz0gIkxldmVsICIgKyBpICsgIjogIiArIGNvdW50QXJyYXlbaV0gKyAiPGJyPiI7CiAgICB9CgkKCXZhciBub3J0aCA9IE1hdGgubWF4LmFwcGx5KG51bGwsIGxuZ0FycmF5KTsKCXZhciBzb3V0aCA9IE1hdGgubWluLmFwcGx5KG51bGwsIGxuZ0FycmF5KTsKCXZhciBlYXN0ID0gTWF0aC5tYXguYXBwbHkobnVsbCwgbGF0QXJyYXkpOwoJdmFyIHdlc3QgPSBNYXRoLm1pbi5hcHBseShudWxsLCBsYXRBcnJheSk7CgkKCXZhciBjZW50ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKCgoZWFzdCArIHdlc3QpIC8gMiksICgobm9ydGggKyBzb3V0aCkgLyAyKSk7CgkvL2NvbnNvbGUubG9nKGNlbnRlcik7CiAgICAvL2NvbnNvbGUubG9nKCJGaW5kIFJhZGl1cyIpOwoJdmFyIHJhZGl1cyA9IDA7Cglmb3IgKHAgPSAwOyBwIDwgZmFybS5sZW5ndGg7IHArKykKCXsKCQl2YXIgdGVtcCA9IGNlbnRlci5kaXN0YW5jZUZyb20oZmFybVtwXS5nZXRMYXRMbmcoKSk7CgkJaWYgKHRlbXAgPiByYWRpdXMpCgkJCXJhZGl1cyA9IHRlbXA7Cgl9CiAgICAKICAgIC8vY29uc29sZS5sb2cocmFkaXVzKTsKCS8vKCgyMCAtIG1hcC5fem9vbSkgKiAxMDAwKSAvIG1hcC5fem9vbQogICAgCgl2YXIgbGF0bG5nID0gbmV3IEwuTGF0TG5nKGNlbnRlci5sYXQoKSwgY2VudGVyLmxuZygpKTsKICAgIC8vY29uc29sZS5sb2coImxhdGxuZzogIiArIGxhdGxuZyk7CiAgICB2YXIgb3B0Q2lyY2xlID0ge2NvbG9yOidyZWQnLG9wYWNpdHk6MC43LGZpbGw6dHJ1ZSxmaWxsQ29sb3I6J3JlZCcsZmlsbE9wYWNpdHk6MC43LHdlaWdodDoxNSxjbGlja2FibGU6dHJ1ZX07CiAgICB2YXIgY2lyY2xlID0gbmV3IEwuQ2lyY2xlKGxhdGxuZywgcmFkaXVzLCBvcHRDaXJjbGUpOwogICAgY2lyY2xlLmJpbmRQb3B1cChwb3B1cE1zZyk7CiAgICAKICAgIAogICAgY2lyY2xlLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbihlKSB7CiAgIAkJY2lyY2xlLmJyaW5nVG9CYWNrKCk7Cgl9KTsKICAgIGNpcmNsZS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAJY2lyY2xlLmJyaW5nVG9CYWNrKCk7Cgl9KTsKICAgIC8vY29uc29sZS5sb2coImNpcmNsZTogIiArIGNpcmNsZSk7CiAgICBjaXJjbGUuYWRkVG8od2luZG93LnBsdWdpbi5mYXJtRmluZC5sZXZlbExheWVyR3JvdXApOwp9OwogICAgCiAgICBnb29nbGUubWFwcy5MYXRMbmcucHJvdG90eXBlLmRpc3RhbmNlRnJvbSA9IGZ1bmN0aW9uKG5ld0xhdExuZykgewogICAgICAgIAogICAvLyBzZXR1cCBvdXIgdmFyaWFibGVzCiAgIHZhciBsYXQxID0gdGhpcy5sYXQoKTsKICAgdmFyIHJhZGlhbkxhdDEgPSBsYXQxICogKCBNYXRoLlBJICAvIDE4MCApOwogICAgICAgIAogICB2YXIgbG5nMSA9IHRoaXMubG5nKCk7CiAgIHZhciByYWRpYW5MbmcxID0gbG5nMSAqICggTWF0aC5QSSAgLyAxODAgKTsKICAgICAgICAKICAgdmFyIGxhdDIgPSBuZXdMYXRMbmcubGF0OwogICB2YXIgcmFkaWFuTGF0MiA9IGxhdDIgKiAoIE1hdGguUEkgIC8gMTgwICk7CiAgICAgICAgCiAgIHZhciBsbmcyID0gbmV3TGF0TG5nLmxuZzsKICAgdmFyIHJhZGlhbkxuZzIgPSBsbmcyICogKCBNYXRoLlBJICAvIDE4MCApOwogICAgICAgIAogICAvLyBzb3J0IG91dCB0aGUgcmFkaXVzLCBNSUxFUyBvciBLTT8KICAgdmFyIGVhcnRoX3JhZGl1cyA9IDYzNzguMTsgLy8gKGttID0gNjM3OC4xKSBPUiAobWlsZXMgPSAzOTU5KSAtIHJhZGl1cyBvZiB0aGUgZWFydGgKIAogICAvLyBzb3J0IG91ciB0aGUgZGlmZmVyZW5jZXMKICAgdmFyIGRpZmZMYXQgPSAgKCByYWRpYW5MYXQxIC0gcmFkaWFuTGF0MiApOwogICB2YXIgZGlmZkxuZyA9ICAoIHJhZGlhbkxuZzEgLSByYWRpYW5MbmcyICk7CiAgIC8vIHB1dCBvbiBhIHdhdmUgKGhleSB0aGUgZWFydGggaXMgcm91bmQgYWZ0ZXIgYWxsKQogICB2YXIgc2luTGF0ID0gTWF0aC5zaW4oIGRpZmZMYXQgLyAyICApOwogICB2YXIgc2luTG5nID0gTWF0aC5zaW4oIGRpZmZMbmcgLyAyICApOyAKIAogICAvLyBtYXRocyAtIGJvcnJvd2VkIGZyb20gaHR0cDovL3d3dy5vcGVuc291cmNlY29ubmVjdGlvbnMuY29tL3dwLWNvbnRlbnQvdXBsb2Fkcy8yMDA5LzAyL2NsaWVudHNpZGVoYXZlcnNpbmVjYWxjdWxhdGlvbi5odG1sCiAgIHZhciBhID0gTWF0aC5wb3coc2luTGF0LCAyLjApICsgTWF0aC5jb3MocmFkaWFuTGF0MSkgKiBNYXRoLmNvcyhyYWRpYW5MYXQyKSAqIE1hdGgucG93KHNpbkxuZywgMi4wKTsKIAogICAvLyB3b3JrIG91dCB0aGUgZGlzdGFuY2UKICAgdmFyIGRpc3RhbmNlID0gZWFydGhfcmFkaXVzICogMiAqIE1hdGguYXNpbihNYXRoLm1pbigxLCBNYXRoLnNxcnQoYSkpKTsKIAkKICAgLy8gcmV0dXJuIHRoZSBkaXN0YW5jZQogICByZXR1cm4gZGlzdGFuY2UgKiAxMDAwOwp9OwogICAgCiAgICB3aW5kb3cucGx1Z2luLmZhcm1GaW5kLnNldHVwQ1NTID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJCgnPHN0eWxlPicpLnByb3AoJ3R5cGUnLCAndGV4dC9jc3MnKS5odG1sKCcnCiAgICAgICAgICAgICsgJyNmYXJtX2xldmVsX3NlbGVjdCB7JwogICAgICAgICAgICArICcgcG9zaXRpb246IGFic29sdXRlOycKICAgICAgICAgICAgKyAnIHRvcDogNXB4OycKICAgICAgICAgICAgKyAnIGxlZnQ6MTgwcHg7JwogICAgICAgICAgICArICcgei1pbmRleDogMjUwMDsnCiAgICAgICAgICAgICsgJyBmb250LXNpemU6MTFweDsnCiAgICAgICAgICAgICsgJyBmb250LWZhbWlseTogImNvZGEiLGFyaWFsLGhlbHZldGljYSxzYW5zLXNlcmlmOycKICAgICAgICAgICAgKyAnIGJhY2tncm91bmQtY29sb3I6IzBFM0M0NjsnCiAgICAgICAgICAgICsgJyBjb2xvcjojZmZjZTAwOycKICAgICAgICAgICAgKyAnfVxuJykuYXBwZW5kVG8oJ2hlYWQnKTsKCX07CgogICAgd2luZG93LnBsdWdpbi5mYXJtRmluZC5zZXR1cFNtYXJ0Q1NTID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJCgnPHN0eWxlPicpLnByb3AoJ3R5cGUnLCAndGV4dC9jc3MnKS5odG1sKCcnCiAgICAgICAgICAgICsgJyNmYXJtX2xldmVsX3NlbGVjdCB7JwogICAgICAgICAgICArICcgdG9wOiAwcHggIWltcG9ydGFudDsnCiAgICAgICAgICAgICsgJyByaWdodDogMHB4OycKICAgICAgICAgICAgKyAnIGxlZnQ6IGF1dG8gIWltcG9ydGFudDsnCiAgICAgICAgICAgICsgJyBtYXJnaW4tcmlnaHQ6IDA7JwogICAgICAgICAgICArICd9XG4nKS5hcHBlbmRUbygnaGVhZCcpOwogICAgfTsKCndpbmRvdy5wbHVnaW4uZmFybUZpbmQuY2hhbmdlTGV2ZWwgPSBmdW5jdGlvbigpCnsKICAgIHZhciBteXNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmYXJtX2xldmVsX3NlbGVjdCIpOwogICAJdmFyIGxldmVsID0gbXlzZWxlY3Qub3B0aW9uc1tteXNlbGVjdC5zZWxlY3RlZEluZGV4XS52YWx1ZTsKICAgIHdpbmRvdy5wbHVnaW4uZmFybUZpbmQubWluTGV2ZWwgPSBsZXZlbDsKICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmluZEZhcm1DbGljayIpOwogICAgYnV0dG9uLnRpdGxlID0gJ0NoZWNrIHBvcnRhbHMgaW4gdmlldyBmb3IgTCcgKyB3aW5kb3cucGx1Z2luLmZhcm1GaW5kLm1pbkxldmVsICsgJyBmYXJtcyc7CiAgICBidXR0b24uaW5uZXJIVE1MID0gJ0wnICsgd2luZG93LnBsdWdpbi5mYXJtRmluZC5taW5MZXZlbCArICcgRmFybXMnOwogICAgCn07Cgp2YXIgc2V0dXAgPSAgZnVuY3Rpb24oKSB7CiAgICB3aW5kb3cucGx1Z2luLmZhcm1GaW5kLm1pbkxldmVsID0gNzsKICAgIHdpbmRvdy5wbHVnaW4uZmFybUZpbmQubWluTmVhcmJ5ID0gNTsKICAgIHdpbmRvdy5wbHVnaW4uZmFybUZpbmQuc2V0dXBDU1MoKTsKICAgIGlmICh3aW5kb3cuaXNTbWFydHBob25lKCkpIHsKICAgICAgICB3aW5kb3cucGx1Z2luLmZhcm1GaW5kLnNldHVwU21hcnRDU1MoKTsKICAgIH0KICAgIHdpbmRvdy5wbHVnaW4uZmFybUZpbmQuUmFkaXVzID0gNTAwOwogICAgJCgnI3Rvb2xib3gnKS5hcHBlbmQoJyA8YSBvbmNsaWNrPSJ3aW5kb3cucGx1Z2luLmZhcm1GaW5kLmNoZWNrUG9ydGFscygpIiBpZD0iZmluZEZhcm1DbGljayIgdGl0bGU9IkNoZWNrIHBvcnRhbHMgaW4gdmlldyBmb3IgTCcgKyB3aW5kb3cucGx1Z2luLmZhcm1GaW5kLm1pbkxldmVsICsgJyBmYXJtcyI+TCcgKyB3aW5kb3cucGx1Z2luLmZhcm1GaW5kLm1pbkxldmVsICsgJyBGYXJtczwvYT4nKTsKICAgIHBvc3NpYmxlRmFybVBvcnRhbHMgPSBbXTsKICAgIHdpbmRvdy5wbHVnaW4uZmFybUZpbmQubGV2ZWxMYXllckdyb3VwID0gbmV3IEwuTGF5ZXJHcm91cCgpOwoJJCgnYm9keScpLmFwcGVuZCgnPHNlbGVjdCBvbmNoYW5nZT0id2luZG93LnBsdWdpbi5mYXJtRmluZC5jaGFuZ2VMZXZlbCgpIiBpZD0iZmFybV9sZXZlbF9zZWxlY3QiPjxvcHRpb24gdmFsdWU9MT5GYXJtIGxldmVsIDE8L29wdGlvbj48b3B0aW9uIHZhbHVlPTI+RmFybSBsZXZlbCAyPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0zPkZhcm0gbGV2ZWwgMzwvb3B0aW9uPjxvcHRpb24gdmFsdWU9ND5GYXJtIGxldmVsIDQ8L29wdGlvbj48b3B0aW9uIHZhbHVlPTU+RmFybSBsZXZlbCA1PC9vcHRpb24+PG9wdGlvbiB2YWx1ZT02PkZhcm0gbGV2ZWwgNjwvb3B0aW9uPjxvcHRpb24gdmFsdWU9Nz5GYXJtIGxldmVsIDc8L29wdGlvbj48b3B0aW9uIHZhbHVlPTg+RmFybSBsZXZlbCA4PC9vcHRpb24+PC9zZWxlY3Q+Jyk7CiAgICB2YXIgbXlzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmFybV9sZXZlbF9zZWxlY3QiKTsKICAgIG15c2VsZWN0Lm9wdGlvbnMuc2VsZWN0ZWRJbmRleCA9IDY7CiAgICB3aW5kb3cuYWRkTGF5ZXJHcm91cCgnRmFybXMnLCB3aW5kb3cucGx1Z2luLmZhcm1GaW5kLmxldmVsTGF5ZXJHcm91cCwgdHJ1ZSk7Cn07CgovLyBQTFVHSU4gRU5EIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgpzZXR1cC5pbmZvID0gcGx1Z2luX2luZm87IC8vYWRkIHRoZSBzY3JpcHQgaW5mbyBkYXRhIHRvIHRoZSBmdW5jdGlvbiBhcyBhIHByb3BlcnR5CmlmKCF3aW5kb3cuYm9vdFBsdWdpbnMpIHdpbmRvdy5ib290UGx1Z2lucyA9IFtdOwp3aW5kb3cuYm9vdFBsdWdpbnMucHVzaChzZXR1cCk7Ci8vIGlmIElJVEMgaGFzIGFscmVhZHkgYm9vdGVkLCBpbW1lZGlhdGVseSBydW4gdGhlICdzZXR1cCcgZnVuY3Rpb24KaWYod2luZG93LmlpdGNMb2FkZWQgJiYgdHlwZW9mIHNldHVwID09PSAnZnVuY3Rpb24nKSBzZXR1cCgpOwp9IC8vIHdyYXBwZXIgZW5kCi8vIGluamVjdCBjb2RlIGludG8gc2l0ZSBjb250ZXh0CnZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKdmFyIGluZm8gPSB7fTsKaWYgKHR5cGVvZiBHTV9pbmZvICE9PSAndW5kZWZpbmVkJyAmJiBHTV9pbmZvICYmIEdNX2luZm8uc2NyaXB0KSBpbmZvLnNjcmlwdCA9IHsgdmVyc2lvbjogR01faW5mby5zY3JpcHQudmVyc2lvbiwgbmFtZTogR01faW5mby5zY3JpcHQubmFtZSwgZGVzY3JpcHRpb246IEdNX2luZm8uc2NyaXB0LmRlc2NyaXB0aW9uIH07CnNjcmlwdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnKCcrIHdyYXBwZXIgKycpKCcrSlNPTi5zdHJpbmdpZnkoaW5mbykrJyk7JykpOwooZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCgo="},{"name":"IITC plugin: Sync","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1480919504230,"data":{}},"enabled":true,"position":12,"file_url":"https://static.iitc.me/build/release/plugins/sync.user.js","uuid":"57b17d24-f7c5-49fc-b689-3e292c36f9b1","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLXN5bmNAeGVsaW8KLy8gQG5hbWUgICAgICAgICAgIElJVEMgcGx1Z2luOiBTeW5jCi8vIEBjYXRlZ29yeSAgICAgICBNaXNjCi8vIEB2ZXJzaW9uICAgICAgICAwLjIuMy4yMDE2MTAwMy40NzQwCi8vIEBuYW1lc3BhY2UgICAgICBodHRwczovL2dpdGh1Yi5jb20vam9uYXRraW5zL2luZ3Jlc3MtaW50ZWwtdG90YWwtY29udmVyc2lvbgovLyBAdXBkYXRlVVJMICAgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3BsdWdpbnMvc3luYy5tZXRhLmpzCi8vIEBkb3dubG9hZFVSTCAgICBodHRwczovL3N0YXRpYy5paXRjLm1lL2J1aWxkL3JlbGVhc2UvcGx1Z2lucy9zeW5jLnVzZXIuanMKLy8gQGRlc2NyaXB0aW9uICAgIFtpaXRjLTIwMTYtMTAtMDMtMDA0NzQwXSBTeW5jIGRhdGEgYmV0d2VlbiBjbGllbnRzIHZpYSBHb29nbGUgUmVhbHRpbWUgQVBJLiBPbmx5IHN5bmNzIGRhdGEgZnJvbSBzcGVjaWZpYyBwbHVnaW5zIChjdXJyZW50bHk6IEtleXMsIEJvb2ttYXJrcykuIFNpZ24gaW4gdmlhIHRoZSAnU3luYycgbGluay4KLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBpbmNsdWRlICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQG1hdGNoICAgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAZ3JhbnQgICAgICAgICAgbm9uZQovLyA9PS9Vc2VyU2NyaXB0PT0KCgpmdW5jdGlvbiB3cmFwcGVyKHBsdWdpbl9pbmZvKSB7Ci8vIGVuc3VyZSBwbHVnaW4gZnJhbWV3b3JrIGlzIHRoZXJlLCBldmVuIGlmIGlpdGMgaXMgbm90IHlldCBsb2FkZWQKaWYodHlwZW9mIHdpbmRvdy5wbHVnaW4gIT09ICdmdW5jdGlvbicpIHdpbmRvdy5wbHVnaW4gPSBmdW5jdGlvbigpIHt9OwoKLy9QTFVHSU4gQVVUSE9SUzogd3JpdGluZyBhIHBsdWdpbiBvdXRzaWRlIG9mIHRoZSBJSVRDIGJ1aWxkIGVudmlyb25tZW50PyBpZiBzbywgZGVsZXRlIHRoZXNlIGxpbmVzISEKLy8obGVhdmluZyB0aGVtIGluIHBsYWNlIG1pZ2h0IGJyZWFrIHRoZSAnQWJvdXQgSUlUQycgcGFnZSBvciBicmVhayB1cGRhdGUgY2hlY2tzKQpwbHVnaW5faW5mby5idWlsZE5hbWUgPSAnaWl0Yyc7CnBsdWdpbl9pbmZvLmRhdGVUaW1lVmVyc2lvbiA9ICcyMDE2MTAwMy40NzQwJzsKcGx1Z2luX2luZm8ucGx1Z2luSWQgPSAnc3luYyc7Ci8vRU5EIFBMVUdJTiBBVVRIT1JTIE5PVEUKCgoKLy8gUExVR0lOIFNUQVJUIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gTm90aWNlIGZvciBkZXZlbG9wZXJzOgovLyAKLy8gWW91IHNob3VsZCB0cmVhdCB0aGUgZGF0YSBzdG9yZWQgb24gR29vZ2xlIFJlYWx0aW1lIEFQSSBhcyB2b2xhdGlsZS4gCi8vIEJlY2F1c2UgaWYgdGhlcmUgYXJlIGNoYW5nZSBpbiBHb29nbGUgQVBJIGNsaWVudCBJRCwgR29vZ2xlIHdpbGwgCi8vIHRyZWF0IGl0IGFzIGFub3RoZXIgYXBwbGljYXRpb24gYW5kIGNvdWxkIG5vdCBhY2Nlc3MgdGhlIGRhdGEgY3JlYXRlZCAKLy8gYnkgb2xkIGNsaWVudCBJRC4gU3RvcmUgYW55IGltcG9ydGFudCBkYXRhIGxvY2FsbHkgYW5kIG9ubHkgdXNlIHRoaXMgCi8vIHBsdWdpbiBhcyBzeW5jaW5nIGZ1bmN0aW9uLiAKLy8KLy8gR29vZ2xlIFJlYWx0aW1lIEFQSSByZWZlcmVuY2UKLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vZHJpdmUvcmVhbHRpbWUvYXBwbGljYXRpb24KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgovLyB1c2Ugb3duIG5hbWVzcGFjZSBmb3IgcGx1Z2luCndpbmRvdy5wbHVnaW4uc3luYyA9IGZ1bmN0aW9uKCkge307Cgp3aW5kb3cucGx1Z2luLnN5bmMuS0VZX1VVSUQgPSB7a2V5OiAncGx1Z2luLXN5bmMtZGF0YS11dWlkJywgZmllbGQ6ICd1dWlkJ307CgovLyBFYWNoIGNsaWVudCBoYXMgYW4gdW5pcXVlIFVVSUQsIHRvIGlkZW50aWZ5IHJlbW90ZSBkYXRhIGlzIHVwZGF0ZWQgYnkgb3RoZXIgY2xpZW50cyBvciBub3QKd2luZG93LnBsdWdpbi5zeW5jLnV1aWQgPSBudWxsOwoKd2luZG93LnBsdWdpbi5zeW5jLmRpYWxvZ0hUTUwgPSBudWxsOwp3aW5kb3cucGx1Z2luLnN5bmMuYXV0aG9yaXplciA9IG51bGw7CgovLyBTdG9yZSByZWdpc3RlcmVkIENvbGxhYm9yYXRpdmVNYXAKd2luZG93LnBsdWdpbi5zeW5jLnJlZ2lzdGVyZWRQbHVnaW5zRmllbGRzID0gbnVsbDsKd2luZG93LnBsdWdpbi5zeW5jLmxvZ2dlciA9IG51bGw7CgovLyBPdGhlciBwbHVnaW4gY2FsbCB0aGlzIGZ1bmN0aW9uIHRvIHB1c2ggdXBkYXRlIHRvIEdvb2dsZSBSZWFsdGltZSBBUEkKLy8gZXhhbXBsZToKLy8gcGx1Z2luLnN5bmMudXBkYXRlTWFwKCdrZXlzJywgJ2tleXNkYXRhJywgWydndWlkMScsICdndWlkMicsICdndWlkMyddKQovLyBXaGljaCB3aWxsIHB1c2ggcGx1Z2luLmtleXMua2V5c2RhdGFbJ2d1aWQxJ10gZXRjLiB0byBHb29nbGUgUmVhbHRpbWUgQVBJCndpbmRvdy5wbHVnaW4uc3luYy51cGRhdGVNYXAgPSBmdW5jdGlvbihwbHVnaW5OYW1lLCBmaWVsZE5hbWUsIGtleUFycmF5KSB7CiAgdmFyIHJlZ2lzdGVyZWRNYXAgPSBwbHVnaW4uc3luYy5yZWdpc3RlcmVkUGx1Z2luc0ZpZWxkcy5nZXQocGx1Z2luTmFtZSwgZmllbGROYW1lKTsKICBpZighcmVnaXN0ZXJlZE1hcCkgcmV0dXJuIGZhbHNlOwogIHJlZ2lzdGVyZWRNYXAudXBkYXRlTWFwKGtleUFycmF5KTsKfQoKLy8gT3RoZXIgcGx1Z2luIGNhbGwgdGhpcyB0byByZWdpc3RlciBhIGZpZWxkIGFzIENvbGxhYm9yYXRpdmVNYXAgdG8gc3luYyB3aXRoIEdvb2dsZSBSZWFsdGltZSBBUEkKLy8gZXhhbXBsZTogcGx1Z2luLnN5bmMucmVnaXN0ZXJNYXBGb3JTeW5jKCdrZXlzJywgJ2tleXNkYXRhJywgcGx1Z2luLmtleXMudXBkYXRlQ2FsbGJhY2ssIHBsdWdpbi5rZXlzLmluaXRpYWxpemVkQ2FsbGJhY2spCi8vIHdoaWNoIHJlZ2lzdGVyIHBsdWdpbi5rZXlzLmtleXNkYXRhCi8vCi8vIHVwZGF0ZUNhbGxiYWNrIGZ1bmN0aW9uIGZvcm1hdDogZnVuY3Rpb24ocGx1Z2luTmFtZSwgZmllbGROYW1lLCBldmVudE9iamVjdCwgZnVsbFVwZGF0ZWQpCi8vIHVwZGF0ZUNhbGxiYWNrIHdpbGwgYmUgZmlyZWQgd2hlbiBsb2NhbCBvciByZW1vdGUgcHVzaGVkIHVwZGF0ZSB0byBHb29nbGUgUmVhbHRpbWUgQVBJCi8vIGZ1bGxVcGRhdGVkIGlzIHRydWUgd2hlbiByZW1vdGUgdXBkYXRlIG9jY3VyIGR1cmluZyBsb2NhbCBjbGllbnQgb2ZmbGluZSwgYWxsIGRhdGEgaXMgcmVwbGFjZWQgYnkgcmVtb3RlIGRhdGEKLy8gZXZlbnRPYmplY3QgaXMgYSBWYWx1ZUNoYW5nZWRFdmVudCwgaXMgbnVsbCBpZiBmdWxsVXBkYXRlZCBpcyB0cnVlCi8vCi8vIGRldGFpbCBvZiBWYWx1ZUNoYW5nZWRFdmVudCByZWZlciB0byBmb2xsb3dpbmcgdXJsCi8vIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2RyaXZlL3JlYWx0aW1lL3JlZmVyZW5jZS9nYXBpLmRyaXZlLnJlYWx0aW1lLlZhbHVlQ2hhbmdlZEV2ZW50Ci8vCi8vIGluaXRpYWxpemVkQ2FsbGJhY2sgZnVuY3Rpb24gZm9ybWF0OiBmdW5jdGlvbihwbHVnaW5OYW1lLCBmaWVsZE5hbWUpCi8vIGluaXRpYWxpemVkQ2FsbGJhY2sgd2lsbCBiZSBmaXJlZCB3aGVuIHRoZSBDb2xsYWJvcmF0aXZlTWFwIGZpbmlzaGVkIGluaXRpYWxpemUgYW5kIGdvb2QgdG8gdXNlCndpbmRvdy5wbHVnaW4uc3luYy5yZWdpc3Rlck1hcEZvclN5bmMgPSBmdW5jdGlvbihwbHVnaW5OYW1lLCBmaWVsZE5hbWUsIGNhbGxiYWNrLCBpbml0aWFsaXplZENhbGxiYWNrKSB7CiAgdmFyIG9wdGlvbnMsIHJlZ2lzdGVyZWRNYXA7CiAgb3B0aW9ucyA9IHsncGx1Z2luTmFtZSc6IHBsdWdpbk5hbWUsCiAgICAgICAgICAgICAgICdmaWVsZE5hbWUnOiBmaWVsZE5hbWUsCiAgICAgICAgICAgICAgICdjYWxsYmFjayc6IGNhbGxiYWNrLAogICAgICAgICAgICAgICAnaW5pdGlhbGl6ZWRDYWxsYmFjayc6IGluaXRpYWxpemVkQ2FsbGJhY2ssCiAgICAgICAgICAgICAgICdhdXRob3JpemVyJzogcGx1Z2luLnN5bmMuYXV0aG9yaXplciwKICAgICAgICAgICAgICAgJ3V1aWQnOiBwbHVnaW4uc3luYy51dWlkfTsKICByZWdpc3RlcmVkTWFwID0gbmV3IHBsdWdpbi5zeW5jLlJlZ2lzdGVyZWRNYXAob3B0aW9ucyk7CiAgcGx1Z2luLnN5bmMucmVnaXN0ZXJlZFBsdWdpbnNGaWVsZHMuYWRkKHJlZ2lzdGVyZWRNYXApOwp9CgoKCi8vLy8gUmVnaXN0ZXJlZE1hcAovLyBDcmVhdGUgYSBmaWxlIG5hbWVkIHBsdWdpbk5hbWVbZmllbGROYW1lXSBpbiBmb2xkZXIgc3BlY2lmaWVkIGJ5IGF1dGhvcml6ZXIKLy8gVGhlIGZpbGUgdXNlIGFzIHJlYWx0aW1lIGRvY3VtZW50IHdpdGggQ29sbGFib3JhdGl2ZU1hcCB0byBzdG9yZSB0aGUgZGF0YSBhbmQgYQovLyBDb2xsYWJvcmF0aXZlU3RyaW5nIHRvIHN0b3JlIHV1aWQgb2YgbGFzdCB1cGRhdGUgY2xpZW50Ci8vIGNhbGxiYWNrIHdpbGwgY2FsbGVkIHdoZW4gYW55IGxvY2FsL3JlbW90ZSB1cGRhdGUgaGFwcGVuCi8vIGluaXRpYWxpemVkQ2FsbGJhY2sgd2lsbCBjYWxsZWQgd2hlbiBSZWdpc3RlcmVkTWFwIGluaXRpYWxpemVkIGFuZCBnb29kIHRvIHVzZS4Kd2luZG93LnBsdWdpbi5zeW5jLlJlZ2lzdGVyZWRNYXAgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgdGhpcy5wbHVnaW5OYW1lID0gb3B0aW9uc1sncGx1Z2luTmFtZSddOwogIHRoaXMuZmllbGROYW1lID0gb3B0aW9uc1snZmllbGROYW1lJ107CiAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnNbJ2NhbGxiYWNrJ107CiAgdGhpcy5pbml0aWFsaXplZENhbGxiYWNrID0gb3B0aW9uc1snaW5pdGlhbGl6ZWRDYWxsYmFjayddOwogIHRoaXMuYXV0aG9yaXplciA9IG9wdGlvbnNbJ2F1dGhvcml6ZXInXTsKICB0aGlzLnV1aWQgPSBvcHRpb25zWyd1dWlkJ107CgogIHRoaXMuZmlsZUlkID0gbnVsbDsKICB0aGlzLmRvYyA9IG51bGw7CiAgdGhpcy5tb2RlbCA9IG51bGw7CiAgdGhpcy5tYXAgPSBudWxsOwogIHRoaXMubGFzdFVwZGF0ZVVVSUQgPSBudWxsOwogIHRoaXMuZmlsZVNlYXJjaGVyID0gbnVsbDsKCiAgdGhpcy5mb3JjZUZpbGVTZWFyY2ggPSBmYWxzZTsKICB0aGlzLmluaXRpYWxpemluZyA9IGZhbHNlOwogIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTsKICB0aGlzLmZhaWxlZCA9IGZhbHNlOwoKICB0aGlzLnVwZGF0ZUxpc3RlbmVyID0gdGhpcy51cGRhdGVMaXN0ZW5lci5iaW5kKHRoaXMpOwogIHRoaXMuaW5pdGlhbGl6ZSA9IHRoaXMuaW5pdGlhbGl6ZS5iaW5kKHRoaXMpOwogIHRoaXMubG9hZFJlYWx0aW1lRG9jdW1lbnQgPSB0aGlzLmxvYWRSZWFsdGltZURvY3VtZW50LmJpbmQodGhpcyk7Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5SZWdpc3RlcmVkTWFwLnByb3RvdHlwZS51cGRhdGVNYXAgPSBmdW5jdGlvbihrZXlBcnJheSkgewogIHZhciBfdGhpcyA9IHRoaXM7CiAgLy8gVXNlIGNvbXBvdW5kIG9wZXJhdGlvbiB0byBlbnN1cmUgdXBkYXRlIHB1c2hlZCBhcyBhIGJhdGNoCiAgdGhpcy5tb2RlbC5iZWdpbkNvbXBvdW5kT3BlcmF0aW9uKCk7CiAgdHJ5IHsKICAgIC8vIFJlbW92ZSBiZWZvcmUgc2V0IHRleHQgdG8gZW5zdXJlIGZ1bGwgdGV4dCBjaGFuZ2UKICAgIGlmICh0aGlzLmxhc3RVcGRhdGVVVUlELmxlbmd0aCA+IDApCiAgICAgIHRoaXMubGFzdFVwZGF0ZVVVSUQucmVtb3ZlUmFuZ2UoMCwgdGhpcy5sYXN0VXBkYXRlVVVJRC5sZW5ndGgpOwogICAgdGhpcy5sYXN0VXBkYXRlVVVJRC5zZXRUZXh0KHRoaXMudXVpZCk7CiAgCiAgICAkLmVhY2goa2V5QXJyYXksIGZ1bmN0aW9uKGluZCwga2V5KSB7CiAgICAgIHZhciB2YWx1ZSA9IHdpbmRvdy5wbHVnaW5bX3RoaXMucGx1Z2luTmFtZV1bX3RoaXMuZmllbGROYW1lXVtrZXldOwogICAgICBpZih0eXBlb2YodmFsdWUpICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIF90aGlzLm1hcC5zZXQoa2V5LCB2YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX3RoaXMubWFwLmRlbGV0ZShrZXkpOwogICAgICB9CiAgICB9KTsKICB9IGZpbmFsbHkgewogICAgLy8gRW5zdXJlIGVuZENvbXBvdW5kT3BlcmF0aW9uIGlzIGFsd2F5cyBjYWxsZWQgKHNlZSBidWcgIzg5NikKICAgIHRoaXMubW9kZWwuZW5kQ29tcG91bmRPcGVyYXRpb24oKTsKICB9Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5SZWdpc3RlcmVkTWFwLnByb3RvdHlwZS5pc1VwZGF0ZWRCeU90aGVycyA9IGZ1bmN0aW9uKCkgewogIHZhciByZW1vdGVVVUlEID0gdGhpcy5sYXN0VXBkYXRlVVVJRC50b1N0cmluZygpOwogIHJldHVybiAocmVtb3RlVVVJRCAhPT0gJycpICYmIChyZW1vdGVVVUlEICE9PSB0aGlzLnV1aWQpOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuUmVnaXN0ZXJlZE1hcC5wcm90b3R5cGUuZ2V0RmlsZU5hbWUgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5wbHVnaW5OYW1lICsgJ1snICsgdGhpcy5maWVsZE5hbWUgKyAnXScKfQoKd2luZG93LnBsdWdpbi5zeW5jLlJlZ2lzdGVyZWRNYXAucHJvdG90eXBlLmluaXRGaWxlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICB2YXIgYXNzaWduSWRDYWxsYmFjaywgZmFpbGVkQ2FsbGJhY2ssIF90aGlzOwogIF90aGlzID0gdGhpczsKCiAgYXNzaWduSWRDYWxsYmFjayA9IGZ1bmN0aW9uKGlkKSB7CiAgICBfdGhpcy5mb3JjZUZpbGVTZWFyY2ggPSBmYWxzZTsKICAgIF90aGlzLmZpbGVJZCA9IGlkOwogICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrKCk7CiAgfTsKCiAgZmFpbGVkQ2FsbGJhY2sgPSBmdW5jdGlvbihyZXNwKSB7CiAgICBfdGhpcy5pbml0aWFsaXppbmcgPSBmYWxzZTsKICAgIF90aGlzLmZhaWxlZCA9IHRydWU7CiAgICBwbHVnaW4uc3luYy5sb2dnZXIubG9nKCdDb3VsZCBub3QgY3JlYXRlIGZpbGU6ICcgKyBfdGhpcy5nZXRGaWxlTmFtZSgpICsgJy4gSWYgdGhpcyBwcm9ibGVtIHBlcnNpc3QsIGRlbGV0ZSB0aGlzIGZpbGUgaW4gSUlUQy1TWU5DLURBVEEtVjIgYW5kIGVtcHR5IHRyYXNoIGluIHlvdXIgR29vZ2xlIGRyaXZlIGFuZCB0cnkgYWdhaW4uJyk7CiAgfQoKICB0aGlzLmZpbGVTZWFyY2hlciA9IG5ldyBwbHVnaW4uc3luYy5GaWxlU2VhcmNoZXIoeydmaWxlTmFtZSc6IHRoaXMuZ2V0RmlsZU5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXNjcmlwdGlvbic6ICdJSVRDIHBsdWdpbiBkYXRhIGZvciAnICsgdGhpcy5nZXRGaWxlTmFtZSgpfSk7CiAgdGhpcy5maWxlU2VhcmNoZXIuaW5pdGlhbGl6ZSh0aGlzLmZvcmNlRmlsZVNlYXJjaCwgYXNzaWduSWRDYWxsYmFjaywgZmFpbGVkQ2FsbGJhY2spOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuUmVnaXN0ZXJlZE1hcC5wcm90b3R5cGUudXBkYXRlTGlzdGVuZXIgPSBmdW5jdGlvbihlKSB7CiAgaWYoIWUuaXNMb2NhbCkgewogICAgaWYoIXdpbmRvdy5wbHVnaW5bdGhpcy5wbHVnaW5OYW1lXVt0aGlzLmZpZWxkTmFtZV0pIHsKICAgICAgd2luZG93LnBsdWdpblt0aGlzLnBsdWdpbk5hbWVdW3RoaXMuZmllbGROYW1lXSA9IHt9OwogICAgfQogICAgaWYodHlwZW9mKGUubmV3VmFsdWUpICE9PSAndW5kZWZpbmVkJyAmJiBlLm5ld1ZhbHVlICE9PSBudWxsKSB7CiAgICAgIHdpbmRvdy5wbHVnaW5bdGhpcy5wbHVnaW5OYW1lXVt0aGlzLmZpZWxkTmFtZV1bZS5wcm9wZXJ0eV0gPSBlLm5ld1ZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgZGVsZXRlIHdpbmRvdy5wbHVnaW5bdGhpcy5wbHVnaW5OYW1lXVt0aGlzLmZpZWxkTmFtZV1bZS5wcm9wZXJ0eV07CiAgICB9CiAgfQogIGlmKHRoaXMuY2FsbGJhY2spIHRoaXMuY2FsbGJhY2sodGhpcy5wbHVnaW5OYW1lLCB0aGlzLmZpZWxkTmFtZSwgZSk7Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5SZWdpc3RlcmVkTWFwLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICB0aGlzLmluaXRGaWxlKHRoaXMubG9hZFJlYWx0aW1lRG9jdW1lbnQpOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuUmVnaXN0ZXJlZE1hcC5wcm90b3R5cGUubG9hZFJlYWx0aW1lRG9jdW1lbnQgPSBmdW5jdGlvbihjYWxsYmFjaykgewogIHRoaXMuaW5pdGlhbGl6aW5nID0gdHJ1ZTsKICB2YXIgaW5pdFJlYWx0aW1lLCBpbml0aWFsaXplTW9kZWwsIG9uRmlsZUxvYWRlZCwgaGFuZGxlRXJyb3IsIF90aGlzOwogIF90aGlzID0gdGhpczsKCiAgLy8gdGhpcyBmdW5jdGlvbiBjYWxsZWQgd2hlbiB0aGUgZG9jdW1lbnQgaXMgY3JlYXRlZCBmaXJzdCB0aW1lCiAgLy8gYW5kIHRoZSBDb2xsYWJvcmF0aXZlTWFwIGlzIHBvcHVsYXRlZCB3aXRoIGRhdGEgaW4gcGx1Z2luIGZpZWxkCiAgaW5pdGlhbGl6ZU1vZGVsID0gZnVuY3Rpb24obW9kZWwpIHsKICAgIHZhciBlbXB0eSA9IHRydWU7CiAgICB2YXIgbWFwID0gbW9kZWwuY3JlYXRlTWFwKCk7CiAgICB2YXIgbGFzdFVwZGF0ZVVVSUQgPSBtb2RlbC5jcmVhdGVTdHJpbmcoKTsKCiAgICAvLyBJbml0IHRoZSBtYXAgdmFsdWVzIGlmIHRoaXMgbWFwIGlzIGZpcnN0IGNyZWF0ZWQKICAgICQuZWFjaCh3aW5kb3cucGx1Z2luW190aGlzLnBsdWdpbk5hbWVdW190aGlzLmZpZWxkTmFtZV0sIGZ1bmN0aW9uKGtleSwgdmFsKSB7CiAgICAgIG1hcC5zZXQoa2V5LCB2YWwpOwogICAgICBlbXB0eSA9IGZhbHNlOwogICAgfSk7CgogICAgLy8gT25seSBzZXQgdGhlIHVwZGF0ZSBjbGllbnQgaWYgdGhlIG1hcCBpcyBub3QgZW1wdHksIGF2b2lkIGNsZWFyaW5nIGRhdGEgb2Ygb3RoZXIgY2xpZW50cwogICAgbGFzdFVwZGF0ZVVVSUQuc2V0VGV4dChlbXB0eSA/ICcnIDogX3RoaXMudXVpZCk7CgogICAgbW9kZWwuZ2V0Um9vdCgpLnNldCgnbWFwJywgbWFwKTsKICAgIG1vZGVsLmdldFJvb3QoKS5zZXQoJ2xhc3QtdWRwYXRlLXV1aWQnLCBsYXN0VXBkYXRlVVVJRCk7CiAgICBwbHVnaW4uc3luYy5sb2dnZXIubG9nKCdNb2RlbCBpbml0aWFsaXplZDogJyArIF90aGlzLnBsdWdpbk5hbWUgKyAnWycgKyBfdGhpcy5maWVsZE5hbWUgKyAnXScpOwogIH07CgogIC8vIHRoaXMgZnVuY3Rpb24gY2FsbGVkIHdoZW4gdGhlIGRvY3VtZW50IGlzIGxvYWRlZAogIC8vIHVwZGF0ZSBsb2NhbCBkYXRhIGlmIHRoZSBkb2N1bWVudCBpcyB1cGRhdGVkIGJ5IG90aGVyCiAgLy8gYW5kIGFkZCB1cGRhdGUgbGlzdGVuZXIgdG8gQ29sbGFib3JhdGl2ZU1hcAogIG9uRmlsZUxvYWRlZCA9IGZ1bmN0aW9uKGRvYykgewogICAgX3RoaXMuZG9jID0gZG9jOwogICAgX3RoaXMubW9kZWwgPSBkb2MuZ2V0TW9kZWwoKTsKICAgIF90aGlzLm1hcCA9IGRvYy5nZXRNb2RlbCgpLmdldFJvb3QoKS5nZXQoJ21hcCcpOwogICAgX3RoaXMubGFzdFVwZGF0ZVVVSUQgPSBkb2MuZ2V0TW9kZWwoKS5nZXRSb290KCkuZ2V0KCdsYXN0LXVkcGF0ZS11dWlkJyk7CiAgICBfdGhpcy5tYXAuYWRkRXZlbnRMaXN0ZW5lcihnYXBpLmRyaXZlLnJlYWx0aW1lLkV2ZW50VHlwZS5WQUxVRV9DSEFOR0VELCBfdGhpcy51cGRhdGVMaXN0ZW5lcik7CgogICAgLy8gUmVwbGFjZSBsb2NhbCB2YWx1ZSBpZiBkYXRhIGlzIGNoYW5nZWQgYnkgb3RoZXJzCiAgICBpZihfdGhpcy5pc1VwZGF0ZWRCeU90aGVycygpKSB7CiAgICBwbHVnaW4uc3luYy5sb2dnZXIubG9nKCdVcGRhdGVkIGJ5IG90aGVycywgcmVwbGFjaW5nIGNvbnRlbnQ6ICcgKyBfdGhpcy5wbHVnaW5OYW1lICsgJ1snICsgX3RoaXMuZmllbGROYW1lICsgJ10nKTsKICAgICAgd2luZG93LnBsdWdpbltfdGhpcy5wbHVnaW5OYW1lXVtfdGhpcy5maWVsZE5hbWVdID0ge307CiAgICAgICQuZWFjaChfdGhpcy5tYXAua2V5cygpLCBmdW5jdGlvbihpbmQsIGtleSkgewogICAgICAgIHdpbmRvdy5wbHVnaW5bX3RoaXMucGx1Z2luTmFtZV1bX3RoaXMuZmllbGROYW1lXVtrZXldID0gX3RoaXMubWFwLmdldChrZXkpOwogICAgICB9KTsKICAgICAgaWYoX3RoaXMuY2FsbGJhY2spIF90aGlzLmNhbGxiYWNrKF90aGlzLnBsdWdpbk5hbWUsIF90aGlzLmZpZWxkTmFtZSwgbnVsbCwgdHJ1ZSk7CiAgICB9CgogICAgX3RoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgX3RoaXMuaW5pdGlhbGl6aW5nID0gZmFsc2U7CiAgICBwbHVnaW4uc3luYy5sb2dnZXIubG9nKCdEYXRhIGxvYWRlZDogJyArIF90aGlzLnBsdWdpbk5hbWUgKyAnWycgKyBfdGhpcy5maWVsZE5hbWUgKyAnXScpOwogICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrKCk7CiAgICBpZihfdGhpcy5pbml0aWFsaXplZENhbGxiYWNrKSBfdGhpcy5pbml0aWFsaXplZENhbGxiYWNrKF90aGlzLnBsdWdpbk5hbWUsIF90aGlzLmZpZWxkTmFtZSk7CiAgfTsKCiAgLy8gU3RvcCB0aGUgc3luYyBpZiBhbnkgZXJyb3Igb2NjdXIgYW5kIHRyeSB0byByZS1hdXRob3JpemUKICBoYW5kbGVFcnJvciA9IGZ1bmN0aW9uKGUpIHsKICAgIHBsdWdpbi5zeW5jLmxvZ2dlci5sb2coJ1JlYWx0aW1lIEFQSSBFcnJvcjogJyArIGUudHlwZSk7CiAgICBfdGhpcy5zdG9wU3luYygpOwogICAgaWYoZS50eXBlID09PSBnYXBpLmRyaXZlLnJlYWx0aW1lLkVycm9yVHlwZS5UT0tFTl9SRUZSRVNIX1JFUVVJUkVEKSB7CiAgICAgIF90aGlzLmF1dGhvcml6ZXIuYXV0aG9yaXplKCk7CiAgICB9IGVsc2UgaWYoZS50eXBlID09PSBnYXBpLmRyaXZlLnJlYWx0aW1lLkVycm9yVHlwZS5OT1RfRk9VTkQpIHsKICAgICAgX3RoaXMuZm9yY2VGaWxlU2VhcmNoID0gdHJ1ZTsKICAgIH0gZWxzZSBpZihlLnR5cGUgPT09IGdhcGkuZHJpdmUucmVhbHRpbWUuRXJyb3JUeXBlLkNMSUVOVF9FUlJPUikgewogICAgICAvLyBXb3JrYXJvdW5kOiBpZiBSZWFsdGltZSBBUEkgb3BlbiBhIHNlY29uZCBkb2N1bWVudCBhbmQgdGhlIGZpbGUgZG8gbm90IGV4aXN0LCAKICAgICAgLy8gaXQgd2lsbCByYXNpZSAnQ0xJRU5UX0VSUk9SJyBpbnN0ZWFkIG9mICdOT1RfRk9VTkQnLiBTbyB3ZSBkbyBhIGZvcmNlIGZpbGUgc2VhcmNoIGhlcmUuCiAgICAgIF90aGlzLmZvcmNlRmlsZVNlYXJjaCA9IHRydWU7CiAgICB9IGVsc2UgewogICAgICBhbGVydCgnUGx1Z2luIFN5bmMgZXJyb3I6ICcgKyBlLnR5cGUgKyAnLCAnICsgZS5tZXNzYWdlKTsKICAgIH0KICB9OwoKICBnYXBpLmRyaXZlLnJlYWx0aW1lLmxvYWQoX3RoaXMuZmlsZUlkLCBvbkZpbGVMb2FkZWQsIGluaXRpYWxpemVNb2RlbCwgaGFuZGxlRXJyb3IpOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuUmVnaXN0ZXJlZE1hcC5wcm90b3R5cGUuc3RvcFN5bmMgPSBmdW5jdGlvbigpIHsKICBpZih0aGlzLm1hcCkgdGhpcy5tYXAucmVtb3ZlRXZlbnRMaXN0ZW5lcihnYXBpLmRyaXZlLnJlYWx0aW1lLkV2ZW50VHlwZS5WQUxVRV9DSEFOR0VELCB0aGlzLnVwZGF0ZUxpc3RlbmVyKTsKICB0aGlzLmZpbGVJZCA9IG51bGw7CiAgdGhpcy5kb2MgPSBudWxsOwogIHRoaXMubW9kZWwgPSBudWxsOwogIHRoaXMubWFwID0gbnVsbDsKICB0aGlzLmxhc3RVcGRhdGVVVUlEID0gbnVsbDsKICB0aGlzLmluaXRpYWxpemluZyA9IGZhbHNlOwogIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTsKICBwbHVnaW4uc3luYy5yZWdpc3RlcmVkUGx1Z2luc0ZpZWxkcy5hZGRUb1dhaXRpbmdJbml0aWFsaXplKHRoaXMucGx1Z2luTmFtZSwgdGhpcy5maWVsZE5hbWUpOwp9Ci8vLy8gZW5kIFJlZ2lzdGVyZWRNYXAKCgoKCi8vLy8gUmVnaXN0ZXJlZFBsdWdpbnNGaWVsZHMKLy8gU3RvcmUgUmVnaXN0ZXJlZE1hcCBhbmQgaGFuZGxlIGluaXRpYWxpemF0aW9uIG9mIFJlZ2lzdGVyZWRNYXAKd2luZG93LnBsdWdpbi5zeW5jLlJlZ2lzdGVyZWRQbHVnaW5zRmllbGRzID0gZnVuY3Rpb24ob3B0aW9ucykgewogIHRoaXMuYXV0aG9yaXplciA9IG9wdGlvbnNbJ2F1dGhvcml6ZXInXTsKICB0aGlzLnBsdWdpbnNmaWVsZHMgPSB7fTsKICB0aGlzLndhaXRpbmdJbml0aWFsaXplID0ge307CgogIHRoaXMuYW55RmFpbCA9IGZhbHNlOwoKICB0aGlzLmluaXRpYWxpemVSZWdpc3RlcmVkID0gdGhpcy5pbml0aWFsaXplUmVnaXN0ZXJlZC5iaW5kKHRoaXMpOwogIHRoaXMuY2xlYW5XYWl0aW5nSW5pdGlhbGl6ZSA9IHRoaXMuY2xlYW5XYWl0aW5nSW5pdGlhbGl6ZS5iaW5kKHRoaXMpOwogIHRoaXMuaW5pdGlhbGl6ZVdvcmtlciA9IHRoaXMuaW5pdGlhbGl6ZVdvcmtlci5iaW5kKHRoaXMpOwoKICB0aGlzLmF1dGhvcml6ZXIuYWRkQXV0aENhbGxiYWNrKHRoaXMuaW5pdGlhbGl6ZVJlZ2lzdGVyZWQpOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuUmVnaXN0ZXJlZFBsdWdpbnNGaWVsZHMucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKHJlZ2lzdGVyZWRNYXApIHsKICB2YXIgcGx1Z2luTmFtZSwgZmllbGROYW1lOwogIHBsdWdpbk5hbWUgPSByZWdpc3RlcmVkTWFwLnBsdWdpbk5hbWU7CiAgZmllbGROYW1lID0gcmVnaXN0ZXJlZE1hcC5maWVsZE5hbWU7CiAgdGhpcy5wbHVnaW5zZmllbGRzW3BsdWdpbk5hbWVdID0gdGhpcy5wbHVnaW5zZmllbGRzW3BsdWdpbk5hbWVdIHx8IHt9OwoKICBpZih0aGlzLnBsdWdpbnNmaWVsZHNbcGx1Z2luTmFtZV1bZmllbGROYW1lXSkgcmV0dXJuIGZhbHNlOwoKICB0aGlzLnBsdWdpbnNmaWVsZHNbcGx1Z2luTmFtZV1bZmllbGROYW1lXSA9IHJlZ2lzdGVyZWRNYXA7CiAgdGhpcy53YWl0aW5nSW5pdGlhbGl6ZVtyZWdpc3RlcmVkTWFwLmdldEZpbGVOYW1lKCldID0gcmVnaXN0ZXJlZE1hcDsKCiAgdGhpcy5pbml0aWFsaXplV29ya2VyKCk7Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5SZWdpc3RlcmVkUGx1Z2luc0ZpZWxkcy5wcm90b3R5cGUuYWRkVG9XYWl0aW5nSW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKHBsdWdpbk5hbWUsIGZpZWxkTmFtZSkgewogIHZhciByZWdpc3RlcmVkTWFwLCBfdGhpczsKICBfdGhpcyA9IHRoaXM7CgogIHJlZ2lzdGVyZWRNYXAgPSB0aGlzLmdldChwbHVnaW5OYW1lLCBmaWVsZE5hbWUpOwogIGlmKCFyZWdpc3RlcmVkTWFwKSByZXR1cm47CiAgdGhpcy53YWl0aW5nSW5pdGlhbGl6ZVtyZWdpc3RlcmVkTWFwLmdldEZpbGVOYW1lKCldID0gcmVnaXN0ZXJlZE1hcDsKCiAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXIpOwogIHRoaXMudGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge190aGlzLmluaXRpYWxpemVXb3JrZXIoKX0sIDEwMDAwKTsKICBwbHVnaW4uc3luYy5sb2dnZXIubG9nKCdSZXRyeSBpbiAxMCBzZWMuOiAnICsgIHBsdWdpbk5hbWUgKyAnWycgKyBmaWVsZE5hbWUgKyAnXScpOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuUmVnaXN0ZXJlZFBsdWdpbnNGaWVsZHMucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKHBsdWdpbk5hbWUsIGZpZWxkTmFtZSkgewogIGlmKCF0aGlzLnBsdWdpbnNmaWVsZHNbcGx1Z2luTmFtZV0pIHJldHVybjsKICByZXR1cm4gdGhpcy5wbHVnaW5zZmllbGRzW3BsdWdpbk5hbWVdW2ZpZWxkTmFtZV07Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5SZWdpc3RlcmVkUGx1Z2luc0ZpZWxkcy5wcm90b3R5cGUuaW5pdGlhbGl6ZVJlZ2lzdGVyZWQgPSBmdW5jdGlvbigpIHsKICB2YXIgX3RoaXMgPSB0aGlzOwogIGlmKHRoaXMuYXV0aG9yaXplci5pc0F1dGhlZCgpKSB7CiAgICAkLmVhY2godGhpcy53YWl0aW5nSW5pdGlhbGl6ZSwgZnVuY3Rpb24oa2V5LCBtYXApIHsKICAgICAgaWYoIW1hcC5pbml0aWFsaXppbmcgJiYgIW1hcC5pbml0aWFsaXplZCkgewogICAgICAgIG1hcC5pbml0aWFsaXplKF90aGlzLmNsZWFuV2FpdGluZ0luaXRpYWxpemUpOwogICAgICB9CiAgICB9KTsKICB9Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5SZWdpc3RlcmVkUGx1Z2luc0ZpZWxkcy5wcm90b3R5cGUuY2xlYW5XYWl0aW5nSW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkgewogIHZhciBuZXdXYWl0aW5nSW5pdGlhbGl6ZSwgX3RoaXM7CiAgX3RoaXMgPSB0aGlzOwoKICBuZXdXYWl0aW5nSW5pdGlhbGl6ZSA9IHt9OwogICQuZWFjaCh0aGlzLndhaXRpbmdJbml0aWFsaXplLCBmdW5jdGlvbihrZXksbWFwKSB7CiAgICBpZihtYXAuZmFpbGVkKSBfdGhpcy5hbnlGYWlsID0gdHJ1ZTsKICAgIGlmKG1hcC5pbml0aWFsaXplZCB8fCBtYXAuZmFpbGVkKSByZXR1cm4gdHJ1ZTsKICAgIG5ld1dhaXRpbmdJbml0aWFsaXplW21hcC5nZXRGaWxlTmFtZSgpXSA9IG1hcDsKICB9KTsKICB0aGlzLndhaXRpbmdJbml0aWFsaXplID0gbmV3V2FpdGluZ0luaXRpYWxpemU7Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5SZWdpc3RlcmVkUGx1Z2luc0ZpZWxkcy5wcm90b3R5cGUuaW5pdGlhbGl6ZVdvcmtlciA9IGZ1bmN0aW9uKCkgewogIHZhciBfdGhpcyA9IHRoaXM7CgogIHRoaXMuY2xlYW5XYWl0aW5nSW5pdGlhbGl6ZSgpOwogIHBsdWdpbi5zeW5jLnRvZ2dsZURpYWxvZ0xpbmsoKTsKICB0aGlzLmluaXRpYWxpemVSZWdpc3RlcmVkKCk7CgogIGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKTsKICBpZihPYmplY3Qua2V5cyh0aGlzLndhaXRpbmdJbml0aWFsaXplKS5sZW5ndGggPiAwKSB7CiAgICB0aGlzLnRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtfdGhpcy5pbml0aWFsaXplV29ya2VyKCl9LCAxMDAwMCk7CiAgfQp9Ci8vLy8gZW5kIFJlZ2lzdGVyZWRQbHVnaW5zRmllbGRzCgoKCgovLy8vIEZpbGVTZWFyY2hlcgovLwovLyBhc3NpZ25JZENhbGxiYWNrIGZ1bmN0aW9uIGZvcm1hdDogZnVuY3Rpb24oaWQpCi8vIGFsbG93IHlvdSB0byBhc3NpZ24gdGhlIGZpbGUvZm9sZGVyIGlkIGVsc2V3aGVyZQovLwovLyBmYWlsZWRDYWxsYmFjayBmdW5jdGlvbiBmb3JtYXQ6IGZ1bmN0aW9uKCkKLy8gY2FsbCB3aGVuIHRoZSBmaWxlL2ZvbGRlciBjb3VsZG4ndCBjcmVhdGUKd2luZG93LnBsdWdpbi5zeW5jLkZpbGVTZWFyY2hlciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAvLyByZXR1cm4gb2JqZWN0IGNyZWF0ZWQgcHJldmlvdXNseQogIGlmKHRoaXMuaW5zdGFuY2VzW29wdGlvbnNbJ2ZpbGVOYW1lJ11dKSByZXR1cm4gdGhpcy5pbnN0YW5jZXNbb3B0aW9uc1snZmlsZU5hbWUnXV07CgogIHRoaXMuZmlsZU5hbWUgPSBvcHRpb25zWydmaWxlTmFtZSddOwogIHRoaXMuZGVzY3JpcHRpb24gPSBvcHRpb25zWydkZXNjcmlwdGlvbiddOwogIHRoaXMuaXNGb2xkZXIgPSBvcHRpb25zWydpc0ZvbGRlciddOwoKICB0aGlzLmZvcmNlID0gZmFsc2U7CiAgdGhpcy5wYXJlbnQgPSBudWxsOwogIHRoaXMuZmlsZUlkID0gbnVsbDsKICB0aGlzLnJldHJ5Q291bnQgPSAwOwogIHRoaXMubG9hZEZpbGVJZCgpOwoKICB0aGlzLmluc3RhbmNlc1t0aGlzLmZpbGVOYW1lXSA9IHRoaXM7Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5GaWxlU2VhcmNoZXIucHJvdG90eXBlLmluc3RhbmNlcyA9IHt9Owp3aW5kb3cucGx1Z2luLnN5bmMuRmlsZVNlYXJjaGVyLnByb3RvdHlwZS5SRVRSWV9MSU1JVCA9IDI7CndpbmRvdy5wbHVnaW4uc3luYy5GaWxlU2VhcmNoZXIucHJvdG90eXBlLk1JTUVUWVBFX0ZJTEUgPSAnYXBwbGljYXRpb24vdm5kLmdvb2dsZS1hcHBzLmRyaXZlLXNkayc7CndpbmRvdy5wbHVnaW4uc3luYy5GaWxlU2VhcmNoZXIucHJvdG90eXBlLk1JTUVUWVBFX0ZPTERFUiA9ICdhcHBsaWNhdGlvbi92bmQuZ29vZ2xlLWFwcHMuZm9sZGVyJzsKd2luZG93LnBsdWdpbi5zeW5jLkZpbGVTZWFyY2hlci5wcm90b3R5cGUucGFyZW50TmFtZSA9ICdJSVRDLVNZTkMtREFUQS1WMic7CndpbmRvdy5wbHVnaW4uc3luYy5GaWxlU2VhcmNoZXIucHJvdG90eXBlLnBhcmVudERlc2NyaXB0aW9uID0gJ1N0b3JlIElJVEMgc3luYyBkYXRhJzsKCndpbmRvdy5wbHVnaW4uc3luYy5GaWxlU2VhcmNoZXIucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbihmb3JjZSwgYXNzaWduSWRDYWxsYmFjaywgZmFpbGVkQ2FsbGJhY2spIHsKICB0aGlzLmZvcmNlID0gZm9yY2U7CiAgLy8gdGhyb3cgZXJyb3IgaWYgdG9vIG1hbnkgcmV0cnkKICBpZih0aGlzLnJldHJ5Q291bnQgPj0gdGhpcy5SRVRSWV9MSU1JVCkgewogICAgcGx1Z2luLnN5bmMubG9nZ2VyLmxvZygnVG9vIG1hbnkgZmlsZSBvcGVyYXRpb246ICcgKyB0aGlzLmZpbGVOYW1lKTsKICAgIGZhaWxlZENhbGxiYWNrKCk7CiAgICByZXR1cm47CiAgfQogIGlmKHRoaXMuZm9yY2UpIHRoaXMucmV0cnlDb3VudCsrOwoKICBpZih0aGlzLmlzRm9sZGVyKSB7CiAgICB0aGlzLmluaXRGaWxlKGFzc2lnbklkQ2FsbGJhY2ssIGZhaWxlZENhbGxiYWNrKTsKICB9IGVsc2UgewogICAgdGhpcy5pbml0UGFyZW50KGFzc2lnbklkQ2FsbGJhY2ssIGZhaWxlZENhbGxiYWNrKTsKICB9Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5GaWxlU2VhcmNoZXIucHJvdG90eXBlLmluaXRGaWxlID0gZnVuY3Rpb24oYXNzaWduSWRDYWxsYmFjaywgZmFpbGVkQ2FsbGJhY2spIHsKICAvLyBJZiBub3QgZm9yY2Ugc2VhcmNoIGFuZCBoYXZlIGNhY2hlZCBmaWxlSWQsIHJldHVybiB0aGUgZmlsZUlkCiAgaWYoIXRoaXMuZm9yY2UgJiYgdGhpcy5maWxlSWQpIHsKICAgIGFzc2lnbklkQ2FsbGJhY2sodGhpcy5maWxlSWQpOwogICAgcmV0dXJuOwogIH0KCiAgdmFyIHNlYXJjaENhbGxiYWNrLCBjcmVhdGVDYWxsYmFjaywgaGFuZGxlRmlsZUlkLCBoYW5kbGVGYWlsZWQsIF90aGlzOwogIF90aGlzID0gdGhpczsKCiAgaGFuZGxlRmlsZUlkID0gZnVuY3Rpb24oaWQpIHsKICAgIF90aGlzLmZpbGVJZCA9IGlkOwogICAgX3RoaXMuc2F2ZUZpbGVJZCgpOwogICAgYXNzaWduSWRDYWxsYmFjayhpZCk7CiAgfTsKCiAgaGFuZGxlRmFpbGVkID0gZnVuY3Rpb24ocmVzcCkgewogICAgX3RoaXMuZmlsZUlkID0gbnVsbDsKICAgIF90aGlzLnNhdmVGaWxlSWQoKTsKICAgIHBsdWdpbi5zeW5jLmxvZ2dlci5sb2coJ0ZpbGUgb3BlcmF0aW9uIGZhaWxlZDogJyArIChyZXNwLmVycm9yIHx8ICd1bmtub3duIGVycm9yJykpOwogICAgZmFpbGVkQ2FsbGJhY2socmVzcCk7CiAgfQoKICBjcmVhdGVDYWxsYmFjayA9IGZ1bmN0aW9uKHJlc3ApIHsKICAgIGlmKHJlc3AuaWQpIHsKICAgICAgaGFuZGxlRmlsZUlkKHJlc3AuaWQpOyAvLyBmaWxlIGNyZWF0ZWQKICAgIH0gZWxzZSB7CiAgICAgIGhhbmRsZUZhaWxlZChyZXNwKSAvLyBjb3VsZCBub3QgY3JlYXRlIGZpbGUKICAgIH0KICB9OwoKICBzZWFyY2hDYWxsYmFjayA9IGZ1bmN0aW9uKHJlc3ApIHsKICAgIGlmKHJlc3AuaXRlbXMgJiYgcmVzcC5pdGVtc1swXSkgewogICAgICBoYW5kbGVGaWxlSWQocmVzcC5pdGVtc1swXS5pZCk7Ly8gZmlsZSBmb3VuZAogICAgfSBlbHNlIGlmKCFyZXNwLmVycm9yKSB7CiAgICAgIF90aGlzLmNyZWF0ZUZpbGVPckZvbGRlcihjcmVhdGVDYWxsYmFjayk7IC8vIGZpbGUgbm90IGZvdW5kLCBjcmVhdGUgZmlsZQogICAgfSBlbHNlIHsKICAgICAgaGFuZGxlRmFpbGVkKHJlc3ApOyAvLyBFcnJvcgogICAgfQogIH07CgogIHRoaXMuc2VhcmNoRmlsZU9yRm9sZGVyKHNlYXJjaENhbGxiYWNrKTsKfQoKd2luZG93LnBsdWdpbi5zeW5jLkZpbGVTZWFyY2hlci5wcm90b3R5cGUuaW5pdFBhcmVudCA9IGZ1bmN0aW9uKGFzc2lnbklkQ2FsbGJhY2ssIGZhaWxlZENhbGxiYWNrKSB7CiAgdmFyIHBhcmVudEFzc2lnbklkQ2FsbGJhY2ssIHBhcmVudEZhaWxlZENhbGxiYWNrLCBfdGhpczsKICBfdGhpcyA9IHRoaXM7CgogIHBhcmVudEFzc2lnbklkQ2FsbGJhY2sgPSBmdW5jdGlvbihpZCkgewogICAgX3RoaXMuaW5pdEZpbGUoYXNzaWduSWRDYWxsYmFjaywgZmFpbGVkQ2FsbGJhY2spOwogIH0KCiAgcGFyZW50RmFpbGVkQ2FsbGJhY2sgPSBmdW5jdGlvbihyZXNwKSB7CiAgICBfdGhpcy5maWxlSWQgPSBudWxsOwogICAgX3RoaXMuc2F2ZUZpbGVJZCgpOwogICAgcGx1Z2luLnN5bmMubG9nZ2VyLmxvZygnRmlsZSBvcGVyYXRpb24gZmFpbGVkOiAnICsgKHJlc3AuZXJyb3IgfHwgJ3Vua25vd24gZXJyb3InKSk7CiAgICBmYWlsZWRDYWxsYmFjayhyZXNwKTsKICB9CgogIHRoaXMucGFyZW50ID0gbmV3IHBsdWdpbi5zeW5jLkZpbGVTZWFyY2hlcih7J2ZpbGVOYW1lJzogdGhpcy5wYXJlbnROYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJzogdGhpcy5wYXJlbnREZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpc0ZvbGRlcic6IHRydWV9KTsKICB0aGlzLnBhcmVudC5pbml0aWFsaXplKHRoaXMuZm9yY2UsIHBhcmVudEFzc2lnbklkQ2FsbGJhY2ssIHBhcmVudEZhaWxlZENhbGxiYWNrKTsKfQoKd2luZG93LnBsdWdpbi5zeW5jLkZpbGVTZWFyY2hlci5wcm90b3R5cGUuY3JlYXRlRmlsZU9yRm9sZGVyID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICB2YXIgX3RoaXMgPSB0aGlzOwogIGdhcGkuY2xpZW50LmxvYWQoJ2RyaXZlJywgJ3YyJywgZnVuY3Rpb24oKSB7CiAgICBnYXBpLmNsaWVudC5kcml2ZS5maWxlcy5pbnNlcnQoX3RoaXMuZ2V0Q3JlYXRlT3B0aW9uKCkpLmV4ZWN1dGUoY2FsbGJhY2spOwogIH0pOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuRmlsZVNlYXJjaGVyLnByb3RvdHlwZS5zZWFyY2hGaWxlT3JGb2xkZXIgPSBmdW5jdGlvbihjYWxsYmFjaykgewogIHZhciBfdGhpcyA9IHRoaXM7CiAgZ2FwaS5jbGllbnQubG9hZCgnZHJpdmUnLCAndjInLCBmdW5jdGlvbigpIHsKICAgIGdhcGkuY2xpZW50LmRyaXZlLmZpbGVzLmxpc3QoX3RoaXMuZ2V0U2VhcmNoT3B0aW9uKCkpLmV4ZWN1dGUoY2FsbGJhY2spOwogIH0pOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuRmlsZVNlYXJjaGVyLnByb3RvdHlwZS5nZXRDcmVhdGVPcHRpb24gPSBmdW5jdGlvbigpIHsKICB2YXIgcmVzb3VyY2UgPSB7CiAgICAndGl0bGUnOiB0aGlzLmZpbGVOYW1lLAogICAgJ2Rlc2NyaXB0aW9uJzogdGhpcy5kZXNjcmlwdGlvbiwKICAgICdtaW1lVHlwZSc6ICh0aGlzLmlzRm9sZGVyID8gdGhpcy5NSU1FVFlQRV9GT0xERVIgOiB0aGlzLk1JTUVUWVBFX0ZJTEUpCiAgfTsKICBpZih0aGlzLnBhcmVudCkgJC5leHRlbmQocmVzb3VyY2UsIHsncGFyZW50cyc6IFt7J2lkJzogdGhpcy5wYXJlbnQuZmlsZUlkfV19KTsKCiAgcmV0dXJuIHsnY29udmVydCc6ICdmYWxzZScsCiAgICAgICAgICAnb2NyJzogJ2ZhbHNlJywKICAgICAgICAgICdyZXNvdXJjZSc6IHJlc291cmNlfTsKfQoKd2luZG93LnBsdWdpbi5zeW5jLkZpbGVTZWFyY2hlci5wcm90b3R5cGUuZ2V0U2VhcmNoT3B0aW9uID0gZnVuY3Rpb24oKSB7CiAgdmFyIHEgPSAndGl0bGUgPSAiJyArIHRoaXMuZmlsZU5hbWUgKyciIGFuZCB0cmFzaGVkID0gZmFsc2UnOwogIGlmKHRoaXMucGFyZW50KSBxICs9ICcgYW5kICInICsgdGhpcy5wYXJlbnQuZmlsZUlkICsgJyIgaW4gcGFyZW50cyc7CiAgcmV0dXJuIHsncSc6IHF9Owp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuRmlsZVNlYXJjaGVyLnByb3RvdHlwZS5sb2NhbFN0b3JhZ2VLZXkgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gJ3N5bmMtZmlsZS0nICsgdGhpcy5maWxlTmFtZTsKfQoKd2luZG93LnBsdWdpbi5zeW5jLkZpbGVTZWFyY2hlci5wcm90b3R5cGUuc2F2ZUZpbGVJZCA9IGZ1bmN0aW9uKCkgewogIGlmKHRoaXMuZmlsZUlkKSB7CiAgICBsb2NhbFN0b3JhZ2VbdGhpcy5sb2NhbFN0b3JhZ2VLZXkoKV0gPSB0aGlzLmZpbGVJZDsKICB9IGVsc2UgewogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5sb2NhbFN0b3JhZ2VLZXkoKSk7CiAgfQp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuRmlsZVNlYXJjaGVyLnByb3RvdHlwZS5sb2FkRmlsZUlkID0gZnVuY3Rpb24oKSB7CiAgdmFyIHN0b3JlZEZpbGVJZCA9IGxvY2FsU3RvcmFnZVt0aGlzLmxvY2FsU3RvcmFnZUtleSgpXTsKICBpZihzdG9yZWRGaWxlSWQpIHRoaXMuZmlsZUlkID0gc3RvcmVkRmlsZUlkOwp9Ci8vLy8gZW5kIEZpbGVTZWFyY2hlcgoKCgoKLy8vLyBBdXRob3JpemVyCi8vIGF1dGhvcml6ZSB1c2VyJ3MgZ29vZ2xlIGFjY291bnQKd2luZG93LnBsdWdpbi5zeW5jLkF1dGhvcml6ZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgdGhpcy5hdXRoQ2FsbGJhY2sgPSBvcHRpb25zWydhdXRoQ2FsbGJhY2snXTsKICB0aGlzLmF1dGhvcml6aW5nID0gZmFsc2U7CiAgdGhpcy5hdXRob3JpemVkID0gZmFsc2U7CiAgdGhpcy5pc0F1dGhlZCA9IHRoaXMuaXNBdXRoZWQuYmluZCh0aGlzKTsKICB0aGlzLmlzQXV0aG9yaXppbmcgPSB0aGlzLmlzQXV0aG9yaXppbmcuYmluZCh0aGlzKTsKICB0aGlzLmF1dGhvcml6ZSA9IHRoaXMuYXV0aG9yaXplLmJpbmQodGhpcyk7Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5BdXRob3JpemVyLnByb3RvdHlwZS5DTElFTlRfSUQgPSAnODkzODA2MTEwNzMyLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tJzsKd2luZG93LnBsdWdpbi5zeW5jLkF1dGhvcml6ZXIucHJvdG90eXBlLlNDT1BFUyA9IFsnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYXV0aC9kcml2ZS5maWxlJywgJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL2F1dGgvZHJpdmUubWV0YWRhdGEucmVhZG9ubHknXTsKCndpbmRvdy5wbHVnaW4uc3luYy5BdXRob3JpemVyLnByb3RvdHlwZS5pc0F1dGhlZCA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB0aGlzLmF1dGhvcml6ZWQ7Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5BdXRob3JpemVyLnByb3RvdHlwZS5pc0F1dGhvcml6aW5nID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMuYXV0aG9yaXppbmc7Cn0Kd2luZG93LnBsdWdpbi5zeW5jLkF1dGhvcml6ZXIucHJvdG90eXBlLmFkZEF1dGhDYWxsYmFjayA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgaWYodHlwZW9mKHRoaXMuYXV0aENhbGxiYWNrKSA9PT0gJ2Z1bmN0aW9uJykgdGhpcy5hdXRoQ2FsbGJhY2sgPSBbdGhpcy5hdXRoQ2FsbGJhY2tdOwogIHRoaXMuYXV0aENhbGxiYWNrLnB1c2goY2FsbGJhY2spOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuQXV0aG9yaXplci5wcm90b3R5cGUuYXV0aENvbXBsZXRlID0gZnVuY3Rpb24oKSB7CiAgdGhpcy5hdXRob3JpemluZyA9IGZhbHNlOwogIGlmKHRoaXMuYXV0aENhbGxiYWNrKSB7CiAgICBpZih0eXBlb2YodGhpcy5hdXRoQ2FsbGJhY2spID09PSAnZnVuY3Rpb24nKSB0aGlzLmF1dGhDYWxsYmFjaygpOwogICAgaWYodGhpcy5hdXRoQ2FsbGJhY2sgaW5zdGFuY2VvZiBBcnJheSAmJiB0aGlzLmF1dGhDYWxsYmFjay5sZW5ndGggPiAwKSB7CiAgICAgICQuZWFjaCh0aGlzLmF1dGhDYWxsYmFjaywgZnVuY3Rpb24oaW5kLCBmdW5jKSB7CiAgICAgICAgZnVuYygpOwogICAgICB9KTsKICAgIH0KICB9Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5BdXRob3JpemVyLnByb3RvdHlwZS5hdXRob3JpemUgPSBmdW5jdGlvbihwb3B1cCkgewogIHRoaXMuYXV0aG9yaXppbmcgPSB0cnVlOwogIHRoaXMuYXV0aG9yaXplZCA9IGZhbHNlOwogIHZhciBoYW5kbGVBdXRoUmVzdWx0LCBfdGhpczsKICBfdGhpcyA9IHRoaXM7CgogIGhhbmRsZUF1dGhSZXN1bHQgPSBmdW5jdGlvbihhdXRoUmVzdWx0KSB7CiAgICBpZihhdXRoUmVzdWx0ICYmICFhdXRoUmVzdWx0LmVycm9yKSB7CiAgICAgIF90aGlzLmF1dGhvcml6ZWQgPSB0cnVlOwogICAgICBwbHVnaW4uc3luYy5sb2dnZXIubG9nKCdBdXRob3JpemVkJyk7CiAgICB9IGVsc2UgewogICAgICBfdGhpcy5hdXRob3JpemVkID0gZmFsc2U7CiAgICAgIHZhciBlcnJvciA9IChhdXRoUmVzdWx0ICYmIGF1dGhSZXN1bHQuZXJyb3IpID8gYXV0aFJlc3VsdC5lcnJvciA6ICdub3QgYXV0aG9yaXplZCc7CiAgICAgIHBsdWdpbi5zeW5jLmxvZ2dlci5sb2coJ0F1dGhvcml6YXRpb24gZXJyb3I6ICcgKyBlcnJvcik7CiAgICB9CiAgICBfdGhpcy5hdXRoQ29tcGxldGUoKTsKICB9OwoKICBnYXBpLmF1dGguYXV0aG9yaXplKHsnY2xpZW50X2lkJzogdGhpcy5DTElFTlRfSUQsICdzY29wZSc6IHRoaXMuU0NPUEVTLCAnaW1tZWRpYXRlJzogIXBvcHVwfQogICAgLCBoYW5kbGVBdXRoUmVzdWx0KTsKfQovLy8vIGVuZCBBdXRob3JpemVyCgoKCgovLy8vIExvZ2dlcgp3aW5kb3cucGx1Z2luLnN5bmMuTG9nZ2VyID0gZnVuY3Rpb24ob3B0aW9ucykgewogIHRoaXMubG9nTGltaXQgPSBvcHRpb25zWydsb2dMaW1pdCddOwogIHRoaXMubG9nVXBkYXRlQ2FsbGJhY2sgPSBvcHRpb25zWydsb2dVcGRhdGVDYWxsYmFjayddOwogIHRoaXMubG9ncyA9IFtdOwogIHRoaXMubG9nID0gdGhpcy5sb2cuYmluZCh0aGlzKTsKICB0aGlzLmdldExvZ3MgPSB0aGlzLmdldExvZ3MuYmluZCh0aGlzKTsKfQoKd2luZG93LnBsdWdpbi5zeW5jLkxvZ2dlci5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24obWVzc2FnZSkgewogIHZhciBsb2cgPSB7J3RpbWUnOiBuZXcgRGF0ZSgpLCAnbWVzc2FnZSc6IG1lc3NhZ2V9OwogIHRoaXMubG9ncy51bnNoaWZ0KGxvZyk7CiAgaWYodGhpcy5sb2dzLmxlbmd0aCA+IHRoaXMubG9nTGltaXQpIHsKICAgIHRoaXMubG9ncy5wb3AoKTsKICB9CiAgaWYodGhpcy5sb2dVcGRhdGVDYWxsYmFjaykgdGhpcy5sb2dVcGRhdGVDYWxsYmFjayh0aGlzLmdldExvZ3MoKSk7Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5Mb2dnZXIucHJvdG90eXBlLmdldExvZ3MgPSBmdW5jdGlvbigpIHsKICB2YXIgYWxsTG9ncyA9ICcnOwogICQuZWFjaCh0aGlzLmxvZ3MsIGZ1bmN0aW9uKGluZCxsb2cpIHsKICAgIGFsbExvZ3MgKz0gbG9nLnRpbWUudG9Mb2NhbGVUaW1lU3RyaW5nKCkgKyAnOiAnICsgbG9nLm1lc3NhZ2UgKyAnPGJyIC8+JzsKICB9KTsKICByZXR1cm4gYWxsTG9nczsKfQoKCi8vLy8gZW5kIExvZ2dlcgoKCgoKLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvODgwOTQ3Mi8yMzIyNjYwCi8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzcyMjE3OTcvMjMyMjY2MAovLyBXaXRoIGZvcm1hdCBmaXhpbmc6IHh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCB3aGVyZSB5IGluIFs4LDksYSxiXQp3aW5kb3cucGx1Z2luLnN5bmMuZ2VuZXJhdGVVVUlEID0gZnVuY3Rpb24oKSB7CiAgaWYod2luZG93LmNyeXB0byAmJiB3aW5kb3cuY3J5cHRvLmdldFJhbmRvbVZhbHVlcykgewogICAgdmFyIGJ1ZiA9IG5ldyBVaW50MTZBcnJheSg4KTsKICAgIHdpbmRvdy5jcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGJ1Zik7CiAgICB2YXIgUzQgPSBmdW5jdGlvbihudW0pIHsKICAgICAgdmFyIHJldCA9IG51bS50b1N0cmluZygxNik7CiAgICAgIHJldHVybiAnMDAwJy5zdWJzdHJpbmcoMCwgNC1yZXQubGVuZ3RoKSArIHJldDsKICAgIH07CiAgICB2YXIgeXh4eCA9IGZ1bmN0aW9uKG51bSkgewogICAgICByZXR1cm4gbnVtJjB4M2ZmZnwweDgwMDA7CiAgICB9CiAgICByZXR1cm4gKFM0KGJ1ZlswXSkrUzQoYnVmWzFdKSsnLScrUzQoYnVmWzJdKSsnLTQnK1M0KGJ1ZlszXSkuc3Vic3RyaW5nKDEpKyctJytTNCh5eHh4KGJ1Zls0XSkpKyctJytTNChidWZbNV0pK1M0KGJ1Zls2XSkrUzQoYnVmWzddKSk7CiAgfSBlbHNlIHsKICAgIHZhciBkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICB2YXIgdXVpZCA9ICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24oYykgewogICAgICAgIHZhciByID0gKGQgKyBNYXRoLnJhbmRvbSgpKjE2KSUxNiB8IDA7CiAgICAgICAgZCA9IE1hdGguZmxvb3IoZC8xNik7CiAgICAgICAgcmV0dXJuIChjPT0neCcgPyByIDogKHImMHgzfDB4OCkpLnRvU3RyaW5nKDE2KTsKICAgIH0pOwogICAgcmV0dXJuIHV1aWQ7CiAgfQp9Cgp3aW5kb3cucGx1Z2luLnN5bmMuc3RvcmVMb2NhbCA9IGZ1bmN0aW9uKG1hcHBpbmcpIHsKICBpZih0eXBlb2YocGx1Z2luLnN5bmNbbWFwcGluZy5maWVsZF0pICE9PSAndW5kZWZpbmVkJyAmJiBwbHVnaW4uc3luY1ttYXBwaW5nLmZpZWxkXSAhPT0gbnVsbCkgewogICAgbG9jYWxTdG9yYWdlW21hcHBpbmcua2V5XSA9IEpTT04uc3RyaW5naWZ5KHBsdWdpbi5zeW5jW21hcHBpbmcuZmllbGRdKTsKICB9IGVsc2UgewogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0obWFwcGluZy5rZXkpOwogIH0KfQoKd2luZG93LnBsdWdpbi5zeW5jLmxvYWRMb2NhbCA9IGZ1bmN0aW9uKG1hcHBpbmcpIHsKICB2YXIgb2JqZWN0SlNPTiA9IGxvY2FsU3RvcmFnZVttYXBwaW5nLmtleV07CiAgaWYoIW9iamVjdEpTT04pIHJldHVybjsKICBwbHVnaW4uc3luY1ttYXBwaW5nLmZpZWxkXSA9IG1hcHBpbmcuY29udmVydEZ1bmMgCiAgICAgICAgICAgICAgICAgICAgICAgICAgPyBtYXBwaW5nLmNvbnZlcnRGdW5jKEpTT04ucGFyc2Uob2JqZWN0SlNPTikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgOiBKU09OLnBhcnNlKG9iamVjdEpTT04pOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMubG9hZFVVSUQgPSBmdW5jdGlvbigpIHsKICBwbHVnaW4uc3luYy5sb2FkTG9jYWwocGx1Z2luLnN5bmMuS0VZX1VVSUQpOwogIGlmKCFwbHVnaW4uc3luYy51dWlkKSB7CiAgICBwbHVnaW4uc3luYy51dWlkID0gcGx1Z2luLnN5bmMuZ2VuZXJhdGVVVUlEKCk7CiAgICBwbHVnaW4uc3luYy5zdG9yZUxvY2FsKHBsdWdpbi5zeW5jLktFWV9VVUlEKTsKICB9Cn0KCndpbmRvdy5wbHVnaW4uc3luYy51cGRhdGVMb2cgPSBmdW5jdGlvbihtZXNzYWdlcykgewogICQoJyNzeW5jLWxvZycpLmh0bWwobWVzc2FnZXMpOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMudG9nZ2xlQXV0aEJ1dHRvbiA9IGZ1bmN0aW9uKCkgewogIHZhciBhdXRoZWQsIGF1dGhvcml6aW5nOwogIGF1dGhlZCA9IHBsdWdpbi5zeW5jLmF1dGhvcml6ZXIuaXNBdXRoZWQoKTsKICBhdXRob3JpemluZyA9IHBsdWdpbi5zeW5jLmF1dGhvcml6ZXIuaXNBdXRob3JpemluZygpOwoKICAkKCcjc3luYy1hdXRoQnV0dG9uJykuaHRtbChhdXRoZWQgPyAnQXV0aG9yaXplZCcgOiAnQXV0aG9yaXplJyk7CgogICQoJyNzeW5jLWF1dGhCdXR0b24nKS5hdHRyKCdkaXNhYmxlZCcsIChhdXRoZWQgfHwgYXV0aG9yaXppbmcpKTsKICAkKCcjc3luYy1hdXRoQnV0dG9uJykudG9nZ2xlQ2xhc3MoJ3N5bmMtYXV0aEJ1dHRvbi1kaW1tZWQnLCBhdXRoZWQgfHwgYXV0aG9yaXppbmcpOwp9Cgp3aW5kb3cucGx1Z2luLnN5bmMudG9nZ2xlRGlhbG9nTGluayA9IGZ1bmN0aW9uKCkgewogIHZhciBhdXRoZWQsIGFueUZhaWw7CiAgYXV0aGVkID0gcGx1Z2luLnN5bmMuYXV0aG9yaXplci5pc0F1dGhlZCgpOwogIGFueUZhaWwgPSBwbHVnaW4uc3luYy5yZWdpc3RlcmVkUGx1Z2luc0ZpZWxkcy5hbnlGYWlsOwoKICAkKCcjc3luYy1zaG93LWRpYWxvZycpLnRvZ2dsZUNsYXNzKCdzeW5jLXNob3ctZGlhbG9nLWVycm9yJywgIWF1dGhlZCB8fCBhbnlGYWlsKTsKfQoKd2luZG93LnBsdWdpbi5zeW5jLnNob3dEaWFsb2cgPSBmdW5jdGlvbigpIHsKICB3aW5kb3cuZGlhbG9nKHtodG1sOiBwbHVnaW4uc3luYy5kaWFsb2dIVE1MLCB0aXRsZTogJ1N5bmMnLCBtb2RhbDogdHJ1ZSwgaWQ6ICdzeW5jLXNldHRpbmcnfSk7CiAgcGx1Z2luLnN5bmMudG9nZ2xlQXV0aEJ1dHRvbigpOwogIHBsdWdpbi5zeW5jLnRvZ2dsZURpYWxvZ0xpbmsoKTsKICBwbHVnaW4uc3luYy51cGRhdGVMb2cocGx1Z2luLnN5bmMubG9nZ2VyLmdldExvZ3MoKSk7Cn0KCndpbmRvdy5wbHVnaW4uc3luYy5zZXR1cERpYWxvZyA9IGZ1bmN0aW9uKCkgewogIHBsdWdpbi5zeW5jLmRpYWxvZ0hUTUwgPSAnPGRpdiBpZD0ic3luYy1kaWFsb2ciPicKICAgICAgICAgICAgICAgICAgICAgICAgICsgJzxidXR0b24gaWQ9InN5bmMtYXV0aEJ1dHRvbiIgY2xhc3M9InN5bmMtYXV0aEJ1dHRvbi1kaW1tZWQiICcKICAgICAgICAgICAgICAgICAgICAgICAgICsgJ29uY2xpY2s9InNldFRpbWVvdXQoZnVuY3Rpb24oKXt3aW5kb3cucGx1Z2luLnN5bmMuYXV0aG9yaXplci5hdXRob3JpemUodHJ1ZSl9LCAxKSIgJwogICAgICAgICAgICAgICAgICAgICAgICAgKyAnZGlzYWJsZWQ9ImRpc2FibGVkIj5BdXRob3JpemU8L2J1dHRvbj4nCiAgICAgICAgICAgICAgICAgICAgICAgICArICc8ZGl2IGlkPSJzeW5jLWxvZyI+PC9kaXY+JwogICAgICAgICAgICAgICAgICAgICAgICAgKyAnPC9kaXY+JzsKICAkKCcjdG9vbGJveCcpLmFwcGVuZCgnPGEgaWQ9InN5bmMtc2hvdy1kaWFsb2ciIG9uY2xpY2s9IndpbmRvdy5wbHVnaW4uc3luYy5zaG93RGlhbG9nKCk7Ij5TeW5jPC9hPiAnKTsKfQoKd2luZG93LnBsdWdpbi5zeW5jLnNldHVwQ1NTID0gZnVuY3Rpb24oKSB7CiAgJCgiPHN0eWxlPiIpCiAgICAucHJvcCgidHlwZSIsICJ0ZXh0L2NzcyIpCiAgICAuaHRtbCgiLnN5bmMtYXV0aEJ1dHRvbi1kaW1tZWQge1wKICAgICAgICAgICAgb3BhY2l0eTogMC41O1wKICAgICAgICAgIH1cCiAgICAgICAgICAuc3luYy1zaG93LWRpYWxvZy1lcnJvciB7XAogICAgICAgICAgICBjb2xvcjogI0ZGMjIyMjtcCiAgICAgICAgICB9XAogICAgICAgICAgI3N5bmMtbG9nIHtcCiAgICAgICAgICAgIGhlaWdodDogMzAwcHg7XAogICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7XAogICAgICAgICAgICB3aGl0ZS1zcGFjZTogLW1vei1wcmUtd3JhcDtcCiAgICAgICAgICAgIHdoaXRlLXNwYWNlOiAtby1wcmUtd3JhcDtcCiAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDtcCiAgICAgICAgICAgIG92ZXJmbG93LXk6IGF1dG87XAogICAgICAgICAgfSIpCiAgLmFwcGVuZFRvKCJoZWFkIik7Cn0KCnZhciBzZXR1cCA9ICBmdW5jdGlvbigpIHsKICB3aW5kb3cucGx1Z2luLnN5bmMubG9nZ2VyID0gbmV3IHBsdWdpbi5zeW5jLkxvZ2dlcih7J2xvZ0xpbWl0JzoxMCwgJ2xvZ1VwZGF0ZUNhbGxiYWNrJzogcGx1Z2luLnN5bmMudXBkYXRlTG9nfSk7CiAgd2luZG93LnBsdWdpbi5zeW5jLmxvYWRVVUlEKCk7CiAgd2luZG93LnBsdWdpbi5zeW5jLnNldHVwQ1NTKCk7CiAgd2luZG93LnBsdWdpbi5zeW5jLnNldHVwRGlhbG9nKCk7CgogIHdpbmRvdy5wbHVnaW4uc3luYy5hdXRob3JpemVyID0gbmV3IHdpbmRvdy5wbHVnaW4uc3luYy5BdXRob3JpemVyKHsKICAgICdhdXRoQ2FsbGJhY2snOiBbcGx1Z2luLnN5bmMudG9nZ2xlQXV0aEJ1dHRvbiwgcGx1Z2luLnN5bmMudG9nZ2xlRGlhbG9nTGlua10KICB9KTsKICB3aW5kb3cucGx1Z2luLnN5bmMucmVnaXN0ZXJlZFBsdWdpbnNGaWVsZHMgPSBuZXcgd2luZG93LnBsdWdpbi5zeW5jLlJlZ2lzdGVyZWRQbHVnaW5zRmllbGRzKHsKICAgICdhdXRob3JpemVyJzogd2luZG93LnBsdWdpbi5zeW5jLmF1dGhvcml6ZXIKICB9KTsKCiAgdmFyIEdPT0dMRUFQSSA9ICdodHRwczovL2FwaXMuZ29vZ2xlLmNvbS9qcy9hcGkuanMnOwogIGxvYWQoR09PR0xFQVBJKS50aGVuUnVuKGZ1bmN0aW9uKCkgewogICAgZ2FwaS5sb2FkKCdhdXRoOmNsaWVudCxkcml2ZS1yZWFsdGltZSxkcml2ZS1zaGFyZScsIHdpbmRvdy5wbHVnaW4uc3luYy5hdXRob3JpemVyLmF1dGhvcml6ZSk7CiAgfSk7Cn0KCi8vIFBMVUdJTiBFTkQgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCnNldHVwLmluZm8gPSBwbHVnaW5faW5mbzsgLy9hZGQgdGhlIHNjcmlwdCBpbmZvIGRhdGEgdG8gdGhlIGZ1bmN0aW9uIGFzIGEgcHJvcGVydHkKaWYoIXdpbmRvdy5ib290UGx1Z2lucykgd2luZG93LmJvb3RQbHVnaW5zID0gW107CndpbmRvdy5ib290UGx1Z2lucy5wdXNoKHNldHVwKTsKLy8gaWYgSUlUQyBoYXMgYWxyZWFkeSBib290ZWQsIGltbWVkaWF0ZWx5IHJ1biB0aGUgJ3NldHVwJyBmdW5jdGlvbgppZih3aW5kb3cuaWl0Y0xvYWRlZCAmJiB0eXBlb2Ygc2V0dXAgPT09ICdmdW5jdGlvbicpIHNldHVwKCk7Cn0gLy8gd3JhcHBlciBlbmQKLy8gaW5qZWN0IGNvZGUgaW50byBzaXRlIGNvbnRleHQKdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwp2YXIgaW5mbyA9IHt9OwppZiAodHlwZW9mIEdNX2luZm8gIT09ICd1bmRlZmluZWQnICYmIEdNX2luZm8gJiYgR01faW5mby5zY3JpcHQpIGluZm8uc2NyaXB0ID0geyB2ZXJzaW9uOiBHTV9pbmZvLnNjcmlwdC52ZXJzaW9uLCBuYW1lOiBHTV9pbmZvLnNjcmlwdC5uYW1lLCBkZXNjcmlwdGlvbjogR01faW5mby5zY3JpcHQuZGVzY3JpcHRpb24gfTsKc2NyaXB0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcoJysgd3JhcHBlciArJykoJytKU09OLnN0cmluZ2lmeShpbmZvKSsnKTsnKSk7Cihkb2N1bWVudC5ib2R5IHx8IGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5hcHBlbmRDaGlsZChzY3JpcHQpOwoKCg=="},{"name":"IITC plugin: Fly Links","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1480919552486,"data":{}},"enabled":true,"position":13,"file_url":"https://static.iitc.me/build/release/plugins/fly-links.user.js","uuid":"7d759dba-25c6-478e-88ab-dbf5075b0bdc","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGZseS1saW5rc0BmbHkKLy8gQG5hbWUgICAgICAgICAgIElJVEMgcGx1Z2luOiBGbHkgTGlua3MKLy8gQGNhdGVnb3J5ICAgICAgIExheWVyCi8vIEB2ZXJzaW9uICAgICAgICAwLjIuMS4yMDE2MTAwMy40NzQwCi8vIEB1cGRhdGVVUkwgICAgICBodHRwczovL3N0YXRpYy5paXRjLm1lL2J1aWxkL3JlbGVhc2UvcGx1Z2lucy9mbHktbGlua3MubWV0YS5qcwovLyBAZG93bmxvYWRVUkwgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3BsdWdpbnMvZmx5LWxpbmtzLnVzZXIuanMKLy8gQGRlc2NyaXB0aW9uICAgIFtpaXRjLTIwMTYtMTAtMDMtMDA0NzQwXSBDYWxjdWxhdGUgaG93IHRvIGxpbmsgdGhlIHBvcnRhbHMgdG8gY3JlYXRlIHRoZSBsYXJnZXN0IHRpZHkgc2V0IG9mIG5lc3RlZCBmaWVsZHMuIEVuYWJsZSBmcm9tIHRoZSBsYXllciBjaG9vc2VyLgovLyBAaW5jbHVkZSAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBtYXRjaCAgICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBtYXRjaCAgICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBncmFudCAgICAgICAgICBub25lCi8vID09L1VzZXJTY3JpcHQ9PQoKCmZ1bmN0aW9uIHdyYXBwZXIocGx1Z2luX2luZm8pIHsKLy8gZW5zdXJlIHBsdWdpbiBmcmFtZXdvcmsgaXMgdGhlcmUsIGV2ZW4gaWYgaWl0YyBpcyBub3QgeWV0IGxvYWRlZAppZih0eXBlb2Ygd2luZG93LnBsdWdpbiAhPT0gJ2Z1bmN0aW9uJykgd2luZG93LnBsdWdpbiA9IGZ1bmN0aW9uKCkge307CgovL1BMVUdJTiBBVVRIT1JTOiB3cml0aW5nIGEgcGx1Z2luIG91dHNpZGUgb2YgdGhlIElJVEMgYnVpbGQgZW52aXJvbm1lbnQ/IGlmIHNvLCBkZWxldGUgdGhlc2UgbGluZXMhIQovLyhsZWF2aW5nIHRoZW0gaW4gcGxhY2UgbWlnaHQgYnJlYWsgdGhlICdBYm91dCBJSVRDJyBwYWdlIG9yIGJyZWFrIHVwZGF0ZSBjaGVja3MpCnBsdWdpbl9pbmZvLmJ1aWxkTmFtZSA9ICdpaXRjJzsKcGx1Z2luX2luZm8uZGF0ZVRpbWVWZXJzaW9uID0gJzIwMTYxMDAzLjQ3NDAnOwpwbHVnaW5faW5mby5wbHVnaW5JZCA9ICdmbHktbGlua3MnOwovL0VORCBQTFVHSU4gQVVUSE9SUyBOT1RFCgoKCi8vIFBMVUdJTiBTVEFSVCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLy8gdXNlIG93biBuYW1lc3BhY2UgZm9yIHBsdWdpbgp3aW5kb3cucGx1Z2luLmZseUxpbmtzID0gZnVuY3Rpb24oKSB7fTsKCi8vIGNvbnN0IHZhbHVlcwp3aW5kb3cucGx1Z2luLmZseUxpbmtzLk1BWF9QT1JUQUxTX1RPX09CU0VSVkUgPSAxMDAwOwp3aW5kb3cucGx1Z2luLmZseUxpbmtzLk1BWF9QT1JUQUxTX1RPX0xJTksgPSAxMDA7Ci8vIHpvb20gbGV2ZWwgdXNlZCBmb3IgcHJvamVjdGluZyBwb2ludHMgYmV0d2VlbiBsYXRMbmcgYW5kIHBpeGVsIGNvb3JkaW5hdGVzLiBtYXkgYWZmZWN0IHByZWNpc2lvbiBvZiB0cmlhbmd1bGF0aW9uCndpbmRvdy5wbHVnaW4uZmx5TGlua3MuUFJPSkVDVF9aT09NID0gMTY7CgoKd2luZG93LnBsdWdpbi5mbHlMaW5rcy5saW5rc0xheWVyR3JvdXAgPSBudWxsOwp3aW5kb3cucGx1Z2luLmZseUxpbmtzLmZpZWxkc0xheWVyR3JvdXAgPSBudWxsOwoKd2luZG93LnBsdWdpbi5mbHlMaW5rcy51cGRhdGVMYXllciA9IGZ1bmN0aW9uKCkgewogIGlmICghd2luZG93Lm1hcC5oYXNMYXllcih3aW5kb3cucGx1Z2luLmZseUxpbmtzLmxpbmtzTGF5ZXJHcm91cCkgJiYKICAgICAgIXdpbmRvdy5tYXAuaGFzTGF5ZXIod2luZG93LnBsdWdpbi5mbHlMaW5rcy5maWVsZHNMYXllckdyb3VwKSkKICAgIHJldHVybjsKCiAgd2luZG93LnBsdWdpbi5mbHlMaW5rcy5saW5rc0xheWVyR3JvdXAuY2xlYXJMYXllcnMoKTsKICB3aW5kb3cucGx1Z2luLmZseUxpbmtzLmZpZWxkc0xheWVyR3JvdXAuY2xlYXJMYXllcnMoKTsKICB2YXIgY3RybCA9IFskKCcubGVhZmxldC1jb250cm9sLWxheWVycy1zZWxlY3RvciArIHNwYW46Y29udGFpbnMoIkZseSBsaW5rcyIpJykucGFyZW50KCksIAogICAgICAgICAgICAgICQoJy5sZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLXNlbGVjdG9yICsgc3Bhbjpjb250YWlucygiRmx5IGZpZWxkcyIpJykucGFyZW50KCldOwogIGlmIChPYmplY3Qua2V5cyh3aW5kb3cucG9ydGFscykubGVuZ3RoID4gd2luZG93LnBsdWdpbi5mbHlMaW5rcy5NQVhfUE9SVEFMU19UT19PQlNFUlZFKSB7CiAgICAkLmVhY2goY3RybCwgZnVuY3Rpb24oZ3VpZCwgY3RsKSB7Y3RsLmFkZENsYXNzKCdkaXNhYmxlZCcpLmF0dHIoJ3RpdGxlJywgJ1RvbyBtYW55IHBvcnRhbHM6ICcgKyBPYmplY3Qua2V5cyh3aW5kb3cucG9ydGFscykubGVuZ3RoKTt9KTsKICAgIHJldHVybjsKICB9CiAgCiAgdmFyIGxvY2F0aW9ucyA9IFtdOwoKICB2YXIgYm91bmRzID0gbWFwLmdldEJvdW5kcygpOwogICQuZWFjaCh3aW5kb3cucG9ydGFscywgZnVuY3Rpb24oZ3VpZCwgcG9ydGFsKSB7CiAgICB2YXIgbGwgPSBwb3J0YWwuZ2V0TGF0TG5nKCk7CiAgICBpZiAoYm91bmRzLmNvbnRhaW5zKGxsKSkgewogICAgICB2YXIgcCA9IG1hcC5wcm9qZWN0KHBvcnRhbC5nZXRMYXRMbmcoKSwgd2luZG93LnBsdWdpbi5mbHlMaW5rcy5QUk9KRUNUX1pPT00pOwogICAgICBsb2NhdGlvbnMucHVzaChwKTsKICAgIH0KICB9KTsKCiAgdmFyIGRpc3RhbmNlID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIE1hdGguc3FydCgoYS54IC0gYi54KSAqIChhLnggLSBiLngpICsgKGEueSAtIGIueSkgKiAoYS55IC0gYi55KSk7CiAgfTsKCiAgdmFyIGRyYXdMaW5rID0gZnVuY3Rpb24oYSwgYiwgc3R5bGUpIHsKICAgIHZhciBhbGF0bG5nID0gbWFwLnVucHJvamVjdChhLCB3aW5kb3cucGx1Z2luLmZseUxpbmtzLlBST0pFQ1RfWk9PTSk7CiAgICB2YXIgYmxhdGxuZyA9IG1hcC51bnByb2plY3QoYiwgd2luZG93LnBsdWdpbi5mbHlMaW5rcy5QUk9KRUNUX1pPT00pOwoKICAgIHZhciBwb2x5ID0gTC5wb2x5bGluZShbYWxhdGxuZywgYmxhdGxuZ10sIHN0eWxlKTsKICAgIHBvbHkuYWRkVG8od2luZG93LnBsdWdpbi5mbHlMaW5rcy5saW5rc0xheWVyR3JvdXApOwogIH0KICAKICB2YXIgZHJhd0ZpZWxkID0gZnVuY3Rpb24oYSwgYiwgYywgc3R5bGUpIHsKICAgIHZhciBhbGF0bG5nID0gbWFwLnVucHJvamVjdChhLCB3aW5kb3cucGx1Z2luLmZseUxpbmtzLlBST0pFQ1RfWk9PTSk7CiAgICB2YXIgYmxhdGxuZyA9IG1hcC51bnByb2plY3QoYiwgd2luZG93LnBsdWdpbi5mbHlMaW5rcy5QUk9KRUNUX1pPT00pOwogICAgdmFyIGNsYXRsbmcgPSBtYXAudW5wcm9qZWN0KGMsIHdpbmRvdy5wbHVnaW4uZmx5TGlua3MuUFJPSkVDVF9aT09NKTsKICAgIAogICAgdmFyIHBvbHkgPSBMLnBvbHlnb24oW2FsYXRsbmcsIGJsYXRsbmcsIGNsYXRsbmddLCBzdHlsZSk7CiAgICBwb2x5LmFkZFRvKHdpbmRvdy5wbHVnaW4uZmx5TGlua3MuZmllbGRzTGF5ZXJHcm91cCk7CiAgfQogIAogIGlmIChsb2NhdGlvbnMubGVuZ3RoID4gd2luZG93LnBsdWdpbi5mbHlMaW5rcy5NQVhfUE9SVEFMU19UT19MSU5LKSB7CiAgICAkLmVhY2goY3RybCwgZnVuY3Rpb24oZ3VpZCwgY3RsKSB7Y3RsLmFkZENsYXNzKCdkaXNhYmxlZCcpLmF0dHIoJ3RpdGxlJywgJ1RvbyBtYW55IHBvcnRhbHMgKGxpbmtlZC9vYnNlcnZlZCk6ICcgKyBsb2NhdGlvbnMubGVuZ3RoICsgJy8nICsgT2JqZWN0LmtleXMod2luZG93LnBvcnRhbHMpLmxlbmd0aCk7fSk7CiAgICByZXR1cm47CiAgfQogICQuZWFjaChjdHJsLCBmdW5jdGlvbihndWlkLCBjdGwpIHtjdGwucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJykuYXR0cigndGl0bGUnLCAncG9ydGFscyAobGlua2VkL29ic2VydmVkKTogJyArIGxvY2F0aW9ucy5sZW5ndGggKyAnLycgKyBPYmplY3Qua2V5cyh3aW5kb3cucG9ydGFscykubGVuZ3RoKTt9KTsKICAKICB2YXIgRVBTID0gMWUtOTsKICB2YXIgZGV0ID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgcmV0dXJuIGEueCAqIGIueSAtIGEueSAqIGIueCArIGIueCAqIGMueSAtIGIueSAqIGMueCArIGMueCAqIGEueSAtIGMueSAqIGEueDsKICB9CiAgCiAgdmFyIGNvbnZleEh1bGwgPSBmdW5jdGlvbihwb2ludHMpIHsKICAgIGlmIChwb2ludHMubGVuZ3RoIDwgMykKICAgICAgcmV0dXJuIFtdOwogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgdmFyIGZ1bmMgPSBmdW5jdGlvbiBfZnVuYyhhaSwgYmksIGluZGV4KSB7CiAgICAgIHZhciBtYXhkID0gMDsKICAgICAgdmFyIG1heGRpID0gLTE7CiAgICAgIHZhciBhID0gcG9pbnRzW2FpXTsKICAgICAgdmFyIGIgPSBwb2ludHNbYmldOwogICAgICB2YXIgX2luZGV4ID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kZXgubGVuZ3RoOyArK2kpIHsKICAgICAgICB2YXIgYyA9IHBvaW50c1tpbmRleFtpXV07CiAgICAgICAgdmFyIGQgPSAtZGV0KGEsIGIsIGMpOwogICAgICAgIGlmIChkID4gRVBTKSB7CiAgICAgICAgICAgIF9pbmRleC5wdXNoKGluZGV4W2ldKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1heGQgPCBkIC0gRVBTKSB7CiAgICAgICAgICBtYXhkID0gZDsKICAgICAgICAgIG1heGRpID0gaW5kZXhbaV07CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChtYXhkaSAhPSAtMSkgewogICAgICAgIF9mdW5jKGFpLCBtYXhkaSwgX2luZGV4KTsKICAgICAgICBfZnVuYyhtYXhkaSwgYmksIF9pbmRleCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0LnB1c2goYWkpOwogICAgICB9CiAgICB9CiAgICB2YXIgbWlueGkgPSAwOwogICAgdmFyIG1heHhpID0gMDsKICAgIHZhciBpbmRleCA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb2ludHMubGVuZ3RoOyArK2kpIHsKICAgICAgaW5kZXgucHVzaChpKTsKICAgICAgaWYgKHBvaW50c1ttaW54aV0ueCA+IHBvaW50c1tpXS54KQogICAgICAgIG1pbnhpID0gaTsKICAgICAgaWYgKHBvaW50c1ttYXh4aV0ueCA8IHBvaW50c1tpXS54KQogICAgICAgIG1heHhpID0gaTsKICAgIH0KICAgIGZ1bmMobWlueGksIG1heHhpLCBpbmRleCk7CiAgICBmdW5jKG1heHhpLCBtaW54aSwgaW5kZXgpOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgCiAgdmFyIGluZGV4ID0gY29udmV4SHVsbChsb2NhdGlvbnMpOwogIAogIHZhciB0cmlhbmd1bGF0ZSA9IGZ1bmN0aW9uKGluZGV4LCBsb2NhdGlvbnMpIHsKICAgIGlmIChpbmRleC5sZW5ndGggPT0gMCkKICAgICAgcmV0dXJuIHtlZGdlczogW10sIHRyaWFuZ2xlczogW119OwogICAgdmFyIGRhdGEgPSBbXTsKICAgIHZhciBzdWJ0cmlhbmd1bGF0ZSA9IGZ1bmN0aW9uIF9zdWJ0cmlhbmd1bGF0ZShhaSwgYmksIGNpLCBpbmRleCkgewogICAgICB2YXIgX2kgPSBbYWksIGJpLCBjaV0uc29ydChmdW5jdGlvbihhLGIpe3JldHVybiBhLWI7fSk7CiAgICAgIGlmIChkYXRhW19pWzBdXSA9PT0gdW5kZWZpbmVkKQogICAgICAgIGRhdGFbX2lbMF1dID0gW107CiAgICAgIGlmIChkYXRhW19pWzBdXVtfaVsxXS1faVswXV0gPT09IHVuZGVmaW5lZCkKICAgICAgICBkYXRhW19pWzBdXVtfaVsxXS1faVswXV0gPSBbXTsKICAgICAgaWYgKGRhdGFbX2lbMF1dW19pWzFdLV9pWzBdXVtfaVsyXS1faVsxXV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhciBfaW5kZXggPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluZGV4Lmxlbmd0aDsgKytpKSB7CiAgICAgICAgICB2YXIgZGV0YyA9IGRldChsb2NhdGlvbnNbYWldLCBsb2NhdGlvbnNbYmldLCBsb2NhdGlvbnNbaW5kZXhbaV1dKTsKICAgICAgICAgIHZhciBkZXRhID0gZGV0KGxvY2F0aW9uc1tiaV0sIGxvY2F0aW9uc1tjaV0sIGxvY2F0aW9uc1tpbmRleFtpXV0pOwogICAgICAgICAgdmFyIGRldGIgPSBkZXQobG9jYXRpb25zW2NpXSwgbG9jYXRpb25zW2FpXSwgbG9jYXRpb25zW2luZGV4W2ldXSk7CiAgICAgICAgICBpZiAoZGV0YSA+IEVQUyAmJiBkZXRiID4gRVBTICYmIGRldGMgPiBFUFMpIHsKICAgICAgICAgICAgX2luZGV4LnB1c2goaW5kZXhbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgYmVzdGggPSAwOwogICAgICAgIHZhciBiZXN0aGkgPSAtMTsKICAgICAgICBpZiAoX2luZGV4Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICB2YXIgYSA9IGxvY2F0aW9uc1thaV07CiAgICAgICAgICB2YXIgYiA9IGxvY2F0aW9uc1tiaV07CiAgICAgICAgICB2YXIgYyA9IGxvY2F0aW9uc1tjaV07CiAgICAgICAgICB2YXIgcyA9IE1hdGguYWJzKGRldChhLCBiLCBjKSk7CiAgICAgICAgICB2YXIgY2ggPSBzIC8gZGlzdGFuY2UoYSwgYik7CiAgICAgICAgICB2YXIgYWggPSBzIC8gZGlzdGFuY2UoYiwgYyk7CiAgICAgICAgICB2YXIgYmggPSBzIC8gZGlzdGFuY2UoYywgYSk7CiAgICAgICAgICBiZXN0aCA9IE1hdGgubWluKGFoLCBiaCwgY2gpOwogICAgICAgICAgYmVzdGhpID0gLTE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBiZXN0aHMgPSAwOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfaW5kZXgubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgdmFyIGNoID0gX3N1YnRyaWFuZ3VsYXRlKGFpLCBiaSwgX2luZGV4W2ldLCBfaW5kZXgpOwogICAgICAgICAgICB2YXIgYWggPSBfc3VidHJpYW5ndWxhdGUoYmksIGNpLCBfaW5kZXhbaV0sIF9pbmRleCk7CiAgICAgICAgICAgIHZhciBiaCA9IF9zdWJ0cmlhbmd1bGF0ZShjaSwgYWksIF9pbmRleFtpXSwgX2luZGV4KTsKICAgICAgICAgICAgdmFyIF9iZXN0aCA9IE1hdGgubWluKGFoLCBiaCwgY2gpOwogICAgICAgICAgICB2YXIgX2Jlc3RocyA9IGFoICsgYmggKyBjaDsKICAgICAgICAgICAgaWYgKGJlc3RoIDwgX2Jlc3RoIHx8IE1hdGguYWJzKGJlc3RoIC0gX2Jlc3RoKSA8PSBFUFMgJiYgYmVzdGhzIDwgX2Jlc3RocykgewogICAgICAgICAgICAgIGJlc3RoID0gX2Jlc3RoOwogICAgICAgICAgICAgIGJlc3RocyA9IF9iZXN0aHM7CiAgICAgICAgICAgICAgYmVzdGhpID0gX2luZGV4W2ldOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRhdGFbX2lbMF1dW19pWzFdLV9pWzBdXVtfaVsyXS1faVsxXV0gPSB7aGVpZ2h0OiBiZXN0aCwgaW5kZXg6IGJlc3RoaX07CiAgICAgIH0KICAgICAgcmV0dXJuIGRhdGFbX2lbMF1dW19pWzFdLV9pWzBdXVtfaVsyXS1faVsxXV0uaGVpZ2h0OwogICAgfQogICAgdmFyIHN1YmluZGV4ID0gW107CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxvY2F0aW9ucy5sZW5ndGg7ICsraSkgewogICAgICBzdWJpbmRleC5wdXNoKGkpOwogICAgfQogICAgdmFyIGJlc3QgPSBbXTsKICAgIGZvciAodmFyIGxlbiA9IDE7IGxlbiA8PSBpbmRleC5sZW5ndGggLSAxOyArK2xlbikgewogICAgICBiZXN0W2xlbl0gPSBbXTsKICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBpbmRleC5sZW5ndGggLSBsZW47ICsraykgewogICAgICAgIHZhciB0ID0gMDsKICAgICAgICB2YXIgdGxlbiA9IC0xOwogICAgICAgIGZvciAodmFyIF9sZW4gPSAxOyBfbGVuIDw9IGxlbiAtIDE7ICsrX2xlbikgewogICAgICAgICAgdmFyIF90ID0gMDsKICAgICAgICAgICQuZWFjaChbYmVzdFtfbGVuXVtrXS5oZWlnaHQsIGJlc3RbbGVuLV9sZW5dW2srX2xlbl0uaGVpZ2h0LCBzdWJ0cmlhbmd1bGF0ZShpbmRleFtrXSwgaW5kZXhbaytfbGVuXSwgaW5kZXhbaytsZW5dLCBzdWJpbmRleCldLCBmdW5jdGlvbihndWlkLCBfX3QpIHsKICAgICAgICAgICAgaWYgKF9fdCA9PSAwKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaWYgKF90ID09IDAgfHwgX3QgPiBfX3QpCiAgICAgICAgICAgICAgX3QgPSBfX3Q7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmICh0ID09IDAgfHwgdCA8IF90KSB7CiAgICAgICAgICAgIHQgPSBfdDsKICAgICAgICAgICAgdGxlbiA9IF9sZW47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGJlc3RbbGVuXVtrXSA9IHtoZWlnaHQ6IHQsIGxlbmd0aDogdGxlbn07CiAgICAgIH0KICAgIH0KICAgIAogICAgdmFyIGVkZ2VzID0gW107CiAgICB2YXIgdHJpYW5nbGVzID0gW107CiAgICB2YXIgbWFrZXN1YnRyaWFuZ3VsYXRpb24gPSBmdW5jdGlvbiBfbWFrZXN1YnRyaWFuZ3VsYXRpb24oYWksIGJpLCBjaSwgZGVwdGgpIHsKICAgICAgdmFyIF9pID0gW2FpLCBiaSwgY2ldLnNvcnQoZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS1iO30pOwogICAgICBpZiAoZGF0YVtfaVswXV1bX2lbMV0tX2lbMF1dW19pWzJdLV9pWzFdXS5pbmRleCA9PSAtMSkgewogICAgICAgIHRyaWFuZ2xlcy5wdXNoKG5ldyB3aW5kb3cucGx1Z2luLmZseUxpbmtzLlRyaWFuZ2xlKGxvY2F0aW9uc1thaV0sIGxvY2F0aW9uc1tiaV0sIGxvY2F0aW9uc1tjaV0sIGRlcHRoKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX21ha2VzdWJ0cmlhbmd1bGF0aW9uKGFpLCBiaSwgZGF0YVtfaVswXV1bX2lbMV0tX2lbMF1dW19pWzJdLV9pWzFdXS5pbmRleCwgZGVwdGgrMSk7CiAgICAgICAgX21ha2VzdWJ0cmlhbmd1bGF0aW9uKGJpLCBjaSwgZGF0YVtfaVswXV1bX2lbMV0tX2lbMF1dW19pWzJdLV9pWzFdXS5pbmRleCwgZGVwdGgrMSk7CiAgICAgICAgX21ha2VzdWJ0cmlhbmd1bGF0aW9uKGNpLCBhaSwgZGF0YVtfaVswXV1bX2lbMV0tX2lbMF1dW19pWzJdLV9pWzFdXS5pbmRleCwgZGVwdGgrMSk7CiAgICAgICAgZWRnZXMucHVzaChuZXcgd2luZG93LnBsdWdpbi5mbHlMaW5rcy5FZGdlKGxvY2F0aW9uc1thaV0sIGxvY2F0aW9uc1tkYXRhW19pWzBdXVtfaVsxXS1faVswXV1bX2lbMl0tX2lbMV1dLmluZGV4XSwgZGVwdGgpKTsKICAgICAgICBlZGdlcy5wdXNoKG5ldyB3aW5kb3cucGx1Z2luLmZseUxpbmtzLkVkZ2UobG9jYXRpb25zW2JpXSwgbG9jYXRpb25zW2RhdGFbX2lbMF1dW19pWzFdLV9pWzBdXVtfaVsyXS1faVsxXV0uaW5kZXhdLCBkZXB0aCkpOwogICAgICAgIGVkZ2VzLnB1c2gobmV3IHdpbmRvdy5wbHVnaW4uZmx5TGlua3MuRWRnZShsb2NhdGlvbnNbY2ldLCBsb2NhdGlvbnNbZGF0YVtfaVswXV1bX2lbMV0tX2lbMF1dW19pWzJdLV9pWzFdXS5pbmRleF0sIGRlcHRoKSk7CiAgICAgIH0KICAgIH0KICAgIHZhciBtYWtldHJpYW5ndWxhdGlvbiA9IGZ1bmN0aW9uIF9tYWtldHJpYW5ndWxhdGlvbihsZW4sIGEpIHsKICAgICAgZWRnZXMucHVzaChuZXcgd2luZG93LnBsdWdpbi5mbHlMaW5rcy5FZGdlKGxvY2F0aW9uc1tpbmRleFthXV0sIGxvY2F0aW9uc1tpbmRleFthK2xlbl1dLCAwKSk7CiAgICAgIGlmIChiZXN0W2xlbl1bYV0ubGVuZ3RoID09IC0xKQogICAgICAgIHJldHVybjsKICAgICAgbWFrZXN1YnRyaWFuZ3VsYXRpb24oaW5kZXhbYV0sIGluZGV4W2ErYmVzdFtsZW5dW2FdLmxlbmd0aF0sIGluZGV4W2ErbGVuXSwgMSk7CiAgICAgIF9tYWtldHJpYW5ndWxhdGlvbihiZXN0W2xlbl1bYV0ubGVuZ3RoLCBhKTsKICAgICAgX21ha2V0cmlhbmd1bGF0aW9uKGxlbiAtIGJlc3RbbGVuXVthXS5sZW5ndGgsIGEgKyBiZXN0W2xlbl1bYV0ubGVuZ3RoKTsKICAgIH0KICAgIG1ha2V0cmlhbmd1bGF0aW9uKGluZGV4Lmxlbmd0aCAtIDEsIDApOwogICAgcmV0dXJuIHtlZGdlczogZWRnZXMsIHRyaWFuZ2xlczogdHJpYW5nbGVzfTsKICB9CiAgCiAgdmFyIHRyaWFuZ3VsYXRpb24gPSB0cmlhbmd1bGF0ZShpbmRleCwgbG9jYXRpb25zKTsKICB2YXIgZWRnZXMgPSB0cmlhbmd1bGF0aW9uLmVkZ2VzOwogIHZhciB0cmlhbmdsZXMgPSB0cmlhbmd1bGF0aW9uLnRyaWFuZ2xlczsKCiAgJC5lYWNoKGVkZ2VzLCBmdW5jdGlvbihpZHgsIGVkZ2UpIHsKICAgIGRyYXdMaW5rKGVkZ2UuYSwgZWRnZS5iLCB7CiAgICAgIGNvbG9yOiAnI0ZGMDAwMCcsCiAgICAgIG9wYWNpdHk6IDEsCiAgICAgIHdlaWdodDogMS41LAogICAgICBjbGlja2FibGU6IGZhbHNlLAogICAgICBzbW9vdGhGYWN0b3I6IDEwLAogICAgICBkYXNoQXJyYXk6IFs2LCA0XSwKICAgIH0pOwogIH0pOwogIAogICQuZWFjaCh0cmlhbmdsZXMsIGZ1bmN0aW9uKGlkeCwgdHJpYW5nbGUpIHsKICAgIGRyYXdGaWVsZCh0cmlhbmdsZS5hLCB0cmlhbmdsZS5iLCB0cmlhbmdsZS5jLCB7CiAgICAgIHN0cm9rZTogZmFsc2UsCiAgICAgIGZpbGw6IHRydWUsCiAgICAgIGZpbGxDb2xvcjogJyNGRjAwMDAnLAogICAgICBmaWxsT3BhY2l0eTogMSAtIE1hdGgucG93KDAuODUsIHRyaWFuZ2xlLmRlcHRoKSwKICAgICAgY2xpY2thYmxlOiBmYWxzZSwKICAgIH0pOwogIH0pOwp9Cgp3aW5kb3cucGx1Z2luLmZseUxpbmtzLkVkZ2UgPSBmdW5jdGlvbihhLCBiLCBkZXB0aCkgewogIHRoaXMuYSA9IGE7CiAgdGhpcy5iID0gYjsKICB0aGlzLmRlcHRoID0gZGVwdGg7Cn0KCndpbmRvdy5wbHVnaW4uZmx5TGlua3MuVHJpYW5nbGUgPSBmdW5jdGlvbihhLCBiLCBjLCBkZXB0aCkgewogIHRoaXMuYSA9IGE7CiAgdGhpcy5iID0gYjsKICB0aGlzLmMgPSBjOwogIHRoaXMuZGVwdGggPSBkZXB0aDsKfQoKd2luZG93LnBsdWdpbi5mbHlMaW5rcy5zZXR1cCA9IGZ1bmN0aW9uKCkgewogIHdpbmRvdy5wbHVnaW4uZmx5TGlua3MubGlua3NMYXllckdyb3VwID0gbmV3IEwuTGF5ZXJHcm91cCgpOwogIHdpbmRvdy5wbHVnaW4uZmx5TGlua3MuZmllbGRzTGF5ZXJHcm91cCA9IG5ldyBMLkxheWVyR3JvdXAoKTsKICAKICB3aW5kb3cuYWRkSG9vaygnbWFwRGF0YVJlZnJlc2hFbmQnLCBmdW5jdGlvbihlKSB7CiAgICB3aW5kb3cucGx1Z2luLmZseUxpbmtzLnVwZGF0ZUxheWVyKCk7CiAgfSk7CgogIHdpbmRvdy5tYXAub24oJ21vdmVlbmQnLCBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5wbHVnaW4uZmx5TGlua3MudXBkYXRlTGF5ZXIoKTsKICB9KTsKCiAgd2luZG93LmFkZExheWVyR3JvdXAoJ0ZseSBsaW5rcycsIHdpbmRvdy5wbHVnaW4uZmx5TGlua3MubGlua3NMYXllckdyb3VwLCBmYWxzZSk7CiAgd2luZG93LmFkZExheWVyR3JvdXAoJ0ZseSBmaWVsZHMnLCB3aW5kb3cucGx1Z2luLmZseUxpbmtzLmZpZWxkc0xheWVyR3JvdXAsIGZhbHNlKTsKfQp2YXIgc2V0dXAgPSB3aW5kb3cucGx1Z2luLmZseUxpbmtzLnNldHVwOwoKLy8gUExVR0lOIEVORCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKc2V0dXAuaW5mbyA9IHBsdWdpbl9pbmZvOyAvL2FkZCB0aGUgc2NyaXB0IGluZm8gZGF0YSB0byB0aGUgZnVuY3Rpb24gYXMgYSBwcm9wZXJ0eQppZighd2luZG93LmJvb3RQbHVnaW5zKSB3aW5kb3cuYm9vdFBsdWdpbnMgPSBbXTsKd2luZG93LmJvb3RQbHVnaW5zLnB1c2goc2V0dXApOwovLyBpZiBJSVRDIGhhcyBhbHJlYWR5IGJvb3RlZCwgaW1tZWRpYXRlbHkgcnVuIHRoZSAnc2V0dXAnIGZ1bmN0aW9uCmlmKHdpbmRvdy5paXRjTG9hZGVkICYmIHR5cGVvZiBzZXR1cCA9PT0gJ2Z1bmN0aW9uJykgc2V0dXAoKTsKfSAvLyB3cmFwcGVyIGVuZAovLyBpbmplY3QgY29kZSBpbnRvIHNpdGUgY29udGV4dAp2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CnZhciBpbmZvID0ge307CmlmICh0eXBlb2YgR01faW5mbyAhPT0gJ3VuZGVmaW5lZCcgJiYgR01faW5mbyAmJiBHTV9pbmZvLnNjcmlwdCkgaW5mby5zY3JpcHQgPSB7IHZlcnNpb246IEdNX2luZm8uc2NyaXB0LnZlcnNpb24sIG5hbWU6IEdNX2luZm8uc2NyaXB0Lm5hbWUsIGRlc2NyaXB0aW9uOiBHTV9pbmZvLnNjcmlwdC5kZXNjcmlwdGlvbiB9OwpzY3JpcHQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJygnKyB3cmFwcGVyICsnKSgnK0pTT04uc3RyaW5naWZ5KGluZm8pKycpOycpKTsKKGRvY3VtZW50LmJvZHkgfHwgZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmFwcGVuZENoaWxkKHNjcmlwdCk7CgoK"},{"name":"IITC plugin: Show the direction of links on the map","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.ingress.com/intel*","http://*.ingress.com/intel*","https://*.ingress.com/mission/*","http://*.ingress.com/mission/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1480919574045,"data":{}},"enabled":true,"position":14,"file_url":"https://static.iitc.me/build/release/plugins/link-show-direction.user.js","uuid":"1b68c6a8-2bc8-4664-9934-9f672d710484","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGlpdGMtcGx1Z2luLWxpbmstc2hvdy1kaXJlY3Rpb24KLy8gQG5hbWUgICAgICAgICAgIElJVEMgcGx1Z2luOiBTaG93IHRoZSBkaXJlY3Rpb24gb2YgbGlua3Mgb24gdGhlIG1hcAovLyBAY2F0ZWdvcnkgICAgICAgVHdlYWtzCi8vIEB2ZXJzaW9uICAgICAgICAwLjIuMS4yMDE2MTAwMy40NzQwCi8vIEBuYW1lc3BhY2UgICAgICBodHRwczovL2dpdGh1Yi5jb20vam9uYXRraW5zL2luZ3Jlc3MtaW50ZWwtdG90YWwtY29udmVyc2lvbgovLyBAdXBkYXRlVVJMICAgICAgaHR0cHM6Ly9zdGF0aWMuaWl0Yy5tZS9idWlsZC9yZWxlYXNlL3BsdWdpbnMvbGluay1zaG93LWRpcmVjdGlvbi5tZXRhLmpzCi8vIEBkb3dubG9hZFVSTCAgICBodHRwczovL3N0YXRpYy5paXRjLm1lL2J1aWxkL3JlbGVhc2UvcGx1Z2lucy9saW5rLXNob3ctZGlyZWN0aW9uLnVzZXIuanMKLy8gQGRlc2NyaXB0aW9uICAgIFtpaXRjLTIwMTYtMTAtMDMtMDA0NzQwXSBTaG93IHRoZSBkaXJlY3Rpb24gb2YgbGlua3Mgb24gdGhlIG1hcCBieSBhZGRpbmcgc2hvcnQgZGFzaGVzIHRvIHRoZSBsaW5lIGF0IHRoZSBvcmlnaW4gcG9ydGFsLgovLyBAaW5jbHVkZSAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL2ludGVsKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBtYXRjaCAgICAgICAgICBodHRwczovLyouaW5ncmVzcy5jb20vaW50ZWwqCi8vIEBtYXRjaCAgICAgICAgICBodHRwOi8vKi5pbmdyZXNzLmNvbS9pbnRlbCoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKi5pbmdyZXNzLmNvbS9taXNzaW9uLyoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cHM6Ly8qLmluZ3Jlc3MuY29tL21pc3Npb24vKgovLyBAbWF0Y2ggICAgICAgICAgaHR0cDovLyouaW5ncmVzcy5jb20vbWlzc2lvbi8qCi8vIEBncmFudCAgICAgICAgICBub25lCi8vID09L1VzZXJTY3JpcHQ9PQoKCmZ1bmN0aW9uIHdyYXBwZXIocGx1Z2luX2luZm8pIHsKLy8gZW5zdXJlIHBsdWdpbiBmcmFtZXdvcmsgaXMgdGhlcmUsIGV2ZW4gaWYgaWl0YyBpcyBub3QgeWV0IGxvYWRlZAppZih0eXBlb2Ygd2luZG93LnBsdWdpbiAhPT0gJ2Z1bmN0aW9uJykgd2luZG93LnBsdWdpbiA9IGZ1bmN0aW9uKCkge307CgovL1BMVUdJTiBBVVRIT1JTOiB3cml0aW5nIGEgcGx1Z2luIG91dHNpZGUgb2YgdGhlIElJVEMgYnVpbGQgZW52aXJvbm1lbnQ/IGlmIHNvLCBkZWxldGUgdGhlc2UgbGluZXMhIQovLyhsZWF2aW5nIHRoZW0gaW4gcGxhY2UgbWlnaHQgYnJlYWsgdGhlICdBYm91dCBJSVRDJyBwYWdlIG9yIGJyZWFrIHVwZGF0ZSBjaGVja3MpCnBsdWdpbl9pbmZvLmJ1aWxkTmFtZSA9ICdpaXRjJzsKcGx1Z2luX2luZm8uZGF0ZVRpbWVWZXJzaW9uID0gJzIwMTYxMDAzLjQ3NDAnOwpwbHVnaW5faW5mby5wbHVnaW5JZCA9ICdsaW5rLXNob3ctZGlyZWN0aW9uJzsKLy9FTkQgUExVR0lOIEFVVEhPUlMgTk9URQoKCgovLyBQTFVHSU4gU1RBUlQgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgovLyB1c2Ugb3duIG5hbWVzcGFjZSBmb3IgcGx1Z2luCndpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24gPSBmdW5jdGlvbigpIHt9Owp3aW5kb3cucGx1Z2luLmxpbmtTaG93RGlyZWN0aW9uLkFOSU1BVEVfVVBEQVRFX1RJTUUgPSAxMDAwOyAvLyAxMDAwbXMgPSAxcwoKd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5zdHlsZXMgPSB7CiAgJ0Rpc2FibGVkJzogW251bGxdLAogICdTdGF0aWMgKic6IFsKICAgICczMCw1LDE1LDUsMTUsNSwyLDUsMiw1LDIsNSwyLDUsMzAsMCcsCiAgXSwKICAnU3RhdGljIG5lYXIgb3JpZ2luJzogWwogICAgJzEwLDUsNSw1LDUsNSw1LDUsMTAwJScsCiAgXSwKICAnQW5pbWF0ZSBuZWFyIG9yaWdpbic6IFsKICAgICcxMCw1LDUsNSw1LDUsNSw1LDEwMCUnLAogICAgJzEyLDUsNSw1LDUsNSw1LDMsMTAwJScsCiAgICAnMTQsNSw1LDUsNSw1LDUsMSwxMDAlJywKICAgICcxMCwxLDUsNSw1LDUsNSw1LDEwMCUnLAogICAgJzEwLDMsNSw1LDUsNSw1LDUsMTAwJScsCiAgXSwKICAnQW5pbWF0ZSBmdWxsIGxpbmsnOiBbCiAgICAnNCw2LDQsNiw0LDYsNCw2JywKICAgICcwLDIsNCw2LDQsNiw0LDQnLAogICAgJzAsNCw0LDYsNCw2LDQsMicsCiAgICAnMCw2LDQsNiw0LDYsNCwwJywKICAgICcyLDYsNCw2LDQsNiwyLDAnLAogIF0sCn07CndpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24uZGFzaEFycmF5ID0gbnVsbDsKd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5mcmFtZSA9IDA7CndpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24ubW92aW5nID0gZmFsc2U7CgoKd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5hbmltYXRlTGlua3MgPSBmdW5jdGlvbigpIHsKICB2YXIgZnJhbWVzID0gd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5zdHlsZXNbd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5tb2RlXTsKICBpZighZnJhbWVzKSBmcmFtZXMgPSBbbnVsbF07CgogIGlmKCF3aW5kb3cucGx1Z2luLmxpbmtTaG93RGlyZWN0aW9uLm1vdmluZykgewogICAgdmFyIGZyYW1lID0gd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5mcmFtZTsKICAgIGZyYW1lID0gKGZyYW1lICsgMSkgJSBmcmFtZXMubGVuZ3RoOwogICAgd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5mcmFtZSA9IGZyYW1lOwoKICAgIHdpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24uZGFzaEFycmF5ID0gZnJhbWVzW2ZyYW1lXTsKICAgIHdpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24uYWRkQWxsTGlua1N0eWxlcygpOwogIH0KCiAgaWYoZnJhbWVzLmxlbmd0aCA8IDIpIHJldHVybjsgLy8gbm8gYW5pbWF0aW9uIG5lZWRlZAoKICAvLyBicm93c2VycyBkb24ndCByZW5kZXIgdGhlIFNWRyBzdHlsZSBjaGFuZ2VzIHVudGlsIGFmdGVyIHRoZSB0aW1lciBmdW5jdGlvbiBoYXMgZmluaXNoZWQuCiAgLy8gdGhpcyBtZWFucyBpZiB3ZSBzdGFydCB0aGUgbmV4dCB0aW1lb3V0IGluIGhlcmUgYSBsb3Qgb2YgdGhlIGRlbGF5IHRpbWUgd2lsbCBiZSB0YWtlbiBieSB0aGUgYnJvd3NlciBpdHNlbGYKICAvLyByZS1yZW5kZXJpbmcgdGhlIHNjcmVlbi4gaW4gdGhlIHdvcnN0IGNhc2UsIHRoZSB0aW1lciB3aWxsIHJ1biBvdXQgYmVmb3JlIHRoZSByZW5kZXIgY29tcGxldGVzLCBhbmQgZmlyZSBpbW1lZGlhdGVseQogIC8vIHRoaXMgd291bGQgbWVhbiB0aGUgdXNlciBoYXMgbm8gY2hhbmNlIHRvIGludGVyYWN0IHdpdGggSUlUQwogIC8vIHRvIHByZXZlbnQgdGhpcywgY3JlYXRlIGEgc2hvcnQgdGltZXIgdGhhdCB0aGVuIHNldHMgdGhlIHRpbWVyIGZvciB0aGUgbmV4dCBmcmFtZS4gaWYgdGhlIGJyb3dzZXIgaXMgc2xvdyB0byByZW5kZXIsCiAgLy8gdGhlIHNob3J0IHRpbWVyIHNob3VsZCBmaXJlIGxhdGVyLCBhdCB3aGljaCBwb2ludCB0aGUgZGVzaXJlZCBBTklNQVRFX1VQREFURV9USU1FIHRpbWVyIGlzIHN0YXJ0ZWQKICBjbGVhclRpbWVvdXQod2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi50aW1lcik7CiAgd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi50aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICBjbGVhclRpbWVvdXQod2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi50aW1lcik7CiAgICB3aW5kb3cucGx1Z2luLmxpbmtTaG93RGlyZWN0aW9uLnRpbWVyID0gc2V0VGltZW91dCgKICAgICAgd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5hbmltYXRlTGlua3MsCiAgICAgIHdpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24uQU5JTUFURV9VUERBVEVfVElNRSk7CiAgfSwgMTApOwp9OwoKd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5hZGRBbGxMaW5rU3R5bGVzID0gZnVuY3Rpb24oKSB7CiAgJC5lYWNoKGxpbmtzLGZ1bmN0aW9uKGd1aWQsbGluaykgeyB3aW5kb3cucGx1Z2luLmxpbmtTaG93RGlyZWN0aW9uLmFkZExpbmtTdHlsZShsaW5rKTsgfSk7CgogIGlmKHdpbmRvdy5wbHVnaW4uZHJhd1Rvb2xzICYmIGxvY2FsU3RvcmFnZVsncGx1Z2luLWxpbmtzaG93ZGlyZWN0aW9uLWRyYXd0b29scyddID09ICJ0cnVlIikgewogICAgd2luZG93LnBsdWdpbi5kcmF3VG9vbHMuZHJhd25JdGVtcy5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpIHsKICAgICAgaWYobGF5ZXIgaW5zdGFuY2VvZiBMLkdlb2Rlc2ljUG9seWxpbmUpCiAgICAgICAgd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5hZGRMaW5rU3R5bGUobGF5ZXIpOwogICAgfSk7CiAgfQp9OwoKd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5hZGRMaW5rU3R5bGUgPSBmdW5jdGlvbihsaW5rKSB7CiAgbGluay5zZXRTdHlsZSh7ZGFzaEFycmF5OiB3aW5kb3cucGx1Z2luLmxpbmtTaG93RGlyZWN0aW9uLmRhc2hBcnJheX0pOwp9OwoKd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5yZW1vdmVEcmF3VG9vbHNTdHlsZSA9IGZ1bmN0aW9uKCkgewogIGlmKCF3aW5kb3cucGx1Z2luLmRyYXdUb29scykgcmV0dXJuOwoKICB3aW5kb3cucGx1Z2luLmRyYXdUb29scy5kcmF3bkl0ZW1zLmVhY2hMYXllcihmdW5jdGlvbihsYXllcikgewogICAgaWYobGF5ZXIgaW5zdGFuY2VvZiBMLkdlb2Rlc2ljUG9seWxpbmUpCiAgICAgIGxheWVyLnNldFN0eWxlKHtkYXNoQXJyYXk6IG51bGx9KTsKICB9KTsKfTsKCndpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24uc2hvd0RpYWxvZyA9IGZ1bmN0aW9uKCkgewogIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCiAgJC5lYWNoKHdpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24uc3R5bGVzLCBmdW5jdGlvbihzdHlsZSkgewogICAgdmFyIGxhYmVsID0gZGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJykpOwogICAgdmFyIGlucHV0ID0gbGFiZWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKSk7CiAgICBpbnB1dC50eXBlID0gJ3JhZGlvJzsKICAgIGlucHV0Lm5hbWUgPSAncGx1Z2luLWxpbmstc2hvdy1kaXJlY3Rpb24nOwogICAgaW5wdXQudmFsdWUgPSBzdHlsZTsKICAgIGlmKHN0eWxlID09IHdpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24ubW9kZSkgewogICAgICBpbnB1dC5jaGVja2VkID0gdHJ1ZTsKICAgIH0KCiAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkgewogICAgICB3aW5kb3cucGx1Z2luLmxpbmtTaG93RGlyZWN0aW9uLm1vZGUgPSBzdHlsZTsKICAgICAgbG9jYWxTdG9yYWdlWydwbHVnaW4tbGlua3Nob3dkaXJlY3Rpb24tbW9kZSddID0gc3R5bGU7CiAgICAgIHdpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24uYW5pbWF0ZUxpbmtzKCk7CiAgICB9LCBmYWxzZSk7CgogICAgbGFiZWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyAnICsgc3R5bGUpKTsKCiAgICBkaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnInKSk7CiAgfSk7CgogIGRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgKICAgICcgKiBTdGF0aWM6IHNpeCBzZWdtZW50cyB3aWxsIGluZGljYXRlIGVhY2ggbGlua1wncyBkaXJlY3Rpb24uICcgKwogICAgJ1R3byBsb25nIHNlZ21lbnRzIGFyZSBvbiB0aGUgb3JpZ2luXCdzIHNpZGUsIGZvbGxvdyBieSBmb3VyIHNob3J0IHNlZ21lbnRzIG9uIHRoZSBkZXN0aW5hdGlvblwncyBzaWRlLicpKTsKCiAgaWYod2luZG93LnBsdWdpbi5kcmF3VG9vbHMpIHsKICAgIGRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdicicpKTsKCiAgICB2YXIgbGFiZWwgPSBkaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKSk7CiAgICB2YXIgaW5wdXQgPSBsYWJlbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpKTsKICAgIGlucHV0LnR5cGUgPSAnY2hlY2tib3gnOwogICAgaW5wdXQuY2hlY2tlZCA9IGxvY2FsU3RvcmFnZVsncGx1Z2luLWxpbmtzaG93ZGlyZWN0aW9uLWRyYXd0b29scyddID09ICJ0cnVlIjsKCiAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkgewogICAgICBsb2NhbFN0b3JhZ2VbJ3BsdWdpbi1saW5rc2hvd2RpcmVjdGlvbi1kcmF3dG9vbHMnXSA9IGlucHV0LmNoZWNrZWQudG9TdHJpbmcoKTsKICAgICAgCiAgICAgIGlmKGlucHV0LmNoZWNrZWQpCiAgICAgICAgd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5hbmltYXRlTGlua3MoKTsKICAgICAgZWxzZQogICAgICAgIHdpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24ucmVtb3ZlRHJhd1Rvb2xzU3R5bGUoKTsKICAgIH0sIGZhbHNlKTsKCiAgICBsYWJlbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnIEFwcGx5IHRvIERyYXdUb29scycpKTsKICB9CgogIGRpYWxvZyh7CiAgICBpZDogJ3BsdWdpbi1saW5rLXNob3ctZGlyZWN0aW9uJywKICAgIGh0bWw6IGRpdiwKICAgIHRpdGxlOiAnU2hvdyBsaW5rIGRpcmVjdGlvbicsCiAgfSk7Cn07Cgp3aW5kb3cucGx1Z2luLmxpbmtTaG93RGlyZWN0aW9uLnNldHVwICA9IGZ1bmN0aW9uKCkgewogICQoJyN0b29sYm94JykuYXBwZW5kKCcgPGEgb25jbGljaz0id2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5zaG93RGlhbG9nKCkiPkxpbmtEaXJlY3Rpb24gT3B0PC9hPicpOwoKICBhZGRIb29rKCdsaW5rQWRkZWQnLCBmdW5jdGlvbihkYXRhKSB7IHdpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24uYWRkTGlua1N0eWxlKGRhdGEubGluayk7IH0pOwoKICB0cnkgewogICAgd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5tb2RlID0gbG9jYWxTdG9yYWdlWydwbHVnaW4tbGlua3Nob3dkaXJlY3Rpb24tbW9kZSddOwogIH0gY2F0Y2goZSkgewogICAgY29uc29sZS53YXJuKGUpOwogICAgd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5tb2RlID0gJ0Rpc2FibGVkJzsKICB9CgogIC8vIG9ubHkgc3RhcnQgdGhlIGFuaW1hdGlvbiB0aW1lciBvZiB0aGUgcGF0aHMgc3VwcG9ydCBTVkcKICBpZihMLlBhdGguU1ZHKSB7CiAgICB3aW5kb3cucGx1Z2luLmxpbmtTaG93RGlyZWN0aW9uLmFuaW1hdGVMaW5rcygpOwoKICAgIC8vIHNldCB1cCBtb3ZlIHN0YXJ0L2VuZCBoYW5kbGVycyB0byBwYXVzZSBhbmltYXRpb25zIHdoaWxlIG1vdmluZwogICAgbWFwLm9uKCdtb3Zlc3RhcnQnLCBmdW5jdGlvbigpIHsgd2luZG93LnBsdWdpbi5saW5rU2hvd0RpcmVjdGlvbi5tb3ZpbmcgPSB0cnVlOyB9KTsKICAgIG1hcC5vbignbW92ZWVuZCcsIGZ1bmN0aW9uKCkgeyB3aW5kb3cucGx1Z2luLmxpbmtTaG93RGlyZWN0aW9uLm1vdmluZyA9IGZhbHNlOyB9KTsKICB9IGVsc2UgewogICAgY29uc29sZS53YXJuKCdsaW5rLXNob3ctZGlyZWN0aW9uOiBub3QgdXNpbmcgU1ZHLCB2aXN1YWxpemF0aW9uIG9mIGxpbmsgZGlyZWN0aW9uIGlzIG5vdCBzdXBwb3J0ZWQhJyk7CiAgfQp9OwoKdmFyIHNldHVwID0gIHdpbmRvdy5wbHVnaW4ubGlua1Nob3dEaXJlY3Rpb24uc2V0dXA7CgovLyBQTFVHSU4gRU5EIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgpzZXR1cC5pbmZvID0gcGx1Z2luX2luZm87IC8vYWRkIHRoZSBzY3JpcHQgaW5mbyBkYXRhIHRvIHRoZSBmdW5jdGlvbiBhcyBhIHByb3BlcnR5CmlmKCF3aW5kb3cuYm9vdFBsdWdpbnMpIHdpbmRvdy5ib290UGx1Z2lucyA9IFtdOwp3aW5kb3cuYm9vdFBsdWdpbnMucHVzaChzZXR1cCk7Ci8vIGlmIElJVEMgaGFzIGFscmVhZHkgYm9vdGVkLCBpbW1lZGlhdGVseSBydW4gdGhlICdzZXR1cCcgZnVuY3Rpb24KaWYod2luZG93LmlpdGNMb2FkZWQgJiYgdHlwZW9mIHNldHVwID09PSAnZnVuY3Rpb24nKSBzZXR1cCgpOwp9IC8vIHdyYXBwZXIgZW5kCi8vIGluamVjdCBjb2RlIGludG8gc2l0ZSBjb250ZXh0CnZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKdmFyIGluZm8gPSB7fTsKaWYgKHR5cGVvZiBHTV9pbmZvICE9PSAndW5kZWZpbmVkJyAmJiBHTV9pbmZvICYmIEdNX2luZm8uc2NyaXB0KSBpbmZvLnNjcmlwdCA9IHsgdmVyc2lvbjogR01faW5mby5zY3JpcHQudmVyc2lvbiwgbmFtZTogR01faW5mby5zY3JpcHQubmFtZSwgZGVzY3JpcHRpb246IEdNX2luZm8uc2NyaXB0LmRlc2NyaXB0aW9uIH07CnNjcmlwdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnKCcrIHdyYXBwZXIgKycpKCcrSlNPTi5zdHJpbmdpZnkoaW5mbykrJyk7JykpOwooZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCgo="}]}